/**
 * skylark-lucksheet - A version of lucksheet.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["../widgets/constant","../store","../locale/locale","../vendors/numeral"],function(t,e,n,r){"use strict";const{columeHeader_word:o,columeHeader_word_index:l,luckysheetdefaultFont:i}=t;function a(t){if(null==t||0==t.length)return{};let e=t.split(";");const r=n(),o=r.fontarray,l=r.fontjson;let i={ff:o[0],fc:"#000000",fs:10,cl:0,un:0,bl:0,it:0};return e.forEach(t=>{let e=u((t=t.toLowerCase()).substr(0,t.indexOf(":"))),n=u(t.substr(t.indexOf(":")+1));if("font-weight"==e&&(i.bl="bold"==n?1:0),"font-style"==e&&(i.it="italic"==n?1:0),"font-family"==e){let t=l[n];i.ff=null==t?n:t}"font-size"==e&&(i.fs=parseInt(n)),"color"==e&&(i.fc=n),"text-decoration"==e&&(i.cl=1),"border-bottom"==e&&(i.un=1),"lucky-strike"==e&&(i.cl=n),"lucky-underline"==e&&(i.un=n)}),i}function u(t){return null==t||0==t.length?t:t.replace(/^\s+|\s+$/gm,"")}function c(t){return!(null==t||t.toString().length<5)&&!!function(t){if(!/^(\d{4})-(\d{1,2})-(\d{1,2})(\s(\d{1,2}):(\d{1,2})(:(\d{1,2}))?)?$/.test(t)&&!/^(\d{4})\/(\d{1,2})\/(\d{1,2})(\s(\d{1,2}):(\d{1,2})(:(\d{1,2}))?)?$/.test(t))return!1;var e=RegExp.$1,n=RegExp.$2,r=RegExp.$3;if(e<1900)return!1;if(n>12)return!1;if(r>31)return!1;if(2==n){if(29==new Date(e,1,29).getDate()&&r>29)return!1;if(29!=new Date(e,1,29).getDate()&&r>28)return!1}return!0}(t)}function s(t){let e={};return c(t)&&(e.date=!0),isNaN(parseFloat(t))||h(t)||(e.num=!0),e}function f(t){let e="string";return c(t)?e="date":isNaN(parseFloat(t))||h(t)||(e="num"),e}function d(t){return null!=t&&""!==t.toString().replace(/\s/g,"")&&("boolean"!=typeof t&&!isNaN(t))}function h(t){return!!/[\u4E00-\u9FA5]|[\uFE30-\uFFA0]/gi.exec(t)}function g(t){return{"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regExp","[object Undefined]":"undefined","[object Null]":"null","[object Object]":"object"}[Object.prototype.toString.call(t)]}function p(t,e){let n=o.length;if(1==t){let t=[],e=0;for(let r=0;r<n;r++){let l=o[r];for(let r=0;r<n;r++){let n=l+o[r];if(t.push(n),++e>index)return t}}}else if(2==t){let t=[],e=0;for(let r=0;r<n;r++){let l=o[r];for(let r=0;r<n;r++){let i=o[r];for(let r=0;r<n;r++){let n=l+i+o[r];if(t.push(n),++e>index)return t}}}}}var m,b,y,w;return{isJsonString:function(t){try{if("object"==typeof JSON.parse(t))return!0}catch(t){}return!1},common_extend:function(t,e){let n={};for(let e in t)n[e]=t[e];for(let t in e)void 0!=e[t]&&(n[t]=e[t]);return n},replaceHtml:function(t,e){return t.replace(/\$\{([\w]+)\}/g,function(t,n){let r=e[n];return void 0!==r?r:t})},getObjType:g,getNowDateTime:function(t){let e=new Date,n=e.getFullYear(),r=e.getMonth(),o=e.getDate(),l=(e.getDay(),e.getHours()),i=e.getMinutes(),a=e.getSeconds();(r+=1)<10&&(r="0"+r),o<10&&(o="0"+o),l<10&&(l="0"+l),i<10&&(i="0"+i),a<10&&(a="0"+a);let u="";return 1==t?u=n+"-"+r+"-"+o:2==t&&(u=n+"-"+r+"-"+o+" "+l+":"+i+":"+a),u},hexToRgb:function(t){let e=[],n=[];if(3==(t=t.replace(/#/,"")).length){let e=[];for(let n=0;n<3;n++)e.push(t.charAt(n)+t.charAt(n));t=e.join("")}for(let r=0;r<3;r++)e[r]="0x"+t.substr(r+2,2),n.push(parseInt(Number(e[r])));return"rgb("+n.join(",")+")"},rgbTohex:function(t){let e;return e=t.indexOf("rgba")>-1?t.replace("rgba(","").replace(")","").split(","):t.replace("rgb(","").replace(")","").split(","),"#"+((1<<24)+(parseInt(e[0])<<16)+(parseInt(e[1])<<8)+parseInt(e[2])).toString(16).slice(1)},ABCatNum:function(t){if(null==t||0==t.length)return NaN;for(var e=t.toLowerCase().split(""),n=e.length,r=0,o=0;o<n;o++)r+=(e[o].charCodeAt()-96)*Math.pow(26,n-o-1);return 0==r?NaN:r-1},chatatABC:function(t){for(var e="a".charCodeAt(0),n="z".charCodeAt(0)-e+1,r="";t>=0;)r=String.fromCharCode(t%n+e)+r,t=Math.floor(t/n)-1;return r.toUpperCase()},ceateABC:function(t){let e=o.length;if(t<e)return o;{let n=[],r=2,l=0;for(;t<e/(e-1)*(Math.pow(e,r)-1);)l=r,r++;for(let e=0;e<l;e++)n=0==e?n.concat(o):n.concat(p(e),t)}},createABCdim:p,getByteLen:function(t,e){if(0===e)return"";if(null==t)return 0;let n=0;for(let r=0;r<t.length;r++)if(null!=t.charAt(r).match(/[^\x00-\xff]/gi)?n+=2:n+=1,d(e)&&n===~~e)return t.substring(0,r);return n},ArrayUnique:function(t){let e=[],n={};if(t.length>0)for(let r=0;r<t.length;r++){let o=t[r];n[o]||(e.push(o),n[o]=1)}return e},luckysheetfontformat:function(t){let r=n().fontarray;if("object"==g(t)){let o="";if("0"==t.it||null==t.it?o+="normal ":o+="italic ",o+="normal ","0"==t.bl||null==t.bl?o+="normal ":o+="bold ",t.fs?o+=Math.ceil(t.fs)+"pt ":o+=e.defaultFontSize+"pt ",t.ff){let e=null;n().fontjson,s(t.ff).num?e=r[parseInt(t.ff)]:((e=(e=t.ff).replace(/"/g,"").replace(/'/g,"")).indexOf(" ")>-1&&(e='"'+e+'"'),null!=e&&document.fonts&&document.fonts.check("12px "+e)),null==e&&(e=r[0]),o+=e+', "Helvetica Neue", Helvetica, Arial, "PingFang SC", "Hiragino Sans GB", "Heiti SC", "Microsoft YaHei", "WenQuanYi Micro Hei", sans-serif'}else o+=r[0]+', "Helvetica Neue", Helvetica, Arial, "PingFang SC", "Hiragino Sans GB", "Heiti SC", "Microsoft YaHei", "WenQuanYi Micro Hei", sans-serif';return o}return i()},showrightclickmenu:function(t,e,n){let r=$(window).height(),o=$(window).width(),l=t.width(),i=t.height(),a=n,u=e;e+l>o&&(u=e-l),n+i>r&&(a=n-i),a<0&&(a=0),t.css({top:a,left:u}).show()},luckysheetactiveCell:function(){e.fullscreenmode&&setTimeout(function(){$("#luckysheet-rich-text-editor").focus().select()},50)},numFormat:function(t,e){if(null==t||isNaN(parseFloat(t))||h(t)||t==-1/0||t==1/0)return null;let n=6,o=!1;null==e||"auto"==e?n=t<1?6:1:"num"==f(e)?(n=parseInt(e),o=!0):n=6;let l="",i=null;for(let t=0;t<n;t++)l+="0";return o||(l="["+l+"]"),i=t>=1e21?parseFloat(r(t).value()):parseFloat(r(t).format("0."+l))},numfloatlen:function(t){if(null==t||isNaN(parseFloat(t))||h(t))return null;{let e=r(t).value().toString().split(".");return e=1==e.length?0:e[1].length}},mouseclickposition:function(t,e,n,r){let o=$(window).height(),l=($(window).width(),t.width());t.height(),null==r&&(r="lefttop"),"lefttop"==r?t.css({top:n,left:e}).show():"righttop"==r?t.css({top:n,left:e-l}).show():"leftbottom"==r?t.css({bottom:o-n-12,left:e}).show():"rightbottom"==r&&t.css({bottom:o-n-12,left:e-l}).show()},$$:function(t,e){var n=(e=e||document).querySelectorAll(t);return 1==n.length?Array.prototype.slice.call(n)[0]:Array.prototype.slice.call(n)},seriesLoadScripts:function(t,e,n){"object"!=typeof t&&(t=[t]);var r=document.getElementsByTagName("head")[0]||document.documentElement,o=[],l=t.length-1,i=function(a){if(o[a]=document.createElement("script"),o[a].setAttribute("type","text/javascript"),o[a].onload=o[a].onreadystatechange=function(){this.onload=this.onreadystatechange=null,this.parentNode.removeChild(this),a!==l?i(a+1):"function"==typeof n&&n()},o[a].setAttribute("src",t[a]),"object"==typeof e)for(var u in e)o[a].setAttribute(u,e[u]);r.appendChild(o[a])};i(0)},parallelLoadScripts:function(t,e,n){"object"!=typeof t&&(t=[t]);for(var r=document.getElementsByTagName("head")[0]||document.documentElement,o=[],l=0,i=0;i<t.length;i++){if(o[i]=document.createElement("script"),o[i].setAttribute("type","text/javascript"),o[i].onload=o[i].onreadystatechange=function(){l++,this.onload=this.onreadystatechange=null,this.parentNode.removeChild(this),l===t.length&&"function"==typeof n&&n()},o[i].setAttribute("src",t[i]),"object"==typeof e)for(var a in e)o[i].setAttribute(a,e[a]);r.appendChild(o[i])}},loadLinks:function(t){"object"!=typeof t&&(t=[t]),t.length&&t.forEach(t=>{!function(t){var e=document,n=e.createElement("link");n.setAttribute("rel","stylesheet"),n.setAttribute("type","text/css"),n.setAttribute("href",t);var r=e.getElementsByTagName("head");r.length?r[0].appendChild(n):e.documentElement.appendChild(n)}(t)})},luckysheetContainerFocus:function(){$("#"+e.container).attr("tabindex",0).focus()},transformRangeToAbsolute:function(t){if(null==t||0==t.length)return null;let e=t.split(","),n="";for(let t=0;t<e.length;t++){let r=e[t].split("!"),o="",l="";r.length>1?(o=r[0],l=r[1]):l=r[0];let i=l.split(":"),a="";for(let t=0;t<i.length;t++){let e=i[t],n=e.replace(/[^0-9]/g,""),r=e.replace(/[^A-Za-z]/g,""),o="";""!=r&&(o+="$"+r),""!=n&&(o+="$"+n),a+=o+":"}n+=o+(a=a.substr(0,a.length-1))+","}return n.substr(0,n.length-1)},openSelfModel:function(t,e=!0){let n=$("#"+t).find(".luckysheet-modal-dialog-content").css("min-width",300).end(),r=n.outerHeight(),o=n.outerWidth(),l=$(window).width(),i=$(window).height(),a=$(document).scrollLeft(),u=$(document).scrollTop();n.css({left:(l+a-o)/2,top:(i+u-r)/3}).show(),e&&$("#luckysheet-modal-dialog-mask").show()},createProxy:(t,e,n)=>{t.hasOwnProperty(e)?"object"===g(t)&&("object"===g(t[e])||"array"===g(t[e])?(m=t,b=e,y=t[e],n=n,m[b]=new Proxy(y,{set:(t,e,r,o)=>(setTimeout(()=>{n(t,e,r,o)},0),Reflect.set(t,e,r,o))})):function(t,e,n,r){Object.defineProperty(t,e,{enumerable:!0,configurable:!1,get:()=>n,set(t){n!==t&&(console.log(`发现 ${e} 属性 ${n} -> ${t}`),setTimeout(()=>{r(n,t)},0),n=t)}})}(t,e,t[e],n)):console.info("No %s in data",e)},arrayRemoveItem:function(t,e){t.some((t,n,r)=>{if(t===e)return r.splice(n,1),t===e})},isRealNull:function(t){return null==t||""==t.toString().replace(/\s/g,"")},isRealNum:d,hasChinaword:h,isdatetime:c,isdatatype:f,isdatatypemulti:s,textTrim:u,convertCssToStyleList:a,convertSpanToShareString:function(t){let e,n=[],r=null;for(let o=0;o<t.length;o++){let l=t.get(o),i=a(l.style.cssText),u=JSON.stringify(i),c=l.innerText;c=c.replace(/\n/g,"\r\n"),u==r?e.v+=c:(i.v=c,n.push(i),r=u,e=i)}return n}}});
//# sourceMappingURL=../sourcemaps/utils/util.js.map
