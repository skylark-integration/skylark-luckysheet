/**
 * skylark-lucksheet - A version of lucksheet.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["./rhchInit","./formula","./editor","./setdata","./getdata","./getRowlen","./draw","../controllers/freezen","../controllers/server","../controllers/sheetmanage","../controllers/postil","../controllers/dataVerificationCtrl","../controllers/hyperlinkCtrl","../controllers/select","../controllers/filter","../methods/get","../store"],function(e,t,l,a,n,r,c,i,o,u,d,f,s,h,g,x,m){"use strict";const{setcellvalue:w}=a,{getcellFormula:y}=n,{computeRowlenArr:v}=r,{luckysheetDrawMain:k,luckysheetDrawgridRowTitle:_,luckysheetDrawgridColumnTitle:I}=c,{selectHightlightShow:p,selectionCopyShow:S,collaborativeEditBox:z}=h,{createFilterOptions:C}=g,{getSheetIndex:P}=x;let V=null;function b(e,l,a){t.execFunctionExist=[];for(let a=0;a<e.length;a++)for(let n=e[a].row[0];n<=e[a].row[1];n++)for(let r=e[a].column[0];r<=e[a].column[1];r++)t.execFunctionExist.push({r:n,c:r,i:l});t.execFunctionExist.reverse(),t.execFunctionGroup(null,null,null,null,a),t.execFunctionGlobalData=null}function D(l,a,n=!0){e(l,a),clearTimeout(V),u.storeSheetParam();let r=m.luckysheetfile[P(m.currentSheetIndex)].calcChain;if(null!=r&&r.length>0){null==m.config.rowlen&&(m.config.rowlen={}),null==m.config.columnlen&&(m.config.columnlen={});for(let e=0;e<r.length;e++){let l=r[e].r,a=r[e].c;if(r[e].index==m.currentSheetIndex&&null!=m.flowdata[l][a]&&null!=m.flowdata[l][a].spl&&(l in m.config.rowlen||a in m.config.columnlen)){window.luckysheetCurrentRow=l,window.luckysheetCurrentColumn=a,window.luckysheetCurrentFunction=m.flowdata[l][a].f;let e=$.trim(t.functionParserExe(m.flowdata[l][a].f)),n=new Function("return "+e)();m.flowdata[l][a].spl=n,o.saveParam("v",m.currentSheetIndex,m.flowdata[l][a],{r:l,c:a})}}m.luckysheetfile[P(m.currentSheetIndex)].data=m.flowdata}if(d.positionSync(),p(),z(),$(".luckysheet-selection-copy").is(":visible")&&S(),$("#luckysheet-dropCell-icon").is(":visible")&&$("#luckysheet-dropCell-icon").remove(),null!=i.freezenhorizontaldata&&null!=i.freezenverticaldata){let e=i.freezenhorizontaldata[1]-1,t=i.freezenverticaldata[1]-1,l=i.freezenhorizontaldata[2],a=i.freezenverticaldata[2],n=m.visibledatarow[e]-2-l+m.columnHeaderHeight,r=[m.visibledatarow[e],e+1,l,i.cutVolumn(m.visibledatarow,e+1),n],c=m.visibledatacolumn[t]-2-a+m.rowHeaderWidth,o=[m.visibledatacolumn[t],t+1,a,i.cutVolumn(m.visibledatacolumn,t+1),c];i.saveFreezen(r,n,o,c),i.createFreezenHorizontal(r,n),i.createFreezenVertical(o,c),i.createAssistCanvas()}else if(null!=i.freezenhorizontaldata){let e=i.freezenhorizontaldata[1]-1,t=i.freezenhorizontaldata[2],l=m.visibledatarow[e]-2-t+m.columnHeaderHeight,a=[m.visibledatarow[e],e+1,t,i.cutVolumn(m.visibledatarow,e+1),l];i.saveFreezen(a,l,null,null),i.createFreezenHorizontal(a,l),i.createAssistCanvas()}else if(null!=i.freezenverticaldata){let e=i.freezenverticaldata[1]-1,t=i.freezenverticaldata[2],l=m.visibledatacolumn[e]-2-t+m.rowHeaderWidth,a=[m.visibledatacolumn[e],e+1,t,i.cutVolumn(m.visibledatacolumn,e+1),l];i.saveFreezen(null,null,a,l),i.createFreezenVertical(a,l),i.createAssistCanvas()}else $("#luckysheet-filter-options-sheet"+m.currentSheetIndex+" .luckysheet-filter-options").length>0&&$("#luckysheet-filter-options-sheet"+m.currentSheetIndex+" .luckysheet-filter-options").each(function(e,t){let l=$(t).data("str"),a=$(t).data("cindex"),n=m.visibledatacolumn[a]-20,r=l-1==-1?0:m.visibledatarow[l-1];$(t).css({left:n,top:r})});if($("#luckysheet-filter-selected-sheet"+m.currentSheetIndex).length>0){let e=m.luckysheetfile[P(m.currentSheetIndex)].filter_select,t=e.row[0],l=e.row[1],a=e.column[0],n=e.column[1],r=m.visibledatarow[l],c=t-1==-1?0:m.visibledatarow[t-1],i=m.visibledatacolumn[n],o=a-1==-1?0:m.visibledatacolumn[a-1];$("#luckysheet-filter-selected-sheet"+m.currentSheetIndex).css({left:o,width:i-o-1,top:c,height:r-c-1})}u.showSheet(),n&&(V=setTimeout(function(){H()},1))}function H(e,l){if(t.groupValuesRefresh(),null==e&&(e=$("#luckysheet-cell-main").scrollLeft()),null==l&&(l=$("#luckysheet-cell-main").scrollTop()),null!=i.freezenverticaldata||null!=i.freezenhorizontaldata){let t,a,n,r,c,o,u=m.luckysheetTableContentHW[0],d=m.luckysheetTableContentHW[1];null!=i.freezenverticaldata&&null!=i.freezenhorizontaldata?(t=i.freezenhorizontaldata[0],a=i.freezenhorizontaldata[1],n=i.freezenhorizontaldata[2],r=i.freezenverticaldata[0],c=i.freezenverticaldata[1],o=i.freezenverticaldata[2],k(o,n,r,t,1,1,null,null,"freezen_3"),k(e+r-o,n,u-r+o,t,1,1,null,null,"freezen_4"),k(o,l+t-n,r,d-t+n,1,1,null,null,"freezen_7"),k(e+r-o,l+t-n,u-r+o,d-t+n,r-o+m.rowHeaderWidth,t-n+m.columnHeaderHeight),I(o,r,m.rowHeaderWidth),I(e+r-o,u-r+o,r-o+m.rowHeaderWidth),_(n,t,m.columnHeaderHeight),_(l+t-n,d-t+n,t-n+m.columnHeaderHeight)):null!=i.freezenhorizontaldata?(t=i.freezenhorizontaldata[0],a=i.freezenhorizontaldata[1],n=i.freezenhorizontaldata[2],k(e,n,u,t,1,1,null,null,"freezen_h"),k(e,l+t-n,u,d-t+n,null,t-n+m.columnHeaderHeight),I(e,u,null),_(n,t,m.columnHeaderHeight),_(l+t-n,d-t+n,t-n+m.columnHeaderHeight)):null!=i.freezenverticaldata&&(r=i.freezenverticaldata[0],c=i.freezenverticaldata[1],o=i.freezenverticaldata[2],k(o,l,r,d,1,1,null,null,"freezen_v"),k(e+r-o,l,u-r+o,d,r-o+m.rowHeaderWidth,null),_(l,d,null),I(o,r,m.rowHeaderWidth),I(e+r-o,u-r+o,r-o+m.rowHeaderWidth))}else{if(0==$("#luckysheetTableContent").length)return;let t=$("#luckysheetTableContent").get(0).getContext("2d");k(e,l),I(e),_(l),t.clearRect(0,0,m.rowHeaderWidth*m.devicePixelRatio-1,m.columnHeaderHeight*m.devicePixelRatio-1)}}return{jfrefreshgrid:function(e,a,n,r=!0,c=!0){null==e&&(e=m.flowdata),null==a&&(a=m.luckysheet_select_save),clearTimeout(V),null==n&&(n={});let i=n.cfg,u=n.RowlChange,d=n.cdformat,s=n.dataVerification,h=n.dynamicArray,g=m.luckysheetfile[P(m.currentSheetIndex)];if(m.clearjfundo){let t,l,n,r;m.jfundo.length=0,t=null==i?$.extend(!0,{},m.config):$.extend(!0,{},i),l=null==d?$.extend(!0,[],g.luckysheet_conditionformat_save):d,n=null==s?$.extend(!0,{},g.dataVerification):s,r=null==h?$.extend(!0,[],g.dynamicArray):h,m.jfredo.push({type:"datachange",data:m.flowdata,curdata:e,sheetIndex:m.currentSheetIndex,range:a,config:$.extend(!0,{},m.config),curConfig:t,cdformat:$.extend(!0,[],g.luckysheet_conditionformat_save),curCdformat:l,RowlChange:u,dataVerification:$.extend(!0,[],g.dataVerification),curDataVerification:n,dynamicArray:$.extend(!0,[],g.dynamicArray),curDynamicArray:r,dataRange:[...g.luckysheet_select_save]})}m.flowdata=e,l.webWorkerFlowDataCache(m.flowdata),g.data=m.flowdata,null!=i&&(m.config=i,g.config=m.config,o.saveParam("all",m.currentSheetIndex,i,{k:"config"}),null!=u&&D(m.flowdata.length,m.flowdata[0].length)),null!=d&&(g.luckysheet_conditionformat_save=d,o.saveParam("all",m.currentSheetIndex,d,{k:"luckysheet_conditionformat_save"})),null!=s&&(f.dataVerification=s,g.dataVerification=s,o.saveParam("all",m.currentSheetIndex,s,{k:"dataVerification"})),null!=h&&(g.dynamicArray=h,o.saveParam("all",m.currentSheetIndex,h,{k:"dynamicArray"}));for(let e=0;e<a.length;e++){let l=a[e].row[0],n=a[e].column[0];if(null!=m.flowdata[l][n]&&null!=m.flowdata[l][n].spl){window.luckysheetCurrentRow=l,window.luckysheetCurrentColumn=n,window.luckysheetCurrentFunction=m.flowdata[l][n].f;let e=$.trim(t.functionParserExe(m.flowdata[l][n].f)),a=new Function("return "+e)();m.flowdata[l][n].spl=a}o.allowUpdate&&o.historyParam(m.flowdata,m.currentSheetIndex,a[e]),"function"==typeof m.chartparam.jfrefreshchartall&&m.chartparam.jfrefreshchartall(m.flowdata,a[e].row[0],a[e].row[1],a[e].column[0],a[e].column[1])}r&&b(a,m.currentSheetIndex,e),c&&(V=setTimeout(function(){H()},1)),window.luckysheet_getcelldata_cache=null},jfrefreshgridall:function(e,t,a,n,r,c,i,d,f=!0){let s={},h=!1;if(clearTimeout(V),"cellRowChange"==c){s.type="cellRowChange",s.config=$.extend(!0,{},m.config),s.curconfig=$.extend(!0,{},n),s.range=$.extend(!0,[],m.luckysheet_select_save),s.currange=r,s.ctrlType=c,s.ctrlValue=i;let e=n.rowlen;null==e&&(e={}),o.saveParam("cg",m.currentSheetIndex,e,{k:"rowlen"})}else if("resizeC"==c){s.type="resize",s.config=$.extend(!0,{},m.config),s.curconfig=$.extend(!0,{},n),s.range=$.extend(!0,[],m.luckysheet_select_save),s.currange=r,s.ctrlType=c,s.ctrlValue=i;let e=n.columnlen;null==e&&(e={}),o.saveParam("cg",m.currentSheetIndex,e,{k:"columnlen"})}else if(c.indexOf("extend")>-1)s.type="extend",s.config=$.extend(!0,{},m.config),s.curconfig=$.extend(!0,{},n),s.range=$.extend(!0,[],m.luckysheet_select_save),s.currange=r,s.ctrlType=c,s.ctrlValue=i,o.saveParam("arc",m.currentSheetIndex,{index:i.index,len:i.len,direction:i.direction,mc:n.merge},{rc:i.type});else if(c.indexOf("dele")>-1)s.type="dele",s.config=$.extend(!0,{},m.config),s.curconfig=$.extend(!0,{},n),s.range=$.extend(!0,[],m.luckysheet_select_save),s.currange=r,s.ctrlType=c,s.ctrlValue=i,o.saveParam("drc",m.currentSheetIndex,{index:i.index,len:i.len,mc:n.merge,borderInfo:n.borderInfo},{rc:i.type});else{s.type="datachangeAll",s.range=$.extend(!0,[],m.luckysheet_select_save),s.currange=r,s.ctrlType=c,s.ctrlValue=i,h=!0;for(let e=0;e<r.length;e++)o.historyParam(a,m.currentSheetIndex,r[e])}m.clearjfundo&&(m.jfundo.length=0,s.data=m.flowdata,s.curdata=a,s.sheetIndex=m.currentSheetIndex,s.cdformat=$.extend(!0,[],m.luckysheetfile[P(m.currentSheetIndex)].luckysheet_conditionformat_save),s.curCdformat=d,m.jfredo.push(s)),m.flowdata=a,l.webWorkerFlowDataCache(a),m.luckysheetfile[P(m.currentSheetIndex)].data=m.flowdata,null!=n&&(m.config=n,m.luckysheetfile[P(m.currentSheetIndex)].config=m.config,o.saveParam("all",m.currentSheetIndex,n,{k:"config"})),null!=d&&(m.luckysheetfile[P(m.currentSheetIndex)].luckysheet_conditionformat_save=d,o.saveParam("all",m.currentSheetIndex,d,{k:"luckysheet_conditionformat_save"})),m.luckysheet_select_save=$.extend(!0,[],r),m.luckysheet_select_save.length>0&&p(),h&&b(r,m.currentSheetIndex,a),D(t,e),f&&(V=setTimeout(function(){H()},1)),u.storeSheetParamALL(),window.luckysheet_getcelldata_cache=null},jfrefreshrange:function(e,t,a){clearTimeout(V),m.clearjfundo&&(m.jfundo.length=0,m.jfredo.push({type:"rangechange",data:m.flowdata,curdata:e,range:t,sheetIndex:m.currentSheetIndex,cdformat:$.extend(!0,[],m.luckysheetfile[P(m.currentSheetIndex)].luckysheet_conditionformat_save),curCdformat:a})),m.flowdata=e,l.webWorkerFlowDataCache(m.flowdata),m.luckysheetfile[P(m.currentSheetIndex)].data=m.flowdata,null!=a&&(m.luckysheetfile[P(m.currentSheetIndex)].luckysheet_conditionformat_save=a),b(t,m.currentSheetIndex,e),V=setTimeout(function(){H()},1);for(let e=0;e<t.length;e++)o.historyParam(m.flowdata,m.currentSheetIndex,t[e])},jfrefreshgrid_adRC:function(e,a,n,r,c,u,d,h,g,x,v){let k=m.luckysheetfile[P(m.currentSheetIndex)];z();let _=[];for(let t in a.merge){let l=a.merge[t];for(let t=l.r;t<=l.r+l.rs-1;t++)for(let a=l.c;a<=l.c+l.cs-1;a++)null==e[t][a]&&(e[t][a]={}),t==l.r&&a==l.c?e[t][a].mc=l:e[t][a].mc={r:l.r,c:l.c},_.push({r:t,c:a})}let I=[];m.clearjfundo&&(m.jfundo.length=0,m.jfredo.push({type:n,sheetIndex:m.currentSheetIndex,data:m.flowdata,curData:e,config:$.extend(!0,{},m.config),curConfig:a,ctrlValue:r,mcData:_,calc:$.extend(!0,[],k.calcChain),curCalc:c,funcData:I,filterObj:{filter_select:$.extend(!0,{},k.filter_select),filter:$.extend(!0,{},k.filter)},curFilterObj:u,cf:$.extend(!0,[],k.luckysheet_conditionformat_save),curCf:d,af:$.extend(!0,[],k.luckysheet_alternateformat_save),curAf:h,freezen:{freezenhorizontaldata:i.freezenhorizontaldata,freezenverticaldata:i.freezenverticaldata},curFreezen:g,dataVerification:$.extend(!0,{},k.dataVerification),curDataVerification:x,hyperlink:$.extend(!0,{},k.hyperlink),curHyperlink:v,dataRange:[...k.luckysheet_select_save]}));let p=r.index,S=r.len,V=r.rc;if("addRC"==n){let t=r.direction,l=[];if(r.restore)if("r"==V){let a;"lefttop"==t?a=p:"rightbottom"==t&&(a=p+1);let n=a+S-1;for(let t=a;t<=n;t++){let a=[];for(let l=0;l<e[0].length;l++){let n=e[t][l];a.push(n)}l.push(a)}}else if("c"==V){let a;"lefttop"==t?a=p:"rightbottom"==t&&(a=p+1);let n=a+S-1;for(let t=0;t<e.length;t++){let r=[];for(let l=a;l<=n;l++){let a=e[t][l];r.push(a)}l.push(r)}}o.saveParam("arc",m.currentSheetIndex,{index:p,len:S,direction:t,data:l},{rc:V})}else"delRC"==n&&o.saveParam("drc",m.currentSheetIndex,{index:p,len:S},{rc:V});m.flowdata=e,l.webWorkerFlowDataCache(m.flowdata),k.data=e,m.config=a,k.config=m.config,o.saveParam("all",m.currentSheetIndex,a,{k:"config"});for(let e=0;e<_.length;e++){let t=_[e].r,l=_[e].c;o.saveParam("v",m.currentSheetIndex,m.flowdata[t][l],{r:t,c:l})}if(c.length>0)for(let l=0;l<c.length;l++){let a=c[l],n=a.r,r=a.c,i=a.index,o=y(n,r,i,e),u=t.execfunction(o,n,r,i,null,!0);a.func=u,e[n][r].f==o&&w(n,r,e,u[1])}k.calcChain=c,o.saveParam("all",m.currentSheetIndex,c,{k:"calcChain"});for(let e=0;e<I.length;e++){let t=I[e].r,l=I[e].c;o.saveParam("v",m.currentSheetIndex,m.flowdata[t][l],{r:t,c:l})}null!=u?(k.filter_select=u.filter_select,k.filter=u.filter):(k.filter_select=null,k.filter=null),C(k.filter_select,k.filter),o.saveParam("all",m.currentSheetIndex,k.filter_select,{k:"filter_select"}),o.saveParam("all",m.currentSheetIndex,k.filter,{k:"filter"}),k.luckysheet_conditionformat_save=d,o.saveParam("all",m.currentSheetIndex,k.luckysheet_conditionformat_save,{k:"luckysheet_conditionformat_save"}),k.luckysheet_alternateformat_save=h,o.saveParam("all",m.currentSheetIndex,k.luckysheet_alternateformat_save,{k:"luckysheet_alternateformat_save"}),null!=g?(i.freezenhorizontaldata=g.freezenhorizontaldata,i.freezenverticaldata=g.freezenverticaldata):(i.freezenhorizontaldata=null,i.freezenverticaldata=null),f.dataVerification=x,k.dataVerification=x,o.saveParam("all",m.currentSheetIndex,k.dataVerification,{k:"dataVerification"}),s.hyperlink=v,k.hyperlink=v,o.saveParam("all",m.currentSheetIndex,k.hyperlink,{k:"hyperlink"}),D(m.flowdata.length,m.flowdata[0].length)},jfrefreshgrid_deleteCell:function(e,a,n,r,c,i,u,d){let h=m.luckysheetfile[P(m.currentSheetIndex)];clearTimeout(V),z();let g=[];if("{}"==JSON.stringify(a.merge))for(let t=0;t<e.length;t++)for(let l=0;l<e[0].length;l++){let a=e[t][l];null!=a&&null!=a.mc&&(delete a.mc,g.push({r:t,c:l}))}else for(let t in a.merge){let l=a.merge[t];for(let t=l.r;t<=l.r+l.rs-1;t++)for(let a=l.c;a<=l.c+l.cs-1;a++)null==e[t][a]&&(e[t][a]={}),t==l.r&&a==l.c?e[t][a].mc=l:e[t][a].mc={r:l.r,c:l.c},g.push({r:t,c:a})}let x=[];if(m.clearjfundo&&(m.jfundo.length=0,m.jfredo.push({type:"deleteCell",sheetIndex:m.currentSheetIndex,ctrl:n,data:m.flowdata,curData:e,config:$.extend(!0,{},m.config),curConfig:a,mcData:g,calc:$.extend(!0,[],h.calcChain),curCalc:r,funcData:x,filterObj:{filter_select:$.extend(!0,{},h.filter_select),filter:$.extend(!0,{},h.filter)},curFilterObj:c,cf:$.extend(!0,[],h.luckysheet_conditionformat_save),curCf:i,dataVerification:$.extend(!0,{},h.dataVerification),curDataVerification:u,hyperlink:$.extend(!0,{},h.hyperlink),curHyperlink:d,dataRange:[...h.luckysheet_select_save]})),m.flowdata=e,l.webWorkerFlowDataCache(m.flowdata),h.data=e,o.allowUpdate){let t,l=n.type,a=n.str,r=n.edr,c=n.stc,i=n.edc;"moveUp"==l?t={row:[a,e.length-1],column:[c,i]}:"moveLeft"==l&&(t={row:[a,r],column:[c,e[0].length-1]}),o.historyParam(m.flowdata,m.currentSheetIndex,t)}m.config=a,h.config=m.config,o.saveParam("all",m.currentSheetIndex,a,{k:"config"});for(let e=0;e<g.length;e++){let t=g[e].r,l=g[e].c;o.saveParam("v",m.currentSheetIndex,m.flowdata[t][l],{r:t,c:l})}if(r.length>0)for(let l=0;l<r.length;l++){let a=r[l],n=a.r,c=a.c,i=a.index,o=y(n,c,i,e),u=t.execfunction(o,n,c,i,null,!0);a.func=u,e[n][c].f==o&&w(n,c,e,u[1])}h.calcChain=r,o.saveParam("all",m.currentSheetIndex,r,{k:"calcChain"});for(let e=0;e<x.length;e++){let t=x[e].r,l=x[e].c;o.saveParam("v",m.currentSheetIndex,m.flowdata[t][l],{r:t,c:l})}null!=c?(h.filter_select=c.filter_select,h.filter=c.filter):(h.filter_select=null,h.filter=null),C(h.filter_select,h.filter),o.saveParam("all",m.currentSheetIndex,h.filter_select,{k:"filter_select"}),o.saveParam("all",m.currentSheetIndex,h.filter,{k:"filter"}),h.luckysheet_conditionformat_save=i,o.saveParam("all",m.currentSheetIndex,h.luckysheet_conditionformat_save,{k:"luckysheet_conditionformat_save"}),f.dataVerification=u,h.dataVerification=u,o.saveParam("all",m.currentSheetIndex,h.dataVerification,{k:"dataVerification"}),s.hyperlink=d,h.hyperlink=d,o.saveParam("all",m.currentSheetIndex,h.hyperlink,{k:"hyperlink"}),V=setTimeout(function(){H()},1)},jfrefreshgrid_pastcut:function(e,a,n){let r,c={};t.execFunctionExist=[],clearTimeout(V);for(let l=e.range.row[0];l<=e.range.row[1];l++)for(let a=e.range.column[0];a<=e.range.column[1];a++)l+"_"+a+"_"+e.sheetIndex in c||(c[l+"_"+a+"_"+e.sheetIndex]=0,t.execFunctionExist.push({r:l,c:a,i:e.sheetIndex}));for(let e=a.range.row[0];e<=a.range.row[1];e++)for(let l=a.range.column[0];l<=a.range.column[1];l++)e+"_"+l+"_"+a.sheetIndex in c||(c[e+"_"+l+"_"+a.sheetIndex]=0,t.execFunctionExist.push({r:e,c:l,i:a.sheetIndex}));if(m.clearjfundo&&(m.jfundo.length=0,m.jfredo.push({type:"pasteCut",source:e,target:a,RowlChange:n})),m.currentSheetIndex==e.sheetIndex?(m.config=e.curConfig,r=e.curData.length,m.luckysheetfile[P(a.sheetIndex)].config=a.curConfig):m.currentSheetIndex==a.sheetIndex&&(m.config=a.curConfig,r=a.curData.length,m.luckysheetfile[P(e.sheetIndex)].config=e.curConfig),n){m.visibledatarow=[],m.rh_height=0;for(let e=0;e<r;e++){let t=m.defaultrowlen;null!=m.config.rowlen&&null!=m.config.rowlen[e]&&(t=m.config.rowlen[e]),null==m.config.rowhidden||null==m.config.rowhidden[e]?(m.rh_height+=t+1,m.visibledatarow.push(m.rh_height)):(t=m.config.rowhidden[e],m.visibledatarow.push(m.rh_height))}if(m.rh_height+=110,m.currentSheetIndex==e.sheetIndex){let e=v(a.curData.length,a.curConfig);m.luckysheetfile[P(a.sheetIndex)].visibledatarow=e}else if(m.currentSheetIndex==a.sheetIndex){let t=v(e.curData.length,e.curConfig);m.luckysheetfile[P(e.sheetIndex)].visibledatarow=t}}m.currentSheetIndex==e.sheetIndex?(m.flowdata=e.curData,m.luckysheetfile[P(a.sheetIndex)].data=a.curData):m.currentSheetIndex==a.sheetIndex&&(m.flowdata=a.curData,m.luckysheetfile[P(e.sheetIndex)].data=e.curData),l.webWorkerFlowDataCache(m.flowdata),m.luckysheetfile[P(m.currentSheetIndex)].data=m.flowdata,m.currentSheetIndex==a.sheetIndex?m.luckysheet_select_save=[{row:a.range.row,column:a.range.column}]:m.luckysheet_select_save=[{row:e.range.row,column:e.range.column}],m.luckysheet_select_save.length>0&&p(),m.luckysheetfile[P(e.sheetIndex)].luckysheet_conditionformat_save=e.curCdformat,m.luckysheetfile[P(a.sheetIndex)].luckysheet_conditionformat_save=a.curCdformat,m.currentSheetIndex==e.sheetIndex?f.dataVerification=e.curDataVerification:m.currentSheetIndex==a.sheetIndex&&(f.dataVerification=a.curDataVerification),m.luckysheetfile[P(e.sheetIndex)].dataVerification=e.curDataVerification,m.luckysheetfile[P(a.sheetIndex)].dataVerification=a.curDataVerification,t.execFunctionExist.reverse(),t.execFunctionGroup(null,null,null,null,a.curData),t.execFunctionGlobalData=null,V=setTimeout(function(){H()},1),u.storeSheetParamALL(),o.saveParam("all",e.sheetIndex,e.curConfig,{k:"config"}),o.saveParam("all",a.sheetIndex,a.curConfig,{k:"config"}),o.historyParam(e.curData,e.sheetIndex,{row:e.range.row,column:e.range.column}),o.historyParam(a.curData,a.sheetIndex,{row:a.range.row,column:a.range.column}),o.saveParam("all",e.sheetIndex,e.curCdformat,{k:"luckysheet_conditionformat_save"}),o.saveParam("all",a.sheetIndex,a.curCdformat,{k:"luckysheet_conditionformat_save"}),o.saveParam("all",e.sheetIndex,e.curDataVerification,{k:"dataVerification"}),o.saveParam("all",a.sheetIndex,a.curDataVerification,{k:"dataVerification"})},jfrefreshgrid_rhcw:D,luckysheetrefreshgrid:H}});
//# sourceMappingURL=../sourcemaps/global/refresh.js.map
