/**
 * skylark-lucksheet - A version of lucksheet.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["./editor","./formula","./refresh","./getdata","./setdata","../controllers/conditionformat","../controllers/freezen","../controllers/select","../controllers/sheetSearch","../controllers/protection","../methods/get","../store"],function(e,l,t,r,o,n,c,i,f,u,s,d){"use strict";const{jfrefreshgrid_adRC:a,jfrefreshgrid_deleteCell:h,jfrefreshgrid_rhcw:m}=t,{datagridgrowth:w,getcellFormula:g}=r,{setcellvalue:p}=o,{selectHightlightShow:_}=i,{luckysheet_searcharray:b}=f,{checkProtectionAuthorityNormal:y,checkProtectionNotEnable:I}=u,{getSheetIndex:v}=s;function x(e,l,t,r,o,n,c,i,f,u,s){let d=[];if("moveLeft"==e){if(l>c||t<n||r>f)d.push({row:[n,c],column:[i,f]});else if(o<i){if(l<=n&&t>=c)d.push({row:[n,c],column:[i-s,f-s]});else if(l>n&&t<c){let e=[{row:[n,l-1],column:[i,f]},{row:[t+1,c],column:[i,f]},{row:[l,t],column:[i-s,f-s]}];d=d.concat(e)}else if(l>n){let e=[{row:[n,l-1],column:[i,f]},{row:[l,c],column:[i-s,f-s]}];d=d.concat(e)}else if(t<c){let e=[{row:[n,t],column:[i-s,f-s]},{row:[t+1,c],column:[i,f]}];d=d.concat(e)}}else if(o>=i)if(r<=i&&o>=f){if(l>n&&t<c){let e=[{row:[n,l-1],column:[i,f]},{row:[t+1,c],column:[i,f]}];d=d.concat(e)}else if(l>n){let e=[{row:[n,l-1],column:[i,f]}];d=d.concat(e)}else if(t<c){let e=[{row:[t+1,c],column:[i,f]}];d=d.concat(e)}}else if(r>i&&o<f){if(l<=n&&t>=c)d.push({row:[n,c],column:[i,f-s]});else if(l>n&&t<c){let e=[{row:[n,l-1],column:[i,f]},{row:[t+1,c],column:[i,f]},{row:[l,t],column:[i,f-s]}];d=d.concat(e)}else if(l>n){let e=[{row:[n,l-1],column:[i,f]},{row:[l,c],column:[i,f-s]}];d=d.concat(e)}else if(t<c){let e=[{row:[n,t],column:[i,f-s]},{row:[t+1,c],column:[i,f]}];d=d.concat(e)}}else if(r>i){if(l<=n&&t>=c)d.push({row:[n,c],column:[i,r-1]});else if(l>n&&t<c){let e=[{row:[n,l-1],column:[i,f]},{row:[t+1,c],column:[i,f]},{row:[l,t],column:[i,r-1]}];d=d.concat(e)}else if(l>n){let e=[{row:[n,l-1],column:[i,f]},{row:[l,c],column:[i,r-1]}];d=d.concat(e)}else if(t<c){let e=[{row:[n,t],column:[i,r-1]},{row:[t+1,c],column:[i,f]}];d=d.concat(e)}}else if(o<f)if(l<=n&&t>=c)d.push({row:[n,c],column:[i-s,f-s]});else if(l>n&&t<c){let e=[{row:[n,l-1],column:[i,f]},{row:[t+1,c],column:[i,f]},{row:[l,t],column:[i-s,f-s]}];d=d.concat(e)}else if(l>n){let e=[{row:[n,l-1],column:[i,f]},{row:[l,c],column:[i-s,f-s]}];d=d.concat(e)}else if(t<c){let e=[{row:[n,t],column:[i-s,f-s]},{row:[t+1,c],column:[i,f]}];d=d.concat(e)}}else if("moveUp"==e)if(r>f||o<i||l>c)d.push({row:[n,c],column:[i,f]});else if(t<n){if(r<=i&&o>=f)d.push({row:[n-u,c-u],column:[i,f]});else if(r>i&&o<f){let e=[{row:[n,c],column:[i,r-1]},{row:[n,c],column:[o+1,f]},{row:[n-u,c-u],column:[r,o]}];d=d.concat(e)}else if(r>i){let e=[{row:[n,c],column:[i,r-1]},{row:[n-u,c-u],column:[r,f]}];d=d.concat(e)}else if(o<f){let e=[{row:[n-u,c-u],column:[i,o]},{row:[n,c],column:[o+1,f]}];d=d.concat(e)}}else if(t>=n)if(l<=n&&t>=c){if(r>i&&o<f){let e=[{row:[n,c],column:[i,r-1]},{row:[n,c],column:[o+1,f]}];d=d.concat(e)}else if(r>i){let e=[{row:[n,c],column:[i,r-1]}];d=d.concat(e)}else if(o<f){let e=[{row:[n,c],column:[o+1,f]}];d=d.concat(e)}}else if(l>n&&t<c){if(r<=i&&o>=f)d.push({row:[n,c-u],column:[i,f]});else if(r>i&&o<f){let e=[{row:[n,c],column:[i,r-1]},{row:[n,c],column:[o+1,f]},{row:[n,c-u],column:[r,o]}];d=d.concat(e)}else if(r>i){let e=[{row:[n,c],column:[i,r-1]},{row:[n,c-u],column:[r,f]}];d=d.concat(e)}else if(o<f){let e=[{row:[n,c-u],column:[i,o]},{row:[n,c],column:[o+1,f]}];d=d.concat(e)}}else if(l>n){if(r<=i&&o>=f)d.push({row:[n,l-1],column:[i,f]});else if(r>i&&o<f){let e=[{row:[n,c],column:[i,r-1]},{row:[n,c],column:[o+1,f]},{row:[n,l-1],column:[r,o]}];d=d.concat(e)}else if(r>i){let e=[{row:[n,c],column:[i,r-1]},{row:[n,l-1],column:[r,f]}];d=d.concat(e)}else if(o<f){let e=[{row:[n,l-1],column:[i,o]},{row:[n,c],column:[o+1,f]}];d=d.concat(e)}}else if(t<c)if(r<=i&&o>=f)d.push({row:[n-u,c-u],column:[i,f]});else if(r>i&&o<f){let e=[{row:[n,c],column:[i,r-1]},{row:[n,c],column:[o+1,f]},{row:[n-u,c-u],column:[r,o]}];d=d.concat(e)}else if(r>i){let e=[{row:[n,c],column:[i,r-1]},{row:[n-u,c-u],column:[r,f]}];d=d.concat(e)}else if(o<f){let e=[{row:[n-u,c-u],column:[i,o]},{row:[n,c],column:[o+1,f]}];d=d.concat(e)}return d}return{luckysheetextendtable:function(e,t,r,o,n){if(n=n||d.currentSheetIndex,"row"==e&&!y(n,"insertRows"))return;if("column"==e&&!y(n,"insertColumns"))return;let i=v(n),f=d.luckysheetfile[i],u=$.extend(!0,[],f.data);r=Math.floor(r);let s=$.extend(!0,{},f.config);null==s.merge&&(s.merge={});let h={};for(let l in s.merge){let n=s.merge[l],c=n.r,i=n.c,f=n.rs,u=n.cs;"row"==e?t<c?h[c+r+"_"+i]={r:c+r,c:i,rs:f,cs:u}:t==c?"lefttop"==o?h[c+r+"_"+i]={r:c+r,c:i,rs:f,cs:u}:h[c+"_"+i]={r:c,c:i,rs:f+r,cs:u}:h[c+"_"+i]=t<c+f-1?{r:c,c:i,rs:f+r,cs:u}:t==c+f-1&&"lefttop"==o?{r:c,c:i,rs:f+r,cs:u}:{r:c,c:i,rs:f,cs:u}:"column"==e&&(t<i?h[c+"_"+(i+r)]={r:c,c:i+r,rs:f,cs:u}:t==i?"lefttop"==o?h[c+"_"+(i+r)]={r:c,c:i+r,rs:f,cs:u}:h[c+"_"+i]={r:c,c:i,rs:f,cs:u+r}:h[c+"_"+i]=t<i+u-1?{r:c,c:i,rs:f,cs:u+r}:t==i+u-1&&"lefttop"==o?{r:c,c:i,rs:f,cs:u+r}:{r:c,c:i,rs:f,cs:u})}s.merge=h;let m=f.calcChain,w=[];if(null!=m&&m.length>0)for(let n=0;n<m.length;n++){let c=$.extend(!0,{},m[n]),i=c.r,f=c.c,s=c.index,d=g(i,f,s);if("row"==e){let e="="+l.functionStrChange(d,"add","row",o,t,r);u[i][f]&&u[i][f].f==d&&(u[i][f].f=e),"lefttop"==o?i>=t&&(c.r+=r):"rightbottom"==o&&i>t&&(c.r+=r),w.push(c)}else if("column"==e){let e="="+l.functionStrChange(d,"add","col",o,t,r);u[i][f]&&u[i][f].f==d&&(u[i][f].f=e),"lefttop"==o?f>=t&&(c.c+=r):"rightbottom"==o&&f>t&&(c.c+=r),w.push(c)}}let p=f.filter_select,b=f.filter,I=null;if(null!=p&&"{}"!=JSON.stringify(p)){I={filter_select:null,filter:null};let l=p.row[0],n=p.row[1],c=p.column[0],i=p.column[1];if("row"==e){if(l<t?n==t&&"lefttop"==o?n+=r:n>t&&(n+=r):l==t?"lefttop"==o?(l+=r,n+=r):"rightbottom"==o&&n>t&&(n+=r):(l+=r,n+=r),null!=b){I.filter={};for(let e in b){let c=b[e].rowhidden,i={};for(let e in c)(e=parseFloat(e))<t?i[e]=0:e==t?"lefttop"==o?i[e+r]=0:"rightbottom"==o&&(i[e]=0):i[e+r]=0;I.filter[e]=$.extend(!0,{},b[e]),I.filter[e].rowhidden=i,I.filter[e].str=l,I.filter[e].edr=n}}}else if("column"==e&&(c<t?i==t&&"lefttop"==o?i+=r:i>t&&(i+=r):c==t?"lefttop"==o?(c+=r,i+=r):"rightbottom"==o&&i>t&&(i+=r):(c+=r,i+=r),null!=b)){I.filter={};for(let e in b){let l=b[e].cindex;l==t&&"lefttop"==o?l+=r:l>t&&(l+=r),I.filter[l-c]=$.extend(!0,{},b[e]),I.filter[l-c].cindex=l,I.filter[l-c].stc=c,I.filter[l-c].edc=i}}I.filter_select={row:[l,n],column:[c,i]}}if(null!=I&&null!=I.filter){null==s.rowhidden&&(s.rowhidden={});for(let e in I.filter){let l=I.filter[e].rowhidden;for(let e in l)s.rowhidden[e]=0}}let x=f.luckysheet_conditionformat_save,z=[];if(null!=x&&x.length>0)for(let l=0;l<x.length;l++){let n=x[l].cellrange,c=[];for(let l=0;l<n.length;l++){let i=n[l].row[0],f=n[l].row[1],u=n[l].column[0],s=n[l].column[1];"row"==e?i<t?f==t&&"lefttop"==o?f+=r:f>t&&(f+=r):i==t?"lefttop"==o?(i+=r,f+=r):"rightbottom"==o&&f>t&&(f+=r):(i+=r,f+=r):"column"==e&&(u<t?s==t&&"lefttop"==o?s+=r:s>t&&(s+=r):u==t?"lefttop"==o?(u+=r,s+=r):"rightbottom"==o&&s>t&&(s+=r):(u+=r,s+=r)),c.push({row:[i,f],column:[u,s]})}let i=$.extend(!0,{},x[l]);i.cellrange=c,z.push(i)}let k=f.luckysheet_alternateformat_save,S=[];if(null!=k&&k.length>0)for(let l=0;l<k.length;l++){let n=k[l].cellrange.row[0],c=k[l].cellrange.row[1],i=k[l].cellrange.column[0],f=k[l].cellrange.column[1],u=$.extend(!0,{},k[l]);"row"==e?n<t?c==t&&"lefttop"==o?c+=r:c>t&&(c+=r):n==t?"lefttop"==o?(n+=r,c+=r):"rightbottom"==o&&c>t&&(c+=r):(n+=r,c+=r):"column"==e&&(i<t?f==t&&"lefttop"==o?f+=r:f>t&&(f+=r):i==t?"lefttop"==o?(i+=r,f+=r):"rightbottom"==o&&f>t&&(f+=r):(i+=r,f+=r)),u.cellrange={row:[n,c],column:[i,f]},S.push(u)}let T={freezenhorizontaldata:null,freezenverticaldata:null};if(null!=c.freezenhorizontaldata&&"row"==e){let e=c.freezenhorizontaldata[2],l=c.freezenhorizontaldata[1]-1;l==t&&"lefttop"==o?l+=r:l>t&&(l+=r);let n=d.visibledatarow[l]-2-e+d.columnHeaderHeight;T.freezenhorizontaldata=[d.visibledatarow[l],l+1,e,c.cutVolumn(d.visibledatarow,l+1),n]}else T.freezenhorizontaldata=c.freezenhorizontaldata;if(null!=c.freezenverticaldata&&"column"==e){let e=c.freezenverticaldata[2],l=c.freezenverticaldata[1]-1;l==t&&"lefttop"==o?l+=r:l>t&&(l+=r);let n=d.visibledatacolumn[l]-2-e+d.rowHeaderWidth;T.freezenverticaldata=[d.visibledatacolumn[l],l+1,e,c.cutVolumn(d.visibledatacolumn,l+1),n]}else T.freezenverticaldata=c.freezenverticaldata;let C=f.dataVerification,N={};if(null!=C)for(let l in C){let n=Number(l.split("_")[0]),c=Number(l.split("_")[1]),i=C[l];if("row"==e)if(t<n)N[n+r+"_"+c]=i;else if(t==n)if("lefttop"==o){N[n+r+"_"+c]=i;for(let e=0;e<r;e++)N[n+e+"_"+c]=i}else{N[n+"_"+c]=i;for(let e=0;e<r;e++)N[n+e+1+"_"+c]=i}else N[n+"_"+c]=i;else if("column"==e)if(t<c)N[n+"_"+(c+r)]=i;else if(t==c)if("lefttop"==o){N[n+"_"+(c+r)]=i;for(let e=0;e<r;e++)N[n+"_"+(c+e)]=i}else{N[n+"_"+c]=i;for(let e=0;e<r;e++)N[n+"_"+(c+e+1)]=i}else N[n+"_"+c]=i}let F,V=f.hyperlink,L={};if(null!=V)for(let l in V){let n=Number(l.split("_")[0]),c=Number(l.split("_")[1]),i=V[l];"row"==e?t<n?L[n+r+"_"+c]=i:t==n&&"lefttop"==o?L[n+r+"_"+c]=i:L[n+"_"+c]=i:"column"==e&&(t<c?L[n+"_"+(c+r)]=i:t==c&&"lefttop"==o?L[n+"_"+(c+r)]=i:L[n+"_"+c]=i)}if("row"==e){if(F="r",null!=s.rowlen){let e={};for(let l in s.rowlen)(l=parseFloat(l))<t?e[l]=s.rowlen[l]:l==t?"lefttop"==o?e[l+r]=s.rowlen[l]:"rightbottom"==o&&(e[l]=s.rowlen[l]):e[l+r]=s.rowlen[l];s.rowlen=e}if(null!=s.rowhidden){let e={};for(let l in s.rowhidden)(l=parseFloat(l))<t?e[l]=s.rowhidden[l]:l==t?"lefttop"==o?e[l+r]=s.rowhidden[l]:"rightbottom"==o&&(e[l]=s.rowhidden[l]):e[l+r]=s.rowhidden[l];s.rowhidden=e}let e=[];for(let l=0;l<u[0].length;l++)e.push(null);if(s.borderInfo&&s.borderInfo.length>0){let e=[];for(let l=0;l<s.borderInfo.length;l++){let n=s.borderInfo[l].rangeType;if("range"==n){let n=s.borderInfo[l].range,c=[];for(let e=0;e<n.length;e++){let l=n[e].row[0],i=n[e].row[1];"lefttop"==o?t<=l?(l+=r,i+=r):t<=i&&(i+=r):t<l?(l+=r,i+=r):t<i&&(i+=r),i>=l&&c.push({row:[l,i],column:n[e].column})}if(c.length>0){let t={rangeType:"range",borderType:s.borderInfo[l].borderType,style:s.borderInfo[l].style,color:s.borderInfo[l].color,range:c};e.push(t)}}else if("cell"==n){let n=s.borderInfo[l].value.row_index;"lefttop"==o?t<=n&&(n+=r):t<n&&(n+=r),s.borderInfo[l].value.row_index=n,e.push(s.borderInfo[l])}}s.borderInfo=e}let l=[];for(let t=0;t<r;t++)l.push(JSON.stringify(e));"lefttop"==o?0==t?new Function("d","return d.unshift("+l.join(",")+")")(u):new Function("d","return d.splice("+t+", 0, "+l.join(",")+")")(u):new Function("d","return d.splice("+(t+1)+", 0, "+l.join(",")+")")(u)}else{if(F="c",null!=s.columnlen){let e={};for(let l in s.columnlen)(l=parseFloat(l))<t?e[l]=s.columnlen[l]:l==t?"lefttop"==o?e[l+r]=s.columnlen[l]:"rightbottom"==o&&(e[l]=s.columnlen[l]):e[l+r]=s.columnlen[l];s.columnlen=e}if(null!=s.colhidden){let e={};for(let l in s.colhidden)(l=parseFloat(l))<t?e[l]=s.colhidden[l]:l==t?"lefttop"==o?e[l+r]=s.colhidden[l]:"rightbottom"==o&&(e[l]=s.colhidden[l]):e[l+r]=s.colhidden[l];s.colhidden=e}let e=[];for(let l=0;l<u.length;l++)e.push(null);if(s.borderInfo&&s.borderInfo.length>0){let e=[];for(let l=0;l<s.borderInfo.length;l++){let n=s.borderInfo[l].rangeType;if("range"==n){let n=s.borderInfo[l].range,c=[];for(let e=0;e<n.length;e++){let l=n[e].column[0],i=n[e].column[1];"lefttop"==o?t<=l?(l+=r,i+=r):t<=i&&(i+=r):t<l?(l+=r,i+=r):t<i&&(i+=r),i>=l&&c.push({row:n[e].row,column:[l,i]})}if(c.length>0){let t={rangeType:"range",borderType:s.borderInfo[l].borderType,style:s.borderInfo[l].style,color:s.borderInfo[l].color,range:c};e.push(t)}}else if("cell"==n){let n=s.borderInfo[l].value.col_index;"lefttop"==o?t<=n&&(n+=r):t<n&&(n+=r),s.borderInfo[l].value.col_index=n,e.push(s.borderInfo[l])}}s.borderInfo=e}for(let l=0;l<u.length;l++){let n=u[l];for(let c=0;c<r;c++)"lefttop"==o?0==t?n.unshift(e[l]):n.splice(t,0,e[l]):n.splice(t+1,0,e[l])}}f.index==d.currentSheetIndex?a(u,s,"addRC",{index:t,len:r,direction:o,rc:F,restore:!1},w,I,z,S,T,N,L):(f.data=u,f.config=s,f.calcChain=w,f.filter=I.filter,f.filter_select=I.filter_select,f.luckysheet_conditionformat_save=z,f.luckysheet_alternateformat_save=S,f.dataVerification=N,f.hyperlink=L);let U=null;if(U="row"==e?"lefttop"==o?[{row:[t,t+r-1],column:[0,u[0].length-1]}]:[{row:[t+1,t+r],column:[0,u[0].length-1]}]:"lefttop"==o?[{row:[0,u.length-1],column:[t,t+r-1]}]:[{row:[0,u.length-1],column:[t+1,t+r]}],f.luckysheet_select_save=U,f.index==d.currentSheetIndex&&(d.luckysheet_select_save=U,_()),"row"==e){$("#luckysheet-cell-main").scrollLeft();let e=$("#luckysheet-cell-main").scrollTop(),l=$("#luckysheet-cell-main").height(),t=($("#luckysheet-cell-main").width(),d.visibledatarow[U[0].row[1]]),o=U[0].row[0]-1==-1?0:d.visibledatarow[U[0].row[0]-1];t-e-l+20>0?$("#luckysheet-scrollbar-y").scrollTop(t-l+20):o-e-20<0&&$("#luckysheet-scrollbar-y").scrollTop(o-20),r>30&&($("#luckysheet-row-count-show").hide(),$("#luckysheet-column-count-show").hide())}},luckysheetextendData:function(l,t){let r=e.deepCopyFlowData(d.flowdata),o=$.extend(!0,{},d.config);null==o.merge&&(o.merge={});let n=r[0].length,c=w([],l,n);r=r.concat(c);for(let e=0;e<t.length;e++){let l=t[e].r,n=t[e].c,c=t[e].v;p(l,n,r,c),null!=c&&null!=c.mc&&null!=c.mc.rs&&(o.merge[c.mc.r+"_"+c.mc.c]=$.extend(!0,{},c.mc))}d.flowdata=r,e.webWorkerFlowDataCache(d.flowdata),d.luckysheetfile[v(d.currentSheetIndex)].data=r,d.config=o,d.luckysheetfile[v(d.currentSheetIndex)].config=d.config,m(d.flowdata.length,d.flowdata[0].length)},luckysheetdeletetable:function(e,t,r,o){if(o=o||d.currentSheetIndex,"row"==e&&!y(o,"deleteRows"))return;if("column"==e&&!y(o,"deleteColumns"))return;let n=v(o),i=d.luckysheetfile[n],f=$.extend(!0,[],i.data);if(t<0&&(t=0),r<0&&(r=0),"row"==e?(t>f.length-1&&(t=f.length-1),r>f.length-1&&(r=f.length-1)):(t>f[0].length-1&&(t=f[0].length-1),r>f[0].length-1&&(r=f[0].length-1)),t>r)return;let u=r-t+1,s=$.extend(!0,{},i.config);null==s.merge&&(s.merge={});let h={};for(let l in s.merge){let o=s.merge[l],n=o.r,c=o.c,i=o.rs,f=o.cs;"row"==e?n<t?n+i-1<t?h[n+"_"+c]={r:n,c:c,rs:i,cs:f}:n+i-1>=t&&n+i-1<r?h[n+"_"+c]={r:n,c:c,rs:t-n,cs:f}:n+i-1>=r&&(h[n+"_"+c]={r:n,c:c,rs:i-u,cs:f}):n>=t&&n<=r?n+i-1>r&&(h[t+"_"+c]={r:t,c:c,rs:n+i-1-r,cs:f}):n>r&&(h[n-u+"_"+c]={r:n-u,c:c,rs:i,cs:f}):"column"==e&&(c<t?c+f-1<t?h[n+"_"+c]={r:n,c:c,rs:i,cs:f}:c+f-1>=t&&c+f-1<r?h[n+"_"+c]={r:n,c:c,rs:i,cs:t-c}:c+f-1>=r&&(h[n+"_"+c]={r:n,c:c,rs:i,cs:f-u}):c>=t&&c<=r?c+f-1>r&&(h[n+"_"+t]={r:n,c:t,rs:i,cs:c+f-1-r}):c>r&&(h[n+"_"+(c-u)]={r:n,c:c-u,rs:i,cs:f}))}s.merge=h;let m=i.calcChain,w=[];if(null!=m&&m.length>0)for(let o=0;o<m.length;o++){let n=$.extend(!0,{},m[o]),c=n.r,i=n.c,s=n.index,d=g(c,i,s);if("row"==e){if(c<t||c>r){let e="="+l.functionStrChange(d,"del","row",null,t,u);f[c][i]&&f[c][i].f==d&&(f[c][i].f=e),c>r&&(n.r=c-u),w.push(n)}}else if("column"==e&&(i<t||i>r)){let e="="+l.functionStrChange(d,"del","col",null,t,u);f[c][i]&&f[c][i].f==d&&(f[c][i].f=e),i>r&&(n.c=i-u),w.push(n)}}let p=i.filter_select,_=i.filter,I=null;if(null!=p&&"{}"!=JSON.stringify(p)){I={filter_select:null,filter:null};let l=p.row[0],o=p.row[1],n=p.column[0],c=p.column[1];if("row"==e){if(l>r?(l-=u,o-=u,I.filter_select={row:[l,o],column:[n,c]}):l<t&&(o<t||(o<=r?o=t-1:o-=u),I.filter_select={row:[l,o],column:[n,c]}),null!=I.filter_select&&null!=_)for(let e in _){let n=_[e].rowhidden,c={};for(let e in n)e<t?c[e]=0:e>r&&(c[e-u]=0);"{}"!=JSON.stringify(c)&&(null==I.filter&&(I.filter={}),I.filter[e]=$.extend(!0,{},_[e]),I.filter[e].rowhidden=c,I.filter[e].str=l,I.filter[e].edr=o)}}else if("column"==e&&(n>r?(n-=u,c-=u,I.filter_select={row:[l,o],column:[n,c]}):n<t?(c<t||(c<=r?c=t-1:c-=u),I.filter_select={row:[l,o],column:[n,c]}):c>r&&(n=t,c-=u,I.filter_select={row:[l,o],column:[n,c]}),null!=I.filter_select&&null!=_))for(let e in _){let l=_[e].cindex;l<t?(null==I.filter&&(I.filter={}),I.filter[l-n]=$.extend(!0,{},_[e]),I.filter[l-n].edc=c):l>r&&(l-=u,null==I.filter&&(I.filter={}),I.filter[l-n]=$.extend(!0,{},_[e]),I.filter[l-n].cindex=l,I.filter[l-n].stc=n,I.filter[l-n].edc=c)}}if(null!=I&&null!=I.filter){null==s.rowhidden&&(s.rowhidden={});for(let e in I.filter){let l=I.filter[e].rowhidden;for(let e in l)s.rowhidden[e]=0}}let x=i.luckysheet_conditionformat_save,z=[];if(null!=x&&x.length>0)for(let l=0;l<x.length;l++){let o=x[l].cellrange,n=[];for(let l=0;l<o.length;l++){let c=o[l].row[0],i=o[l].row[1],f=o[l].column[0],s=o[l].column[1];"row"==e?c>=t&&i<=r||(c>r?(c-=u,i-=u):c<t?i<t||(i<=r?i=t-1:i-=u):i>r&&(c=t,i-=u),n.push({row:[c,i],column:[f,s]})):"column"==e&&(f>=t&&s<=r||(f>r?(f-=u,s-=u):f<t?s<t||(s<=r?s=t-1:s-=u):s>r&&(f=t,s-=u),n.push({row:[c,i],column:[f,s]})))}if(n.length>0){let e=$.extend(!0,{},x[l]);e.cellrange=n,z.push(e)}}let k=i.luckysheet_alternateformat_save,S=[];if(null!=k&&k.length>0)for(let l=0;l<k.length;l++){let o=k[l].cellrange.row[0],n=k[l].cellrange.row[1],c=k[l].cellrange.column[0],i=k[l].cellrange.column[1];if("row"==e){if(!(o>=t&&n<=r)){let e=$.extend(!0,{},k[l]);o>r?(o-=u,n-=u):o<t?n<t||(n<=r?n=t-1:n-=u):n>r&&(o=t,n-=u),e.cellrange={row:[o,n],column:[c,i]},S.push(e)}}else if("column"==e&&!(c>=t&&i<=r)){let e=$.extend(!0,{},k[l]);c>r?(c-=u,i-=u):c<t?i<t||(i<=r?i=t-1:i-=u):i>r&&(c=t,i-=u),e.cellrange={row:[o,n],column:[c,i]},S.push(e)}}let T={freezenhorizontaldata:null,freezenverticaldata:null};if(null!=c.freezenhorizontaldata&&"row"==e){let e=c.freezenhorizontaldata[2],l=b(d.visibledatarow,e);-1==l&&(l=0);let o=c.freezenhorizontaldata[1]-1;o>=t&&(o<r?o=t-1:o-=u),o<l&&(o=l);let n=d.visibledatarow[o]-2-e+d.columnHeaderHeight;T.freezenhorizontaldata=[d.visibledatarow[o],o+1,e,c.cutVolumn(d.visibledatarow,o+1),n]}else T.freezenhorizontaldata=c.freezenhorizontaldata;if(null!=c.freezenverticaldata&&"column"==e){let e=c.freezenverticaldata[2],l=b(d.visibledatacolumn,e);-1==l&&(l=0);let o=c.freezenverticaldata[1]-1;o>=t&&(o<r?o=t-1:o-=u),o<l&&(o=l);let n=d.visibledatacolumn[o]-2-e+d.rowHeaderWidth;T.freezenverticaldata=[d.visibledatacolumn[o],o+1,e,c.cutVolumn(d.visibledatacolumn,o+1),n]}else T.freezenverticaldata=c.freezenverticaldata;let C=i.dataVerification,N={};if(null!=C)for(let l in C){let o=Number(l.split("_")[0]),n=Number(l.split("_")[1]),c=C[l];"row"==e?o<t?N[o+"_"+n]=c:o>r&&(N[o-u+"_"+n]=c):"column"==e&&(n<t?N[o+"_"+n]=c:n>r&&(N[o+"_"+(n-u)]=c))}let F,V=i.hyperlink,L={};if(null!=V)for(let l in V){let o=Number(l.split("_")[0]),n=Number(l.split("_")[1]),c=V[l];"row"==e?o<t?L[o+"_"+n]=c:o>r&&(L[o-u+"_"+n]=c):"column"==e&&(n<t?L[o+"_"+n]=c:n>r&&(L[o+"_"+(n-u)]=c))}if("row"==e){F="r",null==s.rowlen&&(s.rowlen={});let e={};for(let l in s.rowlen)l<t?e[l]=s.rowlen[l]:l>r&&(e[l-u]=s.rowlen[l]);s.rowlen=e,null==s.rowhidden&&(s.rowhidden={});let l={};for(let e in s.rowhidden)e<t?l[e]=s.rowhidden[e]:e>r&&(l[e-u]=s.rowhidden[e]);if(s.rowhidden=l,s.borderInfo&&s.borderInfo.length>0){let e=[];for(let l=0;l<s.borderInfo.length;l++){let o=s.borderInfo[l].rangeType;if("range"==o){let o=s.borderInfo[l].range,n=[];for(let e=0;e<o.length;e++){let l=o[e].row[0],c=o[e].row[1];for(let n=t;n<=r;n++)n<o[e].row[0]?(l-=1,c-=1):n<=o[e].row[1]&&(c-=1);c>=l&&n.push({row:[l,c],column:o[e].column})}if(n.length>0){let t={rangeType:"range",borderType:s.borderInfo[l].borderType,style:s.borderInfo[l].style,color:s.borderInfo[l].color,range:n};e.push(t)}}else if("cell"==o){let o=s.borderInfo[l].value.row_index;o<t?e.push(s.borderInfo[l]):o>r&&(s.borderInfo[l].value.row_index=o-(r-t+1),e.push(s.borderInfo[l]))}}s.borderInfo=e}f.splice(t,u);for(let e=0;e<u;e++){let e=[];for(let l=0;l<f[0].length;l++)e.push(null);f.push(e)}}else{F="c",null==s.columnlen&&(s.columnlen={});let e={};for(let l in s.columnlen)l<t?e[l]=s.columnlen[l]:l>r&&(e[l-u]=s.columnlen[l]);s.columnlen=e,null==s.colhidden&&(s.colhidden={});let l={};for(let e in s.colhidden)e<t?l[e]=s.colhidden[e]:e>r&&(l[e-u]=s.colhidden[e]);if(s.colhidden=l,s.borderInfo&&s.borderInfo.length>0){let e=[];for(let l=0;l<s.borderInfo.length;l++){let o=s.borderInfo[l].rangeType;if("range"==o){let o=s.borderInfo[l].range,n=[];for(let e=0;e<o.length;e++){let l=o[e].column[0],c=o[e].column[1];for(let n=t;n<=r;n++)n<o[e].column[0]?(l-=1,c-=1):n<=o[e].column[1]&&(c-=1);c>=l&&n.push({row:o[e].row,column:[l,c]})}if(n.length>0){let t={rangeType:"range",borderType:s.borderInfo[l].borderType,style:s.borderInfo[l].style,color:s.borderInfo[l].color,range:n};e.push(t)}}else if("cell"==o){let o=s.borderInfo[l].value.col_index;o<t?e.push(s.borderInfo[l]):o>r&&(s.borderInfo[l].value.col_index=o-(r-t+1),e.push(s.borderInfo[l]))}}s.borderInfo=e}let o=[];for(let e=0;e<u;e++)o.push(null);for(let e=0;e<f.length;e++){let l=[].concat(f[e]);l.splice(t,u),f[e]=l.concat(o)}}i.index==d.currentSheetIndex?a(f,s,"delRC",{index:t,len:r-t+1,rc:F},w,I,z,S,T,N,L):(i.data=f,i.config=s,i.calcChain=w,i.filter=I.filter,i.filter_select=I.filter_select,i.luckysheet_conditionformat_save=z,i.luckysheet_alternateformat_save=S,i.dataVerification=N,i.hyperlink=L)},luckysheetDeleteCell:function(e,t,r,o,n,c){if(c=c||d.currentSheetIndex,!I(c))return;let i=v(c),f=d.luckysheetfile[i],u=$.extend(!0,[],f.data),s=r-t+1,a=n-o+1,m=$.extend(!0,{},d.config);null==m.merge&&(m.merge={});let w={};for(let l in m.merge){let c=m.merge[l],i=c.r,f=c.c,d=c.rs,h=c.cs;if("moveLeft"==e)if(t>i+d-1||r<i||o>f+h-1)w[i+"_"+f]={r:i,c:f,rs:d,cs:h};else if(t<=i&&r>=i+d-1&&n<f)w[i+"_"+(f-a)]={r:i,c:f-a,rs:d,cs:h};else for(let e=i;e<=i+d-1;e++)for(let l=f;l<=f+h-1;l++)delete u[e][l].mc;else if("moveUp"==e)if(o>f+h-1||n<f||t>i+d-1)w[i+"_"+f]={r:i,c:f,rs:d,cs:h};else if(o<=f&&n>=f+h-1&&r<i)w[i-s+"_"+f]={r:i-s,c:f,rs:d,cs:h};else for(let e=i;e<=i+d-1;e++)for(let l=f;l<=f+h-1;l++)delete u[e][l].mc}m.merge=w;let p=f.calcChain,_=[];if(null!=p&&p.length>0)for(let c=0;c<p.length;c++){let i=$.extend(!0,{},p[c]),f=i.r,d=i.c,h=i.index,m=g(f,d,h);if(f<t||f>r||d<o||d>n){let c;"moveLeft"==e?(c="="+l.functionStrChange(m,"del","col",null,o,a),d>n&&f>=t&&f<=r&&(i.c=d-a)):"moveUp"==e&&(c="="+l.functionStrChange(m,"del","row",null,t,s),f>r&&d>=o&&d<=n&&(i.r=f-s)),u[f][d]&&u[f][d].f==m&&(u[f][d].f=c),_.push(i)}}let b=f.filter_select,y=f.filter,z=null;if(null!=b&&"{}"!=JSON.stringify(b)){z={filter_select:null,filter:null};let l=b.row[0],c=b.row[1],i=b.column[0],f=b.column[1];if("moveUp"==e)if(i>=o&&f<=n){if(l>r?z.filter_select={row:[l-s,c-s],column:[i,f]}:c<t?z.filter_select={row:[l,c],column:[i,f]}:l<t&&(z.filter_select=c>r?{row:[l,c-s],column:[i,f]}:{row:[l,t-1],column:[i,f]}),null!=z.filter_select&&null!=y)for(let e in y){let l=y[e].rowhidden,o={};for(let e in l)e<t?o[e]=0:e>r&&(o[e-slen]=0);null==z.filter&&(z.filter={}),z.filter[e]=$.extend(!0,{},y[e]),"{}"!=JSON.stringify(o)&&(z.filter[e].rowhidden=o),z.filter[e].str=z.filter_select.row[0],z.filter[e].edr=z.filter_select.row[1]}}else if(l>=t&&c<=r){if(i>n?z.filter_select={row:[l,c],column:[i,f]}:i>=o?f>n&&(z.filter_select={row:[l,c],column:[o,f-a]}):z.filter_select=f<o?{row:[l,c],column:[i,f]}:f<=n?{row:[l,c],column:[i,o-1]}:{row:[l,c],column:[i,f-a]},null!=z.filter_select&&null!=y)for(let e in y){let l=z.filter_select.column[0],t=z.filter_select.column[1],r=y[e].cindex;if(r<o||r>n){null==z.filter&&(z.filter={}),r>n&&(r-=a);let o=r-l;z.filter[o]=$.extend(!0,{},y[e]),z.filter[o].cindex=r,z.filter[o].stc=l,z.filter[o].edc=t}}}else z.filter_select={row:[l,c],column:[i,f]},null!=y&&(z.filter=y);else if("moveLeft"==e)if(l>=t&&c<=r){if(i>n?z.filter_select={row:[l,c],column:[i-a,f-a]}:f<o?z.filter_select={row:[l,c],column:[i,f]}:i<o&&(z.filter_select=f>n?{row:[l,c],column:[i,f-a]}:{row:[l,c],column:[i,o-1]}),null!=z.filter_select&&null!=y)for(let e in y){let l=z.filter_select.column[0],t=z.filter_select.column[1],r=y[e].cindex;if(r<o||r>n){null==z.filter&&(z.filter={}),r>n&&(r-=a);let o=r-l;z.filter[o]=$.extend(!0,{},y[e]),z.filter[o].cindex=r,z.filter[o].stc=l,z.filter[o].edc=t}}}else i>=o&&f<=n?(l<t||l>r)&&(z.filter_select={row:[l,c],column:[i,f]},null!=y&&(z.filter=y)):(z.filter_select={row:[l,c],column:[i,f]},null!=y&&(z.filter=y))}if(null!=z&&null!=z.filter){null==m.rowhidden&&(m.rowhidden={});for(let e in z.filter){let l=z.filter[e].rowhidden;for(let e in l)m.rowhidden[e]=0}}let k=f.luckysheet_conditionformat_save,S=[];if(null!=k&&k.length>0)for(let l=0;l<k.length;l++){let c=k[l].cellrange,i=[];for(let l=0;l<c.length;l++){let f=c[l].row[0],u=c[l].row[1],d=c[l].column[0],h=c[l].column[1];t<=f&&r>=u&&o<=d&&n>=h||(i=x(e,t,r,o,n,f,u,d,h,s,a))}if(i.length>0){let e=$.extend(!0,{},k[l]);e.cellrange=i,S.push(e)}}let T=f.dataVerification,C={};if(null!=T)for(let l in T){let c=Number(l.split("_")[0]),i=Number(l.split("_")[1]),f=T[l];(c<t||c>r||i<o||i>n)&&("moveLeft"==e?i>n&&c>=t&&c<=r?C[c+"_"+(i-a)]=f:C[c+"_"+i]=f:"moveUp"==e&&(c>r&&i>=o&&i<=n?C[c-s+"_"+i]=f:C[c+"_"+i]=f))}let N=f.hyperlink,F={};if(null!=N)for(let l in N){let c=Number(l.split("_")[0]),i=Number(l.split("_")[1]),f=N[l];(c<t||c>r||i<o||i>n)&&("moveLeft"==e?i>n&&c>=t&&c<=r?F[c+"_"+(i-a)]=f:F[c+"_"+i]=f:"moveUp"==e&&(c>r&&i>=o&&i<=n?F[c-s+"_"+i]=f:F[c+"_"+i]=f))}if(m.borderInfo&&m.borderInfo.length>0){let l=[];for(let c=0;c<m.borderInfo.length;c++){let i=m.borderInfo[c].rangeType;if("range"==i){let i=m.borderInfo[c].range,f=[];for(let l=0;l<i.length;l++){let c=i[l].row[0],u=i[l].row[1],d=i[l].column[0],h=i[l].column[1];t<=c&&r>=u&&o<=d&&n>=h||(f=x(e,t,r,o,n,c,u,d,h,s,a))}if(f.length>0){let e={rangeType:"range",borderType:m.borderInfo[c].borderType,style:m.borderInfo[c].style,color:m.borderInfo[c].color,range:f};l.push(e)}}else if("cell"==i){let i=m.borderInfo[c].value.row_index,f=m.borderInfo[c].value.col_index;(i<t||i>r||f<o||f>n)&&("moveLeft"==e?f>n&&i>=t&&i<=r&&(f-=a,m.borderInfo[c].value.col_index=f):"moveUp"==e&&i>r&&f>=o&&f<=n&&(i-=s,m.borderInfo[c].value.row_index=i),l.push(m.borderInfo[c]))}}m.borderInfo=l}let V=[];for(let e=o;e<=n;e++)V.push(null);if("moveUp"==e){let e=[];for(let l=t;l<=u.length-1;l++){let t=[];for(let e=o;e<=n;e++)t.push(u[l][e]);e.push(t)}e.splice(0,s);let l=[];for(let e=t;e<=r;e++)l.push(V);e=e.concat(l);for(let l=t;l<=u.length-1;l++)for(let r=o;r<=n;r++)u[l][r]=e[l-t][r-o]}else if("moveLeft"==e)for(let e=t;e<=r;e++)u[e].splice(o,a),u[e]=u[e].concat(V);f.index==d.currentSheetIndex?h(u,m,{type:e,str:t,edr:r,stc:o,edc:n},_,z,S,C,F):(f.data=u,f.config=m,f.calcChain=_,f.filter=z.filter,f.filter_select=z.filter_select,f.luckysheet_conditionformat_save=S,f.dataVerification=C,f.hyperlink=F)}}});
//# sourceMappingURL=../sourcemaps/global/extend.js.map
