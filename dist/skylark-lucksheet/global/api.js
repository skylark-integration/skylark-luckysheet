/**
 * skylark-lucksheet - A version of lucksheet.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["../store","../utils/util","../methods/get","../locale/locale","../controllers/formula","../methods/func_methods","../widgets/tooltip","../methods/json","../controllers/editor","../controllers/formula","../widgets/cleargridelement","../methods/format","../methods/setdata","../controllers/sort","../methods/getRowlen","../methods/getdata","../controllers/refresh","../widgets/extend","../methods/validate","../methods/datecontroll","../methods/border","../widgets/draw","../controllers/server","../controllers/menuButton","../controllers/selection","../methods/luckysheetConfigsetting","../controllers/freezen","../widgets/resize","../controllers/sheetmanage","../controllers/conditionformat","../methods/sheetSearch","../widgets/select","../widgets/constant","../controllers/filter","../controllers/controlHistory","../controllers/zoom","../widgets/dataVerificationCtrl","../widgets/imageCtrl","skylark-moment","../controllers/updateCell"],function(e,t,l,n,r,o,i,a,s,u,c,f,d,h,g,m,p,y,v,w,x,k,b,S,_,T,I,C,R,M,z,j,F,D,H,A,B,O,P,N){"use strict";const{replaceHtml:V,getObjType:E,chatatABC:W,luckysheetactiveCell:G}=t,{getSheetIndex:L,getluckysheet_select_save:U,getluckysheetfile:Y,getRangetxt:J}=l,{genarate:q,update:Z}=f,{setAccuracy:Q,setcellvalue:K}=d,{orderbydata:X}=h,{rowlenByRange:ee}=g,{getdatabyselection:te,getcellvalue:le}=m,{luckysheetrefreshgrid:ne,jfrefreshgrid:re,jfrefreshgrid_rhcw:oe}=p,{luckysheetDeleteCell:ie,luckysheetextendtable:ae,luckysheetdeletetable:se}=y,{isRealNull:ue,valueIsError:ce,isRealNum:fe,hasPartMC:de}=v,he=T.isEditMode,{isdatetime:ge,diff:me}=w,{getBorderInfoCompute:pe}=x,{luckysheetDrawMain:ye}=k,{luckysheet_searcharray:ve}=z,{selectHightlightShow:we,selectIsOverlap:xe}=j,{sheetHTML:ke,luckysheetdefaultstyle:be}=F,{createFilterOptions:Se}=D,{zoomRefreshView:_e,zoomNumberDomBind:Te}=A,{luckysheetupdateCell:Ie}=N;function Ce(t,l,n,o={}){let a=e.flowdata[t][l];const s=JSON.stringify(a);if(!fe(t)||!fe(l))return i.info("The row or column parameter is invalid.","");let{order:c=L(e.currentSheetIndex),isRefresh:f=!0,success:d}={...o},h=e.luckysheetfile[c];if(null==h)return i.info("The order parameter is invalid.","");if(!T.createHookFunction("cellUpdateBefore",t,l,n,f))return;let g=h.data;f&&(g=$.extend(!0,[],h.data)),0==g.length&&(g=R.buildGridData(h));let m={bg:1,ff:1,fc:1,bl:1,it:1,fs:1,cl:1,un:1,vt:1,ht:1,mc:1,tr:1,tb:1,rt:1,qp:1};if(null==n||0==n.toString().length)r.delFunctionGroup(t,l),K(t,l,g,n);else if(n instanceof Object){let e={},o=g[t][l];ue(o)&&(o={}),null!=n.f&&null==n.v?(e.f=n.f,null!=n.ct&&(e.ct=n.ct),g=u.updatecell(t,l,e,!1).data):(null!=n.ct&&(e.ct=n.ct),null!=n.f&&(e.f=n.f),null!=n.v?e.v=n.v:e.v=o.v,null!=n.m&&(e.m=n.m),r.delFunctionGroup(t,l),K(t,l,g,e));for(let e in n){let r=n[e];e in m?S.updateFormatCell(g,e,r,t,t,l,l):o[e]=r}g[t][l]=o}else"="==n.toString().substr(0,1)||"<span"==n.toString().substr(0,5)?g=u.updatecell(t,l,n,!1).data:(r.delFunctionGroup(t,l),K(t,l,g,n));setTimeout(()=>{T.createHookFunction("cellUpdated",t,l,JSON.parse(s),e.flowdata[t][l],f)},0),h.index==e.currentSheetIndex&&f?e.refreshRange(g,[{row:[t,t],column:[l,l]}]):h.data=g,d&&"function"==typeof d&&d(g)}function $e(t,l={}){if(!t&&0!=t)return i.info("Search content cannot be null or empty","");let n=L(e.currentSheetIndex),{isRegularExpression:r=!1,isWholeWord:a=!1,isCaseSensitive:s=!1,order:u=n,type:c="m"}={...l},f=e.luckysheetfile[u].data,d=[];for(let e=0;e<f.length;e++){const l=f[e];for(let n=0;n<l.length;n++){const i=l[n];if(i)if(i.row=e,i.column=n,a)s?t.toString()==i[c]&&d.push(i):i[c]&&t.toString().toLowerCase()==i[c].toLowerCase()&&d.push(i);else if(r){let e;(e=s?new RegExp(o.getRegExpStr(t),"g"):new RegExp(o.getRegExpStr(t),"ig")).test(i[c])&&d.push(i)}else if(s){new RegExp(o.getRegExpStr(t),"g").test(i[c])&&d.push(i)}else{new RegExp(o.getRegExpStr(t),"ig").test(i[c])&&d.push(i)}}}return d}function Re(t){if(I.saveFrozen("freezenRow",t),!t||t==L(e.currentSheetIndex)){let t=$("#luckysheet-cell-main").scrollTop(),l=ve(e.visibledatarow,t);-1==l&&(l=0);let n=e.visibledatarow[l]-2-t+e.columnHeaderHeight,r=[e.visibledatarow[l],l+1,t,I.cutVolumn(e.visibledatarow,l+1),n];I.saveFreezen(r,n,null,null),null!=e.freezenverticaldata&&(I.cancelFreezenVertical(),I.createAssistCanvas(),ne()),I.createFreezenHorizontal(r,n),I.createAssistCanvas(),ne()}}function Me(t){if(I.saveFrozen("freezenColumn",t),!t||t==L(e.currentSheetIndex)){let t=$("#luckysheet-cell-main").scrollLeft(),l=ve(e.visibledatacolumn,t);-1==l&&(l=0);let n=e.visibledatacolumn[l]-2-t+e.rowHeaderWidth,r=[e.visibledatacolumn[l],l+1,t,I.cutVolumn(e.visibledatacolumn,l+1),n];I.saveFreezen(null,null,r,n),null!=e.freezenhorizontaldata&&(I.cancelFreezenHorizontal(),I.createAssistCanvas(),ne()),I.createFreezenVertical(r,n),I.createAssistCanvas(),ne()}}function ze(t,l){const o=n().freezen;if(t&&(t.hasOwnProperty("row_focus")||r.iscelldata(t))){if("string"==typeof t&&r.iscelldata(t)&&(t={row_focus:(t=r.getcellrange(t)).row[0],column_focus:t.column[0]}),I.saveFrozen("freezenRowRange",l,t),!l||l==L(e.currentSheetIndex)){let l=$("#luckysheet-cell-main").scrollTop(),n=ve(e.visibledatarow,l),r=t.row_focus;r>n&&(n=r),-1==n&&(n=0);let o=e.visibledatarow[n]-2-l+e.columnHeaderHeight,i=[e.visibledatarow[n],n+1,l,I.cutVolumn(e.visibledatarow,n+1),o];I.saveFreezen(i,o,null,null),null!=e.freezenverticaldata&&(I.cancelFreezenVertical(),I.createAssistCanvas(),ne()),I.createFreezenHorizontal(i,o),I.createAssistCanvas(),ne()}}else he()?alert(o.noSeletionError):i.info(o.noSeletionError,"")}function je(t,l){const o=n().freezen;let a="string"==typeof t&&r.iscelldata(t);if(t&&(t.hasOwnProperty("column_focus")||a)){if(a&&(t={row_focus:(t=r.getcellrange(t)).row[0],column_focus:t.column[0]}),I.saveFrozen("freezenColumnRange",l,t),!l||l==L(e.currentSheetIndex)){let l=$("#luckysheet-cell-main").scrollLeft(),n=ve(e.visibledatacolumn,l),r=t.column_focus;r>n&&(n=r),-1==n&&(n=0);let o=e.visibledatacolumn[n]-2-l+e.rowHeaderWidth,i=[e.visibledatacolumn[n],n+1,l,I.cutVolumn(e.visibledatacolumn,n+1),o];I.saveFreezen(null,null,i,o),null!=e.freezenhorizontaldata&&(I.cancelFreezenHorizontal(),I.createAssistCanvas(),ne()),I.createFreezenVertical(i,o),I.createAssistCanvas(),ne()}}else he()?alert(o.noSeletionError):i.info(o.noSeletionError,"")}function Fe(t){I.saveFrozen("freezenCancel",t),t&&t!=L(e.currentSheetIndex)||(null!=e.freezenverticaldata&&I.cancelFreezenVertical(),null!=e.freezenhorizontaldata&&I.cancelFreezenHorizontal(),I.createAssistCanvas(),ne())}function De(t,l=0,r={}){if(!fe(l))return i.info("The index parameter is invalid.","");let o,a=L(e.currentSheetIndex),{number:s=1,order:u=a,success:c}={...r},f=n().info;fe(s)?(s=parseInt(s))<1||s>100?he()?alert(f.tipInputNumberLimit):i.info(f.tipInputNumberLimit,""):(u&&e.luckysheetfile[u]&&(o=e.luckysheetfile[u].index),ae(t,l,s,"lefttop",o),c&&"function"==typeof c&&c()):he()?alert(f.tipInputNumber):i.info(f.tipInputNumber,"")}function He(t,l,n,r={}){if(!fe(l)||!fe(n))return i.info("Please enter the index for deleting rows or columns correctly.","");let o,a=L(e.currentSheetIndex),{order:s=a,success:u}={...r};s&&e.luckysheetfile[s]&&(o=e.luckysheetfile[s].index),se(t,l,n,o),u&&"function"==typeof u&&u()}function Ae(t,l,n,r={}){if(!fe(l)||!fe(n))return i.info("Please enter the index for deleting rows or columns correctly.","");let o=L(e.currentSheetIndex),{order:a=o,success:s}={...r},u=e.luckysheetfile[a],c="row"===t?"rowhidden":"colhidden",f=$.extend(!0,{},u.config);null==f[c]&&(f[c]={});for(let e=l;e<=n;e++)f[c][e]=0;if(e.clearjfundo){let l={};l.type="row"===t?"showHidRows":"showHidCols",l.sheetIndex=u.index,l.config=$.extend(!0,{},u.config),l.curconfig=f,e.jfundo.length=0,e.jfredo.push(l)}e.luckysheetfile[a].config=f,e.saveParam("cg",u.index,f[c],{k:c}),a==o&&(e.config=f,oe(e.flowdata.length,e.flowdata[0].length)),s&&"function"==typeof s&&s()}function Be(t,l,n,r={}){if(!fe(l)||!fe(n))return i.info("Please enter the index for deleting rows or columns correctly.","");let o=L(e.currentSheetIndex),{order:a=o,success:s}={...r},u=e.luckysheetfile[a],c="row"===t?"rowhidden":"colhidden",f=$.extend(!0,{},u.config);if(null!=f[c]){for(let e=l;e<=n;e++)delete f[c][e];if(e.clearjfundo){let l={};l.type="row"===t?"showHidRows":"showHidCols",l.sheetIndex=u.index,l.config=$.extend(!0,{},u.config),l.curconfig=f,e.jfundo.length=0,e.jfredo.push(l)}e.luckysheetfile[a].config=e.config,e.saveParam("cg",u.index,f[c],{k:c}),a===o&&(e.config=f,oe(e.flowdata.length,e.flowdata[0].length)),s&&"function"==typeof s&&s()}}function Oe(){let t=e.luckysheet_select_save,l=[];for(let e=0;e<t.length;e++){let n=t[e],r={row:n.row,column:n.column};l.push(r)}return l}function Pe(e){let t=[];return(e=e||Oe()).forEach(e=>{let l=e.row,n=e.column;for(let e=l[0];e<=l[1];e++)for(let l=n[0];l<=n[1];l++)t.push({r:e,c:l})}),t}function Ne(t,l,n={}){let o=L(e.currentSheetIndex),a=e.luckysheet_select_save[e.luckysheet_select_save.length-1],{range:s=a,order:u=o}={...n};if(!t)return i.info("Arguments attr cannot be null or undefined.",""),"error";if(s instanceof Array)return i.info("setRangeValue only supports a single selection.",""),"error";if("string"==E(s)){if(!r.iscelldata(s))return i.info("The range parameter is invalid.",""),"error";s=r.getcellrange(s)}if("object"!=E(s)||null==s.row||null==s.column)return i.info("The range parameter is invalid.",""),"error";for(let e=s.row[0];e<=s.row[1];e++)for(let n=s.column[0];n<=s.column[1];n++)console.log("r",e),console.log("c",n),Ce(e,n,{[t]:l},{order:u,isRefresh:!1})}function Ve(t={}){let l=e.luckysheet_select_save,n=L(e.currentSheetIndex),{range:o=l,order:a=n,success:s}={...t},u=e.luckysheetfile[a],c=$.extend(!0,{},u.config),f=$.extend(!0,[],u.data);if(0==f.length&&(f=$.extend(!0,[],R.buildGridData(u))),"string"==E(o)){if(!r.iscelldata(o))return i.info("Incorrect selection format","");let e=r.getcellrange(o);o=[{row:e.row,column:e.column}]}else if("object"==E(o)){if(!o.hasOwnProperty("row")||!o.hasOwnProperty("column"))return i.info("Incorrect selection format","");o=[{row:o.row,column:o.column}]}if(xe(o))return i.info("Cannot merge overlapping range","");if(null!=c.merge){let e=!1;for(let t=0;t<o.length;t++){let l=o[t].row[0],n=o[t].row[1],r=o[t].column[0],i=o[t].column[1];if(e=de(c,l,n,r,i))break}if(e)return i.info("Cannot perform this operation on partially merged cells","")}for(let e=0;e<o.length;e++){let t=o[e].row[0],l=o[e].row[1],n=o[e].column[0],r=o[e].column[1];if(t==l&&n==r)continue;let i={};for(let e=t;e<=l;e++)for(let t=n;t<=r;t++){let l=f[e][t];if(null!=l&&null!=l.mc){let n=l.mc.r,r=l.mc.c;if("rs"in l.mc)delete l.mc,delete c.merge[n+"_"+r],i[n+"_"+r]=$.extend(!0,{},l);else{let l=JSON.parse(JSON.stringify(i[n+"_"+r]));delete l.v,delete l.m,delete l.ct,delete l.f,delete l.spl,f[e][t]=l}}}}a==n?(e.clearjfundo&&(e.jfundo.length=0,e.jfredo.push({type:"mergeChange",sheetIndex:u.index,data:$.extend(!0,[],u.data),curData:f,range:o,config:$.extend(!0,{},u.config),curConfig:c})),e.clearjfundo=!1,e.refreshRange(f,o,{cfg:c}),e.clearjfundo=!0):(u.data=f,u.config=c)}function Ee(){return e.toJson()}return{getCellValue:function(t,l,n={}){if(!fe(t)||!fe(l))return i.info("Arguments row or column cannot be null or undefined.","");let o,a=L(e.currentSheetIndex),{type:s="v",order:u=a}={...n},c=e.luckysheetfile[u].data[t][l];return"object"==E(c)&&(o=c[s],"f"==s&&null!=o?o=r.functionHTMLGenerate(o):"f"==s?o=c.v:c&&c.ct&&"yyyy-MM-dd"==c.ct.fa&&(o=c.m)),void 0==o&&(o=null),o},setCellValue:Ce,clearCell:function(t,l,n={}){if(!fe(t)||!fe(l))return i.info("Arguments row and column cannot be null or undefined.","");let o=L(e.currentSheetIndex),{order:a=o,success:s}={...n},u=$.extend(!0,[],e.luckysheetfile[a].data),c=u[t][l];"object"==E(c)?(delete c.m,delete c.v,null!=c.f&&(delete c.f,r.delFunctionGroup(t,l,a),delete c.spl)):c=null,a===o?e.refreshRange(u,[{row:[t,t],column:[l,l]}]):e.luckysheetfile[a].data=u,s&&"function"==typeof s&&s(c)},deleteCell:function(t,l,n,r={}){if(!t||["left","up"].indexOf(t)<0)return i.info("Arguments move cannot be null or undefined and its value must be 'left' or 'up'","");if(!fe(l)||!fe(n))return i.info("Arguments row and column cannot be null or undefined.","");let o,a=L(e.currentSheetIndex),{order:s=a,success:u}={...r},c="move"+t.replace(t[0],t[0].toUpperCase());s&&e.luckysheetfile[s]&&(o=e.luckysheetfile[s].index),ie(c,l,l,n,n,o),u&&"function"==typeof u&&u()},setCellFormat:function(t,l,n,r,o={}){if(!fe(t)||!fe(l))return i.info("Arguments row or column cannot be null or undefined.","");if(!n)return i.info("Arguments attr cannot be null or undefined.","");let a=L(e.currentSheetIndex),{order:s=a,success:u}={...o},c=e.luckysheetfile[s];if(null==c)return i.info("The order parameter is invalid.","");let f=$.extend(!0,[],c.data);0==f.length&&(f=R.buildGridData(c));let d=f[t][l]||{},h=$.extend(!0,{},c.config);if(!("ct"!=n||r&&r.hasOwnProperty("fa")&&r.hasOwnProperty("t")))return new TypeError("While set attribute 'ct' to cell, the value must have property 'fa' and 't'");if("bd"==n){null==h.borderInfo&&(h.borderInfo=[]);let e={rangeType:"range",borderType:"border-all",color:"#000",style:"1",range:[{column:[l,l],row:[t,t]}],...r};h.borderInfo.push(e)}else d[n]=r;f[t][l]=d,c.index==e.currentSheetIndex?(c.config=h,e.config=h,e.refreshRange(f,[{row:[t,t],column:[l,l]}])):(c.config=h,c.data=f),u&&"function"==typeof u&&u(d)},find:$e,replace:function(t,l,n={}){let r=$e(t,n),o=L(e.currentSheetIndex),{order:a=o}={...n},s=e.luckysheetfile[a];if(null==s)return i.info("The order parameter is invalid.","");let u=$.extend(!0,[],s.data);r.forEach(e=>{e.m=l,Ce(e.row,e.column,l,{order:a,isRefresh:!1})});let c=$.extend(!0,[],s.data);return s.data.length=0,s.data.push(...u),s.index==e.currentSheetIndex&&e.refreshRange(c,void 0,void 0,!0,!1),ne(),n.success&&"function"==typeof n.success&&n.success(r),r},exitEditMode:function(t={}){parseInt($("#luckysheet-input-box").css("top"))>0&&($("#luckysheet-formula-search-c").is(":visible")&&null!=r.searchFunctionCell?r.searchFunctionEnter($("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item-active")):(r.updatecell(e.luckysheetCellUpdate[0],e.luckysheetCellUpdate[1]),e.luckysheet_select_save=[{row:[e.luckysheetCellUpdate[0],e.luckysheetCellUpdate[0]],column:[e.luckysheetCellUpdate[1],e.luckysheetCellUpdate[1]],row_focus:e.luckysheetCellUpdate[0],column_focus:e.luckysheetCellUpdate[1]}]),$("#luckysheet-search-formula-parm").is(":visible")&&$("#luckysheet-search-formula-parm").hide(),$("#luckysheet-search-formula-parm-select").is(":visible")&&$("#luckysheet-search-formula-parm-select").hide()),t.success&&"function"==typeof t.success&&t.success()},enterEditMode:function(t={}){if(!$("#luckysheet-conditionformat-dialog").is(":visible")){if($("#luckysheet-cell-selected").is(":visible")){let t=e.luckysheet_select_save[e.luckysheet_select_save.length-1],l=t.row_focus,n=t.column_focus;Ie(l,n,e.flowdata)}t.success&&"function"==typeof t.success&&t.success()}},frozenFirstRow:Re,frozenFirstColumn:Me,frozenRowRange:ze,frozenColumnRange:je,cancelFrozen:Fe,setHorizontalFrozen:function(t,l={}){let n=L(e.currentSheetIndex),{range:r,order:o=n,success:i}={...l};Fe(o),t?ze(r,o):Re(o),i&&"function"==typeof i&&i()},setVerticalFrozen:function(t,l={}){let n=L(e.currentSheetIndex),{range:r,order:o=n,success:i}={...l};Fe(o),t?je(r,o):Me(o),i&&"function"==typeof i&&i()},setBothFrozen:function(t,l={}){let o=L(e.currentSheetIndex),{range:a,order:s=o,success:u}={...l},c=!s||s==L(e.currentSheetIndex);const f=n().freezen;if(Fe(s),t){I.saveFrozen("freezenRCRange",s,a);let t="string"==typeof a&&r.iscelldata(a);if(c){if(!(a&&a.hasOwnProperty("column_focus")&&a.hasOwnProperty("row_focus")||t))return void(he()?alert(f.noSeletionError):i.info(f.noSeletionError,""));t&&(a={row_focus:(a=r.getcellrange(a)).row[0],column_focus:a.column[0]});let l=$("#luckysheet-cell-main").scrollTop(),n=ve(e.visibledatarow,l),o=a.row_focus;o>n&&(n=o),-1==n&&(n=0);let s=e.visibledatarow[n]-2-l+e.columnHeaderHeight,u=[e.visibledatarow[n],n+1,l,I.cutVolumn(e.visibledatarow,n+1),s];I.saveFreezen(u,s,null,null),I.createFreezenHorizontal(u,s);let c=$("#luckysheet-cell-main").scrollLeft(),d=ve(e.visibledatacolumn,c),h=a.column_focus;h>d&&(d=h),-1==d&&(d=0);let g=e.visibledatacolumn[d]-2-c+e.rowHeaderWidth,m=[e.visibledatacolumn[d],d+1,c,I.cutVolumn(e.visibledatacolumn,d+1),g];I.saveFreezen(null,null,m,g),I.createFreezenVertical(m,g),I.createAssistCanvas(),ne()}}else if(I.saveFrozen("freezenRC",s),c){let t=$("#luckysheet-cell-main").scrollTop(),l=ve(e.visibledatarow,t);-1==l&&(l=0);let n=e.visibledatarow[l]-2-t+e.columnHeaderHeight,r=[e.visibledatarow[l],l+1,t,I.cutVolumn(e.visibledatarow,l+1),n];I.saveFreezen(r,n,null,null),I.createFreezenHorizontal(r,n);let o=$("#luckysheet-cell-main").scrollLeft(),i=ve(e.visibledatacolumn,o);-1==i&&(i=0);let a=e.visibledatacolumn[i]-2-o+e.rowHeaderWidth,s=[e.visibledatacolumn[i],i+1,o,I.cutVolumn(e.visibledatacolumn,i+1),a];I.saveFreezen(null,null,s,a),I.createFreezenVertical(s,a),I.createAssistCanvas(),ne()}},insertRowOrColumn:De,insertRow:function(e=0,t={}){De("row",e,t)},insertColumn:function(e=0,t={}){De("column",e,t)},deleteRowOrColumn:He,deleteRow:function(e,t,l={}){He("row",e,t,l)},deleteColumn:function(e,t,l={}){He("column",e,t,l)},hideRowOrColumn:Ae,showRowOrColumn:Be,hideRow:function(e,t,l={}){Ae("row",e,t,l)},showRow:function(e,t,l={}){Be("row",e,t,l)},hideColumn:function(e,t,l={}){Ae("column",e,t,l)},showColumn:function(e,t,l={}){Be("column",e,t,l)},setRowHeight:function(t,l={}){if("object"!=E(t))return i.info("The rowInfo parameter is invalid.","");let{order:n=L(e.currentSheetIndex),success:r}={...l},o=e.luckysheetfile[n];if(null==o)return i.info("The order parameter is invalid.","");let a=$.extend(!0,{},o.config);null==a.rowlen&&(a.rowlen={});for(let e in t)if(parseInt(e)>=0){let l=t[e];Number(l)>=0&&(a.rowlen[parseInt(e)]=Number(l))}o.config=a,e.saveParam("cg",o.index,a.rowlen,{k:"rowlen"}),o.index==e.currentSheetIndex&&(e.config=a,oe(e.flowdata.length,e.flowdata[0].length)),r&&"function"==typeof r&&r()},setColumnWidth:function(t,l={}){if("object"!=E(t))return i.info("The columnInfo parameter is invalid.","");let{order:n=L(e.currentSheetIndex),success:r}={...l},o=e.luckysheetfile[n];if(null==o)return i.info("The order parameter is invalid.","");let a=$.extend(!0,{},o.config);null==a.columnlen&&(a.columnlen={});for(let e in t)if(parseInt(e)>=0){let l=t[e];Number(l)>=0&&(a.columnlen[parseInt(e)]=Number(l))}o.config=a,e.saveParam("cg",o.index,a.columnlen,{k:"columnlen"}),o.index==e.currentSheetIndex&&(e.config=a,oe(e.flowdata.length,e.flowdata[0].length)),r&&"function"==typeof r&&r()},getRowHeight:function(t,l={}){if("array"!=E(t)||0==t.length)return i.info("The rowInfo parameter is invalid.","");let{order:n=L(e.currentSheetIndex),success:r}={...l},o=e.luckysheetfile[n];if(null==o)return i.info("The order parameter is invalid.","");let a=$.extend(!0,{},o.config).rowlen||{},s={};return t.forEach(t=>{if(parseInt(t)>=0){let l=a[parseInt(t)]||e.defaultrowlen;s[parseInt(t)]=l}}),setTimeout(()=>{r&&"function"==typeof r&&r()},1),s},getColumnWidth:function(t,l={}){if("array"!=E(t)||0==t.length)return i.info("The columnInfo parameter is invalid.","");let{order:n=L(e.currentSheetIndex),success:r}={...l},o=e.luckysheetfile[n];if(null==o)return i.info("The order parameter is invalid.","");let a=$.extend(!0,{},o.config).columnlen||{},s={};return t.forEach(t=>{if(parseInt(t)>=0){let l=a[parseInt(t)]||e.defaultcollen;s[parseInt(t)]=l}}),setTimeout(()=>{r&&"function"==typeof r&&r()},1),s},getDefaultRowHeight:function(t={}){let{order:l=L(e.currentSheetIndex),success:n}={...t};return setTimeout(()=>{n&&"function"==typeof n&&n()},1),e.luckysheetfile[l].defaultRowHeight},getDefaultColWidth:function(t={}){let{order:l=L(e.currentSheetIndex),success:n}={...t};return setTimeout(()=>{n&&"function"==typeof n&&n()},1),e.luckysheetfile[l].defaultColWidth},getRange:Oe,getRangeWithFlatten:Pe,getRangeValuesWithFlatte:function(t){let l=[];return(t=t||Pe()).forEach(t=>{l.push(e.flowdata[t.r][t.c])}),l},getRangeAxis:function(){let t=[],l=e.luckysheet_select_save,n=e.currentSheetIndex;return l.forEach(e=>{let l=J(n,{column:e.column,row:e.row});t.push(l)}),t},getRangeValue:function(t={}){let l=L(e.currentSheetIndex),{range:n,order:o=l}={...t},a=e.luckysheetfile[o];if(!n||"object"==typeof n)return te(n,a.index);if("string"==typeof n){if(r.iscelldata(n))return te(r.getcellrange(n),a.index);i.info("The range is invalid, please check range parameter.","")}},getRangeHtml:function(t={}){let{range:l=e.luckysheet_select_save,order:n=L(e.currentSheetIndex),success:o}={...t};if("string"==E(l)){if(!r.iscelldata(l))return i.info("The range parameter is invalid.","");let e=r.getcellrange(l);l=[{row:e.row,column:e.column}]}else if("object"==E(l)){if(null==l.row||null==l.column)return i.info("The range parameter is invalid.","");l=[{row:l.row,column:l.column}]}if("array"!=E(l))return i.info("The range parameter is invalid.","");let a=e.luckysheetfile[n];if(null==a)return i.info("The order parameter is invalid.","");let s=$.extend(!0,{},a.config);if(null!=s.merge){let e=!1;for(let t=0;t<l.length;t++){let n=l[t].row[0],r=l[t].row[1],o=l[t].column[0],i=l[t].column[1];if(e=de(s,n,r,o,i))break}if(e)return i.info("Cannot perform this operation on partially merged cells","")}let u=$.extend(!0,[],a.luckysheet_conditionformat_save);if(l.length>1&&u.length>0){let e=!1,t=M.getComputeMap(a.index);for(let n=0;n<l.length;n++){let r=l[n].row[0],o=l[n].row[1],i=l[n].column[0],a=l[n].column[1];for(let l=r;l<=o;l++){for(let n=i;n<=a;n++)if(null!=M.checksCF(l,n,t)){e=!0;break}if(e)break}if(e)break}if(e)return i.info("Cannot perform this operation on multiple selection areas, please select a single area","")}if(l.length>1){let e=!0,t=l[0].row[0],n=l[0].row[1],r=!0,o=l[0].column[0],a=l[0].column[1];for(let i=1;i<l.length;i++)l[i].row[0]==t&&l[i].row[1]==n||(e=!1),l[i].column[0]==o&&l[i].column[1]==a||(r=!1);if(!e&&!r||xe(l))return i.info("Cannot perform this operation on multiple selection areas, please select a single area","")}let c,f=[],d=[];for(let e=0;e<l.length;e++){let t=l[e].row[0],n=l[e].row[1],r=l[e].column[0],o=l[e].column[1];for(let e=t;e<=n;e++)if(null==s.rowhidden||null==s.rowhidden[e]){f.includes(e)||f.push(e);for(let e=r;e<=o;e++)null!=s.colhidden&&null!=s.colhidden[e]||d.includes(e)||d.push(e)}}s.borderInfo&&s.borderInfo.length>0&&(c=pe(a.index));let h=a.data;null!=h&&0!=h.length||(h=R.buildGridData(a));let g="",m="";f=f.sort(),d=d.sort();for(let e=0;e<f.length;e++){let t=f[e];if(null==s.rowhidden||null==s.rowhidden[t]){g+="<tr>";for(let e=0;e<d.length;e++){let l=d[e];if(null!=s.colhidden&&null!=s.colhidden[l])continue;let n='<td ${span} style="${style}">';if(null!=h[t]&&null!=h[t][l]){let e="",r="";t==f[0]&&(null==s.columnlen||null==s.columnlen[l.toString()]?m+='<colgroup width="72px"></colgroup>':m+='<colgroup width="'+s.columnlen[l.toString()]+'px"></colgroup>'),l==d[0]&&(null==s.rowlen||null==s.rowlen[t.toString()]?e+="height:19px;":e+="height:"+s.rowlen[t.toString()]+"px;");let o,i=/^(w|W)((0?)|(0\.0+))$/;if(o=null!=h[t][l].ct&&null!=h[t][l].ct.fa&&h[t][l].ct.fa.match(i)?le(t,l,h):le(t,l,h,"m"),e+=S.getStyleByCell(h,t,l),"object"==E(h[t][l])&&"mc"in h[t][l]){if(!("rs"in h[t][l].mc))continue;if(r='rowspan="'+h[t][l].mc.rs+'" colspan="'+h[t][l].mc.cs+'"',c&&c[t+"_"+l]){let n={color:{},style:{}},r={color:{},style:{}},o={color:{},style:{}},i={color:{},style:{}};for(let e=t;e<t+h[t][l].mc.rs;e++)for(let a=l;a<l+h[t][l].mc.cs;a++){if(e==t&&c[e+"_"+a]&&c[e+"_"+a].t){let t=c[e+"_"+a].t.style,l=c[e+"_"+a].t.color;null==o.style[t]?o.style[t]=1:o.style[t]=o.style[t]+1,null==o.color[l]?o.color[l]=1:o.color[l]=o.color[l]+1}if(e==t+h[t][l].mc.rs-1&&c[e+"_"+a]&&c[e+"_"+a].b){let t=c[e+"_"+a].b.style,l=c[e+"_"+a].b.color;null==i.style[t]?i.style[t]=1:i.style[t]=i.style[t]+1,null==i.color[l]?i.color[l]=1:i.color[l]=i.color[l]+1}if(a==l&&c[e+"_"+a]&&c[e+"_"+a].l){let r=c[t+"_"+l].l.style,o=c[e+"_"+a].l.color;null==n.style[r]?n.style[r]=1:n.style[r]=n.style[r]+1,null==n.color[o]?n.color[o]=1:n.color[o]=n.color[o]+1}if(a==l+h[t][l].mc.cs-1&&c[e+"_"+a]&&c[e+"_"+a].r){let t=c[e+"_"+a].r.style,l=c[e+"_"+a].r.color;null==r.style[t]?r.style[t]=1:r.style[t]=r.style[t]+1,null==r.color[l]?r.color[l]=1:r.color[l]=r.color[l]+1}}let a=h[t][l].mc.rs,s=h[t][l].mc.cs;if(JSON.stringify(n).length>23){let t=null,l=null;for(let e in n.color)n.color[e]>=a/2&&(t=e);for(let e in n.style)n.style[e]>=a/2&&(l=e);null!=t&&null!=l&&(e+="border-left:"+_.getHtmlBorderStyle(l,t))}if(JSON.stringify(r).length>23){let t=null,l=null;for(let e in r.color)r.color[e]>=a/2&&(t=e);for(let e in r.style)r.style[e]>=a/2&&(l=e);null!=t&&null!=l&&(e+="border-right:"+_.getHtmlBorderStyle(l,t))}if(JSON.stringify(o).length>23){let t=null,l=null;for(let e in o.color)o.color[e]>=s/2&&(t=e);for(let e in o.style)o.style[e]>=s/2&&(l=e);null!=t&&null!=l&&(e+="border-top:"+_.getHtmlBorderStyle(l,t))}if(JSON.stringify(i).length>23){let t=null,l=null;for(let e in i.color)i.color[e]>=s/2&&(t=e);for(let e in i.style)i.style[e]>=s/2&&(l=e);null!=t&&null!=l&&(e+="border-bottom:"+_.getHtmlBorderStyle(l,t))}}}else if(c&&c[t+"_"+l]){if(c[t+"_"+l].l){let n=c[t+"_"+l].l.style,r=c[t+"_"+l].l.color;e+="border-left:"+_.getHtmlBorderStyle(n,r)}if(c[t+"_"+l].r){let n=c[t+"_"+l].r.style,r=c[t+"_"+l].r.color;e+="border-right:"+_.getHtmlBorderStyle(n,r)}if(c[t+"_"+l].b){let n=c[t+"_"+l].b.style,r=c[t+"_"+l].b.color;e+="border-bottom:"+_.getHtmlBorderStyle(n,r)}if(c[t+"_"+l].t){let n=c[t+"_"+l].t.style,r=c[t+"_"+l].t.color;e+="border-top:"+_.getHtmlBorderStyle(n,r)}}n=V(n,{style:e,span:r}),null==o&&(o=le(t,l,h)),null==o&&(o=" "),n+=o}else{let e="";if(c&&c[t+"_"+l]){if(c[t+"_"+l].l){let n=c[t+"_"+l].l.style,r=c[t+"_"+l].l.color;e+="border-left:"+_.getHtmlBorderStyle(n,r)}if(c[t+"_"+l].r){let n=c[t+"_"+l].r.style,r=c[t+"_"+l].r.color;e+="border-right:"+_.getHtmlBorderStyle(n,r)}if(c[t+"_"+l].b){let n=c[t+"_"+l].b.style,r=c[t+"_"+l].b.color;e+="border-bottom:"+_.getHtmlBorderStyle(n,r)}if(c[t+"_"+l].t){let n=c[t+"_"+l].t.style,r=c[t+"_"+l].t.color;e+="border-top:"+_.getHtmlBorderStyle(n,r)}}n+="",t==f[0]&&(null==s.columnlen||null==s.columnlen[l.toString()]?m+='<colgroup width="72px"></colgroup>':m+='<colgroup width="'+s.columnlen[l.toString()]+'px"></colgroup>'),l==d[0]&&(null==s.rowlen||null==s.rowlen[t.toString()]?e+="height:19px;":e+="height:"+s.rowlen[t.toString()]+"px;"),n=V(n,{style:e,span:""}),n+=" "}g+=n+="</td>"}g+="</tr>"}}return g='<table data-type="luckysheet_copy_action_table">'+m+g+"</table>"},getRangeArray:function(t,l={}){if(!["oneDimensional","twoDimensional"].includes(t))return i.info("The dimensional parameter is invalid.","");let{range:n=e.luckysheet_select_save[e.luckysheet_select_save.length-1],order:o=L(e.currentSheetIndex)}={...l},a=e.luckysheetfile[o];if(null==a)return i.info("The order parameter is invalid.","");if("string"==E(n)){if(!r.iscelldata(n))return i.info("The range parameter is invalid.","");n=r.getcellrange(n)}if("object"!=E(n)||null==n.row||null==n.column)return i.info("The range parameter is invalid.","");let s=n.row[0],u=n.row[1],c=n.column[0],f=n.column[1],d=$.extend(!0,{},a.config);if(null!=d.merge&&de(d,s,u,c,f))return i.info("Cannot perform this operation on partially merged cells","");let h=a.data;null!=h&&0!=h.length||(h=R.buildGridData(a));let g=[];if("oneDimensional"==t)for(let e=s;e<=u;e++)for(let t=c;t<=f;t++){let l=h[e][t];null==l||null==l.v?g.push(null):g.push(l.v)}else if("twoDimensional"==t)for(let e=s;e<=u;e++){let t=[];for(let l=c;l<=f;l++){let n=h[e][l];null==n||null==n.v?t.push(null):t.push(n.v)}g.push(t)}return g},getRangeJson:function(t,l={}){let o=e.luckysheet_select_save[0],a=L(e.currentSheetIndex),{range:s=o,order:u=a}={...l},c=e.luckysheetfile[u],f=c.config;if(s&&"string"==typeof s&&r.iscelldata(s)&&(s=r.getcellrange(s)),!s||s.length>1)return void(he()?alert(locale_drag.noMulti):i.info(locale_drag.noMulti,""));if(null!=f.merge){let e=!1,t=s.row[0],l=s.row[1],r=s.column[0],o=s.column[1];if(e=de(f,t,l,r,o))return void(he()?alert(n().drag.noPartMerge):i.info(n().drag.noPartMerge,""))}let d=te(s,c.index),h=[];if(0!==d.length){if(t)if(1===d.length){let e={};for(let t=0;t<d[0].length;t++)e[le(0,t,d)]="";h.push(e)}else for(let e=1;e<d.length;e++){let t={};for(let l=0;l<d[0].length;l++)void 0==le(0,l,d)?t[""]=le(e,l,d):t[le(0,l,d)]=le(e,l,d);h.push(t)}else{let e=s.column[0];for(let t=0;t<d.length;t++){let l={};for(let n=0;n<d[0].length;n++)l[W(n+e)]=le(t,n,d);h.push(l)}}return h}},getRangeDiagonal:function(t,l={}){if(["normal","anti","offset"].indexOf(t)<0)return i.info("The type parameter must be included in ['normal', 'anti', 'offset']","");let o=L(e.currentSheetIndex),a=e.luckysheet_select_save,{column:s=1,range:u=a,order:c=o}={...l},f=e.luckysheetfile[c].config;if(u&&"string"==typeof u&&r.iscelldata(u)&&(u=r.getcellrange(u)),!u||u.length>1)return void(he()?alert(n().drag.noMulti):i.info(n().drag.noMulti,""));if(null!=f.merge){let e=!1,t=u[0].row[0],l=u[0].row[1],r=u[0].column[0],o=u[0].column[1];if(e=de(f,t,l,r,o))return void(he()?alert(n().drag.noPartMerge):i.info(n().drag.noPartMerge,""))}let d=te(u,c),h=[];if(0===d.length)return;let g=d[0].length;switch(t){case"normal":for(let e=0;e<d.length&&!(e>=g);e++)h.push(d[e][e]);break;case"anti":for(let e=0;e<d.length&&!(e>=g);e++)h.push(d[e][g-e-1]);break;case"offset":if("NaN"==s.toString())return void(he()?alert(n().drag.inputCorrect):i.info(n().drag.inputCorrect,""));if(s<0)return void(he()?alert(n().drag.offsetColumnLessZero):i.info(n().drag.offsetColumnLessZero,""));for(let e=0;e<d.length&&!(e+s>=g);e++)h.push(d[e][e+s])}_.copybyformat(new Event,JSON.stringify(h))},getRangeBoolean:function(t={}){let l=L(e.currentSheetIndex),o=e.luckysheet_select_save,{range:a=o,order:s=l}={...t},u=e.luckysheetfile[s].config;if(a&&"string"==typeof a&&r.iscelldata(a)&&(a=r.getcellrange(a)),!a||a.length>1)return void(he()?alert(n().drag.noMulti):i.info(n().drag.noMulti,""));if(null!=u.merge){let e=!1,t=a[0].row[0],l=a[0].row[1],r=a[0].column[0],o=a[0].column[1];if(e=de(u,t,l,r,o))return void(he()?alert(n().drag.noPartMerge):i.info(n().drag.noPartMerge,""))}let c=te(a,s),f=[];if(0!==c.length){for(let e=0;e<c.length;e++){let t=[];for(let l=0;l<c[0].length;l++){let n,r=!1;r=null!=(n="object"==E(c[e][l])?c[e][l].v:c[e][l])&&""!=n&&(null==(n=parseInt(n))||n>0),t.push(r)}f.push(t)}_.copybyformat(event,JSON.stringify(f))}},setRangeShow:function(t,l={}){if("string"==E(t)){if(!r.iscelldata(t))return i.info("The range parameter is invalid.","");let e=r.getcellrange(t);t=[{row:e.row,column:e.column}]}else if("object"==E(t)){if(null==t.row||null==t.column)return i.info("The range parameter is invalid.","");t=[{row:t.row,column:t.column}]}if("array"==E(t))for(let e=0;e<t.length;e++)if("string"===E(t[e])){if(!r.iscelldata(t[e]))return i.info("The range parameter is invalid.","");let l=r.getcellrange(t[e]);t[e]={row:l.row,column:l.column}}else if("object"==E(t)){if(null==t.row||null==t.column)return i.info("The range parameter is invalid.","");t={row:t.row,column:t.column}}if("array"!=E(t))return i.info("The range parameter is invalid.","");let{show:n=!0,order:o=L(e.currentSheetIndex),success:a}={...l},s=e.luckysheetfile[o];if(null==s)return i.info("The order parameter is invalid.","");for(let e=0;e<t.length;e++){let l=cells.mergeMoveMain(t[e].column,t[e].row,t[e]);l&&(t[e]={row:l[1],column:l[0]})}s.luckysheet_select_save=t,s.index==e.currentSheetIndex&&(e.luckysheet_select_save=t,we(),n||($("#luckysheet-cell-selected-boxs").hide(),$("#luckysheet-cell-selected-focus").hide(),$("#luckysheet-row-count-show").hide(),$("#luckysheet-column-count-show").hide(),$("#luckysheet-rows-h-selected").empty(),$("#luckysheet-cols-h-selected").empty())),a&&"function"==typeof a&&a()},setRangeValue:function(t,l={}){let n=L(e.currentSheetIndex),o=e.luckysheet_select_save[e.luckysheet_select_save.length-1],{range:a=o,isRefresh:s=!0,order:u=n,success:c}={...l};if(null==t)return i.info("The data which will be set to range cannot be null.","");if(a instanceof Array)return i.info("setRangeValue only supports a single selection.","");"string"==typeof a&&r.iscelldata(a)&&(a=r.getcellrange(a));let f=a.row[1]-a.row[0]+1,d=a.column[1]-a.column[0]+1;if(t.length!==f||t[0].length!==d)return i.info("The data to be set does not match the selection.","");let h=e.luckysheetfile[u];if(null==h)return i.info("The order parameter is invalid.","");let g=$.extend(!0,[],h.data);for(let e=0;e<f;e++)for(let l=0;l<d;l++)Ce(a.row[0]+e,a.column[0]+l,t[e][l],{order:u,isRefresh:!1});let m=$.extend(!0,[],h.data);h.data.length=0,h.data.push(...g),h.index==e.currentSheetIndex&&e.refreshRange(m,[{row:a.row,column:a.column}],void 0,!0,!1),s&&ne(),c&&"function"==typeof c&&c()},setSingleRangeFormat:Ne,setRangeFormat:function(t,l,n={}){let o=L(e.currentSheetIndex),a=e.luckysheet_select_save,{range:s=a,order:u=o,success:c}={...n};if("string"==E(s)){if(!r.iscelldata(s))return i.info("The range parameter is invalid.","");let e=r.getcellrange(s);s=[{row:e.row,column:e.column}]}else if("object"==E(s)){if(null==s.row||null==s.column)return i.info("The range parameter is invalid.","");s=[{row:s.row,column:s.column}]}if("array"!=E(s))return i.info("The range parameter is invalid.","");let f=e.luckysheetfile[u];if(null==f)return i.info("The order parameter is invalid.","");let d=$.extend(!0,[],f.data),h=[];for(let e=0;e<s.length;e++)h.push(Ne(t,l,{range:s[e],order:u}));if(h.some(e=>"error"===e))return f.data.length=0,f.data.push(...d),!1;let g=$.extend(!0,[],f.data);f.data.length=0,f.data.push(...d),f.index==e.currentSheetIndex&&e.refreshRange(g,void 0,void 0,!0,!1),ne(),c&&"function"==typeof c&&c()},setRangeFilter:function(t,l={}){if(!["open","close"].includes(t))return i.info("The type parameter is invalid.","");let{range:n=e.luckysheet_select_save[e.luckysheet_select_save.length-1],order:o=L(e.currentSheetIndex),success:a}={...l},s=e.luckysheetfile[o];if(null==s)return i.info("The order parameter is invalid.","");if("string"==E(n)){if(!r.iscelldata(n))return i.info("The range parameter is invalid.","");n=r.getcellrange(n)}if("object"!=E(n)||null==n.row||null==n.column)return i.info("The range parameter is invalid.","");if(setTimeout(()=>{a&&"function"==typeof a&&a()},1),"open"==t)return s.filter_select=n,s.index==e.currentSheetIndex&&Se(n,s.filter),{row:n.row,column:n.column};if("close"==t){let e=$.extend(!0,{},s.filter_select);return s.filter_select=null,$("#luckysheet-filter-selected-sheet"+s.index).remove(),$("#luckysheet-filter-options-sheet"+s.index).remove(),{row:e.row,column:e.column}}},setRangeMerge:function(t,l={}){if(["all","horizontal","vertical"].indexOf(t)<0)return i.info("The type parameter must be included in ['all', 'horizontal', 'vertical']","");let n=L(e.currentSheetIndex),o=e.luckysheet_select_save,{range:a=o,order:s=n,success:u}={...l},c=e.luckysheetfile[s],f=$.extend(!0,{},c.config),d=$.extend(!0,[],c.data);if(0==d.length&&(d=$.extend(!0,[],R.buildGridData(c))),"string"==E(a)){if(!r.iscelldata(a))return i.info("Incorrect selection format","");let e=r.getcellrange(a);a=[{row:e.row,column:e.column}]}else if("object"==E(a)){if(!a.hasOwnProperty("row")||!a.hasOwnProperty("column"))return i.info("Incorrect selection format","");a=[{row:a.row,column:a.column}]}if(xe(a))return i.info("Cannot merge overlapping range","");if(null!=f.merge){let e=!1;for(let t=0;t<a.length;t++){let l=a[t].row[0],n=a[t].row[1],r=a[t].column[0],o=a[t].column[1];if(e=de(f,l,n,r,o))break}if(e)return i.info("Cannot perform this operation on partially merged cells","")}let h=!1;for(let e=0;e<a.length;e++){let t=a[e].row[0],l=a[e].row[1],n=a[e].column[0],r=a[e].column[1];for(let e=t;e<=l;e++){for(let t=n;t<=r;t++){let l=d[e][t];if("object"==E(l)&&"mc"in l){h=!0;break}}if(h)break}}if(h)Ve({range:a,order:s});else{for(let e=0;e<a.length;e++){let l=a[e].row[0],n=a[e].row[1],r=a[e].column[0],o=a[e].column[1];if(l!=n||r!=o)if("all"==t){let e={},t=!1;for(let i=l;i<=n;i++)for(let n=r;n<=o;n++){let o=d[i][n];null==o||ue(o.v)&&null==o.f||t||(e=$.extend(!0,{},o),t=!0),d[i][n]={mc:{r:l,c:r}}}d[l][r]=e,d[l][r].mc={r:l,c:r,rs:n-l+1,cs:o-r+1},f.merge[l+"_"+r]={r:l,c:r,rs:n-l+1,cs:o-r+1}}else if("vertical"==t)for(let e=r;e<=o;e++){let t={},r=!1;for(let o=l;o<=n;o++){let n=d[o][e];null==n||ue(n.v)&&null==n.f||r||(t=$.extend(!0,{},n),r=!0),d[o][e]={mc:{r:l,c:e}}}d[l][e]=t,d[l][e].mc={r:l,c:e,rs:n-l+1,cs:1},f.merge[l+"_"+e]={r:l,c:e,rs:n-l+1,cs:1}}else if("horizontal"==t)for(let e=l;e<=n;e++){let t={},l=!1;for(let n=r;n<=o;n++){let o=d[e][n];null==o||ue(o.v)&&null==o.f||l||(t=$.extend(!0,{},o),l=!0),d[e][n]={mc:{r:e,c:r}}}d[e][r]=t,d[e][r].mc={r:e,c:r,rs:1,cs:o-r+1},f.merge[e+"_"+r]={r:e,c:r,rs:1,cs:o-r+1}}}s==n?(e.clearjfundo&&(e.jfundo.length=0,e.jfredo.push({type:"mergeChange",sheetIndex:c.index,data:$.extend(!0,[],c.data),curData:d,range:a,config:$.extend(!0,{},c.config),curConfig:f})),e.clearjfundo=!1,e.refreshRange(d,a,{cfg:f}),e.clearjfundo=!0):(c.data=d,c.config=f)}u&&"function"==typeof u&&u()},cancelRangeMerge:Ve,setRangeSort:function(t,l={}){if(["asc","desc"].indexOf(t)<0)return i.info("The type parameter must be included in ['asc', 'desc'","");let o=L(e.currentSheetIndex),a=e.luckysheet_select_save[0],{range:s=a,order:u=o,success:c}={...l},f=e.luckysheetfile[u],d=$.extend(!0,{},f.config),h=$.extend(!0,[],f.data);if(0==h.length&&(h=$.extend(!0,[],R.buildGridData(f))),s instanceof Array&&s.length>1)return void i.info(n().sort.noRangeError,"");s&&"string"==typeof s&&r.iscelldata(s)&&(s=r.getcellrange(s));let g=s.row[0],m=s.row[1],p=s.column[0],y=s.column[1],v=!1,w=[];for(let e=g;e<=m;e++){let t=[];for(let l=p;l<=y;l++){if(null!=h[e][l]&&null!=h[e][l].mc){v=!0;break}t.push(h[e][l])}w.push(t)}if(v)return void i.info(n().sort.mergeError,"");w=X([].concat(w),0,"asc"===t);for(let e=g;e<=m;e++)for(let t=p;t<=y;t++)h[e][t]=w[e-g][t-p];let x={};null!=d.rowlen&&(x={cfg:d=ee(h,g,m,d),RowlChange:!0}),f.index==e.currentSheetIndex?e.refreshRange(h,[{row:[g,m],column:[p,y]}],x):(f.data=h,f.config=d),c&&"function"==typeof c&&c()},setRangeSortMulti:function(t,l,o={}){if(!(l&&l instanceof Array))return i.info("The sort parameter is invalid.","");let a=L(e.currentSheetIndex),s=e.luckysheet_select_save[0],{range:u=s,order:c=a,success:f}={...o},d=e.luckysheetfile[c],h=$.extend(!0,{},d.config),g=$.extend(!0,[],d.data);if(0==g.length&&(g=$.extend(!0,[],R.buildGridData(d))),u instanceof Array&&u.length>1)return void i.info(n().sort.noRangeError,"");u&&"string"==typeof u&&r.iscelldata(u)&&(u=r.getcellrange(u));let m,p=u.row[0],y=u.row[1],v=u.column[0],w=u.column[1],x=!1,k=[];for(let e=m=t?p+1:p;e<=y;e++){let t=[];for(let l=v;l<=w;l++){if(null!=g[e][l]&&null!=g[e][l].mc){x=!0;break}t.push(g[e][l])}k.push(t)}if(x)return void i.info(n().sort.mergeError,"");l.forEach(e=>{let t=e.i;t-=v,k=X([].concat(k),t,"asc"===e.sort)});for(let e=m;e<=y;e++)for(let t=v;t<=w;t++)g[e][t]=k[e-m][t-v];let b={};null!=h.rowlen&&(b={cfg:h=ee(g,m,y,h),RowlChange:!0}),d.index===e.currentSheetIndex?e.refreshRange(g,[{row:[m,y],column:[v,w]}],b):(d.data=g,d.config=h),f&&"function"==typeof f&&f()},setRangeConditionalFormatDefault:function(t,l,r={}){if(!t||!["greaterThan","lessThan","betweenness","equal","textContains","occurrenceDate","duplicateValue","top10","top10%","last10","last10%","AboveAverage","SubAverage"].includes(t))return i.info("The conditionName parameter is invalid.","");if("array"!=E(l)||0==l.length)return i.info("The conditionValue parameter is invalid.","");let{format:o={textColor:"#000000",cellColor:"#ff0000"},cellrange:a=e.luckysheet_select_save,order:s=L(e.currentSheetIndex),success:u}={...r},c=e.luckysheetfile[s],f=c.data;if(null!=f&&0!=f.length||(f=R.buildGridData(c)),null==c)return i.info("Incorrect worksheet index","");const d=n().conditionformat;let h=[],g=[];if("betweenness"==t){let e=l[0],t=l[1],n=M.getRangeByTxt(e);if(n.length>1)return void M.infoDialog(d.onlySingleCell,"");if(1==n.length){let t=n[0].row[0],l=n[0].row[1],r=n[0].column[0],o=n[0].column[1];if(t!=l||r!=o)return void M.infoDialog(d.onlySingleCell,"");e=le(t,r,f),h.push({row:n[0].row,column:n[0].column}),g.push(e)}else if(0==n.length){if(isNaN(e)||""==e)return void M.infoDialog(d.conditionValueCanOnly,"");g.push(e)}let r=M.getRangeByTxt(t);if(r.length>1)return void M.infoDialog(d.onlySingleCell,"");if(1==r.length){let e=r[0].row[0],l=r[0].row[1],n=r[0].column[0],o=r[0].column[1];if(e!=l||n!=o)return void M.infoDialog(d.onlySingleCell,"");t=le(e,n,f),h.push({row:r[0].row,column:r[0].column}),g.push(t)}else if(0==r.length){if(isNaN(t)||""==t)return void M.infoDialog(d.conditionValueCanOnly,"");g.push(t)}}else if("greaterThan"==t||"lessThan"==t||"equal"==t){let e=l[0],t=M.getRangeByTxt(e);if(t.length>1)return void M.infoDialog(d.onlySingleCell,"");if(1==t.length){let l=t[0].row[0],n=t[0].row[1],r=t[0].column[0],o=t[0].column[1];if(l!=n||r!=o)return void M.infoDialog(d.onlySingleCell,"");e=le(l,r,f),h.push({row:t[0].row,column:t[0].column}),g.push(e)}else if(0==t.length){if(isNaN(e)||""==e)return void M.infoDialog(d.conditionValueCanOnly,"");g.push(e)}}else if("textContains"==t){let e=l[0],t=M.getRangeByTxt(e);if(t.length>1)return void M.infoDialog(d.onlySingleCell,"");if(1==t.length){let l=t[0].row[0],n=t[0].row[1],r=t[0].column[0],o=t[0].column[1];if(l!=n||r!=o)return void M.infoDialog(d.onlySingleCell,"");e=le(l,r,f),h.push({row:t[0].row,column:t[0].column}),g.push(e)}else if(0==t.length){if(""==e)return void M.infoDialog(d.conditionValueCanOnly,"");g.push(e)}}else if("occurrenceDate"==t){let e,t=l[0],n=l[1];if(!ge(t)||!ge(n))return i.info("The conditionValue parameter is invalid.","");e=me(t,n)>0?P(n).format("YYYY/MM/DD")+"-"+P(t).format("YYYY/MM/DD"):P(t).format("YYYY/MM/DD")+"-"+P(n).format("YYYY/MM/DD"),g.push(e)}else if("duplicateValue"==t){let e=l[0];if("0"!=e||"1"!=e)return i.info("The conditionValue parameter is invalid.","");g.push(e)}else if("top10"==t||"top10%"==t||"last10"==t||"last10%"==t){let e=l[0];if(parseInt(e)!=e||parseInt(e)<1||parseInt(e)>1e3)return void M.infoDialog(d.pleaseEnterInteger,"");g.push(parseInt(e))}else"AboveAverage"!=t&&"SubAverage"!=t||g.push(t);if(!o.hasOwnProperty("textColor")||!o.hasOwnProperty("cellColor"))return i.info("The format parameter is invalid.","");if("string"==E(a)?a=M.getRangeByTxt(a):"object"==E(a)&&(a=[a]),"array"!=E(a))return i.info("The cellrange parameter is invalid.","");let m={type:"default",cellrange:a,format:o,conditionName:t,conditionRange:h,conditionValue:g},p=$.extend(!0,[],e.luckysheetfile),y=M.getHistoryRules(p),v=c.luckysheet_conditionformat_save||[];v.push(m),c.luckysheet_conditionformat_save=v;let w=$.extend(!0,[],e.luckysheetfile),x=M.getCurrentRules(w);M.ref(y,x),e.allowUpdate&&e.saveParam("all",c.index,v,{k:"luckysheet_conditionformat_save"}),u&&"function"==typeof u&&u()},setRangeConditionalFormat:function(t,l={}){if(!t||!["dataBar","colorGradation","icons"].includes(t))return i.info("The type parameter is invalid.","");let{format:n,cellrange:r=e.luckysheet_select_save,order:o=L(e.currentSheetIndex),success:a}={...l},s=e.luckysheetfile[o];if(null==s)return i.info("Incorrect worksheet index","");if("dataBar"==t){if(null==n&&(n=["#638ec6","#ffffff"]),"array"!=E(n)||n.length<1||n.length>2)return i.info("The format parameter is invalid.","")}else if("colorGradation"==t){if(null==n&&(n=["rgb(99, 190, 123)","rgb(255, 235, 132)","rgb(248, 105, 107)"]),"array"!=E(n)||n.length<2||n.length>3)return i.info("The format parameter is invalid.","")}else if("icons"==t){null==n&&(n="threeWayArrowMultiColor");let e=["threeWayArrowMultiColor","threeTriangles","fourWayArrowMultiColor","fiveWayArrowMultiColor","threeWayArrowGrayColor","fourWayArrowGrayColor","fiveWayArrowGrayColor","threeColorTrafficLightRimless","threeSigns","greenRedBlackGradient","threeColorTrafficLightBordered","fourColorTrafficLight","threeSymbolsCircled","tricolorFlag","threeSymbolsnoCircle","threeStars","fiveQuadrantDiagram","fiveBoxes","grade4","grade5"];if("string"!=E(n)||!e.includes(n))return i.info("The format parameter is invalid.","");switch(n){case"threeWayArrowMultiColor":n={len:3,leftMin:0,top:0};break;case"threeTriangles":n={len:3,leftMin:0,top:1};break;case"fourWayArrowMultiColor":n={len:4,leftMin:0,top:2};break;case"fiveWayArrowMultiColor":n={len:5,leftMin:0,top:3};break;case"threeWayArrowGrayColor":n={len:3,leftMin:5,top:0};break;case"fourWayArrowGrayColor":n={len:4,leftMin:5,top:1};break;case"fiveWayArrowGrayColor":n={len:5,leftMin:5,top:2};break;case"threeColorTrafficLightRimless":n={len:3,leftMin:0,top:4};break;case"threeSigns":n={len:3,leftMin:0,top:5};break;case"greenRedBlackGradient":n={len:4,leftMin:0,top:6};break;case"threeColorTrafficLightBordered":n={len:3,leftMin:5,top:4};break;case"fourColorTrafficLight":n={len:4,leftMin:5,top:5};break;case"threeSymbolsCircled":n={len:3,leftMin:0,top:7};break;case"tricolorFlag":n={len:3,leftMin:0,top:8};break;case"threeSymbolsnoCircle":n={len:3,leftMin:5,top:7};break;case"threeStars":n={len:3,leftMin:0,top:9};break;case"fiveQuadrantDiagram":n={len:5,leftMin:0,top:10};break;case"fiveBoxes":n={len:5,leftMin:0,top:11};break;case"grade4":n={len:4,leftMin:5,top:9};break;case"grade5":n={len:5,leftMin:5,top:10}}}if("string"==E(r)?r=M.getRangeByTxt(r):"object"==E(r)&&(r=[r]),"array"!=E(r))return i.info("The cellrange parameter is invalid.","");let u={type:t,cellrange:r,format:n},c=$.extend(!0,[],e.luckysheetfile),f=M.getHistoryRules(c),d=s.luckysheet_conditionformat_save||[];d.push(u),s.luckysheet_conditionformat_save=d;let h=$.extend(!0,[],e.luckysheetfile),g=M.getCurrentRules(h);M.ref(f,g),e.allowUpdate&&e.saveParam("all",s.index,d,{k:"luckysheet_conditionformat_save"}),a&&"function"==typeof a&&a()},deleteRangeConditionalFormat:function(t,l={}){if(!fe(t))return i.info("The itemIndex parameter is invalid.","");t=Number(t);let{order:n=L(e.currentSheetIndex),success:r}={...l},o=e.luckysheetfile[n];if(null==o)return i.info("The order parameter is invalid.","");let a=$.extend(!0,[],o.luckysheet_conditionformat_save);if(0==a.length)return i.info("This worksheet has no conditional format to delete","");if(null==a[t])return i.info("The conditional format of the index cannot be found","");let s=a.splice(t,1),u=$.extend(!0,[],e.luckysheetfile),c=M.getHistoryRules(u);o.luckysheet_conditionformat_save=a;let f=$.extend(!0,[],e.luckysheetfile),d=M.getCurrentRules(f);return M.ref(c,d),e.allowUpdate&&e.saveParam("all",o.index,ruleArr,{k:"luckysheet_conditionformat_save"}),setTimeout(()=>{r&&"function"==typeof r&&r()},1),s},clearRange:function(t={}){let{range:l=e.luckysheet_select_save,order:n=L(e.currentSheetIndex),success:o}={...t};if("string"==E(l)){if(!r.iscelldata(l))return i.info("The range parameter is invalid.","");let e=r.getcellrange(l);l=[{row:e.row,column:e.column}]}else if("object"==E(l)){if(null==l.row||null==l.column)return i.info("The range parameter is invalid.","");l=[{row:l.row,column:l.column}]}if("array"!=E(l))return i.info("The range parameter is invalid.","");let a=e.luckysheetfile[n];if(null==a)return i.info("The order parameter is invalid.","");let s=$.extend(!0,{},a.config),u=!1;for(let e=0;e<l.length;e++){let t=l[e].row[0],n=l[e].row[1],r=l[e].column[0],o=l[e].column[1];if(u=de(s,t,n,r,o))break}if(u)return i.info("Cannot perform this operation on partially merged cells","");let c=$.extend(!0,[],a.data);0==c.length&&(c=$.extend(!0,[],R.buildGridData(a)));for(let e=0;e<l.length;e++){let t=l[e].row[0],n=l[e].row[1],o=l[e].column[0],i=l[e].column[1];for(let e=t;e<=n;e++)for(let t=o;t<=i;t++){let l=c[e][t];"object"==E(l)?(delete l.m,delete l.v,null!=l.f&&(delete l.f,r.delFunctionGroup(e,t,a.index),delete l.spl),null!=l.ct&&"inlineStr"==l.ct.t&&delete l.ct):c[e][t]=null}}a.index==e.currentSheetIndex?e.refreshRange(c,l):a.data=c,o&&"function"==typeof o&&o()},deleteRange:function(t,l={}){if(!["left","up"].includes(t))return i.info("The move parameter is invalid.","");let{range:n=e.luckysheet_select_save[e.luckysheet_select_save.length-1],order:o=L(e.currentSheetIndex),success:a}={...l};if("string"==E(n)){if(!r.iscelldata(n))return i.info("The range parameter is invalid.","");let e=r.getcellrange(n);n={row:e.row,column:e.column}}if("object"!=E(n)||null==n.row||null==n.column)return i.info("The range parameter is invalid.","");if(null==e.luckysheetfile[o])return i.info("The order parameter is invalid.","");let s=n.row[0],u=n.row[1],c=n.column[0],f=n.column[1];"left"==t?ie("moveLeft",s,u,c,f,o):"up"==t&&ie("moveUp",s,u,c,f,o),a&&"function"==typeof a&&a()},matrixOperation:function(t,l={}){if(!t||["flipUpDown","flipLeftRight","flipClockwise","flipCounterClockwise","transpose","deleteZeroByRow","deleteZeroByColumn","removeDuplicateByRow","removeDuplicateByColumn","newMatrix"].indexOf(t)<0)return i.info("The type parameter is invalid.","");let o=e.luckysheet_select_save[0],{range:a=o,success:u}={...l};if(a instanceof Array&&a.length>1)return void i.info(n().drag.noMulti,"");a&&"string"==typeof a&&r.iscelldata(a)&&(a=r.getcellrange(a));let c,f,d,h=te(a),g=[];if(0!==h.length){switch(t){case"flipUpDown":for(let e=h.length-1;e>=0;e--){let t=[];for(let l=0;l<h[0].length;l++){let n="";null!=h[e]&&null!=h[e][l]&&(n=h[e][l]),t.push(n)}g.push(t)}break;case"flipLeftRight":for(let e=0;e<h.length;e++){let t=[];for(let l=h[0].length-1;l>=0;l--){let n="";null!=h[e]&&null!=h[e][l]&&(n=h[e][l]),t.push(n)}g.push(t)}break;case"flipClockwise":for(let e=0;e<h[0].length;e++){let t=[];for(let l=h.length-1;l>=0;l--){let n="";null!=h[l]&&null!=h[l][e]&&(n=h[l][e]),t.push(n)}g.push(t)}break;case"flipCounterClockwise":for(let e=h[0].length-1;e>=0;e--){let t=[];for(let l=0;l<h.length;l++){let n="";null!=h[l]&&null!=h[l][e]&&(n=h[l][e]),t.push(n)}g.push(t)}break;case"transpose":for(let e=0;e<h[0].length;e++){let t=[];for(let l=0;l<h.length;l++){let n="";null!=h[l]&&null!=h[l][e]&&(n=h[l][e]),t.push(n)}g.push(t)}break;case"deleteZeroByRow":c=h[0].length;for(let e=0;e<h.length;e++){let t=[],l=!0,n=!0;for(let n=0;n<c;n++){let r="";if(null!=h[e]&&null!=h[e][n]){if(("0"==(r=h[e][n]).v||0==r.v)&&l)continue;l=!1}t.push(r)}let r=[];if(t.length==c)r=t;else{for(let e=t.length-1;e>=0;e--){let l="";if(null!=t[e]){if(("0"==(l=t[e]).v||0==l.v)&&n)continue;n=!1}r.unshift(l)}let e=c-r.length;for(let t=0;t<e;t++)r.push("")}g.push(r)}break;case"deleteZeroByColumn":c=h.length,f=h[0].length;for(let e=0;e<f;e++){let t=[],l=!0,n=!0;for(let n=0;n<c;n++){let r="";if(null!=h[n]&&null!=h[n][e]){if(("0"==(r=h[n][e]).v||0==r.v)&&l)continue;l=!1}t.push(r)}let r=[];if(t.length==c)r=t;else{for(let e=t.length-1;e>=0;e--){let l="";if(null!=t[e]){if(("0"==(l=t[e]).v||0==l.v)&&n)continue;n=!1}r.unshift(l)}let e=c-r.length;for(let t=0;t<e;t++)r.push("")}g.push(r)}d=[];for(let e=0;e<g[0].length;e++){let t=[];for(let l=0;l<g.length;l++){let n="";null!=g[l]&&null!=g[l][e]&&(n=g[l][e]),t.push(n)}d.push(t)}break;case"removeDuplicateByRow":c=h[0].length;for(let e=0;e<h.length;e++){let t=[],l={};for(let t=0;t<c;t++){let n=null;null!=h[e]&&null!=h[e][t]&&((n=h[e][t]).v in l?l[n.v].push(n):(l[n.v]=[],l[n.v].push(n)))}for(let n=0;n<c;n++){let r=null;null!=h[e]&&null!=h[e][n]&&1==l[(r=h[e][n]).v].length&&t.push(r)}let n=c-t.length;for(let e=0;e<n;e++)t.push(null);g.push(t)}break;case"removeDuplicateByColumn":f=h[0].length,c=h.length;for(let e=0;e<f;e++){let t=[],l={};for(let t=0;t<c;t++){let n=null;null!=h[t]&&null!=h[t][e]&&((n=h[t][e]).v in l?l[n.v].push(n):(l[n.v]=[],l[n.v].push(n)))}for(let n=0;n<c;n++){let r=null;null!=h[n]&&null!=h[n][e]&&1==l[(r=h[n][e]).v].length&&t.push(r)}a1=t;let n=c-a1.length;for(let e=0;e<n;e++)a1.push(null);g.push(a1)}d=[];for(let e=0;e<g[0].length;e++){let t=[];for(let l=0;l<g.length;l++){let n=null;null!=g[l]&&null!=g[l][e]&&(n=g[l][e]),t.push(n)}d.push(t)}break;case"newMatrix":console.log("TODO")}s.controlHandler(g,a),u&&"function"==typeof u&&u()}},matrixCalculation:function(t,l,o={}){if(!t||["plus","minus","multiply","divided","power","root","log"].indexOf(t)<0)return i.info("The type parameter is invalid.","");if(!fe(l))return i.info("The number parameter is invalid.","");let a=e.luckysheet_select_save[0],{range:u=a,success:c}={...o};if(u instanceof Array&&u.length>1)return void i.info(n().drag.noMulti,"");u&&"string"==typeof u&&r.iscelldata(u)&&(u=r.getcellrange(u));let f=te(u);if(0==f.length)return;let d=[];for(let e=0;e<f.length;e++){let n=[];for(let r=0;r<f[0].length;r++){let o="";null!=f[e]&&null!=f[e][r]&&(o=f[e][r],null!=parseInt(o)&&void 0!=f[e][r].ct&&"n"==f[e][r].ct.t&&("minus"==t?o.v=o.v-l:"multiply"==t?o.v=o.v*l:"divided"==t?o.v=numFormat(o.v/l,4):"power"==t?o.v=Math.pow(o.v,l):"root"==t?2==l?o.v=numFormat(Math.sqrt(o.v),4):3==l&&Math.cbrt?o.v=numFormat(Math.cbrt(o.v),4):o.v=numFormat(jfnqrt(o.v,l),4):o.v="log"==t?numFormat(1e4*Math.log(o.v)/Math.log(Math.abs(l)),4):o.v+l,null==o.v?o.m="":o.m=o.v.toString())),n.push(o)}d.push(n)}s.controlHandler(d,u),c&&"function"==typeof c&&c()},setSheetAdd:function(t={}){let l=e.luckysheetfile.length-1,{sheetObject:n={},order:r=l,success:o}={...t};if(!fe(r))return i.info("Parameter is not a table index","");r=Number(r);let a=R.generateRandomSheetIndex();n.calcChain&&n.calcChain.length>0&&n.calcChain.forEach(e=>{e.index=a});let s=R.generateRandomSheetName(e.luckysheetfile,!1);if(n.name){let t=!1;for(let l=0;l<e.luckysheetfile.length;l++)if(e.luckysheetfile[l].name==n.name){t=!0;break}t||(s=n.name)}$("#luckysheet-sheet-container-c").append(V(ke,{index:a,active:"",name:s,style:"",colorset:""}));let u={name:"",color:"",status:"0",order:"",index:"",celldata:[],row:e.defaultrowNum,column:e.defaultcolumnNum,config:{},pivotTable:null,isPivotTable:!1};if((u=$.extend(!0,u,n)).index=a,u.name=s,u.order=r,r<=0){let t=e.luckysheetfile[0].index,l=$("#luckysheet-sheets-item"+t);$("#luckysheet-sheets-item"+a).insertBefore(l),e.luckysheetfile.splice(0,0,u)}else{r>e.luckysheetfile.length&&(r=e.luckysheetfile.length);let t=e.luckysheetfile[r-1].index,l=$("#luckysheet-sheets-item"+t);$("#luckysheet-sheets-item"+a).insertAfter(l),e.luckysheetfile.splice(r,0,u)}let f={};if(e.luckysheetfile.forEach((e,t,l)=>{l[t].order=t,f[e.index.toString()]=t}),$("#luckysheet-sheet-area div.luckysheet-sheets-item").removeClass("luckysheet-sheets-item-active"),$("#luckysheet-sheets-item"+a).addClass("luckysheet-sheets-item-active"),$("#luckysheet-cell-main").append('<div id="luckysheet-datavisual-selection-set-'+a+'" class="luckysheet-datavisual-selection-set"></div>'),c(!0),e.saveParam("sha",null,$.extend(!0,{},u)),e.saveParam("shr",null,f),e.clearjfundo){e.jfundo.length=0;let t={type:"addSheet"};t.sheetconfig=$.extend(!0,{},u),t.index=a,t.currentSheetIndex=e.currentSheetIndex,e.jfredo.push(t)}e.changeSheet(a,!1,!0),o&&"function"==typeof o&&o()},setSheetDelete:function(t={}){let{order:l=L(e.currentSheetIndex),success:r}={...t},o=e.luckysheetfile[l];return null==o?i.info("The order parameter is invalid.",""):1===e.luckysheetfile.length?i.info(n().sheetconfig.noMoreSheet,""):(R.deleteSheet(o.index),setTimeout(()=>{r&&"function"==typeof r&&r()},1),o)},setSheetCopy:function(t={}){let{targetOrder:l,order:n=L(e.currentSheetIndex),success:r}={...t},o=e.luckysheetfile[n];if(null==o)return i.info("The order parameter is invalid.","");if(null==l&&(l=n+1),!fe(l))return i.info("The targetOrder parameter is invalid.","");let a=o.index,s=R.generateRandomSheetIndex(),u=$.extend(!0,{},o);u.order=e.luckysheetfile.length,u.index=s,u.name=R.generateCopySheetName(e.luckysheetfile,u.name);let f="";null!=u.color&&(f='<div class="luckysheet-sheets-item-color" style=" position: absolute; width: 100%; height: 3px; bottom: 0px; left: 0px; background-color: '+u.color+';"></div>');let d=$("#luckysheet-sheets-item"+a);if(fe(l)&&(d=$("#luckysheet-sheets-item"+e.luckysheetfile[l-1].index)),$("#luckysheet-sheet-container-c").append(V(ke,{index:u.index,active:"",name:u.name,order:u.order,style:"",colorset:f})),$("#luckysheet-sheets-item"+u.index).insertAfter(d),e.luckysheetfile.splice(l,0,u),$("#luckysheet-sheet-area div.luckysheet-sheets-item").removeClass("luckysheet-sheets-item-active"),$("#luckysheet-sheets-item"+s).addClass("luckysheet-sheets-item-active"),$("#luckysheet-cell-main").append('<div id="luckysheet-datavisual-selection-set-'+s+'" class="luckysheet-datavisual-selection-set"></div>'),c(!0),e.saveParam("shc",s,{copyindex:a,name:u.name}),e.changeSheet(s),R.reOrderAllSheet(),e.clearjfundo)e.jfredo.push({type:"copySheet",copyindex:a,index:u.index,sheetIndex:u.index});else if(e.jfredo.length>0){let t=e.jfredo[e.jfredo.length-1];"copySheet"==t.type&&(t.index=u.index,t.sheetIndex=u.index)}return setTimeout(()=>{r&&"function"==typeof r&&r()},1),u},setSheetHide:function(t={}){let{order:l=L(e.currentSheetIndex),success:n}={...t},r=e.luckysheetfile[l];return null==r?i.info("The order parameter is invalid.",""):(R.setSheetHide(r.index),setTimeout(()=>{n&&"function"==typeof n&&n()},1),r)},setSheetShow:function(t={}){let{order:l=L(e.currentSheetIndex),success:n}={...t},r=e.luckysheetfile[l];return null==r?i.info("The order parameter is invalid.",""):(R.setSheetShow(r.index),setTimeout(()=>{n&&"function"==typeof n&&n()},1),r)},setSheetActive:function(t,l={}){if(null==t||!fe(t)||null==e.luckysheetfile[t])return i.info("The order parameter is invalid.","");let n=e.luckysheetfile[t],{success:r}={...l};return $("#luckysheet-sheet-area div.luckysheet-sheets-item").removeClass("luckysheet-sheets-item-active"),$("#luckysheet-sheets-item"+n.index).addClass("luckysheet-sheets-item-active"),R.changeSheet(n.index),setTimeout(()=>{r&&"function"==typeof r&&r()},1),b.multipleRangeShow(),n},setSheetName:function(t,l={}){if("string"!=E(t)||0==t.toString().length)return i.info("The name parameter is invalid.","");let{order:n=L(e.currentSheetIndex),success:r}={...l},o=e.luckysheetfile[n];if(null==o)return i.info("The order parameter is invalid.","");let a=o.name;if(o.name=t,$("#luckysheet-sheets-item"+o.index+" .luckysheet-sheets-item-name").text(t),e.saveParam("all",o.index,t,{k:"name"}),e.clearjfundo){let l={type:"sheetName"};l.sheetIndex=o.index,l.oldtxt=a,l.txt=t,e.jfundo.length=0,e.jfredo.push(l)}r&&"function"==typeof r&&r()},setSheetColor:function(t,l={}){if("string"!=E(t)||0==t.toString().length)return i.info("The color parameter is invalid.","");let{order:n=L(e.currentSheetIndex),success:r}={...l},o=e.luckysheetfile[n];if(null==o)return i.info("The order parameter is invalid.","");let a=o.color;if(o.color=t,$("#luckysheet-sheets-item"+o.index).find(".luckysheet-sheets-item-color").remove(),$("#luckysheet-sheets-item"+o.index).append('<div class="luckysheet-sheets-item-color" style=" position: absolute; width: 100%; height: 3px; bottom: 0px; left: 0px; background-color: '+t+';"></div>'),e.saveParam("all",o.index,t,{k:"color"}),e.clearjfundo){let l={type:"sheetColor"};l.sheetIndex=o.index,l.oldcolor=a,l.color=t,e.jfundo.length=0,e.jfredo.push(l)}r&&"function"==typeof r&&r()},setSheetMove:function(t,l={}){if("left"!=t&&"right"!=t&&!fe(t))return i.info("Type parameter not available","");fe(t)&&(t=parseInt(t));let n=L(e.currentSheetIndex),{order:r=n,success:o}={...l},a=e.luckysheetfile[r];if(null==a)return i.info("ncorrect worksheet index","");let s=a.index;if("left"==t){if(0==r)return;let t=e.luckysheetfile[r-1].index;$("#luckysheet-sheets-item"+s).insertBefore($("#luckysheet-sheets-item"+t)),e.luckysheetfile.splice(r,1),e.luckysheetfile.splice(r-1,0,a)}else if("right"==t){if(r==e.luckysheetfile.length-1)return;let t=e.luckysheetfile[r+1].index;$("#luckysheet-sheets-item"+s).insertAfter($("#luckysheet-sheets-item"+t)),e.luckysheetfile.splice(r,1),e.luckysheetfile.splice(r+1,0,a)}else{if(t<0&&(t=0),t>e.luckysheetfile.length-1&&(t=e.luckysheetfile.length-1),t==r)return;if(t<r){let l=e.luckysheetfile[t].index;$("#luckysheet-sheets-item"+s).insertBefore($("#luckysheet-sheets-item"+l))}else{let l=e.luckysheetfile[t].index;$("#luckysheet-sheets-item"+s).insertAfter($("#luckysheet-sheets-item"+l))}e.luckysheetfile.splice(r,1),e.luckysheetfile.splice(t,0,a)}let u={};e.luckysheetfile.forEach((e,t,l)=>{l[t].order=t,u[e.index.toString()]=t}),e.saveParam("shr",null,u),o&&"function"==typeof o&&o()},setSheetOrder:function(t,l={}){if(null==t||0==t.length)return i.info("Type orderList not available","");let n={};t.forEach(e=>{n[e.index.toString()]=e.order}),e.luckysheetfile.sort((e,t)=>{let l=n[e.index.toString()],r=n[t.index.toString()];return null!=l&&null!=r?l-r:null!=l?-1:1});let r={};e.luckysheetfile.forEach((e,t,l)=>{if(l[t].order=t,r[e.index.toString()]=t,t>0){let n=l[t-1].index;$("#luckysheet-sheets-item"+e.index).insertAfter($("#luckysheet-sheets-item"+n))}}),e.saveParam("shr",null,r);let{success:o}={...l};o&&"function"==typeof o&&o()},setSheetZoom:function(t,l={}){if(!fe(t)||t<.1||t>4)return i.info("The zoom parameter is invalid.","");let{order:n=L(e.currentSheetIndex),success:r}={...l},o=e.luckysheetfile[n];if(null==o)return i.info("The order parameter is invalid.","");o.zoomRatio=t,e.saveParam("all",o.index,t,{k:"zoomRatio"}),o.index==e.currentSheetIndex&&(e.zoomRatio=t,Te(),_e()),r&&"function"==typeof r&&r()},showGridLines:function(t={}){let{order:l=L(e.currentSheetIndex),success:n}={...t},r=e.luckysheetfile[l];return null==r?i.info("The order parameter is invalid.",""):(r.showGridLines=!0,r.index==e.currentSheetIndex&&(e.showGridLines=!0,setTimeout(function(){ne()},1)),setTimeout(()=>{n&&"function"==typeof n&&n()},1),r)},hideGridLines:function(t={}){let{order:l=L(e.currentSheetIndex),success:n}={...t},r=e.luckysheetfile[l];return null==r?i.info("The order parameter is invalid.",""):(r.showGridLines=!1,r.index==e.currentSheetIndex&&(e.showGridLines=!1,setTimeout(function(){ne()},1)),setTimeout(()=>{n&&"function"==typeof n&&n()},1),r)},refresh:function(t={}){e.refreshRange();let{success:l}={...t};l&&"function"==typeof l&&l()},scroll:function(t={}){let{scrollLeft:l,scrollTop:n,targetRow:r,targetColumn:o,success:a}={...t};if(null!=l){if(!fe(l))return i.info("The scrollLeft parameter is invalid.","");$("#luckysheet-scrollbar-x").scrollLeft(l)}else if(null!=o){if(!fe(o))return i.info("The targetColumn parameter is invalid.","");e.visibledatacolumn[o];let t=o<=0?0:e.visibledatacolumn[o-1];$("#luckysheet-scrollbar-x").scrollLeft(t)}if(null!=n){if(!fe(n))return i.info("The scrollTop parameter is invalid.","");$("#luckysheet-scrollbar-y").scrollTop(n)}else if(null!=r){if(!fe(r))return i.info("The targetRow parameter is invalid.","");e.visibledatarow[r];let t=r<=0?0:e.visibledatarow[r-1];$("#luckysheet-scrollbar-y").scrollTop(t)}a&&"function"==typeof a&&a()},resize:function(e={}){C();let{success:t}={...e};t&&"function"==typeof t&&t()},getScreenshot:function(t={}){let{range:l=e.luckysheet_select_save[e.luckysheet_select_save.length-1]}={...t};if("string"==E(l)){if(!r.iscelldata(l))return i.info("The range parameter is invalid.","");let e=r.getcellrange(l);l={row:e.row,column:e.column}}if("object"!=E(l)||null==l.row||null==l.column)return i.info("The range parameter is invalid.","");let n=l.row[0],o=l.row[1],a=l.column[0],s=l.column[1];if(de(e.config,n,o,a,s))return i.info("Cannot perform this operation on partially merged cells","");let u,c,f,d,h=e.visibledatarow,g=e.visibledatacolumn;n-1<0?(u=0,c=h[o]):(u=h[n-1],c=h[o]-h[n-1]),a-1<0?(f=0,d=g[s]):(f=g[a-1],d=g[s]-g[a-1]);let m=$("<canvas>").attr({width:Math.ceil(d*e.devicePixelRatio),height:Math.ceil(c*e.devicePixelRatio)}).css({width:d,height:c});ye(f,u,d,c,1,1,null,null,m);let p=m.get(0).getContext("2d");return p.beginPath(),p.moveTo(0,0),p.lineTo(0,e.devicePixelRatio*c),p.lineWidth=2*e.devicePixelRatio,p.strokeStyle=be.strokeStyle,p.stroke(),p.closePath(),p.beginPath(),p.moveTo(0,0),p.lineTo(e.devicePixelRatio*d,0),p.lineWidth=2*e.devicePixelRatio,p.strokeStyle=be.strokeStyle,p.stroke(),p.closePath(),m.get(0).toDataURL("image/png")},setWorkbookName:function(e,t={}){if(null==e||0==e.toString().length)return i.info("The name parameter is invalid.","");$("#luckysheet_info_detail_input").val(e);let{success:l}={...t};l&&"function"==typeof l&&l()},getWorkbookName:function(e={}){let t="",l=$("#luckysheet_info_detail_input");if(0==l.length)return i.info("Failed to get workbook name, label loading failed!"),t;t=$.trim(l.val());let{success:n}={...e};return setTimeout(()=>{n&&"function"==typeof n&&n()},1),t},undo:function(t={}){let l=$.extend(!0,{},e.jfredo[e.jfredo.length-1]);H.redo(new Event("custom")),G();let{success:n}={...t};return setTimeout(()=>{n&&"function"==typeof n&&n()},1),l},redo:function(t={}){let l=$.extend(!0,{},e.jfundo[e.jfundo.length-1]);H.undo(new Event("custom")),G();let{success:n}={...t};return setTimeout(()=>{n&&"function"==typeof n&&n()},1),l},getAllSheets:function(){return e.getAllSheets()},getSheet:function(t={}){let{index:l,order:n,name:r}={...t};return null!=l?R.getSheetByIndex(l):null!=n?e.luckysheetfile[n]:null!=r?R.getSheetByName(r):R.getSheetByIndex()},getSheetData:function(t={}){let{order:l=L(e.currentSheetIndex)}={...t},n=e.luckysheetfile[l];if(null==n)return i.info("The order parameter is invalid.","");let r=$.extend(!0,[],n.data);return null!=r&&0!=r.length||(r=$.extend(!0,[],R.buildGridData(n))),r},getConfig:function(t={}){let{order:l=L(e.currentSheetIndex)}={...t},n=e.luckysheetfile[l];return null==n?i.info("The order parameter is invalid.",""):$.extend(!0,{},n.config)},setConfig:function(t,l={}){if("object"!=E(t))return i.info("The cfg parameter is invalid.","");let{order:n=L(e.currentSheetIndex),success:r}={...l},o=e.luckysheetfile[n];if(null==o)return i.info("The order parameter is invalid.","");o.config=t,o.index==e.currentSheetIndex&&(e.config=t,("rowhidden"in t||"colhidden"in t||"rowlen"in t||"columnlen"in t)&&e.refreshGrid_rhcw(e.flowdata.length,e.flowdata[0].length),e.refresh()),r&&"function"==typeof r&&r()},getLuckysheetfile:function(){return Y()},setDataVerification:function(t,l={}){if("object"!=E(t))return i.info("The optionItem parameter is invalid.","");let{type:o,type2:a=null,value1:s="",value2:u="",remote:c=!1,prohibitInput:f=!1,hintShow:d=!1,hintText:h="",checked:g=!1}={...t},m=["bw","nb","eq","ne","gt","lt","gte","lte"],p=["include","exclude","equal"],y=["bw","nb","eq","ne","bf","nbf","af","naf"],v=["card","phone"];if(!["dropdown","checkbox","number","number_integer","number_decimal","text_content","text_length","date","validity"].includes(o))return i.info("The optionItem.type parameter is invalid.","");let w=n().dataVerification;if("dropdown"==o){if(0==s.length)return void i.info('<i class="fa fa-exclamation-triangle"></i>',w.tooltipInfo1)}else if("checkbox"==o){if(0==s.length||0==u.length)return void i.info('<i class="fa fa-exclamation-triangle"></i>',w.tooltipInfo2)}else if("number"==o||"number_integer"==o||"number_decimal"==o){if(!m.includes(a))return i.info("The optionItem.type2 parameter is invalid.","");if(!fe(s))return void i.info('<i class="fa fa-exclamation-triangle"></i>',w.tooltipInfo3);if("bw"==a||"nb"==a){if(!fe(u))return void i.info('<i class="fa fa-exclamation-triangle"></i>',w.tooltipInfo3);if(Number(u)<Number(s))return void i.info('<i class="fa fa-exclamation-triangle"></i>',w.tooltipInfo4)}}else if("text_content"==o){if(!p.includes(a))return i.info("The optionItem.type2 parameter is invalid.","");if(0==s.length)return void i.info('<i class="fa fa-exclamation-triangle"></i>',w.tooltipInfo5)}else if("text_length"==o){if(!m.includes(a))return i.info("The optionItem.type2 parameter is invalid.","");if(!fe(s))return void i.info('<i class="fa fa-exclamation-triangle"></i>',w.tooltipInfo3);if("bw"==a||"nb"==a){if(!fe(u))return void i.info('<i class="fa fa-exclamation-triangle"></i>',w.tooltipInfo3);if(Number(u)<Number(s))return void i.info('<i class="fa fa-exclamation-triangle"></i>',w.tooltipInfo4)}}else if("date"==o){if(!y.includes(a))return i.info("The optionItem.type2 parameter is invalid.","");if(!ge(s))return void i.info('<i class="fa fa-exclamation-triangle"></i>',w.tooltipInfo6);if("bw"==a||"nb"==a){if(!ge(u))return void i.info('<i class="fa fa-exclamation-triangle"></i>',w.tooltipInfo6);if(me(s,u)>0)return void i.info('<i class="fa fa-exclamation-triangle"></i>',w.tooltipInfo7)}}else if("validity"==o&&!v.includes(a))return i.info("The optionItem.type2 parameter is invalid.","");if("boolean"!=E(c))return i.info("The optionItem.remote parameter is invalid.","");if("boolean"!=E(f))return i.info("The optionItem.prohibitInput parameter is invalid.","");if("boolean"!=E(d))return i.info("The optionItem.hintShow parameter is invalid.","");let{range:x=e.luckysheet_select_save[e.luckysheet_select_save.length-1],order:k=L(e.currentSheetIndex),success:b}={...l};if("string"==E(x)){if(!r.iscelldata(x))return i.info("The range parameter is invalid.","");let e=r.getcellrange(x);x={row:e.row,column:e.column}}if("object"!=E(x)||null==x.row||null==x.column)return i.info("The range parameter is invalid.","");let S=e.luckysheetfile[k];if(null==S)return i.info("The order parameter is invalid.","");let _={type:o,type2:a,value1:s,value2:u,checked:g,remote:c,prohibitInput:f,hintShow:d,hintText:h},T=$.extend(!0,{},S.dataVerification),I=$.extend(!0,[],S.data);0==I.length&&(I=R.buildGridData(S));let C=x.row[0],M=x.row[1],z=x.column[0],j=x.column[1];for(let e=C;e<=M;e++)for(let t=z;t<=j;t++)T[e+"_"+t]=_,"checkbox"==o&&K(e,t,I,_.checked?_.value1:_.value2);if(S.index==e.currentSheetIndex){let t=$.extend(!0,{},S.dataVerification);"checkbox"==o?B.refOfCheckbox(t,T,e.currentSheetIndex,I,x):B.ref(t,T,e.currentSheetIndex)}else S.dataVerification=T,S.data=I;b&&"function"==typeof b&&b()},deleteDataVerification:function(t={}){let{range:l=e.luckysheet_select_save[e.luckysheet_select_save.length-1],order:n=L(e.currentSheetIndex),success:o}={...t};if("string"==E(l)){if(!r.iscelldata(l))return i.info("The range parameter is invalid.","");let e=r.getcellrange(l);l={row:e.row,column:e.column}}if("object"!=E(l)||null==l.row||null==l.column)return i.info("The range parameter is invalid.","");let a=e.luckysheetfile[n];if(null==a)return i.info("The order parameter is invalid.","");let s=$.extend(!0,{},a.dataVerification),u=l.row[0],c=l.row[1],f=l.column[0],d=l.column[1];for(let e=u;e<=c;e++)for(let t=f;t<=d;t++)delete s[e+"_"+t];if(a.index==e.currentSheetIndex){let t=$.extend(!0,{},a.dataVerification);B.ref(t,s,e.currentSheetIndex)}else a.dataVerification=s;o&&"function"==typeof o&&o()},insertImage:function(t,l={}){let{order:n=L(e.currentSheetIndex),rowIndex:r,colIndex:o,success:a}={...l},s=e.luckysheetfile[n];if(null==s)return i.info("The order parameter is invalid.","");if(s.index==e.currentSheetIndex){let l=e.luckysheet_select_save[e.luckysheet_select_save.length-1];null==r&&(r=l.row_focus||0),r<0&&(r=0),r>e.visibledatarow.length&&(r=e.visibledatarow.length),null==o&&(o=l.column_focus||0),o<0&&(o=0),o>e.visibledatacolumn.length&&(o=e.visibledatacolumn.length);let n=0==o?0:e.visibledatacolumn[o-1],i=0==r?0:e.visibledatarow[r-1],s=new Image;s.onload=function(){let e=s.width,l=s.height,r={src:t,left:n,top:i,originWidth:e,originHeight:l};O.addImgItem(r),a&&"function"==typeof a&&a()},s.src=t}else{let l=s.images||{},n=s.config,i=s.zoomRatio||1,u=s.row,c=s.visibledatarow||[];if(0===c.length){let t=0;for(let l=0;l<u;l++){let r=e.defaultrowlen;null!=n.rowlen&&null!=n.rowlen[l]&&(r=n.rowlen[l]),null==n.rowhidden||null==n.rowhidden[l]?(t+=Math.round((r+1)*i),c.push(t)):c.push(t)}}let f=s.column,d=s.visibledatacolumn||[];if(0===d.length){let t=0;for(let l=0;l<f;l++){let r=e.defaultcollen;null!=n.columnlen&&null!=n.columnlen[l]&&(r=n.columnlen[l]),null==n.colhidden||null==n.colhidden[l]?(t+=Math.round((r+1)*i),d.push(t)):d.push(t)}}null==r&&(r=0),r<0&&(r=0),r>c.length&&(r=c.length),null==o&&(o=0),o<0&&(o=0),o>d.length&&(o=d.length);let h=0==o?0:d[o-1],g=0==r?0:c[r-1],m=new Image;m.onload=function(){let e,n,r={src:t,left:h,top:g,originWidth:m.width,originHeight:m.height};r.originHeight<r.originWidth?(n=Math.round(r.originHeight*(400/r.originWidth)),e=400):(e=Math.round(r.originWidth*(400/r.originHeight)),n=400);let o=$.extend(!0,{},O.imgItem);o.src=r.src,o.originWidth=r.originWidth,o.originHeight=r.originHeight,o.default.width=e,o.default.height=n,o.default.left=r.left,o.default.top=r.top,o.crop.width=e,o.crop.height=n;let i=O.generateRandomId();l[i]=o,s.images=l,a&&"function"==typeof a&&a()},m.src=t}},deleteImage:function(t={}){let{order:l=L(e.currentSheetIndex),idList:n="all",success:r}={...t},o=e.luckysheetfile[l];if(null==o)return i.info("The order parameter is invalid.","");let a=o.images;return null==a?i.info("The worksheet has no pictures to delete.",""):"all"!=n&&"array"!=E(n)?i.info("The idList parameter is invalid.",""):("array"==E(n)?n.forEach(e=>{delete a[e]}):a=null,o.images=a,o.index==e.currentSheetIndex&&(null==O.currentImgId||"all"!=n&&!n.includes(O.currentImgId)||($("#luckysheet-modal-dialog-activeImage").hide(),$("#luckysheet-modal-dialog-cropping").hide(),$("#luckysheet-modal-dialog-slider-imageCtrl").hide()),O.images=a,O.allImagesShow(),O.init()),void(r&&"function"==typeof r&&r()))},getImageOption:function(t={}){let{order:l=L(e.currentSheetIndex),success:n}={...t},r=e.luckysheetfile[l];return null==r?i.info("The order parameter is invalid.",""):(setTimeout(function(){n&&"function"==typeof n&&n()},1),r.images)},transToCellData:function(e,t={}){let{success:l}={...t};return setTimeout(()=>{l&&"function"==typeof l&&l()},0),R.getGridData(e)},transToData:function(e,t={}){let{success:l}={...t};return setTimeout(()=>{l&&"function"==typeof l&&l()},0),R.buildGridData({celldata:e})},toJson:Ee,changLang:function(e="zh"){if(!["zh","en","es"].includes(e))return i.info("The lang parameter is invalid.","");let t=Ee();t.lang=e,luckysheet.create(t)},closeWebsocket:function(){null!=e.websocket&&e.websocket.close(1e3)},getRangeByTxt:function(t){if(null==t)return{column:e.luckysheet_select_save[e.luckysheet_select_save.length-1].column,row:e.luckysheet_select_save[e.luckysheet_select_save.length-1].row};const l=M.getRangeByTxt(t);return{column:l[0].column,row:l[0].row}},getTxtByRange:function(t=e.luckysheet_select_save){return"object"===E(t)&&(t=[t]),M.getTxtByRange(t)},refreshFormula:function(e){r.execFunctionGroupForce(!0),ne(),setTimeout(()=>{e&&"function"==typeof e&&e()})},refreshMenuButtonFocus:function(t,l,n,r){if(t=t||e.flowdata,null==l&&null==n){let t=e.luckysheet_select_save[e.luckysheet_select_save.length-1];l=t.row_focus||t.row[0],n=t.column_focus||t.column[0]}S.menuButtonFocus(t,l,n),setTimeout(()=>{r&&"function"==typeof r&&r()})}}});
//# sourceMappingURL=../sourcemaps/global/api.js.map
