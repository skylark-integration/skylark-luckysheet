{"version":3,"sources":["controllers/keyboard.js"],"names":["define","luckysheetConfigsetting","menuButton","conditionformat","m_updateCell","m_constant","m_sheetMove","m_select","selection","searchReplace","controlHistory","imageCtrl","m_util","m_get","m_validate","m_cursorPos","formula","cleargridelement","tooltip","locale","m_inlineString","Store","luckysheetupdateCell","setCenterInputPosition","keycode","luckysheetMoveHighlightCell","luckysheetMoveHighlightCell2","luckysheetMoveHighlightRange","luckysheetMoveHighlightRange2","selectHightlightShow","selectIsOverlap","getByteLen","getNowDateTime","luckysheetactiveCell","getSheetIndex","hasPartMC","isEditMode","luckysheetRangeLast","enterKeyControll","luckysheet_shiftkeydown","formulaMoveEvent","dir","ctrlKey","shiftKey","event","$","is","dir_n","step","preventDefault","israngeseleciton","anchor","window","getSelection","anchorNode","parent","next","text","vText","range","getcellrange","r1","r2","c1","c2","row","visibledatarow","row_pre","col","visibledatacolumn","col_pre","func_selectedrange","left","width","top","height","left_move","width_move","top_move","height_move","column","row_focus","column_focus","rangeSetValue","rangestart","rangedrag_column_start","rangedrag_row_start","anchorOffset","length","updatecell","luckysheetCellUpdate","context","childElementCount","prev","rangeHightlightselected","$obj","find","first","last","removeClass","addClass","keyboardInitial","locale_drag","drag","click","add","container","on","altKey","kcode","keyCode","target","hasClass","parseInt","css","closest","ENTER","TAB","UP","DOWN","LEFT","RIGHT","helpboxValue","iscelldata","cellrange","luckysheet_select_save","blur","scrollLeft","scrollTop","winH","winW","$inputbox","metaKey","row_index","col_index","flowdata","searchFunctionCell","searchFunctionEnter","hide","F2","F4","setfreezonFuc","ESC","dontupdate","String","fromCharCode","luckysheet_shiftpositon","extend","value","html","functionInputHanddler","currentImgId","copyImgItem","luckysheetPaintModelOn","cancelPaintModel","config","has_PartMC","s","alert","noMerge","info","cdformat","luckysheetfile","currentSheetIndex","luckysheet_conditionformat_save","hasCF","cf_compute","getComputeMap","label","r","c","checksCF","noMulti","isSameRow","str_r","end_r","isSameCol","str_c","end_c","copy","luckysheet_paste_iscut","stopPropagation","createDialog","init","focus","noPaste","isPasteAction","editMode","_locale_drag","redo","undo","toLocaleUpperCase","DELETE","BACKSPACE","removeImgItem","luckysheet_cell_selected_move","luckysheet_cell_selected_extend","CAPSLOCK","WIN","keydown","WIN_R","MENU","keyup","e","val","title","$t","this","change","bind","inputlen","updatelen","outerWidth","savelen","userlen","minuslen","saveParam","element","trigger"],"mappings":"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","file":"../../controllers/keyboard.js","sourcesContent":["define([\n    '../methods/luckysheetConfigsetting',\n    './menuButton',\n    './conditionformat',\n    './updateCell',\n    '../widgets/constant',\n    './sheetMove',\n    '../widgets/select',\n    './selection',\n    './searchReplace',\n    './controlHistory',\n    '../widgets/imageCtrl',\n    '../utils/util',\n    '../methods/get',\n    '../methods/validate',\n    '../widgets/cursorPos',\n    './formula',\n    '../widgets/cleargridelement',\n    '../widgets/tooltip',\n    '../locale/locale',\n    './inlineString',\n    '../store'\n], function (luckysheetConfigsetting, menuButton, conditionformat, m_updateCell, m_constant, m_sheetMove, m_select, selection, searchReplace, controlHistory, imageCtrl, m_util, m_get, m_validate, m_cursorPos, formula, cleargridelement, tooltip, locale, m_inlineString, Store) {\n    'use strict';\n    const {luckysheetupdateCell, setCenterInputPosition} = m_updateCell;\n    const {keycode} = m_constant;\n    const {luckysheetMoveHighlightCell, luckysheetMoveHighlightCell2, luckysheetMoveHighlightRange, luckysheetMoveHighlightRange2} = m_sheetMove;\n    const {selectHightlightShow, selectIsOverlap} = m_select;\n    const {getByteLen, getNowDateTime, luckysheetactiveCell} = m_util;\n    const {getSheetIndex} = m_get;\n    const {hasPartMC} = m_validate;\n    const isEditMode = luckysheetConfigsetting.isEditMode;\n    const {luckysheetRangeLast} = m_cursorPos;\n    const {enterKeyControll} = m_inlineString;\n    let luckysheet_shiftkeydown = false;\n    function formulaMoveEvent(dir, ctrlKey, shiftKey, event) {\n        if ($('#luckysheet-formula-search-c').is(':visible') && (dir == 'up' || dir == 'down')) {\n            let $obj;\n            if (dir == 'down') {\n                $obj = $('#luckysheet-formula-search-c').find('.luckysheet-formula-search-item-active').next();\n                if ($obj.length == 0) {\n                    $obj = $('#luckysheet-formula-search-c').find('.luckysheet-formula-search-item').first();\n                }\n            } else if (dir == 'up') {\n                $obj = $('#luckysheet-formula-search-c').find('.luckysheet-formula-search-item-active').prev();\n                if ($obj.length == 0) {\n                    $obj = $('#luckysheet-formula-search-c').find('.luckysheet-formula-search-item').last();\n                }\n            }\n            $('#luckysheet-formula-search-c').find('.luckysheet-formula-search-item').removeClass('luckysheet-formula-search-item-active');\n            $obj.addClass('luckysheet-formula-search-item-active');\n            event.preventDefault();\n        } else {\n            if ($('#luckysheet-formula-functionrange-select').is(':visible')) {\n                if (ctrlKey && shiftKey) {\n                    luckysheetMoveHighlightRange2(dir, 'rangeOfFormula');\n                } else if (ctrlKey) {\n                    luckysheetMoveHighlightCell2(dir, 'rangeOfFormula');\n                } else if (shiftKey) {\n                    let dir_n = dir, step = 1;\n                    if (dir == 'up') {\n                        dir_n = 'down';\n                        step = -1;\n                    }\n                    if (dir == 'left') {\n                        dir_n = 'right';\n                        step = -1;\n                    }\n                    luckysheetMoveHighlightRange(dir_n, step, 'rangeOfFormula');\n                } else {\n                    let dir_n = dir, step = 1;\n                    if (dir == 'up') {\n                        dir_n = 'down';\n                        step = -1;\n                    }\n                    if (dir == 'left') {\n                        dir_n = 'right';\n                        step = -1;\n                    }\n                    luckysheetMoveHighlightCell(dir_n, step, 'rangeOfFormula');\n                }\n                event.preventDefault();\n            } else if (formula.israngeseleciton()) {\n                let anchor = $(window.getSelection().anchorNode);    // console.log(anchor.parent().next().text());\n                // console.log(anchor.parent().next().text());\n                if (anchor.parent().next().text() == null || anchor.parent().next().text() == '') {\n                    let vText = $('#luckysheet-input-box #luckysheet-input-box-index').text();\n                    let range = formula.getcellrange(vText);\n                    if (range == null) {\n                        range = formula.getcellrange($('#luckysheet-input-box-index').text());\n                    }\n                    let r1 = range['row'][0], r2 = range['row'][1];\n                    let c1 = range['column'][0], c2 = range['column'][1];\n                    let row = Store.visibledatarow[r2], row_pre = r1 - 1 == -1 ? 0 : Store.visibledatarow[r1 - 1];\n                    let col = Store.visibledatacolumn[c2], col_pre = c1 - 1 == -1 ? 0 : Store.visibledatacolumn[c1 - 1];\n                    formula.func_selectedrange = {\n                        'left': col_pre,\n                        'width': col - col_pre - 1,\n                        'top': row_pre,\n                        'height': row - row_pre - 1,\n                        'left_move': col_pre,\n                        'width_move': col - col_pre - 1,\n                        'top_move': row_pre,\n                        'height_move': row - row_pre - 1,\n                        'row': [\n                            r1,\n                            r2\n                        ],\n                        'column': [\n                            c1,\n                            c2\n                        ],\n                        'row_focus': r1,\n                        'column_focus': c1\n                    };\n                    formula.rangeSetValue({\n                        'row': [\n                            r1,\n                            r2\n                        ],\n                        'column': [\n                            c1,\n                            c2\n                        ]\n                    });\n                    formula.rangestart = true;\n                    formula.rangedrag_column_start = false;\n                    formula.rangedrag_row_start = false;\n                    if (ctrlKey && shiftKey) {\n                        luckysheetMoveHighlightRange2(dir, 'rangeOfFormula');\n                    } else if (ctrlKey) {\n                        luckysheetMoveHighlightCell2(dir, 'rangeOfFormula');\n                    } else if (shiftKey) {\n                        let dir_n = dir, step = 1;\n                        if (dir == 'up') {\n                            dir_n = 'down';\n                            step = -1;\n                        }\n                        if (dir == 'left') {\n                            dir_n = 'right';\n                            step = -1;\n                        }\n                        luckysheetMoveHighlightRange(dir_n, step, 'rangeOfFormula');\n                    } else {\n                        let dir_n = dir, step = 1;\n                        if (dir == 'up') {\n                            dir_n = 'down';\n                            step = -1;\n                        }\n                        if (dir == 'left') {\n                            dir_n = 'right';\n                            step = -1;\n                        }\n                        luckysheetMoveHighlightCell(dir_n, step, 'rangeOfFormula');\n                    }\n                    event.preventDefault();\n                }\n            } else if (!ctrlKey && !shiftKey) {\n                let anchor = $(window.getSelection().anchorNode);\n                let anchorOffset = window.getSelection().anchorOffset;\n                if (dir == 'up') {\n                    if (anchor.parent().is('span') && anchor.parent().next().length == 0 && anchorOffset > 0) {\n                        formula.updatecell(Store.luckysheetCellUpdate[0], Store.luckysheetCellUpdate[1]);\n                        luckysheetMoveHighlightCell('down', -1, 'rangeOfSelect');\n                        event.preventDefault();\n                    } else if (anchor.is('#luckysheet-rich-text-editor') && anchor.context.childElementCount == anchorOffset) {\n                        formula.updatecell(Store.luckysheetCellUpdate[0], Store.luckysheetCellUpdate[1]);\n                        luckysheetMoveHighlightCell('down', -1, 'rangeOfSelect');\n                        event.preventDefault();\n                    } else if (anchor.parent().is('#luckysheet-rich-text-editor') && anchor.context.length == anchorOffset) {\n                        formula.updatecell(Store.luckysheetCellUpdate[0], Store.luckysheetCellUpdate[1]);\n                        luckysheetMoveHighlightCell('down', -1, 'rangeOfSelect');\n                        event.preventDefault();\n                    }\n                } else if (dir == 'down') {\n                    if (anchor.parent().is('span') && anchor.parent().next().length == 0 && anchorOffset > 0) {\n                        formula.updatecell(Store.luckysheetCellUpdate[0], Store.luckysheetCellUpdate[1]);\n                        luckysheetMoveHighlightCell('down', 1, 'rangeOfSelect');\n                        event.preventDefault();\n                    } else if (anchor.is('#luckysheet-rich-text-editor') && anchor.context.childElementCount == anchorOffset) {\n                        formula.updatecell(Store.luckysheetCellUpdate[0], Store.luckysheetCellUpdate[1]);\n                        luckysheetMoveHighlightCell('down', 1, 'rangeOfSelect');\n                        event.preventDefault();\n                    } else if (anchor.parent().is('#luckysheet-rich-text-editor') && anchor.context.length == anchorOffset) {\n                        formula.updatecell(Store.luckysheetCellUpdate[0], Store.luckysheetCellUpdate[1]);\n                        luckysheetMoveHighlightCell('down', 1, 'rangeOfSelect');\n                        event.preventDefault();\n                    }\n                } else if (dir == 'left') {\n                    if (anchor.parent().is('span') && anchor.parent().prev().length == 0 && anchorOffset == 0) {\n                        formula.updatecell(Store.luckysheetCellUpdate[0], Store.luckysheetCellUpdate[1]);\n                        luckysheetMoveHighlightCell('right', -1, 'rangeOfSelect');\n                        event.preventDefault();\n                    } else if (anchor.is('#luckysheet-rich-text-editor') && anchorOffset == 1) {\n                        formula.updatecell(Store.luckysheetCellUpdate[0], Store.luckysheetCellUpdate[1]);\n                        luckysheetMoveHighlightCell('right', -1, 'rangeOfSelect');\n                        event.preventDefault();\n                    } else if (anchor.parent().is('#luckysheet-rich-text-editor') && anchorOffset == 0) {\n                        formula.updatecell(Store.luckysheetCellUpdate[0], Store.luckysheetCellUpdate[1]);\n                        luckysheetMoveHighlightCell('right', -1, 'rangeOfSelect');\n                        event.preventDefault();\n                    } else {\n                        formula.rangeHightlightselected($('#luckysheet-rich-text-editor'));\n                    }\n                } else if (dir == 'right') {\n                    if (anchor.parent().is('span') && anchor.parent().next().length == 0 && anchorOffset > 0) {\n                        formula.updatecell(Store.luckysheetCellUpdate[0], Store.luckysheetCellUpdate[1]);\n                        luckysheetMoveHighlightCell('right', 1, 'rangeOfSelect');\n                        event.preventDefault();\n                    } else if (anchor.is('#luckysheet-rich-text-editor') && anchor.context.childElementCount == anchorOffset) {\n                        formula.updatecell(Store.luckysheetCellUpdate[0], Store.luckysheetCellUpdate[1]);\n                        luckysheetMoveHighlightCell('right', 1, 'rangeOfSelect');\n                        event.preventDefault();\n                    } else if (anchor.parent().is('#luckysheet-rich-text-editor') && anchor.context.length == anchorOffset) {\n                        formula.updatecell(Store.luckysheetCellUpdate[0], Store.luckysheetCellUpdate[1]);\n                        luckysheetMoveHighlightCell('right', 1, 'rangeOfSelect');\n                        event.preventDefault();\n                    } else {\n                        formula.rangeHightlightselected($('#luckysheet-rich-text-editor'));\n                    }\n                }\n            }\n        }\n    }\n    function keyboardInitial() {\n        const _locale = locale();\n        const locale_drag = _locale.drag;    //单元格编辑输入\n        //单元格编辑输入\n        $('#luckysheet-input-box').click(function () {\n            formula.rangeHightlightselected($('#luckysheet-rich-text-editor'));\n        }).add('#' + Store.container).on('keydown', function (event) {\n            let ctrlKey = event.ctrlKey;\n            let altKey = event.altKey;\n            let shiftKey = event.shiftKey;\n            let kcode = event.keyCode;\n            if ($('#luckysheet-modal-dialog-mask').is(':visible') || $(event.target).hasClass('luckysheet-mousedown-cancel') || $(event.target).hasClass('sp-input') || parseInt($('#luckysheet-input-box').css('top')) > 0 && $(event.target).closest('.luckysheet-input-box').length > 0 && kcode != keycode.ENTER && kcode != keycode.TAB && kcode != keycode.UP && kcode != keycode.DOWN && kcode != keycode.LEFT && kcode != keycode.RIGHT) {\n                let anchor = $(window.getSelection().anchorNode);\n                if (anchor.parent().is('#luckysheet-helpbox-cell') || anchor.is('#luckysheet-helpbox-cell')) {\n                    if (kcode == keycode.ENTER) {\n                        let helpboxValue = $('#luckysheet-helpbox-cell').text();\n                        if (formula.iscelldata(helpboxValue)) {\n                            let cellrange = formula.getcellrange(helpboxValue);\n                            Store.luckysheet_select_save = [{\n                                    'row': cellrange['row'],\n                                    'column': cellrange['column'],\n                                    'row_focus': cellrange['row'][0],\n                                    'column_focus': cellrange['column'][0]\n                                }];\n                            selectHightlightShow();\n                            $('#luckysheet-helpbox-cell').blur();\n                            let scrollLeft = $('#luckysheet-cell-main').scrollLeft(), scrollTop = $('#luckysheet-cell-main').scrollTop();\n                            let winH = $('#luckysheet-cell-main').height(), winW = $('#luckysheet-cell-main').width();\n                            let row = Store.visibledatarow[cellrange['row'][1]], row_pre = cellrange['row'][0] - 1 == -1 ? 0 : Store.visibledatarow[cellrange['row'][0] - 1];\n                            let col = Store.visibledatacolumn[cellrange['column'][1]], col_pre = cellrange['column'][0] - 1 == -1 ? 0 : Store.visibledatacolumn[cellrange['column'][0] - 1];\n                            if (col - scrollLeft - winW + 20 > 0) {\n                                $('#luckysheet-scrollbar-x').scrollLeft(col - winW + 20);\n                            } else if (col_pre - scrollLeft - 20 < 0) {\n                                $('#luckysheet-scrollbar-x').scrollLeft(col_pre - 20);\n                            }\n                            if (row - scrollTop - winH + 20 > 0) {\n                                $('#luckysheet-scrollbar-y').scrollTop(row - winH + 20);\n                            } else if (row_pre - scrollTop - 20 < 0) {\n                                $('#luckysheet-scrollbar-y').scrollTop(row_pre - 20);\n                            }\n                        }\n                    }\n                }\n                return;\n            }\n            if ($('#luckysheet-modal-dialog-mask').is(':visible') || $(event.target).hasClass('luckysheet-mousedown-cancel') || $(event.target).hasClass('formulaInputFocus')) {\n                return;\n            }\n            let $inputbox = $('#luckysheet-input-box');\n            if ((altKey || event.metaKey) && kcode == keycode.ENTER && parseInt($inputbox.css('top')) > 0) {\n                let last = Store.luckysheet_select_save[Store.luckysheet_select_save.length - 1];\n                let row_index = last['row_focus'], col_index = last['column_focus'];\n                enterKeyControll(Store.flowdata[row_index][col_index]);\n                event.preventDefault();\n            } else if (kcode == keycode.ENTER && parseInt($inputbox.css('top')) > 0) {\n                if ($('#luckysheet-formula-search-c').is(':visible') && formula.searchFunctionCell != null) {\n                    formula.searchFunctionEnter($('#luckysheet-formula-search-c').find('.luckysheet-formula-search-item-active'));\n                } else {\n                    formula.updatecell(Store.luckysheetCellUpdate[0], Store.luckysheetCellUpdate[1]);\n                    Store.luckysheet_select_save = [{\n                            'row': [\n                                Store.luckysheetCellUpdate[0],\n                                Store.luckysheetCellUpdate[0]\n                            ],\n                            'column': [\n                                Store.luckysheetCellUpdate[1],\n                                Store.luckysheetCellUpdate[1]\n                            ],\n                            'row_focus': Store.luckysheetCellUpdate[0],\n                            'column_focus': Store.luckysheetCellUpdate[1]\n                        }];\n                    luckysheetMoveHighlightCell('down', 1, 'rangeOfSelect');\n                }    //若有参数弹出框，隐藏\n                //若有参数弹出框，隐藏\n                if ($('#luckysheet-search-formula-parm').is(':visible')) {\n                    $('#luckysheet-search-formula-parm').hide();\n                }    //若有参数选取范围弹出框，隐藏\n                //若有参数选取范围弹出框，隐藏\n                if ($('#luckysheet-search-formula-parm-select').is(':visible')) {\n                    $('#luckysheet-search-formula-parm-select').hide();\n                }\n                event.preventDefault();\n            } else if (kcode == keycode.TAB) {\n                if (parseInt($inputbox.css('top')) > 0) {\n                    return;\n                }\n                luckysheetMoveHighlightCell('right', 1, 'rangeOfSelect');\n                event.preventDefault();\n            } else if (kcode == keycode.F2) {\n                if (parseInt($inputbox.css('top')) > 0) {\n                    return;\n                }\n                let last = Store.luckysheet_select_save[Store.luckysheet_select_save.length - 1];\n                let row_index = last['row_focus'], col_index = last['column_focus'];\n                luckysheetupdateCell(row_index, col_index, Store.flowdata);\n                event.preventDefault();\n            } else if (kcode == keycode.F4 && parseInt($inputbox.css('top')) > 0) {\n                formula.setfreezonFuc(event);\n                event.preventDefault();\n            } else if (kcode == keycode.ESC && parseInt($inputbox.css('top')) > 0) {\n                formula.dontupdate();\n                luckysheetMoveHighlightCell('down', 0, 'rangeOfSelect');\n                event.preventDefault();\n            } else if (kcode == keycode.ENTER) {\n                if ($(event.target).hasClass('formulaInputFocus') || $('#luckysheet-conditionformat-dialog').is(':visible')) {\n                    return;\n                } else if (String.fromCharCode(kcode) != null && $('#luckysheet-cell-selected').is(':visible')) {\n                    let last = Store.luckysheet_select_save[Store.luckysheet_select_save.length - 1];\n                    let row_index = last['row_focus'], col_index = last['column_focus'];\n                    luckysheetupdateCell(row_index, col_index, Store.flowdata);\n                    event.preventDefault();\n                }\n            } else {\n                if (ctrlKey || event.metaKey) {\n                    if (shiftKey) {\n                        if (!luckysheet_shiftkeydown) {\n                            Store.luckysheet_shiftpositon = $.extend(true, {}, Store.luckysheet_select_save[Store.luckysheet_select_save.length - 1]);\n                            Store.luckysheet_shiftkeydown = true;\n                        }    //Ctrl + shift + 方向键  调整选区\n                        //Ctrl + shift + 方向键  调整选区\n                        if (kcode == keycode.UP) {\n                            if (parseInt($inputbox.css('top')) > 0 || $('#luckysheet-singleRange-dialog').is(':visible') || $('#luckysheet-multiRange-dialog').is(':visible')) {\n                                return;\n                            }\n                            luckysheetMoveHighlightRange2('up', 'rangeOfSelect');\n                        } else if (kcode == keycode.DOWN) {\n                            if (parseInt($inputbox.css('top')) > 0 || $('#luckysheet-singleRange-dialog').is(':visible') || $('#luckysheet-multiRange-dialog').is(':visible')) {\n                                return;\n                            }\n                            luckysheetMoveHighlightRange2('down', 'rangeOfSelect');\n                        } else if (kcode == keycode.LEFT) {\n                            if (parseInt($inputbox.css('top')) > 0 || $('#luckysheet-singleRange-dialog').is(':visible') || $('#luckysheet-multiRange-dialog').is(':visible')) {\n                                return;\n                            }\n                            luckysheetMoveHighlightRange2('left', 'rangeOfSelect');\n                        } else if (kcode == keycode.RIGHT) {\n                            if (parseInt($inputbox.css('top')) > 0 || $('#luckysheet-singleRange-dialog').is(':visible') || $('#luckysheet-multiRange-dialog').is(':visible')) {\n                                return;\n                            }\n                            luckysheetMoveHighlightRange2('right', 'rangeOfSelect');\n                        } else if (kcode == 186 || kcode == 222) {\n                            let last = Store.luckysheet_select_save[Store.luckysheet_select_save.length - 1];\n                            let row_index = last['row_focus'], col_index = last['column_focus'];\n                            luckysheetupdateCell(row_index, col_index, Store.flowdata, true);\n                            let value = getNowDateTime(2);\n                            $('#luckysheet-rich-text-editor').html(value);\n                            luckysheetRangeLast($('#luckysheet-rich-text-editor')[0]);\n                            formula.functionInputHanddler($('#luckysheet-functionbox-cell'), $('#luckysheet-rich-text-editor'), kcode);\n                        }\n                    } else if (kcode == 66) {\n                        //Ctrl + B  加粗\n                        $('#luckysheet-icon-bold').click();\n                    } else if (kcode == 67) {\n                        //Ctrl + C  复制\n                        if (imageCtrl.currentImgId != null) {\n                            imageCtrl.copyImgItem(event);\n                            return;\n                        }    //复制时存在格式刷状态，取消格式刷\n                        //复制时存在格式刷状态，取消格式刷\n                        if (menuButton.luckysheetPaintModelOn) {\n                            menuButton.cancelPaintModel();\n                        }\n                        if (Store.luckysheet_select_save.length == 0) {\n                            return;\n                        }    //复制范围内包含部分合并单元格，提示\n                        //复制范围内包含部分合并单元格，提示\n                        if (Store.config['merge'] != null) {\n                            let has_PartMC = false;\n                            for (let s = 0; s < Store.luckysheet_select_save.length; s++) {\n                                let r1 = Store.luckysheet_select_save[s].row[0], r2 = Store.luckysheet_select_save[s].row[1];\n                                let c1 = Store.luckysheet_select_save[s].column[0], c2 = Store.luckysheet_select_save[s].column[1];\n                                has_PartMC = hasPartMC(Store.config, r1, r2, c1, c2);\n                                if (has_PartMC) {\n                                    break;\n                                }\n                            }\n                            if (has_PartMC) {\n                                if (isEditMode()) {\n                                    alert(locale_drag.noMerge);\n                                } else {\n                                    tooltip.info(locale_drag.noMerge, '');\n                                }\n                                return;\n                            }\n                        }    //多重选区 有条件格式时 提示\n                        //多重选区 有条件格式时 提示\n                        let cdformat = Store.luckysheetfile[getSheetIndex(Store.currentSheetIndex)].luckysheet_conditionformat_save;\n                        if (Store.luckysheet_select_save.length > 1 && cdformat != null && cdformat.length > 0) {\n                            let hasCF = false;\n                            let cf_compute = conditionformat.getComputeMap();\n                            label:\n                                for (let s = 0; s < Store.luckysheet_select_save.length; s++) {\n                                    if (hasCF) {\n                                        break;\n                                    }\n                                    let r1 = Store.luckysheet_select_save[s].row[0], r2 = Store.luckysheet_select_save[s].row[1];\n                                    let c1 = Store.luckysheet_select_save[s].column[0], c2 = Store.luckysheet_select_save[s].column[1];\n                                    for (let r = r1; r <= r2; r++) {\n                                        for (let c = c1; c <= c2; c++) {\n                                            if (conditionformat.checksCF(r, c, cf_compute) != null) {\n                                                hasCF = true;\n                                                continue label;\n                                            }\n                                        }\n                                    }\n                                }\n                            if (hasCF) {\n                                if (isEditMode()) {\n                                    alert(locale_drag.noMulti);\n                                } else {\n                                    tooltip.info(locale_drag.noMulti, '');\n                                }\n                                return;\n                            }\n                        }    //多重选区 行不一样且列不一样时 提示\n                        //多重选区 行不一样且列不一样时 提示\n                        if (Store.luckysheet_select_save.length > 1) {\n                            let isSameRow = true, str_r = Store.luckysheet_select_save[0].row[0], end_r = Store.luckysheet_select_save[0].row[1];\n                            let isSameCol = true, str_c = Store.luckysheet_select_save[0].column[0], end_c = Store.luckysheet_select_save[0].column[1];\n                            for (let s = 1; s < Store.luckysheet_select_save.length; s++) {\n                                if (Store.luckysheet_select_save[s].row[0] != str_r || Store.luckysheet_select_save[s].row[1] != end_r) {\n                                    isSameRow = false;\n                                }\n                                if (Store.luckysheet_select_save[s].column[0] != str_c || Store.luckysheet_select_save[s].column[1] != end_c) {\n                                    isSameCol = false;\n                                }\n                            }\n                            if (!isSameRow && !isSameCol || selectIsOverlap()) {\n                                if (isEditMode()) {\n                                    alert(locale_drag.noMulti);\n                                } else {\n                                    tooltip.info(locale_drag.noMulti, '');\n                                }\n                                return;\n                            }\n                        }\n                        selection.copy(event);\n                        Store.luckysheet_paste_iscut = false;\n                        luckysheetactiveCell();\n                        event.stopPropagation();\n                        return;\n                    } else if (kcode == 70) {\n                        //Ctrl + F  查找\n                        searchReplace.createDialog(0);\n                        searchReplace.init();\n                        $('#luckysheet-search-replace #searchInput input').focus();\n                    } else if (kcode == 72) {\n                        //Ctrl + H  替换\n                        searchReplace.createDialog(1);\n                        searchReplace.init();\n                        $('#luckysheet-search-replace #searchInput input').focus();\n                    } else if (kcode == 73) {\n                        //Ctrl + I  斜体\n                        $('#luckysheet-icon-italic').click();\n                    } else if (kcode == 86) {\n                        //Ctrl + V  粘贴\n                        if (isEditMode()) {\n                            //此模式下禁用粘贴\n                            return;\n                        }\n                        if ($(event.target).hasClass('formulaInputFocus')) {\n                            return;\n                        }\n                        if (Store.luckysheet_select_save.length > 1) {\n                            if (isEditMode()) {\n                                alert(locale_drag.noPaste);\n                            } else {\n                                tooltip.info(locale_drag.noPaste, '');\n                            }\n                            return;\n                        }\n                        selection.isPasteAction = true;\n                        luckysheetactiveCell();\n                        event.stopPropagation();\n                        return;\n                    } else if (kcode == 88) {\n                        //Ctrl + X  剪切\n                        //复制时存在格式刷状态，取消格式刷\n                        if (menuButton.luckysheetPaintModelOn) {\n                            menuButton.cancelPaintModel();\n                        }\n                        if (Store.luckysheet_select_save.length == 0) {\n                            return;\n                        }    //复制范围内包含部分合并单元格，提示\n                        //复制范围内包含部分合并单元格，提示\n                        if (Store.config['merge'] != null) {\n                            let has_PartMC = false;\n                            for (let s = 0; s < Store.luckysheet_select_save.length; s++) {\n                                let r1 = Store.luckysheet_select_save[s].row[0], r2 = Store.luckysheet_select_save[s].row[1];\n                                let c1 = Store.luckysheet_select_save[s].column[0], c2 = Store.luckysheet_select_save[s].column[1];\n                                has_PartMC = hasPartMC(Store.config, r1, r2, c1, c2);\n                                if (has_PartMC) {\n                                    break;\n                                }\n                            }\n                            if (has_PartMC) {\n                                if (luckysheetConfigsetting.editMode) {\n                                    alert(_locale_drag.noMerge);\n                                } else {\n                                    tooltip.info(_locale_drag.noMerge, '');\n                                }\n                                return;\n                            }\n                        }    //多重选区时 提示\n                        //多重选区时 提示\n                        if (Store.luckysheet_select_save.length > 1) {\n                            if (isEditMode()) {\n                                alert(locale_drag.noMulti);\n                            } else {\n                                tooltip.info(locale_drag.noMulti, '');\n                            }\n                            return;\n                        }\n                        selection.copy(event);\n                        Store.luckysheet_paste_iscut = true;\n                        luckysheetactiveCell();\n                        event.stopPropagation();\n                        return;\n                    } else if (kcode == 90) {\n                        //Ctrl + Z  撤销\n                        controlHistory.redo(event);\n                        luckysheetactiveCell();\n                        event.stopPropagation();\n                        return;\n                    } else if (kcode == 89) {\n                        //Ctrl + Y  重做\n                        controlHistory.undo(event);\n                        luckysheetactiveCell();\n                        event.stopPropagation();\n                        return;\n                    } else if (kcode == keycode.UP) {\n                        //Ctrl + up  调整单元格\n                        if (parseInt($inputbox.css('top')) > 0 || $('#luckysheet-singleRange-dialog').is(':visible') || $('#luckysheet-multiRange-dialog').is(':visible')) {\n                            return;\n                        }\n                        luckysheetMoveHighlightCell2('up', 'rangeOfSelect');\n                    } else if (kcode == keycode.DOWN) {\n                        //Ctrl + down  调整单元格\n                        if (parseInt($inputbox.css('top')) > 0 || $('#luckysheet-singleRange-dialog').is(':visible') || $('#luckysheet-multiRange-dialog').is(':visible')) {\n                            return;\n                        }\n                        luckysheetMoveHighlightCell2('down', 'rangeOfSelect');\n                    } else if (kcode == keycode.LEFT) {\n                        //Ctrl + top  调整单元格\n                        if (parseInt($inputbox.css('top')) > 0 || $('#luckysheet-singleRange-dialog').is(':visible') || $('#luckysheet-multiRange-dialog').is(':visible')) {\n                            return;\n                        }\n                        luckysheetMoveHighlightCell2('left', 'rangeOfSelect');\n                    } else if (kcode == keycode.RIGHT) {\n                        //Ctrl + right  调整单元格\n                        if (parseInt($inputbox.css('top')) > 0 || $('#luckysheet-singleRange-dialog').is(':visible') || $('#luckysheet-multiRange-dialog').is(':visible')) {\n                            return;\n                        }\n                        luckysheetMoveHighlightCell2('right', 'rangeOfSelect');\n                    } else if (kcode == 186) {\n                        //Ctrl + ; 填充系统日期\n                        let last = Store.luckysheet_select_save[Store.luckysheet_select_save.length - 1];\n                        let row_index = last['row_focus'], col_index = last['column_focus'];\n                        luckysheetupdateCell(row_index, col_index, Store.flowdata, true);\n                        let value = getNowDateTime(1);\n                        $('#luckysheet-rich-text-editor').html(value);\n                        luckysheetRangeLast($('#luckysheet-rich-text-editor')[0]);\n                        formula.functionInputHanddler($('#luckysheet-functionbox-cell'), $('#luckysheet-rich-text-editor'), kcode);\n                    } else if (kcode == 222) {\n                        //Ctrl + ' 填充系统时间\n                        let last = Store.luckysheet_select_save[Store.luckysheet_select_save.length - 1];\n                        let row_index = last['row_focus'], col_index = last['column_focus'];\n                        luckysheetupdateCell(row_index, col_index, Store.flowdata, true);\n                        let value = getNowDateTime(2);\n                        $('#luckysheet-rich-text-editor').html(value);\n                        luckysheetRangeLast($('#luckysheet-rich-text-editor')[0]);\n                        formula.functionInputHanddler($('#luckysheet-functionbox-cell'), $('#luckysheet-rich-text-editor'), kcode);\n                    } else if (String.fromCharCode(kcode).toLocaleUpperCase() == 'A') {\n                        //Ctrl + A  全选\n                        // $(\"#luckysheet-left-top\").trigger(\"mousedown\");\n                        // $(document).trigger(\"mouseup\");\n                        $('#luckysheet-left-top').click();\n                    }\n                    event.preventDefault();\n                    return;\n                } else if (shiftKey && (kcode == keycode.UP || kcode == keycode.DOWN || kcode == keycode.LEFT || kcode == keycode.RIGHT || altKey && (kcode == 53 || kcode == 101))) {\n                    if (parseInt($inputbox.css('top')) > 0 || $(event.target).hasClass('formulaInputFocus')) {\n                        return;\n                    }\n                    if (!luckysheet_shiftkeydown) {\n                        Store.luckysheet_shiftpositon = $.extend(true, {}, Store.luckysheet_select_save[Store.luckysheet_select_save.length - 1]);\n                        Store.luckysheet_shiftkeydown = true;\n                    }    //shift + 方向键 调整选区\n                    //shift + 方向键 调整选区\n                    if (kcode == keycode.UP) {\n                        if ($('#luckysheet-singleRange-dialog').is(':visible') || $('#luckysheet-multiRange-dialog').is(':visible')) {\n                            return;\n                        }\n                        luckysheetMoveHighlightRange('down', -1, 'rangeOfSelect');\n                    } else if (kcode == keycode.DOWN) {\n                        if ($('#luckysheet-singleRange-dialog').is(':visible') || $('#luckysheet-multiRange-dialog').is(':visible')) {\n                            return;\n                        }\n                        luckysheetMoveHighlightRange('down', 1, 'rangeOfSelect');\n                    } else if (kcode == keycode.LEFT) {\n                        if ($('#luckysheet-singleRange-dialog').is(':visible') || $('#luckysheet-multiRange-dialog').is(':visible')) {\n                            return;\n                        }\n                        luckysheetMoveHighlightRange('right', -1, 'rangeOfSelect');\n                    } else if (kcode == keycode.RIGHT) {\n                        if ($('#luckysheet-singleRange-dialog').is(':visible') || $('#luckysheet-multiRange-dialog').is(':visible')) {\n                            return;\n                        }\n                        luckysheetMoveHighlightRange('right', 1, 'rangeOfSelect');\n                    } else if (altKey && (kcode == 53 || kcode == 101)) {\n                        //Alt + Shift + 5（删除线）\n                        $('#luckysheet-icon-strikethrough').click();\n                    }    // else if (altKey && (kcode == 54 || kcode == 102)) {\n                         //     //Alt + Shift + 6（删除线）\n                         //     $(\"#luckysheet-icon-underline\").click();\n                         // }\n                    // else if (altKey && (kcode == 54 || kcode == 102)) {\n                    //     //Alt + Shift + 6（删除线）\n                    //     $(\"#luckysheet-icon-underline\").click();\n                    // }\n                    event.preventDefault();\n                } else if (kcode == keycode.ESC) {\n                    if (menuButton.luckysheetPaintModelOn) {\n                        menuButton.cancelPaintModel();\n                    } else {\n                        cleargridelement(event);\n                        event.preventDefault();\n                    }\n                    selectHightlightShow();\n                } else if (kcode == keycode.DELETE || kcode == keycode.BACKSPACE) {\n                    if (imageCtrl.currentImgId != null) {\n                        imageCtrl.removeImgItem();\n                    } else {\n                        $('#luckysheet-delete-text').click();\n                    }\n                    event.preventDefault();\n                } else if (kcode == 8 && imageCtrl.currentImgId != null) {\n                    imageCtrl.removeImgItem();\n                    event.preventDefault();\n                } else if (kcode == keycode.UP) {\n                    if (parseInt($inputbox.css('top')) > 0 || Store.luckysheet_cell_selected_move || Store.luckysheet_cell_selected_extend || $(event.target).hasClass('formulaInputFocus') || $('#luckysheet-singleRange-dialog').is(':visible') || $('#luckysheet-multiRange-dialog').is(':visible')) {\n                        return;\n                    }\n                    luckysheetMoveHighlightCell('down', -1, 'rangeOfSelect');\n                    event.preventDefault();\n                } else if (kcode == keycode.DOWN) {\n                    if (parseInt($inputbox.css('top')) > 0 || Store.luckysheet_cell_selected_move || Store.luckysheet_cell_selected_extend || $(event.target).hasClass('formulaInputFocus') || $('#luckysheet-singleRange-dialog').is(':visible') || $('#luckysheet-multiRange-dialog').is(':visible')) {\n                        return;\n                    }\n                    luckysheetMoveHighlightCell('down', 1, 'rangeOfSelect');\n                    event.preventDefault();\n                } else if (kcode == keycode.LEFT) {\n                    if (parseInt($inputbox.css('top')) > 0 || Store.luckysheet_cell_selected_move || Store.luckysheet_cell_selected_extend || $(event.target).hasClass('formulaInputFocus') || $('#luckysheet-singleRange-dialog').is(':visible') || $('#luckysheet-multiRange-dialog').is(':visible')) {\n                        return;\n                    }\n                    luckysheetMoveHighlightCell('right', -1, 'rangeOfSelect');\n                    event.preventDefault();\n                } else if (kcode == keycode.RIGHT) {\n                    if (parseInt($inputbox.css('top')) > 0 || Store.luckysheet_cell_selected_move || Store.luckysheet_cell_selected_extend || $(event.target).hasClass('formulaInputFocus') || $('#luckysheet-singleRange-dialog').is(':visible') || $('#luckysheet-multiRange-dialog').is(':visible')) {\n                        return;\n                    }\n                    luckysheetMoveHighlightCell('right', 1, 'rangeOfSelect');\n                    event.preventDefault();\n                } else if (!(kcode >= 112 && kcode <= 123 || kcode <= 46 || kcode == 144 || kcode == 108 || event.ctrlKey || event.altKey || event.shiftKey && (kcode == 37 || kcode == 38 || kcode == 39 || kcode == 40)) || kcode == 8 || kcode == 32 || kcode == 46 || kcode == 0 || event.ctrlKey && kcode == 86) {\n                    if (String.fromCharCode(kcode) != null && $('#luckysheet-cell-selected').is(':visible') && (kcode != keycode.CAPSLOCK && kcode != keycode.WIN && kcode != 18)) {\n                        let last = Store.luckysheet_select_save[Store.luckysheet_select_save.length - 1];\n                        let row_index = last['row_focus'], col_index = last['column_focus'];\n                        luckysheetupdateCell(row_index, col_index, Store.flowdata, true);\n                        if (kcode == 8) {\n                            $('#luckysheet-rich-text-editor').html('<br/>');\n                        }\n                        formula.functionInputHanddler($('#luckysheet-functionbox-cell'), $('#luckysheet-rich-text-editor'), kcode);\n                    }\n                }\n            }\n            luckysheetactiveCell();\n            event.stopPropagation();\n        });    //单元格编辑 keydown (公式 上下左右键移动)\n        //单元格编辑 keydown (公式 上下左右键移动)\n        $('#' + Store.container).add('#luckysheet-input-box').keydown(function (event) {\n            if ($('#luckysheet-modal-dialog-mask').is(':visible') || $(event.target).hasClass('luckysheet-mousedown-cancel') || $(event.target).hasClass('formulaInputFocus')) {\n                return;\n            }\n            let ctrlKey = event.ctrlKey;\n            let altKey = event.altKey;\n            let shiftKey = event.shiftKey;\n            let kcode = event.keyCode;\n            let $inputbox = $('#luckysheet-input-box');\n            if (kcode == keycode.ESC && parseInt($('#luckysheet-input-box').css('top')) > 0) {\n                formula.dontupdate();\n                luckysheetMoveHighlightCell('down', 0, 'rangeOfSelect');\n                event.preventDefault();\n            } else if (kcode == keycode.ENTER && parseInt($inputbox.css('top')) > 0) {\n                if ($('#luckysheet-formula-search-c').is(':visible') && formula.searchFunctionCell != null) {\n                    formula.searchFunctionEnter($('#luckysheet-formula-search-c').find('.luckysheet-formula-search-item-active'));\n                    event.preventDefault();\n                }\n            } else if (kcode == keycode.TAB && parseInt($inputbox.css('top')) > 0) {\n                if ($('#luckysheet-formula-search-c').is(':visible') && formula.searchFunctionCell != null) {\n                    formula.searchFunctionEnter($('#luckysheet-formula-search-c').find('.luckysheet-formula-search-item-active'));\n                } else {\n                    formula.updatecell(Store.luckysheetCellUpdate[0], Store.luckysheetCellUpdate[1]);\n                    luckysheetMoveHighlightCell('right', 1, 'rangeOfSelect');\n                }\n                event.preventDefault();\n            } else if (kcode == keycode.F4 && parseInt($inputbox.css('top')) > 0) {\n                formula.setfreezonFuc(event);\n                event.preventDefault();\n            } else if (kcode == keycode.UP && parseInt($inputbox.css('top')) > 0) {\n                formulaMoveEvent('up', ctrlKey, shiftKey, event);\n            } else if (kcode == keycode.DOWN && parseInt($inputbox.css('top')) > 0) {\n                formulaMoveEvent('down', ctrlKey, shiftKey, event);\n            } else if (kcode == keycode.LEFT && parseInt($inputbox.css('top')) > 0) {\n                formulaMoveEvent('left', ctrlKey, shiftKey, event);\n            } else if (kcode == keycode.RIGHT && parseInt($inputbox.css('top')) > 0) {\n                formulaMoveEvent('right', ctrlKey, shiftKey, event);\n            } else if (!(kcode >= 112 && kcode <= 123 || kcode <= 46 || kcode == 144 || kcode == 108 || event.ctrlKey || event.altKey || event.shiftKey && (kcode == 37 || kcode == 38 || kcode == 39 || kcode == 40 || kcode == keycode.WIN || kcode == keycode.WIN_R || kcode == keycode.MENU)) || kcode == 8 || kcode == 32 || kcode == 46 || event.ctrlKey && kcode == 86) {\n                // if(event.target.id!=\"luckysheet-input-box\" && event.target.id!=\"luckysheet-rich-text-editor\"){\n                formula.functionInputHanddler($('#luckysheet-functionbox-cell'), $('#luckysheet-rich-text-editor'), kcode);\n                setCenterInputPosition(Store.luckysheetCellUpdate[0], Store.luckysheetCellUpdate[1], Store.flowdata);    // }\n            }\n        }).keyup(function (e) {\n            let kcode = e.keyCode;\n            if (!e.shiftKey && kcode == 16) {\n                Store.luckysheet_shiftkeydown = false;\n                Store.luckysheet_shiftpositon = null;\n            }    //输入框中文输入后 shift 和 空格 处理\n            //输入框中文输入后 shift 和 空格 处理\n            if (parseInt($('#luckysheet-input-box').css('top')) > 0 && (kcode == 13 || kcode == 16 || kcode == 32)) {\n            }\n            e.preventDefault();\n        });    //top workBook rename\n        //top workBook rename\n        $('#luckysheet_info_detail_input').val(Store.title).css('width', getByteLen(Store.title) * 10).keydown(function () {\n            let ctrlKey = event.ctrlKey;\n            let altKey = event.altKey;\n            let shiftKey = event.shiftKey;\n            let kcode = event.keyCode;\n            let $t = $(this);\n            if (kcode == keycode.ENTER) {\n                $t.blur().change();\n            }\n        }).bind('input propertychange', function () {\n            let $t = $(this);\n            let inputlen = getByteLen($t.val()) * 10;\n            let updatelen = $('#luckysheet_info_detail_update').outerWidth();\n            let savelen = $('#luckysheet_info_detail_save').outerWidth();\n            let userlen = $('#luckysheet_info_detail_user').parent().outerWidth() + 60;\n            let containerlen = $('#' + Store.container).outerWidth();\n            let otherlen = 100;\n            let minuslen = containerlen - savelen - updatelen - userlen - otherlen;\n            if (inputlen > minuslen) {\n                $('#luckysheet_info_detail_input').css('width', minuslen);\n            } else {\n                $('#luckysheet_info_detail_input').css('width', inputlen);\n            }\n        }).change(function () {\n            Store.saveParam('na', null, $(this).val());\n        });    // 右击菜单的input输入框 敲击Enter一样生效\n        // 右击菜单的input输入框 敲击Enter一样生效\n        $('#' + Store.container).add('input.luckysheet-mousedown-cancel').keydown(function (event) {\n            const element = event.target.closest('.luckysheet-cols-menuitem');\n            if (typeof element != 'undefined' && element != null && event.keyCode === 13) {\n                $(element).trigger('click');\n            }\n        });\n    }\n    return { keyboardInitial: keyboardInitial };\n});"]}