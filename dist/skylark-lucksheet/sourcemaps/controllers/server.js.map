{"version":3,"sources":["controllers/server.js"],"names":["define","pako","localforage","m_loading","m_constant","sheets","cells","m_filter","luckysheetFreezen","luckysheetPostil","imageCtrl","dataVerificationCtrl","hyperlinkCtrl","m_util","m_get","Store","m_select","locale","dayjs","json","showloading","hideloading","sheetHTML","luckyColor","createFilterOptions","getObjType","replaceHtml","getByteLen","getSheetIndex","collaborativeEditBox","server","retryTimer","wxErrorCount","openWebSocket","_this","this","window","wxUrl","updateUrl","encodeURIComponent","gridKey","indexOf","websocket","WebSocket","onopen","console","info","success","setInterval","send","onmessage","result","data","Function","type","message","id","$","hide","cooperativeEdit","changeCollaborationSize","filter","value","checkoutData","item","JSON","parse","wsUpdateMsg","chang_data","k","v","username","index","t","i","length","push","some","value1","forEach","val","r","c","currentSheetIndex","op","range","row","column","multipleRangeShow","change_bottom","offsetHeight","css","bottom","items","onerror","refresh","wait","onclose","e","close","code","clearInterval","alert","contact","support","file","luckysheetfile","includes","flowdata","webWorkerFlowDataCache","ps","buildPs","Object","keys","merge_range","r1","r2","c1","c2","key","config","refreshGrid_rhcw","find","html","currentSheetItem","remove","append","frozenTofreezen","locale_freezen","freezen","horizontal","freezenRow","freezenhorizontaldata","createFreezenHorizontal","top","vertical","freezenColumn","freezenverticaldata","createFreezenVertical","left","createAssistCanvas","filter_select","images","allImagesShow","init","dataVerification","hyperlink","pos","calcChain","a","splice","rc","st_i","len","mc","borderInfo","addcol","concat","x","merge","addData","direction","extend","arr","stringify","join","colorset","color","active","name","style","copyindex","copyarrindex","copyjson","copyobject","insertAfter","deleIndex","luckysheetcurrentSheetitem","removeClass","indicator","nextAll","eq","prevAll","addClass","changeSheet","sheetDeleSave","order","reIndex","datav","cur","show","cid","chart","luckysheet","insertChartTosheet","sheetIndex","dataSheetIndex","option","chartType","selfOption","defaultOption","chart_selection_color","chart_id","chart_selection_id","chartStyle","rangeConfigCheck","rangeRowCheck","rangeColCheck","chartMarkConfig","chartTitleConfig","winWidth","winHeight","scrollLeft1","scrollTop1","chartTheme","myWidth","myHeight","myLeft","myTop","myindexrank1","chartjson","vitem","saveChart","delChart","attr","multipleIndex","visibledatarow","row_pre","col","visibledatacolumn","col_pre","margeset","mergeborer","edit","typing","position","width","height","text","usernameTimeout","clearTimeout","setTimeout","itemHtml","appendTo","submitInterval","imagesubmitInterval","submitdatalimit","submitcompresslimit","checksubmit","submitTimeout","imageRequestTimeout","imageRequest","requestTimeOut","requestLock","requestlast","clone","add","isBefore","request","firstchange","cachelocaldata","cahce_key","params","post","compress","status","format","clearcachelocaldata","restorecachelocaldata","imageRequestLast","imageRequestLock","html2canvas","container","get","onrendered","canvas","old","newwidth","newheight","imageData","getContext","getImageData","cutW","cutH","newCanvas","putImageData","drawImage","base64","toDataURL","curindex","getCurSheetnoset","data1","img","updateImageUrl","localdata","matchOpt","d","drc","arc","sha","shc","shd","deleteRepeatOpt","Array","ditem","ret","setlocaldata","func","getlocaldata","clearlocaldata","updatedata","uLen","prevData","flag","setItem","then","removeItem","err","getItem","readValue","newdata","keepHighLightBox"],"mappings":"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","file":"../../controllers/server.js","sourcesContent":["define([\n    'skylark-pako',\n    'skylark-localForage',\n    '../widgets/loading',\n    '../widgets/constant',\n    '../methods/sheets',\n    '../methods/cells',\n    './filter',\n    './freezen',\n    './postil',\n    '../widgets/imageCtrl',\n    '../widgets/dataVerificationCtrl',\n    '../widgets/hyperlinkCtrl',\n    '../utils/util',\n    '../methods/get',\n    '../store',\n    '../widgets/select',\n    '../locale/locale',\n    'skylark-moment',\n    '../methods/json'\n], function (pako,localforage, m_loading,  m_constant, sheets, cells, m_filter, luckysheetFreezen, luckysheetPostil, imageCtrl, dataVerificationCtrl, hyperlinkCtrl, m_util, m_get, Store, m_select, locale, dayjs, json) {\n    'use strict';\n    const {showloading, hideloading} = m_loading;\n    const {sheetHTML, luckyColor} = m_constant;\n    const {createFilterOptions} = m_filter;\n    const {getObjType, replaceHtml, getByteLen} = m_util;\n    const {getSheetIndex} = m_get;\n    const {collaborativeEditBox} = m_select;\n    const server = {\n\n        retryTimer: null,\n        wxErrorCount: 0,\n        openWebSocket: function () {\n            let _this = this;\n            if ('WebSocket' in window) {\n                let wxUrl = _this.updateUrl + '?t=111&g=' + encodeURIComponent(_this.gridKey);\n                if (_this.updateUrl.indexOf('?') > -1) {\n                    wxUrl = _this.updateUrl + '&t=111&g=' + encodeURIComponent(_this.gridKey);\n                }\n                Store.websocket = new WebSocket(wxUrl);    //连接建立时触发\n                //连接建立时触发\n                Store.websocket.onopen = function () {\n                    console.info(locale().websocket.success);\n                    hideloading();\n                    _this.wxErrorCount = 0;    //防止websocket长时间不发送消息导致断连\n                    //防止websocket长时间不发送消息导致断连\n                    _this.retryTimer = setInterval(function () {\n                        Store.websocket.send('rub');\n                    }, 60000);\n                };  \n                //客户端接收服务端数据时触发\n                Store.websocket.onmessage = function (result) {\n                    Store.result = result;\n                    let data = new Function('return ' + result.data)();\n                    console.info(data);\n                    let type = data.type;\n                    let {message, id} = data;    // 用户退出时，关闭协同编辑时其提示框\n                    // 用户退出时，关闭协同编辑时其提示框\n                    if (message === '用户退出') {\n                        $('#luckysheet-multipleRange-show-' + id).hide();\n                        Store.cooperativeEdit.changeCollaborationSize = Store.cooperativeEdit.changeCollaborationSize.filter(value => {\n                            return value.id != id;\n                        });\n                        Store.cooperativeEdit.checkoutData = Store.cooperativeEdit.checkoutData.filter(value => {\n                            return value.id != id;\n                        });\n                    }\n                    if (type == 1) {\n                    } else if (type == 2) {\n                        //更新数据\n                        let item = JSON.parse(data.data);\n                        _this.wsUpdateMsg(item);\n                        let chang_data = JSON.parse(data.data);\n                        if (chang_data.k == 'columnlen') {\n                            collaborativeEditBox(chang_data.v, null);\n                        } else if (chang_data.k == 'rowlen') {\n                            collaborativeEditBox(null, chang_data.v);\n                        }\n                    } else if (type == 3) {\n                        //多人操作不同选区(\"t\": \"mv\")（用不同颜色显示其他人所操作的选区）\n                        let id = data.id;\n                        let username = data.username;\n                        let item = JSON.parse(data.data);\n                        let type = item.t, index = item.i, value = item.v;\n                        if (Store.cooperativeEdit.changeCollaborationSize.length === 0) {\n                            Store.cooperativeEdit.changeCollaborationSize.push({\n                                id: id,\n                                v: item.v[0],\n                                i: index\n                            });\n                        }\n                        let flag = Store.cooperativeEdit.changeCollaborationSize.some(value1 => {\n                            return value1.id == id;\n                        });\n                        if (flag) {\n                            Store.cooperativeEdit.changeCollaborationSize.forEach(val => {\n                                if (val.id == id) {\n                                    val.v = item.v[0];\n                                    val.i = index;\n                                }\n                            });\n                        } else {\n                            Store.cooperativeEdit.changeCollaborationSize.push({\n                                id: id,\n                                v: item.v[0],\n                                i: index\n                            });\n                        }\n                        if (getObjType(value) != 'array' && getObjType(value) !== 'object') {\n                            value = JSON.parse(value);\n                        }\n                        let r = 0;\n                        let c = 0;\n                        if (index == Store.currentSheetIndex) {\n                            //发送消息者在当前页面\n                            if (getObjType(value) === 'object' && value.op === 'enterEdit') {\n                                r = value.range[value.range.length - 1].row[0];\n                                c = value.range[value.range.length - 1].column[0];\n                                _this.multipleRangeShow(id, username, r, c, value.op);\n                            } else {\n                                r = value[value.length - 1].row[0];\n                                c = value[value.length - 1].column[0];\n                                _this.multipleRangeShow(id, username, r, c);\n                            }\n                        } else {\n                            if (getObjType(value) === 'object' && value.op === 'enterEdit') {\n                                r = value.range[value.range.length - 1].row[0];\n                                c = value.range[value.range.length - 1].column[0];\n                            } else {\n                                r = value[value.length - 1].row[0];\n                                c = value[value.length - 1].column[0];\n                            }\n                        }\n                        if (Store.cooperativeEdit.checkoutData.length === 0) {\n                            if (value.op) {\n                                Store.cooperativeEdit.checkoutData.push({\n                                    id,\n                                    username,\n                                    r,\n                                    c,\n                                    op: value.op,\n                                    index\n                                });\n                            } else {\n                                Store.cooperativeEdit.checkoutData.push({\n                                    id,\n                                    username,\n                                    r,\n                                    c,\n                                    index\n                                });\n                            }\n                        }\n                        let checkoutFlag = Store.cooperativeEdit.checkoutData.some(item => {\n                            return item.id == id;\n                        });\n                        if (checkoutFlag) {\n                            Store.cooperativeEdit.checkoutData.forEach(item => {\n                                if (item.id == id) {\n                                    item.username = username;\n                                    item.r = r;\n                                    item.c = c;\n                                    item.index = index;\n                                    if (value.op === 'enterEdit') {\n                                        item.op = value.op;\n                                    }\n                                }\n                            });\n                        } else {\n                            if (value.op === 'enterEdit') {\n                                Store.cooperativeEdit.checkoutData.push({\n                                    id,\n                                    username,\n                                    r,\n                                    c,\n                                    op: value.op,\n                                    index\n                                });\n                            } else {\n                                Store.cooperativeEdit.checkoutData.push({\n                                    id,\n                                    username,\n                                    r,\n                                    c,\n                                    index\n                                });\n                            }\n                        }    //其他客户端切换页面时\n                        //其他客户端切换页面时\n                        Store.cooperativeEdit.checkoutData.forEach(item => {\n                            if (item.index != Store.currentSheetIndex) {\n                                $('#luckysheet-multipleRange-show-' + item.id).hide();\n                                item.op == '';\n                            }\n                        });\n                        if ($('#luckysheet-multipleRange-show-' + id)[0]) {\n                            let change_bottom = $('#luckysheet-multipleRange-show-' + id)[0].offsetHeight - 1;\n                            $('#luckysheet-multipleRange-show-' + id + '>.username').css({ 'bottom': change_bottom + 'px' });\n                        }\n                    } else if (type == 4) {\n                        //批量指令更新\n                        // let items = JSON.parse(data.data);\n                        // After editing by multiple people, data.data may appear as an empty string\n                        let items = data.data === '' ? data.data : JSON.parse(data.data);\n                        for (let i = 0; i < items.length; i++) {\n                            _this.wsUpdateMsg(item[i]);\n                        }\n                    }\n                };    //通信发生错误时触发\n                //通信发生错误时触发\n                Store.websocket.onerror = function () {\n                    _this.wxErrorCount++;\n                    if (_this.wxErrorCount > 3) {\n                        showloading(locale().websocket.refresh);\n                    } else {\n                        showloading(locale().websocket.wait);\n                        _this.openWebSocket();\n                    }\n                };    //连接关闭时触发\n                //连接关闭时触发\n                Store.websocket.onclose = function (e) {\n                    console.info(locale().websocket.close);\n                    if (e.code === 1000) {\n                        clearInterval(_this.retryTimer);\n                        _this.retryTimer = null;\n                    } else {\n                        alert(locale().websocket.contact);\n                    }\n                };\n            } else {\n                alert(locale().websocket.support);\n            }\n        },\n        wsUpdateMsg: function (item) {\n            let type = item.t, index = item.i, value = item.v;\n            let file = Store.luckysheetfile[getSheetIndex(index)];\n            if ([\n                    'v',\n                    'rv',\n                    'cg',\n                    'all',\n                    'fc',\n                    'drc',\n                    'arc',\n                    'f',\n                    'fsc',\n                    'fsr',\n                    'sh',\n                    'c'\n                ].includes(type) && file == null) {\n                return;\n            }\n            if (type == 'v') {\n                //单个单元格数据更新\n                if (file.data == null || file.data.length == 0) {\n                    return;\n                }\n                let r = item.r, c = item.c;\n                file.data[r][c] = value;\n                if (index == Store.currentSheetIndex) {\n                    //更新数据为当前表格数据\n                    Store.flowdata = file.data;\n                    Store.webWorkerFlowDataCache(Store.flowdata);    //worker存数据\n                                                                      //如果更新的单元格有批注\n                    //worker存数据\n                    //如果更新的单元格有批注\n                    if (value != null && value.ps != null) {\n                        luckysheetPostil.buildPs(r, c, value.ps);\n                    } else {\n                        luckysheetPostil.buildPs(r, c, null);\n                    }\n                    ///setTimeout(function () {\n                    ///    luckysheetrefreshgrid();\n                    ///}, 1);\n                    Store.refresh();\n                }\n            } else if (type == 'rv') {\n                //范围单元格数据更新\n                if (Object.keys(item.range).length > 0) {\n                    Store.cooperativeEdit.merge_range = item.range;\n                    Store.cooperativeEdit.merge_range.v = item.v;\n                    collaborativeEditBox();\n                }\n                if (file.data == null || file.data.length == 0) {\n                    return;\n                }\n                let r1 = item.range.row[0], r2 = item.range.row[1];\n                let c1 = item.range.column[0], c2 = item.range.column[1];\n                for (let r = r1; r <= r2; r++) {\n                    for (let c = c1; c <= c2; c++) {\n                        file.data[r][c] = value[r - r1][c - c1];\n                    }\n                }\n                if (index == Store.currentSheetIndex) {\n                    //更新数据为当前表格数据\n                    Store.flowdata = file.data;\n                    Store.webWorkerFlowDataCache(Store.flowdata);    //worker存数据\n                                                                      //如果更新的单元格有批注\n                    //worker存数据\n                    //如果更新的单元格有批注\n                    for (let r = r1; r <= r2; r++) {\n                        for (let c = c1; c <= c2; c++) {\n                            if (value[r - r1][c - c1] != null && value[r - r1][c - c1].ps != null) {\n                                luckysheetPostil.buildPs(r, c, value[r - r1][c - c1].ps);\n                            } else {\n                                luckysheetPostil.buildPs(r, c, null);\n                            }\n                        }\n                    }\n                    ///setTimeout(function () {\n                    ////    luckysheetrefreshgrid();\n                    ///}, 1);\n                    Store.refresh();\n                }\n            } else if (type == 'cg') {\n                //config更新（rowhidden，rowlen，columnlen，merge，borderInfo）\n                let k = item.k;\n                if (k == 'borderInfo') {\n                    file['config']['borderInfo'] = value;\n                } else {\n                    if (!(k in file['config'])) {\n                        file['config'][k] = {};\n                    }\n                    for (let key in value) {\n                        file['config'][k][key] = value[key];\n                    }\n                }\n                if (index == Store.currentSheetIndex) {\n                    //更新数据为当前表格数据\n                    Store.config = file['config'];\n                    if (k == 'rowlen' || k == 'columnlen' || k == 'rowhidden') {\n                        ///jfrefreshgrid_rhcw(Store.flowdata.length, Store.flowdata[0].length);\n                        Store.refreshGrid_rhcw(Store.flowdata.length, Store.flowdata[0].length);\n                    }\n                    ///setTimeout(function () {\n                    ////    luckysheetrefreshgrid();\n                    ///}, 1);\n                    Store.refresh();\n                }\n            } else if (type == 'all') {\n                //通用保存更新\n                let k = item.k;\n                file[k] = value;\n                if (k == 'name') {\n                    //工作表名\n                    $('#luckysheet-sheet-container-c #luckysheet-sheets-item' + index).find('span.luckysheet-sheets-item-name').html(value);\n                } else if (k == 'color') {\n                    //工作表颜色\n                    let currentSheetItem = $('#luckysheet-sheet-container-c #luckysheet-sheets-item' + index);\n                    currentSheetItem.find('.luckysheet-sheets-item-color').remove();\n                    if (value != null || value != '') {\n                        currentSheetItem.append('<div class=\"luckysheet-sheets-item-color\" style=\" position: absolute; width: 100%; height: 3px; bottom: 0px; left: 0px; background-color: ' + value + ';\"></div>');\n                    }\n                } else if (k == 'pivotTable') {\n                } else if (k == 'frozen') {\n                    //freezen row and column\n                    // tranform frozen\n                    luckysheetFreezen.frozenTofreezen();\n                    if (index == Store.currentSheetIndex) {\n                        const _locale = locale();\n                        const locale_freezen = _locale.freezen;\n                        if (file['freezen'].horizontal == null) {\n                            $('#luckysheet-freezen-btn-horizontal').html('<i class=\"fa fa-list-alt\"></i> ' + locale_freezen.freezenRow);\n                            Store.freezenhorizontaldata = null;\n                            $('#luckysheet-freezebar-horizontal').hide();\n                        } else {\n                            luckysheetFreezen.createFreezenHorizontal(file['freezen'].horizontal.freezenhorizontaldata, file['freezen'].horizontal.top);\n                        }\n                        if (file['freezen'].vertical == null) {\n                            $('#luckysheet-freezen-btn-vertical').html('<i class=\"fa fa-indent\"></i> ' + locale_freezen.freezenColumn);\n                            Store.freezenverticaldata = null;\n                            $('#luckysheet-freezebar-vertical').hide();\n                        } else {\n                            luckysheetFreezen.createFreezenVertical(file['freezen'].vertical.freezenverticaldata, file['freezen'].vertical.left);\n                        }\n                        luckysheetFreezen.createAssistCanvas();\n                    }\n                } else if (k == 'filter_select') {\n                    //筛选范围\n                    if (index == Store.currentSheetIndex) {\n                        createFilterOptions(value);\n                    }\n                } else if (k == 'filter') {\n                    //筛选保存\n                    if (index == Store.currentSheetIndex) {\n                        createFilterOptions(file.filter_select, value);\n                    }\n                } else if (k == 'luckysheet_conditionformat_save') {\n                    //条件格式\n                    if (index == Store.currentSheetIndex) {\n                        ///setTimeout(function () {\n                        ////    luckysheetrefreshgrid();\n                        ///}, 1);\n                        Store.refresh();\n                    }\n                } else if (k == 'luckysheet_alternateformat_save') {\n                    //交替颜色\n                    if (index == Store.currentSheetIndex) {\n                        ///setTimeout(function () {\n                        ////    luckysheetrefreshgrid();\n                        ///}, 1);\n                        Store.refresh();\n                    }\n                } else if (k == 'config') {\n                    //config\n                    if (index == Store.currentSheetIndex) {\n                        Store.config = value;\n                        ///jfrefreshgrid_rhcw(Store.flowdata.length, Store.flowdata[0].length);\n                        Store.refreshGrid_rhcw(Store.flowdata.length, Store.flowdata[0].length);\n                    }\n                } else if (k == 'dynamicArray') {\n                    //动态数组\n                        ///setTimeout(function () {\n                        ////    luckysheetrefreshgrid();\n                        ///}, 1);\n                        Store.refresh();\n                } else if (k == 'images') {\n                    //图片\n                    if (index == Store.currentSheetIndex) {\n                        imageCtrl.images = value;\n                        imageCtrl.allImagesShow();\n                        imageCtrl.init();\n                    }\n                } else if (k == 'dataVerification') {\n                    //数据验证\n                    if (index == Store.currentSheetIndex) {\n                        Store.dataVerification = value;\n                        dataVerificationCtrl.init();\n                    }\n                } else if (k == 'hyperlink') {\n                    //链接\n                    if (index == Store.currentSheetIndex) {\n                        hyperlinkCtrl.hyperlink = value;\n                        hyperlinkCtrl.init();\n                    }\n                }\n            } else if (type == 'fc') {\n                //函数链calc\n                let op = item.op, pos = item.pos;\n                if (getObjType(value) != 'object') {\n                    value = new Function('return ' + value)();\n                }\n                let r = value.r, c = value.c;\n                let calcChain = file['calcChain'] == null ? [] : file['calcChain'];\n                if (op == 'add') {\n                    calcChain.push(value);\n                } else if (op == 'del') {\n                    for (let a = 0; a < calcChain.length; a++) {\n                        if (r == calcChain[a].r && c == calcChain[a].c && index == calcChain[a].index) {\n                            calcChain.splice(a, 1);\n                        }\n                    }\n                }    // else if(op == \"update\"){\n                     //     for(let a = 0; a < calcChain.length; a++){\n                     //         if(r == calcChain[a].r && c == calcChain[a].c && index == calcChain[a].index){\n                     //             calcChain[a].func = func;\n                     //         }\n                     //     }\n                     // }\n                // else if(op == \"update\"){\n                //     for(let a = 0; a < calcChain.length; a++){\n                //         if(r == calcChain[a].r && c == calcChain[a].c && index == calcChain[a].index){\n                //             calcChain[a].func = func;\n                //         }\n                //     }\n                // }\n                    ///setTimeout(function () {\n                    ////    luckysheetrefreshgrid();\n                    ///}, 1);\n                    Store.refresh();\n            } else if (type == 'drc') {\n                //删除行列\n                if (file.data == null || file.data.length == 0) {\n                    return;\n                }\n                let rc = item.rc, st_i = value.index, len = value.len, mc = value.mc, borderInfo = value.borderInfo;\n                let data = file.data;\n                if (rc == 'r') {\n                    file['row'] -= len;\n                    data.splice(st_i, len);    //空白行模板\n                    //空白行模板\n                    let row = [];\n                    for (let c = 0; c < data[0].length; c++) {\n                        row.push(null);\n                    }    //删除多少行，增加多少行空白行\n                    //删除多少行，增加多少行空白行\n                    for (let r = 0; r < len; r++) {\n                        data.push(row);\n                    }\n                } else {\n                    file['column'] -= len;    //空白列模板\n                    //空白列模板\n                    let addcol = [];\n                    for (let r = 0; r < len; r++) {\n                        addcol.push(null);\n                    }\n                    for (let i = 0; i < data.length; i++) {\n                        data[i].splice(st_i, len);\n                        data[i] = data[i].concat(addcol);\n                    }\n                }\n                for (let x in mc) {\n                    let r = mc[x].r, c = mc[x].c;\n                    data[r][c].mc = mc[x];\n                }\n                file['config'].merge = mc;\n                file['config'].borderInfo = borderInfo;\n                if (index == Store.currentSheetIndex) {\n                    Store.flowdata = data;\n                    Store.webWorkerFlowDataCache(Store.flowdata);    //worker存数据\n                    //worker存数据\n                    Store.config['merge'] = mc;\n                    Store.config['borderInfo'] = borderInfo;\n                    ///setTimeout(function () {\n                    ////    luckysheetrefreshgrid();\n                    ///}, 1);\n                    Store.refresh();\n                }\n            } else if (type == 'arc') {\n                //增加行列\n                if (file.data == null || file.data.length == 0) {\n                    return;\n                }\n                let rc = item.rc, st_i = value.index, len = value.len, addData = value.data, direction = value.direction, mc = value.mc, borderInfo = value.borderInfo;\n                let data = $.extend(true, [], file.data);\n                if (rc == 'r') {\n                    file['row'] += len;    //空行模板\n                    //空行模板\n                    let row = [];\n                    for (let c = 0; c < data[0].length; c++) {\n                        row.push(null);\n                    }\n                    let arr = [];\n                    for (let i = 0; i < len; i++) {\n                        if (addData[i] == null) {\n                            arr.push(JSON.stringify(row));\n                        } else {\n                            arr.push(JSON.stringify(addData[i]));\n                        }\n                    }\n                    if (direction == 'lefttop') {\n                        if (st_i == 0) {\n                            new Function('data', 'return ' + 'data.unshift(' + arr.join(',') + ')')(data);\n                        } else {\n                            new Function('data', 'return ' + 'data.splice(' + st_i + ', 0, ' + arr.join(',') + ')')(data);\n                        }\n                    } else {\n                        new Function('data', 'return ' + 'data.splice(' + (st_i + 1) + ', 0, ' + arr.join(',') + ')')(data);\n                    }\n                } else {\n                    file['column'] += len;\n                    for (let i = 0; i < data.length; i++) {\n                        data[i].splice(st_i, 0, addData[i]);\n                    }\n                }\n                for (let x in mc) {\n                    let r = mc[x].r, c = mc[x].c;\n                    data[r][c].mc = mc[x];\n                }\n                file.data = data;\n                file['config'].merge = mc;\n                file['config'].borderInfo = borderInfo;\n                if (index == Store.currentSheetIndex) {\n                    Store.flowdata = data;\n                    Store.webWorkerFlowDataCache(Store.flowdata);    //worker存数据\n                    //worker存数据\n                    Store.config['merge'] = mc;\n                    Store.config['borderInfo'] = borderInfo;\n                    ///setTimeout(function () {\n                    ////    luckysheetrefreshgrid();\n                    ///}, 1);\n                    Store.refresh();\n                }\n            } else if (type == 'f') {\n                //筛选\n                let op = item.op, pos = item.pos;\n                let filter = file.filter;\n                if (filter == null) {\n                    filter = {};\n                }\n                if (op == 'upOrAdd') {\n                    filter[pos] = value;\n                } else if (op == 'del') {\n                    delete filter[pos];\n                }\n                if (index == Store.currentSheetIndex) {\n                    createFilterOptions(file.filter_select, filter);\n                }\n            } else if (type == 'fsc') {\n                //清除筛选\n                file.filter = null;\n                file.filter_select = null;\n                if (index == Store.currentSheetIndex) {\n                    $('#luckysheet-filter-selected-sheet' + Store.currentSheetIndex + ', #luckysheet-filter-options-sheet' + Store.currentSheetIndex).remove();\n                    $('#luckysheet-filter-menu, #luckysheet-filter-submenu').hide();\n                }\n            } else if (type == 'fsr') {\n                //恢复筛选\n                file.filter = value.filter;\n                file.filter_select = value.filter_select;\n                if (index == Store.currentSheetIndex) {\n                    createFilterOptions(file.filter_select, file.filter);\n                }\n            } else if (type == 'sha') {\n                //新建sheet\n                Store.luckysheetfile.push(value);\n                let colorset = '';\n                if (value.color != null) {\n                    colorset = '<div class=\"luckysheet-sheets-item-color\" style=\" position: absolute; width: 100%; height: 3px; bottom: 0px; left: 0px; background-color: ' + value.color + ';\"></div>';\n                }\n                $('#luckysheet-sheet-container-c').append(replaceHtml(sheetHTML, {\n                    'index': value.index,\n                    'active': '',\n                    'name': value.name,\n                    'style': '',\n                    'colorset': colorset\n                }));\n                $('#luckysheet-cell-main').append('<div id=\"luckysheet-datavisual-selection-set-' + value.index + '\" class=\"luckysheet-datavisual-selection-set\"></div>');\n            } else if (type == 'shc') {\n                //复制sheet\n                let copyindex = value.copyindex, name = value.name;\n                let copyarrindex = getSheetIndex(copyindex);\n                let copyjson = $.extend(true, {}, Store.luckysheetfile[copyarrindex]);\n                copyjson.index = index;\n                copyjson.name = name;\n                Store.luckysheetfile.splice(copyarrindex + 1, 0, copyjson);\n                let copyobject = $('#luckysheet-sheets-item' + copyindex);\n                $('#luckysheet-sheet-container-c').append(replaceHtml(sheetHTML, {\n                    'index': copyjson.index,\n                    'active': '',\n                    'name': copyjson.name,\n                    'style': '',\n                    'colorset': ''\n                }));\n                $('#luckysheet-sheets-item' + copyjson.index).insertAfter(copyobject);\n                $('#luckysheet-cell-main').append('<div id=\"luckysheet-datavisual-selection-set-' + copyjson.index + '\" class=\"luckysheet-datavisual-selection-set\"></div>');\n            } else if (type == 'shd') {\n                //删除sheet\n                for (let i = 0; i < Store.luckysheetfile.length; i++) {\n                    if (Store.luckysheetfile[i].index == value.deleIndex) {\n                        // 如果删除的是当前sheet，则切换到前一个sheet页\n                        if (Store.currentSheetIndex === value.deleIndex) {\n                            const index = value.deleIndex;\n                            Store.luckysheetfile[Store.getSheetIndex(index)].hide = 1;\n                            let luckysheetcurrentSheetitem = $('#luckysheet-sheets-item' + index);\n                            luckysheetcurrentSheetitem.hide();\n                            $('#luckysheet-sheet-area div.luckysheet-sheets-item').removeClass('luckysheet-sheets-item-active');\n                            let indicator = luckysheetcurrentSheetitem.nextAll(':visible');\n                            if (luckysheetcurrentSheetitem.nextAll(':visible').length > 0) {\n                                indicator = indicator.eq(0).data('index');\n                            } else {\n                                indicator = luckysheetcurrentSheetitem.prevAll(':visible').eq(0).data('index');\n                            }\n                            $('#luckysheet-sheets-item' + indicator).addClass('luckysheet-sheets-item-active');\n                            Store.changeSheet(indicator);\n                        }\n                        server.sheetDeleSave.push(Store.luckysheetfile[i]);\n                        Store.luckysheetfile.splice(i, 1);\n                        break;\n                    }\n                }\n                $('#luckysheet-sheets-item' + value.deleIndex).remove();\n                $('#luckysheet-datavisual-selection-set-' + value.deleIndex).remove();\n            } else if (type == 'shr') {\n                //sheet位置\n                for (let x in value) {\n                    Store.luckysheetfile[getSheetIndex(x)].order = value[x];\n                }\n            } else if (type == 'shre') {\n                //删除sheet恢复操作\n                for (let i = 0; i < server.sheetDeleSave.length; i++) {\n                    if (server.sheetDeleSave[i].index == value.reIndex) {\n                        let datav = server.sheetDeleSave[i];\n                        Store.luckysheetfile.push(datav);\n                        let colorset = '';\n                        if (value.color != null) {\n                            colorset = '<div class=\"luckysheet-sheets-item-color\" style=\" position: absolute; width: 100%; height: 3px; bottom: 0px; left: 0px; background-color: ' + datav.color + ';\"></div>';\n                        }\n                        $('#luckysheet-sheet-container-c').append(replaceHtml(sheetHTML, {\n                            'index': datav.index,\n                            'active': '',\n                            'name': datav.name,\n                            'style': '',\n                            'colorset': colorset\n                        }));\n                        $('#luckysheet-cell-main').append('<div id=\"luckysheet-datavisual-selection-set-' + datav.index + '\" class=\"luckysheet-datavisual-selection-set\"></div>');\n                        break;\n                    }\n                }\n            } else if (type == 'sh') {\n                //隐藏sheet\n                let op = item.op, cur = item.cur;\n                if (op == 'hide') {\n                    file.hide = 1;\n                    $('#luckysheet-sheets-item' + index).hide();\n                    if (index == Store.currentSheetIndex) {\n                        $('#luckysheet-sheets-item' + cur).addClass('luckysheet-sheets-item-active');\n                        Store.changeSheet(cur);\n                    }\n                } else if (op == 'show') {\n                    file.hide = 0;\n                    $('#luckysheet-sheets-item' + index).show();\n                }\n            } else if (type == 'c') {\n                //图表操作 TODO\n                let op = item.op, cid = item.cid;\n                if (op == 'add') {\n                    //插入\n                    file.chart.push(value);\n                    luckysheet.insertChartTosheet(value.sheetIndex, value.dataSheetIndex, value.option, value.chartType, value.selfOption, value.defaultOption, value.row, value.column, value.chart_selection_color, value.chart_id, value.chart_selection_id, value.chartStyle, value.rangeConfigCheck, value.rangeRowCheck, value.rangeColCheck, value.chartMarkConfig, value.chartTitleConfig, value.winWidth, value.winHeight, value.scrollLeft1, value.scrollTop1, value.chartTheme, value.myWidth, value.myHeight, value.myLeft, value.myTop, value.myindexrank1, true);\n                } else if (op == 'xy' || op == 'wh' || op == 'update') {\n                    //移动 缩放 更新\n                    for (let i = 0; i < file.chart.length; i++) {\n                        let chartjson = file.chart[i];\n                        if (chartjson.chart_id == cid) {\n                            for (let item in chartjson) {\n                                for (let vitem in value) {\n                                    if (item == vitem) {\n                                        chartjson[item] = value[vitem];\n                                    }\n                                }\n                            }\n                            sheets.saveChart(chartjson);\n                            return;\n                        }\n                    }\n                } else if (op == 'del') {\n                    //删除\n                    for (let i = 0; i < file.chart.length; i++) {\n                        let chartjson = file.chart[i];\n                        if (chartjson.chart_id == cid) {\n                            file.chart.splice(i, 1);\n                            $('#' + cid).remove();\n                            sheets.delChart($('#' + cid).attr('chart_id'), $('#' + cid).attr('sheetIndex'));\n                            return;\n                        }\n                    }\n                }\n            } else if (type == 'na') {\n                //表格名称\n                $('#luckysheet_info_detail_input').val(value).css('width', getByteLen(value) * 10);\n            }\n        },\n        multipleIndex: 0,\n        multipleRangeShow: function (id, name, r, c, value) {\n            let _this = this;\n            let row = Store.visibledatarow[r], row_pre = r - 1 == -1 ? 0 : Store.visibledatarow[r - 1], col = Store.visibledatacolumn[c], col_pre = c - 1 == -1 ? 0 : Store.visibledatacolumn[c - 1];\n            let margeset = cells.mergeborer(Store.flowdata, r, c);\n            if (!!margeset) {\n                row = margeset.row[1];\n                row_pre = margeset.row[0];\n                col = margeset.column[1];\n                col_pre = margeset.column[0];\n            }    // 超出16个字符就显示...\n            // 超出16个字符就显示...\n            if (getByteLen(name) > 16) {\n                name = getByteLen(name, 16) + '...';\n            }    // 如果正在编辑，就显示“正在输入”\n            // 如果正在编辑，就显示“正在输入”\n            if (value === 'enterEdit') {\n                name += ' ' + locale().edit.typing;\n            }\n            if ($('#luckysheet-multipleRange-show-' + id).length > 0) {\n                $('#luckysheet-multipleRange-show-' + id).css({\n                    'position': 'absolute',\n                    'left': col_pre - 1,\n                    'width': col - col_pre - 1,\n                    'top': row_pre - 1,\n                    'height': row - row_pre - 1\n                });\n                $('#luckysheet-multipleRange-show-' + id + ' .username').text(name);\n                $('#luckysheet-multipleRange-show-' + id + ' .username').show();\n                if (Store.cooperativeEdit.usernameTimeout['user' + id] != null) {\n                    clearTimeout(Store.cooperativeEdit.usernameTimeout['user' + id]);\n                }\n                Store.cooperativeEdit.usernameTimeout['user' + id] = setTimeout(() => {\n                    clearTimeout(Store.cooperativeEdit.usernameTimeout['user' + id]);\n                    Store.cooperativeEdit.usernameTimeout['user' + id] = null;\n                }, 10 * 1000);\n            } else {\n                // let itemHtml = '<div id=\"luckysheet-multipleRange-show-'+ id +'\" data-color=\"'+ luckyColor[_this.multipleIndex] +'\" title=\"'+ name +'\" style=\"position: absolute;left: '+ (col_pre - 1) +'px;width: '+ (col - col_pre - 1) +'px;top: '+ (row_pre - 1) +'px;height: '+ (row - row_pre - 1) +'px;border: 1px solid '+ luckyColor[_this.multipleIndex] +';z-index: 15;\">'+\n                //                 '<div style=\"width: 100%;height: 100%;position: absolute;top: 0;right: 0;bottom: 0;left: 0;opacity: 0.03;background-color: '+ luckyColor[_this.multipleIndex] +'\"></div>'+\n                //                '</div>';\n                let itemHtml = `<div \n\t\t\t\t\t\t\t\tid=\"luckysheet-multipleRange-show-${ id }\"\n\t\t\t\t\t\t\t\tclass=\"luckysheet-multipleRange-show\"\n\t\t\t\t\t\t\t\tdata-color=\"${ luckyColor[_this.multipleIndex] }\" \n\t\t\t\t\t\t\t\ttitle=\"${ name }\" \n\t\t\t\t\t\t\t\tstyle=\"position: absolute;left: ${ col_pre - 1 }px;width: ${ col - col_pre - 1 }px;top: ${ row_pre - 1 }px;height: ${ row - row_pre - 1 }px;border: 1px solid ${ luckyColor[_this.multipleIndex] };z-index: 15;\">\n\n\t\t\t\t\t\t\t\t<div class=\"username\" style=\"height: 19px;line-height:19px;width: max-content;position: absolute;bottom: ${ row - row_pre - 1 }px;right: 0;background-color: ${ luckyColor[_this.multipleIndex] };color:#ffffff;padding:0 10px;\">\n\t\t\t\t\t\t\t\t${ name }\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div style=\"width: 100%;height: 100%;position: absolute;top: 0;right: 0;bottom: 0;left: 0;opacity: 0.03;background-color: ${ luckyColor[_this.multipleIndex] }\">\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t</div>`;    // 正在输入\n                // 正在输入\n                $(itemHtml).appendTo($('#luckysheet-cell-main #luckysheet-multipleRange-show'));\n                _this.multipleIndex++;    // 设定允许用户名消失的定时器，10秒后用户名可隐藏\n                                          // 10秒之类，用户操作界面不会隐藏用户名；10秒之后如果用户操作了界面，则隐藏用户名，没操作就不隐藏\n                // 设定允许用户名消失的定时器，10秒后用户名可隐藏\n                // 10秒之类，用户操作界面不会隐藏用户名；10秒之后如果用户操作了界面，则隐藏用户名，没操作就不隐藏\n                if (Store.cooperativeEdit.usernameTimeout['user' + id] != null) {\n                    clearTimeout(Store.cooperativeEdit.usernameTimeout['user' + id]);\n                }\n                Store.cooperativeEdit.usernameTimeout['user' + id] = setTimeout(() => {\n                    clearTimeout(Store.cooperativeEdit.usernameTimeout['user' + id]);\n                    Store.cooperativeEdit.usernameTimeout['user' + id] = null;\n                }, 10 * 1000);\n            }\n        },\n        sheetDeleSave: [],\n        //共享编辑模式下 删除的sheet保存下来，方便恢复时取值\n        submitInterval: 1000,\n        imagesubmitInterval: 5000,\n        submitdatalimit: 50,\n        submitcompresslimit: 1000,\n        checksubmit: function (data) {\n            let _this = this;    //clearTimeout(_this.requestTimeOut);\n            //clearTimeout(_this.requestTimeOut);\n            _this.submitTimeout();\n            clearTimeout(_this.imageRequestTimeout);\n            _this.imageRequestTimeout = setTimeout(function () {\n                _this.imageRequest();\n            }, _this.imagesubmitInterval);\n        },\n        submitTimeout: function () {\n            let _this = this;\n            clearTimeout(_this.requestTimeOut);    //console.log(_this.requestlast, dayjs(), (_this.requestlast!=null && _this.requestlast.add(10, 'seconds').isBefore(dayjs()) ) );\n            //console.log(_this.requestlast, dayjs(), (_this.requestlast!=null && _this.requestlast.add(10, 'seconds').isBefore(dayjs()) ) );\n            if (!_this.requestLock && (_this.requestlast != null && _this.requestlast.clone().add(1, 'seconds').isBefore(dayjs()))) {\n                _this.request();\n            }    // if(!_this.imageRequestLock && (_this.imageRequestLast==null || _this.imageRequestLast.clone().add(30, 'seconds').isBefore(dayjs()) ) ){\n                 // }\n            // if(!_this.imageRequestLock && (_this.imageRequestLast==null || _this.imageRequestLast.clone().add(30, 'seconds').isBefore(dayjs()) ) ){\n            // }\n            _this.requestTimeOut = setTimeout(function () {\n                _this.submitTimeout();\n            }, _this.submitInterval);\n        },\n        requestLock: false,\n        requestlast: null,\n        firstchange: true,\n        requestTimeOut: null,\n        request: function () {\n            let _this = this;\n            let key = this.gridKey;\n            let cahce_key = key + '__qkcache';\n            _this.cachelocaldata(function (cahce_key, params) {\n                if (params.length == 0) {\n                    return;\n                }\n                params = encodeURIComponent(JSON.stringify(params));\n                let compressBeginLen = params.length;\n                let iscommpress = false;    // if (compressBeginLen > _this.submitcompresslimit) {\n                                            //     params = pako.gzip(params, { to: \"string\" });\n                                            //     iscommpress = true;\n                                            // }\n                // if (compressBeginLen > _this.submitcompresslimit) {\n                //     params = pako.gzip(params, { to: \"string\" });\n                //     iscommpress = true;\n                // }\n                _this.requestLock = true;    //console.log(params);\n                                             // console.log(\"request\");\n                //console.log(params);\n                // console.log(\"request\");\n                if (_this.updateUrl != '') {\n                    $.post(_this.updateUrl, {\n                        compress: iscommpress,\n                        gridKey: _this.gridKey,\n                        data: params\n                    }, function (data) {\n                        let re = new Function('return ' + data)();\n                        if (re.status) {\n                            $('#luckysheet_info_detail_update').html('最近存档时间:' + dayjs().format('M-D H:m:s'));\n                            $('#luckysheet_info_detail_save').html('同步成功');\n                            _this.clearcachelocaldata();\n                        } else {\n                            $('#luckysheet_info_detail_save').html(\"<span style='color:#ff2121'>同步失败</span>\");\n                            _this.restorecachelocaldata();\n                        }\n                        _this.requestlast = dayjs();\n                        _this.requestLock = false;\n                    });\n                }\n            });\n        },\n        imageRequestLast: null,\n        imageRequestLock: false,\n        imageRequestTimeout: null,\n        imageRequest: function () {\n            let _this = this;\n            html2canvas($('#' + container).find('.luckysheet-grid-window').get(0), {\n                onrendered: function (canvas) {\n                    //let imgcut = $(\"#luckysheet-cell-main\").find(\".luckysheet-grid-window\");\n                    //document.body.appendChild(canvas);\n                    let old = $(canvas).appendTo('body');\n                    old.hide();\n                    let newwidth = old.width();\n                    let newheight = old.height();\n                    let imageData = old.get(0).getContext('2d').getImageData(0, 0, newwidth, newheight);\n                    let cutW = newwidth, cutH = newheight;\n                    if (cutW * 0.54 > cutH) {\n                        cutW = cutH / 0.54;\n                    } else {\n                        cutH = cutW * 0.54;\n                    }\n                    let newCanvas = $('<canvas>').attr('width', cutW).attr('height', cutH)[0];\n                    newCanvas.getContext('2d').putImageData(imageData, 0, 0);\n                    old.attr('width', 350);\n                    old.attr('height', 189);\n                    old.get(0).getContext('2d').drawImage(newCanvas, 0, 0, 350, 189);\n                    let base64 = old.get(0).toDataURL('image/jpeg', 0.9);    //console.log(base64);\n                                                                             //console.log(\"压缩：\", pako.gzip(base64, { to: \"string\" }));\n                                                                             //console.log(\"imageRequest\");\n                    //console.log(base64);\n                    //console.log(\"压缩：\", pako.gzip(base64, { to: \"string\" }));\n                    //console.log(\"imageRequest\");\n                    let curindex = Store.getCurSheetnoset();\n                    _this.imageRequestLock = true;    // let data1 = pako.gzip(encodeURIComponent(JSON.stringify({\"t\":\"thumb\", \"img\": base64, \"curindex\":curindex })), { to: \"string\" });\n                    // let data1 = pako.gzip(encodeURIComponent(JSON.stringify({\"t\":\"thumb\", \"img\": base64, \"curindex\":curindex })), { to: \"string\" });\n                    let data1 = encodeURIComponent(JSON.stringify({\n                        't': 'thumb',\n                        'img': base64,\n                        'curindex': curindex\n                    }));\n                    old.remove();    //console.log(\"缩略图\", _this.imageRequestLast,base64);\n                    //console.log(\"缩略图\", _this.imageRequestLast,base64);\n                    if (_this.updateImageUrl != '') {\n                        // $.post(_this.updateImageUrl, { compress: true, gridKey: _this.gridKey, data:data1  }, function (data) {\n                        $.post(_this.updateImageUrl, {\n                            compress: false,\n                            gridKey: _this.gridKey,\n                            data: data1\n                        }, function (data) {\n                            let re = new Function('return ' + data)();\n                            if (re.status) {\n                                imageRequestLast = dayjs();\n                            } else {\n                                $('#luckysheet_info_detail_save').html(\"<span style='color:#ff2121'>网络不稳定</span>\");\n                            }\n                            _this.imageRequestLock = true;\n                        });\n                    }\n                }\n            });\n        },\n        localdata: [],\n        matchOpt: function (v, d) {\n            for (let vitem in v) {\n                if (vitem == 't' && v['t'] in {\n                        'drc': 1,\n                        'arc': 1,\n                        'sha': 1,\n                        'shc': 1,\n                        'shd': 1\n                    }) {\n                    return false;\n                }\n                if (vitem == 'v') {\n                    continue;\n                }\n                if (!(vitem in d)) {\n                    return false;\n                }\n                if (d[vitem] != v[vitem]) {\n                    return false;\n                }\n            }\n            return true;\n        },\n        deleteRepeatOpt: function (data, value) {\n            //let d = $.extend(true, [], data); //原来\n            let d = data;\n            let _this = this;\n            if (value instanceof Array) {\n                for (let i = 0; i < value.length; i++) {\n                    let vitem = value[i];\n                    for (let a = 0; a < d.length; a++) {\n                        let ditem = data[i];    //let ditem = data[a];?\n                        //let ditem = data[a];?\n                        if (_this.matchOpt(vitem, ditem)) {\n                            delete d[a];\n                        }\n                    }\n                }\n            } else {\n                for (let a = 0; a < d.length; a++) {\n                    let ditem = d[a];\n                    if (_this.matchOpt(value, ditem)) {\n                        delete d[a];\n                    }\n                }\n            }\n            let ret = [];\n            for (let i = 0; i < d.length; i++) {\n                if (d[i] != null) {\n                    ret.push(d[i]);\n                }\n            }\n            return ret;\n        },\n        setlocaldata: function (value, func) {\n            let key = this.gridKey;    //store.push(key, data);\n            //store.push(key, data);\n            let _this = this;\n            _this.getlocaldata(function (data) {\n                if (data == null) {\n                    data = [];\n                }    //此处不去重，在request同步后台时统一循环一次去重\n                     //let data = _this.deleteRepeatOpt(data, value);\n                //此处不去重，在request同步后台时统一循环一次去重\n                //let data = _this.deleteRepeatOpt(data, value);\n                if (value instanceof Array) {\n                    data = data.concat(value);\n                } else {\n                    data.push(value);\n                }\n                _this.localdata = data;\n                func(_this.localdata);    //console.log(value);\n                                          // localforage.setItem(key, data).then(function () {\n                                          //     console.log(data);\n                                          //     func(data);\n                                          // }).catch(function (err) {\n                                          // });\n            });\n        },\n        //console.log(value);\n        // localforage.setItem(key, data).then(function () {\n        //     console.log(data);\n        //     func(data);\n        // }).catch(function (err) {\n        // });\n        getlocaldata: function (func) {\n            let key = this.gridKey;    //return store.get(key);\n            //return store.get(key);\n            func(this.localdata);    // localforage.getItem(key).then(function(readValue) {\n                                     //     func(readValue);\n                                     // });\n        },\n        // localforage.getItem(key).then(function(readValue) {\n        //     func(readValue);\n        // });\n        clearlocaldata: function (func) {\n            let key = this.gridKey;    //store.remove(key);\n            //store.remove(key);\n            this.localdata = [];\n            func();    // localforage.removeItem(key, function(err,value) {\n                       //     func();\n                       // });\n        },\n        // localforage.removeItem(key, function(err,value) {\n        //     func();\n        // });\n        cachelocaldata: function (func) {\n            let key = this.gridKey;\n            let _this = this;\n            let cahce_key = key + '__qkcache';    //store.remove(key);\n                                                  //console.log(key, cahce_key);\n                                                  //处理localdata去重\n            //store.remove(key);\n            //console.log(key, cahce_key);\n            //处理localdata去重\n            let updatedata = _this.localdata;\n            let uLen = updatedata.length;\n            if (uLen > 1) {\n                let prevData = [];\n                prevData[0] = updatedata[0];\n                for (let i = 1; i < uLen; i++) {\n                    let value = updatedata[i];\n                    let flag = true;\n                    for (let a = 0; a < prevData.length; a++) {\n                        let ditem = prevData[a];\n                        if (_this.matchOpt(value, ditem)) {\n                            prevData.splice(a, 1, value);\n                            flag = false;    //如果已匹配重复，则后续无需再加\n                            //如果已匹配重复，则后续无需再加\n                            break;\n                        }\n                    }\n                    if (flag) {\n                        prevData = prevData.concat(value);\n                    }\n                }\n                updatedata = prevData;\n            }\n            if (updatedata == null || updatedata.length == 0) {\n                return;\n            }    //console.log(key, cahce_key,updatedata);\n            //console.log(key, cahce_key,updatedata);\n            _this.clearlocaldata(function () {\n                localforage.setItem(cahce_key, updatedata).then(function () {\n                    func(cahce_key, updatedata);\n                });\n            });    // localforage.getItem(key).then(function(readValue) {\n                   //     let updatedata = readValue;\n                   //     if(readValue==null || readValue.length==0){\n                   //         return;\n                   //     }\n                   //     //console.log(key, cahce_key,updatedata);\n                   //     _this.clearlocaldata(function(){\n                   //         localforage.setItem(cahce_key, updatedata).then(function () {\n                   //             func(cahce_key, updatedata);\n                   //         });\n                   //     });\n                   // });\n        },\n        // localforage.getItem(key).then(function(readValue) {\n        //     let updatedata = readValue;\n        //     if(readValue==null || readValue.length==0){\n        //         return;\n        //     }\n        //     //console.log(key, cahce_key,updatedata);\n        //     _this.clearlocaldata(function(){\n        //         localforage.setItem(cahce_key, updatedata).then(function () {\n        //             func(cahce_key, updatedata);\n        //         });\n        //     });\n        // });\n        clearcachelocaldata: function (func) {\n            let key = this.gridKey;\n            let cahce_key = key + '__qkcache';    //store.remove(key);\n            //store.remove(key);\n            localforage.removeItem(cahce_key, function (err, value) {\n                if (func && typeof func == 'function') {\n                    func();\n                }\n            });\n        },\n        restorecachelocaldata: function (func) {\n            let key = this.gridKey;\n            let cahce_key = key + '__qkcache';\n            let _this = this;\n            localforage.getItem(cahce_key).then(function (readValue) {\n                let updatedata = readValue;\n                _this.getlocaldata(function (data) {\n                    if (data == null) {\n                        data = [];\n                    }\n                    let newdata = updatedata.concat(data);    //data.unshift(updatedata);\n                    //data.unshift(updatedata);\n                    _this.localdata = newdata;\n                    if (func instanceof Function) {\n                        func(_this.localdata);\n                    }    // localforage.setItem(key, newdata).then(function () {\n                         //     func(newdata);\n                         // }).catch(function (err) {\n                         // });\n                });\n            });\n        },\n        // localforage.setItem(key, newdata).then(function () {\n        //     func(newdata);\n        // }).catch(function (err) {\n        // });\n        keepHighLightBox: function () {\n            Store.cooperativeEdit.checkoutData.forEach(value => {\n                if (value.index == Store.currentSheetIndex) {\n                    if (value.op === 'enterEdit') {\n                        server.multipleRangeShow(value.id, value.username, value.r, value.c, value.op);\n                    } else {\n                        server.multipleRangeShow(value.id, value.username, value.r, value.c);\n                    }\n                }\n            });\n        }\n    };\n    return server;\n});"]}