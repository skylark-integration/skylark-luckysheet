{"version":3,"sources":["controllers/insertFormula.js"],"names":["define","m_func","formula","m_validate","m_constant","m_select","m_util","Store","locale","luckysheet_getcelldata","isRealNum","isRealNull","modelHTML","luckysheet_count_show","replaceHtml","getObjType","init","_this","this","_locale","locale_formulaMore","formulaMore","locale_button","button","$","document","off","on","empty","txt","val","toUpperCase","functionlist","formulaListByType","i","length","test","n","indexOf","a","appendTo","addClass","type","siblings","removeClass","attr","formulaTxt","html","formulaParmDialog","parmIndex","parents","index","data_parm_index","parmDetail","parmRepeat","formulatxt","find","text","parmLen","luckysheet_function","p","detail","repeat","parmTxtShow","functionStrCompute","parmName","parmCount","valueTitle","tipSelectDataRange","getfunctionParam","fn","iscelldata","lastIndexOf","hide","remove","append","id","addclass","title","content","tipDataRangeTile","botton","confirm","style","$t","css","end","myh","outerHeight","myw","outerWidth","winw","window","width","winh","height","scrollLeft","scrollTop","left","top","show","click","eq","focus","formulaListDialog","findFunctionTitle","tipInputFunctionName","selectCategory","Math","Statistical","Lookup","luckysheet","dataMining","Database","Date","Filter","Financial","Engineering","Logical","Operator","Text","Parser","Array","other","selectFunctionTitle","cancel","user-select","t","parm","parm_title","parm_content","parm_list_content","j","name","d","calculationResult","each","e","parmtxt","txtdata","data","txtArr","cell","v","push","join","Function","trim","functionParserExe","rangestart","cellrange","getcellrange","r1","row","r2","c1","column","c2","visibledatarow","row_pre","col","visibledatacolumn","col_pre","k","param","functionHtmlTxt","isVal","parmValArr","lvi","parmRequire","require","function_str","functionHTMLGenerate","fp","result","error"],"mappings":"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","file":"../../controllers/insertFormula.js","sourcesContent":["define([\n    '../function/func',\n    '../global/formula',\n    '../global/validate',\n    './constant',\n    './select',\n    '../utils/util',\n    '../store',\n    '../locale/locale'\n], function (m_func, formula, m_validate, m_constant, m_select, m_util, Store, locale) {\n    'use strict';\n    const {luckysheet_getcelldata} = m_func;\n    const {isRealNum, isRealNull} = m_validate;\n    const {modelHTML} = m_constant;\n    const {luckysheet_count_show} = m_select;\n    const {replaceHtml, getObjType} = m_util;\n    //插入函数\n    const insertFormula = {\n        init: function () {\n            let _this = this;\n            let _locale = locale();\n            let locale_formulaMore = _locale.formulaMore;\n            let locale_button = _locale.button;\n            $(document).off('keyup.fxSFLI').on('keyup.fxSFLI', '#searchFormulaListInput', function () {\n                $('#formulaTypeList').empty();\n                let txt = $(this).val().toUpperCase();\n                let functionlist = Store.functionlist;\n                if (txt == '') {\n                    //若没有查找内容则根据类别筛选\n                    _this.formulaListByType($('#formulaTypeSelect option:selected').val());\n                } else {\n                    for (let i = 0; i < functionlist.length; i++) {\n                        if (/^[a-zA-Z]+$/.test(txt)) {\n                            if (functionlist[i].n.indexOf(txt) != '-1') {\n                                $('<div class=\"listBox\" name=\"' + functionlist[i].n + '\"><span>' + functionlist[i].n + '</span><span>' + functionlist[i].a + '</span></div>').appendTo($('#formulaTypeList'));\n                            }\n                        } else if (functionlist[i].a.indexOf(txt) != '-1') {\n                            $('<div class=\"listBox\" name=\"' + functionlist[i].n + '\"><span>' + functionlist[i].n + '</span><span>' + functionlist[i].a + '</span></div>').appendTo($('#formulaTypeList'));\n                        }\n                    }\n                }\n                $('#formulaTypeList .listBox:first-child').addClass('on');    //默认公式列表第一个为选中状态\n            });\n            //默认公式列表第一个为选中状态\n            $(document).off('change.fxFormulaTS').on('change.fxFormulaTS', '#formulaTypeSelect', function () {\n                let type = $('#formulaTypeSelect option:selected').val();\n                _this.formulaListByType(type);\n            });\n            $(document).off('click.fxListbox').on('click.fxListbox', '#formulaTypeList .listBox', function () {\n                $(this).addClass('on').siblings().removeClass('on');\n            });    //选择公式后弹出参数栏弹框\n            //选择公式后弹出参数栏弹框\n            $(document).off('click.fxFormulaCf').on('click.fxFormulaCf', '#luckysheet-search-formula-confirm', function () {\n                let formula = $('#luckysheet-search-formula .listBox.on').attr('name');\n                let formulaTxt = '<span dir=\"auto\" class=\"luckysheet-formula-text-color\">=</span><span dir=\"auto\" class=\"luckysheet-formula-text-color\">' + formula.toUpperCase() + '</span><span dir=\"auto\" class=\"luckysheet-formula-text-color\">(</span><span dir=\"auto\" class=\"luckysheet-formula-text-color\">)</span>';\n                $('#luckysheet-rich-text-editor').html(formulaTxt);\n                $('#luckysheet-functionbox-cell').html($('#luckysheet-rich-text-editor').html());\n                _this.formulaParmDialog(formula);\n            });    //公式参数框\n            //公式参数框\n            $(document).off('focus.fxParamInput').on('focus.fxParamInput', '#luckysheet-search-formula-parm .parmBox input', function () {\n                let parmIndex = $(this).parents('.parmBox').index();\n                formula.data_parm_index = parmIndex;\n                let formulatxt = $(this).parents('#luckysheet-search-formula-parm').find('.luckysheet-modal-dialog-title-text').text();\n                let parmLen = Store.luckysheet_function[formulatxt].p.length;\n                let parmDetail, parmRepeat;\n                if (parmIndex >= parmLen) {\n                    parmDetail = Store.luckysheet_function[formulatxt].p[parmLen - 1].detail;\n                    parmRepeat = Store.luckysheet_function[formulatxt].p[parmLen - 1].repeat;\n                } else {\n                    parmDetail = Store.luckysheet_function[formulatxt].p[parmIndex].detail;\n                    parmRepeat = Store.luckysheet_function[formulatxt].p[parmIndex].repeat;\n                }    //参数选区显示，参数值显示\n                //参数选区显示，参数值显示\n                _this.parmTxtShow($(this).val());    //计算结果\n                //计算结果\n                _this.functionStrCompute();    //参数名称和释义切换\n                //参数名称和释义切换\n                $('#luckysheet-search-formula-parm .parmDetailsBox').empty();\n                let parmName = $(this).parents('.parmBox').find('.name').text();\n                $('<span>' + parmName + ':</span><span>' + parmDetail + '</span>').appendTo($('#luckysheet-search-formula-parm .parmDetailsBox'));    //公式参数可自增（参数自增最多5个）\n                //公式参数可自增（参数自增最多5个）\n                if (parmRepeat == 'y') {\n                    let parmCount = $('#luckysheet-search-formula-parm .parmBox').length;\n                    if (parmCount < 5 && parmIndex == parmCount - 1) {\n                        $('<div class=\"parmBox\"><div class=\"name\">' + locale_formulaMore.valueTitle + '' + (parmCount + 1) + '</div><div class=\"txt\"><input class=\"formulaInputFocus\" /><i class=\"fa fa-table\" aria-hidden=\"true\" title=\"' + locale_formulaMore.tipSelectDataRange + '\"></i></div><div class=\"val\">=</div></div>').appendTo($('#luckysheet-search-formula-parm .parmListBox'));\n                    }\n                }\n            });\n            $(document).off('blur.fxParamInput').on('blur.fxParamInput', '#luckysheet-search-formula-parm .parmBox input', function () {\n                let txt = $(this).val();\n                if (formula.getfunctionParam(txt).fn == null && !formula.iscelldata(txt)) {\n                    if (!isRealNum(txt) && txt != '' && txt.length <= 2 && txt.indexOf('\"') != 0 && txt.lastIndexOf('\"') != 0) {\n                        txt = '\"' + txt + '\"';\n                        $(this).val(txt);\n                        _this.parmTxtShow(txt);\n                        _this.functionStrCompute();\n                    }\n                }\n            });\n            $(document).off('keyup.fxParamInput').on('keyup.fxParamInput', '#luckysheet-search-formula-parm .parmBox input', function () {\n                //参数选区显示，参数值显示\n                _this.parmTxtShow($(this).val());    //计算结果\n                //计算结果\n                _this.functionStrCompute();\n            });    //点击图标选取数据范围\n            //点击图标选取数据范围\n            $(document).off('click.fxParamI').on('click.fxParamI', '#luckysheet-search-formula-parm .parmBox i', function () {\n                formula.data_parm_index = $(this).parents('.parmBox').index();    //选取范围弹出框\n                //选取范围弹出框\n                $('#luckysheet-search-formula-parm').hide();\n                $('#luckysheet-modal-dialog-mask').hide();\n                $('#luckysheet-search-formula-parm-select').remove();\n                if ($(this).parents('.parmBox').find('.txt input').val() == '') {\n                    $('body').append(replaceHtml(modelHTML, {\n                        'id': 'luckysheet-search-formula-parm-select',\n                        'addclass': 'luckysheet-search-formula-parm-select',\n                        'title': locale_formulaMore.tipSelectDataRange,\n                        'content': \"<input id='luckysheet-search-formula-parm-select-input' class='luckysheet-datavisual-range-container' style='font-size: 14px;padding:5px;max-width:none;' spellcheck='false' aria-label='\" + locale_formulaMore.tipDataRangeTile + \"' readonly='true' placeholder='\" + locale_formulaMore.tipDataRangeTile + \"'>\",\n                        'botton': '<button id=\"luckysheet-search-formula-parm-select-confirm\" class=\"btn btn-primary\">' + locale_button.confirm + '</button>',\n                        'style': 'z-index:100003'\n                    }));\n                } else {\n                    $('body').append(replaceHtml(modelHTML, {\n                        'id': 'luckysheet-search-formula-parm-select',\n                        'addclass': 'luckysheet-search-formula-parm-select',\n                        'title': locale_formulaMore.tipSelectDataRange,\n                        'content': \"<input id='luckysheet-search-formula-parm-select-input' class='luckysheet-datavisual-range-container' style='font-size: 14px;padding:5px;max-width:none;' spellcheck='false' aria-label='\" + locale_formulaMore.tipDataRangeTile + \"' readonly='true' value='\" + $(this).parents('.parmBox').find('.txt input').val() + \"'>\",\n                        'botton': '<button id=\"luckysheet-search-formula-parm-select-confirm\" class=\"btn btn-primary\">' + locale_button.confirm + '</button>',\n                        'style': 'z-index:100003'\n                    }));\n                }\n                let $t = $('#luckysheet-search-formula-parm-select').find('.luckysheet-modal-dialog-content').css('min-width', 300).end(), myh = $t.outerHeight(), myw = $t.outerWidth();\n                let winw = $(window).width(), winh = $(window).height();\n                let scrollLeft = $(document).scrollLeft(), scrollTop = $(document).scrollTop();\n                $('#luckysheet-search-formula-parm-select').css({\n                    'left': (winw + scrollLeft - myw) / 2,\n                    'top': (winh + scrollTop - myh) / 3\n                }).show();    //参数选区虚线框\n                //参数选区虚线框\n                _this.parmTxtShow($(this).parents('.parmBox').find('.txt input').val());\n            });    //点击确定\n            //点击确定\n            $(document).off('click.fxParamCf').on('click.fxParamCf', '#luckysheet-search-formula-parm-confirm', function () {\n                $('#luckysheet-wa-functionbox-confirm').click();\n            });    //选取范围后传回参数栏弹框\n            //选取范围后传回参数栏弹框\n            $(document).off('click.fxParamSelectCf').on('click.fxParamSelectCf', '#luckysheet-search-formula-parm-select-confirm', function () {\n                let parmIndex = $('#luckysheet-search-formula-parm-select-input').attr('data_parm_index');\n                $('#luckysheet-search-formula-parm-select').hide();\n                $('#luckysheet-search-formula-parm').show();\n                $('#luckysheet-search-formula-parm .parmBox').eq(parmIndex).find('.txt input').focus();\n            });\n        },\n        formulaListDialog: function () {\n            let _this = this;\n            let _locale = locale();\n            let locale_formulaMore = _locale.formulaMore;\n            let locale_button = _locale.button;\n            $('#luckysheet-modal-dialog-mask').show();\n            $('#luckysheet-search-formula').remove();\n            $('body').append(replaceHtml(modelHTML, {\n                'id': 'luckysheet-search-formula',\n                'addclass': 'luckysheet-search-formula',\n                'title': '',\n                'content': \"<div class='inpbox'><label for='searchFormulaListInput'>\" + locale_formulaMore.findFunctionTitle + \"\\uFF1A</label><input class='formulaInputFocus' id='searchFormulaListInput' placeholder='\" + locale_formulaMore.tipInputFunctionName + \"' spellcheck='false'/></div><div class='selbox'><label>\" + locale_formulaMore.selectCategory + \"\\uFF1A</label><select id='formulaTypeSelect'><option value='0'>\" + locale_formulaMore.Math + \"</option><option value='1'>\" + locale_formulaMore.Statistical + \"</option><option value='2'>\" + locale_formulaMore.Lookup + \"</option><option value='3'>\" + locale_formulaMore.luckysheet + \"</option><option value='4'>\" + locale_formulaMore.dataMining + \"</option><option value='5'>\" + locale_formulaMore.Database + \"</option><option value='6'>\" + locale_formulaMore.Date + \"</option><option value='7'>\" + locale_formulaMore.Filter + \"</option><option value='8'>\" + locale_formulaMore.Financial + \"</option><option value='9'>\" + locale_formulaMore.Engineering + \"</option><option value='10'>\" + locale_formulaMore.Logical + \"</option><option value='11'>\" + locale_formulaMore.Operator + \"</option><option value='12'>\" + locale_formulaMore.Text + \"</option><option value='13'>\" + locale_formulaMore.Parser + \"</option><option value='14'>\" + locale_formulaMore.Array + \"</option><option value='-1'>\" + locale_formulaMore.other + \"</option></select></div><div class='listbox'><label>\" + locale_formulaMore.selectFunctionTitle + \"\\uFF1A</label><div id='formulaTypeList'></div></div>\",\n                'botton': '<button id=\"luckysheet-search-formula-confirm\" class=\"btn btn-primary\">' + locale_button.confirm + '</button><button class=\"btn btn-default luckysheet-model-close-btn\">' + locale_button.cancel + '</button>',\n                'style': 'z-index:100003'\n            }));\n            let $t = $('#luckysheet-search-formula').find('.luckysheet-modal-dialog-content').css('min-width', 300).end(), myh = $t.outerHeight(), myw = $t.outerWidth();\n            let winw = $(window).width(), winh = $(window).height();\n            let scrollLeft = $(document).scrollLeft(), scrollTop = $(document).scrollTop();\n            $('#luckysheet-search-formula').css({\n                'left': (winw + scrollLeft - myw) / 2,\n                'top': (winh + scrollTop - myh) / 3,\n                'user-select': 'none'\n            }).show();\n            _this.formulaListByType('0');    //默认公式列表为类型0\n            //默认公式列表为类型0\n            $('#searchFormulaListInput').focus();\n        },\n        formulaListByType: function (type) {\n            $('#formulaTypeList').empty();\n            let functionlist = Store.functionlist;\n            for (let i = 0; i < functionlist.length; i++) {\n                if (type == '-1' && functionlist[i].t > 14 || functionlist[i].t == type) {\n                    $('<div class=\"listBox\" name=\"' + functionlist[i].n + '\"><span>' + functionlist[i].n + '</span><span>' + functionlist[i].a + '</span></div>').appendTo($('#formulaTypeList'));\n                }\n            }\n            $('#formulaTypeList .listBox:first-child').addClass('on');    //默认公式列表第一个为选中状态\n        },\n        //默认公式列表第一个为选中状态\n        formulaParmDialog: function (formulaTxt, parm) {\n            //参数弹出框\n            let parm_title = '', parm_content = '', parm_list_content = '';\n            let _locale = locale();\n            let locale_formulaMore = _locale.formulaMore;\n            let locale_button = _locale.button;\n            let functionlist = Store.functionlist;\n            for (let i = 0; i < functionlist.length; i++) {\n                if (functionlist[i].n == formulaTxt.toUpperCase()) {\n                    parm_title = functionlist[i].n;\n                    for (let j = 0; j < functionlist[i].p.length; j++) {\n                        if (parm == null) {\n                            //无参数\n                            parm_list_content += '<div class=\"parmBox\">' + '<div class=\"name\">' + functionlist[i].p[j].name + '</div>' + '<div class=\"txt\">' + '<input class=\"formulaInputFocus\" spellcheck=\"false\"/>' + '<i class=\"fa fa-table\" aria-hidden=\"true\" title=\"' + locale_formulaMore.tipSelectDataRange + '\"></i>' + '</div>' + '<div class=\"val\">=</div>' + '</div>';\n                        } else {\n                            //有参数\n                            if (parm[j] == null) {\n                                parm[j] = '';\n                            }\n                            parm_list_content += '<div class=\"parmBox\">' + '<div class=\"name\">' + functionlist[i].p[j].name + '</div>' + '<div class=\"txt\">' + '<input class=\"formulaInputFocus\" value=\"' + parm[j] + '\" spellcheck=\"false\"/>' + '<i class=\"fa fa-table\" aria-hidden=\"true\" title=\"' + locale_formulaMore.tipSelectDataRange + '\"></i>' + '</div>' + '<div class=\"val\">=</div>' + '</div>';\n                        }\n                    }\n                    parm_content = '<div>' + '<div class=\"parmListBox\">' + parm_list_content + '</div>' + '<div class=\"formulaDetails\">' + functionlist[i].d + '</div>' + '<div class=\"parmDetailsBox\"></div>' + '<div class=\"result\">' + locale_formulaMore.calculationResult + ' = <span></span></div>' + '</div>';\n                }\n            }\n            $('#luckysheet-search-formula').hide();\n            $('#luckysheet-modal-dialog-mask').hide();\n            $('#luckysheet-search-formula-parm').remove();\n            $('body').append(replaceHtml(modelHTML, {\n                'id': 'luckysheet-search-formula-parm',\n                'addclass': 'luckysheet-search-formula-parm',\n                'title': parm_title,\n                'content': parm_content,\n                'botton': '<button id=\"luckysheet-search-formula-parm-confirm\" class=\"btn btn-primary\">' + locale_button.confirm + '</button><button class=\"btn btn-default luckysheet-model-close-btn\">' + locale_button.cancel + '</button>',\n                'style': 'z-index:100003'\n            }));\n            let $t = $('#luckysheet-search-formula-parm').find('.luckysheet-modal-dialog-content').css('min-width', 300).end(), myh = $t.outerHeight(), myw = $t.outerWidth();\n            let winw = $(window).width(), winh = $(window).height();\n            let scrollLeft = $(document).scrollLeft(), scrollTop = $(document).scrollTop();\n            $('#luckysheet-search-formula-parm').css({\n                'left': (winw + scrollLeft - myw) / 2,\n                'top': (winh + scrollTop - myh) / 3\n            }).show();    //参数栏第一个参数聚焦，显示选取虚线框\n            //参数栏第一个参数聚焦，显示选取虚线框\n            $('#luckysheet-search-formula-parm .parmBox:eq(0) input').focus();    //遍历参数，有参数显示值，无显示空\n            //遍历参数，有参数显示值，无显示空\n            $('#luckysheet-search-formula-parm .parmBox').each(function (index, e) {\n                let parmtxt = $(e).find('.txt input').val();\n                if (formula.getfunctionParam(parmtxt).fn == null) {\n                    //参数不是公式\n                    if (formula.iscelldata(parmtxt)) {\n                        //参数是选区\n                        let txtdata = luckysheet_getcelldata(parmtxt).data;\n                        if (getObjType(txtdata) == 'array') {\n                            //参数为多个单元格选区\n                            let txtArr = [];\n                            for (let i = 0; i < txtdata.length; i++) {\n                                for (let j = 0; j < txtdata[i].length; j++) {\n                                    let cell = txtdata[i][j];\n                                    if (cell == null || isRealNull(cell.v)) {\n                                        txtArr.push(null);\n                                    } else {\n                                        txtArr.push(cell.v);\n                                    }\n                                }\n                            }\n                            $('#luckysheet-search-formula-parm .parmBox').eq(index).find('.val').text(' = {' + txtArr.join(',') + '}');\n                        } else {\n                            //参数为单个单元格选区\n                            $('#luckysheet-search-formula-parm .parmBox').eq(index).find('.val').text(' = {' + txtdata.v + '}');\n                        }\n                    } else {\n                        //参数不是选区\n                        $('#luckysheet-search-formula-parm .parmBox').eq(index).find('.val').text(' = {' + parmtxt + '}');\n                    }\n                } else {\n                    //参数是公式\n                    $('#luckysheet-search-formula-parm .parmBox').eq(index).find('.val').text(' = {' + new Function('return ' + $.trim(formula.functionParserExe('=' + parmtxt)))() + '}');\n                }\n            });\n            $('#luckysheet-formula-functionrange .luckysheet-formula-functionrange-highlight').remove();\n            formula.data_parm_index = 0;\n            formula.rangestart = true;\n        },\n        parmTxtShow: function (parmtxt) {\n            if (formula.getfunctionParam(parmtxt).fn == null) {\n                //参数不是公式\n                if (formula.iscelldata(parmtxt)) {\n                    //参数是选区\n                    let cellrange = formula.getcellrange(parmtxt);\n                    let r1 = cellrange.row[0], r2 = cellrange.row[1], c1 = cellrange.column[0], c2 = cellrange.column[1];\n                    let row = Store.visibledatarow[r2], row_pre = r1 - 1 == -1 ? 0 : Store.visibledatarow[r1 - 1];\n                    let col = Store.visibledatacolumn[c2], col_pre = c1 - 1 == -1 ? 0 : Store.visibledatacolumn[c1 - 1];\n                    $('#luckysheet-formula-functionrange-select').css({\n                        'left': col_pre,\n                        'width': col - col_pre - 1,\n                        'top': row_pre,\n                        'height': row - row_pre - 1\n                    }).show();\n                    $('#luckysheet-formula-help-c').hide();\n                    luckysheet_count_show(col_pre, row_pre, col - col_pre - 1, row - row_pre - 1, cellrange.row, cellrange.column);\n                    let txtdata = luckysheet_getcelldata(parmtxt).data;\n                    if (getObjType(txtdata) == 'array') {\n                        //参数为多个单元格选区\n                        let txtArr = [];\n                        for (let i = 0; i < txtdata.length; i++) {\n                            for (let j = 0; j < txtdata[i].length; j++) {\n                                let cell = txtdata[i][j];\n                                if (cell == null || isRealNull(cell.v)) {\n                                    txtArr.push(null);\n                                } else {\n                                    txtArr.push(cell.v);\n                                }\n                            }\n                        }\n                        $('#luckysheet-search-formula-parm .parmBox').eq(formula.data_parm_index).find('.val').text(' = {' + txtArr.join(',') + '}');\n                    } else {\n                        //参数为单个单元格选区\n                        $('#luckysheet-search-formula-parm .parmBox').eq(formula.data_parm_index).find('.val').text(' = {' + txtdata.v + '}');\n                    }\n                } else {\n                    //参数不是选区\n                    $('#luckysheet-search-formula-parm .parmBox').eq(formula.data_parm_index).find('.val').text(' = {' + parmtxt + '}');\n                    $('#luckysheet-formula-functionrange-select').hide();\n                }\n            } else {\n                //参数是公式\n                let txt;\n                for (let k = 0; k < formula.getfunctionParam(parmtxt).param.length; k++) {\n                    if (formula.iscelldata(formula.getfunctionParam(parmtxt).param[k])) {\n                        txt = formula.getfunctionParam(parmtxt).param[k];\n                        break;\n                    }\n                }\n                let cellrange = formula.getcellrange(txt);\n                let r1 = cellrange.row[0], r2 = cellrange.row[1], c1 = cellrange.column[0], c2 = cellrange.column[1];\n                let row = Store.visibledatarow[r2], row_pre = r1 - 1 == -1 ? 0 : Store.visibledatarow[r1 - 1];\n                let col = Store.visibledatacolumn[c2], col_pre = c1 - 1 == -1 ? 0 : Store.visibledatacolumn[c1 - 1];\n                $('#luckysheet-formula-functionrange-select').css({\n                    'left': col_pre,\n                    'width': col - col_pre - 1,\n                    'top': row_pre,\n                    'height': row - row_pre - 1\n                }).show();\n                $('#luckysheet-formula-help-c').hide();\n                luckysheet_count_show(col_pre, row_pre, col - col_pre - 1, row - row_pre - 1, cellrange.row, cellrange.column);\n                $('#luckysheet-search-formula-parm .parmBox').eq(formula.data_parm_index).find('.val').text(' = {' + new Function('return ' + $.trim(formula.functionParserExe('=' + parmtxt)))() + '}');\n            }\n        },\n        functionStrCompute: function () {\n            let isVal = true;    //参数不为空\n            //参数不为空\n            let parmValArr = [];    //参数值集合\n            //参数值集合\n            let lvi = -1;    //最后一个有值的参数索引\n            //最后一个有值的参数索引\n            let formulatxt = $('#luckysheet-search-formula-parm').find('.luckysheet-modal-dialog-title-text').text();\n            let p = Store.luckysheet_function[formulatxt].p;\n            $('#luckysheet-search-formula-parm .parmBox').each(function (i, e) {\n                let parmtxt = $(e).find('.txt input').val();\n                let parmRequire;\n                if (i < p.length) {\n                    parmRequire = p[i].require;\n                } else {\n                    parmRequire = p[p.length - 1].require;\n                }\n                if (parmtxt == '' && parmRequire == 'm') {\n                    isVal = false;\n                }\n                if (parmtxt != '') {\n                    lvi = i;\n                }\n            });    //单元格显示\n            //单元格显示\n            let functionHtmlTxt;\n            if (lvi == -1) {\n                functionHtmlTxt = '=' + $('#luckysheet-search-formula-parm .luckysheet-modal-dialog-title-text').text() + '()';\n            } else if (lvi == 0) {\n                functionHtmlTxt = '=' + $('#luckysheet-search-formula-parm .luckysheet-modal-dialog-title-text').text() + '(' + $('#luckysheet-search-formula-parm .parmBox').eq(0).find('.txt input').val() + ')';\n            } else {\n                for (let j = 0; j <= lvi; j++) {\n                    parmValArr.push($('#luckysheet-search-formula-parm .parmBox').eq(j).find('.txt input').val());\n                }\n                functionHtmlTxt = '=' + $('#luckysheet-search-formula-parm .luckysheet-modal-dialog-title-text').text() + '(' + parmValArr.join(',') + ')';\n            }\n            let function_str = formula.functionHTMLGenerate(functionHtmlTxt);\n            $('#luckysheet-rich-text-editor').html(function_str);\n            $('#luckysheet-functionbox-cell').html($('#luckysheet-rich-text-editor').html());\n            if (isVal) {\n                //公式计算\n                let fp = $.trim(formula.functionParserExe($('#luckysheet-rich-text-editor').text()));\n                let result = null;\n                try {\n                    result = new Function('return ' + fp)();\n                } catch (e) {\n                    result = formula.error.n;\n                }\n                $('#luckysheet-search-formula-parm .result span').text(result);\n            }\n        }\n    };\n    return insertFormula;\n});"]}