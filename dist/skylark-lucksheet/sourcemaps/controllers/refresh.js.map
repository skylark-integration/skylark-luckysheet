{"version":3,"sources":["controllers/refresh.js"],"names":["define","rhchInit","formula","m_setdata","m_getdata","m_getRowlen","m_draw","luckysheetFreezen","sheetmanage","luckysheetPostil","hyperlinkCtrl","m_select","m_filter","m_get","Store","setcellvalue","getcellFormula","computeRowlenArr","luckysheetDrawMain","luckysheetDrawgridRowTitle","luckysheetDrawgridColumnTitle","selectHightlightShow","selectionCopyShow","collaborativeEditBox","createFilterOptions","getSheetIndex","refreshCanvasTimeOut","runExecFunction","range","index","data","execFunctionExist","s","length","r","row","c","column","push","i","reverse","execFunctionGroup","execFunctionGlobalData","jfrefreshgrid","allParam","isRunExecFunction","isRefreshCanvas","flowdata","luckysheet_select_save","clearTimeout","cfg","RowlChange","cdformat","dataVerification","dynamicArray","file","luckysheetfile","currentSheetIndex","clearjfundo","curConfig","curCdformat","curDataVerification","curDynamicArray","jfundo","$","extend","config","jfredo","type","curdata","sheetIndex","dataRange","webWorkerFlowDataCache","saveParam","k","jfrefreshgrid_rhcw","r1","c1","spl","window","luckysheetCurrentRow","luckysheetCurrentColumn","luckysheetCurrentFunction","f","fp","trim","functionParserExe","sparklines","Function","allowUpdate","historyParam","chartparam","jfrefreshchartall","setTimeout","luckysheetrefreshgrid","luckysheet_getcelldata_cache","jfrefreshgridall","colwidth","rowheight","ctrlType","ctrlValue","redo","setfield","indexOf","len","direction","mc","merge","rc","borderInfo","storeSheetParamALL","jfrefreshgrid_adRC","calc","filterObj","cf","af","freezen","hyperlink","mcData","m","rs","cs","funcData","curData","calcChain","curCalc","filter_select","filter","curFilterObj","luckysheet_conditionformat_save","curCf","luckysheet_alternateformat_save","curAf","freezenhorizontaldata","freezenverticaldata","curFreezen","curHyperlink","addData","restore","st_r","ed_r","cell","st_c","ed_c","mcData_r","mcData_c","clc","clc_r","clc_c","clc_i","clc_funcStr","clc_result","execfunction","func","funcData_r","funcData_c","jfrefreshgrid_deleteCell","ctrl","JSON","stringify","str","edr","stc","edc","jfrefreshgrid_pastcut","source","target","rowHeight","execF_rc","visibledatarow","rh_height","rowlen","defaultrowlen","rowlenArr","storeSheetParam","positionSync","is","remove","row_st","col_st","scrollTop","scrollLeft","top","columnHeaderHeight","cutVolumn","left","visibledatacolumn","rowHeaderWidth","saveFreezen","createFreezenHorizontal","createFreezenVertical","createAssistCanvas","each","e","cindex","css","luckysheet_filter_save","r2","c2","row_pre","col","col_pre","width","height","showSheet","scrollWidth","scrollHeight","groupValuesRefresh","freezen_horizon_px","freezen_horizon_ed","freezen_horizon_scrollTop","freezen_vertical_px","freezen_vertical_ed","freezen_vertical_scrollTop","drawWidth","luckysheetTableContentHW","drawHeight","luckysheetTableContent","get","getContext","clearRect","devicePixelRatio","onRefresh","onRefreshGrid","onRefreshGridAll","onRefreshRange","onRefreshGrid_adRC","onRefreshGrid_deleteCell","onRefreshGrid_pastcut","onRefreshGrid_rhcw","jfrefreshrange"],"mappings":"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","file":"../../controllers/refresh.js","sourcesContent":["define([\n    '../methods/rhchInit',\n    '../methods/formula_methods',\n    '../methods/setdata',\n    '../methods/getdata',\n    '../methods/getRowlen',\n    '../widgets/draw',\n    './freezen',\n    './sheetmanage',\n    './postil',\n    '../widgets/hyperlinkCtrl',\n    '../widgets/select',\n    './filter',\n    '../methods/get',\n    '../store'\n], function (rhchInit, formula, m_setdata, m_getdata, m_getRowlen, m_draw, luckysheetFreezen, sheetmanage, luckysheetPostil, hyperlinkCtrl, m_select, m_filter, m_get, Store) {\n    'use strict';\n    const {setcellvalue} = m_setdata;\n    const {getcellFormula} = m_getdata;\n    const {computeRowlenArr} = m_getRowlen;\n    const {luckysheetDrawMain, luckysheetDrawgridRowTitle, luckysheetDrawgridColumnTitle} = m_draw;\n    const {selectHightlightShow, selectionCopyShow, collaborativeEditBox} = m_select;\n    const {createFilterOptions} = m_filter;\n    const {getSheetIndex} = m_get;\n    let refreshCanvasTimeOut = null;\n    function runExecFunction(range, index, data) {\n        formula.execFunctionExist = [];\n        for (let s = 0; s < range.length; s++) {\n            for (let r = range[s].row[0]; r <= range[s].row[1]; r++) {\n                for (let c = range[s].column[0]; c <= range[s].column[1]; c++) {\n                    formula.execFunctionExist.push({\n                        'r': r,\n                        'c': c,\n                        'i': index\n                    });\n                }\n            }\n        }\n        formula.execFunctionExist.reverse();\n        formula.execFunctionGroup(null, null, null, null, data);\n        formula.execFunctionGlobalData = null;\n    }\n    function jfrefreshgrid(data, range, allParam, isRunExecFunction = true, isRefreshCanvas = true) {\n        if (data == null) {\n            data = Store.flowdata;\n        }\n        if (range == null) {\n            range = Store.luckysheet_select_save;\n        }\n        clearTimeout(refreshCanvasTimeOut);    //关联参数\n        //关联参数\n        if (allParam == null) {\n            allParam = {};\n        }\n        let cfg = allParam['cfg'];    //config\n        //config\n        let RowlChange = allParam['RowlChange'];    //行高改变\n        //行高改变\n        let cdformat = allParam['cdformat'];    //条件格式\n        //条件格式\n        let dataVerification = allParam['dataVerification'];    //数据验证\n        //数据验证\n        let dynamicArray = allParam['dynamicArray'];    //动态数组\n        //动态数组\n        let file = Store.luckysheetfile[getSheetIndex(Store.currentSheetIndex)];\n        if (Store.clearjfundo) {\n            Store.jfundo.length = 0;\n            let curConfig;\n            if (cfg == null) {\n                curConfig = $.extend(true, {}, Store.config);\n            } else {\n                curConfig = $.extend(true, {}, cfg);\n            }\n            let curCdformat;\n            if (cdformat == null) {\n                curCdformat = $.extend(true, [], file['luckysheet_conditionformat_save']);\n            } else {\n                curCdformat = cdformat;\n            }\n            let curDataVerification;\n            if (dataVerification == null) {\n                curDataVerification = $.extend(true, {}, file['dataVerification']);\n            } else {\n                curDataVerification = dataVerification;\n            }\n            let curDynamicArray;\n            if (dynamicArray == null) {\n                curDynamicArray = $.extend(true, [], file['dynamicArray']);\n            } else {\n                curDynamicArray = dynamicArray;\n            }\n            Store.jfredo.push({\n                'type': 'datachange',\n                'data': Store.flowdata,\n                'curdata': data,\n                'sheetIndex': Store.currentSheetIndex,\n                'range': range,\n                'config': $.extend(true, {}, Store.config),\n                'curConfig': curConfig,\n                'cdformat': $.extend(true, [], file['luckysheet_conditionformat_save']),\n                'curCdformat': curCdformat,\n                'RowlChange': RowlChange,\n                'dataVerification': $.extend(true, [], file['dataVerification']),\n                'curDataVerification': curDataVerification,\n                'dynamicArray': $.extend(true, [], file['dynamicArray']),\n                'curDynamicArray': curDynamicArray,\n                'dataRange': [...file.luckysheet_select_save]\n            });\n        }    //Store.flowdata\n        //Store.flowdata\n        Store.flowdata = data;\n        Store.webWorkerFlowDataCache(Store.flowdata);    //worker存数据\n        //worker存数据\n        file.data = Store.flowdata;    //config\n        //config\n        if (cfg != null) {\n            Store.config = cfg;\n            file.config = Store.config;\n            Store.saveParam('all', Store.currentSheetIndex, cfg, { 'k': 'config' });\n            if (RowlChange != null) {\n                jfrefreshgrid_rhcw(Store.flowdata.length, Store.flowdata[0].length);\n            }\n        }    //条件格式\n        //条件格式\n        if (cdformat != null) {\n            file['luckysheet_conditionformat_save'] = cdformat;\n            Store.saveParam('all', Store.currentSheetIndex, cdformat, { 'k': 'luckysheet_conditionformat_save' });\n        }    //数据验证\n        //数据验证\n        if (dataVerification != null) {\n            Store.dataVerification = dataVerification;\n            file['dataVerification'] = dataVerification;\n            Store.saveParam('all', Store.currentSheetIndex, dataVerification, { 'k': 'dataVerification' });\n        }    //动态数组\n        //动态数组\n        if (dynamicArray != null) {\n            file['dynamicArray'] = dynamicArray;\n            Store.saveParam('all', Store.currentSheetIndex, dynamicArray, { 'k': 'dynamicArray' });\n        }    //更新数据的范围\n        //更新数据的范围\n        for (let s = 0; s < range.length; s++) {\n            let r1 = range[s].row[0];\n            let c1 = range[s].column[0];\n            if (Store.flowdata[r1][c1] != null && Store.flowdata[r1][c1].spl != null) {\n                window.luckysheetCurrentRow = r1;\n                window.luckysheetCurrentColumn = c1;\n                window.luckysheetCurrentFunction = Store.flowdata[r1][c1].f;\n                let fp = $.trim(formula.functionParserExe(Store.flowdata[r1][c1].f));\n                let sparklines = new Function('return ' + fp)();\n                Store.flowdata[r1][c1].spl = sparklines;\n            }\n            if (Store.allowUpdate) {\n                //共享编辑模式\n                Store.historyParam(Store.flowdata, Store.currentSheetIndex, range[s]);\n            }    // 刷新图表\n            // 刷新图表\n            if (typeof Store.chartparam.jfrefreshchartall == 'function') {\n                Store.chartparam.jfrefreshchartall(Store.flowdata, range[s].row[0], range[s].row[1], range[s].column[0], range[s].column[1]);\n            }\n        }    //单元格数据更新联动\n        //单元格数据更新联动\n        if (isRunExecFunction) {\n            runExecFunction(range, Store.currentSheetIndex, data);\n        }    //刷新表格\n        //刷新表格\n        if (isRefreshCanvas) {\n            refreshCanvasTimeOut = setTimeout(function () {\n                luckysheetrefreshgrid();\n            }, 1);\n        }\n        window.luckysheet_getcelldata_cache = null;\n    }\n    function jfrefreshgridall(colwidth, rowheight, data, cfg, range, ctrlType, ctrlValue, cdformat, isRefreshCanvas = true) {\n        let redo = {}, isRunExecFunction = false;\n        clearTimeout(refreshCanvasTimeOut);\n        if (ctrlType == 'cellRowChange') {\n            redo['type'] = 'cellRowChange';\n            redo['config'] = $.extend(true, {}, Store.config);\n            redo['curconfig'] = $.extend(true, {}, cfg);\n            redo['range'] = $.extend(true, [], Store.luckysheet_select_save);\n            redo['currange'] = range;\n            redo['ctrlType'] = ctrlType;\n            redo['ctrlValue'] = ctrlValue;\n            let setfield = cfg['rowlen'];\n            if (setfield == null) {\n                setfield = {};\n            }\n            Store.saveParam('cg', Store.currentSheetIndex, setfield, { 'k': 'rowlen' });\n        } else if (ctrlType == 'resizeC') {\n            redo['type'] = 'resize';\n            redo['config'] = $.extend(true, {}, Store.config);\n            redo['curconfig'] = $.extend(true, {}, cfg);\n            redo['range'] = $.extend(true, [], Store.luckysheet_select_save);\n            redo['currange'] = range;\n            redo['ctrlType'] = ctrlType;\n            redo['ctrlValue'] = ctrlValue;\n            let setfield = cfg['columnlen'];\n            if (setfield == null) {\n                setfield = {};\n            }\n            Store.saveParam('cg', Store.currentSheetIndex, setfield, { 'k': 'columnlen' });\n        } else if (ctrlType.indexOf('extend') > -1) {\n            redo['type'] = 'extend';\n            redo['config'] = $.extend(true, {}, Store.config);\n            redo['curconfig'] = $.extend(true, {}, cfg);\n            redo['range'] = $.extend(true, [], Store.luckysheet_select_save);\n            redo['currange'] = range;\n            redo['ctrlType'] = ctrlType;\n            redo['ctrlValue'] = ctrlValue;\n            Store.saveParam('arc', Store.currentSheetIndex, {\n                'index': ctrlValue.index,\n                'len': ctrlValue.len,\n                'direction': ctrlValue.direction,\n                'mc': cfg.merge\n            }, { 'rc': ctrlValue.type });\n        } else if (ctrlType.indexOf('dele') > -1) {\n            redo['type'] = 'dele';\n            redo['config'] = $.extend(true, {}, Store.config);\n            redo['curconfig'] = $.extend(true, {}, cfg);\n            redo['range'] = $.extend(true, [], Store.luckysheet_select_save);\n            redo['currange'] = range;\n            redo['ctrlType'] = ctrlType;\n            redo['ctrlValue'] = ctrlValue;\n            Store.saveParam('drc', Store.currentSheetIndex, {\n                'index': ctrlValue.index,\n                'len': ctrlValue.len,\n                'mc': cfg.merge,\n                'borderInfo': cfg.borderInfo\n            }, { 'rc': ctrlValue.type });\n        } else {\n            redo['type'] = 'datachangeAll';\n            redo['range'] = $.extend(true, [], Store.luckysheet_select_save);\n            redo['currange'] = range;\n            redo['ctrlType'] = ctrlType;\n            redo['ctrlValue'] = ctrlValue;\n            isRunExecFunction = true;\n            for (let s = 0; s < range.length; s++) {\n                Store.historyParam(data, Store.currentSheetIndex, range[s]);\n            }\n        }\n        if (Store.clearjfundo) {\n            Store.jfundo.length = 0;\n            redo['data'] = Store.flowdata;\n            redo['curdata'] = data;\n            redo['sheetIndex'] = Store.currentSheetIndex;\n            redo['cdformat'] = $.extend(true, [], Store.luckysheetfile[getSheetIndex(Store.currentSheetIndex)]['luckysheet_conditionformat_save']);\n            redo['curCdformat'] = cdformat;\n            Store.jfredo.push(redo);\n        } \n        //Store.flowdata\n        Store.flowdata = data;\n        Store.webWorkerFlowDataCache(data); \n        //worker存数据\n        Store.luckysheetfile[getSheetIndex(Store.currentSheetIndex)].data = Store.flowdata; \n        //config\n        if (cfg != null) {\n            Store.config = cfg;\n            Store.luckysheetfile[getSheetIndex(Store.currentSheetIndex)].config = Store.config;\n            Store.saveParam('all', Store.currentSheetIndex, cfg, { 'k': 'config' });\n        } \n        //条件格式\n        if (cdformat != null) {\n            Store.luckysheetfile[getSheetIndex(Store.currentSheetIndex)]['luckysheet_conditionformat_save'] = cdformat;\n            Store.saveParam('all', Store.currentSheetIndex, cdformat, { 'k': 'luckysheet_conditionformat_save' });\n        }    //选区\n        //选区\n        Store.luckysheet_select_save = $.extend(true, [], range);\n        if (Store.luckysheet_select_save.length > 0) {\n            //有选区时，刷新一下选区\n            selectHightlightShow();\n        }\n        if (isRunExecFunction) {\n            //单元格数据更新联动\n            runExecFunction(range, Store.currentSheetIndex, data);\n        } \n        //行高、列宽 刷新  \n        jfrefreshgrid_rhcw(rowheight, colwidth);\n        if (isRefreshCanvas) {\n            refreshCanvasTimeOut = setTimeout(function () {\n                luckysheetrefreshgrid();\n            }, 1);\n        }\n        sheetmanage.storeSheetParamALL();\n        window.luckysheet_getcelldata_cache = null;\n    }\n    function jfrefreshrange(data, range, cdformat) {\n        clearTimeout(refreshCanvasTimeOut);\n        if (Store.clearjfundo) {\n            Store.jfundo.length = 0;\n            Store.jfredo.push({\n                'type': 'rangechange',\n                'data': Store.flowdata,\n                'curdata': data,\n                'range': range,\n                'sheetIndex': Store.currentSheetIndex,\n                'cdformat': $.extend(true, [], Store.luckysheetfile[getSheetIndex(Store.currentSheetIndex)]['luckysheet_conditionformat_save']),\n                'curCdformat': cdformat\n            });\n        }  \n        //flowdata\n        Store.flowdata = data;\n        Store.webWorkerFlowDataCache(Store.flowdata);    //worker存数据\n        //worker存数据\n        Store.luckysheetfile[getSheetIndex(Store.currentSheetIndex)].data = Store.flowdata; \n        //条件格式\n        if (cdformat != null) {\n            Store.luckysheetfile[getSheetIndex(Store.currentSheetIndex)]['luckysheet_conditionformat_save'] = cdformat;\n        }  \n        //单元格数据更新联动\n        runExecFunction(range, Store.currentSheetIndex, data); \n        //刷新表格\n        refreshCanvasTimeOut = setTimeout(function () {\n            luckysheetrefreshgrid();\n        }, 1);   \n        //发送给后台\n        for (let s = 0; s < range.length; s++) {\n            Store.historyParam(Store.flowdata, Store.currentSheetIndex, range[s]);\n        }\n    }   \n    //删除、增加行列 刷新表格\n    function jfrefreshgrid_adRC(data, cfg, ctrlType, ctrlValue, calc, filterObj, cf, af, freezen, dataVerification, hyperlink) {\n        let file = Store.luckysheetfile[getSheetIndex(Store.currentSheetIndex)];\n        collaborativeEditBox(); \n        //merge改变对应的单元格值改变\n        let mcData = [];\n        for (let m in cfg['merge']) {\n            let mc = cfg['merge'][m];\n            for (let r = mc.r; r <= mc.r + mc.rs - 1; r++) {\n                for (let c = mc.c; c <= mc.c + mc.cs - 1; c++) {\n                    if (data[r][c] == null) {\n                        data[r][c] = {};\n                    }\n                    if (r == mc.r && c == mc.c) {\n                        data[r][c].mc = mc;\n                    } else {\n                        data[r][c].mc = {\n                            'r': mc.r,\n                            'c': mc.c\n                        };\n                    }\n                    mcData.push({\n                        'r': r,\n                        'c': c\n                    });\n                }\n            }\n        }  \n        //公式链中公式范围改变对应单元格值的改变\n        let funcData = []; \n        // if(calc.length > 0){\n        //     // 取消execFunctionGroupData，改用execFunctionGlobalData\n        //     // formula.execFunctionGroupData = data;\n        //     for(let i = 0; i < calc.length; i++){\n        //         let clc = calc[i];\n        //         let clc_r = clc.r, clc_c = clc.c, clc_i = clc.index, clc_funcStr =  getcellFormula(clc_r, clc_c, clc_i, data);\n        //         let clc_result = formula.execfunction(clc_funcStr, clc_r, clc_c, clc_i,null, true);\n        //         clc.func = clc_result;\n        //         if(data[clc_r][clc_c].f == clc_funcStr){\n        //             setcellvalue(clc_r, clc_c, data, clc_result[1]);\n        //             // funcData存储当前结果没有用处，每次还是需要从calc公式链实时从当前数据中计算比较靠谱\n        //             // funcData.push({ \"r\": clc_r, \"c\": clc_c });\n        //         }\n        //     }\n        // }\n        if (Store.clearjfundo) {\n            Store.jfundo.length = 0;\n            Store.jfredo.push({\n                'type': ctrlType,\n                'sheetIndex': Store.currentSheetIndex,\n                'data': Store.flowdata,\n                'curData': data,\n                'config': $.extend(true, {}, Store.config),\n                'curConfig': cfg,\n                'ctrlValue': ctrlValue,\n                'mcData': mcData,\n                'calc': $.extend(true, [], file.calcChain),\n                'curCalc': calc,\n                'funcData': funcData,\n                'filterObj': {\n                    'filter_select': $.extend(true, {}, file.filter_select),\n                    'filter': $.extend(true, {}, file.filter)\n                },\n                'curFilterObj': filterObj,\n                'cf': $.extend(true, [], file.luckysheet_conditionformat_save),\n                'curCf': cf,\n                'af': $.extend(true, [], file.luckysheet_alternateformat_save),\n                'curAf': af,\n                'freezen': {\n                    'freezenhorizontaldata': Store.freezenhorizontaldata,\n                    'freezenverticaldata': Store.freezenverticaldata\n                },\n                'curFreezen': freezen,\n                'dataVerification': $.extend(true, {}, file.dataVerification),\n                'curDataVerification': dataVerification,\n                'hyperlink': $.extend(true, {}, file.hyperlink),\n                'curHyperlink': hyperlink,\n                'dataRange': [...file.luckysheet_select_save]\n            });\n        }\n        let index = ctrlValue.index, len = ctrlValue.len, rc = ctrlValue.rc;\n        if (ctrlType == 'addRC') {\n            let direction = ctrlValue.direction, restore = ctrlValue.restore;\n            let addData = [];\n            if (restore) {\n                if (rc == 'r') {\n                    let st_r;\n                    if (direction == 'lefttop') {\n                        st_r = index;\n                    } else if (direction == 'rightbottom') {\n                        st_r = index + 1;\n                    }\n                    let ed_r = st_r + len - 1;\n                    for (let r = st_r; r <= ed_r; r++) {\n                        let row = [];\n                        for (let c = 0; c < data[0].length; c++) {\n                            let cell = data[r][c];\n                            row.push(cell);\n                        }\n                        addData.push(row);\n                    }\n                } else if (rc == 'c') {\n                    let st_c;\n                    if (direction == 'lefttop') {\n                        st_c = index;\n                    } else if (direction == 'rightbottom') {\n                        st_c = index + 1;\n                    }\n                    let ed_c = st_c + len - 1;\n                    for (let r = 0; r < data.length; r++) {\n                        let row = [];\n                        for (let c = st_c; c <= ed_c; c++) {\n                            let cell = data[r][c];\n                            row.push(cell);\n                        }\n                        addData.push(row);\n                    }\n                }\n            }\n            Store.saveParam('arc', Store.currentSheetIndex, {\n                'index': index,\n                'len': len,\n                'direction': direction,\n                'data': addData\n            }, { 'rc': rc });\n        } else if (ctrlType == 'delRC') {\n            Store.saveParam('drc', Store.currentSheetIndex, {\n                'index': index,\n                'len': len\n            }, { 'rc': rc });\n        }    //Store.flowdata\n        //Store.flowdata\n        Store.flowdata = data;\n        Store.webWorkerFlowDataCache(Store.flowdata);    //worker存数据\n        //worker存数据\n        file.data = data;    //config\n        //config\n        Store.config = cfg;\n        file.config = Store.config;\n        Store.saveParam('all', Store.currentSheetIndex, cfg, { 'k': 'config' });    //mcData\n        //mcData\n        for (let i = 0; i < mcData.length; i++) {\n            let mcData_r = mcData[i].r, mcData_c = mcData[i].c;\n            Store.saveParam('v', Store.currentSheetIndex, Store.flowdata[mcData_r][mcData_c], {\n                'r': mcData_r,\n                'c': mcData_c\n            });\n        }    //公式链中公式范围改变对应单元格值的改变\n        //公式链中公式范围改变对应单元格值的改变\n        if (calc.length > 0) {\n            // 取消execFunctionGroupData，改用execFunctionGlobalData\n            // formula.execFunctionGroupData = data;\n            for (let i = 0; i < calc.length; i++) {\n                let clc = calc[i];\n                let clc_r = clc.r, clc_c = clc.c, clc_i = clc.index, clc_funcStr = getcellFormula(clc_r, clc_c, clc_i, data);\n                let clc_result = formula.execfunction(clc_funcStr, clc_r, clc_c, clc_i, null, true);\n                clc.func = clc_result;\n                if (data[clc_r][clc_c].f == clc_funcStr) {\n                    setcellvalue(clc_r, clc_c, data, clc_result[1]);    // funcData存储当前结果没有用处，每次还是需要从calc公式链实时从当前数据中计算比较靠谱\n                                                                        // funcData.push({ \"r\": clc_r, \"c\": clc_c });\n                }\n            }\n        }    //calc函数链\n        // funcData存储当前结果没有用处，每次还是需要从calc公式链实时从当前数据中计算比较靠谱\n        // funcData.push({ \"r\": clc_r, \"c\": clc_c });\n        //calc函数链\n        file.calcChain = calc;\n        Store.saveParam('all', Store.currentSheetIndex, calc, { 'k': 'calcChain' });\n        for (let i = 0; i < funcData.length; i++) {\n            let funcData_r = funcData[i].r, funcData_c = funcData[i].c;\n            Store.saveParam('v', Store.currentSheetIndex, Store.flowdata[funcData_r][funcData_c], {\n                'r': funcData_r,\n                'c': funcData_c\n            });\n        }    //筛选配置\n        //筛选配置\n        if (filterObj != null) {\n            file.filter_select = filterObj.filter_select;\n            file.filter = filterObj.filter;\n        } else {\n            file.filter_select = null;\n            file.filter = null;\n        }\n        createFilterOptions(file.filter_select, file.filter);\n        Store.saveParam('all', Store.currentSheetIndex, file.filter_select, { 'k': 'filter_select' });\n        Store.saveParam('all', Store.currentSheetIndex, file.filter, { 'k': 'filter' });    //条件格式配置\n        //条件格式配置\n        file.luckysheet_conditionformat_save = cf;\n        Store.saveParam('all', Store.currentSheetIndex, file.luckysheet_conditionformat_save, { 'k': 'luckysheet_conditionformat_save' });    //交替颜色配置\n        //交替颜色配置\n        file.luckysheet_alternateformat_save = af;\n        Store.saveParam('all', Store.currentSheetIndex, file.luckysheet_alternateformat_save, { 'k': 'luckysheet_alternateformat_save' });    //冻结配置\n        //冻结配置\n        if (freezen != null) {\n            Store.freezenhorizontaldata = freezen.freezenhorizontaldata;\n            Store.freezenverticaldata = freezen.freezenverticaldata;\n        } else {\n            Store.freezenhorizontaldata = null;\n            Store.freezenverticaldata = null;\n        }    //数据验证\n        //数据验证\n        Store.dataVerification = dataVerification;\n        file.dataVerification = dataVerification;\n        Store.saveParam('all', Store.currentSheetIndex, file.dataVerification, { 'k': 'dataVerification' });    //超链接\n        //超链接\n        hyperlinkCtrl.hyperlink = hyperlink;\n        file.hyperlink = hyperlink;\n        Store.saveParam('all', Store.currentSheetIndex, file.hyperlink, { 'k': 'hyperlink' });    //行高、列宽刷新\n        //行高、列宽刷新\n        jfrefreshgrid_rhcw(Store.flowdata.length, Store.flowdata[0].length);\n    } \n    //删除单元格 刷新表格\n    function jfrefreshgrid_deleteCell(data, cfg, ctrl, calc, filterObj, cf, dataVerification, hyperlink) {\n        let file = Store.luckysheetfile[getSheetIndex(Store.currentSheetIndex)];\n        clearTimeout(refreshCanvasTimeOut);\n        collaborativeEditBox();    //merge改变对应的单元格值改变\n        //merge改变对应的单元格值改变\n        let mcData = [];\n        if (JSON.stringify(cfg['merge']) == '{}') {\n            for (let r = 0; r < data.length; r++) {\n                for (let c = 0; c < data[0].length; c++) {\n                    let cell = data[r][c];\n                    if (cell != null && cell.mc != null) {\n                        delete cell.mc;\n                        mcData.push({\n                            'r': r,\n                            'c': c\n                        });\n                    }\n                }\n            }\n        } else {\n            for (let m in cfg['merge']) {\n                let mc = cfg['merge'][m];\n                for (let r = mc.r; r <= mc.r + mc.rs - 1; r++) {\n                    for (let c = mc.c; c <= mc.c + mc.cs - 1; c++) {\n                        if (data[r][c] == null) {\n                            data[r][c] = {};\n                        }\n                        if (r == mc.r && c == mc.c) {\n                            data[r][c].mc = mc;\n                        } else {\n                            data[r][c].mc = {\n                                'r': mc.r,\n                                'c': mc.c\n                            };\n                        }\n                        mcData.push({\n                            'r': r,\n                            'c': c\n                        });\n                    }\n                }\n            }\n        } \n        //公式链中公式范围改变对应单元格值的改变\n        let funcData = []; \n        // if(calc.length > 0){\n        //     // formula.execFunctionGroupData = data;\n        //     for(let i = 0; i < calc.length; i++){\n        //         let clc = calc[i];\n        //         let clc_r = clc.r, clc_c = clc.c, clc_i = clc.index, clc_funcStr =  getcellFormula(clc_r, clc_c, clc_i, data);\n        //         let clc_result = formula.execfunction(clc_funcStr, clc_r, clc_c, clc_i,null, true);\n        //         clc.func = clc_result;\n        //         if(data[clc_r][clc_c].f == clc_funcStr){\n        //             setcellvalue(clc_r, clc_c, data, clc_result[1]);\n        //             funcData.push({ \"r\": clc_r, \"c\": clc_c });\n        //         }\n        //     }\n        // }\n        if (Store.clearjfundo) {\n            Store.jfundo.length = 0;\n            Store.jfredo.push({\n                'type': 'deleteCell',\n                'sheetIndex': Store.currentSheetIndex,\n                'ctrl': ctrl,\n                'data': Store.flowdata,\n                'curData': data,\n                'config': $.extend(true, {}, Store.config),\n                'curConfig': cfg,\n                'mcData': mcData,\n                'calc': $.extend(true, [], file.calcChain),\n                'curCalc': calc,\n                'funcData': funcData,\n                'filterObj': {\n                    'filter_select': $.extend(true, {}, file.filter_select),\n                    'filter': $.extend(true, {}, file.filter)\n                },\n                'curFilterObj': filterObj,\n                'cf': $.extend(true, [], file.luckysheet_conditionformat_save),\n                'curCf': cf,\n                'dataVerification': $.extend(true, {}, file.dataVerification),\n                'curDataVerification': dataVerification,\n                'hyperlink': $.extend(true, {}, file.hyperlink),\n                'curHyperlink': hyperlink,\n                'dataRange': [...file.luckysheet_select_save]\n            });\n        }    //Store.flowdata\n        //Store.flowdata\n        Store.flowdata = data;\n        Store.webWorkerFlowDataCache(Store.flowdata);    //worker存数据\n        //worker存数据\n        file.data = data;    //共享编辑模式\n        //共享编辑模式\n        if (Store.allowUpdate) {\n            let type = ctrl.type, str = ctrl.str, edr = ctrl.edr, stc = ctrl.stc, edc = ctrl.edc;\n            let range;\n            if (type == 'moveUp') {\n                range = {\n                    'row': [\n                        str,\n                        data.length - 1\n                    ],\n                    'column': [\n                        stc,\n                        edc\n                    ]\n                };\n            } else if (type == 'moveLeft') {\n                range = {\n                    'row': [\n                        str,\n                        edr\n                    ],\n                    'column': [\n                        stc,\n                        data[0].length - 1\n                    ]\n                };\n            }\n            Store.historyParam(Store.flowdata, Store.currentSheetIndex, range);\n        }    //config\n        //config\n        Store.config = cfg;\n        file.config = Store.config;\n        Store.saveParam('all', Store.currentSheetIndex, cfg, { 'k': 'config' });    //mcData\n        //mcData\n        for (let i = 0; i < mcData.length; i++) {\n            let mcData_r = mcData[i].r, mcData_c = mcData[i].c;\n            Store.saveParam('v', Store.currentSheetIndex, Store.flowdata[mcData_r][mcData_c], {\n                'r': mcData_r,\n                'c': mcData_c\n            });\n        }    //公式链中公式范围改变对应单元格值的改变\n        //公式链中公式范围改变对应单元格值的改变\n        if (calc.length > 0) {\n            // formula.execFunctionGroupData = data;\n            for (let i = 0; i < calc.length; i++) {\n                let clc = calc[i];\n                let clc_r = clc.r, clc_c = clc.c, clc_i = clc.index, clc_funcStr = getcellFormula(clc_r, clc_c, clc_i, data);\n                let clc_result = formula.execfunction(clc_funcStr, clc_r, clc_c, clc_i, null, true);\n                clc.func = clc_result;\n                if (data[clc_r][clc_c].f == clc_funcStr) {\n                    setcellvalue(clc_r, clc_c, data, clc_result[1]);    // funcData.push({ \"r\": clc_r, \"c\": clc_c });\n                }\n            }\n        }    //calc函数链\n        // funcData.push({ \"r\": clc_r, \"c\": clc_c });\n        //calc函数链\n        file.calcChain = calc;\n        Store.saveParam('all', Store.currentSheetIndex, calc, { 'k': 'calcChain' });\n        for (let i = 0; i < funcData.length; i++) {\n            let funcData_r = funcData[i].r, funcData_c = funcData[i].c;\n            Store.saveParam('v', Store.currentSheetIndex, Store.flowdata[funcData_r][funcData_c], {\n                'r': funcData_r,\n                'c': funcData_c\n            });\n        }  \n        //筛选配置\n        if (filterObj != null) {\n            file.filter_select = filterObj.filter_select;\n            file.filter = filterObj.filter;\n        } else {\n            file.filter_select = null;\n            file.filter = null;\n        }\n        createFilterOptions(file.filter_select, file.filter);\n        Store.saveParam('all', Store.currentSheetIndex, file.filter_select, { 'k': 'filter_select' });\n        Store.saveParam('all', Store.currentSheetIndex, file.filter, { 'k': 'filter' });    //条件格式配置\n        //条件格式配置\n        file.luckysheet_conditionformat_save = cf;\n        Store.saveParam('all', Store.currentSheetIndex, file.luckysheet_conditionformat_save, { 'k': 'luckysheet_conditionformat_save' });    //数据验证\n        //数据验证\n        Store.dataVerification = dataVerification;\n        file.dataVerification = dataVerification;\n        Store.saveParam('all', Store.currentSheetIndex, file.dataVerification, { 'k': 'dataVerification' });    //超链接\n        //超链接\n        hyperlinkCtrl.hyperlink = hyperlink;\n        file.hyperlink = hyperlink;\n        Store.saveParam('all', Store.currentSheetIndex, file.hyperlink, { 'k': 'hyperlink' });\n        refreshCanvasTimeOut = setTimeout(function () {\n            luckysheetrefreshgrid();\n        }, 1);\n    } \n    //复制剪切 刷新表格\n    function jfrefreshgrid_pastcut(source, target, RowlChange) {\n        //单元格数据更新联动\n        let execF_rc = {};\n        formula.execFunctionExist = [];\n        clearTimeout(refreshCanvasTimeOut);\n        for (let r = source['range'].row[0]; r <= source['range'].row[1]; r++) {\n            for (let c = source['range'].column[0]; c <= source['range'].column[1]; c++) {\n                if (r + '_' + c + '_' + source['sheetIndex'] in execF_rc) {\n                    continue;\n                }\n                execF_rc[r + '_' + c + '_' + source['sheetIndex']] = 0;\n                formula.execFunctionExist.push({\n                    'r': r,\n                    'c': c,\n                    'i': source['sheetIndex']\n                });\n            }\n        }\n        for (let r = target['range'].row[0]; r <= target['range'].row[1]; r++) {\n            for (let c = target['range'].column[0]; c <= target['range'].column[1]; c++) {\n                if (r + '_' + c + '_' + target['sheetIndex'] in execF_rc) {\n                    continue;\n                }\n                execF_rc[r + '_' + c + '_' + target['sheetIndex']] = 0;\n                formula.execFunctionExist.push({\n                    'r': r,\n                    'c': c,\n                    'i': target['sheetIndex']\n                });\n            }\n        }\n        if (Store.clearjfundo) {\n            Store.jfundo.length = 0;\n            Store.jfredo.push({\n                'type': 'pasteCut',\n                'source': source,\n                'target': target,\n                'RowlChange': RowlChange\n            });\n        }    //config\n        //config\n        let rowHeight;\n        if (Store.currentSheetIndex == source['sheetIndex']) {\n            Store.config = source['curConfig'];\n            rowHeight = source['curData'].length;\n            Store.luckysheetfile[getSheetIndex(target['sheetIndex'])]['config'] = target['curConfig'];\n        } else if (Store.currentSheetIndex == target['sheetIndex']) {\n            Store.config = target['curConfig'];\n            rowHeight = target['curData'].length;\n            Store.luckysheetfile[getSheetIndex(source['sheetIndex'])]['config'] = source['curConfig'];\n        }\n        if (RowlChange) {\n            Store.visibledatarow = [];\n            Store.rh_height = 0;\n            for (let i = 0; i < rowHeight; i++) {\n                let rowlen = Store.defaultrowlen;\n                if (Store.config['rowlen'] != null && Store.config['rowlen'][i] != null) {\n                    rowlen = Store.config['rowlen'][i];\n                }\n                if (Store.config['rowhidden'] != null && Store.config['rowhidden'][i] != null) {\n                    rowlen = Store.config['rowhidden'][i];\n                    Store.visibledatarow.push(Store.rh_height);\n                    continue;\n                } else {\n                    Store.rh_height += rowlen + 1;\n                }\n                Store.visibledatarow.push(Store.rh_height);\n            }\n            //行的临时长度分布\n            Store.rh_height += 110; \n            // sheetmanage.showSheet();\n            if (Store.currentSheetIndex == source['sheetIndex']) {\n                let rowlenArr = computeRowlenArr(target['curData'].length, target['curConfig']);\n                Store.luckysheetfile[getSheetIndex(target['sheetIndex'])]['visibledatarow'] = rowlenArr;\n            } else if (Store.currentSheetIndex == target['sheetIndex']) {\n                let rowlenArr = computeRowlenArr(source['curData'].length, source['curConfig']);\n                Store.luckysheetfile[getSheetIndex(source['sheetIndex'])]['visibledatarow'] = rowlenArr;\n            }\n        } \n        //Store.flowdata\n        if (Store.currentSheetIndex == source['sheetIndex']) {\n            Store.flowdata = source['curData'];\n            Store.luckysheetfile[getSheetIndex(target['sheetIndex'])]['data'] = target['curData'];\n        } else if (Store.currentSheetIndex == target['sheetIndex']) {\n            Store.flowdata = target['curData'];\n            Store.luckysheetfile[getSheetIndex(source['sheetIndex'])]['data'] = source['curData'];\n        }\n        Store.webWorkerFlowDataCache(Store.flowdata);    //worker存数据\n        //worker存数据\n        Store.luckysheetfile[getSheetIndex(Store.currentSheetIndex)].data = Store.flowdata;    //luckysheet_select_save\n        //luckysheet_select_save\n        if (Store.currentSheetIndex == target['sheetIndex']) {\n            Store.luckysheet_select_save = [{\n                    'row': target['range'].row,\n                    'column': target['range'].column\n                }];\n        } else {\n            Store.luckysheet_select_save = [{\n                    'row': source['range'].row,\n                    'column': source['range'].column\n                }];\n        }\n        if (Store.luckysheet_select_save.length > 0) {\n            //有选区时，刷新一下选区\n            selectHightlightShow();\n        } \n        //条件格式\n        Store.luckysheetfile[getSheetIndex(source['sheetIndex'])].luckysheet_conditionformat_save = source['curCdformat'];\n        Store.luckysheetfile[getSheetIndex(target['sheetIndex'])].luckysheet_conditionformat_save = target['curCdformat'];    //数据验证\n        //数据验证\n        if (Store.currentSheetIndex == source['sheetIndex']) {\n            Store.dataVerification = source['curDataVerification'];\n        } else if (Store.currentSheetIndex == target['sheetIndex']) {\n            Store.dataVerification = target['curDataVerification'];\n        }\n        Store.luckysheetfile[getSheetIndex(source['sheetIndex'])].dataVerification = source['curDataVerification'];\n        Store.luckysheetfile[getSheetIndex(target['sheetIndex'])].dataVerification = target['curDataVerification'];\n        formula.execFunctionExist.reverse();\n        formula.execFunctionGroup(null, null, null, null, target['curData']);\n        formula.execFunctionGlobalData = null;\n        refreshCanvasTimeOut = setTimeout(function () {\n            luckysheetrefreshgrid();\n        }, 1);\n        sheetmanage.storeSheetParamALL();\n        //saveparam\n        //来源表\n        Store.saveParam('all', source['sheetIndex'], source['curConfig'], { 'k': 'config' });\n        //目的表\n        Store.saveParam('all', target['sheetIndex'], target['curConfig'], { 'k': 'config' });\n        //来源表\n        Store.historyParam(source['curData'], source['sheetIndex'], {\n            'row': source['range']['row'],\n            'column': source['range']['column']\n        }); \n        //目的表\n        Store.historyParam(target['curData'], target['sheetIndex'], {\n            'row': target['range']['row'],\n            'column': target['range']['column']\n        }); \n        //来源表\n        Store.saveParam('all', source['sheetIndex'], source['curCdformat'], { 'k': 'luckysheet_conditionformat_save' });    //目的表\n        //目的表\n        Store.saveParam('all', target['sheetIndex'], target['curCdformat'], { 'k': 'luckysheet_conditionformat_save' });    //来源表\n        //来源表\n        Store.saveParam('all', source['sheetIndex'], source['curDataVerification'], { 'k': 'dataVerification' });    //目的表\n        //目的表\n        Store.saveParam('all', target['sheetIndex'], target['curDataVerification'], { 'k': 'dataVerification' });\n    } \n    //行高、列宽改变 刷新表格\n    function jfrefreshgrid_rhcw(rowheight, colwidth, isRefreshCanvas = true) {\n        rhchInit(rowheight, colwidth);\n        clearTimeout(refreshCanvasTimeOut);\n        sheetmanage.storeSheetParam();    //行高列宽改变时 重新计算sparklines\n        //行高列宽改变时 重新计算sparklines\n        let calcChain = Store.luckysheetfile[getSheetIndex(Store.currentSheetIndex)].calcChain;\n        if (calcChain != null && calcChain.length > 0) {\n            if (Store.config['rowlen'] == null) {\n                Store.config['rowlen'] = {};\n            }\n            if (Store.config['columnlen'] == null) {\n                Store.config['columnlen'] = {};\n            }\n            for (let i = 0; i < calcChain.length; i++) {\n                let r = calcChain[i].r, c = calcChain[i].c, index = calcChain[i].index;\n                if (index == Store.currentSheetIndex && Store.flowdata[r][c] != null && Store.flowdata[r][c].spl != null && (r in Store.config['rowlen'] || c in Store.config['columnlen'])) {\n                    window.luckysheetCurrentRow = r;\n                    window.luckysheetCurrentColumn = c;\n                    window.luckysheetCurrentFunction = Store.flowdata[r][c].f;\n                    let fp = $.trim(formula.functionParserExe(Store.flowdata[r][c].f));\n                    let sparklines = new Function('return ' + fp)();\n                    Store.flowdata[r][c].spl = sparklines;\n                    Store.saveParam('v', Store.currentSheetIndex, Store.flowdata[r][c], {\n                        'r': r,\n                        'c': c\n                    });\n                }\n            }\n            Store.luckysheetfile[getSheetIndex(Store.currentSheetIndex)].data = Store.flowdata;\n        }    //批注框同步\n        //批注框同步\n        luckysheetPostil.positionSync();    //选区同步\n        //选区同步\n        selectHightlightShow();    // 协同提示框同步\n        // 协同提示框同步\n        collaborativeEditBox();    //改变单元格行高，复制虚线框同步\n        //改变单元格行高，复制虚线框同步\n        if ($('.luckysheet-selection-copy').is(':visible')) {\n            selectionCopyShow();\n        }    //改变单元格行高，选区下拉icon隐藏\n        //改变单元格行高，选区下拉icon隐藏\n        if ($('#luckysheet-dropCell-icon').is(':visible')) {\n            $('#luckysheet-dropCell-icon').remove();\n        }    //有冻结状态时，同步行高、列宽\n        //有冻结状态时，同步行高、列宽\n        if (Store.freezenhorizontaldata != null && Store.freezenverticaldata != null) {\n            let row_st = Store.freezenhorizontaldata[1] - 1;\n            let col_st = Store.freezenverticaldata[1] - 1;\n            let scrollTop = Store.freezenhorizontaldata[2];\n            let scrollLeft = Store.freezenverticaldata[2];\n            let top = Store.visibledatarow[row_st] - 2 - scrollTop + Store.columnHeaderHeight;\n            let freezenhorizontaldata = [\n                Store.visibledatarow[row_st],\n                row_st + 1,\n                scrollTop,\n                luckysheetFreezen.cutVolumn(Store.visibledatarow, row_st + 1),\n                top\n            ];\n            let left = Store.visibledatacolumn[col_st] - 2 - scrollLeft + Store.rowHeaderWidth;\n            let freezenverticaldata = [\n                Store.visibledatacolumn[col_st],\n                col_st + 1,\n                scrollLeft,\n                luckysheetFreezen.cutVolumn(Store.visibledatacolumn, col_st + 1),\n                left\n            ];\n            luckysheetFreezen.saveFreezen(freezenhorizontaldata, top, freezenverticaldata, left);\n            luckysheetFreezen.createFreezenHorizontal(freezenhorizontaldata, top);\n            luckysheetFreezen.createFreezenVertical(freezenverticaldata, left);\n            luckysheetFreezen.createAssistCanvas();\n        } else if (Store.freezenhorizontaldata != null) {\n            let row_st = Store.freezenhorizontaldata[1] - 1;\n            let scrollTop = Store.freezenhorizontaldata[2];\n            let top = Store.visibledatarow[row_st] - 2 - scrollTop + Store.columnHeaderHeight;\n            let freezenhorizontaldata = [\n                Store.visibledatarow[row_st],\n                row_st + 1,\n                scrollTop,\n                luckysheetFreezen.cutVolumn(Store.visibledatarow, row_st + 1),\n                top\n            ];\n            luckysheetFreezen.saveFreezen(freezenhorizontaldata, top, null, null);\n            luckysheetFreezen.createFreezenHorizontal(freezenhorizontaldata, top);\n            luckysheetFreezen.createAssistCanvas();\n        } else if (Store.freezenverticaldata != null) {\n            let col_st = Store.freezenverticaldata[1] - 1;\n            let scrollLeft = Store.freezenverticaldata[2];\n            let left = Store.visibledatacolumn[col_st] - 2 - scrollLeft + Store.rowHeaderWidth;\n            let freezenverticaldata = [\n                Store.visibledatacolumn[col_st],\n                col_st + 1,\n                scrollLeft,\n                luckysheetFreezen.cutVolumn(Store.visibledatacolumn, col_st + 1),\n                left\n            ];\n            luckysheetFreezen.saveFreezen(null, null, freezenverticaldata, left);\n            luckysheetFreezen.createFreezenVertical(freezenverticaldata, left);\n            luckysheetFreezen.createAssistCanvas();\n        } else {\n            //有筛选标志时，同步筛选按钮和筛选范围位置\n            if ($('#luckysheet-filter-options-sheet' + Store.currentSheetIndex + ' .luckysheet-filter-options').length > 0) {\n                $('#luckysheet-filter-options-sheet' + Store.currentSheetIndex + ' .luckysheet-filter-options').each(function (i, e) {\n                    let str = $(e).data('str'), cindex = $(e).data('cindex');\n                    let left = Store.visibledatacolumn[cindex] - 20;\n                    let top = str - 1 == -1 ? 0 : Store.visibledatarow[str - 1];\n                    $(e).css({\n                        'left': left,\n                        'top': top\n                    });\n                });\n            }\n        }\n        if ($('#luckysheet-filter-selected-sheet' + Store.currentSheetIndex).length > 0) {\n            let luckysheet_filter_save = Store.luckysheetfile[getSheetIndex(Store.currentSheetIndex)].filter_select;\n            let r1 = luckysheet_filter_save.row[0], r2 = luckysheet_filter_save.row[1];\n            let c1 = luckysheet_filter_save.column[0], c2 = luckysheet_filter_save.column[1];\n            let row = Store.visibledatarow[r2], row_pre = r1 - 1 == -1 ? 0 : Store.visibledatarow[r1 - 1];\n            let col = Store.visibledatacolumn[c2], col_pre = c1 - 1 == -1 ? 0 : Store.visibledatacolumn[c1 - 1];\n            $('#luckysheet-filter-selected-sheet' + Store.currentSheetIndex).css({\n                'left': col_pre,\n                'width': col - col_pre - 1,\n                'top': row_pre,\n                'height': row - row_pre - 1\n            });\n        }\n        sheetmanage.showSheet();\n        if (isRefreshCanvas) {\n            refreshCanvasTimeOut = setTimeout(function () {\n                luckysheetrefreshgrid();\n            }, 1);\n        }\n    }    \n    //Refresh the canvas display data according to scrollHeight and scrollWidth\n    function luckysheetrefreshgrid(scrollWidth, scrollHeight) {\n        formula.groupValuesRefresh();\n        if (scrollWidth == null) {\n            scrollWidth = $('#luckysheet-cell-main').scrollLeft();\n        }\n        if (scrollHeight == null) {\n            scrollHeight = $('#luckysheet-cell-main').scrollTop();\n        }\n        if (Store.freezenverticaldata != null || Store.freezenhorizontaldata != null) {\n            let freezen_horizon_px, freezen_horizon_ed, freezen_horizon_scrollTop;\n            let freezen_vertical_px, freezen_vertical_ed, freezen_vertical_scrollTop;\n            let drawWidth = Store.luckysheetTableContentHW[0], drawHeight = Store.luckysheetTableContentHW[1];\n            if (Store.freezenverticaldata != null && Store.freezenhorizontaldata != null) {\n                freezen_horizon_px = Store.freezenhorizontaldata[0];\n                freezen_horizon_ed = Store.freezenhorizontaldata[1];\n                freezen_horizon_scrollTop = Store.freezenhorizontaldata[2];\n                freezen_vertical_px = Store.freezenverticaldata[0];\n                freezen_vertical_ed = Store.freezenverticaldata[1];\n                freezen_vertical_scrollTop = Store.freezenverticaldata[2]; \n                //左上canvas freezen_3\n                luckysheetDrawMain(freezen_vertical_scrollTop, freezen_horizon_scrollTop, freezen_vertical_px, freezen_horizon_px, 1, 1, null, null, 'freezen_3');    //上右canvas freezen_4\n                //上右canvas freezen_4\n                luckysheetDrawMain(scrollWidth + freezen_vertical_px - freezen_vertical_scrollTop, freezen_horizon_scrollTop, drawWidth - freezen_vertical_px + freezen_vertical_scrollTop, freezen_horizon_px, 1, 1, null, null, 'freezen_4');    //左下canvas freezen_7\n                //左下canvas freezen_7\n                luckysheetDrawMain(freezen_vertical_scrollTop, scrollHeight + freezen_horizon_px - freezen_horizon_scrollTop, freezen_vertical_px, drawHeight - freezen_horizon_px + freezen_horizon_scrollTop, 1, 1, null, null, 'freezen_7');    //右下canvas luckysheetTableContent\n                //右下canvas luckysheetTableContent\n                luckysheetDrawMain(scrollWidth + freezen_vertical_px - freezen_vertical_scrollTop, scrollHeight + freezen_horizon_px - freezen_horizon_scrollTop, drawWidth - freezen_vertical_px + freezen_vertical_scrollTop, drawHeight - freezen_horizon_px + freezen_horizon_scrollTop, freezen_vertical_px - freezen_vertical_scrollTop + Store.rowHeaderWidth, freezen_horizon_px - freezen_horizon_scrollTop + Store.columnHeaderHeight);    //标题\n                //标题\n                luckysheetDrawgridColumnTitle(freezen_vertical_scrollTop, freezen_vertical_px, Store.rowHeaderWidth);\n                luckysheetDrawgridColumnTitle(scrollWidth + freezen_vertical_px - freezen_vertical_scrollTop, drawWidth - freezen_vertical_px + freezen_vertical_scrollTop, freezen_vertical_px - freezen_vertical_scrollTop + Store.rowHeaderWidth);\n                luckysheetDrawgridRowTitle(freezen_horizon_scrollTop, freezen_horizon_px, Store.columnHeaderHeight);\n                luckysheetDrawgridRowTitle(scrollHeight + freezen_horizon_px - freezen_horizon_scrollTop, drawHeight - freezen_horizon_px + freezen_horizon_scrollTop, freezen_horizon_px - freezen_horizon_scrollTop + Store.columnHeaderHeight);\n            } else if (Store.freezenhorizontaldata != null) {\n                freezen_horizon_px = Store.freezenhorizontaldata[0];\n                freezen_horizon_ed = Store.freezenhorizontaldata[1];\n                freezen_horizon_scrollTop = Store.freezenhorizontaldata[2];\n                luckysheetDrawMain(scrollWidth, freezen_horizon_scrollTop, drawWidth, freezen_horizon_px, 1, 1, null, null, 'freezen_h');\n                luckysheetDrawMain(scrollWidth, scrollHeight + freezen_horizon_px - freezen_horizon_scrollTop, drawWidth, drawHeight - freezen_horizon_px + freezen_horizon_scrollTop, null, freezen_horizon_px - freezen_horizon_scrollTop + Store.columnHeaderHeight);\n                luckysheetDrawgridColumnTitle(scrollWidth, drawWidth, null);\n                luckysheetDrawgridRowTitle(freezen_horizon_scrollTop, freezen_horizon_px, Store.columnHeaderHeight);\n                luckysheetDrawgridRowTitle(scrollHeight + freezen_horizon_px - freezen_horizon_scrollTop, drawHeight - freezen_horizon_px + freezen_horizon_scrollTop, freezen_horizon_px - freezen_horizon_scrollTop + Store.columnHeaderHeight);\n            } else if (Store.freezenverticaldata != null) {\n                freezen_vertical_px = Store.freezenverticaldata[0];\n                freezen_vertical_ed = Store.freezenverticaldata[1];\n                freezen_vertical_scrollTop = Store.freezenverticaldata[2];\n                luckysheetDrawMain(freezen_vertical_scrollTop, scrollHeight, freezen_vertical_px, drawHeight, 1, 1, null, null, 'freezen_v');\n                luckysheetDrawMain(scrollWidth + freezen_vertical_px - freezen_vertical_scrollTop, scrollHeight, drawWidth - freezen_vertical_px + freezen_vertical_scrollTop, drawHeight, freezen_vertical_px - freezen_vertical_scrollTop + Store.rowHeaderWidth, null);\n                luckysheetDrawgridRowTitle(scrollHeight, drawHeight, null);\n                luckysheetDrawgridColumnTitle(freezen_vertical_scrollTop, freezen_vertical_px, Store.rowHeaderWidth);\n                luckysheetDrawgridColumnTitle(scrollWidth + freezen_vertical_px - freezen_vertical_scrollTop, drawWidth - freezen_vertical_px + freezen_vertical_scrollTop, freezen_vertical_px - freezen_vertical_scrollTop + Store.rowHeaderWidth);\n            }\n        } else {\n            if ($('#luckysheetTableContent').length == 0) {\n                return;\n            }\n            let luckysheetTableContent = $('#luckysheetTableContent').get(0).getContext('2d');\n            luckysheetDrawMain(scrollWidth, scrollHeight);    // luckysheetTableContent.clearRect(0, 0, 46, 20);\n            // luckysheetTableContent.clearRect(0, 0, 46, 20);\n            luckysheetDrawgridColumnTitle(scrollWidth);\n            luckysheetDrawgridRowTitle(scrollHeight);    //清除canvas左上角区域 防止列标题栏序列号溢出显示\n            //清除canvas左上角区域 防止列标题栏序列号溢出显示\n            luckysheetTableContent.clearRect(0, 0, Store.rowHeaderWidth * Store.devicePixelRatio - 1, Store.columnHeaderHeight * Store.devicePixelRatio - 1);\n        }\n    }\n\n    Store.onRefresh = luckysheetrefreshgrid;\n    Store.onRefreshGrid = jfrefreshgrid;\n    Store.onRefreshGridAll = jfrefreshgridall;\n    Store.onRefreshRange = jfrefreshgrid;\n    Store.onRefreshGrid_adRC = jfrefreshgrid_adRC;\n    Store.onRefreshGrid_deleteCell = jfrefreshgrid_deleteCell;\n    Store.onRefreshGrid_pastcut = jfrefreshgrid_pastcut;\n    Store.onRefreshGrid_rhcw = jfrefreshgrid_rhcw;\n\n\n\n    return {\n        jfrefreshgrid,\n        jfrefreshgridall,\n        jfrefreshrange,\n        jfrefreshgrid_adRC,\n        jfrefreshgrid_deleteCell,\n        jfrefreshgrid_pastcut,\n        jfrefreshgrid_rhcw,\n        luckysheetrefreshgrid\n    };\n});"]}