{"version":3,"sources":["controllers/cellFormat.js"],"names":["define","Store","m_util","m_constant","cells","m_protection","locale","m_setdata","replaceHtml","transformRangeToAbsolute","openSelfModel","modelHTML","checkProtectionNotEnable","setcellvalue","isInitialCellFormatModel","recycleSeletion","cycleFunction","dataIsNullFunction","luckysheet_select_save","length","data","getSheetByIndex","i","selection","row","column","r","c","cell","margeset","mergeborer","row_index","col_index","initialCellFormatModel","_locale","local_cellFormat","cellFormat","locale_button","button","$","append","id","addclass","title","cellFormatTitle","content","protection","protectionTips","locked","hidden","botton","confirm","cancel","style","click","is","d","lo","hi","alert","sheetDataIsNullAlert","refreshRange","undefined","hide","initialCellFormatModelEvent","openCellFormatModel","currentSheetIndex","lockedCount","hiddenCount","count","selectionIsNullAlert","tipsLock","tipshidden","tipsAll","tipsPart","prop","parent","next","html"],"mappings":"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","file":"../../controllers/cellFormat.js","sourcesContent":["define([\n    '../store',\n    '../utils/util',\n    '../widgets/constant',\n    '../methods/cells',\n    '../methods/protection_methods',\n    '../locale/locale',\n    '../methods/setdata'\n], function (Store, m_util, m_constant, cells, m_protection, locale, m_setdata) {\n    'use strict';\n    const {replaceHtml, transformRangeToAbsolute, openSelfModel} = m_util;\n    const {modelHTML} = m_constant;\n    const {checkProtectionNotEnable} = m_protection;\n    const {setcellvalue} = m_setdata;\n    let isInitialCellFormatModel = false;\n    function initialCellFormatModelEvent() {\n        const _locale = locale();\n        const local_cellFormat = _locale.cellFormat;\n        $('#luckysheet-cellFormat-confirm').click(function () {\n            let locked = $('#luckysheet-protection-check-locked').is(':checked');\n            let hidden = $('#luckysheet-protection-check-hidden').is(':checked');\n            locked = locked == true ? 1 : 0;\n            hidden = hidden == true ? 1 : 0;\n            let d = recycleSeletion(function (cell, r, c, data) {\n                if (cell == null) {\n                    setcellvalue(r, c, data, {\n                        lo: locked,\n                        hi: hidden\n                    });\n                } else {\n                    cell.lo = locked;\n                    cell.hi = hidden;\n                }\n            }, function () {\n                alert(local_cellFormat.sheetDataIsNullAlert);\n            });\n            ///jfrefreshgrid(d, undefined, undefined, false);\n            Store.refreshRange(d,undefined,undefined,false);\n\n            $('#luckysheet-cellFormat-config').hide();\n            $('#luckysheet-modal-dialog-mask').hide();\n        });\n    }\n    function recycleSeletion(cycleFunction, dataIsNullFunction) {\n        if (Store.luckysheet_select_save != null && Store.luckysheet_select_save.length > 0) {\n            let sheetFile = Store.getSheetByIndex(), data = sheetFile.data;\n            if (data != null) {\n                for (let i = 0; i < Store.luckysheet_select_save.length; i++) {\n                    let selection = Store.luckysheet_select_save[i];\n                    let row = selection.row, column = selection.column;\n                    for (let r = row[0]; r <= row[1]; r++) {\n                        for (let c = column[0]; c <= column[1]; c++) {\n                            let cell;\n                            let margeset = cells.mergeborer(data, r, c);\n                            if (!!margeset) {\n                                // row = margeset.row[1];\n                                // row_pre = margeset.row[0];\n                                let row_index = margeset.row[2];    // row_index_ed = margeset.row[3];\n                                                                    // col = margeset.column[1];\n                                                                    // col_pre = margeset.column[0];\n                                // row_index_ed = margeset.row[3];\n                                // col = margeset.column[1];\n                                // col_pre = margeset.column[0];\n                                let col_index = margeset.column[2];    // col_index_ed = margeset.column[3];\n                                // col_index_ed = margeset.column[3];\n                                cell = data[row_index][col_index];\n                            } else {\n                                cell = data[r][c];\n                            }    // if(cell.lo==null || cell.lo==1){\n                                 //     locked = true;\n                                 //     lockedCount++;\n                                 // }\n                                 // if(cell.hi==1){\n                                 //     hidden = true;\n                                 //     hiddenCount++;\n                                 // }\n                                 // count++;\n                            // if(cell.lo==null || cell.lo==1){\n                            //     locked = true;\n                            //     lockedCount++;\n                            // }\n                            // if(cell.hi==1){\n                            //     hidden = true;\n                            //     hiddenCount++;\n                            // }\n                            // count++;\n                            cycleFunction(cell, r, c, data);\n                        }\n                    }\n                }\n            } else {\n                // locked = true;\n                dataIsNullFunction();\n            }\n            return data;\n        }\n    }\n    function initialCellFormatModel() {\n        if (isInitialCellFormatModel) {\n            return;\n        }\n        isInitialCellFormatModel = true;\n        const _locale = locale();\n        const local_cellFormat = _locale.cellFormat;\n        const locale_button = _locale.button;    //Password input initial\n        //Password input initial\n        $('body').append(replaceHtml(modelHTML, {\n            'id': 'luckysheet-cellFormat-config',\n            'addclass': 'luckysheet-cellFormat-config',\n            'title': local_cellFormat.cellFormatTitle,\n            'content': `\n            <div class=\"luckysheet-cellFormat-menu-c\">\n                <div class=\"luckysheet-cellFormat-menu luckysheet-cellFormat-menu-active\" id=\"luckysheet-cellFormat-protection\">\n                    ${ local_cellFormat.protection }\n                </div>\n            </div>\n            <div id=\"luckysheet-cellFormat-protection-content\" class=\"luckysheet-cellFormat-content\">\n                <div class=\"luckysheet-cellFormat-protection\">\n                    <p>\n                        ${ local_cellFormat.protectionTips }\n                    </p>\n                    <label for=\"luckysheet-protection-check-locked\"><input id=\"luckysheet-protection-check-locked\" name=\"luckysheet-protection-check-locked\" type=\"checkbox\">${ local_cellFormat.locked }</label><span>部分选中</span>\n                    <br/>\n                    <label for=\"luckysheet-protection-check-hidden\"><input id=\"luckysheet-protection-check-hidden\" name=\"luckysheet-protection-check-hidden\" type=\"checkbox\">${ local_cellFormat.hidden }</label><span>全部选中</span>\n                </div>\n            </div>\n        `,\n            'botton': `<button id=\"luckysheet-cellFormat-confirm\" class=\"btn btn-primary\">${ locale_button.confirm }</button>\n                    <button class=\"btn btn-default luckysheet-model-close-btn\">${ locale_button.cancel }</button>`,\n            'style': 'z-index:100003'\n        }));\n        initialCellFormatModelEvent();\n    }\n    function openCellFormatModel() {\n        initialCellFormatModel();\n        const _locale = locale();\n        const local_cellFormat = _locale.cellFormat;\n        const locale_button = _locale.button;\n        $('#luckysheet-rightclick-menu').hide();\n        if (!checkProtectionNotEnable(Store.currentSheetIndex)) {\n            return;\n        }\n        let locked = false, hidden = false;\n        let lockedCount = 0, hiddenCount = 0, count = 0;\n        if (Store.luckysheet_select_save != null && Store.luckysheet_select_save.length > 0) {\n            recycleSeletion(function (cell) {\n                // let cell = data[r][c];\n                if (cell == null || cell.lo == null || cell.lo == 1) {\n                    locked = true;\n                    lockedCount++;\n                }\n                if (cell != null && cell.hi == 1) {\n                    hidden = true;\n                    hiddenCount++;\n                }\n                count++;\n            }, function () {\n                locked = true;\n            });\n        } else {\n            alert(local_cellFormat.selectionIsNullAlert);\n            return;\n        }\n        let tipsLock = '', tipshidden = '';\n        if (locked) {\n            tipsLock = lockedCount == count ? local_cellFormat.tipsAll : local_cellFormat.tipsPart;\n        }\n        if (hidden) {\n            tipshidden = hiddenCount == count ? local_cellFormat.tipsAll : local_cellFormat.tipsPart;\n        }\n        $('#luckysheet-protection-check-locked').prop('checked', locked).parent().next().html(tipsLock);\n        $('#luckysheet-protection-check-hidden').prop('checked', hidden).parent().next().html(tipshidden);\n        openSelfModel('luckysheet-cellFormat-config');\n    }\n    return { openCellFormatModel: openCellFormatModel };\n});"]}