{"version":3,"sources":["controllers/formulaBar.js"],"names":["define","menuButton","m_updateCell","m_constant","m_sheetMove","insertFormula","m_location","m_validate","formula","tooltip","locale","Store","luckysheetupdateCell","keycode","luckysheetMoveHighlightCell","rowLocation","colLocation","mouseposition","isEditMode","formulaBarInitial","locale_formula","$","focus","luckysheet_select_save","length","last","row_index","col_index","flowdata","rangeResizeTo","keydown","event","ctrlKey","altKey","shiftKey","kcode","keyCode","$inputbox","ENTER","parseInt","css","is","searchFunctionCell","searchFunctionEnter","find","updatecell","luckysheetCellUpdate","row","column","row_focus","column_focus","preventDefault","ESC","dontupdate","F4","setfreezonFuc","UP","$up","prev","removeClass","addClass","DOWN","next","first","LEFT","rangeHightlightselected","RIGHT","functionInputHanddler","click","this","hasClass","hide","alert","tipSelectCell","info","cell","f","functionStr","getfunctionParam","fn","formulaParmDialog","param","formulaListDialog","html","init","on","rangeMove","luckysheet_scroll_status","rangeMoveObj","parent","rangeMoveIndex","attr","mouse","pageX","pageY","x","scrollLeft","y","scrollTop","type","data","rangeMovexy","stopPropagation","rangeResize","rangeResizeIndex","rangeResizeObj","row_location","row_pre","col_location","col","col_pre","position","rangeResizexy","width","height","left","top","rangeResizeWinH","scrollHeight","rangeResizeWinW","scrollWidth"],"mappings":"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","file":"../../controllers/formulaBar.js","sourcesContent":["define([\n    './menuButton',\n    './updateCell',\n    './constant',\n    './sheetMove',\n    './insertFormula',\n    '../global/location',\n    '../global/validate',\n    '../global/formula',\n    '../global/tooltip',\n    '../locale/locale',\n    '../store'\n], function (menuButton, m_updateCell, m_constant, m_sheetMove, insertFormula, m_location, m_validate, formula, tooltip, locale, Store) {\n    'use strict';\n    const {luckysheetupdateCell} = m_updateCell;\n    const {keycode} = m_constant;\n    const {luckysheetMoveHighlightCell} = m_sheetMove;\n    const {rowLocation, colLocation, mouseposition} = m_location;\n    const {isEditMode} = m_validate;\n    function formulaBarInitial() {\n        //公式栏处理\n        const _locale = locale();\n        const locale_formula = _locale.formula;\n        $('#luckysheet-functionbox-cell').focus(function () {\n            if (isEditMode()) {\n                //此模式下禁用公式栏\n                return;\n            }\n            if (Store.luckysheet_select_save.length > 0) {\n                let last = Store.luckysheet_select_save[Store.luckysheet_select_save.length - 1];\n                let row_index = last['row_focus'], col_index = last['column_focus'];    // let $input = $(\"#luckysheet-rich-text-editor\"),value = $input.text();\n                                                                                        // if(value) {\n                                                                                        //     formula.updatecell(row_index, col_index);\n                                                                                        // }\n                // let $input = $(\"#luckysheet-rich-text-editor\"),value = $input.text();\n                // if(value) {\n                //     formula.updatecell(row_index, col_index);\n                // }\n                luckysheetupdateCell(row_index, col_index, Store.flowdata, null, true);\n                formula.rangeResizeTo = $('#luckysheet-functionbox-cell');\n            }\n        }).keydown(function (event) {\n            if (isEditMode()) {\n                //此模式下禁用公式栏\n                return;\n            }\n            let ctrlKey = event.ctrlKey;\n            let altKey = event.altKey;\n            let shiftKey = event.shiftKey;\n            let kcode = event.keyCode;\n            let $inputbox = $('#luckysheet-input-box');\n            if (kcode == keycode.ENTER && parseInt($inputbox.css('top')) > 0) {\n                if ($('#luckysheet-formula-search-c').is(':visible') && formula.searchFunctionCell != null) {\n                    formula.searchFunctionEnter($('#luckysheet-formula-search-c').find('.luckysheet-formula-search-item-active'));\n                } else {\n                    formula.updatecell(Store.luckysheetCellUpdate[0], Store.luckysheetCellUpdate[1]);\n                    Store.luckysheet_select_save = [{\n                            'row': [\n                                Store.luckysheetCellUpdate[0],\n                                Store.luckysheetCellUpdate[0]\n                            ],\n                            'column': [\n                                Store.luckysheetCellUpdate[1],\n                                Store.luckysheetCellUpdate[1]\n                            ],\n                            'row_focus': Store.luckysheetCellUpdate[0],\n                            'column_focus': Store.luckysheetCellUpdate[1]\n                        }];\n                    luckysheetMoveHighlightCell('down', 1, 'rangeOfSelect');    //$(\"#luckysheet-functionbox-cell\").blur();\n                    //$(\"#luckysheet-functionbox-cell\").blur();\n                    $('#luckysheet-rich-text-editor').focus();\n                }\n                event.preventDefault();\n            } else if (kcode == keycode.ESC && parseInt($inputbox.css('top')) > 0) {\n                formula.dontupdate();\n                luckysheetMoveHighlightCell('down', 0, 'rangeOfSelect');    //$(\"#luckysheet-functionbox-cell\").blur();\n                //$(\"#luckysheet-functionbox-cell\").blur();\n                $('#luckysheet-rich-text-editor').focus();\n                event.preventDefault();\n            } else if (kcode == keycode.F4 && parseInt($inputbox.css('top')) > 0) {\n                formula.setfreezonFuc(event);\n                event.preventDefault();\n            } else if (kcode == keycode.UP && parseInt($inputbox.css('top')) > 0) {\n                if ($('#luckysheet-formula-search-c').is(':visible')) {\n                    let $up = $('#luckysheet-formula-search-c').find('.luckysheet-formula-search-item-active').prev();\n                    if ($up.length == 0) {\n                        $up = $('#luckysheet-formula-search-c').find('.luckysheet-formula-search-item').last();\n                    }\n                    $('#luckysheet-formula-search-c').find('.luckysheet-formula-search-item').removeClass('luckysheet-formula-search-item-active');\n                    $up.addClass('luckysheet-formula-search-item-active');\n                    event.preventDefault();\n                }\n            } else if (kcode == keycode.DOWN && parseInt($inputbox.css('top')) > 0) {\n                if ($('#luckysheet-formula-search-c').is(':visible')) {\n                    let $up = $('#luckysheet-formula-search-c').find('.luckysheet-formula-search-item-active').next();\n                    if ($up.length == 0) {\n                        $up = $('#luckysheet-formula-search-c').find('.luckysheet-formula-search-item').first();\n                    }\n                    $('#luckysheet-formula-search-c').find('.luckysheet-formula-search-item').removeClass('luckysheet-formula-search-item-active');\n                    $up.addClass('luckysheet-formula-search-item-active');\n                    event.preventDefault();\n                }\n            } else if (kcode == keycode.LEFT && parseInt($inputbox.css('top')) > 0) {\n                formula.rangeHightlightselected($('#luckysheet-functionbox-cell'));\n            } else if (kcode == keycode.RIGHT && parseInt($inputbox.css('top')) > 0) {\n                formula.rangeHightlightselected($('#luckysheet-functionbox-cell'));\n            } else if (!(kcode >= 112 && kcode <= 123 || kcode <= 46 || kcode == 144 || kcode == 108 || event.ctrlKey || event.altKey || event.shiftKey && (kcode == 37 || kcode == 38 || kcode == 39 || kcode == 40)) || kcode == 8 || kcode == 32 || kcode == 46 || event.ctrlKey && kcode == 86) {\n                formula.functionInputHanddler($('#luckysheet-rich-text-editor'), $('#luckysheet-functionbox-cell'), kcode);\n            }\n        }).click(function () {\n            if (isEditMode()) {\n                //此模式下禁用公式栏\n                return;\n            }\n            formula.rangeHightlightselected($('#luckysheet-functionbox-cell'));\n        });    //公式栏 取消（X）按钮\n        //公式栏 取消（X）按钮\n        $('#luckysheet-wa-functionbox-cancel').click(function () {\n            if (!$(this).hasClass('luckysheet-wa-calculate-active')) {\n                return;\n            }    //若有参数弹出框，隐藏\n            //若有参数弹出框，隐藏\n            if ($('#luckysheet-search-formula-parm').is(':visible')) {\n                $('#luckysheet-search-formula-parm').hide();\n            }    //若有参数选取范围弹出框，隐藏\n            //若有参数选取范围弹出框，隐藏\n            if ($('#luckysheet-search-formula-parm-select').is(':visible')) {\n                $('#luckysheet-search-formula-parm-select').hide();\n            }\n            formula.dontupdate();\n            luckysheetMoveHighlightCell('down', 0, 'rangeOfSelect');\n        });    //公式栏 确认（）按钮\n        //公式栏 确认（）按钮\n        $('#luckysheet-wa-functionbox-confirm').click(function () {\n            if (!$(this).hasClass('luckysheet-wa-calculate-active')) {\n                return;\n            }    //若有参数弹出框，隐藏\n            //若有参数弹出框，隐藏\n            if ($('#luckysheet-search-formula-parm').is(':visible')) {\n                $('#luckysheet-search-formula-parm').hide();\n            }    //若有参数选取范围弹出框，隐藏\n            //若有参数选取范围弹出框，隐藏\n            if ($('#luckysheet-search-formula-parm-select').is(':visible')) {\n                $('#luckysheet-search-formula-parm-select').hide();\n            }\n            formula.updatecell(Store.luckysheetCellUpdate[0], Store.luckysheetCellUpdate[1]);\n            luckysheetMoveHighlightCell('down', 0, 'rangeOfSelect');\n        });    //公式栏 fx按钮\n        //公式栏 fx按钮\n        $('#luckysheet-wa-functionbox-fx').click(function () {\n            //点击函数查找弹出框\n            if (Store.luckysheet_select_save.length == 0) {\n                if (isEditMode()) {\n                    alert(locale_formula.tipSelectCell);\n                } else {\n                    tooltip.info(locale_formula.tipSelectCell, '');\n                }\n                return;\n            }\n            let last = Store.luckysheet_select_save[Store.luckysheet_select_save.length - 1];\n            let row_index = last['row_focus'], col_index = last['column_focus'];\n            luckysheetupdateCell(row_index, col_index, Store.flowdata);\n            let cell = Store.flowdata[row_index][col_index];\n            if (cell != null && cell.f != null) {\n                //单元格有计算\n                let functionStr = formula.getfunctionParam(cell.f);\n                if (functionStr.fn != null) {\n                    //有函数公式\n                    insertFormula.formulaParmDialog(functionStr.fn, functionStr.param);\n                } else {\n                    //无函数公式\n                    insertFormula.formulaListDialog();\n                }\n            } else {\n                //单元格无计算\n                $('#luckysheet-rich-text-editor').html('<span dir=\"auto\" class=\"luckysheet-formula-text-color\">=</span>');\n                $('#luckysheet-functionbox-cell').html($('#luckysheet-rich-text-editor').html());\n                insertFormula.formulaListDialog();\n            }\n            insertFormula.init();\n        });    //公式选区操作\n        //公式选区操作\n        $('#luckysheet-formula-functionrange').on('mousedown', '.luckysheet-copy', function (event) {\n            formula.rangeMove = true;\n            Store.luckysheet_scroll_status = true;\n            formula.rangeMoveObj = $(this).parent();\n            formula.rangeMoveIndex = $(this).parent().attr('rangeindex');\n            let mouse = mouseposition(event.pageX, event.pageY);\n            let x = mouse[0] + $('#luckysheet-cell-main').scrollLeft();\n            let y = mouse[1] + $('#luckysheet-cell-main').scrollTop();\n            $('#luckysheet-formula-functionrange-highlight-' + formula.rangeMoveIndex).find('.luckysheet-selection-copy-hc').css('opacity', 0.13);\n            let type = $(this).data('type');\n            if (type == 'top') {\n                y += 3;\n            } else if (type == 'right') {\n                x -= 3;\n            } else if (type == 'bottom') {\n                y -= 3;\n            } else if (type == 'left') {\n                x += 3;\n            }\n            let row_index = rowLocation(y)[2];\n            let col_index = colLocation(x)[2];\n            formula.rangeMovexy = [\n                row_index,\n                col_index\n            ];\n            $('#luckysheet-sheettable').css('cursor', 'move');\n            event.stopPropagation();\n        });\n        $('#luckysheet-formula-functionrange').on('mousedown', '.luckysheet-highlight', function (event) {\n            formula.rangeResize = $(this).data('type');    //开始状态resize\n            //开始状态resize\n            formula.rangeResizeIndex = $(this).parent().attr('rangeindex');\n            let mouse = mouseposition(event.pageX, event.pageY), scrollLeft = $('#luckysheet-cell-main').scrollLeft(), scrollTop = $('#luckysheet-cell-main').scrollTop();\n            let x = mouse[0] + scrollLeft;\n            let y = mouse[1] + scrollTop;\n            formula.rangeResizeObj = $(this).parent();\n            $('#luckysheet-formula-functionrange-highlight-' + formula.rangeResizeIndex).find('.luckysheet-selection-copy-hc').css('opacity', 0.13);\n            if (formula.rangeResize == 'lt') {\n                x += 3;\n                y += 3;\n            } else if (formula.rangeResize == 'lb') {\n                x += 3;\n                y -= 3;\n            } else if (formula.rangeResize == 'rt') {\n                x -= 3;\n                y += 3;\n            } else if (formula.rangeResize == 'rb') {\n                x -= 3;\n                y -= 3;\n            }\n            let row_location = rowLocation(y), row = row_location[1], row_pre = row_location[0], row_index = row_location[2];\n            let col_location = colLocation(x), col = col_location[1], col_pre = col_location[0], col_index = col_location[2];\n            let position = formula.rangeResizeObj.position();\n            formula.rangeResizexy = [\n                col_pre,\n                row_pre,\n                formula.rangeResizeObj.width(),\n                formula.rangeResizeObj.height(),\n                position.left + scrollLeft,\n                position.top + scrollTop,\n                col,\n                row\n            ];\n            formula.rangeResizeWinH = $('#luckysheet-cell-main')[0].scrollHeight;\n            formula.rangeResizeWinW = $('#luckysheet-cell-main')[0].scrollWidth;\n            Store.luckysheet_scroll_status = true;\n            event.stopPropagation();\n        });\n    }\n    return { formulaBarInitial: formulaBarInitial };\n});"]}