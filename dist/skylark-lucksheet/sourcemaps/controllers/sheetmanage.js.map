{"version":3,"sources":["controllers/sheetmanage.js"],"names":["define","m_validate","cleargridelement","m_getdata","m_setdata","luckysheetcreatedom","tooltip","formula","m_refresh","rhchInit","editor","m_extend","m_util","m_constant","server","luckysheetConfigsetting","pivotTable","luckysheetsizeauto","luckysheetPostil","imageCtrl","dataVerificationCtrl","hyperlinkCtrl","luckysheetFreezen","m_filter","m_select","Store","locale","m_plugin","m_resize","m_zoom","menuButton","method","isEditMode","isRealNum","getcellvalue","datagridgrowth","getcellFormula","setcellvalue","luckysheetrefreshgrid","jfrefreshgrid_rhcw","luckysheetextendtable","luckysheetdeletetable","replaceHtml","getObjType","chatatABC","arrayRemoveItem","sheetHTML","luckysheetlodingHTML","createFilterOptions","labelFilterOptionState","selectHightlightShow","selectionCopyShow","renderChartShow","changeSheetContainerSize","menuToolBarWidth","zoomNumberDomBind","generateRandomSheetIndex","prefix","userAgent","window","navigator","replace","split","mid","i","Math","round","random","length","Date","getTime","generateRandomSheetName","file","isPivotTable","index","title","name","indexOf","suffix","parseFloat","ceil","generateCopySheetName","copySheetName","locale_info","info","toString","copy","copy_i","name2","substring","fileName","st_i","ed_i","num","parseInt","hascopy","getSheetByIndex","currentSheetIndex","this","getSheetIndex","luckysheetfile","getSheetByName","getCurSheetnoset","curindex","status","getCurSheet","hasActive","indexs","forEach","item","includes","push","addNewSheet","e","allowEdit","order","sheetname","$","append","active","style","colorset","sheetconfig","color","celldata","row","defaultrowNum","column","defaultcolumnNum","config","removeClass","addClass","saveParam","extend","clearjfundo","jfundo","redo","type","jfredo","changeSheetExec","setSheetHide","currentIdx","hide","indicator","luckysheetcurrentSheetitem","showsheetbarConfig","sheet","nextAll","eq","data","prevAll","nextActiveIdx","showSheetIdxs","ele","len","find","op","cur","setSheetShow","sheetMaxIndex","ordersheet","property","a","b","getCurrentOrder","orders","each","reOrderAllSheet","sort","x","y","order_x","order_y","createSheet","btn","display","sheetIndex","join","locationSheet","$c","winW","container","width","scrollLeftpx","c_width","hasClass","outerWidth","setTimeout","scrollLeft","css","show","copySheet","copyindex","copyarrindex","copyjson","copyobject","insertAfter","splice","jfredostr","hasSheet","createSheetbydata","isrenew","isBefore","previndex","insertBefore","reIndex","deleteSheet","arrIndex","remove","removedsheet","deleIndex","nulldata","getGridData","d","ret","r","c","v","buildGridData","j","autoFormatw","accuracy","undefined","cutGridData","rowindex","isnull","value","trim","slice","addGridData","sheetParamRestore","luckysheet_select_save","mc","rs","cs","luckysheet_selection_range","zoomRatio","defaultrowlen","defaultcollen","showGridLines","initialjfFile","menu","_this","select_save","jfgird_select_save","r2","c2","fontInitial","fontList","rowheight","colwidth","beforeCreateDom","luckysheet","workbookCreateBefore","createHoverTip","luckysheetTableContentHW","rowHeaderWidth","cellMainSrollBarSize","height","columnHeaderHeight","attr","devicePixelRatio","get","getContext","cahce_key","gridKey","ini","execF","mergeCalculation","setSheetParam","storeSheetParam","restoreselect","CacheNotLoadControll","restoreCache","execFunctionGroupForce","forceCalculation","restoreSheetAll","html","detailSave","luckysheetcurrentisPivotTable","scrollTop","asyncLoad","pointEdit","fadeOut","loadSheetUrl","loadOtherFile","sheetindexset","checkLoadSheetIndex","sheetindex","post","dataset","Function","otherfile","localforage","getItem","then","readValue","clearcachelocaldata","console","log","visibledatarow","visibledatacolumn","ch_width","rh_height","scrollWidth","offsetWidth","scrollHeight","offsetHeight","isload","flowdata","webWorkerFlowDataCache","execFunctionGlobalData","luckysheet_getcelldata_cache","freezenhorizontaldata","freezenverticaldata","horizontal","vertical","buildAllPs","currentImgId","images","allImagesShow","init","dataVerification","hyperlink","storeSheetParamALL","mergeCalculationSheet","mergeConfig","merge","substr","mcInfo","ir","ic","changeSheet","isPivotInitial","isNewSheet","allowUpdate","empty","multipleIndex","createHookFunction","setCurSheet","changePivotTable","showSheet","execFunctionGroup","initialFreezen","checkLoadSheetIndexToDataIndex","calchain","getAllFunctionGroup","chart","cache","dataIndexList","f","dataindex","formulaTxt","addToSheetIndexList","formulaContainSheetList","dataSheetIndex","functionParser","str","addToCellList","pivotDataSheetIndex","top","scrollRefreshSwitch","$sheet","rangestart","createRangeHightlight","sheetBarShowAndHide","[object Object]","containerW","offset","left","c_srollwidth","delChart","chart_id","saveChart","json","old","getChart","getRangetxt","range","currentIndex","sheettxt","row0","row1","column0","column1","getSheetName","getSheetMerge","getSheetData","getSheetConfig","restoreFilter","filter_select","JSON","parse","filter","rowhidden","$top","optionstate","caljs","st_r","ed_r","cindex","st_c","ed_c","restorePivot","getCellData","initialPivotManage","refreshPivotTable","restoreFreezen","execCache","t","pos","load","sha","shc","shd","shr","delFunctionGroup","insertUpdateFunctionGroup","k","config1","key","s","stringify","cid","vitem","rc","cell","mtype","mst","med","imageRequest"],"mappings":"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","file":"../../controllers/sheetmanage.js","sourcesContent":["define([\n    '../global/validate',\n    '../global/cleargridelement',\n    '../global/getdata',\n    '../global/setdata',\n    '../global/createdom',\n    '../global/tooltip',\n    '../global/formula',\n    '../global/refresh',\n    '../global/rhchInit',\n    '../global/editor',\n    '../global/extend',\n    '../utils/util',\n    './constant',\n    './server',\n    './luckysheetConfigsetting',\n    './pivotTable',\n    './resize',\n    './postil',\n    './imageCtrl',\n    './dataVerificationCtrl',\n    './hyperlinkCtrl',\n    './freezen',\n    './filter',\n    './select',\n    '../store',\n    '../locale/locale',\n    '../expendPlugins/chart/plugin',\n    './resize',\n    './zoom',\n    './menuButton',\n    '../global/method'\n], function (m_validate, cleargridelement, m_getdata, m_setdata, luckysheetcreatedom, tooltip, formula, m_refresh, rhchInit, editor, m_extend, m_util, m_constant, server, luckysheetConfigsetting, pivotTable, luckysheetsizeauto, luckysheetPostil, imageCtrl, dataVerificationCtrl, hyperlinkCtrl, luckysheetFreezen, m_filter, m_select, Store, locale, m_plugin, m_resize, m_zoom, menuButton, method) {\n    'use strict';\n    const {isEditMode, isRealNum} = m_validate;\n    const {getcellvalue, datagridgrowth, getcellFormula} = m_getdata;\n    const {setcellvalue} = m_setdata;\n    const {luckysheetrefreshgrid, jfrefreshgrid_rhcw} = m_refresh;\n    const {luckysheetextendtable, luckysheetdeletetable} = m_extend;\n    const {replaceHtml, getObjType, chatatABC, arrayRemoveItem} = m_util;\n    const {sheetHTML, luckysheetlodingHTML} = m_constant;\n    const {createFilterOptions, labelFilterOptionState} = m_filter;\n    const {selectHightlightShow, selectionCopyShow} = m_select;\n    const {renderChartShow} = m_plugin;\n    const {changeSheetContainerSize, menuToolBarWidth} = m_resize;\n    const {zoomNumberDomBind} = m_zoom;\n    const sheetmanage = {\n        generateRandomSheetIndex: function (prefix) {\n            if (prefix == null) {\n                prefix = 'Sheet';\n            }\n            let userAgent = window.navigator.userAgent.replace(/[^a-zA-Z0-9]/g, '').split('');\n            let mid = '';\n            for (let i = 0; i < 12; i++) {\n                mid += userAgent[Math.round(Math.random() * (userAgent.length - 1))];\n            }\n            let time = new Date().getTime();\n            return prefix + '_' + mid + '_' + time;\n        },\n        generateRandomSheetName: function (file, isPivotTable) {\n            let index = file.length;\n            const locale_pivotTable = locale().pivotTable;\n            const title = locale_pivotTable.title;\n            for (let i = 0; i < file.length; i++) {\n                if (file[i].name.indexOf('Sheet') > -1 || file[i].name.indexOf(title) > -1) {\n                    let suffix = parseFloat(file[i].name.replace('Sheet', '').replace(title, ''));\n                    if (suffix != 'NaN' && Math.ceil(suffix) > index) {\n                        index = Math.ceil(suffix);\n                    }\n                }\n            }\n            if (isPivotTable) {\n                return title + (index + 1);\n            } else {\n                return 'Sheet' + (index + 1);\n            }\n        },\n        generateCopySheetName: function (file, name) {\n            let copySheetName = '';\n            let _locale = locale();\n            let locale_info = _locale.info;\n            if (name.toString().indexOf('(' + locale_info.copy) > -1) {\n                let copy_i = name.toString().indexOf('(' + locale_info.copy);\n                let name2 = name.toString().substring(0, copy_i) + '(' + locale_info.copy;\n                let index = null;\n                for (let i = 0; i < file.length; i++) {\n                    let fileName = file[i].name.toString();\n                    let st_i = fileName.indexOf(name2);\n                    if (st_i > -1) {\n                        let ed_i = fileName.indexOf(')', st_i + name2.length);\n                        let num = fileName.substring(st_i + name2.length, ed_i);\n                        if (isRealNum(num)) {\n                            if (index == null || parseInt(num) > index) {\n                                index = parseInt(num);\n                            }\n                        }\n                    }\n                }\n                if (index == null) {\n                    copySheetName = name2 + '2)';\n                } else {\n                    index++;\n                    copySheetName = name2 + index + ')';\n                }\n            } else {\n                let index = null;\n                let hascopy = false;\n                let name2 = name + '(' + locale_info.copy;\n                for (let i = 0; i < file.length; i++) {\n                    let fileName = file[i].name.toString();\n                    let st_i = fileName.indexOf(name2);\n                    if (st_i > -1) {\n                        hascopy = true;\n                        let ed_i = fileName.indexOf(')', st_i + name2.length);\n                        let num = fileName.substring(st_i + name2.length, ed_i);\n                        if (isRealNum(num)) {\n                            if (index == null || parseInt(num) > index) {\n                                index = parseInt(num);\n                            }\n                        }\n                    }\n                }\n                if (hascopy) {\n                    if (index == null) {\n                        copySheetName = name + '(' + locale_info.copy + '2)';\n                    } else {\n                        index++;\n                        copySheetName = name + '(' + locale_info.copy + '' + index + ')';\n                    }\n                } else {\n                    copySheetName = name + '(' + locale_info.copy + ')';\n                }\n            }\n            return copySheetName;\n        },\n        getSheetByIndex: function (index) {\n            let _this = this;\n            if (index == null) {\n                index = Store.currentSheetIndex;\n            }\n            let i = _this.getSheetIndex(index);\n            return Store.luckysheetfile[i];\n        },\n        getSheetByName: function (name) {\n            let _this = this;\n            if (name == null) {\n                return null;\n            }\n            for (let i = 0; i < Store.luckysheetfile.length; i++) {\n                let file = Store.luckysheetfile[i];\n                if (file.name == name) {\n                    return file;\n                }\n            }\n            return null;\n        },\n        getCurSheetnoset: function () {\n            let curindex = 0;\n            for (let i = 0; i < Store.luckysheetfile.length; i++) {\n                if (Store.luckysheetfile[i].status == 1) {\n                    curindex = Store.luckysheetfile[i].index;\n                    break;\n                }\n            }\n            return curindex;\n        },\n        getCurSheet: function () {\n            if (Store.luckysheetfile.length) {\n                let hasActive = false, indexs = [];\n                Store.luckysheetfile.forEach(item => {\n                    if ('undefined' === typeof item.index) {\n                        item.index = this.generateRandomSheetIndex();\n                    }\n                    if (indexs.includes(item.index)) {\n                        item.index = this.generateRandomSheetIndex();\n                    } else {\n                        indexs.push(item.index);\n                    }\n                    if ('undefined' === typeof item.status) {\n                        item.status = 0;\n                    }\n                    if (item.status == 1) {\n                        if (hasActive) {\n                            item.status = 0;\n                        } else {\n                            hasActive = true;\n                        }\n                    }\n                });\n                if (!hasActive) {\n                    Store.luckysheetfile[0].status = 1;\n                }\n            }\n            Store.currentSheetIndex = Store.luckysheetfile[0].index;\n            for (let i = 0; i < Store.luckysheetfile.length; i++) {\n                if (Store.luckysheetfile[i].status == 1) {\n                    Store.currentSheetIndex = Store.luckysheetfile[i].index;\n                    break;\n                }\n            }\n            return Store.currentSheetIndex;\n        },\n        addNewSheet: function (e, isPivotTable) {\n            if (isEditMode() || Store.allowEdit === false) {\n                // alert(\"非编辑模式下不允许该操作！\");\n                return;\n            }\n            let _this = this;\n            let order = Store.luckysheetfile.length;\n            let index = _this.generateRandomSheetIndex();\n            let sheetname = _this.generateRandomSheetName(Store.luckysheetfile, isPivotTable);\n            $('#luckysheet-sheet-container-c').append(replaceHtml(sheetHTML, {\n                'index': index,\n                'active': '',\n                'name': sheetname,\n                'style': '',\n                'colorset': ''\n            }));\n            let sheetconfig = {\n                'name': sheetname,\n                'color': '',\n                'status': '0',\n                'order': order,\n                'index': index,\n                'celldata': [],\n                'row': Store.defaultrowNum,\n                'column': Store.defaultcolumnNum,\n                'config': {},\n                'pivotTable': null,\n                'isPivotTable': !!isPivotTable\n            };\n            Store.luckysheetfile.push(sheetconfig);\n            $('#luckysheet-sheet-area div.luckysheet-sheets-item').removeClass('luckysheet-sheets-item-active');\n            $('#luckysheet-sheets-item' + index).addClass('luckysheet-sheets-item-active');\n            $('#luckysheet-cell-main').append('<div id=\"luckysheet-datavisual-selection-set-' + index + '\" class=\"luckysheet-datavisual-selection-set\"></div>');\n            cleargridelement(e);\n            server.saveParam('sha', null, $.extend(true, {}, sheetconfig));\n            if (Store.clearjfundo) {\n                Store.jfundo.length = 0;\n                let redo = {};\n                redo['type'] = 'addSheet';\n                redo['sheetconfig'] = $.extend(true, {}, sheetconfig);\n                redo['index'] = index;\n                redo['currentSheetIndex'] = Store.currentSheetIndex;\n                Store.jfredo.push(redo);\n            }\n            _this.changeSheetExec(index, isPivotTable, true);\n        },\n        setSheetHide: function (index) {\n            let _this = this;\n            let currentIdx = _this.getSheetIndex(index);\n            Store.luckysheetfile[currentIdx].hide = 1;\n            let luckysheetcurrentSheetitem = $('#luckysheet-sheets-item' + index);\n            luckysheetcurrentSheetitem.hide();\n            $('#luckysheet-sheet-area div.luckysheet-sheets-item').removeClass('luckysheet-sheets-item-active');\n            let indicator;\n            if (luckysheetConfigsetting.showsheetbarConfig.sheet) {\n                indicator = luckysheetcurrentSheetitem.nextAll(':visible');\n                if (luckysheetcurrentSheetitem.nextAll(':visible').length > 0) {\n                    indicator = indicator.eq(0).data('index');\n                } else {\n                    indicator = luckysheetcurrentSheetitem.prevAll(':visible').eq(0).data('index');\n                }\n            } else {\n                let nextActiveIdx, showSheetIdxs = [];\n                Store.luckysheetfile.forEach((ele, index) => {\n                    if (1 !== ele.hide)\n                        showSheetIdxs.push(index);\n                });\n                let len = showSheetIdxs.length;\n                if (1 === len) {\n                    nextActiveIdx = showSheetIdxs[0];\n                } else {\n                    nextActiveIdx = showSheetIdxs[len - 1] > currentIdx ? showSheetIdxs.find(e => e > currentIdx) : showSheetIdxs[len - 1];\n                }\n                indicator = Store.luckysheetfile[nextActiveIdx].index;\n            }\n            $('#luckysheet-sheets-item' + indicator).addClass('luckysheet-sheets-item-active');\n            _this.changeSheetExec(indicator);\n            server.saveParam('sh', luckysheetcurrentSheetitem.data('index'), 1, {\n                'op': 'hide',\n                'cur': indicator\n            });\n        },\n        setSheetShow: function (index) {\n            let _this = this;\n            Store.luckysheetfile[_this.getSheetIndex(index)].hide = 0;\n            _this.changeSheetExec(index);\n            server.saveParam('sh', index, 0, {\n                'op': 'show',\n                'cur': null\n            });\n        },\n        sheetMaxIndex: 0,\n        ordersheet: function (property) {\n            return function (a, b) {\n                let value1 = a[property];\n                let value2 = b[property];\n                return value1 - value2;\n            };\n        },\n        getCurrentOrder: function () {\n            let orders = {};\n            $('#luckysheet-sheet-area div.luckysheet-sheets-item').each(function (a) {\n                let index = $(this).data('index');\n                for (let i = 0; i < Store.luckysheetfile.length; i++) {\n                    if (Store.luckysheetfile[i].index == index) {\n                        orders[index.toString()] = a;\n                        break;\n                    }\n                }\n            });\n            return orders;\n        },\n        reOrderAllSheet: function () {\n            let orders = {};\n            $('#luckysheet-sheet-area div.luckysheet-sheets-item').each(function (a) {\n                let index = $(this).data('index');\n                for (let i = 0; i < Store.luckysheetfile.length; i++) {\n                    if (Store.luckysheetfile[i].index == index) {\n                        Store.luckysheetfile[i].order = a;\n                        orders[index.toString()] = a;\n                        break;\n                    }\n                }\n            });\n            server.saveParam('shr', null, orders);\n            Store.luckysheetfile.sort((x, y) => {\n                let order_x = x.order;\n                let order_y = y.order;\n                if (order_x != null && order_y != null) {\n                    return order_x - order_y;\n                } else if (order_x != null) {\n                    return -1;\n                } else if (order_y != null) {\n                    return 1;\n                } else {\n                    return 1;\n                }\n            });\n        },\n        createSheet: function () {\n            //修复拖动sheet更新后台后，重新打开显示错误\n            let _this = this;\n            let btn = [];\n            Store.luckysheetfile.sort(_this.ordersheet('order'));\n            for (let i = 0; i < Store.luckysheetfile.length; i++) {\n                let display = '';\n                let sheetIndex = Store.luckysheetfile[i].index;\n                let colorset = '';\n                if (Store.luckysheetfile[i].color != null) {\n                    colorset = '<div class=\"luckysheet-sheets-item-color\" style=\" position: absolute; width: 100%; height: 3px; bottom: 0px; left: 0px; background-color: ' + Store.luckysheetfile[i].color + ';\"></div>';\n                }\n                if (Store.currentSheetIndex == sheetIndex) {\n                    //使用Store.luckysheetfile中的index比较，而不是order\n                    btn.push(replaceHtml(sheetHTML, {\n                        'index': sheetIndex,\n                        'active': 'luckysheet-sheets-item-active',\n                        'name': Store.luckysheetfile[i].name,\n                        'style': '',\n                        'colorset': colorset\n                    }));\n                } else {\n                    if (Store.luckysheetfile[i].hide == 1) {\n                        btn.push(replaceHtml(sheetHTML, {\n                            'index': sheetIndex,\n                            'active': '',\n                            'name': Store.luckysheetfile[i].name,\n                            'style': 'display:none;',\n                            'colorset': colorset\n                        }));\n                    } else {\n                        btn.push(replaceHtml(sheetHTML, {\n                            'index': sheetIndex,\n                            'active': '',\n                            'name': Store.luckysheetfile[i].name,\n                            'style': '',\n                            'colorset': colorset\n                        }));\n                    }\n                    display = \"style='display:none;'\";\n                }    //Store.luckysheetfile[i].index = i; //index即为默认\n                     // if(sheetIndex > this.sheetMaxIndex){\n                     //     this.sheetMaxIndex = sheetIndex;\n                     // }\n                //Store.luckysheetfile[i].index = i; //index即为默认\n                // if(sheetIndex > this.sheetMaxIndex){\n                //     this.sheetMaxIndex = sheetIndex;\n                // }\n                $('#luckysheet-cell-main').append('<div ' + display + ' id=\"luckysheet-datavisual-selection-set-' + sheetIndex + '\" class=\"luckysheet-datavisual-selection-set\"></div>');\n            }\n            $('#luckysheet-sheet-container-c').append(btn.join(''));\n            _this.locationSheet();\n        },\n        locationSheet: function () {\n            let $c = $('#luckysheet-sheet-container-c'), winW = $('#' + Store.container).width();\n            let $cursheet = $('#luckysheet-sheet-container-c > div.luckysheet-sheets-item-active').eq(0);\n            let scrollLeftpx = 0;\n            let c_width = 0;\n            $('#luckysheet-sheet-container-c > div.luckysheet-sheets-item:visible').each(function () {\n                if ($(this).hasClass('luckysheet-sheets-item-active')) {\n                    scrollLeftpx = c_width;\n                }\n                c_width += $(this).outerWidth();\n            });\n            setTimeout(function () {\n                $c.scrollLeft(scrollLeftpx - 10);\n                if (c_width >= winW * 0.7) {\n                    if (luckysheetConfigsetting.showsheetbarConfig.sheet) {\n                        $('#luckysheet-sheet-area .luckysheet-sheets-scroll').css('display', 'inline-block');\n                        $('#luckysheet-sheet-container .docs-sheet-fade-left').show();\n                    }\n                }\n            }, 1);\n        },\n        copySheet: function (copyindex, e) {\n            if (isEditMode() || Store.allowEdit === false) {\n                // alert(\"非编辑模式下不允许该操作！\");\n                return;\n            }\n            let _this = this;\n            let order = Store.luckysheetfile.length;\n            let index = _this.generateRandomSheetIndex();\n            let copyarrindex = _this.getSheetIndex(copyindex);\n            let copyjson = $.extend(true, {}, Store.luckysheetfile[copyarrindex]);\n            copyjson.order = order;\n            copyjson.index = index;\n            copyjson.name = _this.generateCopySheetName(Store.luckysheetfile, copyjson.name);\n            let colorset = '';\n            if (copyjson.color != null) {\n                colorset = '<div class=\"luckysheet-sheets-item-color\" style=\" position: absolute; width: 100%; height: 3px; bottom: 0px; left: 0px; background-color: ' + copyjson.color + ';\"></div>';\n            }\n            let copyobject = $('#luckysheet-sheets-item' + copyindex);\n            $('#luckysheet-sheet-container-c').append(replaceHtml(sheetHTML, {\n                'index': copyjson.index,\n                'active': '',\n                'name': copyjson.name,\n                'order': copyjson.order,\n                'style': '',\n                'colorset': colorset\n            }));\n            $('#luckysheet-sheets-item' + copyjson.index).insertAfter(copyobject);\n            Store.luckysheetfile.splice(copyarrindex + 1, 0, copyjson);\n            $('#luckysheet-sheet-area div.luckysheet-sheets-item').removeClass('luckysheet-sheets-item-active');\n            $('#luckysheet-sheets-item' + index).addClass('luckysheet-sheets-item-active');\n            $('#luckysheet-cell-main').append('<div id=\"luckysheet-datavisual-selection-set-' + index + '\" class=\"luckysheet-datavisual-selection-set\"></div>');\n            cleargridelement(e);\n            server.saveParam('shc', index, {\n                'copyindex': copyindex,\n                'name': copyjson.name\n            });\n            _this.changeSheetExec(index);\n            _this.reOrderAllSheet();\n            if (Store.clearjfundo) {\n                Store.jfredo.push({\n                    'type': 'copySheet',\n                    'copyindex': copyindex,\n                    'index': copyjson.index,\n                    'sheetIndex': copyjson.index\n                });\n            } else if (Store.jfredo.length > 0) {\n                let jfredostr = Store.jfredo[Store.jfredo.length - 1];\n                if (jfredostr.type == 'copySheet') {\n                    jfredostr.index = copyjson.index;\n                    jfredostr.sheetIndex = copyjson.index;\n                }\n            }\n        },\n        hasSheet: function (index) {\n            if (index == null) {\n                return false;\n            }\n            index = this.getSheetIndex(index);\n            if (index == null) {\n                return false;\n            } else {\n                return true;\n            }\n        },\n        createSheetbydata: function (data, isrenew, isBefore = true) {\n            let _this = this;\n            let colorset = '';\n            if (data.color != null) {\n                colorset = '<div class=\"luckysheet-sheets-item-color\" style=\" position: absolute; width: 100%; height: 3px; bottom: 0px; left: 0px; background-color: ' + data.color + ';\"></div>';\n            }\n            $('#luckysheet-sheet-container-c').append(replaceHtml(sheetHTML, {\n                'index': data.index,\n                'active': '',\n                'name': data.name,\n                'order': data.order,\n                'style': '',\n                'colorset': colorset\n            }));\n            if (isBefore) {\n                let previndex = data.order;\n                if (previndex >= Store.luckysheetfile.length) {\n                    previndex = Store.luckysheetfile.length - 1;\n                    $('#luckysheet-sheets-item' + data.index).insertAfter($('#luckysheet-sheets-item' + Store.luckysheetfile[previndex].index));\n                } else {\n                    $('#luckysheet-sheets-item' + data.index).insertBefore($('#luckysheet-sheets-item' + Store.luckysheetfile[previndex].index));\n                }\n            }\n            Store.luckysheetfile.push(data);\n            $('#luckysheet-sheet-area div.luckysheet-sheets-item').removeClass('luckysheet-sheets-item-active');\n            $('#luckysheet-sheets-item' + data.index).addClass('luckysheet-sheets-item-active');\n            $('#luckysheet-cell-main').append('<div id=\"luckysheet-datavisual-selection-set-' + data.index + '\" class=\"luckysheet-datavisual-selection-set\"></div>');\n            cleargridelement();\n            if (isrenew != null) {\n                server.saveParam('shre', null, { 'reIndex': data.index });\n                data.hide = 0;\n                server.saveParam('sh', data.index, 0, {\n                    'op': 'show',\n                    'cur': null\n                });\n            } else {\n                server.saveParam('sha', null, data);\n            }\n            _this.changeSheetExec(data.index, data.isPivotTable, true);\n            _this.reOrderAllSheet();\n        },\n        deleteSheet: function (index) {\n            let _this = this;\n            if (Store.allowEdit === false) {\n                return;\n            }\n            let arrIndex = _this.getSheetIndex(index);\n            _this.setSheetHide(index);\n            $('#luckysheet-sheets-item' + index).remove();\n            $('#luckysheet-datavisual-selection-set-' + index).remove();\n            let removedsheet = Store.luckysheetfile.splice(arrIndex, 1);\n            _this.reOrderAllSheet();\n            server.saveParam('shd', null, { 'deleIndex': index });\n            if (Store.clearjfundo) {\n                removedsheet[0].type = 'deleteSheet';\n                Store.jfredo.push(removedsheet[0]);\n            }\n        },\n        nulldata: null,\n        getGridData: function (d) {\n            let ret = [];\n            for (let r = 0; r < d.length; r++) {\n                for (let c = 0; c < d[0].length; c++) {\n                    if (d[r][c] == null) {\n                        continue;\n                    }\n                    ret.push({\n                        r: r,\n                        c: c,\n                        v: d[r][c]\n                    });\n                }\n            }\n            return ret;\n        },\n        buildGridData: function (file) {\n            // 如果已经存在二维数据data,那么直接返回data；如果只有celldata，那么就转化成二维数组data，再返回\n            let row = file.row == null ? Store.defaultrowNum : file.row, column = file.column == null ? Store.defaultcolumnNum : file.column, data = file.data && file.data.length > 0 ? file.data : datagridgrowth([], row, column), celldata = file.celldata;\n            if (file.data && file.data.length > 0) {\n                for (let i = 0; i < data.length; i++) {\n                    for (let j = 0; j < data[0].length; j++) {\n                        setcellvalue(i, j, data, data[i][j]);\n                    }\n                }\n            } else {\n                if (celldata && celldata.length > 0) {\n                    for (let i = 0; i < celldata.length; i++) {\n                        let item = celldata[i];\n                        let r = item.r;\n                        let c = item.c;\n                        let v = item.v;\n                        if (r >= data.length) {\n                            data = datagridgrowth(data, r - data.length + 1, 0);\n                        }\n                        if (c >= data[0].length) {\n                            data = datagridgrowth(data, 0, c - data[0].length + 1);\n                        }\n                        setcellvalue(r, c, data, v);\n                    }\n                }\n            }    //亿万格式+精确度 恢复全局初始化\n            //亿万格式+精确度 恢复全局初始化\n            luckysheetConfigsetting.autoFormatw = false;\n            luckysheetConfigsetting.accuracy = undefined;\n            return data;\n        },\n        cutGridData: function (d) {\n            let rowindex = 0;\n            for (let r = d.length - 1; r >= 0; r--) {\n                let isnull = true;\n                for (let c = 0; c < d[0].length; c++) {\n                    let value = getcellvalue(r, c);\n                    if (value != null && $.trim(value).length > 0) {\n                        isnull = false;\n                        break;\n                    }\n                }\n                if (!isnull) {\n                    break;\n                } else {\n                    rowindex = r;\n                }\n            }\n            return d.slice(0, rowindex);\n        },\n        addGridData: function (celldata, row, column) {\n            let data = datagridgrowth([], row, column);\n            if (celldata != null) {\n                for (let i = 0; i < celldata.length; i++) {\n                    let item = celldata[i];\n                    let r = item.r;\n                    let c = item.c;\n                    let v = item.v;\n                    if (r >= data.length) {\n                        data = datagridgrowth(data, r - data.length + 1, 0);\n                    }\n                    if (c >= data[0].length) {\n                        data = datagridgrowth(data, 0, c - data[0].length + 1);\n                    }\n                    setcellvalue(r, c, data, v);\n                }\n            }\n            return data;\n        },\n        sheetParamRestore: function (file, data) {\n            Store.luckysheet_select_save = file['luckysheet_select_save'];\n            if (Store.luckysheet_select_save == null || Store.luckysheet_select_save.length == 0) {\n                if (data[0] != null && data[0][0] != null && data[0][0].mc != null) {\n                    Store.luckysheet_select_save = [{\n                            'row': [\n                                0,\n                                data[0][0].mc.rs - 1\n                            ],\n                            'column': [\n                                0,\n                                data[0][0].mc.cs - 1\n                            ]\n                        }];\n                } else {\n                    Store.luckysheet_select_save = [{\n                            'row': [\n                                0,\n                                0\n                            ],\n                            'column': [\n                                0,\n                                0\n                            ]\n                        }];\n                }\n            }\n            Store.luckysheet_selection_range = file['luckysheet_selection_range'] == null ? [] : file['luckysheet_selection_range'];\n            Store.config = file['config'] == null ? {} : file['config'];\n            Store.zoomRatio = file['zoomRatio'] == null ? 1 : file['zoomRatio'];\n            if (file['defaultRowHeight'] != null) {\n                Store.defaultrowlen = parseFloat(file['defaultRowHeight']);\n            } else {\n                Store.defaultrowlen = luckysheetConfigsetting['defaultRowHeight'];\n            }\n            if (file['defaultColWidth'] != null) {\n                Store.defaultcollen = parseFloat(file['defaultColWidth']);\n            } else {\n                Store.defaultcollen = luckysheetConfigsetting['defaultColWidth'];\n            }\n            if (file['showGridLines'] != null) {\n                let showGridLines = file['showGridLines'];\n                if (showGridLines == 0 || showGridLines == false) {\n                    Store.showGridLines = false;\n                } else {\n                    Store.showGridLines = true;\n                }\n            } else {\n                Store.showGridLines = true;\n            }\n        },\n        initialjfFile: function (menu, title) {\n            let _this = this;\n            _this.getCurSheet();\n            let file = Store.luckysheetfile[_this.getSheetIndex(Store.currentSheetIndex)];\n            _this.nulldata = datagridgrowth([], Store.defaultrowNum, Store.defaultcolumnNum);\n            let data = _this.buildGridData(file);    //初始化的时候 记录选区\n            //初始化的时候 记录选区\n            let select_save = [];\n            file.jfgird_select_save = file.jfgird_select_save || [];\n            file.jfgird_select_save.forEach(item => select_save.push({\n                'row': item.row,\n                'column': item.column\n            }));\n            file.luckysheet_select_save = select_save;\n            this.sheetParamRestore(file, data);\n            let r2 = Store.luckysheet_select_save[0].row[1], c2 = Store.luckysheet_select_save[0].column[1];\n            if (Store.luckysheet_select_save.length > 1) {\n                for (let i = 0; i < Store.luckysheet_select_save.length; i++) {\n                    if (Store.luckysheet_select_save[i].row[1] > r2) {\n                        r2 = Store.luckysheet_select_save[i].row[1];\n                    }\n                    if (Store.luckysheet_select_save[i].column[1] > c2) {\n                        c2 = Store.luckysheet_select_save[i].column[1];\n                    }\n                }\n            }\n            menuButton.fontInitial(Store.fontList);    //initial font\n            //initial font\n            file.data = data;\n            let rowheight = data.length;\n            if (r2 > rowheight - 1) {\n                rowheight = r2 + 1;\n            }\n            let colwidth = data[0].length;\n            if (c2 > colwidth - 1) {\n                colwidth = c2 + 1;\n            }    //钩子函数 表格创建之前触发\n            //钩子函数 表格创建之前触发\n            if (typeof luckysheetConfigsetting.beforeCreateDom == 'function') {\n                luckysheetConfigsetting.beforeCreateDom(luckysheet);\n            }\n            if (typeof luckysheetConfigsetting.workbookCreateBefore == 'function') {\n                luckysheetConfigsetting.workbookCreateBefore(luckysheet);\n            }    // Store.flowdata = data;\n            // Store.flowdata = data;\n            luckysheetcreatedom(colwidth, rowheight, data, menu, title);\n            setTimeout(function () {\n                tooltip.createHoverTip('#luckysheet_info_detail', '.luckysheet_info_detail_back, .luckysheet_info_detail_input, .luckysheet_info_detail_update');\n                tooltip.createHoverTip('#luckysheet-wa-editor', '.luckysheet-toolbar-menu-button, .luckysheet-toolbar-button, .luckysheet-toolbar-combo-button');\n                Store.luckysheetTableContentHW = [\n                    $('#luckysheet-cell-main').width() + Store.rowHeaderWidth - Store.cellMainSrollBarSize,\n                    $('#luckysheet-cell-main').height() + Store.columnHeaderHeight - Store.cellMainSrollBarSize\n                ];\n                $('#luckysheetTableContent, #luckysheetTableContentF').attr({\n                    width: Math.ceil(Store.luckysheetTableContentHW[0] * Store.devicePixelRatio),\n                    height: Math.ceil(Store.luckysheetTableContentHW[1] * Store.devicePixelRatio)\n                }).css({\n                    width: Store.luckysheetTableContentHW[0],\n                    height: Store.luckysheetTableContentHW[1]\n                }).get(0).getContext('2d');\n                let locale_info = locale().info;\n                let key = server.gridKey;\n                let cahce_key = key + '__qkcache';\n                let ini = function () {\n                    file['load'] = '1';\n                    _this.createSheet();\n                    let execF = function () {\n                        _this.mergeCalculation(file['index']);\n                        _this.setSheetParam(false);    // editor.webWorkerFlowDataCache(Store.flowdata);//worker存数据\n                        // editor.webWorkerFlowDataCache(Store.flowdata);//worker存数据\n                        _this.storeSheetParam();\n                        _this.restoreselect();\n                        _this.CacheNotLoadControll = [];\n                        _this.restoreCache();\n                        formula.execFunctionGroupForce(luckysheetConfigsetting.forceCalculation);\n                        _this.restoreSheetAll(Store.currentSheetIndex);    // luckysheetrefreshgrid(0, 0);\n                        // luckysheetrefreshgrid(0, 0);\n                        $('#luckysheet_info_detail_save').html(locale_info.detailSave);\n                        if (!!file.isPivotTable) {\n                            Store.luckysheetcurrentisPivotTable = true;    // pivotTable.changePivotTable(Store.currentSheetIndex); //此方法需要注释掉，在restoreSheetAll中已经执行了刷新了数据透视表，这里就不需要了\n                        } else\n                            // pivotTable.changePivotTable(Store.currentSheetIndex); //此方法需要注释掉，在restoreSheetAll中已经执行了刷新了数据透视表，这里就不需要了\n                            {\n                                Store.luckysheetcurrentisPivotTable = false;\n                                $('#luckysheet-modal-dialog-slider-pivot').hide();\n                            }    // Store toolbar button width value\n                        // Store toolbar button width value\n                        menuToolBarWidth();\n                        luckysheetsizeauto();    //等待滚动条dom宽高加载完成后 初始化滚动位置\n                        //等待滚动条dom宽高加载完成后 初始化滚动位置\n                        if (file['scrollLeft'] != null && file['scrollLeft'] > 0) {\n                            $('#luckysheet-scrollbar-x').scrollLeft(file['scrollLeft']);\n                        } else {\n                            $('#luckysheet-scrollbar-x').scrollLeft(0);\n                        }\n                        if (file['scrollTop'] != null && file['scrollTop'] > 0) {\n                            $('#luckysheet-scrollbar-y').scrollTop(file['scrollTop']);\n                        } else {\n                            $('#luckysheet-scrollbar-y').scrollTop(0);\n                        }    // 此处已经渲染完成表格，应该挪到前面\n                             // //钩子函数 表格创建之前触发\n                             // if(typeof luckysheetConfigsetting.beforeCreateDom == \"function\" ){\n                             //     luckysheetConfigsetting.beforeCreateDom(luckysheet);\n                             // }\n                             // if(typeof luckysheetConfigsetting.workbookCreateBefore == \"function\"){\n                             //     luckysheetConfigsetting.workbookCreateBefore(luckysheet);\n                             // }\n                        // 此处已经渲染完成表格，应该挪到前面\n                        // //钩子函数 表格创建之前触发\n                        // if(typeof luckysheetConfigsetting.beforeCreateDom == \"function\" ){\n                        //     luckysheetConfigsetting.beforeCreateDom(luckysheet);\n                        // }\n                        // if(typeof luckysheetConfigsetting.workbookCreateBefore == \"function\"){\n                        //     luckysheetConfigsetting.workbookCreateBefore(luckysheet);\n                        // }\n                        arrayRemoveItem(Store.asyncLoad, 'core');\n                        if (luckysheetConfigsetting.pointEdit) {\n                            setTimeout(function () {\n                                $('#luckysheetloadingdata').remove();\n                            }, 0);\n                        } else {\n                            setTimeout(function () {\n                                $('#luckysheetloadingdata').fadeOut().remove();\n                            }, 500);\n                        }\n                    };\n                    let loadSheetUrl = server.loadSheetUrl;\n                    if (loadSheetUrl == '') {\n                        //     execF();\n                        // }\n                        // else if(sheetindex.length>0 && loadSheetUrl == \"\"){\n                        // for(let i = 0;i<Store.luckysheetfile.length;i++){\n                        //     let otherfile = Store.luckysheetfile[i];\n                        //     if(otherfile.index == file.index){\n                        //         continue;\n                        //     }\n                        //     // let otherfile = Store.luckysheetfile[_this.getSheetIndex(item)]; \n                        //     if(otherfile[\"load\"] == null || otherfile[\"load\"] == \"0\"){\n                        //         otherfile[\"data\"] = _this.buildGridData(otherfile);\n                        //         otherfile[\"load\"] = \"1\";\n                        //     }\n                        // }\n                        _this.loadOtherFile(file);\n                        execF();\n                    } else {\n                        let sheetindexset = _this.checkLoadSheetIndex(file);\n                        let sheetindex = [];\n                        for (let i = 0; i < sheetindexset.length; i++) {\n                            let item = sheetindexset[i];\n                            if (item == file['index']) {\n                                continue;\n                            }\n                            sheetindex.push(item);\n                        }    // No request is sent if it is not linked to other worksheets\n                        // No request is sent if it is not linked to other worksheets\n                        if (sheetindex.length === 0) {\n                            execF();\n                            return;\n                        }\n                        $.post(loadSheetUrl, {\n                            'gridKey': server.gridKey,\n                            'index': sheetindex.join(',')\n                        }, function (d) {\n                            let dataset = new Function('return ' + d)();\n                            for (let item in dataset) {\n                                if (item == file['index']) {\n                                    continue;\n                                }\n                                let otherfile = Store.luckysheetfile[_this.getSheetIndex(item)];\n                                if (otherfile['load'] == null || otherfile['load'] == '0') {\n                                    otherfile.celldata = dataset[item.toString()];\n                                    otherfile['data'] = _this.buildGridData(otherfile);\n                                    otherfile['load'] = '1';\n                                }\n                            }\n                            execF();\n                        });\n                    }\n                };\n                try {\n                    localforage.getItem(cahce_key).then(function (readValue) {\n                        if (readValue != null) {\n                            _this.CacheNotLoadControll = readValue;\n                        }\n                        server.clearcachelocaldata(function () {\n                            ini();\n                        });\n                    });\n                } catch (e) {\n                    ini();\n                    console.log('缓存操作失败');\n                }\n            }, 1);\n        },\n        storeSheetParam: function () {\n            let index = this.getSheetIndex(Store.currentSheetIndex);\n            let file = Store.luckysheetfile[index];\n            file['config'] = Store.config;\n            file['visibledatarow'] = Store.visibledatarow;\n            file['visibledatacolumn'] = Store.visibledatacolumn;\n            file['ch_width'] = Store.ch_width;\n            file['rh_height'] = Store.rh_height;\n            file['luckysheet_select_save'] = $.extend(true, [], Store.luckysheet_select_save);\n            file['luckysheet_selection_range'] = $.extend(true, [], Store.luckysheet_selection_range);\n            if ($('#luckysheet-scrollbar-x')[0].scrollWidth > $('#luckysheet-scrollbar-x')[0].offsetWidth) {\n                file['scrollLeft'] = $('#luckysheet-scrollbar-x').scrollLeft();    //横向滚动条\n            }\n            //横向滚动条\n            if ($('#luckysheet-scrollbar-y')[0].scrollHeight > $('#luckysheet-scrollbar-y')[0].offsetHeight) {\n                file['scrollTop'] = $('#luckysheet-scrollbar-y').scrollTop();    //纵向滚动条\n            }\n            //纵向滚动条\n            file['zoomRatio'] = Store.zoomRatio;\n        },\n        setSheetParam: function (isload = true) {\n            let index = this.getSheetIndex(Store.currentSheetIndex);\n            let file = Store.luckysheetfile[index];\n            Store.flowdata = file['data'];\n            editor.webWorkerFlowDataCache(Store.flowdata);    //worker存数据\n                                                              // formula.execFunctionGroupData = null;\n            //worker存数据\n            // formula.execFunctionGroupData = null;\n            formula.execFunctionGlobalData = null;\n            window.luckysheet_getcelldata_cache = null;\n            this.sheetParamRestore(file, Store.flowdata);\n            if (file['freezen'] == null) {\n                luckysheetFreezen.freezenhorizontaldata = null;\n                luckysheetFreezen.freezenverticaldata = null;\n            } else {\n                luckysheetFreezen.freezenhorizontaldata = file['freezen'].horizontal == null ? null : file['freezen'].horizontal.freezenhorizontaldata;\n                luckysheetFreezen.freezenverticaldata = file['freezen'].vertical == null ? null : file['freezen'].vertical.freezenverticaldata;\n            }\n            if (isload) {\n                rhchInit(Store.flowdata.length, Store.flowdata[0].length);\n            }    //批注\n            //批注\n            luckysheetPostil.buildAllPs(Store.flowdata);    //图片\n            //图片\n            imageCtrl.currentImgId = null;\n            imageCtrl.images = file.images;\n            imageCtrl.allImagesShow();\n            imageCtrl.init();    //数据验证\n            //数据验证\n            dataVerificationCtrl.dataVerification = file.dataVerification;\n            dataVerificationCtrl.init();    //链接\n            //链接\n            hyperlinkCtrl.hyperlink = file.hyperlink;\n            hyperlinkCtrl.init();\n            createFilterOptions(file['filter_select'], file['filter']);\n        },\n        restoreselect: function () {\n            let index = this.getSheetIndex(Store.currentSheetIndex);\n            let file = Store.luckysheetfile[index];    //选区\n            //选区\n            selectHightlightShow(true);    //复制选区虚线框\n            //复制选区虚线框\n            selectionCopyShow();\n            if (file['scrollLeft'] != null && file['scrollLeft'] > 0) {\n                $('#luckysheet-scrollbar-x').scrollLeft(file['scrollLeft']);    //列标题\n            } else\n                //列标题\n                {\n                    $('#luckysheet-scrollbar-x').scrollLeft(0);\n                }\n            if (file['scrollTop'] != null && file['scrollTop'] > 0) {\n                $('#luckysheet-scrollbar-y').scrollTop(file['scrollTop']);    //列标题\n            } else\n                //列标题\n                {\n                    $('#luckysheet-scrollbar-y').scrollTop(0);\n                }\n        },\n        storeSheetParamALL: function () {\n            let _this = this;\n            _this.storeSheetParam();\n            let index = _this.getSheetIndex(Store.currentSheetIndex);\n            Store.luckysheetfile[index]['data'] = Store.flowdata;\n            Store.luckysheetfile[index]['config'] = $.extend(true, {}, Store.config);\n        },\n        mergeCalculationSheet: {},\n        mergeCalculation: function (index) {\n            let file = Store.luckysheetfile[this.getSheetIndex(index)];\n            let config = file.config, data = file.data;\n            if (config == null) {\n                return;\n            }\n            let mergeConfig = config.merge;\n            if (mergeConfig == null || index in this.mergeCalculationSheet || file['autoCalculationMerge'] === false) {\n                return;\n            }\n            this.mergeCalculationSheet[index] = 1;\n            for (let x in mergeConfig) {\n                let r = parseInt(x.substr(0, x.indexOf('_')));\n                let c = parseInt(x.substr(x.indexOf('_') + 1));\n                let mcInfo = mergeConfig[x];\n                if (data[r][c] == null) {\n                    data[r][c] = {};\n                }\n                data[r][c]['mc'] = {\n                    r: r,\n                    c: c,\n                    rs: mcInfo.rs,\n                    cs: mcInfo.cs\n                };\n                for (let ir = r; ir < r + mcInfo.rs; ir++) {\n                    for (let ic = c; ic < c + mcInfo.cs; ic++) {\n                        if (ir == r && ic == c) {\n                            continue;\n                        }\n                        if (data[ir][ic] == null) {\n                            data[ir][ic] = {};\n                        }\n                        data[ir][ic]['mc'] = {\n                            r: r,\n                            c: c\n                        };\n                    }\n                }\n            }\n        },\n        loadOtherFile: function (file) {\n            let _this = this;    // let sheetindexset = _this.checkLoadSheetIndex(file);\n                                 // let sheetindex = [];\n                                 // for(let i = 0; i < sheetindexset.length; i++){\n                                 //     let item = sheetindexset[i];\n                                 //     if(item == file[\"index\"]){\n                                 //         continue;\n                                 //     }\n                                 //     sheetindex.push(item);\n                                 // }\n                                 // for(let i = 0;i<sheetindex.length;i++){\n                                 //     let item = sheetindex[i];\n                                 //     let otherfile = Store.luckysheetfile[_this.getSheetIndex(item)]; \n                                 //     if(otherfile[\"load\"] == null || otherfile[\"load\"] == \"0\"){\n                                 //         otherfile[\"data\"] = _this.buildGridData(otherfile);\n                                 //         otherfile[\"load\"] = \"1\";\n                                 //     }\n                                 // }\n            // let sheetindexset = _this.checkLoadSheetIndex(file);\n            // let sheetindex = [];\n            // for(let i = 0; i < sheetindexset.length; i++){\n            //     let item = sheetindexset[i];\n            //     if(item == file[\"index\"]){\n            //         continue;\n            //     }\n            //     sheetindex.push(item);\n            // }\n            // for(let i = 0;i<sheetindex.length;i++){\n            //     let item = sheetindex[i];\n            //     let otherfile = Store.luckysheetfile[_this.getSheetIndex(item)]; \n            //     if(otherfile[\"load\"] == null || otherfile[\"load\"] == \"0\"){\n            //         otherfile[\"data\"] = _this.buildGridData(otherfile);\n            //         otherfile[\"load\"] = \"1\";\n            //     }\n            // }\n            for (let i = 0; i < Store.luckysheetfile.length; i++) {\n                let otherfile = Store.luckysheetfile[i];\n                if (otherfile.index == file.index) {\n                    continue;\n                }    // let otherfile = Store.luckysheetfile[_this.getSheetIndex(item)]; \n                // let otherfile = Store.luckysheetfile[_this.getSheetIndex(item)]; \n                if (otherfile['load'] == null || otherfile['load'] == '0') {\n                    otherfile['data'] = _this.buildGridData(otherfile);\n                    otherfile['load'] = '1';\n                }\n            }\n        },\n        changeSheet: function (index, isPivotInitial, isNewSheet) {\n            if (isEditMode()) {\n                // alert(\"非编辑模式下不允许该操作！\");\n                return;\n            }\n            let _this = this;\n            if (index == Store.currentSheetIndex) {\n                return;\n            }\n            if (server.allowUpdate) {\n                $('#luckysheet-cell-main #luckysheet-multipleRange-show').empty();\n                server.multipleIndex = 0;\n            }    // 钩子函数\n            // 钩子函数\n            method.createHookFunction('sheetActivate', index, isPivotInitial, isNewSheet);\n            $('#luckysheet-filter-selected-sheet' + Store.currentSheetIndex + ', #luckysheet-filter-options-sheet' + Store.currentSheetIndex).hide();\n            $('#luckysheet-filter-selected-sheet' + index + ', #luckysheet-filter-options-sheet' + index).show();\n            _this.storeSheetParamALL();\n            _this.setCurSheet(index);\n            let file = Store.luckysheetfile[_this.getSheetIndex(index)];\n            if (!!file.isPivotTable) {\n                Store.luckysheetcurrentisPivotTable = true;\n                if (!isPivotInitial) {\n                    pivotTable.changePivotTable(index);\n                }\n            } else {\n                Store.luckysheetcurrentisPivotTable = false;\n                $('#luckysheet-modal-dialog-slider-pivot').hide();\n                luckysheetsizeauto(false);\n            }\n            let load = file['load'];\n            if (load != null) {\n                let data = _this.buildGridData(file);\n                file.data = data;    // _this.loadOtherFile(file);\n                // _this.loadOtherFile(file);\n                _this.mergeCalculation(index);\n                _this.setSheetParam(true);\n                _this.showSheet();\n                setTimeout(function () {\n                    formula.execFunctionGroup();\n                    luckysheetrefreshgrid();\n                    server.saveParam('shs', null, Store.currentSheetIndex);\n                }, 1);\n            } else {\n                let loadSheetUrl = server.loadSheetUrl;\n                if (loadSheetUrl == '' || Store.luckysheetcurrentisPivotTable || !!isNewSheet) {\n                    let data = _this.buildGridData(file);\n                    file['data'] = data;\n                    file['load'] = '1';\n                    _this.loadOtherFile(file);    // let sheetindexset = _this.checkLoadSheetIndex(file);\n                                                  // let sheetindex = [];\n                                                  // for(let i = 0; i < sheetindexset.length; i++){\n                                                  //     let item = sheetindexset[i];\n                                                  //     if(item == file[\"index\"]){\n                                                  //         continue;\n                                                  //     }\n                                                  //     sheetindex.push(item);\n                                                  // }\n                                                  // for(let i = 0;i<sheetindex.length;i++){\n                                                  //     let item = sheetindex[i];\n                                                  //     let otherfile = Store.luckysheetfile[_this.getSheetIndex(item)]; \n                                                  //     if(otherfile[\"load\"] == null || otherfile[\"load\"] == \"0\"){\n                                                  //         otherfile[\"data\"] = _this.buildGridData(otherfile);\n                                                  //         otherfile[\"load\"] = \"1\";\n                                                  //     }\n                                                  // }\n                    // let sheetindexset = _this.checkLoadSheetIndex(file);\n                    // let sheetindex = [];\n                    // for(let i = 0; i < sheetindexset.length; i++){\n                    //     let item = sheetindexset[i];\n                    //     if(item == file[\"index\"]){\n                    //         continue;\n                    //     }\n                    //     sheetindex.push(item);\n                    // }\n                    // for(let i = 0;i<sheetindex.length;i++){\n                    //     let item = sheetindex[i];\n                    //     let otherfile = Store.luckysheetfile[_this.getSheetIndex(item)]; \n                    //     if(otherfile[\"load\"] == null || otherfile[\"load\"] == \"0\"){\n                    //         otherfile[\"data\"] = _this.buildGridData(otherfile);\n                    //         otherfile[\"load\"] = \"1\";\n                    //     }\n                    // }\n                    _this.mergeCalculation(index);\n                    _this.setSheetParam();\n                    _this.showSheet();\n                    setTimeout(function () {\n                        _this.restoreCache();\n                        formula.execFunctionGroupForce(luckysheetConfigsetting.forceCalculation);\n                        _this.restoreSheetAll(Store.currentSheetIndex);\n                        luckysheetrefreshgrid();\n                    }, 1);\n                    server.saveParam('shs', null, Store.currentSheetIndex);\n                } else {\n                    $('#luckysheet-grid-window-1').append(luckysheetlodingHTML());\n                    let sheetindex = _this.checkLoadSheetIndex(file);\n                    $.post(loadSheetUrl, {\n                        'gridKey': server.gridKey,\n                        'index': sheetindex.join(',')\n                    }, function (d) {\n                        let dataset = new Function('return ' + d)();\n                        file.celldata = dataset[index.toString()];\n                        let data = _this.buildGridData(file);\n                        setTimeout(function () {\n                            $('#luckysheetloadingdata').fadeOut().remove();\n                        }, 500);\n                        for (let item in dataset) {\n                            if (item == index) {\n                                continue;\n                            }\n                            let otherfile = Store.luckysheetfile[_this.getSheetIndex(item)];\n                            if (otherfile['load'] == null || otherfile['load'] == '0') {\n                                otherfile.celldata = dataset[item.toString()];\n                                otherfile['data'] = _this.buildGridData(otherfile);\n                                otherfile['load'] = '1';\n                            }\n                        }\n                        file['data'] = data;\n                        file['load'] = '1';\n                        _this.mergeCalculation(index);\n                        _this.setSheetParam();\n                        _this.showSheet();\n                        setTimeout(function () {\n                            _this.restoreCache();\n                            formula.execFunctionGroupForce(luckysheetConfigsetting.forceCalculation);\n                            _this.restoreSheetAll(Store.currentSheetIndex);\n                            luckysheetrefreshgrid();\n                        }, 1);\n                        server.saveParam('shs', null, Store.currentSheetIndex);\n                    });\n                }\n            }\n            $('#luckysheet-cell-main .luckysheet-datavisual-selection-set').hide();\n            $('#luckysheet-datavisual-selection-set-' + index).show();    //隐藏其他sheet的图表，显示当前sheet的图表 chartMix\n            //隐藏其他sheet的图表，显示当前sheet的图表 chartMix\n            renderChartShow(index);\n            luckysheetFreezen.initialFreezen(index);\n            _this.restoreselect();\n        },\n        checkLoadSheetIndexToDataIndex: {},\n        checkLoadSheetIndex: function (file) {\n            let calchain = formula.getAllFunctionGroup();    //file.calcChain; //index\n            //file.calcChain; //index\n            let chart = file.chart;    //dataSheetIndex\n            //dataSheetIndex\n            let pivotTable = file.pivotTable;    //pivotDataSheetIndex\n            //pivotDataSheetIndex\n            let ret = [], cache = {};\n            if (file.index in this.checkLoadSheetIndexToDataIndex) {\n                return [];\n            }\n            ret.push(file.index);\n            cache[file.index.toString()] = 1;\n            this.checkLoadSheetIndexToDataIndex[file.index] = 1;\n            if (calchain != null) {\n                let dataIndexList = {};\n                for (let i = 0; i < calchain.length; i++) {\n                    let f = calchain[i];\n                    let dataindex = f.index;\n                    let formulaTxt = getcellFormula(f.r, f.c, dataindex);\n                    if (formulaTxt == null) {\n                        let file = Store.luckysheetfile[this.getSheetIndex(dataindex)];\n                        file.data = this.buildGridData(file);\n                        formulaTxt = getcellFormula(f.r, f.c, dataindex);\n                        if (formulaTxt == null) {\n                            continue;\n                        }\n                    }\n                    if (formulaTxt.indexOf('!') == -1) {\n                        // dataIndexList[dataindex] = 1;\n                        formula.addToSheetIndexList(formulaTxt, dataindex);\n                    } else if (formula.formulaContainSheetList != null && formula.formulaContainSheetList[formulaTxt] != null) {\n                        for (let dataSheetIndex in formula.formulaContainSheetList[formulaTxt]) {\n                            dataIndexList[dataSheetIndex] = 1;\n                        }\n                    } else {\n                        formula.functionParser(formulaTxt, str => {\n                            formula.addToCellList(formulaTxt, str);\n                            if (str.indexOf('!') > -1) {\n                                let name = str.substr(0, str.indexOf('!'));    // dataNameList[name] = true;\n                                // dataNameList[name] = true;\n                                let sheet = this.getSheetByName(name);\n                                if (sheet != null) {\n                                    let dataSheetIndex = sheet.index;\n                                    dataIndexList[dataSheetIndex] = 1;\n                                    formula.addToSheetIndexList(formulaTxt, dataSheetIndex);\n                                }\n                            }\n                        });\n                        if (formula.formulaContainSheetList[formulaTxt] == null) {\n                            // dataIndexList[dataindex] = 1;\n                            formula.addToSheetIndexList(formulaTxt, dataindex);\n                        }\n                    }\n                    if (dataindex == null) {\n                        continue;\n                    }    // if(cache[dataindex.toString()] == null){\n                         // \t// ret.push(dataindex);\n                         //     cache[dataindex.toString()] = 1;\n                         //     this.checkLoadSheetIndexToDataIndex[dataindex] = 1;\n                         // }\n                }\n                // if(cache[dataindex.toString()] == null){\n                // \t// ret.push(dataindex);\n                //     cache[dataindex.toString()] = 1;\n                //     this.checkLoadSheetIndexToDataIndex[dataindex] = 1;\n                // }\n                for (let index in dataIndexList) {\n                    // let sheet = this.getSheetByName(n);\n                    // if(sheet==null){\n                    //     continue;\n                    // }\n                    // if(index == Store.currentSheetIndex){\n                    //     continue;\n                    // }\n                    let dataindex = index;\n                    if (cache[dataindex.toString()] == null) {\n                        ret.push(dataindex);\n                        cache[dataindex.toString()] = 1;\n                        this.checkLoadSheetIndexToDataIndex[dataindex] = 1;\n                    }\n                }\n            }\n            if (chart != null) {\n                for (let i = 0; i < chart.length; i++) {\n                    let cc = chart[i];\n                    let dataindex = cc.dataSheetIndex;\n                    if (dataindex == null) {\n                        continue;\n                    }\n                    if (cache[dataindex.toString()] == null) {\n                        ret.push(dataindex);\n                        cache[dataindex.toString()] = 1;\n                    }\n                }\n            }\n            if (pivotTable != null) {\n                let dataindex = pivotTable.pivotDataSheetIndex;\n                if (dataindex != null && cache[dataindex.toString()] == null) {\n                    ret.push(dataindex);\n                    cache[dataindex.toString()] = 1;\n                }\n            }\n            return ret;\n        },\n        showSheet: function () {\n            // changeSheetContainerSize();\n            $('#luckysheet-cell-flow_0').css({\n                'width': Store.ch_width,\n                'top': '-1px'\n            });    //width更新\n            //width更新\n            $('#luckysheet-sheettable_0').css({\n                'width': Store.ch_width - 1,\n                'height': Store.rh_height\n            });\n            $('#luckysheetrowHeader_0').css('height', Store.rh_height);\n            $('#luckysheet-cols-h-cells_0').css('width', Store.ch_width);    //width更新\n            //width更新\n            $('#luckysheet-scrollbar-x div').width(Store.ch_width);\n            $('#luckysheet-scrollbar-y div').height(Store.rh_height + Store.columnHeaderHeight - Store.cellMainSrollBarSize - 3);    //等待滚动条dom宽高计算完成后 初始化该表格滚动位置\n            //等待滚动条dom宽高计算完成后 初始化该表格滚动位置\n            let index = this.getSheetIndex(Store.currentSheetIndex);\n            let file = Store.luckysheetfile[index];\n            Store.scrollRefreshSwitch = false;\n            if (file['scrollLeft'] != null && file['scrollLeft'] > 0) {\n                $('#luckysheet-scrollbar-x').scrollLeft(file['scrollLeft'] * Store.zoomRatio);\n            } else {\n                $('#luckysheet-scrollbar-x').scrollLeft(0);\n            }\n            if (file['scrollTop'] != null && file['scrollTop'] > 0) {\n                $('#luckysheet-scrollbar-y').scrollTop(file['scrollTop'] * Store.zoomRatio);\n            } else {\n                $('#luckysheet-scrollbar-y').scrollTop(0);\n            }\n            setTimeout(() => {\n                Store.scrollRefreshSwitch = true;\n            }, 0);\n            zoomNumberDomBind(Store.zoomRatio);\n        },\n        setCurSheet: function (index) {\n            for (let i = 0; i < Store.luckysheetfile.length; i++) {\n                if (Store.luckysheetfile[i]['index'] == index) {\n                    Store.luckysheetfile[i].status = 1;\n                } else {\n                    Store.luckysheetfile[i].status = 0;\n                }\n            }\n            Store.currentSheetIndex = index;\n        },\n        getSheetIndex: function (index) {\n            for (let i = 0; i < Store.luckysheetfile.length; i++) {\n                if (Store.luckysheetfile[i]['index'] == index) {\n                    return i;\n                }\n            }\n            return null;\n        },\n        changeSheetExec: function (index, isPivotInitial, isNewSheet) {\n            let $sheet = $('#luckysheet-sheets-item' + index);\n            window.luckysheet_getcelldata_cache = null;\n            $('#luckysheet-sheet-area div.luckysheet-sheets-item').removeClass('luckysheet-sheets-item-active');\n            $sheet.addClass('luckysheet-sheets-item-active').show();\n            cleargridelement();\n            this.changeSheet(index, isPivotInitial, isNewSheet);\n            $('#luckysheet-sheet-list, #luckysheet-rightclick-sheet-menu').hide();\n            if (formula.rangestart) {\n                formula.createRangeHightlight();\n            }\n            this.sheetBarShowAndHide(index);\n        },\n        sheetArrowShowAndHide() {\n            let containerW = $('#luckysheet-sheet-container').width();\n            let c_width = 0;\n            $('#luckysheet-sheet-container-c > div.luckysheet-sheets-item:visible').each(function () {\n                c_width += $(this).outerWidth();\n            });\n            if (c_width >= containerW) {\n                if (luckysheetConfigsetting.showsheetbarConfig.sheet) {\n                    $('#luckysheet-sheet-area .luckysheet-sheets-scroll').css('display', 'inline-block');\n                    $('#luckysheet-sheet-container .docs-sheet-fade-left').show();\n                }\n            } else {\n                $('#luckysheet-sheet-area .luckysheet-sheets-scroll').css('display', 'none');\n                $('#luckysheet-sheet-container .docs-sheet-fade-left').hide();\n            }\n        },\n        sheetBarShowAndHide(index) {\n            let $c = $('#luckysheet-sheet-container-c');\n            if (index != null) {\n                let $sheet = $('#luckysheet-sheets-item' + index);\n                $c.scrollLeft($sheet.offset().left);\n            }\n            let c_width = $c.width(), c_srollwidth = $c[0].scrollWidth, scrollLeft = $c.scrollLeft();\n            if (scrollLeft <= 0) {\n                $('#luckysheet-sheet-container .docs-sheet-fade-left').hide();\n            } else {\n                $('#luckysheet-sheet-container .docs-sheet-fade-left').show();\n            }\n            if (c_width + scrollLeft >= c_srollwidth) {\n                $('#luckysheet-sheet-container .docs-sheet-fade-right').hide();\n            } else {\n                $('#luckysheet-sheet-container .docs-sheet-fade-right').show();\n            }\n        },\n        delChart: function (chart_id, sheetIndex) {\n            let index = this.getSheetIndex(sheetIndex);\n            let file = Store.luckysheetfile[index];\n            if (file.chart == null) {\n                file.chart = [];\n            } else {\n                for (let i = 0; i < file.chart.length; i++) {\n                    if (file.chart[i].chart_id == chart_id) {\n                        Store.luckysheetfile[index].chart.splice(i, 1);\n                        break;\n                    }\n                }\n            }\n        },\n        saveChart: function (json) {\n            //采用chartMix store存储，弃用Store.luckysheetfile存储，防止重复存储\n            let index = this.getSheetIndex(json.sheetIndex);\n            let file = Store.luckysheetfile[index];\n            if (file.chart == null) {\n                file.chart = [];\n                file.chart.push(json);\n            } else {\n                for (let i = 0; i < file.chart.length; i++) {\n                    if (file.chart[i].chart_id == json.chart_id) {\n                        let old = $.extend(true, {}, file.chart[i]);\n                        file.chart[i] = $.extend(true, {}, old, json);\n                        return;\n                    }\n                }\n                file.chart.push(json);\n            }\n        },\n        getChart: function (sheetIndex, chart_id) {\n            let index = this.getSheetIndex(sheetIndex);\n            let file = Store.luckysheetfile[index];\n            if (file.chart == null) {\n                return null;\n            } else {\n                for (let i = 0; i < file.chart.length; i++) {\n                    if (file.chart[i].chart_id == chart_id) {\n                        return file.chart[i];\n                    }\n                }\n                return null;\n            }\n        },\n        getRangetxt: function (sheetIndex, range, currentIndex) {\n            let sheettxt = '';\n            if (currentIndex == null) {\n                currentIndex = Store.currentSheetIndex;\n            }\n            if (sheetIndex != currentIndex) {\n                sheettxt = Store.luckysheetfile[this.getSheetIndex(sheetIndex)].name + '!';\n            }\n            let row0 = range['row'][0], row1 = range['row'][1];\n            let column0 = range['column'][0], column1 = range['column'][1];\n            if (row0 == null && row1 == null) {\n                return sheettxt + chatatABC(column0) + ':' + chatatABC(column1);\n            } else if (column0 == null && column1 == null) {\n                return sheettxt + (row0 + 1) + ':' + (row1 + 1);\n            } else {\n                if (column0 == column1 && row0 == row1) {\n                    return sheettxt + chatatABC(column0) + (row0 + 1);\n                } else {\n                    return sheettxt + chatatABC(column0) + (row0 + 1) + ':' + chatatABC(column1) + (row1 + 1);\n                }\n            }\n        },\n        getSheetName: function (sheetIndex) {\n            if (sheetIndex == null) {\n                sheetIndex = Store.currentSheetIndex;\n            }\n            return Store.luckysheetfile[this.getSheetIndex(sheetIndex)].name;\n        },\n        getSheetMerge: function () {\n            if (Store.config.merge == null) {\n                return null;\n            }\n            return Store.config.merge;\n        },\n        getSheetData: function (sheetIndex) {\n            if (sheetIndex == null) {\n                sheetIndex = Store.currentSheetIndex;\n            }\n            return Store.luckysheetfile[this.getSheetIndex(sheetIndex)].data;\n        },\n        getSheetConfig: function (sheetIndex) {\n            let _this = this;\n            if (sheetIndex == null) {\n                sheetIndex = Store.currentSheetIndex;\n            }\n            let config = Store.luckysheetfile[_this.getSheetIndex(sheetIndex)].config;\n            if (config == null) {\n                Store.luckysheetfile[_this.getSheetIndex(sheetIndex)].config = {};\n            }\n            return Store.luckysheetfile[_this.getSheetIndex(sheetIndex)].config;\n        },\n        restoreFilter: function (sheetIndex) {\n            let index = this.getSheetIndex(sheetIndex);\n            let file = Store.luckysheetfile[index];    // if($('#luckysheet-filter-selected-sheet' + sheetIndex).length > 0 || file.filter_select == null || JSON.stringify(file.filter_select) == \"{}\"){\n                                                       //     if(file.config != null && file.config.rowhidden != null){\n                                                       //         file.config.rowhidden =  {};\n                                                       //         Store.config = file.config;\n                                                       //         jfrefreshgrid_rhcw(Store.flowdata.length, Store.flowdata[0].length,false);\n                                                       //     }\n                                                       //     return;\n                                                       // }\n            // if($('#luckysheet-filter-selected-sheet' + sheetIndex).length > 0 || file.filter_select == null || JSON.stringify(file.filter_select) == \"{}\"){\n            //     if(file.config != null && file.config.rowhidden != null){\n            //         file.config.rowhidden =  {};\n            //         Store.config = file.config;\n            //         jfrefreshgrid_rhcw(Store.flowdata.length, Store.flowdata[0].length,false);\n            //     }\n            //     return;\n            // }\n            if (getObjType(file.filter_select) == 'string') {\n                file.filter_select = JSON.parse(file.filter_select);\n            }\n            if (file.filter_select == null || file.filter_select.row == null || file.filter_select.column == null) {\n                return;\n            }\n            createFilterOptions(file.filter_select);\n            if (getObjType(file.filter) != 'object') {\n                if (file.filter != null && getObjType(file.filter) == 'string') {\n                    file.filter = JSON.parse(file.filter);\n                }\n            }\n            let rowhidden = {};\n            if (file.config != null && file.config.rowhidden != null) {\n                rowhidden = file.config.rowhidden;\n            }\n            $('#luckysheet-filter-options-sheet' + sheetIndex + ' .luckysheet-filter-options').each(function (i) {\n                if (file.filter == null) {\n                    return false;\n                }\n                let $top = $(this);\n                let item = file.filter[i];\n                if (item == null) {\n                    return true;\n                }\n                if (getObjType(item) != 'object') {\n                    item = JSON.parse(item);\n                }\n                labelFilterOptionState($top, item.optionstate, item.rowhidden, item.caljs, false, item.st_r, item.ed_r, item.cindex, item.st_c, item.ed_c);\n                rowhidden = $.extend(true, rowhidden, item.rowhidden);\n            });\n            if (file.config == null) {\n                file.config = {};\n            }\n            file.config['rowhidden'] = rowhidden;\n            Store.config = file.config;\n            jfrefreshgrid_rhcw(Store.flowdata.length, Store.flowdata[0].length, false);\n        },\n        restorePivot: function (sheetIndex) {\n            let index = this.getSheetIndex(sheetIndex);\n            let file = Store.luckysheetfile[index];\n            if (!file.isPivotTable) {\n                return;\n            }\n            pivotTable.getCellData(sheetIndex);\n            pivotTable.initialPivotManage(true);\n            pivotTable.refreshPivotTable(false);\n        },\n        restoreSheetAll: function (sheetIndex) {\n            let _this = this;\n            _this.restorePivot(sheetIndex);\n            _this.restoreFilter(sheetIndex);\n            _this.restoreFreezen(sheetIndex);\n        },\n        restoreFreezen: function (sheetIndex) {\n            luckysheetFreezen.initialFreezen(sheetIndex);\n        },\n        restoreCache: function () {\n            let _this = this;\n            let data = _this.CacheNotLoadControll;\n            _this.CacheNotLoadControll = [];\n            if (data.length == 0) {\n                return;\n            }\n            for (let i = 0; i < data.length; i++) {\n                let item = data[i];\n                _this.execCache(item);\n            }\n        },\n        CacheNotLoadControll: [],\n        execCache: function (item) {\n            let _this = this;\n            let type = item.t;\n            let index = item.i;\n            let value = item.v;\n            let file = Store.luckysheetfile[_this.getSheetIndex(index)];\n            if (type == 'sha') {\n                Store.luckysheetfile.push(value);\n            } else if (type == 'shc') {\n                let copyjson = $.extend(true, {}, Store.luckysheetfile[_this.getSheetIndex(value.copyindex)]);\n                copyjson.index = index;\n                Store.luckysheetfile.push(copyjson);\n            } else if (type == 'shd') {\n                Store.luckysheetfile.splice(value.deleIndex, 1);\n            } else if (type == 'shr') {\n                for (let pos in value) {\n                    Store.luckysheetfile[_this.getSheetIndex(pos)].order = value[pos];\n                }\n            }\n            if ((file == null || file.load != '1') && !(type in {\n                    'sha': 0,\n                    'shc': 0,\n                    'shd': 0,\n                    'shr': 0\n                })) {\n                _this.CacheNotLoadControll.push(item);\n                return;\n            }\n            if (type == 'v') {\n                let r = item.r, c = item.c, v = item.v;\n                let data = _this.getSheetData(index);\n                file.data[r][c] = v;\n            } else if (type == 'fc') {\n                let op = item.op, pos = item.pos;\n                if (getObjType(value) != 'object') {\n                    value = new Function('return ' + value)();\n                }\n                let r = value.r, c = value.c;\n                if (op == 'del') {\n                    formula.delFunctionGroup(r, c, index);\n                } else {\n                    formula.insertUpdateFunctionGroup(r, c, index);\n                }\n            } else if (type == 'cg') {\n                let v = value, k = item.k;\n                let config1 = _this.getSheetConfig(index);\n                if (!(k in config1)) {\n                    config1[k] = {};\n                }\n                for (let key in v) {\n                    config1[k][key] = v[key];\n                }\n                Store.config = config1;\n            } else if (type == 'f') {\n                let v = value, op = item.op, pos = item.pos;\n                let filter = file.filter;\n                if (filter == null) {\n                    filter = {};\n                }\n                if (op == 'upOrAdd') {\n                    filter[pos] = v;\n                } else if (op == 'del') {\n                    delete filter[pos];\n                }\n            } else if (type == 'fsc') {\n                file.filter = null;\n                file.filter_select = null;\n            } else if (type == 'fsr') {\n                let v = value;\n                file.filter = v.filter;\n                file.filter_select = v.filter_select;\n            } else if (type == 'sh') {\n                let op = item.op, cur = item.cur, v = value;\n                if (op == 'hide') {\n                    file.status = 0;\n                    Store.luckysheetfile[_this.getSheetIndex(cur)].status = 1;\n                } else if (op == 'show') {\n                    for (let i = 0; i < Store.luckysheetfile.length; i++) {\n                        Store.luckysheetfile[i].status = 0;\n                    }\n                    file.status = 1;\n                }\n            } else if (type == 'all') {\n                let k = item.k, s = item.s;\n                if (s && getObjType(value) != 'object') {\n                    file[k] = JSON.stringify(value);\n                } else {\n                    file[k] = value;\n                }\n            } else if (type == 'c') {\n                let op = item.op, cid = item.cid;\n                if (op == 'add') {\n                    file.chart.push(value);\n                } else if (op == 'xy' || op == 'wh' || op == 'update') {\n                    for (let i = 0; i < file.chart.length; i++) {\n                        if (file.chart[i].chart_id == cid) {\n                            for (let item in file.chart[i]) {\n                                for (let vitem in value) {\n                                    if (item == vitem) {\n                                        file.chart[i][item] = value[vitem];\n                                    }\n                                }\n                            }\n                            return;\n                        }\n                    }\n                } else if (op == 'del') {\n                    for (let i = 0; i < file.chart.length; i++) {\n                        if (file.chart[i].chart_id == cid) {\n                            file.chart.splice(i, 1);\n                            return;\n                        }\n                    }\n                }\n            } else if (type == 'drc') {\n                let rc = item.rc, index = value.index, len = value.len;\n                let celldata = file.celldata;\n                if (rc == 'r') {\n                    for (let i = 0; celldata.length == 0; i++) {\n                        let cell = celldata[i];\n                        if (cell.r >= index && cell.r < index + len) {\n                            delete celldata[i];\n                        } else if (cell.r >= index + len) {\n                            cell.r -= len;\n                        }\n                    }\n                    file.row -= len;\n                } else {\n                    for (let i = 0; celldata.length == 0; i++) {\n                        let cell = celldata[i];\n                        if (cell.c >= index && cell.c < index + len) {\n                            delete celldata[i];\n                        } else if (cell.c >= index + len) {\n                            cell.c -= len;\n                        }\n                    }\n                    file.column -= len;\n                }\n                let ret = [];\n                for (let i = 0; i < celldata.length; i++) {\n                    if (celldata[i] != null) {\n                        ret.push(celldata[i]);\n                    }\n                }\n                file.celldata = ret;\n                let mtype, mst, med;\n                if (rc == 'r') {\n                    mtype = 'row';\n                } else {\n                    mtype = 'column';\n                }\n                mst = index;\n                med = index + len - 1;\n                luckysheetdeletetable(mtype, mst, med, true);\n            } else if (type == 'arc') {\n                let rc = item.rc, index = value.index, len = value.len;\n                let celldata = file.celldata;\n                if (rc == 'r') {\n                    for (let i = 0; i < celldata.length; i++) {\n                        let cell = celldata[i];\n                        if (cell.r > index) {\n                            cell.r += len;\n                        }\n                    }\n                    file.row += len;\n                } else {\n                    for (let i = 0; i < celldata.length; i++) {\n                        let cell = celldata[i];\n                        if (cell.c > index) {\n                            cell.c += len;\n                        }\n                    }\n                    file.column += len;\n                }\n                let mtype;\n                if (rc == 'r') {\n                    mtype = 'row';\n                } else {\n                    mtype = 'column';\n                }\n                luckysheetextendtable(mtype, index, len, true);\n            } else if (type == 'na') {\n                server.saveParam('na', null, value);\n            } else if (type == 'thumb') {\n                setTimeout(function () {\n                    _this.imageRequest();\n                }, 2000);\n            }\n        }\n    };\n    return sheetmanage;\n});"]}