{"version":3,"sources":["controllers/sheetmanage.js"],"names":["define","localforage","m_validate","cleargridelement","m_getdata","m_setdata","luckysheetcreatedom","tooltip","formula","rhchInit","sheets","m_extend","m_util","m_constant","server","luckysheetConfigsetting","pivotTable","luckysheetsizeauto","luckysheetPostil","imageCtrl","dataVerificationCtrl","hyperlinkCtrl","luckysheetFreezen","m_filter","m_select","Store","locale","m_plugin","m_resize","m_zoom","menuButton","isRealNum","isEditMode","getcellvalue","datagridgrowth","getcellFormula","setcellvalue","luckysheetextendtable","luckysheetdeletetable","replaceHtml","getObjType","chatatABC","arrayRemoveItem","sheetHTML","luckysheetlodingHTML","createFilterOptions","labelFilterOptionState","selectHightlightShow","selectionCopyShow","renderChartShow","changeSheetContainerSize","menuToolBarWidth","zoomNumberDomBind","sheetmanage","Object","assign","addNewSheet","e","isPivotTable","allowEdit","order","luckysheetfile","length","index","this","generateRandomSheetIndex","sheetname","generateRandomSheetName","$","append","active","name","style","colorset","sheetconfig","color","status","celldata","row","defaultrowNum","column","defaultcolumnNum","config","push","removeClass","addClass","saveParam","extend","clearjfundo","jfundo","redo","type","currentSheetIndex","jfredo","changeSheet","setSheetHide","currentIdx","getSheetIndex","hide","indicator","luckysheetcurrentSheetitem","showsheetbarConfig","sheet","nextAll","eq","data","prevAll","nextActiveIdx","showSheetIdxs","forEach","ele","len","find","op","cur","setSheetShow","sheetMaxIndex","ordersheet","property","a","b","getCurrentOrder","orders","each","i","toString","reOrderAllSheet","sort","x","y","order_x","order_y","createSheet","btn","display","sheetIndex","join","locationSheet","$c","winW","container","width","scrollLeftpx","c_width","hasClass","outerWidth","setTimeout","scrollLeft","css","show","copySheet","copyindex","copyarrindex","copyjson","generateCopySheetName","copyobject","insertAfter","splice","jfredostr","createSheetbydata","isrenew","isBefore","previndex","insertBefore","reIndex","deleteSheet","arrIndex","remove","removedsheet","deleIndex","nulldata","initialjfFile","menu","title","_this","getCurSheet","file","buildGridData","select_save","jfgird_select_save","item","luckysheet_select_save","sheetParamRestore","r2","c2","fontInitial","fontList","rowheight","colwidth","beforeCreateDom","luckysheet","workbookCreateBefore","createHoverTip","luckysheetTableContentHW","rowHeaderWidth","cellMainSrollBarSize","height","columnHeaderHeight","attr","Math","ceil","devicePixelRatio","get","getContext","locale_info","info","cahce_key","gridKey","ini","execF","mergeCalculation","setSheetParam","storeSheetParam","restoreselect","CacheNotLoadControll","restoreCache","execFunctionGroupForce","forceCalculation","restoreSheetAll","html","detailSave","luckysheetcurrentisPivotTable","scrollTop","asyncLoad","pointEdit","fadeOut","loadSheetUrl","loadOtherFile","sheetindexset","checkLoadSheetIndex","sheetindex","post","d","dataset","Function","otherfile","getItem","then","readValue","clearcachelocaldata","console","log","visibledatarow","visibledatacolumn","ch_width","rh_height","luckysheet_selection_range","scrollWidth","offsetWidth","scrollHeight","offsetHeight","zoomRatio","isload","flowdata","webWorkerFlowDataCache","execFunctionGlobalData","window","luckysheet_getcelldata_cache","freezenhorizontaldata","freezenverticaldata","horizontal","vertical","buildAllPs","currentImgId","images","allImagesShow","init","dataVerification","hyperlink","storeSheetParamALL","mergeCalculationSheet","mergeConfig","merge","r","parseInt","substr","indexOf","c","mcInfo","rs","cs","ir","ic","isPivotInitial","isNewSheet","allowUpdate","empty","multipleIndex","createHookFunction","setCurSheet","changePivotTable","showSheet","execFunctionGroup","refresh","initialFreezen","top","scrollRefreshSwitch","changeSheetExec","$sheet","rangestart","createRangeHightlight","sheetBarShowAndHide","[object Object]","containerW","offset","left","c_srollwidth","restoreFilter","filter_select","JSON","parse","filter","rowhidden","$top","optionstate","caljs","st_r","ed_r","cindex","st_c","ed_c","refreshGrid_rhcw","restorePivot","getCellData","initialPivotManage","refreshPivotTable","restoreFreezen","execCache","zoomChange","ratio","currentSheet","getSheetByIndex","sheetViewZoom","curentsheetView","k","onSheetChanging","bind","onActive","onInvalidate","sheetArrowShowAndHide","onZoomChange"],"mappings":"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","file":"../../controllers/sheetmanage.js","sourcesContent":["define([\n    'skylark-localForage',\n    '../methods/validate',\n    '../widgets/cleargridelement',\n    '../methods/getdata',\n    '../methods/setdata',\n    '../widgets/createdom',\n    '../widgets/tooltip',\n    './formula',\n    '../methods/rhchInit',\n    '../methods/sheets',\n    '../widgets/extend',\n    '../utils/util',\n    '../widgets/constant',\n    './server',\n    '../methods/luckysheetConfigsetting',\n    './pivotTable',\n    '../widgets/resize',\n    './postil',\n    '../widgets/imageCtrl',\n    '../widgets/dataVerificationCtrl',\n    '../widgets/hyperlinkCtrl',\n    './freezen',\n    './filter',\n    '../widgets/select',\n    '../store',\n    '../locale/locale',\n    '../expendPlugins/chart/plugin',\n    '../widgets/resize',\n    './zoom',\n    './menuButton'\n], function (localforage,m_validate, cleargridelement, m_getdata, m_setdata, luckysheetcreatedom, tooltip, formula,  rhchInit, sheets, m_extend, m_util, m_constant, server, luckysheetConfigsetting, pivotTable, luckysheetsizeauto, luckysheetPostil, imageCtrl, dataVerificationCtrl, hyperlinkCtrl, luckysheetFreezen, m_filter, m_select, Store, locale, m_plugin, m_resize, m_zoom, menuButton) {\n    'use strict';\n    const {isRealNum} = m_validate;\n    const isEditMode = luckysheetConfigsetting.isEditMode;\n    const {getcellvalue, datagridgrowth, getcellFormula} = m_getdata;\n    const {setcellvalue} = m_setdata;\n    const {luckysheetextendtable, luckysheetdeletetable} = m_extend;\n    const {replaceHtml, getObjType, chatatABC, arrayRemoveItem} = m_util;\n    const {sheetHTML, luckysheetlodingHTML} = m_constant;\n    const {createFilterOptions, labelFilterOptionState} = m_filter;\n    const {selectHightlightShow, selectionCopyShow} = m_select;\n    const {renderChartShow} = m_plugin;\n    const {changeSheetContainerSize, menuToolBarWidth} = m_resize;\n    const {zoomNumberDomBind} = m_zoom;\n    const sheetmanage = Object.assign(sheets, {\n\n        addNewSheet: function (e, isPivotTable) {\n            if (isEditMode() || Store.allowEdit === false) {\n                // alert(\"非编辑模式下不允许该操作！\");\n                return;\n            }\n            let _this = this;\n            let order = Store.luckysheetfile.length;\n            let index = _this.generateRandomSheetIndex();\n            let sheetname = _this.generateRandomSheetName(Store.luckysheetfile, isPivotTable);\n            $('#luckysheet-sheet-container-c').append(replaceHtml(sheetHTML, {\n                'index': index,\n                'active': '',\n                'name': sheetname,\n                'style': '',\n                'colorset': ''\n            }));\n            let sheetconfig = {\n                'name': sheetname,\n                'color': '',\n                'status': '0',\n                'order': order,\n                'index': index,\n                'celldata': [],\n                'row': Store.defaultrowNum,\n                'column': Store.defaultcolumnNum,\n                'config': {},\n                'pivotTable': null,\n                'isPivotTable': !!isPivotTable\n            };\n            Store.luckysheetfile.push(sheetconfig);\n            $('#luckysheet-sheet-area div.luckysheet-sheets-item').removeClass('luckysheet-sheets-item-active');\n            $('#luckysheet-sheets-item' + index).addClass('luckysheet-sheets-item-active');\n            $('#luckysheet-cell-main').append('<div id=\"luckysheet-datavisual-selection-set-' + index + '\" class=\"luckysheet-datavisual-selection-set\"></div>');\n            cleargridelement(e);\n            Store.saveParam('sha', null, $.extend(true, {}, sheetconfig));\n            if (Store.clearjfundo) {\n                Store.jfundo.length = 0;\n                let redo = {};\n                redo['type'] = 'addSheet';\n                redo['sheetconfig'] = $.extend(true, {}, sheetconfig);\n                redo['index'] = index;\n                redo['currentSheetIndex'] = Store.currentSheetIndex;\n                Store.jfredo.push(redo);\n            }\n            ///_this.changeSheetExec(index, isPivotTable, true);\n            Store.changeSheet(index, isPivotTable, true)\n        },\n        setSheetHide: function (index) {\n            let _this = this;\n            let currentIdx = _this.getSheetIndex(index);\n            Store.luckysheetfile[currentIdx].hide = 1;\n            let luckysheetcurrentSheetitem = $('#luckysheet-sheets-item' + index);\n            luckysheetcurrentSheetitem.hide();\n            $('#luckysheet-sheet-area div.luckysheet-sheets-item').removeClass('luckysheet-sheets-item-active');\n            let indicator;\n            if (luckysheetConfigsetting.showsheetbarConfig.sheet) {\n                indicator = luckysheetcurrentSheetitem.nextAll(':visible');\n                if (luckysheetcurrentSheetitem.nextAll(':visible').length > 0) {\n                    indicator = indicator.eq(0).data('index');\n                } else {\n                    indicator = luckysheetcurrentSheetitem.prevAll(':visible').eq(0).data('index');\n                }\n            } else {\n                let nextActiveIdx, showSheetIdxs = [];\n                Store.luckysheetfile.forEach((ele, index) => {\n                    if (1 !== ele.hide)\n                        showSheetIdxs.push(index);\n                });\n                let len = showSheetIdxs.length;\n                if (1 === len) {\n                    nextActiveIdx = showSheetIdxs[0];\n                } else {\n                    nextActiveIdx = showSheetIdxs[len - 1] > currentIdx ? showSheetIdxs.find(e => e > currentIdx) : showSheetIdxs[len - 1];\n                }\n                indicator = Store.luckysheetfile[nextActiveIdx].index;\n            }\n            $('#luckysheet-sheets-item' + indicator).addClass('luckysheet-sheets-item-active');\n            ///_this.changeSheetExec(indicator);\n            Store.changeSheet(indicator);\n            Store.saveParam('sh', luckysheetcurrentSheetitem.data('index'), 1, {\n                'op': 'hide',\n                'cur': indicator\n            });\n        },\n        setSheetShow: function (index) {\n            let _this = this;\n            Store.luckysheetfile[_this.getSheetIndex(index)].hide = 0;\n            ///_this.changeSheetExec(index);\n            Store.changeSheet(index);\n            Store.saveParam('sh', index, 0, {\n                'op': 'show',\n                'cur': null\n            });\n        },\n        sheetMaxIndex: 0,\n        ordersheet: function (property) {\n            return function (a, b) {\n                let value1 = a[property];\n                let value2 = b[property];\n                return value1 - value2;\n            };\n        },\n        getCurrentOrder: function () {\n            let orders = {};\n            $('#luckysheet-sheet-area div.luckysheet-sheets-item').each(function (a) {\n                let index = $(this).data('index');\n                for (let i = 0; i < Store.luckysheetfile.length; i++) {\n                    if (Store.luckysheetfile[i].index == index) {\n                        orders[index.toString()] = a;\n                        break;\n                    }\n                }\n            });\n            return orders;\n        },\n        reOrderAllSheet: function () {\n            let orders = {};\n            $('#luckysheet-sheet-area div.luckysheet-sheets-item').each(function (a) {\n                let index = $(this).data('index');\n                for (let i = 0; i < Store.luckysheetfile.length; i++) {\n                    if (Store.luckysheetfile[i].index == index) {\n                        Store.luckysheetfile[i].order = a;\n                        orders[index.toString()] = a;\n                        break;\n                    }\n                }\n            });\n            Store.saveParam('shr', null, orders);\n            Store.luckysheetfile.sort((x, y) => {\n                let order_x = x.order;\n                let order_y = y.order;\n                if (order_x != null && order_y != null) {\n                    return order_x - order_y;\n                } else if (order_x != null) {\n                    return -1;\n                } else if (order_y != null) {\n                    return 1;\n                } else {\n                    return 1;\n                }\n            });\n        },\n        createSheet: function () {\n            //修复拖动sheet更新后台后，重新打开显示错误\n            let _this = this;\n            let btn = [];\n            Store.luckysheetfile.sort(_this.ordersheet('order'));\n            for (let i = 0; i < Store.luckysheetfile.length; i++) {\n                let display = '';\n                let sheetIndex = Store.luckysheetfile[i].index;\n                let colorset = '';\n                if (Store.luckysheetfile[i].color != null) {\n                    colorset = '<div class=\"luckysheet-sheets-item-color\" style=\" position: absolute; width: 100%; height: 3px; bottom: 0px; left: 0px; background-color: ' + Store.luckysheetfile[i].color + ';\"></div>';\n                }\n                if (Store.currentSheetIndex == sheetIndex) {\n                    //使用Store.luckysheetfile中的index比较，而不是order\n                    btn.push(replaceHtml(sheetHTML, {\n                        'index': sheetIndex,\n                        'active': 'luckysheet-sheets-item-active',\n                        'name': Store.luckysheetfile[i].name,\n                        'style': '',\n                        'colorset': colorset\n                    }));\n                } else {\n                    if (Store.luckysheetfile[i].hide == 1) {\n                        btn.push(replaceHtml(sheetHTML, {\n                            'index': sheetIndex,\n                            'active': '',\n                            'name': Store.luckysheetfile[i].name,\n                            'style': 'display:none;',\n                            'colorset': colorset\n                        }));\n                    } else {\n                        btn.push(replaceHtml(sheetHTML, {\n                            'index': sheetIndex,\n                            'active': '',\n                            'name': Store.luckysheetfile[i].name,\n                            'style': '',\n                            'colorset': colorset\n                        }));\n                    }\n                    display = \"style='display:none;'\";\n                }    //Store.luckysheetfile[i].index = i; //index即为默认\n                     // if(sheetIndex > this.sheetMaxIndex){\n                     //     this.sheetMaxIndex = sheetIndex;\n                     // }\n                //Store.luckysheetfile[i].index = i; //index即为默认\n                // if(sheetIndex > this.sheetMaxIndex){\n                //     this.sheetMaxIndex = sheetIndex;\n                // }\n                $('#luckysheet-cell-main').append('<div ' + display + ' id=\"luckysheet-datavisual-selection-set-' + sheetIndex + '\" class=\"luckysheet-datavisual-selection-set\"></div>');\n            }\n            $('#luckysheet-sheet-container-c').append(btn.join(''));\n            _this.locationSheet();\n        },\n        locationSheet: function () {\n            let $c = $('#luckysheet-sheet-container-c'), winW = $('#' + Store.container).width();\n            let $cursheet = $('#luckysheet-sheet-container-c > div.luckysheet-sheets-item-active').eq(0);\n            let scrollLeftpx = 0;\n            let c_width = 0;\n            $('#luckysheet-sheet-container-c > div.luckysheet-sheets-item:visible').each(function () {\n                if ($(this).hasClass('luckysheet-sheets-item-active')) {\n                    scrollLeftpx = c_width;\n                }\n                c_width += $(this).outerWidth();\n            });\n            setTimeout(function () {\n                $c.scrollLeft(scrollLeftpx - 10);\n                if (c_width >= winW * 0.7) {\n                    if (luckysheetConfigsetting.showsheetbarConfig.sheet) {\n                        $('#luckysheet-sheet-area .luckysheet-sheets-scroll').css('display', 'inline-block');\n                        $('#luckysheet-sheet-container .docs-sheet-fade-left').show();\n                    }\n                }\n            }, 1);\n        },\n        copySheet: function (copyindex, e) {\n            if (isEditMode() || Store.allowEdit === false) {\n                // alert(\"非编辑模式下不允许该操作！\");\n                return;\n            }\n            let _this = this;\n            let order = Store.luckysheetfile.length;\n            let index = _this.generateRandomSheetIndex();\n            let copyarrindex = _this.getSheetIndex(copyindex);\n            let copyjson = $.extend(true, {}, Store.luckysheetfile[copyarrindex]);\n            copyjson.order = order;\n            copyjson.index = index;\n            copyjson.name = _this.generateCopySheetName(Store.luckysheetfile, copyjson.name);\n            let colorset = '';\n            if (copyjson.color != null) {\n                colorset = '<div class=\"luckysheet-sheets-item-color\" style=\" position: absolute; width: 100%; height: 3px; bottom: 0px; left: 0px; background-color: ' + copyjson.color + ';\"></div>';\n            }\n            let copyobject = $('#luckysheet-sheets-item' + copyindex);\n            $('#luckysheet-sheet-container-c').append(replaceHtml(sheetHTML, {\n                'index': copyjson.index,\n                'active': '',\n                'name': copyjson.name,\n                'order': copyjson.order,\n                'style': '',\n                'colorset': colorset\n            }));\n            $('#luckysheet-sheets-item' + copyjson.index).insertAfter(copyobject);\n            Store.luckysheetfile.splice(copyarrindex + 1, 0, copyjson);\n            $('#luckysheet-sheet-area div.luckysheet-sheets-item').removeClass('luckysheet-sheets-item-active');\n            $('#luckysheet-sheets-item' + index).addClass('luckysheet-sheets-item-active');\n            $('#luckysheet-cell-main').append('<div id=\"luckysheet-datavisual-selection-set-' + index + '\" class=\"luckysheet-datavisual-selection-set\"></div>');\n            cleargridelement(e);\n            Store.saveParam('shc', index, {\n                'copyindex': copyindex,\n                'name': copyjson.name\n            });\n            ///_this.changeSheetExec(index);\n            Store.changeSheet(index);\n            _this.reOrderAllSheet();\n            if (Store.clearjfundo) {\n                Store.jfredo.push({\n                    'type': 'copySheet',\n                    'copyindex': copyindex,\n                    'index': copyjson.index,\n                    'sheetIndex': copyjson.index\n                });\n            } else if (Store.jfredo.length > 0) {\n                let jfredostr = Store.jfredo[Store.jfredo.length - 1];\n                if (jfredostr.type == 'copySheet') {\n                    jfredostr.index = copyjson.index;\n                    jfredostr.sheetIndex = copyjson.index;\n                }\n            }\n        },\n        createSheetbydata: function (data, isrenew, isBefore = true) {\n            let _this = this;\n            let colorset = '';\n            if (data.color != null) {\n                colorset = '<div class=\"luckysheet-sheets-item-color\" style=\" position: absolute; width: 100%; height: 3px; bottom: 0px; left: 0px; background-color: ' + data.color + ';\"></div>';\n            }\n            $('#luckysheet-sheet-container-c').append(replaceHtml(sheetHTML, {\n                'index': data.index,\n                'active': '',\n                'name': data.name,\n                'order': data.order,\n                'style': '',\n                'colorset': colorset\n            }));\n            if (isBefore) {\n                let previndex = data.order;\n                if (previndex >= Store.luckysheetfile.length) {\n                    previndex = Store.luckysheetfile.length - 1;\n                    $('#luckysheet-sheets-item' + data.index).insertAfter($('#luckysheet-sheets-item' + Store.luckysheetfile[previndex].index));\n                } else {\n                    $('#luckysheet-sheets-item' + data.index).insertBefore($('#luckysheet-sheets-item' + Store.luckysheetfile[previndex].index));\n                }\n            }\n            Store.luckysheetfile.push(data);\n            $('#luckysheet-sheet-area div.luckysheet-sheets-item').removeClass('luckysheet-sheets-item-active');\n            $('#luckysheet-sheets-item' + data.index).addClass('luckysheet-sheets-item-active');\n            $('#luckysheet-cell-main').append('<div id=\"luckysheet-datavisual-selection-set-' + data.index + '\" class=\"luckysheet-datavisual-selection-set\"></div>');\n            cleargridelement();\n            if (isrenew != null) {\n                Store.saveParam('shre', null, { 'reIndex': data.index });\n                data.hide = 0;\n                Store.saveParam('sh', data.index, 0, {\n                    'op': 'show',\n                    'cur': null\n                });\n            } else {\n                Store.saveParam('sha', null, data);\n            }\n            ///_this.changeSheetExec(data.index, data.isPivotTable, true);\n            Store.changeSheet(data.index,data.isPivotTable,true);\n            _this.reOrderAllSheet();\n        },\n        deleteSheet: function (index) {\n            let _this = this;\n            if (Store.allowEdit === false) {\n                return;\n            }\n            let arrIndex = _this.getSheetIndex(index);\n            _this.setSheetHide(index);\n            $('#luckysheet-sheets-item' + index).remove();\n            $('#luckysheet-datavisual-selection-set-' + index).remove();\n            let removedsheet = Store.luckysheetfile.splice(arrIndex, 1);\n            _this.reOrderAllSheet();\n            Store.saveParam('shd', null, { 'deleIndex': index });\n            if (Store.clearjfundo) {\n                removedsheet[0].type = 'deleteSheet';\n                Store.jfredo.push(removedsheet[0]);\n            }\n        },\n        nulldata: null,\n\n        initialjfFile: function (menu, title) {\n            let _this = this;\n            _this.getCurSheet();\n            let file = Store.luckysheetfile[_this.getSheetIndex(Store.currentSheetIndex)];\n            _this.nulldata = datagridgrowth([], Store.defaultrowNum, Store.defaultcolumnNum);\n            let data = _this.buildGridData(file);    //初始化的时候 记录选区\n            //初始化的时候 记录选区\n            let select_save = [];\n            file.jfgird_select_save = file.jfgird_select_save || [];\n            file.jfgird_select_save.forEach(item => select_save.push({\n                'row': item.row,\n                'column': item.column\n            }));\n            file.luckysheet_select_save = select_save;\n            this.sheetParamRestore(file, data);\n            let r2 = Store.luckysheet_select_save[0].row[1], c2 = Store.luckysheet_select_save[0].column[1];\n            if (Store.luckysheet_select_save.length > 1) {\n                for (let i = 0; i < Store.luckysheet_select_save.length; i++) {\n                    if (Store.luckysheet_select_save[i].row[1] > r2) {\n                        r2 = Store.luckysheet_select_save[i].row[1];\n                    }\n                    if (Store.luckysheet_select_save[i].column[1] > c2) {\n                        c2 = Store.luckysheet_select_save[i].column[1];\n                    }\n                }\n            }\n            menuButton.fontInitial(Store.fontList);    //initial font\n            //initial font\n            file.data = data;\n            let rowheight = data.length;\n            if (r2 > rowheight - 1) {\n                rowheight = r2 + 1;\n            }\n            let colwidth = data[0].length;\n            if (c2 > colwidth - 1) {\n                colwidth = c2 + 1;\n            }    //钩子函数 表格创建之前触发\n            //钩子函数 表格创建之前触发\n            if (typeof luckysheetConfigsetting.beforeCreateDom == 'function') {\n                luckysheetConfigsetting.beforeCreateDom(luckysheet);\n            }\n            if (typeof luckysheetConfigsetting.workbookCreateBefore == 'function') {\n                luckysheetConfigsetting.workbookCreateBefore(luckysheet);\n            }    // Store.flowdata = data;\n            // Store.flowdata = data;\n            luckysheetcreatedom(colwidth, rowheight, data, menu, title);\n            setTimeout(function () {\n                tooltip.createHoverTip('#luckysheet_info_detail', '.luckysheet_info_detail_back, .luckysheet_info_detail_input, .luckysheet_info_detail_update');\n                tooltip.createHoverTip('#luckysheet-wa-editor', '.luckysheet-toolbar-menu-button, .luckysheet-toolbar-button, .luckysheet-toolbar-combo-button');\n                Store.luckysheetTableContentHW = [\n                    $('#luckysheet-cell-main').width() + Store.rowHeaderWidth - Store.cellMainSrollBarSize,\n                    $('#luckysheet-cell-main').height() + Store.columnHeaderHeight - Store.cellMainSrollBarSize\n                ];\n                $('#luckysheetTableContent, #luckysheetTableContentF').attr({\n                    width: Math.ceil(Store.luckysheetTableContentHW[0] * Store.devicePixelRatio),\n                    height: Math.ceil(Store.luckysheetTableContentHW[1] * Store.devicePixelRatio)\n                }).css({\n                    width: Store.luckysheetTableContentHW[0],\n                    height: Store.luckysheetTableContentHW[1]\n                }).get(0).getContext('2d');\n                let locale_info = locale().info;\n                let key = Store.gridKey;\n                let cahce_key = key + '__qkcache';\n                let ini = function () {\n                    file['load'] = '1';\n                    _this.createSheet();\n                    let execF = function () {\n                        _this.mergeCalculation(file['index']);\n                        _this.setSheetParam(false);    // editor.webWorkerFlowDataCache(Store.flowdata);//worker存数据\n                        // editor.webWorkerFlowDataCache(Store.flowdata);//worker存数据\n                        _this.storeSheetParam();\n                        _this.restoreselect();\n                        _this.CacheNotLoadControll = [];\n                        _this.restoreCache();\n                        formula.execFunctionGroupForce(luckysheetConfigsetting.forceCalculation);\n                        _this.restoreSheetAll(Store.currentSheetIndex);\n                        // luckysheetrefreshgrid(0, 0);\n                        $('#luckysheet_info_detail_save').html(locale_info.detailSave);\n                        if (!!file.isPivotTable) {\n                            Store.luckysheetcurrentisPivotTable = true;    // pivotTable.changePivotTable(Store.currentSheetIndex); //此方法需要注释掉，在restoreSheetAll中已经执行了刷新了数据透视表，这里就不需要了\n                        } else\n                            // pivotTable.changePivotTable(Store.currentSheetIndex); //此方法需要注释掉，在restoreSheetAll中已经执行了刷新了数据透视表，这里就不需要了\n                            {\n                                Store.luckysheetcurrentisPivotTable = false;\n                                $('#luckysheet-modal-dialog-slider-pivot').hide();\n                            }    // Store toolbar button width value\n                        // Store toolbar button width value\n                        menuToolBarWidth();\n                        luckysheetsizeauto();    //等待滚动条dom宽高加载完成后 初始化滚动位置\n                        //等待滚动条dom宽高加载完成后 初始化滚动位置\n                        if (file['scrollLeft'] != null && file['scrollLeft'] > 0) {\n                            $('#luckysheet-scrollbar-x').scrollLeft(file['scrollLeft']);\n                        } else {\n                            $('#luckysheet-scrollbar-x').scrollLeft(0);\n                        }\n                        if (file['scrollTop'] != null && file['scrollTop'] > 0) {\n                            $('#luckysheet-scrollbar-y').scrollTop(file['scrollTop']);\n                        } else {\n                            $('#luckysheet-scrollbar-y').scrollTop(0);\n                        }    // 此处已经渲染完成表格，应该挪到前面\n                             // //钩子函数 表格创建之前触发\n                             // if(typeof luckysheetConfigsetting.beforeCreateDom == \"function\" ){\n                             //     luckysheetConfigsetting.beforeCreateDom(luckysheet);\n                             // }\n                             // if(typeof luckysheetConfigsetting.workbookCreateBefore == \"function\"){\n                             //     luckysheetConfigsetting.workbookCreateBefore(luckysheet);\n                             // }\n                        // 此处已经渲染完成表格，应该挪到前面\n                        // //钩子函数 表格创建之前触发\n                        // if(typeof luckysheetConfigsetting.beforeCreateDom == \"function\" ){\n                        //     luckysheetConfigsetting.beforeCreateDom(luckysheet);\n                        // }\n                        // if(typeof luckysheetConfigsetting.workbookCreateBefore == \"function\"){\n                        //     luckysheetConfigsetting.workbookCreateBefore(luckysheet);\n                        // }\n                        arrayRemoveItem(Store.asyncLoad, 'core');\n                        if (luckysheetConfigsetting.pointEdit) {\n                            setTimeout(function () {\n                                $('#luckysheetloadingdata').remove();\n                            }, 0);\n                        } else {\n                            setTimeout(function () {\n                                $('#luckysheetloadingdata').fadeOut().remove();\n                            }, 500);\n                        }\n                    };\n                    let loadSheetUrl = Store.loadSheetUrl;\n                    if (loadSheetUrl == '') {\n                        //     execF();\n                        // }\n                        // else if(sheetindex.length>0 && loadSheetUrl == \"\"){\n                        // for(let i = 0;i<Store.luckysheetfile.length;i++){\n                        //     let otherfile = Store.luckysheetfile[i];\n                        //     if(otherfile.index == file.index){\n                        //         continue;\n                        //     }\n                        //     // let otherfile = Store.luckysheetfile[_this.getSheetIndex(item)]; \n                        //     if(otherfile[\"load\"] == null || otherfile[\"load\"] == \"0\"){\n                        //         otherfile[\"data\"] = _this.buildGridData(otherfile);\n                        //         otherfile[\"load\"] = \"1\";\n                        //     }\n                        // }\n                        _this.loadOtherFile(file);\n                        execF();\n                    } else {\n                        let sheetindexset = _this.checkLoadSheetIndex(file);\n                        let sheetindex = [];\n                        for (let i = 0; i < sheetindexset.length; i++) {\n                            let item = sheetindexset[i];\n                            if (item == file['index']) {\n                                continue;\n                            }\n                            sheetindex.push(item);\n                        }    // No request is sent if it is not linked to other worksheets\n                        // No request is sent if it is not linked to other worksheets\n                        if (sheetindex.length === 0) {\n                            execF();\n                            return;\n                        }\n                        $.post(loadSheetUrl, {\n                            'gridKey': Store.gridKey,\n                            'index': sheetindex.join(',')\n                        }, function (d) {\n                            let dataset = new Function('return ' + d)();\n                            for (let item in dataset) {\n                                if (item == file['index']) {\n                                    continue;\n                                }\n                                let otherfile = Store.luckysheetfile[_this.getSheetIndex(item)];\n                                if (otherfile['load'] == null || otherfile['load'] == '0') {\n                                    otherfile.celldata = dataset[item.toString()];\n                                    otherfile['data'] = _this.buildGridData(otherfile);\n                                    otherfile['load'] = '1';\n                                }\n                            }\n                            execF();\n                        });\n                    }\n                };\n                try {\n                    localforage.getItem(cahce_key).then(function (readValue) {\n                        if (readValue != null) {\n                            _this.CacheNotLoadControll = readValue;\n                        }\n                        server.clearcachelocaldata(function () {\n                            ini();\n                        });\n                    });\n                } catch (e) {\n                    ini();\n                    console.log('缓存操作失败');\n                }\n            }, 1);\n        },\n        storeSheetParam: function () {\n            let index = this.getSheetIndex(Store.currentSheetIndex);\n            let file = Store.luckysheetfile[index];\n            file['config'] = Store.config;\n            file['visibledatarow'] = Store.visibledatarow;\n            file['visibledatacolumn'] = Store.visibledatacolumn;\n            file['ch_width'] = Store.ch_width;\n            file['rh_height'] = Store.rh_height;\n            file['luckysheet_select_save'] = $.extend(true, [], Store.luckysheet_select_save);\n            file['luckysheet_selection_range'] = $.extend(true, [], Store.luckysheet_selection_range);\n            if ($('#luckysheet-scrollbar-x')[0].scrollWidth > $('#luckysheet-scrollbar-x')[0].offsetWidth) {\n                file['scrollLeft'] = $('#luckysheet-scrollbar-x').scrollLeft();    //横向滚动条\n            }\n            //横向滚动条\n            if ($('#luckysheet-scrollbar-y')[0].scrollHeight > $('#luckysheet-scrollbar-y')[0].offsetHeight) {\n                file['scrollTop'] = $('#luckysheet-scrollbar-y').scrollTop();    //纵向滚动条\n            }\n            //纵向滚动条\n            file['zoomRatio'] = Store.zoomRatio;\n        },\n        setSheetParam: function (isload = true) {\n            let index = this.getSheetIndex(Store.currentSheetIndex);\n            let file = Store.luckysheetfile[index];\n            Store.flowdata = file['data'];\n            Store.webWorkerFlowDataCache(Store.flowdata);    //worker存数据\n                                                              // formula.execFunctionGroupData = null;\n            //worker存数据\n            // formula.execFunctionGroupData = null;\n            formula.execFunctionGlobalData = null;\n            window.luckysheet_getcelldata_cache = null;\n            this.sheetParamRestore(file, Store.flowdata);\n            if (file['freezen'] == null) {\n                Store.freezenhorizontaldata = null;\n                Store.freezenverticaldata = null;\n            } else {\n                Store.freezenhorizontaldata = file['freezen'].horizontal == null ? null : file['freezen'].horizontal.freezenhorizontaldata;\n                Store.freezenverticaldata = file['freezen'].vertical == null ? null : file['freezen'].vertical.freezenverticaldata;\n            }\n            if (isload) {\n                rhchInit(Store.flowdata.length, Store.flowdata[0].length);\n            } \n            //批注\n            luckysheetPostil.buildAllPs(Store.flowdata); \n            //图片\n            imageCtrl.currentImgId = null;\n            imageCtrl.images = file.images;\n            imageCtrl.allImagesShow();\n            imageCtrl.init();    //数据验证\n            //数据验证\n            Store.dataVerification = file.dataVerification;\n            dataVerificationCtrl.init();    //链接\n            //链接\n            hyperlinkCtrl.hyperlink = file.hyperlink;\n            hyperlinkCtrl.init();\n            createFilterOptions(file['filter_select'], file['filter']);\n        },\n        restoreselect: function () {\n            let index = this.getSheetIndex(Store.currentSheetIndex);\n            let file = Store.luckysheetfile[index];    //选区\n            //选区\n            selectHightlightShow(true);    //复制选区虚线框\n            //复制选区虚线框\n            selectionCopyShow();\n            if (file['scrollLeft'] != null && file['scrollLeft'] > 0) {\n                $('#luckysheet-scrollbar-x').scrollLeft(file['scrollLeft']);    //列标题\n            } else\n                //列标题\n                {\n                    $('#luckysheet-scrollbar-x').scrollLeft(0);\n                }\n            if (file['scrollTop'] != null && file['scrollTop'] > 0) {\n                $('#luckysheet-scrollbar-y').scrollTop(file['scrollTop']);    //列标题\n            } else\n                //列标题\n                {\n                    $('#luckysheet-scrollbar-y').scrollTop(0);\n                }\n        },\n        storeSheetParamALL: function () {\n            let _this = this;\n            _this.storeSheetParam();\n            let index = _this.getSheetIndex(Store.currentSheetIndex);\n            Store.luckysheetfile[index]['data'] = Store.flowdata;\n            Store.luckysheetfile[index]['config'] = $.extend(true, {}, Store.config);\n        },\n        mergeCalculationSheet: {},\n        mergeCalculation: function (index) {\n            let file = Store.luckysheetfile[this.getSheetIndex(index)];\n            let config = file.config, data = file.data;\n            if (config == null) {\n                return;\n            }\n            let mergeConfig = config.merge;\n            if (mergeConfig == null || index in this.mergeCalculationSheet || file['autoCalculationMerge'] === false) {\n                return;\n            }\n            this.mergeCalculationSheet[index] = 1;\n            for (let x in mergeConfig) {\n                let r = parseInt(x.substr(0, x.indexOf('_')));\n                let c = parseInt(x.substr(x.indexOf('_') + 1));\n                let mcInfo = mergeConfig[x];\n                if (data[r][c] == null) {\n                    data[r][c] = {};\n                }\n                data[r][c]['mc'] = {\n                    r: r,\n                    c: c,\n                    rs: mcInfo.rs,\n                    cs: mcInfo.cs\n                };\n                for (let ir = r; ir < r + mcInfo.rs; ir++) {\n                    for (let ic = c; ic < c + mcInfo.cs; ic++) {\n                        if (ir == r && ic == c) {\n                            continue;\n                        }\n                        if (data[ir][ic] == null) {\n                            data[ir][ic] = {};\n                        }\n                        data[ir][ic]['mc'] = {\n                            r: r,\n                            c: c\n                        };\n                    }\n                }\n            }\n        },\n\n        changeSheet: function (index, isPivotInitial, isNewSheet) {\n            if (isEditMode()) {\n                // alert(\"非编辑模式下不允许该操作！\");\n                return;\n            }\n            let _this = this;\n            if (index == Store.currentSheetIndex) {\n                return;\n            }\n            if (Store.allowUpdate) {\n                $('#luckysheet-cell-main #luckysheet-multipleRange-show').empty();\n                server.multipleIndex = 0;\n            }    // 钩子函数\n            // 钩子函数\n            luckysheetConfigsetting.createHookFunction('sheetActivate', index, isPivotInitial, isNewSheet);\n            $('#luckysheet-filter-selected-sheet' + Store.currentSheetIndex + ', #luckysheet-filter-options-sheet' + Store.currentSheetIndex).hide();\n            $('#luckysheet-filter-selected-sheet' + index + ', #luckysheet-filter-options-sheet' + index).show();\n            _this.storeSheetParamALL();\n            _this.setCurSheet(index);\n            let file = Store.luckysheetfile[_this.getSheetIndex(index)];\n            if (!!file.isPivotTable) {\n                Store.luckysheetcurrentisPivotTable = true;\n                if (!isPivotInitial) {\n                    pivotTable.changePivotTable(index);\n                }\n            } else {\n                Store.luckysheetcurrentisPivotTable = false;\n                $('#luckysheet-modal-dialog-slider-pivot').hide();\n                luckysheetsizeauto(false);\n            }\n            let load = file['load'];\n            if (load != null) {\n                let data = _this.buildGridData(file);\n                file.data = data;    // _this.loadOtherFile(file);\n                // _this.loadOtherFile(file);\n                _this.mergeCalculation(index);\n                _this.setSheetParam(true);\n                _this.showSheet();\n                setTimeout(function () {\n                    formula.execFunctionGroup();\n                    ///luckysheetrefreshgrid();\n                    Store.refresh();\n                    Store.saveParam('shs', null, Store.currentSheetIndex);\n                }, 1);\n            } else {\n                let loadSheetUrl = Store.loadSheetUrl;\n                if (loadSheetUrl == '' || Store.luckysheetcurrentisPivotTable || !!isNewSheet) {\n                    let data = _this.buildGridData(file);\n                    file['data'] = data;\n                    file['load'] = '1';\n                    _this.loadOtherFile(file); \n                    // let sheetindexset = _this.checkLoadSheetIndex(file);\n                    // let sheetindex = [];\n                    // for(let i = 0; i < sheetindexset.length; i++){\n                    //     let item = sheetindexset[i];\n                    //     if(item == file[\"index\"]){\n                    //         continue;\n                    //     }\n                    //     sheetindex.push(item);\n                    // }\n                    // for(let i = 0;i<sheetindex.length;i++){\n                    //     let item = sheetindex[i];\n                    //     let otherfile = Store.luckysheetfile[_this.getSheetIndex(item)]; \n                    //     if(otherfile[\"load\"] == null || otherfile[\"load\"] == \"0\"){\n                    //         otherfile[\"data\"] = _this.buildGridData(otherfile);\n                    //         otherfile[\"load\"] = \"1\";\n                    //     }\n                    // }\n                    _this.mergeCalculation(index);\n                    _this.setSheetParam();\n                    _this.showSheet();\n                    setTimeout(function () {\n                        _this.restoreCache();\n                        formula.execFunctionGroupForce(luckysheetConfigsetting.forceCalculation);\n                        _this.restoreSheetAll(Store.currentSheetIndex);\n                        ///luckysheetrefreshgrid();\n                        Store.refresh();\n                    }, 1);\n                    Store.saveParam('shs', null, Store.currentSheetIndex);\n                } else {\n                    $('#luckysheet-grid-window-1').append(luckysheetlodingHTML());\n                    let sheetindex = _this.checkLoadSheetIndex(file);\n                    $.post(loadSheetUrl, {\n                        'gridKey': Store.gridKey,\n                        'index': sheetindex.join(',')\n                    }, function (d) {\n                        let dataset = new Function('return ' + d)();\n                        file.celldata = dataset[index.toString()];\n                        let data = _this.buildGridData(file);\n                        setTimeout(function () {\n                            $('#luckysheetloadingdata').fadeOut().remove();\n                        }, 500);\n                        for (let item in dataset) {\n                            if (item == index) {\n                                continue;\n                            }\n                            let otherfile = Store.luckysheetfile[_this.getSheetIndex(item)];\n                            if (otherfile['load'] == null || otherfile['load'] == '0') {\n                                otherfile.celldata = dataset[item.toString()];\n                                otherfile['data'] = _this.buildGridData(otherfile);\n                                otherfile['load'] = '1';\n                            }\n                        }\n                        file['data'] = data;\n                        file['load'] = '1';\n                        _this.mergeCalculation(index);\n                        _this.setSheetParam();\n                        _this.showSheet();\n                        setTimeout(function () {\n                            _this.restoreCache();\n                            formula.execFunctionGroupForce(luckysheetConfigsetting.forceCalculation);\n                            _this.restoreSheetAll(Store.currentSheetIndex);\n                            ///luckysheetrefreshgrid();\n                            Store.refresh();\n\n                        }, 1);\n                        Store.saveParam('shs', null, Store.currentSheetIndex);\n                    });\n                }\n            }\n            $('#luckysheet-cell-main .luckysheet-datavisual-selection-set').hide();\n            $('#luckysheet-datavisual-selection-set-' + index).show();    //隐藏其他sheet的图表，显示当前sheet的图表 chartMix\n            //隐藏其他sheet的图表，显示当前sheet的图表 chartMix\n            renderChartShow(index);\n            luckysheetFreezen.initialFreezen(index);\n            _this.restoreselect();\n        },\n\n        showSheet: function () {\n            // changeSheetContainerSize();\n            $('#luckysheet-cell-flow_0').css({\n                'width': Store.ch_width,\n                'top': '-1px'\n            });    //width更新\n            //width更新\n            $('#luckysheet-sheettable_0').css({\n                'width': Store.ch_width - 1,\n                'height': Store.rh_height\n            });\n            $('#luckysheetrowHeader_0').css('height', Store.rh_height);\n            $('#luckysheet-cols-h-cells_0').css('width', Store.ch_width);    //width更新\n            //width更新\n            $('#luckysheet-scrollbar-x div').width(Store.ch_width);\n            $('#luckysheet-scrollbar-y div').height(Store.rh_height + Store.columnHeaderHeight - Store.cellMainSrollBarSize - 3);    //等待滚动条dom宽高计算完成后 初始化该表格滚动位置\n            //等待滚动条dom宽高计算完成后 初始化该表格滚动位置\n            let index = this.getSheetIndex(Store.currentSheetIndex);\n            let file = Store.luckysheetfile[index];\n            Store.scrollRefreshSwitch = false;\n            if (file['scrollLeft'] != null && file['scrollLeft'] > 0) {\n                $('#luckysheet-scrollbar-x').scrollLeft(file['scrollLeft'] * Store.zoomRatio);\n            } else {\n                $('#luckysheet-scrollbar-x').scrollLeft(0);\n            }\n            if (file['scrollTop'] != null && file['scrollTop'] > 0) {\n                $('#luckysheet-scrollbar-y').scrollTop(file['scrollTop'] * Store.zoomRatio);\n            } else {\n                $('#luckysheet-scrollbar-y').scrollTop(0);\n            }\n            setTimeout(() => {\n                Store.scrollRefreshSwitch = true;\n            }, 0);\n            zoomNumberDomBind(Store.zoomRatio);\n        },\n\n        changeSheetExec: function (index, isPivotInitial, isNewSheet) {\n            let $sheet = $('#luckysheet-sheets-item' + index);\n            window.luckysheet_getcelldata_cache = null;\n            $('#luckysheet-sheet-area div.luckysheet-sheets-item').removeClass('luckysheet-sheets-item-active');\n            $sheet.addClass('luckysheet-sheets-item-active').show();\n            cleargridelement();\n            this.changeSheet(index, isPivotInitial, isNewSheet);\n            $('#luckysheet-sheet-list, #luckysheet-rightclick-sheet-menu').hide();\n            if (formula.rangestart) {\n                formula.createRangeHightlight();\n            }\n            this.sheetBarShowAndHide(index);\n        },\n        sheetArrowShowAndHide() {\n            let containerW = $('#luckysheet-sheet-container').width();\n            let c_width = 0;\n            $('#luckysheet-sheet-container-c > div.luckysheet-sheets-item:visible').each(function () {\n                c_width += $(this).outerWidth();\n            });\n            if (c_width >= containerW) {\n                if (luckysheetConfigsetting.showsheetbarConfig.sheet) {\n                    $('#luckysheet-sheet-area .luckysheet-sheets-scroll').css('display', 'inline-block');\n                    $('#luckysheet-sheet-container .docs-sheet-fade-left').show();\n                }\n            } else {\n                $('#luckysheet-sheet-area .luckysheet-sheets-scroll').css('display', 'none');\n                $('#luckysheet-sheet-container .docs-sheet-fade-left').hide();\n            }\n        },\n        sheetBarShowAndHide(index) {\n            let $c = $('#luckysheet-sheet-container-c');\n            if (index != null) {\n                let $sheet = $('#luckysheet-sheets-item' + index);\n                $c.scrollLeft($sheet.offset().left);\n            }\n            let c_width = $c.width(), c_srollwidth = $c[0].scrollWidth, scrollLeft = $c.scrollLeft();\n            if (scrollLeft <= 0) {\n                $('#luckysheet-sheet-container .docs-sheet-fade-left').hide();\n            } else {\n                $('#luckysheet-sheet-container .docs-sheet-fade-left').show();\n            }\n            if (c_width + scrollLeft >= c_srollwidth) {\n                $('#luckysheet-sheet-container .docs-sheet-fade-right').hide();\n            } else {\n                $('#luckysheet-sheet-container .docs-sheet-fade-right').show();\n            }\n        },\n\n        restoreFilter: function (sheetIndex) {\n            let index = this.getSheetIndex(sheetIndex);\n            let file = Store.luckysheetfile[index]; \n            // if($('#luckysheet-filter-selected-sheet' + sheetIndex).length > 0 || file.filter_select == null || JSON.stringify(file.filter_select) == \"{}\"){\n            //     if(file.config != null && file.config.rowhidden != null){\n            //         file.config.rowhidden =  {};\n            //         Store.config = file.config;\n            //         jfrefreshgrid_rhcw(Store.flowdata.length, Store.flowdata[0].length,false);\n            //     }\n            //     return;\n            // }\n            if (getObjType(file.filter_select) == 'string') {\n                file.filter_select = JSON.parse(file.filter_select);\n            }\n            if (file.filter_select == null || file.filter_select.row == null || file.filter_select.column == null) {\n                return;\n            }\n            createFilterOptions(file.filter_select);\n            if (getObjType(file.filter) != 'object') {\n                if (file.filter != null && getObjType(file.filter) == 'string') {\n                    file.filter = JSON.parse(file.filter);\n                }\n            }\n            let rowhidden = {};\n            if (file.config != null && file.config.rowhidden != null) {\n                rowhidden = file.config.rowhidden;\n            }\n            $('#luckysheet-filter-options-sheet' + sheetIndex + ' .luckysheet-filter-options').each(function (i) {\n                if (file.filter == null) {\n                    return false;\n                }\n                let $top = $(this);\n                let item = file.filter[i];\n                if (item == null) {\n                    return true;\n                }\n                if (getObjType(item) != 'object') {\n                    item = JSON.parse(item);\n                }\n                labelFilterOptionState($top, item.optionstate, item.rowhidden, item.caljs, false, item.st_r, item.ed_r, item.cindex, item.st_c, item.ed_c);\n                rowhidden = $.extend(true, rowhidden, item.rowhidden);\n            });\n            if (file.config == null) {\n                file.config = {};\n            }\n            file.config['rowhidden'] = rowhidden;\n            Store.config = file.config;\n            ///jfrefreshgrid_rhcw(Store.flowdata.length, Store.flowdata[0].length, false);\n            Store.refreshGrid_rhcw(Store.flowdata.length, Store.flowdata[0].length, false);\n        },\n        restorePivot: function (sheetIndex) {\n            let index = this.getSheetIndex(sheetIndex);\n            let file = Store.luckysheetfile[index];\n            if (!file.isPivotTable) {\n                return;\n            }\n            pivotTable.getCellData(sheetIndex);\n            pivotTable.initialPivotManage(true);\n            pivotTable.refreshPivotTable(false);\n        },\n        restoreSheetAll: function (sheetIndex) {\n            let _this = this;\n            _this.restorePivot(sheetIndex);\n            _this.restoreFilter(sheetIndex);\n            _this.restoreFreezen(sheetIndex);\n        },\n        restoreFreezen: function (sheetIndex) {\n            luckysheetFreezen.initialFreezen(sheetIndex);\n        },\n        restoreCache: function () {\n            let _this = this;\n            let data = _this.CacheNotLoadControll;\n            _this.CacheNotLoadControll = [];\n            if (data.length == 0) {\n                return;\n            }\n            for (let i = 0; i < data.length; i++) {\n                let item = data[i];\n                _this.execCache(item);\n            }\n        }\n    });\n\n\n    Store.onSheetChanging =  sheetmanage.changeSheetExec.bind(sheetmanage);\n\n    // from global/createsheet\n    Store.onActive = function() {\n        sheetmanage.showSheet();\n        setTimeout(function () {\n            sheetmanage.restoreCache();\n            formula.execFunctionGroup();\n            sheetmanage.restoreSheetAll(Store.currentSheetIndex);\n            ///luckysheetrefreshgrid();\n            Store.refresh();\n        }, 1);\n    };\n\n    Store.onInvalidate = function(){\n        sheetmanage.sheetArrowShowAndHide(); \n        sheetmanage.sheetBarShowAndHide(); \n    };\n\n    // from zoom.js\n    function zoomChange(ratio) {\n        let currentSheet = Store.getSheetByIndex(); \n        //批注\n        luckysheetPostil.buildAllPs(currentSheet.data); \n        //图片\n        imageCtrl.images = currentSheet.images;\n        imageCtrl.allImagesShow();\n        imageCtrl.init();\n        if (currentSheet.config == null) {\n            currentSheet.config = {};\n        }\n        if (currentSheet.config.sheetViewZoom == null) {\n            currentSheet.config.sheetViewZoom = {};\n        }\n        let type = currentSheet.config.curentsheetView;\n        if (type == null) {\n            type = 'viewNormal';\n        }\n        currentSheet.config.sheetViewZoom[type + 'ZoomScale'] = ratio;\n        Store.saveParam('all', Store.currentSheetIndex, Store.zoomRatio, { 'k': 'zoomRatio' });\n        Store.saveParam('cg', Store.currentSheetIndex, currentSheet.config['sheetViewZoom'], { 'k': 'sheetViewZoom' });\n        zoomRefreshView();\n    }\n    function zoomRefreshView() {\n        // let $scrollLeft = $(\"#luckysheet-scrollbar-x\"), $scrollTop = $(\"#luckysheet-scrollbar-y\");\n        // let sl = $scrollLeft.scrollLeft(), st = $scrollTop.scrollTop();\n        // let wp = $scrollLeft.find(\"div\").width(), hp = $scrollTop.find(\"div\").height();\n        ///jfrefreshgrid_rhcw(Store.flowdata.length, Store.flowdata[0].length);\n        Store.refreshGrid_rhcw(Store.flowdata.length, Store.flowdata[0].length);\n        changeSheetContainerSize();    \n    }\n    Store.onZoomChange = function(ratio){\n        zoomChange(ratio);\n\n    };\n\n    return sheetmanage;\n});"]}