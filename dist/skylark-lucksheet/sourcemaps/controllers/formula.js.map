{"version":3,"sources":["controllers/formula.js"],"names":["define","m_util","m_get","m_set","m_constant","luckysheetFreezen","m_protection","dataVerificationCtrl","m_select","m_validate","m_datecontroll","m_getRowlen","m_getdata","m_setdata","m_format","tooltip","m_location","m_cursorPos","luckysheetConfigsetting","formula_methods","m_func","Store","locale","json","cells","replaceHtml","getObjType","chatatABC","ABCatNum","luckysheetfontformat","getSheetIndex","getRangetxt","getluckysheetfile","setluckysheetfile","luckyColor","checkProtectionLocked","checkProtectionCellHidden","seletedHighlistByindex","luckysheet_count_show","isRealNum","isRealNull","valueIsError","isEditMode","isdatetime","isdatatype","getCellTextSplitArr","getCellTextInfo","getcellvalue","getcellFormula","getInlineStringNoStyle","getOrigincell","setcellvalue","genarate","valueShowEs","rowLocation","colLocation","colLocationByIndex","mouseposition","luckysheetRangeLast","setCaretPosition","convertSpanToShareString","isInlineStringCell","luckysheet_compareWith","luckysheet_getarraydata","luckysheet_getcelldata","luckysheet_parseData","luckysheet_getValue","luckysheet_indirect_check","luckysheet_indirect_check_return","luckysheet_offset_check","luckysheet_calcADPMM","luckysheet_getSpecialReference","Object","assign","oldvalue","dontupdate","_this","this","luckysheetCellUpdate","length","$","html","cancelNormalSelected","rangetosheet","currentSheetIndex","changeSheet","fucntionboxshow","r","c","d","flowdata","value","cell","extend","f","functionHTMLGenerate","rangeHightlightHTML","createRangeHightlight","$span","find","remove","each","rangeindex","attr","range","text","append","id","cellrange","getcellrange","rangeid","sheetIndex","data","css","background","end","row","column","show","searchHTML","helpHTML","getrangeseleciton","currSelection","window","getSelection","anchor","anchorNode","anchorOffset","parent","is","txt","trim","lasttxt","prev","ahr","substr","last","eq","searchFunctionPosition","$menu","$editor","x","y","isparam","winH","height","winW","width","menuW","outerWidth","menuH","outerHeight","left","top","get","reverse","searchFunctionCell","searchFunction","$editer","functionlist","$cell","inputContent","searchtxt","toUpperCase","test","result","s","t","result_i","i","item","n","unshift","indexOf","list","concat","listHTML","searchFunctionHTML","hide","$c","offset","searchFunctionEnter","$obj","functxt","after","next","helpFunctionExe","closest","on","removeClass","addClass","itemHTML","retHTML","class","a","functionlistPosition","helpFunction","funcname","paramIndex","$func","locale_formulaMore","formulaMore","fht","ahf","fhcp","p","paramitem","name","nameli","repeat","allowRepeatText","require","allowOptionText","example","param","content","detail","index","helpClose","helpCollapse","helpExample","helpAbstract","click","$content","slideToggle","rangeResizeTo","$prev","currentIndex","funcName","paramindex","$cur","exceptIndex","endstate","rangeHightlightselected","kcode","opacity","updatecell","isRefresh","$input","inputText","inputHtml","dataVerification","dvItem","prohibitInput","validateCellData","failureText","getFailureText","info","curv","oldValue","JSON","stringify","isPrevInline","isCurInline","slice","isCopyVal","splitArr","replace","split","join","v","m","ct","fa","createHookFunction","spl","qp","luckysheet_getcelldata_cache","isRunExecFunction","deepCopyFlowData","dynamicArrayItem","execfunction","undefined","type","curCalv","valueFunction","delFunctionGroup","execFunctionGroup","RowlChange","cfg","tb","defaultrowlen","canvas","getContext","cellWidth","textInfo","currentRowLen","textHeightAll","dynamicArray","insertUpdateDynamicArray","allParam","setTimeout","parse","refreshRange","execFunctionGlobalData","canceFunctionrangeSelected","removeAttr","rangestart","rangedrag_column_start","rangedrag_row_start","operator","operatorjson","functionCopy","mode","step","arr","op","toString","funcstack","str","function_str","matchConfig","bracket","comma","squote","dquote","s_next","s_pre","iscelldata","downparam","upparam","leftparam","rightparam","isfreezonFuc","col","row$","col$","ret","setfreezonFuceExe","rangetxt","parseInt","isNaN","setfreezonFuc","event","obj","pos","val","prefix","newtxt","newpos","rangetxtIndex","firsttxt","updateparam","orient","freezonFuc","$row","$col","error","freezonFuc0","freezonFuc1","$row0","$col0","$row1","$col1","functionStrChange","rc","stindex","functionStrChange_range","r1","r2","c1","c2","israngeseleciton","istooltip","rangeSetValueTo","rangechangeindex","func_selectedrange","rangeSetValue","selected","rf","cf","config","data_parm_index","txtdata","Array","txtArr","j","push","functionHtmlTxt","isVal","parmValArr","lvi","e","parmtxt","fp","functionParserExe","Function","functionHTMLIndex","insertAfter","rangedrag","mouse","pageX","pageY","scrollLeft","scrollTop","row_location","row_pre","row_index","col_location","col_pre","col_index","rowseleted","columnseleted","changeFreezenIndex","changeparam","mergeMoveMain","scrollFreezen","rangedrag_column","visibledatarow","rangedrag_row","visibledatacolumn","rangedragged","rangeResizeObj","rangeResize","rangeResizeIndex","rangeResizexy","rangeResizeWinH","rangeResizeWinW","rangeResizeDraging","luckysheetCurrentChartResizeObj","luckysheetCurrentChartResizeXy","luckysheetCurrentChartResize","luckysheetCurrentChartResizeWinW","luckysheetCurrentChartResizeWinH","ch_width","rh_height","topchange","leftchange","getSelectedFromRange","row_st","row_ed","col_st","col_ed","rangeResizeDragged","rangeMovexy","rangeMove","rangeMoveObj","rangeMoveIndex","rangeMoveRangedata","rangeMoveDraging","luckysheet_cell_selected_move_index","luckysheet_select_save","sheetBarHeight","statisticBarHeight","row_index_original","col_index_original","row_s","row_e","col_s","col_e","display","rangeMoveDragged","functionRangeIndex","findrangeindex","vp","re","v_a","vp_a","pop","pfri","vplen","vlen","start","search","textDom","children","functionRange","fri","selectAllChildren","collapseToEnd","document","selection","moveToElementText","collapse","select","functionInputHanddler","$to","$copy","value1","value1txt","editorlen","textRange","createRange","functionHTML","braces","regx","arraytxt","exec","arraystart","alltxt"],"mappings":"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","file":"../../controllers/formula.js","sourcesContent":["define([\n    '../utils/util',\n    '../methods/get',\n    '../methods/set',\n    '../widgets/constant',\n    '../methods/freezen_methods',\n    '../methods/protection_methods',\n    '../widgets/dataVerificationCtrl',\n    '../widgets/select',\n    '../methods/validate',\n    '../methods/datecontroll',\n    '../methods/getRowlen',\n    '../methods/getdata',\n    '../methods/setdata',\n    '../methods/format',\n    '../widgets/tooltip',\n    '../methods/location',\n    '../widgets/cursorPos',\n    '../methods/luckysheetConfigsetting',   \n    '../methods/formula_methods',    \n\n    '../function/func',\n    '../store',\n    '../locale/locale',\n    '../methods/json',\n    \"../methods/cells\"\n], function (m_util, m_get, m_set, m_constant, luckysheetFreezen, m_protection, dataVerificationCtrl, m_select, m_validate, m_datecontroll, m_getRowlen, m_getdata, m_setdata, m_format, tooltip, m_location, m_cursorPos, luckysheetConfigsetting,formula_methods, m_func, Store, locale, json,cells) {\n    'use strict';\n    const {replaceHtml, getObjType, chatatABC, ABCatNum, luckysheetfontformat} = m_util;\n    const {getSheetIndex, getRangetxt, getluckysheetfile} = m_get;\n    const {setluckysheetfile} = m_set;\n    const {luckyColor} = m_constant;\n    const {checkProtectionLocked, checkProtectionCellHidden} = m_protection;\n    const {seletedHighlistByindex, luckysheet_count_show} = m_select;\n    const {isRealNum, isRealNull, valueIsError} = m_validate;\n    const isEditMode = luckysheetConfigsetting.isEditMode;\n    const {isdatetime, isdatatype} = m_datecontroll;\n    const {getCellTextSplitArr, getCellTextInfo} = m_getRowlen;\n    const {getcellvalue, getcellFormula, getInlineStringNoStyle, getOrigincell} = m_getdata;\n    const {setcellvalue} = m_setdata;\n    const {genarate, valueShowEs} = m_format;\n    const {rowLocation, colLocation, colLocationByIndex, mouseposition} = m_location;\n    const {luckysheetRangeLast,setCaretPosition} = m_cursorPos;\n    const {convertSpanToShareString} = m_util;\n\n    const {isInlineStringCell} = cells;\n\n    const {luckysheet_compareWith, luckysheet_getarraydata, luckysheet_getcelldata, luckysheet_parseData, luckysheet_getValue, luckysheet_indirect_check, luckysheet_indirect_check_return, luckysheet_offset_check, luckysheet_calcADPMM, luckysheet_getSpecialReference} = m_func;\n    const luckysheetformula = Object.assign(formula_methods,{\n        oldvalue: null,\n        dontupdate: function () {\n            let _this = this;\n            Store.luckysheetCellUpdate.length = 0;    //clear array\n            //clear array\n            $('#luckysheet-functionbox-cell, #luckysheet-rich-text-editor').html(_this.oldvalue);\n            _this.cancelNormalSelected();\n            if (_this.rangetosheet != Store.currentSheetIndex) {\n                Store.changeSheet(_this.rangetosheet);\n            }\n        },\n        fucntionboxshow: function (r, c) {\n            if (!checkProtectionCellHidden(r, c, Store.currentSheetIndex)) {\n                $('#luckysheet-functionbox-cell').html('');\n                return;\n            }\n            let _this = this;\n            let d = Store.flowdata;\n            let value = '';    // && d[r][c].v != null\n            // && d[r][c].v != null\n            if (d[r] != null && d[r][c] != null) {\n                let cell = $.extend(true, {}, d[r][c]);\n                if (isInlineStringCell(cell)) {\n                    value = getInlineStringNoStyle(r, c);\n                } else if (cell.f != null) {\n                    value = _this.functionHTMLGenerate(getcellvalue(r, c, d, 'f'));\n                } else {\n                    value = valueShowEs(r, c, d);\n                }\n            }\n            _this.oldvalue = value;\n            $('#luckysheet-functionbox-cell').html(value);\n        },\n        rangeHightlightHTML: '<div id=\"luckysheet-formula-functionrange-highlight-${id}\" rangeindex=\"${id}\"  class=\"luckysheet-selection-highlight luckysheet-formula-functionrange-highlight\"><div data-type=\"top\" class=\"luckysheet-selection-copy-top luckysheet-copy\"></div><div data-type=\"right\" class=\"luckysheet-selection-copy-right luckysheet-copy\"></div><div data-type=\"bottom\" class=\"luckysheet-selection-copy-bottom luckysheet-copy\"></div><div data-type=\"left\" class=\"luckysheet-selection-copy-left luckysheet-copy\"></div><div class=\"luckysheet-selection-copy-hc\"></div><div data-type=\"lt\" class=\"luckysheet-selection-highlight-topleft luckysheet-highlight\"></div><div data-type=\"rt\" class=\"luckysheet-selection-highlight-topright luckysheet-highlight\"></div><div data-type=\"lb\" class=\"luckysheet-selection-highlight-bottomleft luckysheet-highlight\"></div><div data-type=\"rb\" class=\"luckysheet-selection-highlight-bottomright luckysheet-highlight\"></div></div>',\n        createRangeHightlight: function () {\n            let _this = this;\n            let $span = $('#luckysheet-rich-text-editor').find('span.luckysheet-formula-functionrange-cell');\n            $('#luckysheet-formula-functionrange .luckysheet-formula-functionrange-highlight').remove();\n            $span.each(function () {\n                let rangeindex = $(this).attr('rangeindex'), range = $(this).text();\n                $('#luckysheet-formula-functionrange').append(replaceHtml(_this.rangeHightlightHTML, { 'id': rangeindex }));\n                let cellrange = _this.getcellrange(range);\n                let rangeid = 'luckysheet-formula-functionrange-highlight-' + rangeindex;\n                if (cellrange == null) {\n                } else if (cellrange.sheetIndex == Store.currentSheetIndex || cellrange.sheetIndex == -1 && _this.rangetosheet == Store.currentSheetIndex) {\n                    $('#' + rangeid).data('range', cellrange).find('.luckysheet-copy').css({ 'background': luckyColor[rangeindex] }).end().find('.luckysheet-highlight').css({ 'background': luckyColor[rangeindex] }).end().find('.luckysheet-selection-copy-hc').css({ 'background': luckyColor[rangeindex] });\n                    seletedHighlistByindex(rangeid, cellrange.row[0], cellrange.row[1], cellrange.column[0], cellrange.column[1]);\n                }\n            });\n            $('#luckysheet-formula-functionrange .luckysheet-formula-functionrange-highlight').show();\n        },\n        searchHTML: '<div id=\"luckysheet-formula-search-c\" class=\"luckysheet-formula-search-c\"></div>',\n        helpHTML: '<div id=\"luckysheet-formula-help-c\" class=\"luckysheet-formula-help-c\"> <div class=\"luckysheet-formula-help-close\" title=\"${helpClose}\"><i class=\"fa fa-times\" aria-hidden=\"true\"></i></div> <div class=\"luckysheet-formula-help-collapse\" title=\"${helpCollapse}\"><i class=\"fa fa-angle-up\" aria-hidden=\"true\"></i></div> <div class=\"luckysheet-formula-help-title\"><div class=\"luckysheet-formula-help-title-formula\"> <span class=\"luckysheet-arguments-help-function-name\">SUM</span> <span class=\"luckysheet-arguments-paren\">(</span> <span class=\"luckysheet-arguments-parameter-holder\"> <span class=\"luckysheet-arguments-help-parameter luckysheet-arguments-help-parameter-active\" dir=\"auto\">A2:A100</span>, <span class=\"luckysheet-arguments-help-parameter\" dir=\"auto\">101</span> </span> <span class=\"luckysheet-arguments-paren\">)</span> </div></div> <div class=\"luckysheet-formula-help-content\"> <div class=\"luckysheet-formula-help-content-example\"> <div class=\"luckysheet-arguments-help-section-title\">${helpExample}</div> <div class=\"luckysheet-arguments-help-formula\"> <span class=\"luckysheet-arguments-help-function-name\">SUM</span> <span class=\"luckysheet-arguments-paren\">(</span> <span class=\"luckysheet-arguments-parameter-holder\"> <span class=\"luckysheet-arguments-help-parameter luckysheet-arguments-help-parameter-active\" dir=\"auto\">A2:A100</span>, <span class=\"luckysheet-arguments-help-parameter\" dir=\"auto\">101</span> </span> <span class=\"luckysheet-arguments-paren\">)</span> </div> </div> <div class=\"luckysheet-formula-help-content-detail\"> <div class=\"luckysheet-arguments-help-section\"> <div class=\"luckysheet-arguments-help-section-title luckysheet-arguments-help-parameter-name\">${helpAbstract}</div> <span class=\"luckysheet-arguments-help-parameter-content\">${helpAbstract}</span> </div> </div> <div class=\"luckysheet-formula-help-content-param\"> ${param} </div> </div> <div class=\"luckysheet-formula-help-foot\"></div></div>',\n        getrangeseleciton: function () {\n            let currSelection = window.getSelection();\n            let anchor = $(currSelection.anchorNode);\n            let anchorOffset = currSelection.anchorOffset;\n            if (anchor.parent().is('span') && anchorOffset != 0) {\n                let txt = $.trim(anchor.text()), lasttxt = '';\n                if (txt.length == 0 && anchor.parent().prev().length > 0) {\n                    let ahr = anchor.parent().prev();\n                    txt = $.trim(ahr.text());\n                    lasttxt = txt.substr(txt.length - 1, 1);\n                    return ahr;\n                } else {\n                    lasttxt = txt.substr(anchorOffset - 1, 1);\n                    return anchor.parent();\n                }\n            } else if (anchor.is('#luckysheet-rich-text-editor') || anchor.is('#luckysheet-functionbox-cell')) {\n                let txt = $.trim(anchor.find('span').last().text());\n                if (txt.length == 0 && anchor.find('span').length > 1) {\n                    let ahr = anchor.find('span');\n                    txt = $.trim(ahr.eq(ahr.length - 2).text());\n                    return ahr;\n                } else {\n                    return anchor.find('span').last();\n                }\n            } else if (anchor.parent().is('#luckysheet-rich-text-editor') || anchor.parent().is('#luckysheet-functionbox-cell') || anchorOffset == 0) {\n                if (anchorOffset == 0) {\n                    anchor = anchor.parent();\n                }\n                if (anchor.prev().length > 0) {\n                    let txt = $.trim(anchor.prev().text());\n                    let lasttxt = txt.substr(txt.length - 1, 1);\n                    return anchor.prev();\n                }\n            }\n            return null;\n        },\n        searchFunctionPosition: function ($menu, $editor, x, y, isparam) {\n            let winH = $(window).height(), winW = $(window).width();\n            let menuW = $menu.outerWidth(), menuH = $menu.outerHeight();\n            if (isparam == null) {\n                isparam = false;\n            }\n            let left = x;\n            if (x + menuW > winW) {\n                left = x - menuW + $editor.outerWidth();\n            } else {\n                left = x;\n            }\n            let top = y;\n            if (y + menuH > winH) {\n                top = y - menuH;\n            } else {\n                top = y + $editor.outerHeight();\n                if (!isparam) {\n                    $menu.html($menu.find('.luckysheet-formula-search-item').get().reverse());\n                }\n            }\n            if (top < 0) {\n                top = 0;\n            }\n            if (left < 0) {\n                left = 0;\n            }\n            $menu.css({\n                'top': top,\n                'left': left\n            }).show();\n        },\n        searchFunctionCell: null,\n        searchFunction: function ($editer) {\n            let _this = this;\n            let functionlist = Store.functionlist;\n            let $cell = _this.getrangeseleciton();\n            _this.searchFunctionCell = $cell;\n            if ($cell == null || $editer == null) {\n                return;\n            }\n            let inputContent = $editer.text();\n            let searchtxt = $cell.text().toUpperCase();\n            let reg = /^[a-zA-Z]|[a-zA-Z_]+$/;\n            if (!reg.test(searchtxt) || inputContent.substr(0, 1) != '=') {\n                return;\n            }\n            let result = {\n                    'f': [],\n                    's': [],\n                    't': []\n                }, result_i = 0;\n            for (let i = 0; i < functionlist.length; i++) {\n                let item = functionlist[i], n = item.n;\n                if (n == searchtxt) {\n                    result.f.unshift(item);\n                    result_i++;\n                } else if (n.substr(0, searchtxt.length) == searchtxt) {\n                    result.s.unshift(item);\n                    result_i++;\n                } else if (n.indexOf(searchtxt) > -1) {\n                    result.t.unshift(item);\n                    result_i++;\n                }\n                if (result_i >= 10) {\n                    break;\n                }\n            }\n            let list = result.t.concat(result.s.concat(result.f));\n            if (list.length <= 0) {\n                return;\n            }\n            let listHTML = _this.searchFunctionHTML(list);\n            $('#luckysheet-formula-search-c').html(listHTML).show();\n            $('#luckysheet-formula-help-c').hide();\n            let $c = $editer.parent(), offset = $c.offset();\n            _this.searchFunctionPosition($('#luckysheet-formula-search-c'), $c, offset.left, offset.top);\n        },\n        searchFunctionEnter: function ($obj) {\n            let _this = this;\n            let functxt = $obj.data('func');\n            _this.searchFunctionCell.text(functxt).after('<span dir=\"auto\" class=\"luckysheet-formula-text-color\">(</span>');\n            _this.setCaretPosition(_this.searchFunctionCell.next().get(0), 0, 1);\n            $('#luckysheet-formula-search-c').hide();\n            _this.helpFunctionExe(_this.searchFunctionCell.closest('div'), _this.searchFunctionCell.next());\n        },\n        searchFunctionHTML: function (list) {\n            let _this = this;\n            if ($('#luckysheet-formula-search-c').length == 0) {\n                $('body').append(_this.searchHTML);\n                $('#luckysheet-formula-search-c').on('mouseover', '.luckysheet-formula-search-item', function () {\n                    $('#luckysheet-formula-search-c').find('.luckysheet-formula-search-item').removeClass('luckysheet-formula-search-item-active');\n                    $(this).addClass('luckysheet-formula-search-item-active');\n                }).on('mouseout', '.luckysheet-formula-search-item', function () {\n                }).on('click', '.luckysheet-formula-search-item', function () {\n                    if (_this.searchFunctionCell == null) {\n                        return;\n                    }\n                    _this.searchFunctionEnter($(this));\n                });\n            }\n            let itemHTML = '<div data-func=\"${n}\" class=\"luckysheet-formula-search-item ${class}\"><div class=\"luckysheet-formula-search-func\">${n}</div><div class=\"luckysheet-formula-search-detail\">${a}</div></div>';\n            let retHTML = '';\n            for (let i = 0; i < list.length; i++) {\n                let item = list[i];\n                if (i == list.length - 1) {\n                    retHTML += replaceHtml(itemHTML, {\n                        'class': 'luckysheet-formula-search-item-active',\n                        'n': item.n,\n                        'a': item.a\n                    });\n                } else {\n                    retHTML += replaceHtml(itemHTML, {\n                        'class': '',\n                        'n': item.n,\n                        'a': item.a\n                    });\n                }\n            }\n            return retHTML;\n        },\n        functionlistPosition: {},\n        helpFunction: function ($editer, funcname, paramIndex) {\n            let _this = this;\n            let functionlist = Store.functionlist;\n            let $func = functionlist[_this.functionlistPosition[$.trim(funcname).toUpperCase()]];\n            if ($func == null) {\n                return;\n            }\n            let _locale = locale();\n            let locale_formulaMore = _locale.formulaMore;\n            $('#luckysheet-formula-help-c .luckysheet-arguments-help-function-name').html($func.n);\n            $('#luckysheet-formula-help-c .luckysheet-arguments-help-parameter-content').html($func.d);\n            let helpformula = '<span class=\"luckysheet-arguments-help-function-name\">${name}</span> <span class=\"luckysheet-arguments-paren\">(</span> <span class=\"luckysheet-arguments-parameter-holder\"> ${param} </span> <span class=\"luckysheet-arguments-paren\">)</span>';\n            let helpformulaItem = '<span class=\"luckysheet-arguments-help-parameter\" dir=\"auto\">${param}</span>';\n            let helpformulaArg = '<div class=\"luckysheet-arguments-help-section\"><div class=\"luckysheet-arguments-help-section-title\">${param}</div><span class=\"luckysheet-arguments-help-parameter-content\">${content}</span></div>';    //\"n\": \"AVERAGE\",\n                                                                                                                                                                                                                                           //\"t\": \"1\",\n                                                                                                                                                                                                                                           //\"d\": \"返回数据集的算术平均值，对文本忽略不计。\",\n                                                                                                                                                                                                                                           //\"a\": \"返回数据集的算术平均值\",\n                                                                                                                                                                                                                                           //\"p\": [{ \"name\": \"数值1\", \"example\": \"A2:A100\", \"detail\": \"计算平均值时用到的第一个数值或范围。\", \"require\": \"m\", \"repeat\": \"n\", \"type\": \"rangenumber\" },\n                                                                                                                                                                                                                                           //    { \"name\": \"数值2\", \"example\": \"B2:B100\", \"detail\": \"计算平均值时用到的其他数值或范围。\", \"require\": \"o\", \"repeat\": \"y\", \"type\": \"rangenumber\" }\n                                                                                                                                                                                                                                           //]\n            //\"n\": \"AVERAGE\",\n            //\"t\": \"1\",\n            //\"d\": \"返回数据集的算术平均值，对文本忽略不计。\",\n            //\"a\": \"返回数据集的算术平均值\",\n            //\"p\": [{ \"name\": \"数值1\", \"example\": \"A2:A100\", \"detail\": \"计算平均值时用到的第一个数值或范围。\", \"require\": \"m\", \"repeat\": \"n\", \"type\": \"rangenumber\" },\n            //    { \"name\": \"数值2\", \"example\": \"B2:B100\", \"detail\": \"计算平均值时用到的其他数值或范围。\", \"require\": \"o\", \"repeat\": \"y\", \"type\": \"rangenumber\" }\n            //]\n            let fht = '', ahf = '', fhcp = '';\n            for (let i = 0; i < $func.p.length; i++) {\n                let paramitem = $func.p[i];\n                let name = paramitem.name, nameli = paramitem.name;\n                if (paramitem.repeat == 'y') {\n                    name += ', ...';\n                    nameli += '<span class=\"luckysheet-arguments-help-argument-info\">...-' + locale_formulaMore.allowRepeatText + '</span>';\n                }\n                if (paramitem.require == 'o') {\n                    name = '[' + name + ']';\n                    nameli += '<span class=\"luckysheet-arguments-help-argument-info\">-[' + locale_formulaMore.allowOptionText + ']</span>';\n                }\n                fht += '<span class=\"luckysheet-arguments-help-parameter\" dir=\"auto\">' + name + '</span>, ';\n                ahf += '<span class=\"luckysheet-arguments-help-parameter\" dir=\"auto\">' + paramitem.example + '</span>, ';\n                fhcp += replaceHtml(helpformulaArg, {\n                    'param': nameli,\n                    'content': paramitem.detail\n                });\n            }\n            fht = fht.substr(0, fht.length - 2);\n            ahf = ahf.substr(0, ahf.length - 2);\n            $('#luckysheet-formula-help-c .luckysheet-formula-help-title .luckysheet-arguments-parameter-holder').html(fht);    //介绍\n            //介绍\n            $('#luckysheet-formula-help-c .luckysheet-arguments-help-formula .luckysheet-arguments-parameter-holder').html(ahf);    //示例\n            //示例\n            $('#luckysheet-formula-help-c .luckysheet-formula-help-content-param').html(fhcp);    //参数\n            //参数\n            if (paramIndex == null) {\n                $('#luckysheet-formula-help-c .luckysheet-formula-help-title-formula .luckysheet-arguments-help-function-name').css('font-weight', 'bold');\n            } else {\n                $('#luckysheet-formula-help-c .luckysheet-formula-help-title-formula .luckysheet-arguments-help-function-name').css('font-weight', 'normal');\n                let index = paramIndex >= $func.p.length ? $func.p.length - 1 : paramIndex;\n                $('#luckysheet-formula-help-c .luckysheet-formula-help-title .luckysheet-arguments-parameter-holder .luckysheet-arguments-help-parameter').removeClass('luckysheet-arguments-help-parameter-active');\n                $('#luckysheet-formula-help-c .luckysheet-formula-help-title .luckysheet-arguments-parameter-holder .luckysheet-arguments-help-parameter').eq(index).addClass('luckysheet-arguments-help-parameter-active');\n                $('#luckysheet-formula-help-c .luckysheet-arguments-help-formula .luckysheet-arguments-parameter-holder .luckysheet-arguments-help-parameter').removeClass('luckysheet-arguments-help-parameter-active');\n                $('#luckysheet-formula-help-c .luckysheet-arguments-help-formula .luckysheet-arguments-parameter-holder .luckysheet-arguments-help-parameter').eq(index).addClass('luckysheet-arguments-help-parameter-active');\n                $('#luckysheet-formula-help-c .luckysheet-formula-help-content-param .luckysheet-arguments-help-section').removeClass('luckysheet-arguments-help-parameter-active');\n                $('#luckysheet-formula-help-c .luckysheet-formula-help-content-param .luckysheet-arguments-help-section').eq(index).addClass('luckysheet-arguments-help-parameter-active');\n            }\n            let $c = $editer.parent(), offset = $c.offset();\n            _this.searchFunctionPosition($('#luckysheet-formula-help-c'), $c, offset.left, offset.top, true);\n        },\n        helpFunctionExe: function ($editer, currSelection) {\n            let _this = this;\n            let functionlist = Store.functionlist;\n            let _locale = locale();\n            let locale_formulaMore = _locale.formulaMore;\n            if ($('#luckysheet-formula-help-c').length == 0) {\n                $('body').after(replaceHtml(_this.helpHTML, {\n                    helpClose: locale_formulaMore.helpClose,\n                    helpCollapse: locale_formulaMore.helpCollapse,\n                    helpExample: locale_formulaMore.helpExample,\n                    helpAbstract: locale_formulaMore.helpAbstract\n                }));\n                $('#luckysheet-formula-help-c .luckysheet-formula-help-close').click(function () {\n                    $('#luckysheet-formula-help-c').hide();\n                });\n                $('#luckysheet-formula-help-c .luckysheet-formula-help-collapse').click(function () {\n                    let $content = $('#luckysheet-formula-help-c .luckysheet-formula-help-content');\n                    $content.slideToggle(100, function () {\n                        let $c = _this.rangeResizeTo.parent(), offset = $c.offset();\n                        _this.searchFunctionPosition($('#luckysheet-formula-help-c'), $c, offset.left, offset.top, true);\n                    });\n                    if ($content.is(':hidden')) {\n                        $(this).html('<i class=\"fa fa-angle-up\" aria-hidden=\"true\"></i>');\n                    } else {\n                        $(this).html('<i class=\"fa fa-angle-down\" aria-hidden=\"true\"></i>');\n                    }\n                });\n                for (let i = 0; i < functionlist.length; i++) {\n                    _this.functionlistPosition[functionlist[i].n] = i;\n                }\n            }\n            if (!currSelection) {\n                return;\n            }\n            let $prev = currSelection, funcLen = $editer.length, $span = $editer.find('span'), currentIndex = currSelection.index(), i = currentIndex;\n            if ($prev == null) {\n                return;\n            }\n            let funcName = null, paramindex = null;\n            if ($span.eq(i).is('.luckysheet-formula-text-func')) {\n                funcName = $span.eq(i).text();\n            } else {\n                let $cur = null, exceptIndex = [\n                        -1,\n                        -1\n                    ];\n                while (--i > 0) {\n                    $cur = $span.eq(i);\n                    if ($cur.is('.luckysheet-formula-text-func') || $.trim($cur.text()).toUpperCase() in _this.functionlistPosition) {\n                        funcName = $cur.text();\n                        paramindex = null;\n                        let endstate = true;\n                        for (let a = i; a <= currentIndex; a++) {\n                            if (!paramindex) {\n                                paramindex = 0;\n                            }\n                            if (a >= exceptIndex[0] && a <= exceptIndex[1]) {\n                                continue;\n                            }\n                            $cur = $span.eq(a);\n                            if ($cur.is('.luckysheet-formula-text-rpar')) {\n                                exceptIndex = [\n                                    i,\n                                    a\n                                ];\n                                funcName = null;\n                                endstate = false;\n                                break;\n                            }\n                            if ($cur.is('.luckysheet-formula-text-comma')) {\n                                paramindex++;\n                            }\n                        }\n                        if (endstate) {\n                            break;\n                        }\n                    }\n                }\n            }\n            if (funcName == null) {\n                return;\n            }\n            _this.helpFunction($editer, funcName, paramindex);\n        },\n        rangeHightlightselected: function ($editer, kcode) {\n            let _this = this;\n            let currSelection = _this.getrangeseleciton();\n            $('#luckysheet-formula-search-c, #luckysheet-formula-help-c').hide();\n            $('#luckysheet-formula-functionrange .luckysheet-formula-functionrange-highlight .luckysheet-selection-copy-hc').css('opacity', '0.03');\n            $('#luckysheet-formula-search-c, #luckysheet-formula-help-c').hide();\n            _this.helpFunctionExe($editer, currSelection);    // console.log(currSelection, $(currSelection).closest(\".luckysheet-formula-functionrange-cell\").length);\n            // console.log(currSelection, $(currSelection).closest(\".luckysheet-formula-functionrange-cell\").length);\n            if ($(currSelection).closest('.luckysheet-formula-functionrange-cell').length == 0) {\n                _this.searchFunction($editer);\n                return;\n            }\n            let $anchorOffset = $(currSelection).closest('.luckysheet-formula-functionrange-cell');\n            let rangeindex = $anchorOffset.attr('rangeindex');\n            let rangeid = 'luckysheet-formula-functionrange-highlight-' + rangeindex;\n            $('#' + rangeid).find('.luckysheet-selection-copy-hc').css({ 'opacity': '0.13' });\n        },\n        updatecell: function (r, c, value, isRefresh = true) {\n            let _this = this;\n            let $input = $('#luckysheet-rich-text-editor');\n            let inputText = $input.text(), inputHtml = $input.html();\n            if (_this.rangetosheet != null && _this.rangetosheet != Store.currentSheetIndex) {\n                Store.changeSheet(_this.rangetosheet);\n            }\n            if (!checkProtectionLocked(r, c, Store.currentSheetIndex)) {\n                return;\n            } \n            //数据验证 输入数据无效时禁止输入\n            if (Store.dataVerification != null) {\n                let dvItem = Store.dataVerification[r + '_' + c];\n                if (dvItem != null && dvItem.prohibitInput && !dataVerificationCtrl.validateCellData(inputText, dvItem)) {\n                    let failureText = dataVerificationCtrl.getFailureText(dvItem);\n                    tooltip.info(failureText, '');\n                    _this.cancelNormalSelected();\n                    return;\n                }\n            }\n            let curv = Store.flowdata[r][c];    // Store old value for hook function\n            // Store old value for hook function\n            const oldValue = JSON.stringify(curv);\n            let isPrevInline = isInlineStringCell(curv);\n            let isCurInline = inputText.slice(0, 1) != '=' && inputHtml.substr(0, 5) == '<span';\n            let isCopyVal = false;\n            if (!isCurInline && inputText && inputText.length > 0) {\n                let splitArr = inputText.replace(/\\r\\n/g, '_x000D_').replace(/&#13;&#10;/g, '_x000D_').replace(/\\r/g, '_x000D_').replace(/\\n/g, '_x000D_').split('_x000D_');\n                if (splitArr.length > 1) {\n                    isCopyVal = true;\n                    isCurInline = true;\n                    inputText = splitArr.join('\\r\\n');\n                }\n            }\n            if (!value && !isCurInline && isPrevInline) {\n                delete curv.ct.s;\n                curv.ct.t = 'g';\n                curv.ct.fa = 'General';\n                value = '';\n            } else if (isCurInline) {\n                if (getObjType(curv) != 'object') {\n                    curv = {};\n                }\n                delete curv.f;\n                delete curv.v;\n                delete curv.m;\n                if (curv.ct == null) {\n                    curv.ct = {};\n                    curv.ct.fa = 'General';\n                }\n                curv.ct.t = 'inlineStr';\n                curv.ct.s = convertSpanToShareString($input.find('span'));\n                if (isCopyVal) {\n                    curv.ct.s = [{ v: inputText }];\n                }\n            }    // API, we get value from user\n            // API, we get value from user\n            value = value || $input.text();    // Hook function\n            // Hook function\n            if (!luckysheetConfigsetting.createHookFunction('cellUpdateBefore', r, c, value, isRefresh)) {\n                _this.cancelNormalSelected();\n                return;\n            }\n            if (!isCurInline) {\n                if (isRealNull(value) && !isPrevInline) {\n                    if (curv == null || isRealNull(curv.v) && curv.spl == null && curv.f == null) {\n                        _this.cancelNormalSelected();\n                        return;\n                    }\n                } else if (curv != null && curv.qp != 1) {\n                    if (getObjType(curv) == 'object' && (value == curv.f || value == curv.v || value == curv.m)) {\n                        _this.cancelNormalSelected();\n                        return;\n                    } else if (value == curv) {\n                        _this.cancelNormalSelected();\n                        return;\n                    }\n                }\n                if (getObjType(value) == 'string' && value.slice(0, 1) == '=' && value.length > 1) {\n                } else if (getObjType(curv) == 'object' && curv.ct != null && curv.ct.fa != null && curv.ct.fa != '@' && !isRealNull(value)) {\n                    delete curv.m;    //更新时间m处理 ， 会实际删除单元格数据的参数（flowdata时已删除）\n                    //更新时间m处理 ， 会实际删除单元格数据的参数（flowdata时已删除）\n                    if (curv.f != null) {\n                        //如果原来是公式，而更新的数据不是公式，则把公式删除\n                        delete curv.f;\n                        delete curv.spl;    //删除单元格的sparklines的配置串\n                    }\n                }\n            }\n            //删除单元格的sparklines的配置串\n            window.luckysheet_getcelldata_cache = null;\n            let isRunExecFunction = true;\n            let d = Store.deepCopyFlowData(Store.flowdata);\n            let dynamicArrayItem = null;    //动态数组\n            //动态数组\n            if (getObjType(curv) == 'object') {\n                if (!isCurInline) {\n                    if (getObjType(value) == 'string' && value.slice(0, 1) == '=' && value.length > 1) {\n                        let v = _this.execfunction(value, r, c, undefined, true);\n                        isRunExecFunction = false;\n                        curv = $.extend(true, {}, d[r][c]);\n                        curv.v = v[1];\n                        curv.f = v[2];    //打进单元格的sparklines的配置串， 报错需要单独处理。\n                        //打进单元格的sparklines的配置串， 报错需要单独处理。\n                        if (v.length == 4 && v[3].type == 'sparklines') {\n                            delete curv.m;\n                            delete curv.v;\n                            let curCalv = v[3].data;\n                            if (getObjType(curCalv) == 'array' && getObjType(curCalv[0]) != 'object') {\n                                curv.v = curCalv[0];\n                            } else {\n                                curv.spl = v[3].data;\n                            }\n                        } else if (v.length == 4 && v[3].type == 'dynamicArrayItem') {\n                            dynamicArrayItem = v[3].data;\n                        }\n                    }    // from API setCellValue,luckysheet.setCellValue(0, 0, {f: \"=sum(D1)\", bg:\"#0188fb\"}),value is an object, so get attribute f as value\n                    else // from API setCellValue,luckysheet.setCellValue(0, 0, {f: \"=sum(D1)\", bg:\"#0188fb\"}),value is an object, so get attribute f as value\n                    if (getObjType(value) == 'object') {\n                        let valueFunction = value.f;\n                        if (getObjType(valueFunction) == 'string' && valueFunction.slice(0, 1) == '=' && valueFunction.length > 1) {\n                            let v = _this.execfunction(valueFunction, r, c, undefined, true);\n                            isRunExecFunction = false;    // get v/m/ct\n                            // get v/m/ct\n                            curv = $.extend(true, {}, d[r][c]);\n                            curv.v = v[1];\n                            curv.f = v[2];    //打进单元格的sparklines的配置串， 报错需要单独处理。\n                            //打进单元格的sparklines的配置串， 报错需要单独处理。\n                            if (v.length == 4 && v[3].type == 'sparklines') {\n                                delete curv.m;\n                                delete curv.v;\n                                let curCalv = v[3].data;\n                                if (getObjType(curCalv) == 'array' && getObjType(curCalv[0]) != 'object') {\n                                    curv.v = curCalv[0];\n                                } else {\n                                    curv.spl = v[3].data;\n                                }\n                            } else if (v.length == 4 && v[3].type == 'dynamicArrayItem') {\n                                dynamicArrayItem = v[3].data;\n                            }\n                        }    // from API setCellValue,luckysheet.setCellValue(0, 0, {f: \"=sum(D1)\", bg:\"#0188fb\"}),value is an object, so get attribute f as value\n                        else\n                            // from API setCellValue,luckysheet.setCellValue(0, 0, {f: \"=sum(D1)\", bg:\"#0188fb\"}),value is an object, so get attribute f as value\n                            {\n                                for (let attr in value) {\n                                    curv[attr] = value[attr];\n                                }    // let valueFunction = value.f;\n                                     // if(getObjType(valueFunction) == \"string\" && valueFunction.slice(0, 1) == \"=\" && valueFunction.length > 1){\n                                     //     let v = _this.execfunction(valueFunction, r, c, undefined, true);\n                                     //     isRunExecFunction = false;\n                                     //     // get v/m/ct\n                                     //     curv = d[r][c];\n                                     //     curv.v = v[1];\n                                     //     // get f\n                                     //     curv.f = v[2];\n                                     //     // get other cell style attribute\n                                     //     delete value.v;\n                                     //     delete value.m;\n                                     //     delete value.f;\n                                     //     Object.assign(curv,value);\n                                     //     //打进单元格的sparklines的配置串， 报错需要单独处理。\n                                     //     if(v.length == 4 && v[3].type == \"sparklines\"){\n                                     //         delete curv.m;\n                                     //         delete curv.v;\n                                     //         let curCalv = v[3].data;\n                                     //         if(getObjType(curCalv) == \"array\" && getObjType(curCalv[0]) != \"object\"){\n                                     //             curv.v = curCalv[0];\n                                     //         }\n                                     //         else{\n                                     //             curv.spl = v[3].data;\n                                     //         }\n                                     //     }\n                                     // }\n                            }\n                    } else\n                        // let valueFunction = value.f;\n                        // if(getObjType(valueFunction) == \"string\" && valueFunction.slice(0, 1) == \"=\" && valueFunction.length > 1){\n                        //     let v = _this.execfunction(valueFunction, r, c, undefined, true);\n                        //     isRunExecFunction = false;\n                        //     // get v/m/ct\n                        //     curv = d[r][c];\n                        //     curv.v = v[1];\n                        //     // get f\n                        //     curv.f = v[2];\n                        //     // get other cell style attribute\n                        //     delete value.v;\n                        //     delete value.m;\n                        //     delete value.f;\n                        //     Object.assign(curv,value);\n                        //     //打进单元格的sparklines的配置串， 报错需要单独处理。\n                        //     if(v.length == 4 && v[3].type == \"sparklines\"){\n                        //         delete curv.m;\n                        //         delete curv.v;\n                        //         let curCalv = v[3].data;\n                        //         if(getObjType(curCalv) == \"array\" && getObjType(curCalv[0]) != \"object\"){\n                        //             curv.v = curCalv[0];\n                        //         }\n                        //         else{\n                        //             curv.spl = v[3].data;\n                        //         }\n                        //     }\n                        // }\n                        {\n                            _this.delFunctionGroup(r, c);\n                            _this.execFunctionGroup(r, c, value);\n                            isRunExecFunction = false;\n                            curv = $.extend(true, {}, d[r][c]);    // let gd = _this.execFunctionGlobalData[r+\"_\"+c+\"_\"+Store.currentSheetIndex];\n                                                                   // if(gd!=null){\n                                                                   //     curv.v = gd.v;\n                                                                   // }\n                            // let gd = _this.execFunctionGlobalData[r+\"_\"+c+\"_\"+Store.currentSheetIndex];\n                            // if(gd!=null){\n                            //     curv.v = gd.v;\n                            // }\n                            curv.v = value;\n                            delete curv.f;\n                            delete curv.spl;\n                            if (curv.qp == 1 && ('' + value).substr(0, 1) != \"'\") {\n                                //if quotePrefix is 1, cell is force string, cell clear quotePrefix when it is updated\n                                curv.qp = 0;\n                                if (curv.ct != null) {\n                                    curv.ct.fa = 'General';\n                                    curv.ct.t = 'n';\n                                }\n                            }\n                        }\n                }\n                value = curv;\n            } else {\n                if (getObjType(value) == 'string' && value.slice(0, 1) == '=' && value.length > 1) {\n                    let v = _this.execfunction(value, r, c, undefined, true);\n                    isRunExecFunction = false;\n                    value = {\n                        'v': v[1],\n                        'f': v[2]\n                    };    //打进单元格的sparklines的配置串， 报错需要单独处理。\n                    //打进单元格的sparklines的配置串， 报错需要单独处理。\n                    if (v.length == 4 && v[3].type == 'sparklines') {\n                        let curCalv = v[3].data;\n                        if (getObjType(curCalv) == 'array' && getObjType(curCalv[0]) != 'object') {\n                            value.v = curCalv[0];\n                        } else {\n                            value.spl = v[3].data;\n                        }\n                    } else if (v.length == 4 && v[3].type == 'dynamicArrayItem') {\n                        dynamicArrayItem = v[3].data;\n                    }\n                }    // from API setCellValue,luckysheet.setCellValue(0, 0, {f: \"=sum(D1)\", bg:\"#0188fb\"}),value is an object, so get attribute f as value\n                else // from API setCellValue,luckysheet.setCellValue(0, 0, {f: \"=sum(D1)\", bg:\"#0188fb\"}),value is an object, so get attribute f as value\n                if (getObjType(value) == 'object') {\n                    let valueFunction = value.f;\n                    if (getObjType(valueFunction) == 'string' && valueFunction.slice(0, 1) == '=' && valueFunction.length > 1) {\n                        let v = _this.execfunction(valueFunction, r, c, undefined, true);\n                        isRunExecFunction = false;    // value = {\n                                                      //     \"v\": v[1],\n                                                      //     \"f\": v[2]\n                                                      // };\n                                                      // update attribute v\n                        // value = {\n                        //     \"v\": v[1],\n                        //     \"f\": v[2]\n                        // };\n                        // update attribute v\n                        value.v = v[1];\n                        value.f = v[2];    //打进单元格的sparklines的配置串， 报错需要单独处理。\n                        //打进单元格的sparklines的配置串， 报错需要单独处理。\n                        if (v.length == 4 && v[3].type == 'sparklines') {\n                            let curCalv = v[3].data;\n                            if (getObjType(curCalv) == 'array' && getObjType(curCalv[0]) != 'object') {\n                                value.v = curCalv[0];\n                            } else {\n                                value.spl = v[3].data;\n                            }\n                        } else if (v.length == 4 && v[3].type == 'dynamicArrayItem') {\n                            dynamicArrayItem = v[3].data;\n                        }\n                    } else {\n                        let v = curv;\n                        if (value.v == null) {\n                            value.v = v;\n                        }\n                    }\n                } else {\n                    _this.delFunctionGroup(r, c);\n                    _this.execFunctionGroup(r, c, value);\n                    isRunExecFunction = false;\n                }\n            }    // value maybe an object\n            // value maybe an object\n            setcellvalue(r, c, d, value);\n            _this.cancelNormalSelected();\n            let RowlChange = false;\n            let cfg = $.extend(true, {}, getluckysheetfile()[getSheetIndex(Store.currentSheetIndex)]['config']);\n            if (cfg['rowlen'] == null) {\n                cfg['rowlen'] = {};\n            }\n            if (d[r][c].tb == '2' && d[r][c].v != null || isInlineStringCell(d[r][c])) {\n                //自动换行\n                let defaultrowlen = Store.defaultrowlen;\n                let canvas = $('#luckysheetTableContent').get(0).getContext('2d');    // offlinecanvas.textBaseline = 'top'; //textBaseline以top计算\n                                                                                      // let fontset = luckysheetfontformat(d[r][c]);\n                                                                                      // offlinecanvas.font = fontset;\n                // offlinecanvas.textBaseline = 'top'; //textBaseline以top计算\n                // let fontset = luckysheetfontformat(d[r][c]);\n                // offlinecanvas.font = fontset;\n                if (cfg['customHeight'] && cfg['customHeight'][r] == 1) {\n                } else {\n                    // let currentRowLen = defaultrowlen;\n                    // if(cfg[\"rowlen\"][r] != null){\n                    //     currentRowLen = cfg[\"rowlen\"][r];\n                    // }\n                    let cellWidth = colLocationByIndex(c)[1] - colLocationByIndex(c)[0] - 2;\n                    let textInfo = getCellTextInfo(d[r][c], canvas, {\n                        r: r,\n                        c: c,\n                        cellWidth: cellWidth\n                    });\n                    let currentRowLen = defaultrowlen;    // console.log(\"rowlen\", textInfo);\n                    // console.log(\"rowlen\", textInfo);\n                    if (textInfo != null) {\n                        currentRowLen = textInfo.textHeightAll + 2;\n                    }    // let strValue = getcellvalue(r, c, d).toString();\n                         // let measureText = offlinecanvas.measureText(strValue);\n                         // let textMetrics = measureText.width;\n                         // let cellWidth = colLocationByIndex(c)[1] - colLocationByIndex(c)[0] - 4;\n                         // let oneLineTextHeight = measureText.actualBoundingBoxDescent - measureText.actualBoundingBoxAscent;\n                         // if(textMetrics > cellWidth){\n                         //     let strArr = [];//文本截断数组\n                         //     strArr = getCellTextSplitArr(strValue, strArr, cellWidth, offlinecanvas);\n                         //     let computeRowlen = oneLineTextHeight * strArr.length + 4;\n                         //     //比较计算高度和当前高度取最大高度\n                         //     if(computeRowlen > currentRowLen){\n                         //         currentRowLen = computeRowlen;\n                         //     }\n                         // }\n                    // let strValue = getcellvalue(r, c, d).toString();\n                    // let measureText = offlinecanvas.measureText(strValue);\n                    // let textMetrics = measureText.width;\n                    // let cellWidth = colLocationByIndex(c)[1] - colLocationByIndex(c)[0] - 4;\n                    // let oneLineTextHeight = measureText.actualBoundingBoxDescent - measureText.actualBoundingBoxAscent;\n                    // if(textMetrics > cellWidth){\n                    //     let strArr = [];//文本截断数组\n                    //     strArr = getCellTextSplitArr(strValue, strArr, cellWidth, offlinecanvas);\n                    //     let computeRowlen = oneLineTextHeight * strArr.length + 4;\n                    //     //比较计算高度和当前高度取最大高度\n                    //     if(computeRowlen > currentRowLen){\n                    //         currentRowLen = computeRowlen;\n                    //     }\n                    // }\n                    if (currentRowLen > defaultrowlen) {\n                        cfg['rowlen'][r] = currentRowLen;\n                        RowlChange = true;\n                    }\n                }\n            }    //动态数组\n            //动态数组\n            let dynamicArray = null;\n            if (!!dynamicArrayItem) {\n                // let file = Store.luckysheetfile[getSheetIndex(Store.currentSheetIndex)];\n                dynamicArray = $.extend(true, [], this.insertUpdateDynamicArray(dynamicArrayItem));    // dynamicArray.push(dynamicArrayItem);\n            }\n            // dynamicArray.push(dynamicArrayItem);\n            let allParam = { 'dynamicArray': dynamicArray };\n            if (RowlChange) {\n                allParam = {\n                    'cfg': cfg,\n                    'dynamicArray': dynamicArray,\n                    'RowlChange': RowlChange\n                };\n            }\n            setTimeout(() => {\n                // Hook function\n                luckysheetConfigsetting.createHookFunction('cellUpdated', r, c, JSON.parse(oldValue), Store.flowdata[r][c], isRefresh);\n            }, 0);\n            if (isRefresh) {\n                Store.refreshRange(d, [{\n                        'row': [\n                            r,\n                            r\n                        ],\n                        'column': [\n                            c,\n                            c\n                        ]\n                    }], allParam, isRunExecFunction);    // Store.luckysheetCellUpdate.length = 0; //clear array\n                // Store.luckysheetCellUpdate.length = 0; //clear array\n                _this.execFunctionGlobalData = null;    //销毁\n            } else\n                //销毁\n                {\n                    return {\n                        data: d,\n                        allParam: allParam\n                    };\n                }\n        },\n        cancelNormalSelected: function () {\n            let _this = this;\n            _this.canceFunctionrangeSelected();\n            $('#luckysheet-formula-functionrange .luckysheet-formula-functionrange-highlight').remove();\n            $('#luckysheet-input-box').removeAttr('style');\n            $('#luckysheet-input-box-index').hide();\n            $('#luckysheet-wa-functionbox-cancel, #luckysheet-wa-functionbox-confirm').removeClass('luckysheet-wa-calculate-active');\n            _this.rangestart = false;\n            _this.rangedrag_column_start = false;\n            _this.rangedrag_row_start = false;\n        },\n        canceFunctionrangeSelected: function () {\n            $('#luckysheet-formula-functionrange-select').hide();\n            $('#luckysheet-row-count-show, #luckysheet-column-count-show').hide();    // $(\"#luckysheet-cols-h-selected, #luckysheet-rows-h-selected\").hide();\n            // $(\"#luckysheet-cols-h-selected, #luckysheet-rows-h-selected\").hide();\n            $('#luckysheet-formula-search-c, #luckysheet-formula-help-c').hide();\n        },\n\n        operator: '==|!=|<>|<=|>=|=|+|-|>|<|/|*|%|&|^',\n        operatorjson: null,\n        functionCopy: function (txt, mode, step) {\n            let _this = this;\n            if (_this.operatorjson == null) {\n                let arr = _this.operator.split('|'), op = {};\n                for (let i = 0; i < arr.length; i++) {\n                    op[arr[i].toString()] = 1;\n                }\n                _this.operatorjson = op;\n            }\n            if (mode == null) {\n                mode = 'down';\n            }\n            if (step == null) {\n                step = 1;\n            }\n            if (txt.substr(0, 1) == '=') {\n                txt = txt.substr(1);\n            }\n            let funcstack = txt.split('');\n            let i = 0, str = '', function_str = '', ispassby = true;\n            let matchConfig = {\n                'bracket': 0,\n                'comma': 0,\n                'squote': 0,\n                'dquote': 0\n            };\n            while (i < funcstack.length) {\n                let s = funcstack[i];\n                if (s == '(' && matchConfig.dquote == 0) {\n                    matchConfig.bracket += 1;\n                    if (str.length > 0) {\n                        function_str += str + '(';\n                    } else {\n                        function_str += '(';\n                    }\n                    str = '';\n                } else if (s == ')' && matchConfig.dquote == 0) {\n                    matchConfig.bracket -= 1;\n                    function_str += _this.functionCopy(str, mode, step) + ')';\n                    str = '';\n                } else if (s == '\"' && matchConfig.squote == 0) {\n                    if (matchConfig.dquote > 0) {\n                        function_str += str + '\"';\n                        matchConfig.dquote -= 1;\n                        str = '';\n                    } else {\n                        matchConfig.dquote += 1;\n                        str += '\"';\n                    }\n                } else if (s == ',' && matchConfig.dquote == 0) {\n                    function_str += _this.functionCopy(str, mode, step) + ',';\n                    str = '';\n                } else if (s == '&' && matchConfig.dquote == 0) {\n                    if (str.length > 0) {\n                        function_str += _this.functionCopy(str, mode, step) + '&';\n                        str = '';\n                    } else {\n                        function_str += '&';\n                    }\n                } else if (s in _this.operatorjson && matchConfig.dquote == 0) {\n                    let s_next = '';\n                    if (i + 1 < funcstack.length) {\n                        s_next = funcstack[i + 1];\n                    }\n                    let p = i - 1, s_pre = null;\n                    if (p >= 0) {\n                        do {\n                            s_pre = funcstack[p--];\n                        } while (p >= 0 && s_pre == ' ');\n                    }\n                    if (s + s_next in _this.operatorjson) {\n                        if (str.length > 0) {\n                            function_str += _this.functionCopy(str, mode, step) + s + s_next;\n                            str = '';\n                        } else {\n                            function_str += s + s_next;\n                        }\n                        i++;\n                    } else if (!/[^0-9]/.test(s_next) && s == '-' && (s_pre == '(' || s_pre == null || s_pre == ',' || s_pre == ' ' || s_pre in _this.operatorjson)) {\n                        str += s;\n                    } else {\n                        if (str.length > 0) {\n                            function_str += _this.functionCopy(str, mode, step) + s;\n                            str = '';\n                        } else {\n                            function_str += s;\n                        }\n                    }\n                } else {\n                    str += s;\n                }\n                if (i == funcstack.length - 1) {\n                    if (_this.iscelldata($.trim(str))) {\n                        if (mode == 'down') {\n                            function_str += _this.downparam($.trim(str), step);\n                        } else if (mode == 'up') {\n                            function_str += _this.upparam($.trim(str), step);\n                        } else if (mode == 'left') {\n                            function_str += _this.leftparam($.trim(str), step);\n                        } else if (mode == 'right') {\n                            function_str += _this.rightparam($.trim(str), step);\n                        }\n                    } else {\n                        function_str += $.trim(str);\n                    }\n                }\n                i++;\n            }\n            return function_str;\n        },\n        isfreezonFuc: function (txt) {\n            let row = txt.replace(/[^0-9]/g, '');\n            let col = txt.replace(/[^A-Za-z]/g, '');\n            let row$ = txt.substr(txt.indexOf(row) - 1, 1);\n            let col$ = txt.substr(txt.indexOf(col) - 1, 1);\n            let ret = [\n                false,\n                false\n            ];\n            if (row$ == '$') {\n                ret[0] = true;\n            }\n            if (col$ == '$') {\n                ret[1] = true;\n            }\n            return ret;\n        },\n        setfreezonFuceExe: function (rangetxt) {\n            let row = parseInt(rangetxt.replace(/[^0-9]/g, ''));\n            let col = ABCatNum(rangetxt.replace(/[^A-Za-z]/g, ''));\n            let $row = '$', $col = '$';\n            if (!isNaN(row) && !isNaN(col)) {\n                return $col + chatatABC(col) + $row + row;\n            } else if (!isNaN(row)) {\n                return $row + row;\n            } else if (!isNaN(col)) {\n                return $col + chatatABC(col);\n            } else {\n                return rangetxt;\n            }\n        },\n        setfreezonFuc: function (event) {\n            let _this = this;\n            let obj = _this.getrangeseleciton();\n            if (!_this.iscelldata(obj.text())) {\n                return;\n            }\n            let txt = obj.text(), pos = window.getSelection().anchorOffset;\n            let val = txt.split('!'), rangetxt, prefix = '';\n            if (val.length > 1) {\n                rangetxt = val[1];\n                prefix = val[0] + '!';\n            } else {\n                rangetxt = val[0];\n            }\n            let newtxt = '', newpos = '';\n            let rangetxtIndex = rangetxt.indexOf(':');\n            if (rangetxtIndex == -1) {\n                newtxt = prefix + _this.setfreezonFuceExe(rangetxt);\n                newpos = newtxt.length;\n            } else {\n                rangetxt = rangetxt.split(':');\n                if (pos > rangetxtIndex) {\n                    let ret = prefix + rangetxt[0] + ':' + _this.setfreezonFuceExe(rangetxt[1]);\n                    newtxt = ret;\n                    newpos = ret.length;\n                } else {\n                    let firsttxt = prefix + _this.setfreezonFuceExe(rangetxt[0]);\n                    let ret = firsttxt + ':' + rangetxt[1];\n                    newtxt = ret;\n                    newpos = firsttxt.length;\n                }\n            }\n            obj.text(prefix + newtxt);\n            _this.setCaretPosition(obj.get(0), 0, newpos);\n        },\n        updateparam: function (orient, txt, step) {\n            let _this = this;\n            let val = txt.split('!'), rangetxt, prefix = '';\n            if (val.length > 1) {\n                rangetxt = val[1];\n                prefix = val[0] + '!';\n            } else {\n                rangetxt = val[0];\n            }\n            if (rangetxt.indexOf(':') == -1) {\n                let row = parseInt(rangetxt.replace(/[^0-9]/g, ''));\n                let col = ABCatNum(rangetxt.replace(/[^A-Za-z]/g, ''));\n                let freezonFuc = _this.isfreezonFuc(rangetxt);\n                let $row = freezonFuc[0] ? '$' : '', $col = freezonFuc[1] ? '$' : '';\n                if (orient == 'u' && !freezonFuc[0]) {\n                    row -= step;\n                } else if (orient == 'r' && !freezonFuc[1]) {\n                    col += step;\n                } else if (orient == 'l' && !freezonFuc[1]) {\n                    col -= step;\n                } else if (orient == 'd' && !freezonFuc[0]) {\n                    row += step;\n                }\n                if (row[0] < 0 || col[0] < 0) {\n                    return _this.error.r;\n                }\n                if (!isNaN(row) && !isNaN(col)) {\n                    return prefix + $col + chatatABC(col) + $row + row;\n                } else if (!isNaN(row)) {\n                    return prefix + $row + row;\n                } else if (!isNaN(col)) {\n                    return prefix + $col + chatatABC(col);\n                } else {\n                    return txt;\n                }\n            } else {\n                rangetxt = rangetxt.split(':');\n                let row = [], col = [];\n                row[0] = parseInt(rangetxt[0].replace(/[^0-9]/g, ''));\n                row[1] = parseInt(rangetxt[1].replace(/[^0-9]/g, ''));\n                if (row[0] > row[1]) {\n                    return txt;\n                }\n                col[0] = ABCatNum(rangetxt[0].replace(/[^A-Za-z]/g, ''));\n                col[1] = ABCatNum(rangetxt[1].replace(/[^A-Za-z]/g, ''));\n                if (col[0] > col[1]) {\n                    return txt;\n                }\n                let freezonFuc0 = _this.isfreezonFuc(rangetxt[0]);\n                let freezonFuc1 = _this.isfreezonFuc(rangetxt[1]);\n                let $row0 = freezonFuc0[0] ? '$' : '', $col0 = freezonFuc0[1] ? '$' : '';\n                let $row1 = freezonFuc1[0] ? '$' : '', $col1 = freezonFuc1[1] ? '$' : '';\n                if (orient == 'u') {\n                    if (!freezonFuc0[0]) {\n                        row[0] -= step;\n                    }\n                    if (!freezonFuc1[0]) {\n                        row[1] -= step;\n                    }\n                } else if (orient == 'r') {\n                    if (!freezonFuc0[1]) {\n                        col[0] += step;\n                    }\n                    if (!freezonFuc1[1]) {\n                        col[1] += step;\n                    }\n                } else if (orient == 'l') {\n                    if (!freezonFuc0[1]) {\n                        col[0] -= step;\n                    }\n                    if (!freezonFuc1[1]) {\n                        col[1] -= step;\n                    }\n                } else if (orient == 'd') {\n                    if (!freezonFuc0[0]) {\n                        row[0] += step;\n                    }\n                    if (!freezonFuc1[0]) {\n                        row[1] += step;\n                    }\n                }\n                if (row[0] < 0 || col[0] < 0) {\n                    return _this.error.r;\n                }\n                if (isNaN(col[0]) && isNaN(col[1])) {\n                    return prefix + $row0 + row[0] + ':' + $row1 + row[1];\n                } else if (isNaN(row[0]) && isNaN(row[1])) {\n                    return prefix + $col0 + chatatABC(col[0]) + ':' + $col1 + chatatABC(col[1]);\n                } else {\n                    return prefix + $col0 + chatatABC(col[0]) + $row0 + row[0] + ':' + $col1 + chatatABC(col[1]) + $row1 + row[1];\n                }\n            }\n        },\n        downparam: function (txt, step) {\n            return this.updateparam('d', txt, step);\n        },\n        upparam: function (txt, step) {\n            return this.updateparam('u', txt, step);\n        },\n        leftparam: function (txt, step) {\n            return this.updateparam('l', txt, step);\n        },\n        rightparam: function (txt, step) {\n            return this.updateparam('r', txt, step);\n        },\n        functionStrChange: function (txt, type, rc, orient, stindex, step) {\n            let _this = this;\n            if (_this.operatorjson == null) {\n                let arr = _this.operator.split('|'), op = {};\n                for (let i = 0; i < arr.length; i++) {\n                    op[arr[i].toString()] = 1;\n                }\n                _this.operatorjson = op;\n            }\n            if (txt.substr(0, 1) == '=') {\n                txt = txt.substr(1);\n            }\n            let funcstack = txt.split('');\n            let i = 0, str = '', function_str = '', ispassby = true;\n            let matchConfig = {\n                'bracket': 0,\n                //括号\n                'comma': 0,\n                //逗号\n                'squote': 0,\n                //单引号\n                'dquote': 0    //双引号\n            };\n            //双引号\n            while (i < funcstack.length) {\n                let s = funcstack[i];\n                if (s == '(' && matchConfig.dquote == 0) {\n                    matchConfig.bracket += 1;\n                    if (str.length > 0) {\n                        function_str += str + '(';\n                    } else {\n                        function_str += '(';\n                    }\n                    str = '';\n                } else if (s == ')' && matchConfig.dquote == 0) {\n                    matchConfig.bracket -= 1;\n                    function_str += _this.functionStrChange(str, type, rc, orient, stindex, step) + ')';\n                    str = '';\n                } else if (s == '\"' && matchConfig.squote == 0) {\n                    if (matchConfig.dquote > 0) {\n                        function_str += str + '\"';\n                        matchConfig.dquote -= 1;\n                        str = '';\n                    } else {\n                        matchConfig.dquote += 1;\n                        str += '\"';\n                    }\n                } else if (s == ',' && matchConfig.dquote == 0) {\n                    function_str += _this.functionStrChange(str, type, rc, orient, stindex, step) + ',';\n                    str = '';\n                } else if (s == '&' && matchConfig.dquote == 0) {\n                    if (str.length > 0) {\n                        function_str += _this.functionStrChange(str, type, rc, orient, stindex, step) + '&';\n                        str = '';\n                    } else {\n                        function_str += '&';\n                    }\n                } else if (s in _this.operatorjson && matchConfig.dquote == 0) {\n                    let s_next = '';\n                    if (i + 1 < funcstack.length) {\n                        s_next = funcstack[i + 1];\n                    }\n                    let p = i - 1, s_pre = null;\n                    if (p >= 0) {\n                        do {\n                            s_pre = funcstack[p--];\n                        } while (p >= 0 && s_pre == ' ');\n                    }\n                    if (s + s_next in _this.operatorjson) {\n                        if (str.length > 0) {\n                            function_str += _this.functionStrChange(str, type, rc, orient, stindex, step) + s + s_next;\n                            str = '';\n                        } else {\n                            function_str += s + s_next;\n                        }\n                        i++;\n                    } else if (!/[^0-9]/.test(s_next) && s == '-' && (s_pre == '(' || s_pre == null || s_pre == ',' || s_pre == ' ' || s_pre in _this.operatorjson)) {\n                        str += s;\n                    } else {\n                        if (str.length > 0) {\n                            function_str += _this.functionStrChange(str, type, rc, orient, stindex, step) + s;\n                            str = '';\n                        } else {\n                            function_str += s;\n                        }\n                    }\n                } else {\n                    str += s;\n                }\n                if (i == funcstack.length - 1) {\n                    if (_this.iscelldata($.trim(str))) {\n                        function_str += _this.functionStrChange_range($.trim(str), type, rc, orient, stindex, step);\n                    } else {\n                        function_str += $.trim(str);\n                    }\n                }\n                i++;\n            }\n            return function_str;\n        },\n        functionStrChange_range: function (txt, type, rc, orient, stindex, step) {\n            let _this = this;\n            let val = txt.split('!'), rangetxt, prefix = '';\n            if (val.length > 1) {\n                rangetxt = val[1];\n                prefix = val[0] + '!';\n            } else {\n                rangetxt = val[0];\n            }\n            let r1, r2, c1, c2;\n            let $row0, $row1, $col0, $col1;\n            if (rangetxt.indexOf(':') == -1) {\n                r1 = r2 = parseInt(rangetxt.replace(/[^0-9]/g, '')) - 1;\n                c1 = c2 = ABCatNum(rangetxt.replace(/[^A-Za-z]/g, ''));\n                let freezonFuc = _this.isfreezonFuc(rangetxt);\n                $row0 = $row1 = freezonFuc[0] ? '$' : '', $col0 = $col1 = freezonFuc[1] ? '$' : '';\n            } else {\n                rangetxt = rangetxt.split(':');\n                r1 = parseInt(rangetxt[0].replace(/[^0-9]/g, '')) - 1;\n                r2 = parseInt(rangetxt[1].replace(/[^0-9]/g, '')) - 1;\n                if (r1 > r2) {\n                    return txt;\n                }\n                c1 = ABCatNum(rangetxt[0].replace(/[^A-Za-z]/g, ''));\n                c2 = ABCatNum(rangetxt[1].replace(/[^A-Za-z]/g, ''));\n                if (c1 > c2) {\n                    return txt;\n                }\n                let freezonFuc0 = _this.isfreezonFuc(rangetxt[0]);\n                $row0 = freezonFuc0[0] ? '$' : '';\n                $col0 = freezonFuc0[1] ? '$' : '';\n                let freezonFuc1 = _this.isfreezonFuc(rangetxt[1]);\n                $row1 = freezonFuc1[0] ? '$' : '';\n                $col1 = freezonFuc1[1] ? '$' : '';\n            }\n            if (type == 'del') {\n                if (rc == 'row') {\n                    if (r1 >= stindex && r2 <= stindex + step - 1) {\n                        return _this.error.r;\n                    }\n                    if (r1 > stindex + step - 1) {\n                        r1 -= step;\n                    } else if (r1 >= stindex) {\n                        r1 = stindex;\n                    }\n                    if (r2 > stindex + step - 1) {\n                        r2 -= step;\n                    } else if (r2 >= stindex) {\n                        r2 = stindex - 1;\n                    }\n                    if (r1 < 0) {\n                        r1 = 0;\n                    }\n                    if (r2 < r1) {\n                        r2 = r1;\n                    }\n                } else if (rc == 'col') {\n                    if (c1 >= stindex && c2 <= stindex + step - 1) {\n                        return _this.error.r;\n                    }\n                    if (c1 > stindex + step - 1) {\n                        c1 -= step;\n                    } else if (c1 >= stindex) {\n                        c1 = stindex;\n                    }\n                    if (c2 > stindex + step - 1) {\n                        c2 -= step;\n                    } else if (c2 >= stindex) {\n                        c2 = stindex - 1;\n                    }\n                    if (c1 < 0) {\n                        c1 = 0;\n                    }\n                    if (c2 < c1) {\n                        c2 = c1;\n                    }\n                }\n                if (r1 == r2 && c1 == c2) {\n                    if (!isNaN(r1) && !isNaN(c1)) {\n                        return prefix + $col0 + chatatABC(c1) + $row0 + (r1 + 1);\n                    } else if (!isNaN(r1)) {\n                        return prefix + $row0 + (r1 + 1);\n                    } else if (!isNaN(c1)) {\n                        return prefix + $col0 + chatatABC(c1);\n                    } else {\n                        return txt;\n                    }\n                } else {\n                    if (isNaN(c1) && isNaN(c2)) {\n                        return prefix + $row0 + (r1 + 1) + ':' + $row1 + (r2 + 1);\n                    } else if (isNaN(r1) && isNaN(r2)) {\n                        return prefix + $col0 + chatatABC(c1) + ':' + $col1 + chatatABC(c2);\n                    } else {\n                        return prefix + $col0 + chatatABC(c1) + $row0 + (r1 + 1) + ':' + $col1 + chatatABC(c2) + $row1 + (r2 + 1);\n                    }\n                }\n            } else if (type == 'add') {\n                if (rc == 'row') {\n                    if (orient == 'lefttop') {\n                        if (r1 >= stindex) {\n                            r1 += step;\n                        }\n                        if (r2 >= stindex) {\n                            r2 += step;\n                        }\n                    } else if (orient == 'rightbottom') {\n                        if (r1 > stindex) {\n                            r1 += step;\n                        }\n                        if (r2 > stindex) {\n                            r2 += step;\n                        }\n                    }\n                } else if (rc == 'col') {\n                    if (orient == 'lefttop') {\n                        if (c1 >= stindex) {\n                            c1 += step;\n                        }\n                        if (c2 >= stindex) {\n                            c2 += step;\n                        }\n                    } else if (orient == 'rightbottom') {\n                        if (c1 > stindex) {\n                            c1 += step;\n                        }\n                        if (c2 > stindex) {\n                            c2 += step;\n                        }\n                    }\n                }\n                if (r1 == r2 && c1 == c2) {\n                    if (!isNaN(r1) && !isNaN(c1)) {\n                        return prefix + $col0 + chatatABC(c1) + $row0 + (r1 + 1);\n                    } else if (!isNaN(r1)) {\n                        return prefix + $row0 + (r1 + 1);\n                    } else if (!isNaN(c1)) {\n                        return prefix + $col0 + chatatABC(c1);\n                    } else {\n                        return txt;\n                    }\n                } else {\n                    if (isNaN(c1) && isNaN(c2)) {\n                        return prefix + $row0 + (r1 + 1) + ':' + $row1 + (r2 + 1);\n                    } else if (isNaN(r1) && isNaN(r2)) {\n                        return prefix + $col0 + chatatABC(c1) + ':' + $col1 + chatatABC(c2);\n                    } else {\n                        return prefix + $col0 + chatatABC(c1) + $row0 + (r1 + 1) + ':' + $col1 + chatatABC(c2) + $row1 + (r2 + 1);\n                    }\n                }\n            }\n        },\n        israngeseleciton: function (istooltip) {\n            let _this = this;\n            if (_this.operatorjson == null) {\n                let arr = _this.operator.split('|'), op = {};\n                for (let i = 0; i < arr.length; i++) {\n                    op[arr[i].toString()] = 1;\n                }\n                _this.operatorjson = op;\n            }\n            if (istooltip == null) {\n                istooltip = false;\n            }\n            let currSelection = window.getSelection();\n            let anchor = $(currSelection.anchorNode);\n            let anchorOffset = currSelection.anchorOffset;\n            if (anchor.parent().is('span') && anchorOffset != 0) {\n                let txt = $.trim(anchor.text()), lasttxt = '';\n                if (txt.length == 0 && anchor.parent().prev().length > 0) {\n                    let ahr = anchor.parent().prev();\n                    txt = $.trim(ahr.text());\n                    lasttxt = txt.substr(txt.length - 1, 1);\n                    _this.rangeSetValueTo = ahr;\n                } else {\n                    lasttxt = txt.substr(anchorOffset - 1, 1);\n                    _this.rangeSetValueTo = anchor.parent();\n                }\n                if (istooltip && (lasttxt == '(' || lasttxt == ',') || !istooltip && (lasttxt == '(' || lasttxt == ',' || lasttxt == '=' || lasttxt in _this.operatorjson || lasttxt == '&')) {\n                    return true;\n                }\n            } else if (anchor.is('#luckysheet-rich-text-editor') || anchor.is('#luckysheet-functionbox-cell')) {\n                let txt = $.trim(anchor.find('span').last().text()), lasttxt;\n                _this.rangeSetValueTo = anchor.find('span').last();\n                if (txt.length == 0 && anchor.find('span').length > 1) {\n                    let ahr = anchor.find('span');\n                    txt = $.trim(ahr.eq(ahr.length - 2).text());\n                    _this.rangeSetValueTo = ahr;\n                }\n                lasttxt = txt.substr(txt.length - 1, 1);\n                if (istooltip && (lasttxt == '(' || lasttxt == ',') || !istooltip && (lasttxt == '(' || lasttxt == ',' || lasttxt == '=' || lasttxt in _this.operatorjson || lasttxt == '&')) {\n                    return true;\n                }\n            } else if (anchor.parent().is('#luckysheet-rich-text-editor') || anchor.parent().is('#luckysheet-functionbox-cell') || anchorOffset == 0) {\n                if (anchorOffset == 0) {\n                    anchor = anchor.parent();\n                }\n                if (anchor.prev().length > 0) {\n                    let txt = $.trim(anchor.prev().text());\n                    let lasttxt = txt.substr(txt.length - 1, 1);\n                    _this.rangeSetValueTo = anchor.prev();\n                    if (istooltip && (lasttxt == '(' || lasttxt == ',') || !istooltip && (lasttxt == '(' || lasttxt == ',' || lasttxt == '=' || lasttxt in _this.operatorjson || lasttxt == '&')) {\n                        return true;\n                    }\n                }\n            }\n            return false;\n        },\n        rangechangeindex: null,\n        rangestart: false,\n        rangetosheet: null,\n        rangeSetValueTo: null,\n        func_selectedrange: {},\n        //函数选区范围\n        rangeSetValue: function (selected, obj) {\n            let _this = this;\n            let range = '', rf = selected['row'][0], cf = selected['column'][0];\n            if (Store.config['merge'] != null && rf + '_' + cf in Store.config['merge']) {\n                range = getRangetxt(Store.currentSheetIndex, {\n                    column: [\n                        cf,\n                        cf\n                    ],\n                    row: [\n                        rf,\n                        rf\n                    ]\n                }, _this.rangetosheet);\n            } else {\n                range = getRangetxt(Store.currentSheetIndex, selected, _this.rangetosheet);\n            }\n            let $editor;\n            if (_this.rangestart || _this.rangedrag_column_start || _this.rangedrag_row_start) {\n                if ($('#luckysheet-search-formula-parm').is(':visible') || $('#luckysheet-search-formula-parm-select').is(':visible')) {\n                    //公式参数框选取范围\n                    $editor = $('#luckysheet-rich-text-editor');\n                    $('#luckysheet-search-formula-parm-select-input').val(range);\n                    $('#luckysheet-search-formula-parm .parmBox').eq(_this.data_parm_index).find('.txt input').val(range);    //参数对应值显示\n                    //参数对应值显示\n                    let txtdata = luckysheet_getcelldata(range).data;\n                    if (txtdata instanceof Array) {\n                        //参数为多个单元格选区\n                        let txtArr = [];\n                        for (let i = 0; i < txtdata.length; i++) {\n                            for (let j = 0; j < txtdata[i].length; j++) {\n                                if (txtdata[i][j] == null) {\n                                    txtArr.push(null);\n                                } else {\n                                    txtArr.push(txtdata[i][j].v);\n                                }\n                            }\n                        }\n                        $('#luckysheet-search-formula-parm .parmBox').eq(_this.data_parm_index).find('.val').text(' = {' + txtArr.join(',') + '}');\n                    } else {\n                        //参数为单个单元格选区\n                        $('#luckysheet-search-formula-parm .parmBox').eq(_this.data_parm_index).find('.val').text(' = {' + txtdata.v + '}');\n                    }    //计算结果显示\n                    //计算结果显示\n                    let isVal = true;    //参数不为空\n                    //参数不为空\n                    let parmValArr = [];    //参数值集合\n                    //参数值集合\n                    let lvi = -1;    //最后一个有值的参数索引\n                    //最后一个有值的参数索引\n                    $('#luckysheet-search-formula-parm .parmBox').each(function (i, e) {\n                        let parmtxt = $(e).find('.txt input').val();\n                        if (parmtxt == '' && $(e).find('.txt input').attr('data_parm_require') == 'm') {\n                            isVal = false;\n                        }\n                        if (parmtxt != '') {\n                            lvi = i;\n                        }\n                    });    //单元格显示\n                    //单元格显示\n                    let functionHtmlTxt;\n                    if (lvi == -1) {\n                        functionHtmlTxt = '=' + $('#luckysheet-search-formula-parm .luckysheet-modal-dialog-title-text').text() + '()';\n                    } else if (lvi == 0) {\n                        functionHtmlTxt = '=' + $('#luckysheet-search-formula-parm .luckysheet-modal-dialog-title-text').text() + '(' + $('#luckysheet-search-formula-parm .parmBox').eq(0).find('.txt input').val() + ')';\n                    } else {\n                        for (let j = 0; j <= lvi; j++) {\n                            parmValArr.push($('#luckysheet-search-formula-parm .parmBox').eq(j).find('.txt input').val());\n                        }\n                        functionHtmlTxt = '=' + $('#luckysheet-search-formula-parm .luckysheet-modal-dialog-title-text').text() + '(' + parmValArr.join(',') + ')';\n                    }\n                    let function_str = _this.functionHTMLGenerate(functionHtmlTxt);\n                    $('#luckysheet-rich-text-editor').html(function_str);\n                    $('#luckysheet-functionbox-cell').html($('#luckysheet-rich-text-editor').html());\n                    if (isVal) {\n                        //公式计算\n                        let fp = $.trim(_this.functionParserExe($('#luckysheet-rich-text-editor').text()));\n                        let result = new Function('return ' + fp)();\n                        $('#luckysheet-search-formula-parm .result span').text(result);\n                    }\n                } else {\n                    let currSelection = window.getSelection();\n                    let anchorOffset = currSelection.anchorNode;\n                    $editor = $(anchorOffset).closest('div');\n                    let $span = $editor.find(\"span[rangeindex='\" + _this.rangechangeindex + \"']\").html(range);\n                    _this.setCaretPosition($span.get(0), 0, range.length);\n                }\n            } else {\n                let function_str = '<span class=\"luckysheet-formula-functionrange-cell\" rangeindex=\"' + _this.functionHTMLIndex + '\" dir=\"auto\" style=\"color:' + luckyColor[_this.functionHTMLIndex] + ';\">' + range + '</span>';\n                let $t = $(function_str).insertAfter(_this.rangeSetValueTo);\n                _this.rangechangeindex = _this.functionHTMLIndex;\n                $editor = $(_this.rangeSetValueTo).closest('div');\n                _this.setCaretPosition($editor.find(\"span[rangeindex='\" + _this.rangechangeindex + \"']\").get(0), 0, range.length);\n                _this.functionHTMLIndex++;\n            }\n            if ($editor.attr('id') == 'luckysheet-rich-text-editor') {\n                $('#luckysheet-functionbox-cell').html($('#luckysheet-rich-text-editor').html());\n            } else {\n                $('#luckysheet-rich-text-editor').html($('#luckysheet-functionbox-cell').html());\n            }\n        },\n        rangedrag: function (event) {\n            let _this = this;\n            let mouse = mouseposition(event.pageX, event.pageY);\n            let x = mouse[0] + $('#luckysheet-cell-main').scrollLeft();\n            let y = mouse[1] + $('#luckysheet-cell-main').scrollTop();\n            let row_location = rowLocation(y), row = row_location[1], row_pre = row_location[0], row_index = row_location[2];\n            let col_location = colLocation(x), col = col_location[1], col_pre = col_location[0], col_index = col_location[2];\n            let top = 0, height = 0, rowseleted = [];\n            if (_this.func_selectedrange.top > row_pre) {\n                top = row_pre;\n                height = _this.func_selectedrange.top + _this.func_selectedrange.height - row_pre;\n                rowseleted = [\n                    row_index,\n                    _this.func_selectedrange.row[1]\n                ];\n            } else if (_this.func_selectedrange.top == row_pre) {\n                top = row_pre;\n                height = _this.func_selectedrange.top + _this.func_selectedrange.height - row_pre;\n                rowseleted = [\n                    row_index,\n                    _this.func_selectedrange.row[0]\n                ];\n            } else {\n                top = _this.func_selectedrange.top;\n                height = row - _this.func_selectedrange.top - 1;\n                rowseleted = [\n                    _this.func_selectedrange.row[0],\n                    row_index\n                ];\n            }\n            let left = 0, width = 0, columnseleted = [];\n            if (_this.func_selectedrange.left > col_pre) {\n                left = col_pre;\n                width = _this.func_selectedrange.left + _this.func_selectedrange.width - col_pre;\n                columnseleted = [\n                    col_index,\n                    _this.func_selectedrange.column[1]\n                ];\n            } else if (_this.func_selectedrange.left == col_pre) {\n                left = col_pre;\n                width = _this.func_selectedrange.left + _this.func_selectedrange.width - col_pre;\n                columnseleted = [\n                    col_index,\n                    _this.func_selectedrange.column[0]\n                ];\n            } else {\n                left = _this.func_selectedrange.left;\n                width = col - _this.func_selectedrange.left - 1;\n                columnseleted = [\n                    _this.func_selectedrange.column[0],\n                    col_index\n                ];\n            }\n            rowseleted[0] = luckysheetFreezen.changeFreezenIndex(rowseleted[0], 'h');\n            rowseleted[1] = luckysheetFreezen.changeFreezenIndex(rowseleted[1], 'h');\n            columnseleted[0] = luckysheetFreezen.changeFreezenIndex(columnseleted[0], 'v');\n            columnseleted[1] = luckysheetFreezen.changeFreezenIndex(columnseleted[1], 'v');\n            let changeparam = cells.mergeMoveMain(columnseleted, rowseleted, _this.func_selectedrange, top, height, left, width);\n            if (changeparam != null) {\n                columnseleted = changeparam[0];\n                rowseleted = changeparam[1];\n                top = changeparam[2];\n                height = changeparam[3];\n                left = changeparam[4];\n                width = changeparam[5];\n            }\n            _this.func_selectedrange['row'] = rowseleted;\n            _this.func_selectedrange['column'] = columnseleted;\n            _this.func_selectedrange['left_move'] = left;\n            _this.func_selectedrange['width_move'] = width;\n            _this.func_selectedrange['top_move'] = top;\n            _this.func_selectedrange['height_move'] = height;\n            luckysheet_count_show(left, top, width, height, rowseleted, columnseleted);\n            $('#luckysheet-formula-functionrange-select').css({\n                'left': left,\n                'width': width,\n                'top': top,\n                'height': height\n            }).show();\n            if ($('#luckysheet-ifFormulaGenerator-multiRange-dialog').is(':visible')) {\n                //if公式生成器 选择范围\n                let range = getRangetxt(Store.currentSheetIndex, {\n                    'row': rowseleted,\n                    'column': columnseleted\n                }, Store.currentSheetIndex);\n                $('#luckysheet-ifFormulaGenerator-multiRange-dialog input').val(range);\n            } else {\n                _this.rangeSetValue({\n                    'row': rowseleted,\n                    'column': columnseleted\n                });\n            }\n            luckysheetFreezen.scrollFreezen(rowseleted, columnseleted); //TODO\n        },\n        rangedrag_column_start: false,\n        rangedrag_row_start: false,\n        rangedrag_column: function (event) {\n            let _this = this;\n            let mouse = mouseposition(event.pageX, event.pageY);\n            let x = mouse[0] + $('#luckysheet-cell-main').scrollLeft();\n            let y = mouse[1] + $('#luckysheet-cell-main').scrollTop();\n            let visibledatarow = Store.visibledatarow;\n            let row_index = visibledatarow.length - 1, row = visibledatarow[row_index], row_pre = 0;\n            let col_location = colLocation(x), col = col_location[1], col_pre = col_location[0], col_index = col_location[2];\n            let left = 0, width = 0, columnseleted = [];\n            if (_this.func_selectedrange.left > col_pre) {\n                left = col_pre;\n                width = _this.func_selectedrange.left + _this.func_selectedrange.width - col_pre;\n                columnseleted = [\n                    col_index,\n                    _this.func_selectedrange.column[1]\n                ];\n            } else if (_this.func_selectedrange.left == col_pre) {\n                left = col_pre;\n                width = _this.func_selectedrange.left + _this.func_selectedrange.width - col_pre;\n                columnseleted = [\n                    col_index,\n                    _this.func_selectedrange.column[0]\n                ];\n            } else {\n                left = _this.func_selectedrange.left;\n                width = col - _this.func_selectedrange.left - 1;\n                columnseleted = [\n                    _this.func_selectedrange.column[0],\n                    col_index\n                ];\n            }    //rowseleted[0] = luckysheetFreezen.changeFreezenIndex(rowseleted[0], \"h\");\n                 //rowseleted[1] = luckysheetFreezen.changeFreezenIndex(rowseleted[1], \"h\");\n            //rowseleted[0] = luckysheetFreezen.changeFreezenIndex(rowseleted[0], \"h\");\n            //rowseleted[1] = luckysheetFreezen.changeFreezenIndex(rowseleted[1], \"h\");\n            columnseleted[0] = luckysheetFreezen.changeFreezenIndex(columnseleted[0], 'v');\n            columnseleted[1] = luckysheetFreezen.changeFreezenIndex(columnseleted[1], 'v');\n            let changeparam = cells.mergeMoveMain(columnseleted, [\n                0,\n                row_index\n            ], _this.func_selectedrange, row_pre, row - row_pre - 1, left, width);\n            if (changeparam != null) {\n                columnseleted = changeparam[0];    // rowseleted= changeparam[1];\n                                                   // top = changeparam[2];\n                                                   // height = changeparam[3];\n                // rowseleted= changeparam[1];\n                // top = changeparam[2];\n                // height = changeparam[3];\n                left = changeparam[4];\n                width = changeparam[5];\n            }\n            _this.func_selectedrange['column'] = columnseleted;\n            _this.func_selectedrange['left_move'] = left;\n            _this.func_selectedrange['width_move'] = width;\n            luckysheet_count_show(left, row_pre, width, row - row_pre - 1, [\n                0,\n                row_index\n            ], columnseleted);\n            _this.rangeSetValue({\n                'row': [\n                    null,\n                    null\n                ],\n                'column': columnseleted\n            });\n            $('#luckysheet-formula-functionrange-select').css({\n                'left': left,\n                'width': width,\n                'top': row_pre,\n                'height': row - row_pre - 1\n            }).show();\n            luckysheetFreezen.scrollFreezen([\n                0,\n                row_index\n            ], columnseleted); //TODO:lwf\n        },\n        rangedrag_row: function (event) {\n            let _this = this;\n            let mouse = mouseposition(event.pageX, event.pageY);\n            let x = mouse[0] + $('#luckysheet-cell-main').scrollLeft();\n            let y = mouse[1] + $('#luckysheet-cell-main').scrollTop();\n            let row_location = rowLocation(y), row = row_location[1], row_pre = row_location[0], row_index = row_location[2];\n            let visibledatacolumn = Store.visibledatacolumn;\n            let col_index = visibledatacolumn.length - 1, col = visibledatacolumn[col_index], col_pre = 0;\n            let top = 0, height = 0, rowseleted = [];\n            if (_this.func_selectedrange.top > row_pre) {\n                top = row_pre;\n                height = _this.func_selectedrange.top + _this.func_selectedrange.height - row_pre;\n                rowseleted = [\n                    row_index,\n                    _this.func_selectedrange.row[1]\n                ];\n            } else if (_this.func_selectedrange.top == row_pre) {\n                top = row_pre;\n                height = _this.func_selectedrange.top + _this.func_selectedrange.height - row_pre;\n                rowseleted = [\n                    row_index,\n                    _this.func_selectedrange.row[0]\n                ];\n            } else {\n                top = _this.func_selectedrange.top;\n                height = row - _this.func_selectedrange.top - 1;\n                rowseleted = [\n                    _this.func_selectedrange.row[0],\n                    row_index\n                ];\n            }\n            rowseleted[0] = luckysheetFreezen.changeFreezenIndex(rowseleted[0], 'h');\n            rowseleted[1] = luckysheetFreezen.changeFreezenIndex(rowseleted[1], 'h');    // columnseleted[0] = luckysheetFreezen.changeFreezenIndex(columnseleted[0], \"v\");\n                                                                                         // columnseleted[1] = luckysheetFreezen.changeFreezenIndex(columnseleted[1], \"v\");\n            // columnseleted[0] = luckysheetFreezen.changeFreezenIndex(columnseleted[0], \"v\");\n            // columnseleted[1] = luckysheetFreezen.changeFreezenIndex(columnseleted[1], \"v\");\n            let changeparam = cells.mergeMoveMain([\n                0,\n                col_index\n            ], rowseleted, _this.func_selectedrange, top, height, col_pre, col - col_pre - 1);\n            if (changeparam != null) {\n                // columnseleted = changeparam[0];\n                rowseleted = changeparam[1];\n                top = changeparam[2];\n                height = changeparam[3];\n            }\n            // left = changeparam[4];\n            // width = changeparam[5];\n            _this.func_selectedrange['row'] = rowseleted;\n            _this.func_selectedrange['top_move'] = top;\n            _this.func_selectedrange['height_move'] = height;\n            luckysheet_count_show(col_pre, top, col - col_pre - 1, height, rowseleted, [\n                0,\n                col_index\n            ]);\n            _this.rangeSetValue({\n                'row': rowseleted,\n                'column': [\n                    null,\n                    null\n                ]\n            });\n            $('#luckysheet-formula-functionrange-select').css({\n                'left': col_pre,\n                'width': col - col_pre - 1,\n                'top': top,\n                'height': height\n            }).show();\n            luckysheetFreezen.scrollFreezen(rowseleted, [\n                0,\n                col_index\n            ]); //TODO:lwf\n        },\n        rangedragged: function () {\n        },\n        rangeResizeObj: null,\n        rangeResize: null,\n        rangeResizeIndex: null,\n        rangeResizexy: null,\n        rangeResizeWinH: null,\n        rangeResizeWinW: null,\n        rangeResizeTo: null,\n        rangeResizeDraging: function (event, luckysheetCurrentChartResizeObj, luckysheetCurrentChartResizeXy, luckysheetCurrentChartResize, luckysheetCurrentChartResizeWinW, luckysheetCurrentChartResizeWinH, ch_width, rh_height) {\n            let _this = this;\n            let scrollTop = $('#luckysheet-scrollbar-y').scrollTop(), scrollLeft = $('#luckysheet-scrollbar-x').scrollLeft();\n            let mouse = mouseposition(event.pageX, event.pageY);\n            let x = mouse[0] + scrollLeft;\n            let y = mouse[1] + scrollTop;\n            let row_location = rowLocation(y), row = row_location[1], row_pre = row_location[0], row_index = row_location[2];\n            let col_location = colLocation(x), col = col_location[1], col_pre = col_location[0], col_index = col_location[2];\n            if (x < 0 || y < 0) {\n                return false;\n            }\n            let topchange = row_pre - luckysheetCurrentChartResizeXy[1], leftchange = col_pre - luckysheetCurrentChartResizeXy[0];\n            let top = luckysheetCurrentChartResizeXy[5], height = luckysheetCurrentChartResizeXy[3], left = luckysheetCurrentChartResizeXy[4], width = luckysheetCurrentChartResizeXy[2];\n            if (luckysheetCurrentChartResize == 'lt' || luckysheetCurrentChartResize == 'lb') {\n                if (luckysheetCurrentChartResizeXy[0] + luckysheetCurrentChartResizeXy[2] < col_pre) {\n                    return;\n                }\n                left = col_pre;\n                width = luckysheetCurrentChartResizeXy[2] - leftchange;\n                if (left > luckysheetCurrentChartResizeXy[2] + luckysheetCurrentChartResizeXy[4] - col + col_pre) {\n                    left = luckysheetCurrentChartResizeXy[2] + luckysheetCurrentChartResizeXy[4] - col + col_pre;\n                    width = luckysheetCurrentChartResizeXy[2] - (luckysheetCurrentChartResizeXy[2] + luckysheetCurrentChartResizeXy[4] - col + col_pre - luckysheetCurrentChartResizeXy[0]);\n                } else if (left <= 0) {\n                    left = 0;\n                    width = luckysheetCurrentChartResizeXy[2] + luckysheetCurrentChartResizeXy[0];\n                }\n            }\n            if (luckysheetCurrentChartResize == 'rt' || luckysheetCurrentChartResize == 'rb') {\n                if (luckysheetCurrentChartResizeXy[6] - luckysheetCurrentChartResizeXy[2] > col) {\n                    return;\n                }\n                width = luckysheetCurrentChartResizeXy[2] + col - luckysheetCurrentChartResizeXy[6];\n                if (width < col - col_pre - 1) {\n                    width = col - col_pre - 1;\n                } else if (width >= ch_width - left) {\n                    width = ch_width - left;\n                }\n            }\n            if (luckysheetCurrentChartResize == 'lt' || luckysheetCurrentChartResize == 'rt') {\n                if (luckysheetCurrentChartResizeXy[1] + luckysheetCurrentChartResizeXy[3] < row_pre) {\n                    return;\n                }\n                top = row_pre;\n                height = luckysheetCurrentChartResizeXy[3] - topchange;\n                if (top > luckysheetCurrentChartResizeXy[3] + luckysheetCurrentChartResizeXy[5] - row + row_pre) {\n                    top = luckysheetCurrentChartResizeXy[3] + luckysheetCurrentChartResizeXy[5] - row + row_pre;\n                    height = luckysheetCurrentChartResizeXy[3] - (luckysheetCurrentChartResizeXy[3] + luckysheetCurrentChartResizeXy[5] - row + row_pre - luckysheetCurrentChartResizeXy[1]);\n                } else if (top <= 0) {\n                    top = 0;\n                    height = luckysheetCurrentChartResizeXy[3] + luckysheetCurrentChartResizeXy[1];\n                }\n            }\n            if (luckysheetCurrentChartResize == 'lb' || luckysheetCurrentChartResize == 'rb') {\n                if (luckysheetCurrentChartResizeXy[7] - luckysheetCurrentChartResizeXy[3] > row) {\n                    return;\n                }\n                height = luckysheetCurrentChartResizeXy[3] + row - luckysheetCurrentChartResizeXy[7];\n                if (height < row - row_pre - 1) {\n                    height = row - row_pre - 1;\n                } else if (height >= rh_height - top) {\n                    height = rh_height - top;\n                }\n            }\n            let rangeindex = _this.rangeResizeIndex;\n            let selected = {\n                'top': top,\n                'left': left,\n                'height': height,\n                'width': width\n            };\n            let range = _this.getSelectedFromRange(selected);\n            let rangetxt = getRangetxt(Store.currentSheetIndex, range, _this.rangetosheet);\n            let $span = _this.rangeResizeTo.find(\"span[rangeindex='\" + rangeindex + \"']\").html(rangetxt);\n            luckysheetRangeLast(_this.rangeResizeTo[0]);\n            luckysheetCurrentChartResizeObj.css(selected).data('range', range);\n        },\n        getSelectedFromRange: function (obj) {\n            let row_st = obj.top + 2, row_ed = obj.top + obj.height - 2;\n            let col_st = obj.left + 2, col_ed = obj.left + obj.width - 2;\n            let ret = {\n                'row': [\n                    rowLocation(row_st)[2],\n                    rowLocation(row_ed)[2]\n                ],\n                'column': [\n                    colLocation(col_st)[2],\n                    colLocation(col_ed)[2]\n                ]\n            };\n            return ret;\n        },\n        rangeResizeDragged: function (event, luckysheetCurrentChartResizeObj, luckysheetCurrentChartResizeXy, luckysheetCurrentChartResize, luckysheetCurrentChartResizeWinW, luckysheetCurrentChartResizeWinH) {\n            let _this = this;\n            _this.rangeResize = null;\n            $('#luckysheet-formula-functionrange-highlight-' + _this.rangeResizeIndex).find('.luckysheet-selection-copy-hc').css('opacity', 0.03);\n        },\n        rangeMovexy: null,\n        rangeMove: false,\n        rangeMoveObj: null,\n        rangeMoveIndex: null,\n        rangeMoveRangedata: null,\n        rangeMoveDraging: function (event, luckysheet_cell_selected_move_index, luckysheet_select_save, obj, sheetBarHeight, statisticBarHeight) {\n            let _this = this;\n            let mouse = mouseposition(event.pageX, event.pageY);\n            let scrollLeft = $('#luckysheet-scrollbar-x').scrollLeft();\n            let scrollTop = $('#luckysheet-scrollbar-y').scrollTop();\n            let x = mouse[0] + scrollLeft;\n            let y = mouse[1] + scrollTop;\n            let winH = $(window).height() + scrollTop - sheetBarHeight - statisticBarHeight, winW = $(window).width() + scrollLeft;\n            let row_index_original = luckysheet_cell_selected_move_index[0], col_index_original = luckysheet_cell_selected_move_index[1];\n            let row_s = luckysheet_select_save['row'][0] - row_index_original + rowLocation(y)[2], row_e = luckysheet_select_save['row'][1] - row_index_original + rowLocation(y)[2];\n            let col_s = luckysheet_select_save['column'][0] - col_index_original + colLocation(x)[2], col_e = luckysheet_select_save['column'][1] - col_index_original + colLocation(x)[2];\n            if (row_s < 0 || y < 0) {\n                row_s = 0;\n                row_e = luckysheet_select_save['row'][1] - luckysheet_select_save['row'][0];\n            }\n            if (col_s < 0 || x < 0) {\n                col_s = 0;\n                col_e = luckysheet_select_save['column'][1] - luckysheet_select_save['column'][0];\n            }\n            let visibledatarow = Store.visibledatarow;\n            if (row_e >= visibledatarow[visibledatarow.length - 1] || y > winH) {\n                row_s = visibledatarow.length - 1 - luckysheet_select_save['row'][1] + luckysheet_select_save['row'][0];\n                row_e = visibledatarow.length - 1;\n            }\n            let visibledatacolumn = Store.visibledatacolumn;\n            if (col_e >= visibledatacolumn[visibledatacolumn.length - 1] || x > winW) {\n                col_s = visibledatacolumn.length - 1 - luckysheet_select_save['column'][1] + luckysheet_select_save['column'][0];\n                col_e = visibledatacolumn.length - 1;\n            }\n            let col_pre = col_s - 1 == -1 ? 0 : visibledatacolumn[col_s - 1], col = visibledatacolumn[col_e];\n            let row_pre = row_s - 1 == -1 ? 0 : visibledatarow[row_s - 1], row = visibledatarow[row_e];\n            let rangeindex = _this.rangeMoveIndex;\n            let selected = {\n                'left': col_pre,\n                'width': col - col_pre - 2,\n                'top': row_pre,\n                'height': row - row_pre - 2,\n                'display': 'block'\n            };\n            let range = _this.getSelectedFromRange(selected);\n            let rangetxt = getRangetxt(Store.currentSheetIndex, range, _this.rangetosheet);\n            let $span = _this.rangeResizeTo.find(\"span[rangeindex='\" + rangeindex + \"']\").html(rangetxt);\n            luckysheetRangeLast(_this.rangeResizeTo[0]);\n            _this.rangeMoveRangedata = range;\n            obj.css(selected);\n        },\n        rangeMoveDragged: function (obj) {\n            let _this = this;\n            _this.rangeMove = false;\n            $('#luckysheet-formula-functionrange-highlight-' + _this.rangeMoveIndex).data('range', _this.rangeMoveRangedata).find('.luckysheet-selection-copy-hc').css('opacity', 0.03);\n        },\n        functionHTMLIndex: 0,\n        functionRangeIndex: null,\n        findrangeindex: function (v, vp) {\n            let _this = this;\n            let re = /<span.*?>/g;\n            let v_a = v.replace(re, ''), vp_a = vp.replace(re, '');\n            v_a = v_a.split('</span>');\n            vp_a = vp_a.split('</span>');\n            v_a.pop();\n            vp_a.pop();\n            let pfri = _this.functionRangeIndex;\n            let i = 0;\n            let spanlen = vp_a.length > v_a.length ? v_a.length : vp_a.length;\n            let vplen = vp_a.length, vlen = v_a.length;    //不增加元素输入\n            //不增加元素输入\n            if (vplen == vlen) {\n                let i = pfri[0];\n                let p = vp_a[i], n = v_a[i];\n                if (p == null) {\n                    if (vp_a.length <= i) {\n                        pfri = [\n                            vp_a.length - 1,\n                            vp_a.length - 1\n                        ];\n                    } else if (v_a.length <= i) {\n                        pfri = [\n                            v_a.length - 1,\n                            v_a.length - 1\n                        ];\n                    }\n                    return pfri;\n                } else if (p.length == n.length) {\n                    if (vp_a[i + 1] != null && v_a[i + 1] != null && vp_a[i + 1].length < v_a[i + 1].length) {\n                        pfri[0] = pfri[0] + 1;\n                        pfri[1] = 1;\n                    }\n                    return pfri;\n                } else if (p.length > n.length) {\n                    if (p != null && v_a[i + 1] != null && v_a[i + 1].substr(0, 1) == '\"' && (p.indexOf('{') > -1 || p.indexOf('}') > -1)) {\n                        pfri[0] = pfri[0] + 1;\n                        pfri[1] = 1;\n                    }\n                    return pfri;\n                } else if (p.length < n.length) {\n                    if (pfri[1] > n.length) {\n                        pfri[1] = n.length;\n                    }\n                    return pfri;\n                }\n            }    //减少元素输入\n            else //减少元素输入\n            if (vplen > vlen) {\n                let i = pfri[0];\n                let p = vp_a[i], n = v_a[i];\n                if (n == null) {\n                    if (v_a[i - 1].indexOf('{') > -1) {\n                        pfri[0] = pfri[0] - 1;\n                        let start = v_a[i - 1].search('{');\n                        pfri[1] = pfri[1] + start;\n                    } else {\n                        pfri[0] = 0;\n                        pfri[1] = 0;\n                    }\n                } else if (p.length == n.length) {\n                    if (v_a[i + 1] != null && (v_a[i + 1].substr(0, 1) == '\"' || v_a[i + 1].substr(0, 1) == '{' || v_a[i + 1].substr(0, 1) == '}')) {\n                        pfri[0] = pfri[0] + 1;\n                        pfri[1] = 1;\n                    } else if (p != null && p.length > 2 && p.substr(0, 1) == '\"' && p.substr(p.length - 1, 1) == '\"') {\n                    } else if (v_a[i] != null && v_a[i] == '\")') {\n                        pfri[1] = 1;\n                    } else if (v_a[i] != null && v_a[i] == '\"}') {\n                        pfri[1] = 1;\n                    } else if (v_a[i] != null && v_a[i] == '{)') {\n                        pfri[1] = 1;\n                    } else {\n                        pfri[1] = n.length;\n                    }\n                    return pfri;\n                } else if (p.length > n.length) {\n                    if (v_a[i + 1] != null && (v_a[i + 1].substr(0, 1) == '\"' || v_a[i + 1].substr(0, 1) == '{' || v_a[i + 1].substr(0, 1) == '}')) {\n                        pfri[0] = pfri[0] + 1;\n                        pfri[1] = 1;\n                    }\n                    return pfri;\n                } else if (p.length < n.length) {\n                    return pfri;\n                }\n                return pfri;\n            }    //增加元素输入\n            else //增加元素输入\n            if (vplen < vlen) {\n                let i = pfri[0];\n                let p = vp_a[i], n = v_a[i];\n                if (p == null) {\n                    pfri[0] = v_a.length - 1;\n                    if (n != null) {\n                        pfri[1] = n.length;\n                    } else {\n                        pfri[1] = 1;\n                    }\n                } else if (p.length == n.length) {\n                    if (vp_a[i + 1] != null && (vp_a[i + 1].substr(0, 1) == '\"' || vp_a[i + 1].substr(0, 1) == '{' || vp_a[i + 1].substr(0, 1) == '}')) {\n                        pfri[1] = n.length;\n                    } else if (v_a[i + 1] != null && v_a[i + 1].substr(0, 1) == '\"' && (v_a[i + 1].substr(0, 1) == '{' || v_a[i + 1].substr(0, 1) == '}')) {\n                        pfri[0] = pfri[0] + 1;\n                        pfri[1] = 1;\n                    } else if (n != null && n.substr(0, 1) == '\"' && n.substr(n.length - 1, 1) == '\"' && p.substr(0, 1) == '\"' && p.substr(p.length - 1, 1) == ')') {\n                        pfri[1] = n.length;\n                    } else if (n != null && n.substr(0, 1) == '{' && n.substr(n.length - 1, 1) == '}' && p.substr(0, 1) == '{' && p.substr(p.length - 1, 1) == ')') {\n                        pfri[1] = n.length;\n                    } else {\n                        pfri[0] = pfri[0] + vlen - vplen;\n                        if (v_a.length > vp_a.length) {\n                            pfri[1] = v_a[i + 1].length;\n                        } else {\n                            pfri[1] = 1;\n                        }\n                    }\n                    return pfri;\n                } else if (p.length > n.length) {\n                    if (p != null && p.substr(0, 1) == '\"') {\n                        pfri[1] = n.length;\n                    } else if (v_a[i + 1] != null && /{.*?}/.test(v_a[i + 1])) {\n                        pfri[0] = pfri[0] + 1;\n                        pfri[1] = v_a[i + 1].length;\n                    } else if (p != null && v_a[i + 1].substr(0, 1) == '\"' && (p.indexOf('{') > -1 || p.indexOf('}') > -1)) {\n                        pfri[0] = pfri[0] + 1;\n                        pfri[1] = 1;\n                    } else if (p != null && (p.indexOf('{') > -1 || p.indexOf('}') > -1)) {\n                    } else {\n                        pfri[0] = pfri[0] + vlen - vplen - 1;\n                        pfri[1] = v_a[i - 1].length;\n                    }\n                    return pfri;\n                } else if (p.length < n.length) {\n                    return pfri;\n                }\n                return pfri;\n            }\n            return null;\n        },\n        setCaretPosition: function (textDom, children, pos) {\n            return setCaretPosition(textDom,children,pos);\n        },\n        functionRange: function (obj, v, vp) {\n            let _this = this;\n            if (window.getSelection) {\n                //ie11 10 9 ff safari\n                let currSelection = window.getSelection();\n                let fri = _this.findrangeindex(v, vp);\n                if (fri == null) {\n                    currSelection.selectAllChildren(obj.get(0));\n                    currSelection.collapseToEnd();\n                } else {\n                    _this.setCaretPosition(obj.find('span').get(fri[0]), 0, fri[1]);\n                }\n            } else if (document.selection) {\n                //ie10 9 8 7 6 5\n                _this.functionRangeIndex.moveToElementText(obj);    //range定位到obj\n                //range定位到obj\n                _this.functionRangeIndex.collapse(false);    //光标移至最后\n                //光标移至最后\n                _this.functionRangeIndex.select();\n            }\n        },\n        functionInputHanddler: function ($to, $input, kcode) {\n            if (isEditMode()) {\n                //此模式下禁用公式栏\n                return;\n            }\n            let _this = this;\n            let $copy = $to, $editer = $input;\n            let value1 = $editer.html(), value1txt = $editer.text();\n            setTimeout(function () {\n                let value = $editer.text(), valuetxt = value;\n                if (value.length > 0 && value.substr(0, 1) == '=' && (kcode != 229 || value.length == 1)) {\n                    value = _this.functionHTMLGenerate(value);\n                    value1 = _this.functionHTMLGenerate(value1txt);\n                    if (window.getSelection) {\n                        // all browsers, except IE before version 9\n                        let currSelection = window.getSelection();\n                        if ($(currSelection.anchorNode).is('div')) {\n                            let editorlen = $('#luckysheet-rich-text-editor span').length;\n                            _this.functionRangeIndex = [\n                                editorlen - 1,\n                                $('#luckysheet-rich-text-editor').find('span').eq(editorlen - 1).text().length\n                            ];\n                        } else {\n                            _this.functionRangeIndex = [\n                                $(currSelection.anchorNode).parent().index(),\n                                currSelection.anchorOffset\n                            ];\n                        }\n                    } else {\n                        // Internet Explorer before version 9\n                        let textRange = document.selection.createRange();\n                        _this.functionRangeIndex = textRange;\n                    }\n                    $editer.html(value);\n                    _this.functionRange($editer, value, value1);\n                    _this.canceFunctionrangeSelected();\n                    if (kcode != 46) {\n                        //delete不执行此函数\n                        _this.createRangeHightlight();\n                    }\n                    $copy.html(value);\n                    _this.rangestart = false;\n                    _this.rangedrag_column_start = false;\n                    _this.rangedrag_row_start = false;\n                    _this.rangeHightlightselected($editer, kcode);\n                } else if (value1txt.substr(0, 1) != '=') {\n                    //&& value1.indexOf(\"span\")>-1\n                    // $editer.html(value1);\n                    // let w = window.getSelection();\n                    // if(w!=null && w.type!=\"None\"){\n                    //     let range = w.getRangeAt(0);\n                    //     let c = range.startContainer;\n                    //     if(c.id==\"luckysheet-rich-text-editor\" || $(c).closest(\"#luckysheet-rich-text-editor\")){\n                    //         $functionbox.html(value);\n                    //     }\n                    //     else if(c.id==\"luckysheet-functionbox-cell\" || $(c).closest(\"#luckysheet-functionbox-cell\")){\n                    //         if(value1.indexOf(\"span\")>-1){\n                    //         }\n                    //         else{\n                    //             $editer.html(value);\n                    //         }\n                    //     }\n                    // }\n                    // console.trace();\n                    // console.log(value, $copy.attr(\"id\"));\n                    if ($copy.attr('id') == 'luckysheet-rich-text-editor') {\n                        if ($copy.html().substr(0, 5) == '<span') {\n                        } else {\n                            $copy.html(value);\n                        }\n                    } else {\n                        $copy.html(value);\n                    }\n                }\n            }, 1);\n        },\n        functionHTMLGenerate: function (txt) {\n            let _this = this;\n            if (txt.length == 0 || txt.substr(0, 1) != '=') {\n                return txt;\n            }\n            _this.functionHTMLIndex = 0;\n            return '<span dir=\"auto\" class=\"luckysheet-formula-text-color\">=</span>' + _this.functionHTML(txt);\n        },\n        functionHTML: function (txt) {\n            let _this = this;\n            if (_this.operatorjson == null) {\n                let arr = _this.operator.split('|'), op = {};\n                for (let i = 0; i < arr.length; i++) {\n                    op[arr[i].toString()] = 1;\n                }\n                _this.operatorjson = op;\n            }\n            if (txt.substr(0, 1) == '=') {\n                txt = txt.substr(1);\n            }\n            let funcstack = txt.split('');\n            let i = 0, str = '', function_str = '', ispassby = true;\n            let matchConfig = {\n                'bracket': 0,\n                'comma': 0,\n                'squote': 0,\n                'dquote': 0,\n                'braces': 0\n            };\n            while (i < funcstack.length) {\n                let s = funcstack[i];\n                if (s == '(' && matchConfig.squote == 0 && matchConfig.dquote == 0 && matchConfig.braces == 0) {\n                    matchConfig.bracket += 1;\n                    if (str.length > 0) {\n                        function_str += '<span dir=\"auto\" class=\"luckysheet-formula-text-func\">' + str + '</span><span dir=\"auto\" class=\"luckysheet-formula-text-lpar\">(</span>';\n                    } else {\n                        function_str += '<span dir=\"auto\" class=\"luckysheet-formula-text-lpar\">(</span>';\n                    }\n                    str = '';\n                } else if (s == ')' && matchConfig.squote == 0 && matchConfig.dquote == 0 && matchConfig.braces == 0) {\n                    matchConfig.bracket -= 1;\n                    function_str += _this.functionHTML(str) + '<span dir=\"auto\" class=\"luckysheet-formula-text-rpar\">)</span>';\n                    str = '';\n                } else if (s == '{' && matchConfig.squote == 0 && matchConfig.dquote == 0) {\n                    str += '{';\n                    matchConfig.braces += 1;\n                } else if (s == '}' && matchConfig.squote == 0 && matchConfig.dquote == 0) {\n                    str += '}';\n                    matchConfig.braces -= 1;\n                } else if (s == '\"' && matchConfig.squote == 0) {\n                    if (matchConfig.dquote > 0) {\n                        if (str.length > 0) {\n                            function_str += str + '\"</span>';\n                        } else {\n                            function_str += '\"</span>';\n                        }\n                        matchConfig.dquote -= 1;\n                        str = '';\n                    } else {\n                        matchConfig.dquote += 1;\n                        if (str.length > 0) {\n                            function_str += _this.functionHTML(str) + '<span dir=\"auto\" class=\"luckysheet-formula-text-string\">\"';\n                        } else {\n                            function_str += '<span dir=\"auto\" class=\"luckysheet-formula-text-string\">\"';\n                        }\n                        str = '';\n                    }\n                }    //修正例如输入公式='1-2'!A1时，只有2'!A1是luckysheet-formula-functionrange-cell色，'1-是黑色的问题。\n                else //修正例如输入公式='1-2'!A1时，只有2'!A1是luckysheet-formula-functionrange-cell色，'1-是黑色的问题。\n                if (s == \"'\" && matchConfig.dquote == 0) {\n                    str += \"'\";\n                    matchConfig.squote = matchConfig.squote == 0 ? 1 : 0;\n                } else if (s == ',' && matchConfig.squote == 0 && matchConfig.dquote == 0 && matchConfig.braces == 0) {\n                    //matchConfig.comma += 1;\n                    function_str += _this.functionHTML(str) + '<span dir=\"auto\" class=\"luckysheet-formula-text-comma\">,</span>';\n                    str = '';\n                } else if (s == '&' && matchConfig.squote == 0 && matchConfig.dquote == 0 && matchConfig.braces == 0) {\n                    if (str.length > 0) {\n                        function_str += _this.functionHTML(str) + '<span dir=\"auto\" class=\"luckysheet-formula-text-calc\">' + '&' + '</span>';\n                        str = '';\n                    } else {\n                        function_str += '<span dir=\"auto\" class=\"luckysheet-formula-text-calc\">' + '&' + '</span>';\n                    }\n                } else if (s in _this.operatorjson && matchConfig.squote == 0 && matchConfig.dquote == 0 && matchConfig.braces == 0) {\n                    let s_next = '';\n                    if (i + 1 < funcstack.length) {\n                        s_next = funcstack[i + 1];\n                    }\n                    let p = i - 1, s_pre = null;\n                    if (p >= 0) {\n                        do {\n                            s_pre = funcstack[p--];\n                        } while (p >= 0 && s_pre == ' ');\n                    }\n                    if (s + s_next in _this.operatorjson) {\n                        if (str.length > 0) {\n                            function_str += _this.functionHTML(str) + '<span dir=\"auto\" class=\"luckysheet-formula-text-calc\">' + s + s_next + '</span>';\n                            str = '';\n                        } else {\n                            function_str += '<span dir=\"auto\" class=\"luckysheet-formula-text-calc\">' + s + s_next + '</span>';\n                        }\n                        i++;\n                    } else if (!/[^0-9]/.test(s_next) && s == '-' && (s_pre == '(' || s_pre == null || s_pre == ',' || s_pre == ' ' || s_pre in _this.operatorjson)) {\n                        str += s;\n                    } else {\n                        if (str.length > 0) {\n                            function_str += _this.functionHTML(str) + '<span dir=\"auto\" class=\"luckysheet-formula-text-calc\">' + s + '</span>';\n                            str = '';\n                        } else {\n                            function_str += '<span dir=\"auto\" class=\"luckysheet-formula-text-calc\">' + s + '</span>';\n                        }\n                    }\n                } else {\n                    str += s;\n                }\n                if (i == funcstack.length - 1) {\n                    //function_str += str;\n                    if (_this.iscelldata($.trim(str))) {\n                        function_str += '<span class=\"luckysheet-formula-functionrange-cell\" rangeindex=\"' + _this.functionHTMLIndex + '\" dir=\"auto\" style=\"color:' + luckyColor[_this.functionHTMLIndex] + ';\">' + str + '</span>';\n                        _this.functionHTMLIndex++;\n                    } else if (matchConfig.dquote > 0) {\n                        function_str += str + '</span>';\n                    } else if (str.indexOf('</span>') == -1 && str.length > 0) {\n                        let regx = /{.*?}/;\n                        if (regx.test($.trim(str))) {\n                            let arraytxt = regx.exec(str)[0];\n                            let arraystart = str.search(regx);\n                            let alltxt = '';\n                            if (arraystart > 0) {\n                                alltxt += '<span dir=\"auto\" class=\"luckysheet-formula-text-color\">' + str.substr(0, arraystart) + '</span>';\n                            }\n                            alltxt += '<span dir=\"auto\" style=\"color:#959a05\" class=\"luckysheet-formula-text-array\">' + arraytxt + '</span>';\n                            if (arraystart + arraytxt.length < str.length) {\n                                alltxt += '<span dir=\"auto\" class=\"luckysheet-formula-text-color\">' + str.substr(arraystart + arraytxt.length, str.length) + '</span>';\n                            }\n                            function_str += alltxt;\n                        } else {\n                            function_str += '<span dir=\"auto\" class=\"luckysheet-formula-text-color\">' + str + '</span>';\n                        }\n                    }\n                }\n                i++;\n            }\n            return function_str;\n        }\n    });\n    //选择公式后参数索引标记\n    return luckysheetformula;\n});"]}