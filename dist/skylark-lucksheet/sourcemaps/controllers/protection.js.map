{"version":3,"sources":["controllers/protection.js"],"names":["define","Store","locale","m_constant","m_get","m_set","sheetmanage","luckysheetsizeauto","dataVerificationCtrl","m_util","m_select","tooltip","cleargridelement","modelHTML","getSheetIndex","setluckysheet_scroll_status","replaceHtml","transformRangeToAbsolute","openSelfModel","selectionCopyShow","isInitialProtection","isInitialProtectionAddRang","rangeItemListCache","isAddRangeItemState","updateRangeItemIndex","validationAuthority","updatingSheetFile","firstInputSheetProtectionPassword","inputRangeProtectionPassword","initialRangePasswordHtml","authorityItemArr","addRangeItem","item","_locale","local_protection","protection","locale_button","button","title","name","sqref","password","passwordTxt","length","rangeItemHasPassword","rangeItemTemplate","rangeItemDblclick","delete","update","$","append","initialProtectionRangeModal","file","id","addclass","allowRangeTitle","content","allowRangeAddTitle","allowRangeAddtitleDefault","allowRangeAddSqrf","selectCellRangeHolder","selectCellRange","allowRangeAddTitlePassword","enterPassword","allowRangeAddTitleHint","allowRangeAddTitleHintTitle","botton","insert","cancel","style","restoreProtectionConfig","aut","i","checkId","authorityValue","selectLockedCells","selectunLockedCells","prop","algorithmName","val","sheet","hintText","empty","allowRangeList","push","closeProtectionModal","hide","checkProtectionLockedSqref","r","c","isOpenAlert","isPass","rangeAut","isExists","ra","range","getRangeByTxt","s","r1","row","r2","c1","column","c2","openRangePasswordModal","ht","defaultSheetHintText","info","validationTitle","validationInputHint","confirm","$hint","html","defaultRangeHintText","$rangeV","$input","find","off","on","saltValue","hasher","CryptoApi","getHasher","hmac","hash","alert","checkPasswordSucceedalert","checkPasswordWrongalert","checkPasswordNullalert","openProtectionModal","authorityItemHtml","protectionModalHtml","protectiontTitle","close","swichProtectionTip","enterHintTitle","authorityTitle","allowRangeAdd","validationTips","initialProtectionRIghtBar","click","is","hint","config","authority","authorityData","document","e","$rangeItem","target","closest","index","splice","remove","rangeText","rangeItemErrorTitleNull","checkRangePasswordUrl","$rangeitem","eq","$name","attr","rangeItemErrorRange","rangeItemErrorRangeNull","$validation","show","change","$selectLockedCells","$selectunLockedCells","selectLockedCellsChecked","txt","this","siblings","trim","rangeDialog","selectRange","visibledatarow","row_pre","col","visibledatacolumn","col_pre","left","width","top","height","left_move","width_move","top_move","height_move","row_focus","column_focus","parents","inputValue","substr","initialEvent","checkProtectionNotEnable","sheetIndex","sheetFile","getSheetByIndex","checkProtectionLocked","cell","data","lo","checkProtectionCellHidden","hi","checkProtectionLockedRangeList","rangeList","checkProtectionSelectLockedOrUnLockedCells","checkProtectionAllSelected","checkProtectionFormatCells","formatCells","checkProtectionAuthorityNormal","type","isAlert"],"mappings":"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","file":"../../controllers/protection.js","sourcesContent":["define([\n    '../store',\n    '../locale/locale',\n    './constant',\n    '../methods/get',\n    '../methods/set',\n    './sheetmanage',\n    './resize',\n    './dataVerificationCtrl',\n    '../utils/util',\n    './select',\n    '../global/tooltip',\n    '../global/cleargridelement'\n], function (Store, locale, m_constant, m_get, m_set, sheetmanage, luckysheetsizeauto, dataVerificationCtrl, m_util, m_select, tooltip, cleargridelement) {\n    'use strict';\n    const {modelHTML} = m_constant;\n    const {getSheetIndex} = m_get;\n    const {setluckysheet_scroll_status} = m_set;\n    const {replaceHtml, transformRangeToAbsolute, openSelfModel} = m_util;\n    const {selectionCopyShow} = m_select;\n    let isInitialProtection = false, isInitialProtectionAddRang = false, rangeItemListCache = [], isAddRangeItemState = true, updateRangeItemIndex = null, validationAuthority = null, updatingSheetFile = null, firstInputSheetProtectionPassword = true;\n    let sqrefMapCache = {}, inputRangeProtectionPassword = {}, initialRangePasswordHtml = false;\n    const authorityItemArr = [\n        'selectLockedCells',\n        'selectunLockedCells',\n        'formatCells',\n        'formatColumns',\n        'formatRows',\n        'insertColumns',\n        'insertRows',\n        'insertHyperlinks',\n        'deleteColumns',\n        'deleteRows',\n        'sort',\n        'filter',\n        'usePivotTablereports',\n        'editObjects',\n        'editScenarios'\n    ];\n    function addRangeItem(item) {\n        const _locale = locale();\n        const local_protection = _locale.protection;\n        const locale_button = _locale.button;\n        let title = item.name, sqref = item.sqref, password = item.password;\n        let passwordTxt = '';\n        if (password != null && password.length > 0) {\n            passwordTxt = '<i class=\"icon iconfont luckysheet-iconfont-bianji2\" title=\"' + local_protection.rangeItemHasPassword + '\"></i>';\n        }\n        let rangeItemTemplate = `\n        <div class=\"luckysheet-protection-rangeItem\" title=\"${ local_protection.rangeItemDblclick }\">\n            <div class=\"luckysheet-protection-rangeItem-del\" title=\"${ locale_button.delete }\">\n                <i class=\"icon iconfont luckysheet-iconfont-shanchu\"></i>\n            </div>\n            <div class=\"luckysheet-protection-rangeItem-name\" title=\"${ title }\">\n                ${ title }${ passwordTxt }\n            </div>\n            <div class=\"luckysheet-protection-rangeItem-range\" title=\"${ sqref }\">\n                ${ sqref }\n            </div>\n            <div class=\"luckysheet-protection-rangeItem-update\" title=\"${ locale_button.update }\">\n                <i class=\"icon iconfont luckysheet-iconfont-bianji\"></i>\n            </div>\n        </div>\n    `;\n        $('#luckysheet-protection-rangeItem-container').append(rangeItemTemplate);\n    }\n    function initialEvent(file) {\n        const _locale = locale();\n        const local_protection = _locale.protection;\n        const locale_button = _locale.button;    //confirm protection\n        //confirm protection\n        $('#luckysheet-slider-protection-ok').click(function () {\n            let password = $('#protection-password').val();\n            let sheet = $('#protection-swichProtectionState').is(':checked');\n            let hint = $('#protection-hint').val();\n            let file = updatingSheetFile, aut = {};\n            if (file != null && file.config != null && file.config.authority != null) {\n                aut = file.config.authority;\n            }\n            let authorityData = {};\n            let algorithmName = 'None';\n            if (password != '\\u2022\\u2022\\u2022\\u2022\\u2022\\u2022\\u2022\\u2022') {\n                authorityData.password = password;\n                authorityData.algorithmName = 'None';\n                authorityData.saltValue = null;\n            } else if (aut != null) {\n                authorityData.algorithmName = aut.algorithmName;\n                authorityData.saltValue = aut.saltValue;\n                authorityData.password = aut.password;\n            } else {\n                authorityData.algorithmName = 'None';\n                authorityData.saltValue = null;\n                authorityData.password = '';\n            }\n            authorityData.hintText = hint;\n            authorityData.sheet = sheet == true ? 1 : 0;\n            for (let i = 0; i < authorityItemArr.length; i++) {\n                let name = authorityItemArr[i];\n                let checkId = 'luckysheet-protection-check-' + name;\n                let authorityValue = $('#' + checkId).is(':checked');\n                authorityData[name] = authorityValue == true ? 1 : 0;\n            }\n            authorityData.allowRangeList = rangeItemListCache;\n            rangeItemListCache = [];\n            firstInputSheetProtectionPassword = true;\n            if (file.config == null) {\n                file.config = {};\n            }\n            file.config.authority = authorityData;\n            inputRangeProtectionPassword = {};\n            closeProtectionModal();\n        });    //cancel protection\n        //cancel protection\n        $('#luckysheet-slider-protection-cancel, #luckysheet-modal-dialog-protection-close').click(function () {\n            closeProtectionModal();\n        });    //Add allow edit range\n        //Add allow edit range\n        $('#luckysheet-slider-protection-addRange').click(function () {\n            initialProtectionRangeModal();\n            isAddRangeItemState = true;\n            $('#luckysheet-protection-rangeItem-confirm').html(locale_button.insert);\n            openSelfModel('luckysheet-protection-rangeItem-dialog');\n            $('#protection-allowRangeAdd-title').val('Default' + rangeItemListCache.length);\n            $('#protection-allowRangeAdd-range input').val('');\n            $('#protection-allowRangeAdd-password').val('');\n            $('#protection-allowRangeAdd-hint').val('');\n        });    //update allow edit range\n        //update allow edit range\n        $(document).off('click.luckysheetProtection.rangeItemUpdate').on('click.luckysheetProtection.rangeItemUpdate', '#luckysheet-protection-rangeItem-container .luckysheet-protection-rangeItem-update', function (e) {\n            initialProtectionRangeModal();\n            isAddRangeItemState = false;\n            $('#luckysheet-protection-rangeItem-confirm').html(locale_button.update);\n            openSelfModel('luckysheet-protection-rangeItem-dialog');\n            let $rangeItem = $(e.target).closest('.luckysheet-protection-rangeItem');\n            let $rangeItemContainer = $('#luckysheet-protection-rangeItem-container');\n            let index = $rangeItemContainer.find('> div.luckysheet-protection-rangeItem').index($rangeItem);\n            let item = rangeItemListCache[index];\n            updateRangeItemIndex = index;\n            $('#protection-allowRangeAdd-title').val(item.name);\n            $('#protection-allowRangeAdd-range input').val(item.sqref);\n            if (item.algorithmName == 'None') {\n                $('#protection-allowRangeAdd-password').val(item.password);\n            } else {\n                $('#protection-allowRangeAdd-password').val('\\u2022\\u2022\\u2022\\u2022\\u2022\\u2022\\u2022\\u2022');\n            }\n            $('#protection-allowRangeAdd-hint').val(item.hintText);\n        });    //delete allow edit range\n        //delete allow edit range\n        $(document).off('click.luckysheetProtection.rangeItemDelete').on('click.luckysheetProtection.rangeItemDelete', '#luckysheet-protection-rangeItem-container .luckysheet-protection-rangeItem-del', function (e) {\n            let $rangeItem = $(e.target).closest('.luckysheet-protection-rangeItem');\n            let $rangeItemContainer = $('#luckysheet-protection-rangeItem-container');\n            let index = $rangeItemContainer.find('> div.luckysheet-protection-rangeItem').index($rangeItem);\n            let item = rangeItemListCache[index];\n            rangeItemListCache.splice(index, 1);\n            $rangeItem.remove();\n        });    //confirm allow edit range\n        //confirm allow edit range\n        $(document).off('click.luckysheetProtection.rangeItemConfirm').on('click.luckysheetProtection.rangeItemConfirm', '#luckysheet-protection-rangeItem-confirm', function () {\n            let name = $('#protection-allowRangeAdd-title').val(), rangeText = $('#protection-allowRangeAdd-range input').val(), password = $('#protection-allowRangeAdd-password').val(), hint = $('#protection-allowRangeAdd-hint').val();\n            if (name.length == 0) {\n                alert(local_protection.rangeItemErrorTitleNull);\n                return;\n            }\n            let range = dataVerificationCtrl.getRangeByTxt(rangeText);\n            if (rangeText.length == 0) {\n                alert(local_protection.rangeItemErrorRangeNull);\n                return;\n            }\n            if (range.length == 0) {\n                alert(local_protection.rangeItemErrorRange);\n                return;\n            }\n            rangeText = transformRangeToAbsolute(rangeText);\n            if (isAddRangeItemState) {\n                let item = {\n                    name: name,\n                    password: password,\n                    hintText: hint,\n                    algorithmName: 'None',\n                    //MD2,MD4,MD5,RIPEMD-128,RIPEMD-160,SHA-1,SHA-256,SHA-384,SHA-512,WHIRLPOOL\n                    saltValue: null,\n                    checkRangePasswordUrl: null,\n                    sqref: rangeText\n                };\n                addRangeItem(item);\n                rangeItemListCache.push(item);\n            } else {\n                let index = updateRangeItemIndex;\n                let item = rangeItemListCache[index];\n                item.name = name;\n                item.sqref = rangeText;\n                item.hintText = hint;\n                if (password != '\\u2022\\u2022\\u2022\\u2022\\u2022\\u2022\\u2022\\u2022') {\n                    item.password = password;\n                    item.algorithmName = 'None';\n                }\n                let $rangeItemContainer = $('#luckysheet-protection-rangeItem-container');\n                let $rangeitem = $rangeItemContainer.find('> div.luckysheet-protection-rangeItem').eq(index);\n                let $name = $rangeitem.find('.luckysheet-protection-rangeItem-name');\n                let passwordTxt = '';\n                if (password != null && password.length > 0) {\n                    passwordTxt = '<i class=\"icon iconfont luckysheet-iconfont-bianji2\" title=\"' + local_protection.rangeItemHasPassword + '\"></i>';\n                }\n                $name.html(name + passwordTxt).attr('title', name);\n                let $range = $rangeitem.find('.luckysheet-protection-rangeItem-range');\n                $range.html(rangeText).attr('title', rangeText);\n            }\n            $('#luckysheet-protection-rangeItem-dialog').hide();\n            $('#luckysheet-modal-dialog-mask').hide();\n        });    //sheet validation check passWord\n        //sheet validation check passWord\n        $(document).off('click.luckysheetProtection.validationConfirm').on('click.luckysheetProtection.validationConfirm', '#luckysheet-protection-sheet-validation-confirm', function (e) {\n            let $validation = $('#luckysheet-protection-sheet-validation');\n            let aut = validationAuthority;\n            if (aut == null) {\n                restoreProtectionConfig(validationAuthority);\n                $validation.hide();\n                $('#luckysheet-modal-dialog-mask').hide();\n                $('#luckysheet-modal-dialog-slider-protection').show();\n                luckysheetsizeauto();\n                return;\n            }\n            let $input = $validation.find('input');\n            let password = $input.val();\n            if (password == null || password.length == 0) {\n                alert(local_protection.checkPasswordNullalert);\n                return;\n            }\n            if (aut.algorithmName != null && aut.algorithmName != 'None') {\n                if (aut.saltValue != null && aut.saltValue.length > 0) {\n                    var hasher = CryptoApi.getHasher(aut.algorithmName);\n                    password = CryptoApi.hmac(aut.saltValue, password, hasher);\n                } else {\n                    password = CryptoApi.hash(aut.algorithmName, password);\n                }\n            }\n            if (password == aut.password) {\n                restoreProtectionConfig(validationAuthority);\n                $validation.hide();\n                $('#luckysheet-modal-dialog-mask').hide();\n                $('#luckysheet-modal-dialog-slider-protection').show();\n                luckysheetsizeauto();\n                firstInputSheetProtectionPassword = false;\n            } else {\n                alert(local_protection.checkPasswordWrongalert);\n            }\n        });\n        $('#luckysheet-protection-check-selectLockedCells').change(function () {\n            let $selectLockedCells = $('#luckysheet-protection-check-selectLockedCells'), $selectunLockedCells = $('#luckysheet-protection-check-selectunLockedCells');\n            let selectLockedCellsChecked = $selectLockedCells.is(':checked'), selectunLockedCellsChecked = $selectunLockedCells.is(':checked');\n            if (selectLockedCellsChecked) {\n                $selectunLockedCells.prop('checked', true);\n            }\n        });\n        $('#luckysheet-protection-check-selectunLockedCells').change(function () {\n            let $selectLockedCells = $('#luckysheet-protection-check-selectLockedCells'), $selectunLockedCells = $('#luckysheet-protection-check-selectunLockedCells');\n            let selectLockedCellsChecked = $selectLockedCells.is(':checked'), selectunLockedCellsChecked = $selectunLockedCells.is(':checked');\n            if (!selectunLockedCellsChecked) {\n                $selectLockedCells.prop('checked', false);\n            }\n        });    //Cell range select controll\n        //Cell range select controll\n        $(document).off('click.luckysheetProtection.dvRange').on('click.luckysheetProtection.dvRange', '#protection-allowRangeAdd-range .fa-table', function (e) {\n            $('#luckysheet-protection-rangeItem-dialog').hide();\n            let dataSource = '0';\n            let txt = $(this).siblings('input').val().trim();\n            dataVerificationCtrl.rangeDialog(dataSource, txt);\n            dataVerificationCtrl.selectRange = [];\n            let range = dataVerificationCtrl.getRangeByTxt(txt);\n            if (range.length > 0) {\n                for (let s = 0; s < range.length; s++) {\n                    let r1 = range[s].row[0], r2 = range[s].row[1];\n                    let c1 = range[s].column[0], c2 = range[s].column[1];\n                    let row = Store.visibledatarow[r2], row_pre = r1 - 1 == -1 ? 0 : Store.visibledatarow[r1 - 1];\n                    let col = Store.visibledatacolumn[c2], col_pre = c1 - 1 == -1 ? 0 : Store.visibledatacolumn[c1 - 1];\n                    dataVerificationCtrl.selectRange.push({\n                        'left': col_pre,\n                        'width': col - col_pre - 1,\n                        'top': row_pre,\n                        'height': row - row_pre - 1,\n                        'left_move': col_pre,\n                        'width_move': col - col_pre - 1,\n                        'top_move': row_pre,\n                        'height_move': row - row_pre - 1,\n                        'row': [\n                            r1,\n                            r2\n                        ],\n                        'column': [\n                            c1,\n                            c2\n                        ],\n                        'row_focus': r1,\n                        'column_focus': c1\n                    });\n                }\n            }\n            selectionCopyShow(dataVerificationCtrl.selectRange);\n        });\n        $(document).off('click.luckysheetProtection.dvRange2').on('click.luckysheetProtection.dvRange2', '#luckysheet-protection-rangeItem-dialog .show-box-item-dropdown .range .fa-table', function (e) {\n            $('#luckysheet-protection-rangeItem-dialog').hide();\n            let dataSource = '1';\n            let txt = $(this).siblings('input').val().trim();\n            dataVerificationCtrl.rangeDialog(dataSource, txt);\n            dataVerificationCtrl.selectRange = [];\n            let range = dataVerificationCtrl.getRangeByTxt(txt);\n            if (range.length > 0) {\n                for (let s = 0; s < range.length; s++) {\n                    let r1 = range[s].row[0], r2 = range[s].row[1];\n                    let c1 = range[s].column[0], c2 = range[s].column[1];\n                    let row = Store.visibledatarow[r2], row_pre = r1 - 1 == -1 ? 0 : Store.visibledatarow[r1 - 1];\n                    let col = Store.visibledatacolumn[c2], col_pre = c1 - 1 == -1 ? 0 : Store.visibledatacolumn[c1 - 1];\n                    dataVerificationCtrl.selectRange.push({\n                        'left': col_pre,\n                        'width': col - col_pre - 1,\n                        'top': row_pre,\n                        'height': row - row_pre - 1,\n                        'left_move': col_pre,\n                        'width_move': col - col_pre - 1,\n                        'top_move': row_pre,\n                        'height_move': row - row_pre - 1,\n                        'row': [\n                            r1,\n                            r2\n                        ],\n                        'column': [\n                            c1,\n                            c2\n                        ],\n                        'row_focus': r1,\n                        'column_focus': c1\n                    });\n                }\n            }\n            selectionCopyShow(dataVerificationCtrl.selectRange);\n        });\n        $(document).off('click.luckysheetProtection.dvRangeConfirm').on('click.luckysheetProtection.dvRangeConfirm', '#luckysheet-dataVerificationRange-dialog-confirm', function (e) {\n            let txt = $(this).parents('#luckysheet-dataVerificationRange-dialog').find('input').val();\n            let $input = $('#protection-allowRangeAdd-range input'), inputValue = $input.val();\n            if (inputValue.substr(inputValue.length - 1, 1) == ',') {\n                $input.val(inputValue + txt);\n            } else {\n                $input.val(txt);\n            }\n            $('#luckysheet-dataVerificationRange-dialog').hide();\n            $('#luckysheet-modal-dialog-mask').show();\n            $('#luckysheet-protection-rangeItem-dialog').show();\n            let range = [];\n            selectionCopyShow(range);\n        });\n        $(document).off('click.luckysheetProtection.dvRangeClose').on('click.dvRangeClose', '#luckysheet-dataVerificationRange-dialog-close', function (e) {\n            $('#luckysheet-dataVerificationRange-dialog').hide();\n            $('#luckysheet-modal-dialog-mask').show();\n            $('#luckysheet-protection-rangeItem-dialog').show();\n            let range = [];\n            selectionCopyShow(range);\n        });\n        $(document).on('click.luckysheetProtection.luckysheetProtection', '#luckysheet-dataVerificationRange-dialog .luckysheet-modal-dialog-title-close', function (e) {\n            $('#luckysheet-dataVerificationRange-dialog').hide();\n            $('#luckysheet-modal-dialog-mask').show();\n            $('#luckysheet-protection-rangeItem-dialog').show();\n            let range = [];\n            selectionCopyShow(range);\n        });\n    }    //protect range config\n    //protect range config\n    function initialProtectionRangeModal(file) {\n        if (isInitialProtectionAddRang) {\n            return;\n        }\n        isInitialProtectionAddRang = true;\n        let _locale = locale();\n        let local_protection = _locale.protection;\n        const locale_button = _locale.button;\n        $('body').append(replaceHtml(modelHTML, {\n            'id': 'luckysheet-protection-rangeItem-dialog',\n            'addclass': 'luckysheet-protection-rangeItem-dialog',\n            'title': local_protection.allowRangeTitle,\n            'content': `\n            <div class=\"luckysheet-protection-rangeItem-content\">\n                <div class=\"luckysheet-slider-protection-row\">\n                    <div class=\"luckysheet-slider-protection-column luckysheet-protection-column-3x\">\n                        ${ local_protection.allowRangeAddTitle }\n                    </div>\n                    <div class=\"luckysheet-slider-protection-column luckysheet-protection-column-7x\" style=\"left:30%\">\n                        <input class=\"luckysheet-protection-rangeItemiInput\" id=\"protection-allowRangeAdd-title\"  placeHolder=\"${ local_protection.allowRangeAddtitleDefault }\">\n                    </div>\n                </div>\n                <div class=\"luckysheet-slider-protection-row\">\n                    <div class=\"luckysheet-slider-protection-column luckysheet-protection-column-3x\">\n                        ${ local_protection.allowRangeAddSqrf }\n                    </div>\n                    <div class=\"luckysheet-slider-protection-column luckysheet-protection-column-7x\" style=\"left:30%\">\n                        <div id=\"protection-allowRangeAdd-range\" class=\"range\">\n                            <input class=\"formulaInputFocus\" spellcheck=\"false\" placeHolder=\"${ local_protection.selectCellRangeHolder }\">\n                            <i class=\"fa fa-table\" aria-hidden=\"true\" title=\"${ local_protection.selectCellRange }\"></i>\n                        </div>\n                    </div>\n                </div>\n                <div class=\"luckysheet-slider-protection-row\">\n                    <div class=\"luckysheet-slider-protection-column luckysheet-protection-column-3x\">\n                        ${ local_protection.allowRangeAddTitlePassword }\n                    </div>\n                    <div class=\"luckysheet-slider-protection-column luckysheet-protection-column-7x\" style=\"left:30%\">\n                        <input class=\"luckysheet-protection-rangeItemiInput\" id=\"protection-allowRangeAdd-password\"  placeHolder=\"${ local_protection.enterPassword }\">\n                    </div>\n                </div>\n                <div class=\"luckysheet-slider-protection-row\">\n                    <div class=\"luckysheet-slider-protection-column luckysheet-protection-column-3x\">\n                        ${ local_protection.allowRangeAddTitleHint }\n                    </div>\n                    <div class=\"luckysheet-slider-protection-column luckysheet-protection-column-7x\" style=\"left:30%\">\n                        <textarea class=\"luckysheet-protection-rangeItemTextarea\" id=\"protection-allowRangeAdd-hint\"  placeHolder=\"${ local_protection.allowRangeAddTitleHintTitle }\"></textarea>\n                    </div>\n                </div>\n            </div>\n        `,\n            'botton': `<button id=\"luckysheet-protection-rangeItem-confirm\" class=\"btn btn-primary\">${ locale_button.insert }</button>\n                    <button class=\"btn btn-default luckysheet-model-close-btn\">${ locale_button.cancel }</button>`,\n            'style': 'z-index:100003'\n        }));\n    }    //Protect sheet initial\n    //Protect sheet initial\n    function initialProtectionRIghtBar(file) {\n        const _locale = locale();\n        const local_protection = _locale.protection;\n        const locale_button = _locale.button;\n        let authorityItemHtml = '';\n        for (let i = 0; i < authorityItemArr.length; i++) {\n            let name = authorityItemArr[i];\n            authorityItemHtml += `\n            <div class=\"luckysheet-slider-protection-row\" style=\"height:18px;\">\n                <div class=\"luckysheet-slider-protection-column luckysheet-protection-column-10x\">\n                <label for=\"luckysheet-protection-check-${ name }\"><input id=\"luckysheet-protection-check-${ name }\" name=\"luckysheet-protection-check-${ name }\" type=\"checkbox\">${ local_protection[name] }</label>\n                </div>\n            </div>\n        `;\n        }\n        const protectionModalHtml = `\n    <div id=\"luckysheet-modal-dialog-slider-protection\" class=\"luckysheet-modal-dialog-slider luckysheet-modal-dialog-slider-pivot\" style=\"display:none;\">\n        <div class=\"luckysheet-modal-dialog-slider-title\"> <span>${ local_protection.protectiontTitle }</span> <span id=\"luckysheet-modal-dialog-protection-close\" title=\"${ locale_button.close }\"><i class=\"fa fa-times\" aria-hidden=\"true\"></i></span> </div>\n        <div class=\"luckysheet-modal-dialog-slider-content\">\n            <div class=\"luckysheet-slider-protection-config\" style=\"top:10px;height:115px\">\n                <div class=\"luckysheet-slider-protection-row\">\n                    <div class=\"luckysheet-slider-protection-column luckysheet-protection-column-10x\">\n                    <label for=\"protection-swichProtectionState\"><input id=\"protection-swichProtectionState\" name=\"protection-swichProtectionState\" type=\"checkbox\">${ local_protection.swichProtectionTip }</label>\n                    </div>\n                </div>\n                <div class=\"luckysheet-slider-protection-row\" style=\"height:23px;\">\n                    <div class=\"luckysheet-slider-protection-column\" style=\"width:98%;\">\n                        <input class=\"luckysheet-protection-input\" id=\"protection-password\"  placeHolder=\"${ local_protection.enterPassword }\">\n                    </div>\n                </div>\n                <div class=\"luckysheet-slider-protection-row\" style=\"height:47px;margin-top:4px;\">\n                    <div class=\"luckysheet-slider-protection-column\" style=\"width:98%;\">\n                        <textarea class=\"luckysheet-protection-textarea\" id=\"protection-hint\"  placeHolder=\"${ local_protection.enterHintTitle }\"></textarea>\n                    </div>\n                </div>\n            </div>\n            <div class=\"luckysheet-slider-protection-config\" style=\"top:130px;height:290px;border-top:1px solid #c5c5c5\">\n                <div class=\"luckysheet-slider-protection-row\" style=\"height:20px;\">\n                    ${ local_protection.authorityTitle }\n                </div>\n                ${ authorityItemHtml }\n            </div>\n            <div class=\"luckysheet-slider-protection-config\" style=\"top:440px;bottom:45px;border-top:1px solid #c5c5c5\">\n                <div class=\"luckysheet-slider-protection-row\" style=\"height:25px;\">\n                    <div class=\"luckysheet-slider-protection-column luckysheet-protection-column-7x\" style=\"left:0px;line-height: 25px;\">\n                        ${ local_protection.allowRangeTitle }\n                    </div>\n                    <div class=\"luckysheet-slider-protection-column luckysheet-protection-column-3x\" style=\"left:70%;\">\n                        <div class=\"luckysheet-slider-protection-ok luckysheet-slider-protection-addRange\" id=\"luckysheet-slider-protection-addRange\">\n                            ${ local_protection.allowRangeAdd }\n                        </div>\n                    </div>\n                </div>\n\n                <div id=\"luckysheet-protection-rangeItem-container\" class=\"luckysheet-slider-protection-row\" style=\"top:25px;bottom:0px;position:absolute\">\n                   \n                </div>\n            </div>\n            <div class=\"luckysheet-slider-protection-config\" style=\"bottom:0px;height:45px\">\n                <div class=\"luckysheet-slider-protection-column luckysheet-protection-column-5x\" style=\"left:0px;\">\n                    <div class=\"luckysheet-slider-protection-ok\" id=\"luckysheet-slider-protection-ok\">\n                        ${ locale_button.confirm }\n                    </div>\n                </div>\n                <div class=\"luckysheet-slider-protection-column luckysheet-protection-column-5x\" style=\"left:50%;\">\n                    <div class=\"luckysheet-slider-protection-cancel\" id=\"luckysheet-slider-protection-cancel\">\n                        ${ locale_button.cancel }\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n    `;\n        $('body').append(protectionModalHtml);    //Password input initial for sheet Protection\n        //Password input initial for sheet Protection\n        $('body').append(replaceHtml(modelHTML, {\n            'id': 'luckysheet-protection-sheet-validation',\n            'addclass': 'luckysheet-protection-sheet-validation',\n            'title': local_protection.validationTitle,\n            'content': `\n            <div class=\"luckysheet-slider-protection-row\">\n                <div class=\"luckysheet-slider-protection-column luckysheet-protection-column-10x\">\n                    ${ local_protection.validationTips }\n                </div>\n            </div>\n            <div class=\"luckysheet-slider-protection-row\" style=\"margin-top:20px\">\n                <div class=\"luckysheet-slider-protection-column luckysheet-protection-column-10x\">\n                    <input type=\"password\" class=\"luckysheet-protection-rangeItemiInput\" placeHolder=\"${ local_protection.validationInputHint }\">\n                </div>\n            </div>\n        `,\n            'botton': `<button id=\"luckysheet-protection-sheet-validation-confirm\" class=\"btn btn-primary\">${ locale_button.confirm }</button>\n                    <button class=\"btn btn-default luckysheet-model-close-btn\">${ locale_button.cancel }</button>`,\n            'style': 'z-index:100003'\n        }));\n    }\n    function restoreProtectionConfig(aut) {\n        if (aut == null) {\n            aut = {};\n        }\n        for (let i = 0; i < authorityItemArr.length; i++) {\n            let name = authorityItemArr[i];\n            let checkId = 'luckysheet-protection-check-' + name;\n            let authorityValue = aut[name];\n            if (authorityValue == null) {\n                authorityValue = 0;\n            }\n            if (authorityValue == null && name in {\n                    selectLockedCells: 1,\n                    selectunLockedCells: 1\n                }) {\n                authorityValue = 1;\n            }\n            $('#' + checkId).prop('checked', authorityValue == 1 ? true : false);\n        }\n        if (aut.password != null && aut.password.length > 0) {\n            if (aut.algorithmName == 'None' || aut.algorithmName == null) {\n                $('#protection-password').val(aut.password);\n            } else {\n                $('#protection-password').val('\\u2022\\u2022\\u2022\\u2022\\u2022\\u2022\\u2022\\u2022');\n            }\n        } else {\n            $('#protection-password').val('');\n        }\n        let sheet = aut.sheet;\n        if (aut.sheet == null) {\n            sheet = 0;\n        }\n        $('#protection-swichProtectionState').prop('checked', sheet == 1 ? true : false);\n        let hintText = aut.hintText;\n        if (hintText == null) {\n            hintText = '';\n        }\n        $('#protection-hint').val(hintText);\n        rangeItemListCache = [];\n        $('#luckysheet-protection-rangeItem-container').empty();\n        let allowRangeList = aut.allowRangeList;\n        if (allowRangeList != null && allowRangeList.length > 0) {\n            for (let i = 0; i < allowRangeList.length; i++) {\n                let item = allowRangeList[i];\n                addRangeItem(item);\n                rangeItemListCache.push(item);\n            }\n        }\n    }\n    function openProtectionModal(file) {\n        if (!isInitialProtection) {\n            initialProtectionRIghtBar(file);\n            initialEvent(file);\n            isInitialProtection = true;\n        }\n        updatingSheetFile = file;\n        if (file != null && file.config != null && file.config.authority != null) {\n            let aut = file.config.authority;\n            if (firstInputSheetProtectionPassword && aut.sheet == 1 && aut.password != null && aut.password.length > 0) {\n                validationAuthority = aut;\n                $('#luckysheet-protection-sheet-validation input').val('');\n                openSelfModel('luckysheet-protection-sheet-validation');\n                return;\n            } else {\n                //retore protection config\n                restoreProtectionConfig(aut);\n            }\n        } else {\n            //protection initial config\n            $('#luckysheet-protection-check-selectLockedCells').prop('checked', true);\n            $('#luckysheet-protection-check-selectunLockedCells').prop('checked', true);\n        }\n        $('#luckysheet-modal-dialog-slider-protection').show();\n        luckysheetsizeauto();\n    }\n    function closeProtectionModal() {\n        $('#luckysheet-protection-rangeItem-dialog').hide();\n        $('#luckysheet-modal-dialog-slider-protection').hide();\n        luckysheetsizeauto();\n    }\n    function checkProtectionLockedSqref(r, c, aut, local_protection, isOpenAlert = true) {\n        let isPass = false;\n        let rangeAut = aut.allowRangeList;\n        if (rangeAut != null && rangeAut.length > 0) {\n            let isExists = false;\n            for (let i = 0; i < rangeAut.length; i++) {\n                let ra = rangeAut[i];\n                let sqref = ra.sqref;\n                let range = dataVerificationCtrl.getRangeByTxt(sqref);\n                if (range.length > 0) {\n                    for (let s = 0; s < range.length; s++) {\n                        let r1 = range[s].row[0], r2 = range[s].row[1];\n                        let c1 = range[s].column[0], c2 = range[s].column[1];\n                        if (r >= r1 && r <= r2 && c >= c1 && c <= c2) {\n                            isExists = true;\n                            break;\n                        }\n                    }\n                }\n                if (isExists) {\n                    let password = ra.password;\n                    if (password != null && password.length > 0 && !(sqref in inputRangeProtectionPassword)) {\n                        if (isOpenAlert) {\n                            openRangePasswordModal(ra);\n                            $('#luckysheet-selection-copy .luckysheet-selection-copy').hide();\n                        }\n                        return false;\n                    } else {\n                        isPass = true;\n                    }\n                    break;\n                }\n            }\n        }\n        if (!isPass && isOpenAlert) {\n            let ht;\n            if (aut.hintText != null && aut.hintText.length > 0) {\n                ht = aut.hintText;\n            } else {\n                ht = local_protection.defaultSheetHintText;\n            }\n            tooltip.info('', ht);\n            $('#luckysheet-selection-copy .luckysheet-selection-copy').hide();\n        }\n        return isPass;\n    }\n    function openRangePasswordModal(rangeAut) {\n        const _locale = locale();\n        const local_protection = _locale.protection;\n        const locale_button = _locale.button;\n        if (!initialRangePasswordHtml) {\n            //Password input initial for range\n            $('body').append(replaceHtml(modelHTML, {\n                'id': 'luckysheet-protection-range-validation',\n                'addclass': 'luckysheet-protection-sheet-validation',\n                'title': local_protection.validationTitle,\n                'content': `\n                <div class=\"luckysheet-slider-protection-row\">\n                    <div id=\"luckysheet-protection-range-validation-hint\" class=\"luckysheet-slider-protection-column luckysheet-protection-column-10x\">\n                        \n                    </div>\n                </div>\n                <div class=\"luckysheet-slider-protection-row\" style=\"margin-top:20px\">\n                    <div class=\"luckysheet-slider-protection-column luckysheet-protection-column-10x\">\n                        <input type=\"password\" class=\"luckysheet-protection-rangeItemiInput\" placeHolder=\"${ local_protection.validationInputHint }\">\n                    </div>\n                </div>\n            `,\n                'botton': `<button id=\"luckysheet-protection-range-validation-confirm\" class=\"btn btn-primary\">${ locale_button.confirm }</button>\n                        <button class=\"btn btn-default luckysheet-model-close-btn\">${ locale_button.cancel }</button>`,\n                'style': 'z-index:100003'\n            }));\n        }\n        initialRangePasswordHtml = true;\n        openSelfModel('luckysheet-protection-range-validation');\n        let $hint = $('#luckysheet-protection-range-validation-hint');\n        if (rangeAut.hintText != null && rangeAut.hintText.length > 0) {\n            $hint.html(rangeAut.hintText);\n        } else {\n            $hint.html(local_protection.defaultRangeHintText);\n        }\n        let $rangeV = $('#luckysheet-protection-range-validation');\n        let $input = $rangeV.find('input');\n        $input.val('');\n        $('#luckysheet-protection-range-validation-confirm').off('click').on('click', function () {\n            let password = $input.val();\n            if (password == null || password.length == 0) {\n                alert(local_protection.checkPasswordNullalert);\n                return;\n            }\n            if (rangeAut.algorithmName != null && rangeAut.algorithmName != 'None') {\n                // password = CryptoApi.hash(rangeAut.algorithmName, password);\n                if (rangeAut.saltValue != null && rangeAut.saltValue.length > 0) {\n                    var hasher = CryptoApi.getHasher(rangeAut.algorithmName);\n                    password = CryptoApi.hmac(rangeAut.saltValue, password, hasher);\n                } else {\n                    password = CryptoApi.hash(rangeAut.algorithmName, password);\n                }\n            }\n            if (password == rangeAut.password) {\n                inputRangeProtectionPassword[rangeAut.sqref] = 1;\n                $rangeV.hide();\n                $('#luckysheet-modal-dialog-mask').hide();\n                alert(local_protection.checkPasswordSucceedalert);\n            } else {\n                alert(local_protection.checkPasswordWrongalert);\n            }\n        });\n    }    //protection state\n    function checkProtectionNotEnable(sheetIndex) {\n        let sheetFile = sheetmanage.getSheetByIndex(sheetIndex);\n        if (sheetFile == null) {\n            return true;\n        }\n        if (sheetFile.config == null || sheetFile.config.authority == null) {\n            return true;\n        }\n        let aut = sheetFile.config.authority;\n        if (aut == null || aut.sheet == null || aut.sheet == 0) {\n            return true;\n        }\n        const _locale = locale();\n        const local_protection = _locale.protection;\n        let ht;\n        if (aut.hintText != null && aut.hintText.length > 0) {\n            ht = aut.hintText;\n        } else {\n            ht = local_protection.defaultSheetHintText;\n        }\n        tooltip.info('', ht);\n        return false;\n    }\n    function checkProtectionLocked(r, c, sheetIndex) {\n        let sheetFile = sheetmanage.getSheetByIndex(sheetIndex);\n        if (sheetFile == null) {\n            return true;\n        }\n        if (sheetFile.config == null || sheetFile.config.authority == null) {\n            return true;\n        }\n        let data = sheetFile.data, cell = data[r][c], aut = sheetFile.config.authority;\n        if (aut == null || aut.sheet == null || aut.sheet == 0) {\n            return true;\n        }\n        if (cell && !cell.lo) {\n            return true;\n        }\n        const _locale = locale();\n        const local_protection = _locale.protection;\n        return checkProtectionLockedSqref(r, c, aut, local_protection);\n    }\n    function checkProtectionCellHidden(r, c, sheetIndex) {\n        let sheetFile = sheetmanage.getSheetByIndex(sheetIndex);\n        if (!sheetFile || !sheetFile.data[r] || !sheetFile.data[r][c]) {\n            return true;\n        }\n        if (sheetFile.config == null || sheetFile.config.authority == null) {\n            return true;\n        }\n        let data = sheetFile.data, cell = data[r][c], aut = sheetFile.config.authority;\n        if (aut == null || aut.sheet == null || aut.sheet == 0) {\n            return true;\n        }\n        if (cell == null || cell.hi == null || cell.hi == 0) {\n            return true;\n        }\n        return false;\n    }\n    function checkProtectionLockedRangeList(rangeList, sheetIndex) {\n        //EPM-BUDGET-START\n        if (rangeList[0].column[0] !== rangeList[0].column[1])\n            return true;    //EPM-BUDGET-END\n        //EPM-BUDGET-END\n        let sheetFile = sheetmanage.getSheetByIndex(sheetIndex);\n        if (sheetFile == null) {\n            return true;\n        }\n        if (sheetFile.config == null || sheetFile.config.authority == null) {\n            return true;\n        }\n        let aut = sheetFile.config.authority;\n        if (aut == null || aut.sheet == null || aut.sheet == 0) {\n            return true;\n        }\n        if (rangeList == null || rangeList.length == 0) {\n            return true;\n        }    //EPM-BUDGET-START\n        //EPM-BUDGET-START\n        let cell = sheetFile.data[rangeList[0].row[0]][rangeList[0].column[0]];\n        if (cell && !cell.lo) {\n            return true;\n        }    //EPM-BUDGET-END\n        //EPM-BUDGET-END\n        const _locale = locale();\n        const local_protection = _locale.protection;\n        for (let s = 0; s < rangeList.length; s++) {\n            let r1 = rangeList[s].row[0], r2 = rangeList[s].row[1];\n            let c1 = rangeList[s].column[0], c2 = rangeList[s].column[1];\n            for (let r = r1; r <= r2; r++) {\n                for (let c = c1; c <= c2; c++) {\n                    let isPass = checkProtectionLockedSqref(r, c, aut, local_protection);\n                    if (isPass == false) {\n                        return false;\n                    }\n                }\n            }\n        }\n        return true;\n    }\n    function checkProtectionSelectLockedOrUnLockedCells(r, c, sheetIndex) {\n        const _locale = locale();\n        const local_protection = _locale.protection;\n        let sheetFile = sheetmanage.getSheetByIndex(sheetIndex);\n        if (sheetFile == null) {\n            return true;\n        }\n        if (sheetFile.config == null || sheetFile.config.authority == null) {\n            return true;\n        }\n        let data = sheetFile.data, cell = data[r][c], aut = sheetFile.config.authority;\n        if (aut == null || aut.sheet == null || aut.sheet == 0) {\n            return true;\n        }\n        if (cell && !cell.lo) {\n            //unlocked\n            if (aut.selectunLockedCells == 1 || aut.selectunLockedCells == null) {\n                return true;\n            } else {\n                return false;\n            }\n        } else {\n            //locked??\n            let isAllEdit = checkProtectionLockedSqref(r, c, aut, local_protection, false);    //dont alert password model\n            //dont alert password model\n            if (isAllEdit) {\n                //unlocked\n                if (aut.selectunLockedCells == 1 || aut.selectunLockedCells == null) {\n                    return true;\n                } else {\n                    return false;\n                }\n            } else {\n                //locked\n                if (aut.selectLockedCells == 1 || aut.selectLockedCells == null) {\n                    return true;\n                } else {\n                    return false;\n                }\n            }\n        }\n    }\n    function checkProtectionAllSelected(sheetIndex) {\n        const _locale = locale();\n        const local_protection = _locale.protection;\n        let sheetFile = sheetmanage.getSheetByIndex(sheetIndex);\n        if (sheetFile == null) {\n            return true;\n        }\n        if (sheetFile.config == null || sheetFile.config.authority == null) {\n            return true;\n        }\n        let aut = sheetFile.config.authority;\n        if (aut == null || aut.sheet == null || aut.sheet == 0) {\n            return true;\n        }\n        let selectunLockedCells = false;\n        if (aut.selectunLockedCells == 1 || aut.selectunLockedCells == null) {\n            selectunLockedCells = true;\n        }\n        let selectLockedCells = false;\n        if (aut.selectLockedCells == 1 || aut.selectLockedCells == null) {\n            selectLockedCells = true;\n        }\n        if (selectunLockedCells && selectLockedCells) {\n            return true;\n        }\n        return false;\n    }\n    function checkProtectionFormatCells(sheetIndex) {\n        let sheetFile = sheetmanage.getSheetByIndex(sheetIndex);\n        if (sheetFile == null) {\n            return true;\n        }\n        if (sheetFile.config == null || sheetFile.config.authority == null) {\n            return true;\n        }\n        let aut = sheetFile.config.authority;\n        if (aut == null || aut.sheet == null || aut.sheet == 0) {\n            return true;\n        }\n        if (aut.formatCells == 1 || aut.formatCells == null) {\n            return true;\n        }\n        const _locale = locale();\n        const local_protection = _locale.protection;\n        let ht;\n        if (aut.hintText != null && aut.hintText.length > 0) {\n            ht = aut.hintText;\n        } else {\n            ht = local_protection.defaultSheetHintText;\n        }\n        tooltip.info('', ht);\n        return false;\n    }\n    function checkProtectionAuthorityNormal(sheetIndex, type = 'formatColumns', isAlert = true) {\n        let sheetFile = sheetmanage.getSheetByIndex(sheetIndex);\n        if (sheetFile == null) {\n            return true;\n        }\n        if (sheetFile.config == null || sheetFile.config.authority == null) {\n            return true;\n        }\n        let aut = sheetFile.config.authority;\n        if (aut == null || aut.sheet == null || aut.sheet == 0) {\n            return true;\n        }\n        if (aut[type] == 1 || aut[type] == null) {\n            return true;\n        }\n        if (isAlert) {\n            const _locale = locale();\n            const local_protection = _locale.protection;\n            let ht;\n            if (aut.hintText != null && aut.hintText.length > 0) {\n                ht = aut.hintText;\n            } else {\n                ht = local_protection.defaultSheetHintText;\n            }\n            tooltip.info('', ht);\n        }\n        return false;\n    }\n    return {\n        openProtectionModal: openProtectionModal,\n        closeProtectionModal: closeProtectionModal,\n        checkProtectionNotEnable: checkProtectionNotEnable,\n        checkProtectionLocked: checkProtectionLocked,\n        checkProtectionCellHidden: checkProtectionCellHidden,\n        checkProtectionLockedRangeList: checkProtectionLockedRangeList,\n        checkProtectionSelectLockedOrUnLockedCells: checkProtectionSelectLockedOrUnLockedCells,\n        checkProtectionAllSelected: checkProtectionAllSelected,\n        checkProtectionFormatCells: checkProtectionFormatCells,\n        checkProtectionAuthorityNormal: checkProtectionAuthorityNormal\n    };\n});"]}