{"version":3,"sources":["controllers/mobile.js"],"names":["define","m_location","m_select","cells","luckysheetFreezen","Store","rowLocation","colLocation","mouseposition","selectHightlightShow","cellMainSrollBarSize","luckysheet_touchmove_status","luckysheet_touchmove_startPos","luckysheet_touchhandle_status","_scrollTimer","$","document","on","event","clearInterval","touch","originalEvent","targetTouches","x","pageX","y","pageY","vy","moveType","length","scale","slideX","slideY","scrollLeft","scrollTop","vy_y","vy_x","mouse","row_location","row","row_pre","row_index","col_location","col","col_pre","col_index","last","extend","luckysheet_select_save","top","height","rowseleted","row_focus","left","width","columnseleted","column","column_focus","changeparam","mergeMoveMain","scrollFreezen","stopPropagation","Math","abs","friction_x","friction_y","setInterval","addEventListener","preventDefault","passive"],"mappings":"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","file":"../../controllers/mobile.js","sourcesContent":["define([\n    '../methods/location',\n    '../widgets/select',\n    '../methods/cells',\n    './freezen',\n    '../store'\n], function (m_location, m_select, cells, luckysheetFreezen, Store) {\n    'use strict';\n    const {rowLocation, colLocation, mouseposition} = m_location;\n    const {selectHightlightShow} = m_select;\n    //设备是移动端\n    return function mobileinit() {\n        //去除滚动条\n        Store.cellMainSrollBarSize = 0;    //滑动滚动表格\n        //滑动滚动表格\n        let luckysheet_touchmove_status = false, luckysheet_touchmove_startPos = {}, luckysheet_touchhandle_status = false, _scrollTimer = null;\n        $(document).on('touchstart', '#luckysheet-grid-window-1', function (event) {\n            clearInterval(_scrollTimer);    //clear timer\n            //clear timer\n            luckysheet_touchmove_status = true;\n            let touch = event.originalEvent.targetTouches[0];\n            luckysheet_touchmove_startPos = {\n                x: touch.pageX,\n                y: touch.pageY,\n                vy: 0,\n                //vy可以理解为滑动的力度\n                moveType: 'y'\n            };\n        });\n        $(document).on('touchmove', '#luckysheet-grid-window-1', function (event) {\n            if (event.originalEvent.targetTouches.length > 1 || event.scale && event.scale !== 1) {\n                return;\n            }\n            let touch = event.originalEvent.targetTouches[0];\n            if (luckysheet_touchmove_status) {\n                //滚动\n                let slideX = touch.pageX - luckysheet_touchmove_startPos.x;\n                let slideY = touch.pageY - luckysheet_touchmove_startPos.y;\n                luckysheet_touchmove_startPos.x = touch.pageX;\n                luckysheet_touchmove_startPos.y = touch.pageY;\n                let scrollLeft = $('#luckysheet-scrollbar-x').scrollLeft();\n                let scrollTop = $('#luckysheet-scrollbar-y').scrollTop();    // console.log(\"start\",scrollTop, slideY,touch.pageY);\n                // console.log(\"start\",scrollTop, slideY,touch.pageY);\n                scrollLeft -= slideX;\n                scrollTop -= slideY;    // console.log(touch,touch.pageY, luckysheet_touchmove_startPos.y, slideY);\n                // console.log(touch,touch.pageY, luckysheet_touchmove_startPos.y, slideY);\n                if (scrollLeft < 0) {\n                    scrollLeft = 0;\n                }\n                if (scrollTop < 0) {\n                    scrollTop = 0;\n                }\n                $('#luckysheet-scrollbar-y').scrollTop(scrollTop);\n                luckysheet_touchmove_startPos.vy_y = slideY;\n                luckysheet_touchmove_startPos.scrollTop = scrollTop;\n                $('#luckysheet-scrollbar-x').scrollLeft(scrollLeft);\n                luckysheet_touchmove_startPos.vy_x = slideX;\n                luckysheet_touchmove_startPos.scrollLeft = scrollLeft;\n            } else if (luckysheet_touchhandle_status) {\n                //选区\n                let mouse = mouseposition(touch.pageX, touch.pageY);\n                let x = mouse[0] + $('#luckysheet-cell-main').scrollLeft();\n                let y = mouse[1] + $('#luckysheet-cell-main').scrollTop();\n                let row_location = rowLocation(y), row = row_location[1], row_pre = row_location[0], row_index = row_location[2];\n                let col_location = colLocation(x), col = col_location[1], col_pre = col_location[0], col_index = col_location[2];\n                let last = $.extend(true, {}, Store.luckysheet_select_save[Store.luckysheet_select_save.length - 1]);\n                let top = 0, height = 0, rowseleted = [];\n                if (last.top > row_pre) {\n                    top = row_pre;\n                    height = last.top + last.height - row_pre;\n                    if (last.row[1] > last.row_focus) {\n                        last.row[1] = last.row_focus;\n                    }\n                    rowseleted = [\n                        row_index,\n                        last.row[1]\n                    ];\n                } else if (last.top == row_pre) {\n                    top = row_pre;\n                    height = last.top + last.height - row_pre;\n                    rowseleted = [\n                        row_index,\n                        last.row[0]\n                    ];\n                } else {\n                    top = last.top;\n                    height = row - last.top - 1;\n                    if (last.row[0] < last.row_focus) {\n                        last.row[0] = last.row_focus;\n                    }\n                    rowseleted = [\n                        last.row[0],\n                        row_index\n                    ];\n                }\n                let left = 0, width = 0, columnseleted = [];\n                if (last.left > col_pre) {\n                    left = col_pre;\n                    width = last.left + last.width - col_pre;\n                    if (last.column[1] > last.column_focus) {\n                        last.column[1] = last.column_focus;\n                    }\n                    columnseleted = [\n                        col_index,\n                        last.column[1]\n                    ];\n                } else if (last.left == col_pre) {\n                    left = col_pre;\n                    width = last.left + last.width - col_pre;\n                    columnseleted = [\n                        col_index,\n                        last.column[0]\n                    ];\n                } else {\n                    left = last.left;\n                    width = col - last.left - 1;\n                    if (last.column[0] < last.column_focus) {\n                        last.column[0] = last.column_focus;\n                    }\n                    columnseleted = [\n                        last.column[0],\n                        col_index\n                    ];\n                }\n                let changeparam = cells.mergeMoveMain(columnseleted, rowseleted, last, top, height, left, width);\n                if (changeparam != null) {\n                    columnseleted = changeparam[0];\n                    rowseleted = changeparam[1];\n                    top = changeparam[2];\n                    height = changeparam[3];\n                    left = changeparam[4];\n                    width = changeparam[5];\n                }\n                last['row'] = rowseleted;\n                last['column'] = columnseleted;\n                last['left_move'] = left;\n                last['width_move'] = width;\n                last['top_move'] = top;\n                last['height_move'] = height;\n                Store.luckysheet_select_save[Store.luckysheet_select_save.length - 1] = last;\n                selectHightlightShow();\n                luckysheetFreezen.scrollFreezen();\n            }\n            event.stopPropagation();\n        });\n        $(document).on('touchend', function (event) {\n            if (luckysheet_touchmove_status) {\n                let vy_x = Math.abs(luckysheet_touchmove_startPos.vy_x), friction_x = ((vy_x >> 31) * 2 + 1) * 0.25;\n                let vy_y = Math.abs(luckysheet_touchmove_startPos.vy_y), friction_y = ((vy_y >> 31) * 2 + 1) * 0.25;\n                if (vy_x > 0 || vy_y > 0) {\n                    _scrollTimer = setInterval(function () {\n                        //\n                        vy_x -= friction_x;    //力度按 惯性的大小递减\n                        //力度按 惯性的大小递减\n                        vy_y -= friction_y;    //力度按 惯性的大小递减\n                        //力度按 惯性的大小递减\n                        if (vy_x <= 0) {\n                            vy_x = 0;\n                        }\n                        if (vy_y <= 0) {\n                            vy_y = 0;\n                        }\n                        if (luckysheet_touchmove_startPos.vy_y > 0) {\n                            luckysheet_touchmove_startPos.scrollTop -= vy_y;\n                        } else {\n                            luckysheet_touchmove_startPos.scrollTop += vy_y;\n                        }\n                        $('#luckysheet-scrollbar-y').scrollTop(luckysheet_touchmove_startPos.scrollTop);\n                        if (luckysheet_touchmove_startPos.vy_x > 0) {\n                            luckysheet_touchmove_startPos.scrollLeft -= vy_x;\n                        } else {\n                            luckysheet_touchmove_startPos.scrollLeft += vy_x;\n                        }\n                        $('#luckysheet-scrollbar-x').scrollLeft(luckysheet_touchmove_startPos.scrollLeft);\n                        if (vy_x <= 0 && vy_y <= 0) {\n                            clearInterval(_scrollTimer);\n                        }\n                    }, 20);\n                }\n            }\n            luckysheet_touchmove_status = false;    // luckysheet_touchmove_startPos = {};\n            // luckysheet_touchmove_startPos = {};\n            luckysheet_touchhandle_status = false;\n        });    //滑动选择选区\n        //滑动选择选区\n        $(document).on('touchstart', '.luckysheet-cs-touchhandle', function (event) {\n            luckysheet_touchhandle_status = true;\n            luckysheet_touchmove_status = false;    // console.log(1111111111);\n            // console.log(1111111111);\n            event.stopPropagation();\n        });    //禁止微信下拉拖出微信背景\n        //禁止微信下拉拖出微信背景\n        document.addEventListener('touchmove', function (event) {\n            event.preventDefault();\n        }, { passive: false });\n    };\n});"]}