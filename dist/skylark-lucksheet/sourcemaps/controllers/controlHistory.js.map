{"version":3,"sources":["controllers/controlHistory.js"],"names":["define","sheetmanage","server","pivotTable","conditionformat","luckysheetPostil","imageCtrl","dataVerificationCtrl","hyperlinkCtrl","m_zoom","m_filter","formula","json","cleargridelement","m_refresh","m_get","Store","m_select","method","m_api","zoomRefreshView","zoomNumberDomBind","createFilter","createFilterOptions","labelFilterOptionState","jfrefreshgrid","jfrefreshgridall","jfrefreshrange","jfrefreshgrid_rhcw","jfrefreshgrid_adRC","jfrefreshgrid_deleteCell","jfrefreshgrid_pastcut","luckysheetrefreshgrid","getSheetIndex","selectHightlightShow","refreshMenuButtonFocus","formulaHistoryHanddler","ctr","type","data","curdata","s","range","length","st_r","row","ed_r","st_c","column","ed_c","r","c","f","delFunctionGroup","sheetIndex","insertUpdateFunctionGroup","redo","e","jfredo","pop","jfundo","push","clearjfundo","hasSheet","currentSheetIndex","changeSheetExec","allParam","cfg","config","RowlChange","cdformat","dataVerification","dynamicArray","source","curData","curConfig","curCdformat","curDataVerification","t","target","luckysheetfile","ctrlType","saveParam","k","images","$","extend","allImagesShow","flowdata","ctrlValue","ctrlValue1","restore","direction","index","calc","filterObj","cf","af","freezen","hyperlink","ctrl","execFunctionGroup","filter_save","each","i","$top","this","item","optiongroups","optionstate","rowhidden","caljs","cindex","filter","filter_select","hide","eq","hasKey","rowhidenPre","remove","allowUpdate","getCellData","initialPivotManage","refreshPivotTable","deleteSheet","removeAttr","copyindex","isDupName","name","createSheetbydata","oldtxt","find","html","color","oldcolor","luckysheetcurrentSheetitem","append","ref","currentDataVerification","historyDataVerification","refOfCheckbox","currentHyperlink","historyHyperlink","historyRules","setTimeout","rc","split","ps","buildPs","zoomRatio","luckysheet_select_save","newCtr","createHookFunction","undo","curDynamicArray","curconfig","curImages","currange","curCalc","curFilterObj","curCf","curAf","curFreezen","curHyperlink","val","text","filterchage","pivotTablecur","sheetconfig","copySheet","order","txt","currentRules","curZoomRatio"],"mappings":"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","file":"../../controllers/controlHistory.js","sourcesContent":["define([\n    './sheetmanage',\n    './server',\n    './pivotTable',\n    './conditionformat',\n    './postil',\n    './imageCtrl',\n    './dataVerificationCtrl',\n    './hyperlinkCtrl',\n    './zoom',\n    './filter',\n    '../global/formula',\n    '../global/json',\n    '../global/cleargridelement',\n    '../global/refresh',\n    '../methods/get',\n    '../store',\n    './select',\n    '../global/method',\n    '../global/api'\n], function (sheetmanage, server, pivotTable, conditionformat, luckysheetPostil, imageCtrl, dataVerificationCtrl, hyperlinkCtrl, m_zoom, m_filter, formula, json, cleargridelement, m_refresh, m_get, Store, m_select, method, m_api) {\n    'use strict';\n    const {zoomRefreshView, zoomNumberDomBind} = m_zoom;\n    const {createFilter, createFilterOptions, labelFilterOptionState} = m_filter;\n    const {jfrefreshgrid, jfrefreshgridall, jfrefreshrange, jfrefreshgrid_rhcw, jfrefreshgrid_adRC, jfrefreshgrid_deleteCell, jfrefreshgrid_pastcut, luckysheetrefreshgrid} = m_refresh;\n    const {getSheetIndex} = m_get;\n    const {selectHightlightShow} = m_select;\n    const {refreshMenuButtonFocus} = m_api;\n    function formulaHistoryHanddler(ctr, type = 'redo') {\n        if (ctr == null) {\n            return;\n        }\n        let data = ctr.data;\n        if (type == 'undo') {\n            data = ctr.curdata;\n        }\n        for (let s = 0; s < ctr.range.length; s++) {\n            let st_r = ctr.range[s].row[0];\n            let ed_r = ctr.range[s].row[1];\n            let st_c = ctr.range[s].column[0];\n            let ed_c = ctr.range[s].column[1];\n            for (let r = st_r; r < ed_r + 1; r++) {\n                for (let c = st_c; c < ed_c + 1; c++) {\n                    if (r > data.length - 1) {\n                        break;\n                    }    // formula.execFunctionExist.push({ \"r\": r, \"c\": c, \"i\": ctr.sheetIndex });\n                    // formula.execFunctionExist.push({ \"r\": r, \"c\": c, \"i\": ctr.sheetIndex });\n                    if (data[r][c] == null || data[r][c].f == null || data[r][c].f == '') {\n                        formula.delFunctionGroup(r, c, ctr.sheetIndex);\n                    } else if (data[r][c] != null && data[r][c].f != null && data[r][c].f.length > 0) {\n                        formula.insertUpdateFunctionGroup(r, c, ctr.sheetIndex);\n                    }\n                }\n            }\n        }\n    }\n    const controlHistory = {\n        redo: function (e) {\n            if (Store.jfredo.length == 0) {\n                return;\n            }\n            let ctr = Store.jfredo.pop();\n            Store.jfundo.push(ctr);\n            Store.clearjfundo = false;\n            if (sheetmanage.hasSheet(ctr.sheetIndex) && Store.currentSheetIndex != ctr.sheetIndex) {\n                sheetmanage.changeSheetExec(ctr.sheetIndex);\n            }    // formula.execFunctionExist = [];\n            // formula.execFunctionExist = [];\n            if (ctr.type == 'datachange') {\n                //如果有单元格为null,则对应公式应该删除\n                formulaHistoryHanddler(ctr);\n                let allParam = {\n                    'cfg': ctr.config,\n                    'RowlChange': ctr.RowlChange,\n                    'cdformat': ctr.cdformat,\n                    'dataVerification': ctr.dataVerification,\n                    'dynamicArray': ctr.dynamicArray\n                };\n                jfrefreshgrid(ctr.data, ctr.range, allParam);    // formula.execFunctionGroup(null, null, null, null, ctr.data);//取之前的数据\n            } else // formula.execFunctionGroup(null, null, null, null, ctr.data);//取之前的数据\n            if (ctr.type == 'pasteCut') {\n                let s = {\n                    'sheetIndex': ctr.source['sheetIndex'],\n                    'data': ctr.source['curData'],\n                    'curData': ctr.source['data'],\n                    'config': ctr.source['curConfig'],\n                    'curConfig': ctr.source['config'],\n                    'cdformat': ctr.source['curCdformat'],\n                    'curCdformat': ctr.source['cdformat'],\n                    'dataVerification': ctr.source['curDataVerification'],\n                    'curDataVerification': ctr.source['dataVerification'],\n                    'range': ctr.source['range']\n                };\n                let t = {\n                    'sheetIndex': ctr.target['sheetIndex'],\n                    'data': ctr.target['curData'],\n                    'curData': ctr.target['data'],\n                    'config': ctr.target['curConfig'],\n                    'curConfig': ctr.target['config'],\n                    'cdformat': ctr.target['curCdformat'],\n                    'curCdformat': ctr.target['cdformat'],\n                    'dataVerification': ctr.target['curDataVerification'],\n                    'curDataVerification': ctr.target['dataVerification'],\n                    'range': ctr.target['range']\n                };\n                jfrefreshgrid_pastcut(s, t, ctr.RowlChange);\n            } else if (ctr.type == 'rangechange') {\n                //如果有单元格为null,则对应公式应该删除\n                formulaHistoryHanddler(ctr);\n                jfrefreshrange(ctr.data, ctr.range, ctr.cdformat);    // formula.execFunctionGroup(null, null, null, null, ctr.data);//取之前的数据\n            } else // formula.execFunctionGroup(null, null, null, null, ctr.data);//取之前的数据\n            if (ctr.type == 'resize') {\n                Store.config = ctr.config;\n                Store.luckysheetfile[getSheetIndex(ctr.sheetIndex)].config = Store.config;\n                if (ctr.ctrlType == 'resizeR') {\n                    server.saveParam('cg', ctr.sheetIndex, ctr.config['rowlen'], { 'k': 'rowlen' });\n                } else if (ctr.ctrlType == 'resizeC') {\n                    server.saveParam('cg', ctr.sheetIndex, ctr.config['columnlen'], { 'k': 'columnlen' });\n                }\n                let images = $.extend(true, {}, ctr.images);\n                Store.luckysheetfile[getSheetIndex(ctr.sheetIndex)].images = images;\n                server.saveParam('all', ctr.sheetIndex, images, { 'k': 'images' });\n                imageCtrl.images = images;\n                imageCtrl.allImagesShow();\n                jfrefreshgrid_rhcw(Store.flowdata.length, Store.flowdata[0].length);\n            } else if (ctr.type == 'cellRowChange') {\n                jfrefreshgridall(ctr.data[0].length, ctr.data.length, ctr.data, ctr.config, ctr.range, ctr.ctrlType, ctr.ctrlValue, ctr.cdformat);\n            } else if (ctr.type == 'extend') {\n                jfrefreshgridall(ctr.data[0].length, ctr.data.length, ctr.data, ctr.config, ctr.range, 'dele', ctr.ctrlValue);\n            } else if (ctr.type == 'dele') {\n                let ctrlValue1 = $.extend(true, {}, ctr.ctrlValue);\n                ctrlValue1.restore = true;\n                jfrefreshgridall(ctr.data[0].length, ctr.data.length, ctr.data, ctr.config, ctr.range, 'extend', ctrlValue1);\n            } else if (ctr.type == 'addRC') {\n                //增加行列撤销操作\n                let ctrlValue = $.extend(true, {}, ctr.ctrlValue);\n                if (ctrlValue.direction == 'rightbottom') {\n                    ctrlValue.index = ctrlValue.index + 1;\n                }\n                jfrefreshgrid_adRC(ctr.data, ctr.config, 'delRC', ctrlValue, ctr.calc, ctr.filterObj, ctr.cf, ctr.af, ctr.freezen, ctr.dataVerification, ctr.hyperlink);\n            } else if (ctr.type == 'delRC') {\n                //删除行列撤销操作\n                let ctrlValue = $.extend(true, {}, ctr.ctrlValue);\n                ctrlValue.restore = true;\n                ctrlValue.direction = 'lefttop';\n                jfrefreshgrid_adRC(ctr.data, ctr.config, 'addRC', ctrlValue, ctr.calc, ctr.filterObj, ctr.cf, ctr.af, ctr.freezen, ctr.dataVerification, ctr.hyperlink);\n            } else if (ctr.type == 'deleteCell') {\n                //删除单元格撤销操作\n                jfrefreshgrid_deleteCell(ctr.data, ctr.config, ctr.ctrl, ctr.calc, ctr.filterObj, ctr.cf, ctr.dataVerification, ctr.hyperlink);\n            } else if (ctr.type == 'showHidRows') {\n                // 隐藏、显示行 撤销操作\n                //config\n                Store.config = ctr.config;\n                Store.luckysheetfile[getSheetIndex(ctr.sheetIndex)].config = ctr.config;\n                server.saveParam('cg', ctr.sheetIndex, ctr.config['rowhidden'], { 'k': 'rowhidden' });    //行高、列宽 刷新  \n                //行高、列宽 刷新  \n                jfrefreshgrid_rhcw(Store.flowdata.length, Store.flowdata[0].length);\n            } else if (ctr.type == 'showHidCols') {\n                // 隐藏、显示列 撤销操作\n                //config\n                Store.config = ctr.config;\n                Store.luckysheetfile[getSheetIndex(ctr.sheetIndex)].config = ctr.config;\n                server.saveParam('cg', ctr.sheetIndex, ctr.config['colhidden'], { 'k': 'colhidden' });    //行高、列宽 刷新  \n                //行高、列宽 刷新  \n                jfrefreshgrid_rhcw(Store.flowdata.length, Store.flowdata[0].length);\n            } else if (ctr.type == 'datachangeAll') {\n                formula.execFunctionGroup();\n                jfrefreshgridall(ctr.data[0].length, ctr.data.length, ctr.data, null, ctr.range, 'datachangeAll', ctr.ctrlValue);\n            } else if (ctr.type == 'datachangeAll_filter_clear') {\n                createFilterOptions(ctr.filter_save);\n                $('#luckysheet-filter-options-sheet' + Store.currentSheetIndex + ' .luckysheet-filter-options').each(function (i) {\n                    let $top = $(this);\n                    let item = ctr.optiongroups[i];\n                    labelFilterOptionState($top, item.optionstate, item.rowhidden, item.caljs, false, item.st_r, item.ed_r, item.cindex, item.st_c, item.ed_c);\n                });\n                server.saveParam('fsr', Store.currentSheetIndex, {\n                    'filter': ctr.optiongroups,\n                    'filter_select': ctr.filter_save\n                });    //config\n                //config\n                Store.config = ctr.config;\n                Store.luckysheetfile[getSheetIndex(Store.currentSheetIndex)].config = Store.config;\n                if (Store.config['rowhidden'] == null) {\n                    Store.config['rowhidden'] = {};\n                }\n                server.saveParam('cg', Store.currentSheetIndex, Store.config['rowhidden'], { 'k': 'rowhidden' });    //行高、列宽 刷新  \n                //行高、列宽 刷新  \n                jfrefreshgrid_rhcw(Store.flowdata.length, Store.flowdata[0].length);\n                $('#luckysheet-filter-menu, #luckysheet-filter-submenu').hide();\n            } else if (ctr.type == 'datachangeAll_filter') {\n                let $top = $('#luckysheet-filter-options-sheet' + Store.currentSheetIndex + ' .luckysheet-filter-options').eq(ctr['optionsindex']);\n                let st_r = $top.data('str'), ed_r = $top.data('edr'), cindex = $top.data('cindex'), st_c = $top.data('stc'), ed_c = $top.data('edc');\n                labelFilterOptionState($top, json.hasKey(ctr.rowhidenPre), ctr.rowhidenPre, ctr.caljs, true, st_r, ed_r, cindex, st_c, ed_c);    //config\n                //config\n                Store.config = ctr.config;\n                Store.luckysheetfile[getSheetIndex(Store.currentSheetIndex)].config = Store.config;\n                if (Store.config['rowhidden'] == null) {\n                    Store.config['rowhidden'] = {};\n                }\n                server.saveParam('cg', Store.currentSheetIndex, Store.config['rowhidden'], { 'k': 'rowhidden' });    //行高、列宽 刷新  \n                //行高、列宽 刷新  \n                jfrefreshgrid_rhcw(Store.flowdata.length, Store.flowdata[0].length);\n                $('#luckysheet-filter-menu, #luckysheet-filter-submenu').hide();\n            } else if (ctr.type == 'filtershow') {\n                $('#luckysheet-filter-selected-sheet' + ctr.sheetIndex + ', #luckysheet-filter-options-sheet' + ctr.sheetIndex).remove();\n                if (server.allowUpdate) {\n                    server.saveParam('all', ctr.sheetIndex, null, { 'k': 'filter_select' });\n                }\n            } else if (ctr.type == 'pivotTable_change') {\n                Store.luckysheetfile[getSheetIndex(ctr.sheetIndex)].pivotTable = ctr.pivotTable;\n                pivotTable.getCellData(ctr.sheetIndex);\n                pivotTable.initialPivotManage(true);\n                pivotTable.refreshPivotTable();\n            } else if (ctr.type == 'addSheet') {\n                sheetmanage.deleteSheet(ctr.index);\n                sheetmanage.changeSheetExec(ctr.currentSheetIndex);\n                $('#luckysheet-input-box').removeAttr('style');\n                $('#luckysheet-sheet-list, #luckysheet-rightclick-sheet-menu').hide();\n            } else if (ctr.type == 'copySheet') {\n                sheetmanage.deleteSheet(ctr.index);\n                sheetmanage.changeSheetExec(ctr.copyindex);\n            } else if (ctr.type == 'deleteSheet') {\n                let isDupName = false;\n                for (let i = 0; i < Store.luckysheetfile.length; i++) {\n                    if (Store.luckysheetfile[i].name == ctr.name) {\n                        isDupName = true;\n                    }\n                }\n                if (!isDupName) {\n                    sheetmanage.createSheetbydata(ctr, 'isrenew');\n                    $('#luckysheet-input-box').removeAttr('style');\n                    $('#luckysheet-sheet-list, #luckysheet-rightclick-sheet-menu').hide();\n                }\n            } else if (ctr.type == 'sheetName') {\n                Store.luckysheetfile[getSheetIndex(ctr.sheetIndex)].name = ctr.oldtxt;\n                $('#luckysheet-sheets-item' + ctr.sheetIndex).find('.luckysheet-sheets-item-name').html(ctr.oldtxt);\n                server.saveParam('all', ctr.sheetIndex, ctr.oldtxt, { 'k': 'name' });\n            } else if (ctr.type == 'sheetColor') {\n                Store.luckysheetfile[getSheetIndex(ctr.sheetIndex)].color = ctr.oldcolor;\n                let luckysheetcurrentSheetitem = $('#luckysheet-sheets-item' + ctr.sheetIndex);\n                luckysheetcurrentSheetitem.find('.luckysheet-sheets-item-color').remove();\n                if (ctr.oldcolor != null) {\n                    luckysheetcurrentSheetitem.append('<div class=\"luckysheet-sheets-item-color\" style=\" position: absolute; width: 100%; height: 3px; bottom: 0px; left: 0px; background-color: ' + ctr.oldcolor + ';\"></div>');\n                }\n                server.saveParam('all', ctr.sheetIndex, ctr.oldcolor, { 'k': 'color' });\n            } else if (ctr.type == 'mergeChange') {\n                let allParam = { 'cfg': ctr.config };\n                jfrefreshgrid(ctr.data, ctr.range, allParam);\n            } else if (ctr.type == 'updateDataVerification') {\n                dataVerificationCtrl.ref(ctr.currentDataVerification, ctr.historyDataVerification, ctr.sheetIndex);\n            } else if (ctr.type == 'updateDataVerificationOfCheckbox') {\n                dataVerificationCtrl.refOfCheckbox(ctr.currentDataVerification, ctr.historyDataVerification, ctr.sheetIndex, ctr.data, ctr.range);\n            } else if (ctr.type == 'updateHyperlink') {\n                hyperlinkCtrl.ref(ctr.currentHyperlink, ctr.historyHyperlink, ctr.sheetIndex, ctr.data, ctr.range);\n            } else if (ctr.type == 'updateCF') {\n                let historyRules = ctr['data']['historyRules'];\n                for (let i = 0; i < historyRules.length; i++) {\n                    //条件规则\n                    let sheetIndex = historyRules[i]['sheetIndex'];\n                    Store.luckysheetfile[getSheetIndex(sheetIndex)]['luckysheet_conditionformat_save'] = historyRules[i]['luckysheet_conditionformat_save'];\n                    if (server.allowUpdate) {\n                        server.saveParam('all', sheetIndex, historyRules[i]['luckysheet_conditionformat_save'], { 'k': 'luckysheet_conditionformat_save' });\n                    }\n                }    //刷新一次表格\n                //刷新一次表格\n                conditionformat.ref();\n            } else if (ctr.type == 'updateAF') {\n                let historyRules = ctr['data']['historyRules'];\n                let index = getSheetIndex(ctr['sheetIndex']);\n                Store.luckysheetfile[index]['luckysheet_alternateformat_save'] = $.extend(true, [], historyRules);\n                setTimeout(function () {\n                    luckysheetrefreshgrid();\n                }, 1);\n            } else if (ctr.type == 'borderChange') {\n                if (ctr.config['borderInfo'] == null) {\n                    server.saveParam('cg', ctr.sheetIndex, [], { 'k': 'borderInfo' });\n                } else {\n                    server.saveParam('cg', ctr.sheetIndex, ctr.config['borderInfo'], { 'k': 'borderInfo' });\n                }\n                Store.config = ctr.config;\n                Store.luckysheetfile[getSheetIndex(ctr.sheetIndex)].config = Store.config;\n                setTimeout(function () {\n                    luckysheetrefreshgrid();\n                }, 1);\n            } else if (ctr.type == 'postil') {\n                luckysheetPostil.ref(ctr.data, ctr.rc);\n                for (let i = 0; i < ctr.rc.length; i++) {\n                    let r = ctr.rc[i].split('_')[0];\n                    let c = ctr.rc[i].split('_')[1];\n                    if (ctr.data[r][c] != null && ctr.data[r][c].ps != null) {\n                        luckysheetPostil.buildPs(r, c, ctr.data[r][c].ps);\n                    } else {\n                        luckysheetPostil.buildPs(r, c, null);\n                    }\n                }\n            } else if (ctr.type == 'imageCtrl') {\n                imageCtrl.images = $.extend(true, {}, ctr.images);\n                imageCtrl.allImagesShow();\n                imageCtrl.ref();\n            } else if (ctr.type == 'zoomChange') {\n                Store.zoomRatio = ctr.zoomRatio;\n                server.saveParam('all', ctr.currentSheetIndex, ctr.zoomRatio, { 'k': 'zoomRatio' });\n                zoomNumberDomBind();\n                zoomRefreshView();\n            }\n            cleargridelement(e);\n            if (ctr.range) {\n                Store.luckysheet_select_save = ctr.range;\n                selectHightlightShow();\n            }\n            Store.clearjfundo = true;    /* 刷新当前状态栏 */\n            /* 刷新当前状态栏 */\n            refreshMenuButtonFocus();    // 撤销的时候curdata 跟 data 数据要调换一下\n            // 撤销的时候curdata 跟 data 数据要调换一下\n            let newCtr = {\n                ...ctr,\n                ...{\n                    data: ctr.curdata,\n                    curdata: ctr.data\n                }\n            };    // 钩子函数\n            // 钩子函数\n            method.createHookFunction('updated', newCtr);\n        },\n        undo: function () {\n            if (Store.jfundo.length == 0) {\n                return;\n            }\n            let ctr = Store.jfundo.pop();\n            Store.jfredo.push(ctr);\n            Store.clearjfundo = false;\n            if (sheetmanage.hasSheet(ctr.sheetIndex) && Store.currentSheetIndex != ctr.sheetIndex) {\n                sheetmanage.changeSheetExec(ctr.sheetIndex);\n            }\n            if (ctr.type == 'datachange') {\n                formula.execFunctionGroup();\n                let allParam = {\n                    'cfg': ctr.curConfig,\n                    'RowlChange': ctr.RowlChange,\n                    'cdformat': ctr.curCdformat,\n                    'dataVerification': ctr.curDataVerification,\n                    'dynamicArray': ctr.curDynamicArray\n                };\n                formulaHistoryHanddler(ctr, 'undo');\n                jfrefreshgrid(ctr.curdata, ctr.range, allParam);\n            } else if (ctr.type == 'pasteCut') {\n                jfrefreshgrid_pastcut(ctr.source, ctr.target, ctr.RowlChange);\n            } else if (ctr.type == 'rangechange') {\n                // formula.execFunctionGroup();\n                formulaHistoryHanddler(ctr, 'undo');\n                jfrefreshrange(ctr.curdata, ctr.range, ctr.curCdformat);\n            } else if (ctr.type == 'resize') {\n                Store.config = ctr.curconfig;\n                Store.luckysheetfile[getSheetIndex(ctr.sheetIndex)].config = Store.config;\n                if (ctr.ctrlType == 'resizeR') {\n                    server.saveParam('cg', ctr.sheetIndex, ctr.curconfig['rowlen'], { 'k': 'rowlen' });\n                } else if (ctr.ctrlType == 'resizeC') {\n                    server.saveParam('cg', ctr.sheetIndex, ctr.curconfig['columnlen'], { 'k': 'columnlen' });\n                }\n                let images = $.extend(true, {}, ctr.curImages);\n                Store.luckysheetfile[getSheetIndex(ctr.sheetIndex)].images = images;\n                server.saveParam('all', ctr.sheetIndex, images, { 'k': 'images' });\n                imageCtrl.images = images;\n                imageCtrl.allImagesShow();\n                jfrefreshgrid_rhcw(Store.flowdata.length, Store.flowdata[0].length);\n            } else if (ctr.type == 'cellRowChange') {\n                jfrefreshgridall(ctr.curdata[0].length, ctr.curdata.length, ctr.curdata, ctr.curconfig, ctr.currange, ctr.ctrlType, ctr.ctrlValue, ctr.curCdformat);\n            } else if (ctr.type == 'extend') {\n                jfrefreshgridall(ctr.curdata[0].length, ctr.curdata.length, ctr.curdata, ctr.curconfig, ctr.currange, ctr.ctrlType, ctr.ctrlValue);\n            } else if (ctr.type == 'dele') {\n                let ctrlValue1 = $.extend(true, {}, ctr.ctrlValue);\n                ctrlValue1.restore = true;\n                jfrefreshgridall(ctr.curdata[0].length, ctr.curdata.length, ctr.curdata, ctr.curconfig, ctr.currange, ctr.ctrlType, ctr.ctrlValue);\n            } else if (ctr.type == 'addRC') {\n                //增加行列重做操作\n                jfrefreshgrid_adRC(ctr.curData, ctr.curConfig, 'addRC', ctr.ctrlValue, ctr.curCalc, ctr.curFilterObj, ctr.curCf, ctr.curAf, ctr.curFreezen, ctr.curDataVerification, ctr.curHyperlink);\n            } else if (ctr.type == 'delRC') {\n                //删除行列重做操作\n                jfrefreshgrid_adRC(ctr.curData, ctr.curConfig, 'delRC', ctr.ctrlValue, ctr.curCalc, ctr.curFilterObj, ctr.curCf, ctr.curAf, ctr.curFreezen, ctr.curDataVerification, ctr.curHyperlink);\n            } else if (ctr.type == 'deleteCell') {\n                //删除单元格重做操作\n                jfrefreshgrid_deleteCell(ctr.curData, ctr.curConfig, ctr.ctrl, ctr.curCalc, ctr.curFilterObj, ctr.curCf, ctr.curDataVerification, ctr.curHyperlink);\n            } else if (ctr.type == 'showHidRows') {\n                // 隐藏、显示行 重做操作\n                //config\n                Store.config = ctr.curconfig;\n                Store.luckysheetfile[getSheetIndex(ctr.sheetIndex)].config = ctr.curconfig;\n                server.saveParam('cg', ctr.sheetIndex, ctr.curconfig['rowhidden'], { 'k': 'rowhidden' });    //行高、列宽 刷新  \n                //行高、列宽 刷新  \n                jfrefreshgrid_rhcw(Store.flowdata.length, Store.flowdata[0].length);\n            } else if (ctr.type == 'showHidCols') {\n                // 隐藏、显示列 重做操作\n                //config\n                Store.config = ctr.curconfig;\n                Store.luckysheetfile[getSheetIndex(ctr.sheetIndex)].config = ctr.curconfig;\n                server.saveParam('cg', ctr.sheetIndex, ctr.curconfig['colhidden'], { 'k': 'colhidden' });    //行高、列宽 刷新  \n                //行高、列宽 刷新  \n                jfrefreshgrid_rhcw(Store.flowdata.length, Store.flowdata[0].length);\n            } else if (ctr.type == 'datachangeAll') {\n                formula.execFunctionGroup();\n                jfrefreshgridall(ctr.curdata[0].length, ctr.curdata.length, ctr.curdata, null, ctr.currange, 'datachangeAll', ctr.ctrlValue);\n            } else if (ctr.type == 'datachangeAll_filter_clear') {\n                server.saveParam('fsc', Store.currentSheetIndex, null);    //config\n                //config\n                Store.config = ctr.curconfig;\n                Store.luckysheetfile[getSheetIndex(Store.currentSheetIndex)].config = Store.config;\n                server.saveParam('cg', Store.currentSheetIndex, {}, { 'k': 'rowhidden' });    //行高、列宽 刷新  \n                //行高、列宽 刷新  \n                jfrefreshgrid_rhcw(Store.flowdata.length, Store.flowdata[0].length);\n                $('#luckysheet-filter-menu .luckysheet-filter-selected-input').hide().find('input').val();\n                $('#luckysheet-filter-selected span').data('type', '0').data('type', null).text('无');\n                $('#luckysheet-filter-selected-sheet' + Store.currentSheetIndex + ', #luckysheet-filter-options-sheet' + Store.currentSheetIndex).remove();\n                $('#luckysheet-filter-menu, #luckysheet-filter-submenu').hide();\n            } else if (ctr.type == 'datachangeAll_filter') {\n                let $top = $('#luckysheet-filter-options-sheet' + Store.currentSheetIndex + ' .luckysheet-filter-options').eq(ctr['optionsindex']);\n                let st_r = $top.data('str'), ed_r = $top.data('edr'), cindex = $top.data('cindex'), st_c = $top.data('stc'), ed_c = $top.data('edc');\n                labelFilterOptionState($top, json.hasKey(ctr.rowhidden), ctr.rowhidden, ctr.caljs, true, st_r, ed_r, cindex, st_c, ed_c);    //config\n                //config\n                Store.config = ctr.curconfig;\n                Store.luckysheetfile[getSheetIndex(Store.currentSheetIndex)].config = Store.config;\n                server.saveParam('cg', Store.currentSheetIndex, Store.config['rowhidden'], { 'k': 'rowhidden' });    //行高、列宽 刷新  \n                //行高、列宽 刷新  \n                jfrefreshgrid_rhcw(Store.flowdata.length, Store.flowdata[0].length);\n                $('#luckysheet-filter-menu, #luckysheet-filter-submenu').hide();\n            } else if (ctr.type == 'filtershow') {\n                Store.luckysheet_select_save = [ctr.filter_save];\n                Store.filterchage = false;\n                createFilter();\n                Store.filterchage = true;\n                server.saveParam('all', ctr.sheetIndex, ctr.filter_save, { 'k': 'filter_select' });\n            } else if (ctr.type == 'pivotTable_change') {\n                Store.luckysheetfile[getSheetIndex(ctr.sheetIndex)].pivotTable = ctr.pivotTablecur;\n                pivotTable.getCellData(ctr.sheetIndex);\n                pivotTable.initialPivotManage(true);\n                pivotTable.refreshPivotTable();\n            } else if (ctr.type == 'addSheet') {\n                sheetmanage.createSheetbydata(ctr.sheetconfig);\n                $('#luckysheet-input-box').removeAttr('style');\n                $('#luckysheet-sheet-list, #luckysheet-rightclick-sheet-menu').hide();\n            } else if (ctr.type == 'copySheet') {\n                sheetmanage.copySheet(ctr.copyindex);\n            } else if (ctr.type == 'deleteSheet') {\n                sheetmanage.deleteSheet(ctr.index);\n                if (ctr.order == 0) {\n                    sheetmanage.changeSheetExec(Store.luckysheetfile[0].index);\n                } else {\n                    sheetmanage.changeSheetExec(Store.luckysheetfile[ctr.order - 1].index);\n                }\n                $('#luckysheet-input-box').removeAttr('style');\n                $('#luckysheet-sheet-list, #luckysheet-rightclick-sheet-menu').hide();\n            } else if (ctr.type == 'sheetName') {\n                Store.luckysheetfile[getSheetIndex(ctr.sheetIndex)].name = ctr.txt;\n                $('#luckysheet-sheets-item' + ctr.sheetIndex).find('.luckysheet-sheets-item-name').html(ctr.txt);\n                server.saveParam('all', ctr.sheetIndex, ctr.txt, { 'k': 'name' });\n            } else if (ctr.type == 'sheetColor') {\n                Store.luckysheetfile[getSheetIndex(ctr.sheetIndex)].color = ctr.color;\n                let luckysheetcurrentSheetitem = $('#luckysheet-sheets-item' + ctr.sheetIndex);\n                luckysheetcurrentSheetitem.find('.luckysheet-sheets-item-color').remove();\n                if (ctr.color != null) {\n                    luckysheetcurrentSheetitem.append('<div class=\"luckysheet-sheets-item-color\" style=\" position: absolute; width: 100%; height: 3px; bottom: 0px; left: 0px; background-color: ' + ctr.color + ';\"></div>');\n                }\n                server.saveParam('all', ctr.sheetIndex, ctr.color, { 'k': 'color' });\n            } else if (ctr.type == 'mergeChange') {\n                let allParam = { 'cfg': ctr.curConfig };\n                jfrefreshgrid(ctr.curData, ctr.range, allParam);\n            } else if (ctr.type == 'updateDataVerification') {\n                dataVerificationCtrl.ref(ctr.historyDataVerification, ctr.currentDataVerification, ctr.sheetIndex);\n            } else if (ctr.type == 'updateDataVerificationOfCheckbox') {\n                dataVerificationCtrl.refOfCheckbox(ctr.historyDataVerification, ctr.currentDataVerification, ctr.sheetIndex, ctr.curData, ctr.range);\n            } else if (ctr.type == 'updateHyperlink') {\n                hyperlinkCtrl.ref(ctr.historyHyperlink, ctr.currentHyperlink, ctr.sheetIndex, ctr.curData, ctr.range);\n            } else if (ctr.type == 'updateCF') {\n                let currentRules = ctr['data']['currentRules'];\n                for (let i = 0; i < currentRules.length; i++) {\n                    //条件规则\n                    let sheetIndex = currentRules[i]['sheetIndex'];\n                    Store.luckysheetfile[getSheetIndex(sheetIndex)]['luckysheet_conditionformat_save'] = currentRules[i]['luckysheet_conditionformat_save'];\n                    if (server.allowUpdate) {\n                        server.saveParam('all', sheetIndex, currentRules[i]['luckysheet_conditionformat_save'], { 'k': 'luckysheet_conditionformat_save' });\n                    }\n                }    //刷新一次表格\n                //刷新一次表格\n                conditionformat.ref();\n            } else if (ctr.type == 'updateAF') {\n                let currentRules = ctr['data']['currentRules'];\n                let index = getSheetIndex(ctr['sheetIndex']);\n                Store.luckysheetfile[index]['luckysheet_alternateformat_save'] = $.extend(true, [], currentRules);\n                setTimeout(function () {\n                    luckysheetrefreshgrid();\n                }, 1);\n            } else if (ctr.type == 'borderChange') {\n                server.saveParam('cg', ctr.sheetIndex, ctr.curconfig['borderInfo'], { 'k': 'borderInfo' });\n                Store.config = ctr.curconfig;\n                Store.luckysheetfile[getSheetIndex(ctr.sheetIndex)].config = Store.config;\n                setTimeout(function () {\n                    luckysheetrefreshgrid();\n                }, 1);\n            } else if (ctr.type == 'postil') {\n                luckysheetPostil.ref(ctr.curdata, ctr.rc);\n                for (let i = 0; i < ctr.rc.length; i++) {\n                    let r = ctr.rc[i].split('_')[0];\n                    let c = ctr.rc[i].split('_')[1];\n                    if (ctr.curdata[r][c] != null && ctr.curdata[r][c].ps != null) {\n                        luckysheetPostil.buildPs(r, c, ctr.curdata[r][c].ps);\n                    } else {\n                        luckysheetPostil.buildPs(r, c, null);\n                    }\n                }\n            } else if (ctr.type == 'imageCtrl') {\n                imageCtrl.images = $.extend(true, {}, ctr.curImages);\n                imageCtrl.allImagesShow();\n                imageCtrl.ref();\n            } else if (ctr.type == 'zoomChange') {\n                Store.zoomRatio = ctr.curZoomRatio;\n                server.saveParam('all', ctr.currentSheetIndex, ctr.curZoomRatio, { 'k': 'zoomRatio' });\n                zoomNumberDomBind();\n                zoomRefreshView();\n            }\n            if (ctr.range) {\n                Store.luckysheet_select_save = ctr.range;\n                selectHightlightShow();\n            }\n            Store.clearjfundo = true;    /* 刷新当前状态栏 */\n            /* 刷新当前状态栏 */\n            refreshMenuButtonFocus();\n        }\n    };\n    return controlHistory;\n});"]}