{"version":3,"sources":["widgets/cursorPos.js"],"names":["define","Store","luckysheetRangeLast","obj","range","document","createRange","innerHTML","innerText","focus","window","getSelection","selectAllChildren","collapseToEnd","len","length","selectNodeContents","setStart","childNodes","collapse","selection","removeAllRanges","addRange","body","createTextRange","moveToElementText","select","isInPage","node","contains","getCursortPosition","textDom","cursorPos","selectRange","moveStart","value","text","selectionStart","hideMenuByCancel","event","target","classList","$","hasClass","filter","hide","luckysheet_cols_menu_status","selectTextContent","ele","content","firstChild","setEnd","startContainer","selectTextDom","selectTextContentCross","sEle","eEle","sContent","eContent","selectTextContentCollapse","index","setCaretPosition","children","pos","el","sel","err","this","rangeResizeTo"],"mappings":"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","file":"../../widgets/cursorPos.js","sourcesContent":["define([\n    '../store'\n], function (Store) {\n    'use strict';\n    function luckysheetRangeLast(obj) {\n        let range;\n        if (document.createRange) {\n            //chrome, firefox, opera, safari, ie9+\n            if (obj.innerHTML != obj.innerText || obj.innerHTML == '') {\n                obj.focus();    //解决ff不获取焦点无法定位问题\n                //解决ff不获取焦点无法定位问题\n                range = window.getSelection();    //创建range\n                //创建range\n                range.selectAllChildren(obj);    //range 选择obj下所有子内容\n                //range 选择obj下所有子内容\n                range.collapseToEnd();    //光标移至最后\n            } else\n                //光标移至最后\n                {\n                    let len = obj.innerText.length;\n                    range = document.createRange();\n                    range.selectNodeContents(obj);\n                    range.setStart(obj.childNodes[0], len);\n                    range.collapse(true);\n                    let selection = window.getSelection();\n                    selection.removeAllRanges();\n                    selection.addRange(range);\n                }\n        } else if (document.selection) {\n            //ie8 and lower\n            range = document.body.createTextRange();\n            range.moveToElementText(obj);\n            range.collapse(false);\n            range.select();\n        }\n    }\n    function getCursortPosition(textDom) {\n        let cursorPos = 0;\n        if (document.selection) {\n            textDom.focus();\n            let selectRange = document.selection.createRange();\n            selectRange.moveStart('character', -textDom.value.length);\n            cursorPos = selectRange.text.length;\n        } else if (textDom.selectionStart || textDom.selectionStart == '0') {\n            cursorPos = textDom.selectionStart;\n        }\n        return cursorPos;\n    }\n    function hideMenuByCancel(event) {\n        // Right-click the menu in the title bar, and click on the elements whose class is luckysheet-cols-rows-shift-left and luckysheet-cols-rows-shift-right will trigger the hiding of the menu bar. It should be prohibited. Exclude these two elements. There may be more Other elements will also jump here for more testing\n        if (event.target.classList.contains('luckysheet-cols-rows-shift-left') || event.target.classList.contains('luckysheet-cols-rows-shift-right')) {\n            return;\n        }\n        if (!$(event.target).hasClass('luckysheet-mousedown-cancel') && $(event.target).filter(\"[class*='sp-palette']\").length == 0 && $(event.target).filter(\"[class*='sp-thumb']\").length == 0 && $(event.target).filter(\"[class*='sp-']\").length == 0) {\n            $('#luckysheet-rightclick-menu').hide();\n            $('#luckysheet-cols-h-hover').hide();\n            $('#luckysheet-cols-menu-btn').hide();    // $(\"#luckysheet-rightclick-menu\").hide();\n            // $(\"#luckysheet-rightclick-menu\").hide();\n            $('#luckysheet-sheet-list, #luckysheet-rightclick-sheet-menu, #luckysheet-user-menu').hide();\n            $('body > .luckysheet-filter-menu, body > .luckysheet-filter-submenu, body > .luckysheet-cols-menu').hide();    //$(\"body > luckysheet-menuButton\").hide();\n            //$(\"body > luckysheet-menuButton\").hide();\n            Store.luckysheet_cols_menu_status = false;\n        }\n    }\n    function selectTextDom(ele) {\n        if (window.getSelection) {\n            let range = document.createRange();\n            range.selectNodeContents(ele);\n            if (range.startContainer && isInPage(range.startContainer)) {\n                window.getSelection().removeAllRanges();\n                window.getSelection().addRange(range);\n            }\n        } else if (document.selection) {\n            let range = document.body.createTextRange();\n            range.moveToElementText(ele);\n            range.select();\n        }\n    }\n    function selectTextContent(ele) {\n        if (window.getSelection) {\n            let range = document.createRange();\n            var content = ele.firstChild;\n            range.setStart(content, 0);\n            range.setEnd(content, content.length);\n            if (range.startContainer && isInPage(range.startContainer)) {\n                window.getSelection().removeAllRanges();\n                window.getSelection().addRange(range);\n            }\n        } else if (document.selection) {\n            let range = document.body.createTextRange();\n            range.moveToElementText(ele);\n            range.select();\n        }\n    }\n    function selectTextContentCross(sEle, eEle) {\n        if (window.getSelection) {\n            let range = document.createRange();\n            var sContent = sEle.firstChild, eContent = eEle.firstChild;\n            range.setStart(sContent, 0);\n            range.setEnd(eContent, eContent.length);\n            if (range.startContainer && isInPage(range.startContainer)) {\n                window.getSelection().removeAllRanges();\n                window.getSelection().addRange(range);\n            }\n        }\n    }\n    function selectTextContentCollapse(sEle, index) {\n        if (window.getSelection) {\n            let range = document.createRange();\n            var sContent = sEle.firstChild;\n            if (index > sContent.length) {\n                index = sContent.length;\n            } else if (index < 0) {\n                index = 0;\n            }\n            range.setStart(sContent, index);\n            range.collapse(true);\n            if (range.startContainer && isInPage(range.startContainer)) {\n                window.getSelection().removeAllRanges();\n                window.getSelection().addRange(range);\n            }\n        }\n    }\n    function isInPage(node) {\n        return node === document.body ? false : document.body.contains(node);\n    }\n\n    // from global/formula.js\n    function setCaretPosition(textDom, children, pos) {\n        try {\n            let el = textDom;\n            let range = document.createRange();\n            let sel = window.getSelection();\n            range.setStart(el.childNodes[children], pos);\n            range.collapse(true);\n            sel.removeAllRanges();\n            sel.addRange(range);\n            el.focus();\n        } catch (err) {\n            luckysheetRangeLast(this.rangeResizeTo[0]);\n        }\n    }\n    return {\n        luckysheetRangeLast,\n        getCursortPosition,\n        hideMenuByCancel,\n        selectTextContent,\n        selectTextDom,\n        selectTextContentCross,\n        selectTextContentCollapse,\n\n        setCaretPosition\n    };\n});"]}