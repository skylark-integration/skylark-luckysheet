{"version":3,"sources":["global/refresh.js"],"names":["define","rhchInit","formula","editor","m_setdata","m_getdata","m_getRowlen","m_draw","luckysheetFreezen","server","sheetmanage","luckysheetPostil","dataVerificationCtrl","hyperlinkCtrl","m_select","m_filter","m_get","Store","setcellvalue","getcellFormula","computeRowlenArr","luckysheetDrawMain","luckysheetDrawgridRowTitle","luckysheetDrawgridColumnTitle","selectHightlightShow","selectionCopyShow","collaborativeEditBox","createFilterOptions","getSheetIndex","refreshCanvasTimeOut","runExecFunction","range","index","data","execFunctionExist","s","length","r","row","c","column","push","i","reverse","execFunctionGroup","execFunctionGlobalData","jfrefreshgrid_rhcw","rowheight","colwidth","isRefreshCanvas","clearTimeout","storeSheetParam","calcChain","luckysheetfile","currentSheetIndex","config","flowdata","spl","window","luckysheetCurrentRow","luckysheetCurrentColumn","luckysheetCurrentFunction","f","fp","$","trim","functionParserExe","sparklines","Function","saveParam","positionSync","is","remove","freezenhorizontaldata","freezenverticaldata","row_st","col_st","scrollTop","scrollLeft","top","visibledatarow","columnHeaderHeight","cutVolumn","left","visibledatacolumn","rowHeaderWidth","saveFreezen","createFreezenHorizontal","createFreezenVertical","createAssistCanvas","each","e","str","cindex","css","luckysheet_filter_save","filter_select","r1","r2","c1","c2","row_pre","col","col_pre","width","height","showSheet","setTimeout","luckysheetrefreshgrid","scrollWidth","scrollHeight","groupValuesRefresh","freezen_horizon_px","freezen_horizon_ed","freezen_horizon_scrollTop","freezen_vertical_px","freezen_vertical_ed","freezen_vertical_scrollTop","drawWidth","luckysheetTableContentHW","drawHeight","luckysheetTableContent","get","getContext","clearRect","devicePixelRatio","jfrefreshgrid","allParam","isRunExecFunction","luckysheet_select_save","cfg","RowlChange","cdformat","dataVerification","dynamicArray","file","clearjfundo","curConfig","curCdformat","curDataVerification","curDynamicArray","jfundo","extend","jfredo","type","curdata","sheetIndex","dataRange","webWorkerFlowDataCache","k","allowUpdate","historyParam","chartparam","jfrefreshchartall","luckysheet_getcelldata_cache","jfrefreshgridall","ctrlType","ctrlValue","redo","setfield","indexOf","len","direction","mc","merge","rc","borderInfo","storeSheetParamALL","jfrefreshrange","jfrefreshgrid_adRC","calc","filterObj","cf","af","freezen","hyperlink","mcData","m","rs","cs","funcData","curData","curCalc","filter","curFilterObj","luckysheet_conditionformat_save","curCf","luckysheet_alternateformat_save","curAf","curFreezen","curHyperlink","addData","restore","st_r","ed_r","cell","st_c","ed_c","mcData_r","mcData_c","clc","clc_r","clc_c","clc_i","clc_funcStr","clc_result","execfunction","func","funcData_r","funcData_c","jfrefreshgrid_deleteCell","ctrl","JSON","stringify","edr","stc","edc","jfrefreshgrid_pastcut","source","target","rowHeight","execF_rc","rh_height","rowlen","defaultrowlen","rowlenArr"],"mappings":";;;;;;;AAAAA,QACI,aACA,YACA,WACA,YACA,YACA,cACA,SACA,yBACA,wBACA,6BACA,wBACA,sCACA,+BACA,wBACA,wBACA,iBACA,YACD,SAAUC,EAAUC,EAASC,EAAQC,EAAWC,EAAWC,EAAaC,EAAQC,EAAmBC,EAAQC,EAAaC,EAAkBC,EAAsBC,EAAeC,EAAUC,EAAUC,EAAOC,GACzM,aACA,MAAMC,aAACA,GAAgBd,GACjBe,eAACA,GAAkBd,GACnBe,iBAACA,GAAoBd,GACrBe,mBAACA,EAAkBC,2BAAEA,EAA0BC,8BAAEA,GAAiChB,GAClFiB,qBAACA,EAAoBC,kBAAEA,EAAiBC,qBAAEA,GAAwBZ,GAClEa,oBAACA,GAAuBZ,GACxBa,cAACA,GAAiBZ,EACxB,IAAIa,EAAuB,KAC3B,SAASC,EAAgBC,EAAOC,EAAOC,GACnC/B,EAAQgC,qBACR,IAAK,IAAIC,EAAI,EAAGA,EAAIJ,EAAMK,OAAQD,IAC9B,IAAK,IAAIE,EAAIN,EAAMI,GAAGG,IAAI,GAAID,GAAKN,EAAMI,GAAGG,IAAI,GAAID,IAChD,IAAK,IAAIE,EAAIR,EAAMI,GAAGK,OAAO,GAAID,GAAKR,EAAMI,GAAGK,OAAO,GAAID,IACtDrC,EAAQgC,kBAAkBO,MACtBJ,EAAKA,EACLE,EAAKA,EACLG,EAAKV,IAKrB9B,EAAQgC,kBAAkBS,UAC1BzC,EAAQ0C,kBAAkB,KAAM,KAAM,KAAM,KAAMX,GAClD/B,EAAQ2C,uBAAyB,KAk1BrC,SAASC,EAAmBC,EAAWC,EAAUC,GAAkB,GAC/DhD,EAAS8C,EAAWC,GACpBE,aAAarB,GACbnB,EAAYyC,kBAEZ,IAAIC,EAAYnC,EAAMoC,eAAezB,EAAcX,EAAMqC,oBAAoBF,UAC7E,GAAiB,MAAbA,GAAqBA,EAAUhB,OAAS,EAAG,CACb,MAA1BnB,EAAMsC,OAAe,SACrBtC,EAAMsC,OAAe,WAEQ,MAA7BtC,EAAMsC,OAAkB,YACxBtC,EAAMsC,OAAkB,cAE5B,IAAK,IAAIb,EAAI,EAAGA,EAAIU,EAAUhB,OAAQM,IAAK,CACvC,IAAIL,EAAIe,EAAUV,GAAGL,EAAGE,EAAIa,EAAUV,GAAGH,EACzC,GADoDa,EAAUV,GAAGV,OACpDf,EAAMqC,mBAA6C,MAAxBrC,EAAMuC,SAASnB,GAAGE,IAA0C,MAA5BtB,EAAMuC,SAASnB,GAAGE,GAAGkB,MAAgBpB,KAAKpB,EAAMsC,OAAe,QAAKhB,KAAKtB,EAAMsC,OAAkB,WAAI,CACzKG,OAAOC,qBAAuBtB,EAC9BqB,OAAOE,wBAA0BrB,EACjCmB,OAAOG,0BAA4B5C,EAAMuC,SAASnB,GAAGE,GAAGuB,EACxD,IAAIC,EAAKC,EAAEC,KAAK/D,EAAQgE,kBAAkBjD,EAAMuC,SAASnB,GAAGE,GAAGuB,IAC3DK,EAAa,IAAIC,SAAS,UAAYL,EAAzB,GACjB9C,EAAMuC,SAASnB,GAAGE,GAAGkB,IAAMU,EAC3B1D,EAAO4D,UAAU,IAAKpD,EAAMqC,kBAAmBrC,EAAMuC,SAASnB,GAAGE,IAC7DF,EAAKA,EACLE,EAAKA,KAIjBtB,EAAMoC,eAAezB,EAAcX,EAAMqC,oBAAoBrB,KAAOhB,EAAMuC,SAiB9E,GAdA7C,EAAiB2D,eAEjB9C,IAEAE,IAEIsC,EAAE,8BAA8BO,GAAG,aACnC9C,IAGAuC,EAAE,6BAA6BO,GAAG,aAClCP,EAAE,6BAA6BQ,SAGY,MAA3ChE,EAAkBiE,uBAA0E,MAAzCjE,EAAkBkE,oBAA6B,CAClG,IAAIC,EAASnE,EAAkBiE,sBAAsB,GAAK,EACtDG,EAASpE,EAAkBkE,oBAAoB,GAAK,EACpDG,EAAYrE,EAAkBiE,sBAAsB,GACpDK,EAAatE,EAAkBkE,oBAAoB,GACnDK,EAAM9D,EAAM+D,eAAeL,GAAU,EAAIE,EAAY5D,EAAMgE,mBAC3DR,GACAxD,EAAM+D,eAAeL,GACrBA,EAAS,EACTE,EACArE,EAAkB0E,UAAUjE,EAAM+D,eAAgBL,EAAS,GAC3DI,GAEAI,EAAOlE,EAAMmE,kBAAkBR,GAAU,EAAIE,EAAa7D,EAAMoE,eAChEX,GACAzD,EAAMmE,kBAAkBR,GACxBA,EAAS,EACTE,EACAtE,EAAkB0E,UAAUjE,EAAMmE,kBAAmBR,EAAS,GAC9DO,GAEJ3E,EAAkB8E,YAAYb,EAAuBM,EAAKL,EAAqBS,GAC/E3E,EAAkB+E,wBAAwBd,EAAuBM,GACjEvE,EAAkBgF,sBAAsBd,EAAqBS,GAC7D3E,EAAkBiF,0BACf,GAA+C,MAA3CjF,EAAkBiE,sBAA+B,CACxD,IAAIE,EAASnE,EAAkBiE,sBAAsB,GAAK,EACtDI,EAAYrE,EAAkBiE,sBAAsB,GACpDM,EAAM9D,EAAM+D,eAAeL,GAAU,EAAIE,EAAY5D,EAAMgE,mBAC3DR,GACAxD,EAAM+D,eAAeL,GACrBA,EAAS,EACTE,EACArE,EAAkB0E,UAAUjE,EAAM+D,eAAgBL,EAAS,GAC3DI,GAEJvE,EAAkB8E,YAAYb,EAAuBM,EAAK,KAAM,MAChEvE,EAAkB+E,wBAAwBd,EAAuBM,GACjEvE,EAAkBiF,0BACf,GAA6C,MAAzCjF,EAAkBkE,oBAA6B,CACtD,IAAIE,EAASpE,EAAkBkE,oBAAoB,GAAK,EACpDI,EAAatE,EAAkBkE,oBAAoB,GACnDS,EAAOlE,EAAMmE,kBAAkBR,GAAU,EAAIE,EAAa7D,EAAMoE,eAChEX,GACAzD,EAAMmE,kBAAkBR,GACxBA,EAAS,EACTE,EACAtE,EAAkB0E,UAAUjE,EAAMmE,kBAAmBR,EAAS,GAC9DO,GAEJ3E,EAAkB8E,YAAY,KAAM,KAAMZ,EAAqBS,GAC/D3E,EAAkBgF,sBAAsBd,EAAqBS,GAC7D3E,EAAkBiF,0BAGdzB,EAAE,mCAAqC/C,EAAMqC,kBAAoB,+BAA+BlB,OAAS,GACzG4B,EAAE,mCAAqC/C,EAAMqC,kBAAoB,+BAA+BoC,KAAK,SAAUhD,EAAGiD,GAC9G,IAAIC,EAAM5B,EAAE2B,GAAG1D,KAAK,OAAQ4D,EAAS7B,EAAE2B,GAAG1D,KAAK,UAC3CkD,EAAOlE,EAAMmE,kBAAkBS,GAAU,GACzCd,EAAMa,EAAM,IAAM,EAAI,EAAI3E,EAAM+D,eAAeY,EAAM,GACzD5B,EAAE2B,GAAGG,KACDX,KAAQA,EACRJ,IAAOA,MAKvB,GAAIf,EAAE,oCAAsC/C,EAAMqC,mBAAmBlB,OAAS,EAAG,CAC7E,IAAI2D,EAAyB9E,EAAMoC,eAAezB,EAAcX,EAAMqC,oBAAoB0C,cACtFC,EAAKF,EAAuBzD,IAAI,GAAI4D,EAAKH,EAAuBzD,IAAI,GACpE6D,EAAKJ,EAAuBvD,OAAO,GAAI4D,EAAKL,EAAuBvD,OAAO,GAC1EF,EAAMrB,EAAM+D,eAAekB,GAAKG,EAAUJ,EAAK,IAAM,EAAI,EAAIhF,EAAM+D,eAAeiB,EAAK,GACvFK,EAAMrF,EAAMmE,kBAAkBgB,GAAKG,EAAUJ,EAAK,IAAM,EAAI,EAAIlF,EAAMmE,kBAAkBe,EAAK,GACjGnC,EAAE,oCAAsC/C,EAAMqC,mBAAmBwC,KAC7DX,KAAQoB,EACRC,MAASF,EAAMC,EAAU,EACzBxB,IAAOsB,EACPI,OAAUnE,EAAM+D,EAAU,IAGlC3F,EAAYgG,YACRzD,IACApB,EAAuB8E,WAAW,WAC9BC,KACD,IAIX,SAASA,EAAsBC,EAAaC,GAQxC,GAPA5G,EAAQ6G,qBACW,MAAfF,IACAA,EAAc7C,EAAE,yBAAyBc,cAEzB,MAAhBgC,IACAA,EAAe9C,EAAE,yBAAyBa,aAED,MAAzCrE,EAAkBkE,qBAA0E,MAA3ClE,EAAkBiE,sBAA+B,CAClG,IAAIuC,EAAoBC,EAAoBC,EACxCC,EAAqBC,EAAqBC,EAC1CC,EAAYrG,EAAMsG,yBAAyB,GAAIC,EAAavG,EAAMsG,yBAAyB,GAClD,MAAzC/G,EAAkBkE,qBAA0E,MAA3ClE,EAAkBiE,uBACnEuC,EAAqBxG,EAAkBiE,sBAAsB,GAC7DwC,EAAqBzG,EAAkBiE,sBAAsB,GAC7DyC,EAA4B1G,EAAkBiE,sBAAsB,GACpE0C,EAAsB3G,EAAkBkE,oBAAoB,GAC5D0C,EAAsB5G,EAAkBkE,oBAAoB,GAC5D2C,EAA6B7G,EAAkBkE,oBAAoB,GAEnErD,EAAmBgG,EAA4BH,EAA2BC,EAAqBH,EAAoB,EAAG,EAAG,KAAM,KAAM,aAErI3F,EAAmBwF,EAAcM,EAAsBE,EAA4BH,EAA2BI,EAAYH,EAAsBE,EAA4BL,EAAoB,EAAG,EAAG,KAAM,KAAM,aAElN3F,EAAmBgG,EAA4BP,EAAeE,EAAqBE,EAA2BC,EAAqBK,EAAaR,EAAqBE,EAA2B,EAAG,EAAG,KAAM,KAAM,aAElN7F,EAAmBwF,EAAcM,EAAsBE,EAA4BP,EAAeE,EAAqBE,EAA2BI,EAAYH,EAAsBE,EAA4BG,EAAaR,EAAqBE,EAA2BC,EAAsBE,EAA6BpG,EAAMoE,eAAgB2B,EAAqBE,EAA4BjG,EAAMgE,oBAE7Y1D,EAA8B8F,EAA4BF,EAAqBlG,EAAMoE,gBACrF9D,EAA8BsF,EAAcM,EAAsBE,EAA4BC,EAAYH,EAAsBE,EAA4BF,EAAsBE,EAA6BpG,EAAMoE,gBACrN/D,EAA2B4F,EAA2BF,EAAoB/F,EAAMgE,oBAChF3D,EAA2BwF,EAAeE,EAAqBE,EAA2BM,EAAaR,EAAqBE,EAA2BF,EAAqBE,EAA4BjG,EAAMgE,qBAC5J,MAA3CzE,EAAkBiE,uBACzBuC,EAAqBxG,EAAkBiE,sBAAsB,GAC7DwC,EAAqBzG,EAAkBiE,sBAAsB,GAC7DyC,EAA4B1G,EAAkBiE,sBAAsB,GACpEpD,EAAmBwF,EAAaK,EAA2BI,EAAWN,EAAoB,EAAG,EAAG,KAAM,KAAM,aAC5G3F,EAAmBwF,EAAaC,EAAeE,EAAqBE,EAA2BI,EAAWE,EAAaR,EAAqBE,EAA2B,KAAMF,EAAqBE,EAA4BjG,EAAMgE,oBACpO1D,EAA8BsF,EAAaS,EAAW,MACtDhG,EAA2B4F,EAA2BF,EAAoB/F,EAAMgE,oBAChF3D,EAA2BwF,EAAeE,EAAqBE,EAA2BM,EAAaR,EAAqBE,EAA2BF,EAAqBE,EAA4BjG,EAAMgE,qBAC9J,MAAzCzE,EAAkBkE,sBACzByC,EAAsB3G,EAAkBkE,oBAAoB,GAC5D0C,EAAsB5G,EAAkBkE,oBAAoB,GAC5D2C,EAA6B7G,EAAkBkE,oBAAoB,GACnErD,EAAmBgG,EAA4BP,EAAcK,EAAqBK,EAAY,EAAG,EAAG,KAAM,KAAM,aAChHnG,EAAmBwF,EAAcM,EAAsBE,EAA4BP,EAAcQ,EAAYH,EAAsBE,EAA4BG,EAAYL,EAAsBE,EAA6BpG,EAAMoE,eAAgB,MACpP/D,EAA2BwF,EAAcU,EAAY,MACrDjG,EAA8B8F,EAA4BF,EAAqBlG,EAAMoE,gBACrF9D,EAA8BsF,EAAcM,EAAsBE,EAA4BC,EAAYH,EAAsBE,EAA4BF,EAAsBE,EAA6BpG,EAAMoE,qBAEtN,CACH,GAA2C,GAAvCrB,EAAE,2BAA2B5B,OAC7B,OAEJ,IAAIqF,EAAyBzD,EAAE,2BAA2B0D,IAAI,GAAGC,WAAW,MAC5EtG,EAAmBwF,EAAaC,GAEhCvF,EAA8BsF,GAC9BvF,EAA2BwF,GAE3BW,EAAuBG,UAAU,EAAG,EAAG3G,EAAMoE,eAAiBpE,EAAM4G,iBAAmB,EAAG5G,EAAMgE,mBAAqBhE,EAAM4G,iBAAmB,IAGtJ,OACIC,cAthCJ,SAAuB7F,EAAMF,EAAOgG,EAAUC,GAAoB,EAAM/E,GAAkB,GAC1E,MAARhB,IACAA,EAAOhB,EAAMuC,UAEJ,MAATzB,IACAA,EAAQd,EAAMgH,wBAElB/E,aAAarB,GAEG,MAAZkG,IACAA,MAEJ,IAAIG,EAAMH,EAAc,IAEpBI,EAAaJ,EAAqB,WAElCK,EAAWL,EAAmB,SAE9BM,EAAmBN,EAA2B,iBAE9CO,EAAeP,EAAuB,aAEtCQ,EAAOtH,EAAMoC,eAAezB,EAAcX,EAAMqC,oBACpD,GAAIrC,EAAMuH,YAAa,CAEnB,IAAIC,EAMAC,EAMAC,EAMAC,EAnBJ3H,EAAM4H,OAAOzG,OAAS,EAGlBqG,EADO,MAAPP,EACYlE,EAAE8E,QAAO,KAAU7H,EAAMsC,QAEzBS,EAAE8E,QAAO,KAAUZ,GAI/BQ,EADY,MAAZN,EACcpE,EAAE8E,QAAO,KAAUP,EAAsC,iCAEzDH,EAIdO,EADoB,MAApBN,EACsBrE,EAAE8E,QAAO,KAAUP,EAAuB,kBAE1CF,EAItBO,EADgB,MAAhBN,EACkBtE,EAAE8E,QAAO,KAAUP,EAAmB,cAEtCD,EAEtBrH,EAAM8H,OAAOtG,MACTuG,KAAQ,aACR/G,KAAQhB,EAAMuC,SACdyF,QAAWhH,EACXiH,WAAcjI,EAAMqC,kBACpBvB,MAASA,EACTwB,OAAUS,EAAE8E,QAAO,KAAU7H,EAAMsC,QACnCkF,UAAaA,EACbL,SAAYpE,EAAE8E,QAAO,KAAUP,EAAsC,iCACrEG,YAAeA,EACfP,WAAcA,EACdE,iBAAoBrE,EAAE8E,QAAO,KAAUP,EAAuB,kBAC9DI,oBAAuBA,EACvBL,aAAgBtE,EAAE8E,QAAO,KAAUP,EAAmB,cACtDK,gBAAmBA,EACnBO,cAAiBZ,EAAKN,0BAI9BhH,EAAMuC,SAAWvB,EACjB9B,EAAOiJ,uBAAuBnI,EAAMuC,UAEpC+E,EAAKtG,KAAOhB,EAAMuC,SAEP,MAAP0E,IACAjH,EAAMsC,OAAS2E,EACfK,EAAKhF,OAAStC,EAAMsC,OACpB9C,EAAO4D,UAAU,MAAOpD,EAAMqC,kBAAmB4E,GAAOmB,EAAK,WAC3C,MAAdlB,GACArF,EAAmB7B,EAAMuC,SAASpB,OAAQnB,EAAMuC,SAAS,GAAGpB,SAIpD,MAAZgG,IACAG,EAAsC,gCAAIH,EAC1C3H,EAAO4D,UAAU,MAAOpD,EAAMqC,kBAAmB8E,GAAYiB,EAAK,qCAG9C,MAApBhB,IACAzH,EAAqByH,iBAAmBA,EACxCE,EAAuB,iBAAIF,EAC3B5H,EAAO4D,UAAU,MAAOpD,EAAMqC,kBAAmB+E,GAAoBgB,EAAK,sBAG1D,MAAhBf,IACAC,EAAmB,aAAID,EACvB7H,EAAO4D,UAAU,MAAOpD,EAAMqC,kBAAmBgF,GAAgBe,EAAK,kBAG1E,IAAK,IAAIlH,EAAI,EAAGA,EAAIJ,EAAMK,OAAQD,IAAK,CACnC,IAAI8D,EAAKlE,EAAMI,GAAGG,IAAI,GAClB6D,EAAKpE,EAAMI,GAAGK,OAAO,GACzB,GAA8B,MAA1BvB,EAAMuC,SAASyC,GAAIE,IAA6C,MAA9BlF,EAAMuC,SAASyC,GAAIE,GAAI1C,IAAa,CACtEC,OAAOC,qBAAuBsC,EAC9BvC,OAAOE,wBAA0BuC,EACjCzC,OAAOG,0BAA4B5C,EAAMuC,SAASyC,GAAIE,GAAIrC,EAC1D,IAAIC,EAAKC,EAAEC,KAAK/D,EAAQgE,kBAAkBjD,EAAMuC,SAASyC,GAAIE,GAAIrC,IAC7DK,EAAa,IAAIC,SAAS,UAAYL,EAAzB,GACjB9C,EAAMuC,SAASyC,GAAIE,GAAI1C,IAAMU,EAE7B1D,EAAO6I,aAEP7I,EAAO8I,aAAatI,EAAMuC,SAAUvC,EAAMqC,kBAAmBvB,EAAMI,IAGtB,mBAAtClB,EAAMuI,WAAWC,mBACxBxI,EAAMuI,WAAWC,kBAAkBxI,EAAMuC,SAAUzB,EAAMI,GAAGG,IAAI,GAAIP,EAAMI,GAAGG,IAAI,GAAIP,EAAMI,GAAGK,OAAO,GAAIT,EAAMI,GAAGK,OAAO,IAI7HwF,GACAlG,EAAgBC,EAAOd,EAAMqC,kBAAmBrB,GAGhDgB,IACApB,EAAuB8E,WAAW,WAC9BC,KACD,IAEPlD,OAAOgG,6BAA+B,MAu5BtCC,iBAr5BJ,SAA0B3G,EAAUD,EAAWd,EAAMiG,EAAKnG,EAAO6H,EAAUC,EAAWzB,EAAUnF,GAAkB,GAC9G,IAAI6G,KAAW9B,GAAoB,EAEnC,GADA9E,aAAarB,GACG,iBAAZ+H,EAA6B,CAC7BE,EAAW,KAAI,gBACfA,EAAa,OAAI9F,EAAE8E,QAAO,KAAU7H,EAAMsC,QAC1CuG,EAAgB,UAAI9F,EAAE8E,QAAO,KAAUZ,GACvC4B,EAAY,MAAI9F,EAAE8E,QAAO,KAAU7H,EAAMgH,wBACzC6B,EAAe,SAAI/H,EACnB+H,EAAe,SAAIF,EACnBE,EAAgB,UAAID,EACpB,IAAIE,EAAW7B,EAAY,OACX,MAAZ6B,IACAA,MAEJtJ,EAAO4D,UAAU,KAAMpD,EAAMqC,kBAAmByG,GAAYV,EAAK,gBAC9D,GAAgB,WAAZO,EAAuB,CAC9BE,EAAW,KAAI,SACfA,EAAa,OAAI9F,EAAE8E,QAAO,KAAU7H,EAAMsC,QAC1CuG,EAAgB,UAAI9F,EAAE8E,QAAO,KAAUZ,GACvC4B,EAAY,MAAI9F,EAAE8E,QAAO,KAAU7H,EAAMgH,wBACzC6B,EAAe,SAAI/H,EACnB+H,EAAe,SAAIF,EACnBE,EAAgB,UAAID,EACpB,IAAIE,EAAW7B,EAAe,UACd,MAAZ6B,IACAA,MAEJtJ,EAAO4D,UAAU,KAAMpD,EAAMqC,kBAAmByG,GAAYV,EAAK,mBAC9D,GAAIO,EAASI,QAAQ,WAAa,EACrCF,EAAW,KAAI,SACfA,EAAa,OAAI9F,EAAE8E,QAAO,KAAU7H,EAAMsC,QAC1CuG,EAAgB,UAAI9F,EAAE8E,QAAO,KAAUZ,GACvC4B,EAAY,MAAI9F,EAAE8E,QAAO,KAAU7H,EAAMgH,wBACzC6B,EAAe,SAAI/H,EACnB+H,EAAe,SAAIF,EACnBE,EAAgB,UAAID,EACpBpJ,EAAO4D,UAAU,MAAOpD,EAAMqC,mBAC1BtB,MAAS6H,EAAU7H,MACnBiI,IAAOJ,EAAUI,IACjBC,UAAaL,EAAUK,UACvBC,GAAMjC,EAAIkC,QACTC,GAAMR,EAAUb,YAClB,GAAIY,EAASI,QAAQ,SAAW,EACnCF,EAAW,KAAI,OACfA,EAAa,OAAI9F,EAAE8E,QAAO,KAAU7H,EAAMsC,QAC1CuG,EAAgB,UAAI9F,EAAE8E,QAAO,KAAUZ,GACvC4B,EAAY,MAAI9F,EAAE8E,QAAO,KAAU7H,EAAMgH,wBACzC6B,EAAe,SAAI/H,EACnB+H,EAAe,SAAIF,EACnBE,EAAgB,UAAID,EACpBpJ,EAAO4D,UAAU,MAAOpD,EAAMqC,mBAC1BtB,MAAS6H,EAAU7H,MACnBiI,IAAOJ,EAAUI,IACjBE,GAAMjC,EAAIkC,MACVE,WAAcpC,EAAIoC,aACjBD,GAAMR,EAAUb,WAClB,CACHc,EAAW,KAAI,gBACfA,EAAY,MAAI9F,EAAE8E,QAAO,KAAU7H,EAAMgH,wBACzC6B,EAAe,SAAI/H,EACnB+H,EAAe,SAAIF,EACnBE,EAAgB,UAAID,EACpB7B,GAAoB,EACpB,IAAK,IAAI7F,EAAI,EAAGA,EAAIJ,EAAMK,OAAQD,IAC9B1B,EAAO8I,aAAatH,EAAMhB,EAAMqC,kBAAmBvB,EAAMI,IAG7DlB,EAAMuH,cACNvH,EAAM4H,OAAOzG,OAAS,EACtB0H,EAAW,KAAI7I,EAAMuC,SACrBsG,EAAc,QAAI7H,EAClB6H,EAAiB,WAAI7I,EAAMqC,kBAC3BwG,EAAe,SAAI9F,EAAE8E,QAAO,KAAU7H,EAAMoC,eAAezB,EAAcX,EAAMqC,oBAAqD,iCACpIwG,EAAkB,YAAI1B,EACtBnH,EAAM8H,OAAOtG,KAAKqH,IAGtB7I,EAAMuC,SAAWvB,EACjB9B,EAAOiJ,uBAAuBnH,GAE9BhB,EAAMoC,eAAezB,EAAcX,EAAMqC,oBAAoBrB,KAAOhB,EAAMuC,SAE/D,MAAP0E,IACAjH,EAAMsC,OAAS2E,EACfjH,EAAMoC,eAAezB,EAAcX,EAAMqC,oBAAoBC,OAAStC,EAAMsC,OAC5E9C,EAAO4D,UAAU,MAAOpD,EAAMqC,kBAAmB4E,GAAOmB,EAAK,YAGjD,MAAZjB,IACAnH,EAAMoC,eAAezB,EAAcX,EAAMqC,oBAAqD,gCAAI8E,EAClG3H,EAAO4D,UAAU,MAAOpD,EAAMqC,kBAAmB8E,GAAYiB,EAAK,qCAGtEpI,EAAMgH,uBAAyBjE,EAAE8E,QAAO,KAAU/G,GAC9Cd,EAAMgH,uBAAuB7F,OAAS,GAEtCZ,IAEAwG,GAEAlG,EAAgBC,EAAOd,EAAMqC,kBAAmBrB,GAGpDa,EAAmBC,EAAWC,GAC1BC,IACApB,EAAuB8E,WAAW,WAC9BC,KACD,IAEPlG,EAAY6J,qBACZ7G,OAAOgG,6BAA+B,MAuyBtCc,eAryBJ,SAAwBvI,EAAMF,EAAOqG,GACjClF,aAAarB,GACTZ,EAAMuH,cACNvH,EAAM4H,OAAOzG,OAAS,EACtBnB,EAAM8H,OAAOtG,MACTuG,KAAQ,cACR/G,KAAQhB,EAAMuC,SACdyF,QAAWhH,EACXF,MAASA,EACTmH,WAAcjI,EAAMqC,kBACpB8E,SAAYpE,EAAE8E,QAAO,KAAU7H,EAAMoC,eAAezB,EAAcX,EAAMqC,oBAAqD,iCAC7HoF,YAAeN,KAIvBnH,EAAMuC,SAAWvB,EACjB9B,EAAOiJ,uBAAuBnI,EAAMuC,UAEpCvC,EAAMoC,eAAezB,EAAcX,EAAMqC,oBAAoBrB,KAAOhB,EAAMuC,SAE1D,MAAZ4E,IACAnH,EAAMoC,eAAezB,EAAcX,EAAMqC,oBAAqD,gCAAI8E,GAGtGtG,EAAgBC,EAAOd,EAAMqC,kBAAmBrB,GAEhDJ,EAAuB8E,WAAW,WAC9BC,KACD,GAEH,IAAK,IAAIzE,EAAI,EAAGA,EAAIJ,EAAMK,OAAQD,IAC9B1B,EAAO8I,aAAatI,EAAMuC,SAAUvC,EAAMqC,kBAAmBvB,EAAMI,KAuwBvEsI,mBAnwBJ,SAA4BxI,EAAMiG,EAAK0B,EAAUC,EAAWa,EAAMC,EAAWC,EAAIC,EAAIC,EAASzC,EAAkB0C,GAC5G,IAAIxC,EAAOtH,EAAMoC,eAAezB,EAAcX,EAAMqC,oBACpD5B,IAEA,IAAIsJ,KACJ,IAAK,IAAIC,KAAK/C,EAAW,MAAG,CACxB,IAAIiC,EAAKjC,EAAW,MAAE+C,GACtB,IAAK,IAAI5I,EAAI8H,EAAG9H,EAAGA,GAAK8H,EAAG9H,EAAI8H,EAAGe,GAAK,EAAG7I,IACtC,IAAK,IAAIE,EAAI4H,EAAG5H,EAAGA,GAAK4H,EAAG5H,EAAI4H,EAAGgB,GAAK,EAAG5I,IACpB,MAAdN,EAAKI,GAAGE,KACRN,EAAKI,GAAGE,OAERF,GAAK8H,EAAG9H,GAAKE,GAAK4H,EAAG5H,EACrBN,EAAKI,GAAGE,GAAG4H,GAAKA,EAEhBlI,EAAKI,GAAGE,GAAG4H,IACP9H,EAAK8H,EAAG9H,EACRE,EAAK4H,EAAG5H,GAGhByI,EAAOvI,MACHJ,EAAKA,EACLE,EAAKA,IAMrB,IAAI6I,KA8BAnK,EAAMuH,cACNvH,EAAM4H,OAAOzG,OAAS,EACtBnB,EAAM8H,OAAOtG,MACTuG,KAAQY,EACRV,WAAcjI,EAAMqC,kBACpBrB,KAAQhB,EAAMuC,SACd6H,QAAWpJ,EACXsB,OAAUS,EAAE8E,QAAO,KAAU7H,EAAMsC,QACnCkF,UAAaP,EACb2B,UAAaA,EACbmB,OAAUA,EACVN,KAAQ1G,EAAE8E,QAAO,KAAUP,EAAKnF,WAChCkI,QAAWZ,EACXU,SAAYA,EACZT,WACI3E,cAAiBhC,EAAE8E,QAAO,KAAUP,EAAKvC,eACzCuF,OAAUvH,EAAE8E,QAAO,KAAUP,EAAKgD,SAEtCC,aAAgBb,EAChBC,GAAM5G,EAAE8E,QAAO,KAAUP,EAAKkD,iCAC9BC,MAASd,EACTC,GAAM7G,EAAE8E,QAAO,KAAUP,EAAKoD,iCAC9BC,MAASf,EACTC,SACIrG,sBAAyBjE,EAAkBiE,sBAC3CC,oBAAuBlE,EAAkBkE,qBAE7CmH,WAAcf,EACdzC,iBAAoBrE,EAAE8E,QAAO,KAAUP,EAAKF,kBAC5CM,oBAAuBN,EACvB0C,UAAa/G,EAAE8E,QAAO,KAAUP,EAAKwC,WACrCe,aAAgBf,EAChB5B,cAAiBZ,EAAKN,2BAG9B,IAAIjG,EAAQ6H,EAAU7H,MAAOiI,EAAMJ,EAAUI,IAAKI,EAAKR,EAAUQ,GACjE,GAAgB,SAAZT,EAAqB,CACrB,IAAIM,EAAYL,EAAUK,UACtB6B,KACJ,GAF+ClC,EAAUmC,QAGrD,GAAU,KAAN3B,EAAW,CACX,IAAI4B,EACa,WAAb/B,EACA+B,EAAOjK,EACa,eAAbkI,IACP+B,EAAOjK,EAAQ,GAEnB,IAAIkK,EAAOD,EAAOhC,EAAM,EACxB,IAAK,IAAI5H,EAAI4J,EAAM5J,GAAK6J,EAAM7J,IAAK,CAC/B,IAAIC,KACJ,IAAK,IAAIC,EAAI,EAAGA,EAAIN,EAAK,GAAGG,OAAQG,IAAK,CACrC,IAAI4J,EAAOlK,EAAKI,GAAGE,GACnBD,EAAIG,KAAK0J,GAEbJ,EAAQtJ,KAAKH,SAEd,GAAU,KAAN+H,EAAW,CAClB,IAAI+B,EACa,WAAblC,EACAkC,EAAOpK,EACa,eAAbkI,IACPkC,EAAOpK,EAAQ,GAEnB,IAAIqK,EAAOD,EAAOnC,EAAM,EACxB,IAAK,IAAI5H,EAAI,EAAGA,EAAIJ,EAAKG,OAAQC,IAAK,CAClC,IAAIC,KACJ,IAAK,IAAIC,EAAI6J,EAAM7J,GAAK8J,EAAM9J,IAAK,CAC/B,IAAI4J,EAAOlK,EAAKI,GAAGE,GACnBD,EAAIG,KAAK0J,GAEbJ,EAAQtJ,KAAKH,IAIzB7B,EAAO4D,UAAU,MAAOpD,EAAMqC,mBAC1BtB,MAASA,EACTiI,IAAOA,EACPC,UAAaA,EACbjI,KAAQ8J,IACP1B,GAAMA,QACQ,SAAZT,GACPnJ,EAAO4D,UAAU,MAAOpD,EAAMqC,mBAC1BtB,MAASA,EACTiI,IAAOA,IACNI,GAAMA,IAGfpJ,EAAMuC,SAAWvB,EACjB9B,EAAOiJ,uBAAuBnI,EAAMuC,UAEpC+E,EAAKtG,KAAOA,EAEZhB,EAAMsC,OAAS2E,EACfK,EAAKhF,OAAStC,EAAMsC,OACpB9C,EAAO4D,UAAU,MAAOpD,EAAMqC,kBAAmB4E,GAAOmB,EAAK,WAE7D,IAAK,IAAI3G,EAAI,EAAGA,EAAIsI,EAAO5I,OAAQM,IAAK,CACpC,IAAI4J,EAAWtB,EAAOtI,GAAGL,EAAGkK,EAAWvB,EAAOtI,GAAGH,EACjD9B,EAAO4D,UAAU,IAAKpD,EAAMqC,kBAAmBrC,EAAMuC,SAAS8I,GAAUC,IACpElK,EAAKiK,EACL/J,EAAKgK,IAIb,GAAI7B,EAAKtI,OAAS,EAGd,IAAK,IAAIM,EAAI,EAAGA,EAAIgI,EAAKtI,OAAQM,IAAK,CAClC,IAAI8J,EAAM9B,EAAKhI,GACX+J,EAAQD,EAAInK,EAAGqK,EAAQF,EAAIjK,EAAGoK,EAAQH,EAAIxK,MAAO4K,EAAczL,EAAesL,EAAOC,EAAOC,EAAO1K,GACnG4K,EAAa3M,EAAQ4M,aAAaF,EAAaH,EAAOC,EAAOC,EAAO,MAAM,GAC9EH,EAAIO,KAAOF,EACP5K,EAAKwK,GAAOC,GAAO5I,GAAK8I,GACxB1L,EAAauL,EAAOC,EAAOzK,EAAM4K,EAAW,IAQxDtE,EAAKnF,UAAYsH,EACjBjK,EAAO4D,UAAU,MAAOpD,EAAMqC,kBAAmBoH,GAAQrB,EAAK,cAC9D,IAAK,IAAI3G,EAAI,EAAGA,EAAI0I,EAAShJ,OAAQM,IAAK,CACtC,IAAIsK,EAAa5B,EAAS1I,GAAGL,EAAG4K,EAAa7B,EAAS1I,GAAGH,EACzD9B,EAAO4D,UAAU,IAAKpD,EAAMqC,kBAAmBrC,EAAMuC,SAASwJ,GAAYC,IACtE5K,EAAK2K,EACLzK,EAAK0K,IAII,MAAbtC,GACApC,EAAKvC,cAAgB2E,EAAU3E,cAC/BuC,EAAKgD,OAASZ,EAAUY,SAExBhD,EAAKvC,cAAgB,KACrBuC,EAAKgD,OAAS,MAElB5J,EAAoB4G,EAAKvC,cAAeuC,EAAKgD,QAC7C9K,EAAO4D,UAAU,MAAOpD,EAAMqC,kBAAmBiF,EAAKvC,eAAiBqD,EAAK,kBAC5E5I,EAAO4D,UAAU,MAAOpD,EAAMqC,kBAAmBiF,EAAKgD,QAAUlC,EAAK,WAErEd,EAAKkD,gCAAkCb,EACvCnK,EAAO4D,UAAU,MAAOpD,EAAMqC,kBAAmBiF,EAAKkD,iCAAmCpC,EAAK,oCAE9Fd,EAAKoD,gCAAkCd,EACvCpK,EAAO4D,UAAU,MAAOpD,EAAMqC,kBAAmBiF,EAAKoD,iCAAmCtC,EAAK,oCAE/E,MAAXyB,GACAtK,EAAkBiE,sBAAwBqG,EAAQrG,sBAClDjE,EAAkBkE,oBAAsBoG,EAAQpG,sBAEhDlE,EAAkBiE,sBAAwB,KAC1CjE,EAAkBkE,oBAAsB,MAG5C9D,EAAqByH,iBAAmBA,EACxCE,EAAKF,iBAAmBA,EACxB5H,EAAO4D,UAAU,MAAOpD,EAAMqC,kBAAmBiF,EAAKF,kBAAoBgB,EAAK,qBAE/ExI,EAAckK,UAAYA,EAC1BxC,EAAKwC,UAAYA,EACjBtK,EAAO4D,UAAU,MAAOpD,EAAMqC,kBAAmBiF,EAAKwC,WAAa1B,EAAK,cAExEvG,EAAmB7B,EAAMuC,SAASpB,OAAQnB,EAAMuC,SAAS,GAAGpB,SAsiB5D8K,yBAniBJ,SAAkCjL,EAAMiG,EAAKiF,EAAMzC,EAAMC,EAAWC,EAAIvC,EAAkB0C,GACtF,IAAIxC,EAAOtH,EAAMoC,eAAezB,EAAcX,EAAMqC,oBACpDJ,aAAarB,GACbH,IAEA,IAAIsJ,KACJ,GAAoC,MAAhCoC,KAAKC,UAAUnF,EAAW,OAC1B,IAAK,IAAI7F,EAAI,EAAGA,EAAIJ,EAAKG,OAAQC,IAC7B,IAAK,IAAIE,EAAI,EAAGA,EAAIN,EAAK,GAAGG,OAAQG,IAAK,CACrC,IAAI4J,EAAOlK,EAAKI,GAAGE,GACP,MAAR4J,GAA2B,MAAXA,EAAKhC,YACdgC,EAAKhC,GACZa,EAAOvI,MACHJ,EAAKA,EACLE,EAAKA,UAMrB,IAAK,IAAI0I,KAAK/C,EAAW,MAAG,CACxB,IAAIiC,EAAKjC,EAAW,MAAE+C,GACtB,IAAK,IAAI5I,EAAI8H,EAAG9H,EAAGA,GAAK8H,EAAG9H,EAAI8H,EAAGe,GAAK,EAAG7I,IACtC,IAAK,IAAIE,EAAI4H,EAAG5H,EAAGA,GAAK4H,EAAG5H,EAAI4H,EAAGgB,GAAK,EAAG5I,IACpB,MAAdN,EAAKI,GAAGE,KACRN,EAAKI,GAAGE,OAERF,GAAK8H,EAAG9H,GAAKE,GAAK4H,EAAG5H,EACrBN,EAAKI,GAAGE,GAAG4H,GAAKA,EAEhBlI,EAAKI,GAAGE,GAAG4H,IACP9H,EAAK8H,EAAG9H,EACRE,EAAK4H,EAAG5H,GAGhByI,EAAOvI,MACHJ,EAAKA,EACLE,EAAKA,IAOzB,IAAI6I,KA4DJ,GAlCInK,EAAMuH,cACNvH,EAAM4H,OAAOzG,OAAS,EACtBnB,EAAM8H,OAAOtG,MACTuG,KAAQ,aACRE,WAAcjI,EAAMqC,kBACpB6J,KAAQA,EACRlL,KAAQhB,EAAMuC,SACd6H,QAAWpJ,EACXsB,OAAUS,EAAE8E,QAAO,KAAU7H,EAAMsC,QACnCkF,UAAaP,EACb8C,OAAUA,EACVN,KAAQ1G,EAAE8E,QAAO,KAAUP,EAAKnF,WAChCkI,QAAWZ,EACXU,SAAYA,EACZT,WACI3E,cAAiBhC,EAAE8E,QAAO,KAAUP,EAAKvC,eACzCuF,OAAUvH,EAAE8E,QAAO,KAAUP,EAAKgD,SAEtCC,aAAgBb,EAChBC,GAAM5G,EAAE8E,QAAO,KAAUP,EAAKkD,iCAC9BC,MAASd,EACTvC,iBAAoBrE,EAAE8E,QAAO,KAAUP,EAAKF,kBAC5CM,oBAAuBN,EACvB0C,UAAa/G,EAAE8E,QAAO,KAAUP,EAAKwC,WACrCe,aAAgBf,EAChB5B,cAAiBZ,EAAKN,2BAI9BhH,EAAMuC,SAAWvB,EACjB9B,EAAOiJ,uBAAuBnI,EAAMuC,UAEpC+E,EAAKtG,KAAOA,EAERxB,EAAO6I,YAAa,CACpB,IACIvH,EADAiH,EAAOmE,EAAKnE,KAAMpD,EAAMuH,EAAKvH,IAAK0H,EAAMH,EAAKG,IAAKC,EAAMJ,EAAKI,IAAKC,EAAML,EAAKK,IAErE,UAARxE,EACAjH,GACIO,KACIsD,EACA3D,EAAKG,OAAS,GAElBI,QACI+K,EACAC,IAGO,YAARxE,IACPjH,GACIO,KACIsD,EACA0H,GAEJ9K,QACI+K,EACAtL,EAAK,GAAGG,OAAS,KAI7B3B,EAAO8I,aAAatI,EAAMuC,SAAUvC,EAAMqC,kBAAmBvB,GAGjEd,EAAMsC,OAAS2E,EACfK,EAAKhF,OAAStC,EAAMsC,OACpB9C,EAAO4D,UAAU,MAAOpD,EAAMqC,kBAAmB4E,GAAOmB,EAAK,WAE7D,IAAK,IAAI3G,EAAI,EAAGA,EAAIsI,EAAO5I,OAAQM,IAAK,CACpC,IAAI4J,EAAWtB,EAAOtI,GAAGL,EAAGkK,EAAWvB,EAAOtI,GAAGH,EACjD9B,EAAO4D,UAAU,IAAKpD,EAAMqC,kBAAmBrC,EAAMuC,SAAS8I,GAAUC,IACpElK,EAAKiK,EACL/J,EAAKgK,IAIb,GAAI7B,EAAKtI,OAAS,EAEd,IAAK,IAAIM,EAAI,EAAGA,EAAIgI,EAAKtI,OAAQM,IAAK,CAClC,IAAI8J,EAAM9B,EAAKhI,GACX+J,EAAQD,EAAInK,EAAGqK,EAAQF,EAAIjK,EAAGoK,EAAQH,EAAIxK,MAAO4K,EAAczL,EAAesL,EAAOC,EAAOC,EAAO1K,GACnG4K,EAAa3M,EAAQ4M,aAAaF,EAAaH,EAAOC,EAAOC,EAAO,MAAM,GAC9EH,EAAIO,KAAOF,EACP5K,EAAKwK,GAAOC,GAAO5I,GAAK8I,GACxB1L,EAAauL,EAAOC,EAAOzK,EAAM4K,EAAW,IAMxDtE,EAAKnF,UAAYsH,EACjBjK,EAAO4D,UAAU,MAAOpD,EAAMqC,kBAAmBoH,GAAQrB,EAAK,cAC9D,IAAK,IAAI3G,EAAI,EAAGA,EAAI0I,EAAShJ,OAAQM,IAAK,CACtC,IAAIsK,EAAa5B,EAAS1I,GAAGL,EAAG4K,EAAa7B,EAAS1I,GAAGH,EACzD9B,EAAO4D,UAAU,IAAKpD,EAAMqC,kBAAmBrC,EAAMuC,SAASwJ,GAAYC,IACtE5K,EAAK2K,EACLzK,EAAK0K,IAII,MAAbtC,GACApC,EAAKvC,cAAgB2E,EAAU3E,cAC/BuC,EAAKgD,OAASZ,EAAUY,SAExBhD,EAAKvC,cAAgB,KACrBuC,EAAKgD,OAAS,MAElB5J,EAAoB4G,EAAKvC,cAAeuC,EAAKgD,QAC7C9K,EAAO4D,UAAU,MAAOpD,EAAMqC,kBAAmBiF,EAAKvC,eAAiBqD,EAAK,kBAC5E5I,EAAO4D,UAAU,MAAOpD,EAAMqC,kBAAmBiF,EAAKgD,QAAUlC,EAAK,WAErEd,EAAKkD,gCAAkCb,EACvCnK,EAAO4D,UAAU,MAAOpD,EAAMqC,kBAAmBiF,EAAKkD,iCAAmCpC,EAAK,oCAE9FzI,EAAqByH,iBAAmBA,EACxCE,EAAKF,iBAAmBA,EACxB5H,EAAO4D,UAAU,MAAOpD,EAAMqC,kBAAmBiF,EAAKF,kBAAoBgB,EAAK,qBAE/ExI,EAAckK,UAAYA,EAC1BxC,EAAKwC,UAAYA,EACjBtK,EAAO4D,UAAU,MAAOpD,EAAMqC,kBAAmBiF,EAAKwC,WAAa1B,EAAK,cACxExH,EAAuB8E,WAAW,WAC9BC,KACD,IAoWH6G,sBAjWJ,SAA+BC,EAAQC,EAAQxF,GAE3C,IAuCIyF,EAvCAC,KACJ3N,EAAQgC,qBACRgB,aAAarB,GACb,IAAK,IAAIQ,EAAIqL,EAAc,MAAEpL,IAAI,GAAID,GAAKqL,EAAc,MAAEpL,IAAI,GAAID,IAC9D,IAAK,IAAIE,EAAImL,EAAc,MAAElL,OAAO,GAAID,GAAKmL,EAAc,MAAElL,OAAO,GAAID,IAChEF,EAAI,IAAME,EAAI,IAAMmL,EAAmB,cAAKG,IAGhDA,EAASxL,EAAI,IAAME,EAAI,IAAMmL,EAAmB,YAAK,EACrDxN,EAAQgC,kBAAkBO,MACtBJ,EAAKA,EACLE,EAAKA,EACLG,EAAKgL,EAAmB,cAIpC,IAAK,IAAIrL,EAAIsL,EAAc,MAAErL,IAAI,GAAID,GAAKsL,EAAc,MAAErL,IAAI,GAAID,IAC9D,IAAK,IAAIE,EAAIoL,EAAc,MAAEnL,OAAO,GAAID,GAAKoL,EAAc,MAAEnL,OAAO,GAAID,IAChEF,EAAI,IAAME,EAAI,IAAMoL,EAAmB,cAAKE,IAGhDA,EAASxL,EAAI,IAAME,EAAI,IAAMoL,EAAmB,YAAK,EACrDzN,EAAQgC,kBAAkBO,MACtBJ,EAAKA,EACLE,EAAKA,EACLG,EAAKiL,EAAmB,cAwBpC,GApBI1M,EAAMuH,cACNvH,EAAM4H,OAAOzG,OAAS,EACtBnB,EAAM8H,OAAOtG,MACTuG,KAAQ,WACR0E,OAAUA,EACVC,OAAUA,EACVxF,WAAcA,KAKlBlH,EAAMqC,mBAAqBoK,EAAmB,YAC9CzM,EAAMsC,OAASmK,EAAkB,UACjCE,EAAYF,EAAgB,QAAEtL,OAC9BnB,EAAMoC,eAAezB,EAAc+L,EAAmB,aAAY,OAAIA,EAAkB,WACjF1M,EAAMqC,mBAAqBqK,EAAmB,aACrD1M,EAAMsC,OAASoK,EAAkB,UACjCC,EAAYD,EAAgB,QAAEvL,OAC9BnB,EAAMoC,eAAezB,EAAc8L,EAAmB,aAAY,OAAIA,EAAkB,WAExFvF,EAAY,CACZlH,EAAM+D,kBACN/D,EAAM6M,UAAY,EAClB,IAAK,IAAIpL,EAAI,EAAGA,EAAIkL,EAAWlL,IAAK,CAChC,IAAIqL,EAAS9M,EAAM+M,cACW,MAA1B/M,EAAMsC,OAAe,QAA0C,MAA7BtC,EAAMsC,OAAe,OAAEb,KACzDqL,EAAS9M,EAAMsC,OAAe,OAAEb,IAEH,MAA7BzB,EAAMsC,OAAkB,WAA6C,MAAhCtC,EAAMsC,OAAkB,UAAEb,IAK/DzB,EAAM6M,WAAaC,EAAS,EAEhC9M,EAAM+D,eAAevC,KAAKxB,EAAM6M,aAN5BC,EAAS9M,EAAMsC,OAAkB,UAAEb,GACnCzB,EAAM+D,eAAevC,KAAKxB,EAAM6M,YAUxC,GAFA7M,EAAM6M,WAAa,IAEf7M,EAAMqC,mBAAqBoK,EAAmB,WAAG,CACjD,IAAIO,EAAY7M,EAAiBuM,EAAgB,QAAEvL,OAAQuL,EAAkB,WAC7E1M,EAAMoC,eAAezB,EAAc+L,EAAmB,aAAoB,eAAIM,OAC3E,GAAIhN,EAAMqC,mBAAqBqK,EAAmB,WAAG,CACxD,IAAIM,EAAY7M,EAAiBsM,EAAgB,QAAEtL,OAAQsL,EAAkB,WAC7EzM,EAAMoC,eAAezB,EAAc8L,EAAmB,aAAoB,eAAIO,GAIlFhN,EAAMqC,mBAAqBoK,EAAmB,YAC9CzM,EAAMuC,SAAWkK,EAAgB,QACjCzM,EAAMoC,eAAezB,EAAc+L,EAAmB,aAAU,KAAIA,EAAgB,SAC7E1M,EAAMqC,mBAAqBqK,EAAmB,aACrD1M,EAAMuC,SAAWmK,EAAgB,QACjC1M,EAAMoC,eAAezB,EAAc8L,EAAmB,aAAU,KAAIA,EAAgB,SAExFvN,EAAOiJ,uBAAuBnI,EAAMuC,UAEpCvC,EAAMoC,eAAezB,EAAcX,EAAMqC,oBAAoBrB,KAAOhB,EAAMuC,SAEtEvC,EAAMqC,mBAAqBqK,EAAmB,WAC9C1M,EAAMgH,yBACE3F,IAAOqL,EAAc,MAAErL,IACvBE,OAAUmL,EAAc,MAAEnL,SAGlCvB,EAAMgH,yBACE3F,IAAOoL,EAAc,MAAEpL,IACvBE,OAAUkL,EAAc,MAAElL,SAGlCvB,EAAMgH,uBAAuB7F,OAAS,GAEtCZ,IAGJP,EAAMoC,eAAezB,EAAc8L,EAAmB,aAAIjC,gCAAkCiC,EAAoB,YAChHzM,EAAMoC,eAAezB,EAAc+L,EAAmB,aAAIlC,gCAAkCkC,EAAoB,YAE5G1M,EAAMqC,mBAAqBoK,EAAmB,WAC9C9M,EAAqByH,iBAAmBqF,EAA4B,oBAC7DzM,EAAMqC,mBAAqBqK,EAAmB,aACrD/M,EAAqByH,iBAAmBsF,EAA4B,qBAExE1M,EAAMoC,eAAezB,EAAc8L,EAAmB,aAAIrF,iBAAmBqF,EAA4B,oBACzGzM,EAAMoC,eAAezB,EAAc+L,EAAmB,aAAItF,iBAAmBsF,EAA4B,oBACzGzN,EAAQgC,kBAAkBS,UAC1BzC,EAAQ0C,kBAAkB,KAAM,KAAM,KAAM,KAAM+K,EAAgB,SAClEzN,EAAQ2C,uBAAyB,KACjChB,EAAuB8E,WAAW,WAC9BC,KACD,GACHlG,EAAY6J,qBAIZ9J,EAAO4D,UAAU,MAAOqJ,EAAmB,WAAGA,EAAkB,WAAKrE,EAAK,WAE1E5I,EAAO4D,UAAU,MAAOsJ,EAAmB,WAAGA,EAAkB,WAAKtE,EAAK,WAE1E5I,EAAO8I,aAAamE,EAAgB,QAAGA,EAAmB,YACtDpL,IAAOoL,EAAc,MAAO,IAC5BlL,OAAUkL,EAAc,MAAU,SAGtCjN,EAAO8I,aAAaoE,EAAgB,QAAGA,EAAmB,YACtDrL,IAAOqL,EAAc,MAAO,IAC5BnL,OAAUmL,EAAc,MAAU,SAGtClN,EAAO4D,UAAU,MAAOqJ,EAAmB,WAAGA,EAAoB,aAAKrE,EAAK,oCAE5E5I,EAAO4D,UAAU,MAAOsJ,EAAmB,WAAGA,EAAoB,aAAKtE,EAAK,oCAE5E5I,EAAO4D,UAAU,MAAOqJ,EAAmB,WAAGA,EAA4B,qBAAKrE,EAAK,qBAEpF5I,EAAO4D,UAAU,MAAOsJ,EAAmB,WAAGA,EAA4B,qBAAKtE,EAAK,sBA+MpFvG,mBAAAA,EACA8D,sBAAAA","file":"../../global/refresh.js","sourcesContent":["define([\n    './rhchInit',\n    './formula',\n    './editor',\n    './setdata',\n    './getdata',\n    './getRowlen',\n    './draw',\n    '../controllers/freezen',\n    '../controllers/server',\n    '../controllers/sheetmanage',\n    '../controllers/postil',\n    '../controllers/dataVerificationCtrl',\n    '../controllers/hyperlinkCtrl',\n    '../controllers/select',\n    '../controllers/filter',\n    '../methods/get',\n    '../store'\n], function (rhchInit, formula, editor, m_setdata, m_getdata, m_getRowlen, m_draw, luckysheetFreezen, server, sheetmanage, luckysheetPostil, dataVerificationCtrl, hyperlinkCtrl, m_select, m_filter, m_get, Store) {\n    'use strict';\n    const {setcellvalue} = m_setdata;\n    const {getcellFormula} = m_getdata;\n    const {computeRowlenArr} = m_getRowlen;\n    const {luckysheetDrawMain, luckysheetDrawgridRowTitle, luckysheetDrawgridColumnTitle} = m_draw;\n    const {selectHightlightShow, selectionCopyShow, collaborativeEditBox} = m_select;\n    const {createFilterOptions} = m_filter;\n    const {getSheetIndex} = m_get;\n    let refreshCanvasTimeOut = null;\n    function runExecFunction(range, index, data) {\n        formula.execFunctionExist = [];\n        for (let s = 0; s < range.length; s++) {\n            for (let r = range[s].row[0]; r <= range[s].row[1]; r++) {\n                for (let c = range[s].column[0]; c <= range[s].column[1]; c++) {\n                    formula.execFunctionExist.push({\n                        'r': r,\n                        'c': c,\n                        'i': index\n                    });\n                }\n            }\n        }\n        formula.execFunctionExist.reverse();\n        formula.execFunctionGroup(null, null, null, null, data);\n        formula.execFunctionGlobalData = null;\n    }\n    function jfrefreshgrid(data, range, allParam, isRunExecFunction = true, isRefreshCanvas = true) {\n        if (data == null) {\n            data = Store.flowdata;\n        }\n        if (range == null) {\n            range = Store.luckysheet_select_save;\n        }\n        clearTimeout(refreshCanvasTimeOut);    //关联参数\n        //关联参数\n        if (allParam == null) {\n            allParam = {};\n        }\n        let cfg = allParam['cfg'];    //config\n        //config\n        let RowlChange = allParam['RowlChange'];    //行高改变\n        //行高改变\n        let cdformat = allParam['cdformat'];    //条件格式\n        //条件格式\n        let dataVerification = allParam['dataVerification'];    //数据验证\n        //数据验证\n        let dynamicArray = allParam['dynamicArray'];    //动态数组\n        //动态数组\n        let file = Store.luckysheetfile[getSheetIndex(Store.currentSheetIndex)];\n        if (Store.clearjfundo) {\n            Store.jfundo.length = 0;\n            let curConfig;\n            if (cfg == null) {\n                curConfig = $.extend(true, {}, Store.config);\n            } else {\n                curConfig = $.extend(true, {}, cfg);\n            }\n            let curCdformat;\n            if (cdformat == null) {\n                curCdformat = $.extend(true, [], file['luckysheet_conditionformat_save']);\n            } else {\n                curCdformat = cdformat;\n            }\n            let curDataVerification;\n            if (dataVerification == null) {\n                curDataVerification = $.extend(true, {}, file['dataVerification']);\n            } else {\n                curDataVerification = dataVerification;\n            }\n            let curDynamicArray;\n            if (dynamicArray == null) {\n                curDynamicArray = $.extend(true, [], file['dynamicArray']);\n            } else {\n                curDynamicArray = dynamicArray;\n            }\n            Store.jfredo.push({\n                'type': 'datachange',\n                'data': Store.flowdata,\n                'curdata': data,\n                'sheetIndex': Store.currentSheetIndex,\n                'range': range,\n                'config': $.extend(true, {}, Store.config),\n                'curConfig': curConfig,\n                'cdformat': $.extend(true, [], file['luckysheet_conditionformat_save']),\n                'curCdformat': curCdformat,\n                'RowlChange': RowlChange,\n                'dataVerification': $.extend(true, [], file['dataVerification']),\n                'curDataVerification': curDataVerification,\n                'dynamicArray': $.extend(true, [], file['dynamicArray']),\n                'curDynamicArray': curDynamicArray,\n                'dataRange': [...file.luckysheet_select_save]\n            });\n        }    //Store.flowdata\n        //Store.flowdata\n        Store.flowdata = data;\n        editor.webWorkerFlowDataCache(Store.flowdata);    //worker存数据\n        //worker存数据\n        file.data = Store.flowdata;    //config\n        //config\n        if (cfg != null) {\n            Store.config = cfg;\n            file.config = Store.config;\n            server.saveParam('all', Store.currentSheetIndex, cfg, { 'k': 'config' });\n            if (RowlChange != null) {\n                jfrefreshgrid_rhcw(Store.flowdata.length, Store.flowdata[0].length);\n            }\n        }    //条件格式\n        //条件格式\n        if (cdformat != null) {\n            file['luckysheet_conditionformat_save'] = cdformat;\n            server.saveParam('all', Store.currentSheetIndex, cdformat, { 'k': 'luckysheet_conditionformat_save' });\n        }    //数据验证\n        //数据验证\n        if (dataVerification != null) {\n            dataVerificationCtrl.dataVerification = dataVerification;\n            file['dataVerification'] = dataVerification;\n            server.saveParam('all', Store.currentSheetIndex, dataVerification, { 'k': 'dataVerification' });\n        }    //动态数组\n        //动态数组\n        if (dynamicArray != null) {\n            file['dynamicArray'] = dynamicArray;\n            server.saveParam('all', Store.currentSheetIndex, dynamicArray, { 'k': 'dynamicArray' });\n        }    //更新数据的范围\n        //更新数据的范围\n        for (let s = 0; s < range.length; s++) {\n            let r1 = range[s].row[0];\n            let c1 = range[s].column[0];\n            if (Store.flowdata[r1][c1] != null && Store.flowdata[r1][c1].spl != null) {\n                window.luckysheetCurrentRow = r1;\n                window.luckysheetCurrentColumn = c1;\n                window.luckysheetCurrentFunction = Store.flowdata[r1][c1].f;\n                let fp = $.trim(formula.functionParserExe(Store.flowdata[r1][c1].f));\n                let sparklines = new Function('return ' + fp)();\n                Store.flowdata[r1][c1].spl = sparklines;\n            }\n            if (server.allowUpdate) {\n                //共享编辑模式\n                server.historyParam(Store.flowdata, Store.currentSheetIndex, range[s]);\n            }    // 刷新图表\n            // 刷新图表\n            if (typeof Store.chartparam.jfrefreshchartall == 'function') {\n                Store.chartparam.jfrefreshchartall(Store.flowdata, range[s].row[0], range[s].row[1], range[s].column[0], range[s].column[1]);\n            }\n        }    //单元格数据更新联动\n        //单元格数据更新联动\n        if (isRunExecFunction) {\n            runExecFunction(range, Store.currentSheetIndex, data);\n        }    //刷新表格\n        //刷新表格\n        if (isRefreshCanvas) {\n            refreshCanvasTimeOut = setTimeout(function () {\n                luckysheetrefreshgrid();\n            }, 1);\n        }\n        window.luckysheet_getcelldata_cache = null;\n    }\n    function jfrefreshgridall(colwidth, rowheight, data, cfg, range, ctrlType, ctrlValue, cdformat, isRefreshCanvas = true) {\n        let redo = {}, isRunExecFunction = false;\n        clearTimeout(refreshCanvasTimeOut);\n        if (ctrlType == 'cellRowChange') {\n            redo['type'] = 'cellRowChange';\n            redo['config'] = $.extend(true, {}, Store.config);\n            redo['curconfig'] = $.extend(true, {}, cfg);\n            redo['range'] = $.extend(true, [], Store.luckysheet_select_save);\n            redo['currange'] = range;\n            redo['ctrlType'] = ctrlType;\n            redo['ctrlValue'] = ctrlValue;\n            let setfield = cfg['rowlen'];\n            if (setfield == null) {\n                setfield = {};\n            }\n            server.saveParam('cg', Store.currentSheetIndex, setfield, { 'k': 'rowlen' });\n        } else if (ctrlType == 'resizeC') {\n            redo['type'] = 'resize';\n            redo['config'] = $.extend(true, {}, Store.config);\n            redo['curconfig'] = $.extend(true, {}, cfg);\n            redo['range'] = $.extend(true, [], Store.luckysheet_select_save);\n            redo['currange'] = range;\n            redo['ctrlType'] = ctrlType;\n            redo['ctrlValue'] = ctrlValue;\n            let setfield = cfg['columnlen'];\n            if (setfield == null) {\n                setfield = {};\n            }\n            server.saveParam('cg', Store.currentSheetIndex, setfield, { 'k': 'columnlen' });\n        } else if (ctrlType.indexOf('extend') > -1) {\n            redo['type'] = 'extend';\n            redo['config'] = $.extend(true, {}, Store.config);\n            redo['curconfig'] = $.extend(true, {}, cfg);\n            redo['range'] = $.extend(true, [], Store.luckysheet_select_save);\n            redo['currange'] = range;\n            redo['ctrlType'] = ctrlType;\n            redo['ctrlValue'] = ctrlValue;\n            server.saveParam('arc', Store.currentSheetIndex, {\n                'index': ctrlValue.index,\n                'len': ctrlValue.len,\n                'direction': ctrlValue.direction,\n                'mc': cfg.merge\n            }, { 'rc': ctrlValue.type });\n        } else if (ctrlType.indexOf('dele') > -1) {\n            redo['type'] = 'dele';\n            redo['config'] = $.extend(true, {}, Store.config);\n            redo['curconfig'] = $.extend(true, {}, cfg);\n            redo['range'] = $.extend(true, [], Store.luckysheet_select_save);\n            redo['currange'] = range;\n            redo['ctrlType'] = ctrlType;\n            redo['ctrlValue'] = ctrlValue;\n            server.saveParam('drc', Store.currentSheetIndex, {\n                'index': ctrlValue.index,\n                'len': ctrlValue.len,\n                'mc': cfg.merge,\n                'borderInfo': cfg.borderInfo\n            }, { 'rc': ctrlValue.type });\n        } else {\n            redo['type'] = 'datachangeAll';\n            redo['range'] = $.extend(true, [], Store.luckysheet_select_save);\n            redo['currange'] = range;\n            redo['ctrlType'] = ctrlType;\n            redo['ctrlValue'] = ctrlValue;\n            isRunExecFunction = true;\n            for (let s = 0; s < range.length; s++) {\n                server.historyParam(data, Store.currentSheetIndex, range[s]);\n            }\n        }\n        if (Store.clearjfundo) {\n            Store.jfundo.length = 0;\n            redo['data'] = Store.flowdata;\n            redo['curdata'] = data;\n            redo['sheetIndex'] = Store.currentSheetIndex;\n            redo['cdformat'] = $.extend(true, [], Store.luckysheetfile[getSheetIndex(Store.currentSheetIndex)]['luckysheet_conditionformat_save']);\n            redo['curCdformat'] = cdformat;\n            Store.jfredo.push(redo);\n        }    //Store.flowdata\n        //Store.flowdata\n        Store.flowdata = data;\n        editor.webWorkerFlowDataCache(data);    //worker存数据\n        //worker存数据\n        Store.luckysheetfile[getSheetIndex(Store.currentSheetIndex)].data = Store.flowdata;    //config\n        //config\n        if (cfg != null) {\n            Store.config = cfg;\n            Store.luckysheetfile[getSheetIndex(Store.currentSheetIndex)].config = Store.config;\n            server.saveParam('all', Store.currentSheetIndex, cfg, { 'k': 'config' });\n        }    //条件格式\n        //条件格式\n        if (cdformat != null) {\n            Store.luckysheetfile[getSheetIndex(Store.currentSheetIndex)]['luckysheet_conditionformat_save'] = cdformat;\n            server.saveParam('all', Store.currentSheetIndex, cdformat, { 'k': 'luckysheet_conditionformat_save' });\n        }    //选区\n        //选区\n        Store.luckysheet_select_save = $.extend(true, [], range);\n        if (Store.luckysheet_select_save.length > 0) {\n            //有选区时，刷新一下选区\n            selectHightlightShow();\n        }\n        if (isRunExecFunction) {\n            //单元格数据更新联动\n            runExecFunction(range, Store.currentSheetIndex, data);\n        }    //行高、列宽 刷新  \n        //行高、列宽 刷新  \n        jfrefreshgrid_rhcw(rowheight, colwidth);\n        if (isRefreshCanvas) {\n            refreshCanvasTimeOut = setTimeout(function () {\n                luckysheetrefreshgrid();\n            }, 1);\n        }\n        sheetmanage.storeSheetParamALL();\n        window.luckysheet_getcelldata_cache = null;\n    }\n    function jfrefreshrange(data, range, cdformat) {\n        clearTimeout(refreshCanvasTimeOut);\n        if (Store.clearjfundo) {\n            Store.jfundo.length = 0;\n            Store.jfredo.push({\n                'type': 'rangechange',\n                'data': Store.flowdata,\n                'curdata': data,\n                'range': range,\n                'sheetIndex': Store.currentSheetIndex,\n                'cdformat': $.extend(true, [], Store.luckysheetfile[getSheetIndex(Store.currentSheetIndex)]['luckysheet_conditionformat_save']),\n                'curCdformat': cdformat\n            });\n        }    //flowdata\n        //flowdata\n        Store.flowdata = data;\n        editor.webWorkerFlowDataCache(Store.flowdata);    //worker存数据\n        //worker存数据\n        Store.luckysheetfile[getSheetIndex(Store.currentSheetIndex)].data = Store.flowdata;    //条件格式\n        //条件格式\n        if (cdformat != null) {\n            Store.luckysheetfile[getSheetIndex(Store.currentSheetIndex)]['luckysheet_conditionformat_save'] = cdformat;\n        }    //单元格数据更新联动\n        //单元格数据更新联动\n        runExecFunction(range, Store.currentSheetIndex, data);    //刷新表格\n        //刷新表格\n        refreshCanvasTimeOut = setTimeout(function () {\n            luckysheetrefreshgrid();\n        }, 1);    //发送给后台\n        //发送给后台\n        for (let s = 0; s < range.length; s++) {\n            server.historyParam(Store.flowdata, Store.currentSheetIndex, range[s]);\n        }\n    }    //删除、增加行列 刷新表格\n    //删除、增加行列 刷新表格\n    function jfrefreshgrid_adRC(data, cfg, ctrlType, ctrlValue, calc, filterObj, cf, af, freezen, dataVerification, hyperlink) {\n        let file = Store.luckysheetfile[getSheetIndex(Store.currentSheetIndex)];\n        collaborativeEditBox();    //merge改变对应的单元格值改变\n        //merge改变对应的单元格值改变\n        let mcData = [];\n        for (let m in cfg['merge']) {\n            let mc = cfg['merge'][m];\n            for (let r = mc.r; r <= mc.r + mc.rs - 1; r++) {\n                for (let c = mc.c; c <= mc.c + mc.cs - 1; c++) {\n                    if (data[r][c] == null) {\n                        data[r][c] = {};\n                    }\n                    if (r == mc.r && c == mc.c) {\n                        data[r][c].mc = mc;\n                    } else {\n                        data[r][c].mc = {\n                            'r': mc.r,\n                            'c': mc.c\n                        };\n                    }\n                    mcData.push({\n                        'r': r,\n                        'c': c\n                    });\n                }\n            }\n        }    //公式链中公式范围改变对应单元格值的改变\n        //公式链中公式范围改变对应单元格值的改变\n        let funcData = [];    // if(calc.length > 0){\n                              //     // 取消execFunctionGroupData，改用execFunctionGlobalData\n                              //     // formula.execFunctionGroupData = data;\n                              //     for(let i = 0; i < calc.length; i++){\n                              //         let clc = calc[i];\n                              //         let clc_r = clc.r, clc_c = clc.c, clc_i = clc.index, clc_funcStr =  getcellFormula(clc_r, clc_c, clc_i, data);\n                              //         let clc_result = formula.execfunction(clc_funcStr, clc_r, clc_c, clc_i,null, true);\n                              //         clc.func = clc_result;\n                              //         if(data[clc_r][clc_c].f == clc_funcStr){\n                              //             setcellvalue(clc_r, clc_c, data, clc_result[1]);\n                              //             // funcData存储当前结果没有用处，每次还是需要从calc公式链实时从当前数据中计算比较靠谱\n                              //             // funcData.push({ \"r\": clc_r, \"c\": clc_c });\n                              //         }\n                              //     }\n                              // }\n        // if(calc.length > 0){\n        //     // 取消execFunctionGroupData，改用execFunctionGlobalData\n        //     // formula.execFunctionGroupData = data;\n        //     for(let i = 0; i < calc.length; i++){\n        //         let clc = calc[i];\n        //         let clc_r = clc.r, clc_c = clc.c, clc_i = clc.index, clc_funcStr =  getcellFormula(clc_r, clc_c, clc_i, data);\n        //         let clc_result = formula.execfunction(clc_funcStr, clc_r, clc_c, clc_i,null, true);\n        //         clc.func = clc_result;\n        //         if(data[clc_r][clc_c].f == clc_funcStr){\n        //             setcellvalue(clc_r, clc_c, data, clc_result[1]);\n        //             // funcData存储当前结果没有用处，每次还是需要从calc公式链实时从当前数据中计算比较靠谱\n        //             // funcData.push({ \"r\": clc_r, \"c\": clc_c });\n        //         }\n        //     }\n        // }\n        if (Store.clearjfundo) {\n            Store.jfundo.length = 0;\n            Store.jfredo.push({\n                'type': ctrlType,\n                'sheetIndex': Store.currentSheetIndex,\n                'data': Store.flowdata,\n                'curData': data,\n                'config': $.extend(true, {}, Store.config),\n                'curConfig': cfg,\n                'ctrlValue': ctrlValue,\n                'mcData': mcData,\n                'calc': $.extend(true, [], file.calcChain),\n                'curCalc': calc,\n                'funcData': funcData,\n                'filterObj': {\n                    'filter_select': $.extend(true, {}, file.filter_select),\n                    'filter': $.extend(true, {}, file.filter)\n                },\n                'curFilterObj': filterObj,\n                'cf': $.extend(true, [], file.luckysheet_conditionformat_save),\n                'curCf': cf,\n                'af': $.extend(true, [], file.luckysheet_alternateformat_save),\n                'curAf': af,\n                'freezen': {\n                    'freezenhorizontaldata': luckysheetFreezen.freezenhorizontaldata,\n                    'freezenverticaldata': luckysheetFreezen.freezenverticaldata\n                },\n                'curFreezen': freezen,\n                'dataVerification': $.extend(true, {}, file.dataVerification),\n                'curDataVerification': dataVerification,\n                'hyperlink': $.extend(true, {}, file.hyperlink),\n                'curHyperlink': hyperlink,\n                'dataRange': [...file.luckysheet_select_save]\n            });\n        }\n        let index = ctrlValue.index, len = ctrlValue.len, rc = ctrlValue.rc;\n        if (ctrlType == 'addRC') {\n            let direction = ctrlValue.direction, restore = ctrlValue.restore;\n            let addData = [];\n            if (restore) {\n                if (rc == 'r') {\n                    let st_r;\n                    if (direction == 'lefttop') {\n                        st_r = index;\n                    } else if (direction == 'rightbottom') {\n                        st_r = index + 1;\n                    }\n                    let ed_r = st_r + len - 1;\n                    for (let r = st_r; r <= ed_r; r++) {\n                        let row = [];\n                        for (let c = 0; c < data[0].length; c++) {\n                            let cell = data[r][c];\n                            row.push(cell);\n                        }\n                        addData.push(row);\n                    }\n                } else if (rc == 'c') {\n                    let st_c;\n                    if (direction == 'lefttop') {\n                        st_c = index;\n                    } else if (direction == 'rightbottom') {\n                        st_c = index + 1;\n                    }\n                    let ed_c = st_c + len - 1;\n                    for (let r = 0; r < data.length; r++) {\n                        let row = [];\n                        for (let c = st_c; c <= ed_c; c++) {\n                            let cell = data[r][c];\n                            row.push(cell);\n                        }\n                        addData.push(row);\n                    }\n                }\n            }\n            server.saveParam('arc', Store.currentSheetIndex, {\n                'index': index,\n                'len': len,\n                'direction': direction,\n                'data': addData\n            }, { 'rc': rc });\n        } else if (ctrlType == 'delRC') {\n            server.saveParam('drc', Store.currentSheetIndex, {\n                'index': index,\n                'len': len\n            }, { 'rc': rc });\n        }    //Store.flowdata\n        //Store.flowdata\n        Store.flowdata = data;\n        editor.webWorkerFlowDataCache(Store.flowdata);    //worker存数据\n        //worker存数据\n        file.data = data;    //config\n        //config\n        Store.config = cfg;\n        file.config = Store.config;\n        server.saveParam('all', Store.currentSheetIndex, cfg, { 'k': 'config' });    //mcData\n        //mcData\n        for (let i = 0; i < mcData.length; i++) {\n            let mcData_r = mcData[i].r, mcData_c = mcData[i].c;\n            server.saveParam('v', Store.currentSheetIndex, Store.flowdata[mcData_r][mcData_c], {\n                'r': mcData_r,\n                'c': mcData_c\n            });\n        }    //公式链中公式范围改变对应单元格值的改变\n        //公式链中公式范围改变对应单元格值的改变\n        if (calc.length > 0) {\n            // 取消execFunctionGroupData，改用execFunctionGlobalData\n            // formula.execFunctionGroupData = data;\n            for (let i = 0; i < calc.length; i++) {\n                let clc = calc[i];\n                let clc_r = clc.r, clc_c = clc.c, clc_i = clc.index, clc_funcStr = getcellFormula(clc_r, clc_c, clc_i, data);\n                let clc_result = formula.execfunction(clc_funcStr, clc_r, clc_c, clc_i, null, true);\n                clc.func = clc_result;\n                if (data[clc_r][clc_c].f == clc_funcStr) {\n                    setcellvalue(clc_r, clc_c, data, clc_result[1]);    // funcData存储当前结果没有用处，每次还是需要从calc公式链实时从当前数据中计算比较靠谱\n                                                                        // funcData.push({ \"r\": clc_r, \"c\": clc_c });\n                }\n            }\n        }    //calc函数链\n        // funcData存储当前结果没有用处，每次还是需要从calc公式链实时从当前数据中计算比较靠谱\n        // funcData.push({ \"r\": clc_r, \"c\": clc_c });\n        //calc函数链\n        file.calcChain = calc;\n        server.saveParam('all', Store.currentSheetIndex, calc, { 'k': 'calcChain' });\n        for (let i = 0; i < funcData.length; i++) {\n            let funcData_r = funcData[i].r, funcData_c = funcData[i].c;\n            server.saveParam('v', Store.currentSheetIndex, Store.flowdata[funcData_r][funcData_c], {\n                'r': funcData_r,\n                'c': funcData_c\n            });\n        }    //筛选配置\n        //筛选配置\n        if (filterObj != null) {\n            file.filter_select = filterObj.filter_select;\n            file.filter = filterObj.filter;\n        } else {\n            file.filter_select = null;\n            file.filter = null;\n        }\n        createFilterOptions(file.filter_select, file.filter);\n        server.saveParam('all', Store.currentSheetIndex, file.filter_select, { 'k': 'filter_select' });\n        server.saveParam('all', Store.currentSheetIndex, file.filter, { 'k': 'filter' });    //条件格式配置\n        //条件格式配置\n        file.luckysheet_conditionformat_save = cf;\n        server.saveParam('all', Store.currentSheetIndex, file.luckysheet_conditionformat_save, { 'k': 'luckysheet_conditionformat_save' });    //交替颜色配置\n        //交替颜色配置\n        file.luckysheet_alternateformat_save = af;\n        server.saveParam('all', Store.currentSheetIndex, file.luckysheet_alternateformat_save, { 'k': 'luckysheet_alternateformat_save' });    //冻结配置\n        //冻结配置\n        if (freezen != null) {\n            luckysheetFreezen.freezenhorizontaldata = freezen.freezenhorizontaldata;\n            luckysheetFreezen.freezenverticaldata = freezen.freezenverticaldata;\n        } else {\n            luckysheetFreezen.freezenhorizontaldata = null;\n            luckysheetFreezen.freezenverticaldata = null;\n        }    //数据验证\n        //数据验证\n        dataVerificationCtrl.dataVerification = dataVerification;\n        file.dataVerification = dataVerification;\n        server.saveParam('all', Store.currentSheetIndex, file.dataVerification, { 'k': 'dataVerification' });    //超链接\n        //超链接\n        hyperlinkCtrl.hyperlink = hyperlink;\n        file.hyperlink = hyperlink;\n        server.saveParam('all', Store.currentSheetIndex, file.hyperlink, { 'k': 'hyperlink' });    //行高、列宽刷新\n        //行高、列宽刷新\n        jfrefreshgrid_rhcw(Store.flowdata.length, Store.flowdata[0].length);\n    }    //删除单元格 刷新表格\n    //删除单元格 刷新表格\n    function jfrefreshgrid_deleteCell(data, cfg, ctrl, calc, filterObj, cf, dataVerification, hyperlink) {\n        let file = Store.luckysheetfile[getSheetIndex(Store.currentSheetIndex)];\n        clearTimeout(refreshCanvasTimeOut);\n        collaborativeEditBox();    //merge改变对应的单元格值改变\n        //merge改变对应的单元格值改变\n        let mcData = [];\n        if (JSON.stringify(cfg['merge']) == '{}') {\n            for (let r = 0; r < data.length; r++) {\n                for (let c = 0; c < data[0].length; c++) {\n                    let cell = data[r][c];\n                    if (cell != null && cell.mc != null) {\n                        delete cell.mc;\n                        mcData.push({\n                            'r': r,\n                            'c': c\n                        });\n                    }\n                }\n            }\n        } else {\n            for (let m in cfg['merge']) {\n                let mc = cfg['merge'][m];\n                for (let r = mc.r; r <= mc.r + mc.rs - 1; r++) {\n                    for (let c = mc.c; c <= mc.c + mc.cs - 1; c++) {\n                        if (data[r][c] == null) {\n                            data[r][c] = {};\n                        }\n                        if (r == mc.r && c == mc.c) {\n                            data[r][c].mc = mc;\n                        } else {\n                            data[r][c].mc = {\n                                'r': mc.r,\n                                'c': mc.c\n                            };\n                        }\n                        mcData.push({\n                            'r': r,\n                            'c': c\n                        });\n                    }\n                }\n            }\n        }    //公式链中公式范围改变对应单元格值的改变\n        //公式链中公式范围改变对应单元格值的改变\n        let funcData = [];    // if(calc.length > 0){\n                              //     // formula.execFunctionGroupData = data;\n                              //     for(let i = 0; i < calc.length; i++){\n                              //         let clc = calc[i];\n                              //         let clc_r = clc.r, clc_c = clc.c, clc_i = clc.index, clc_funcStr =  getcellFormula(clc_r, clc_c, clc_i, data);\n                              //         let clc_result = formula.execfunction(clc_funcStr, clc_r, clc_c, clc_i,null, true);\n                              //         clc.func = clc_result;\n                              //         if(data[clc_r][clc_c].f == clc_funcStr){\n                              //             setcellvalue(clc_r, clc_c, data, clc_result[1]);\n                              //             funcData.push({ \"r\": clc_r, \"c\": clc_c });\n                              //         }\n                              //     }\n                              // }\n        // if(calc.length > 0){\n        //     // formula.execFunctionGroupData = data;\n        //     for(let i = 0; i < calc.length; i++){\n        //         let clc = calc[i];\n        //         let clc_r = clc.r, clc_c = clc.c, clc_i = clc.index, clc_funcStr =  getcellFormula(clc_r, clc_c, clc_i, data);\n        //         let clc_result = formula.execfunction(clc_funcStr, clc_r, clc_c, clc_i,null, true);\n        //         clc.func = clc_result;\n        //         if(data[clc_r][clc_c].f == clc_funcStr){\n        //             setcellvalue(clc_r, clc_c, data, clc_result[1]);\n        //             funcData.push({ \"r\": clc_r, \"c\": clc_c });\n        //         }\n        //     }\n        // }\n        if (Store.clearjfundo) {\n            Store.jfundo.length = 0;\n            Store.jfredo.push({\n                'type': 'deleteCell',\n                'sheetIndex': Store.currentSheetIndex,\n                'ctrl': ctrl,\n                'data': Store.flowdata,\n                'curData': data,\n                'config': $.extend(true, {}, Store.config),\n                'curConfig': cfg,\n                'mcData': mcData,\n                'calc': $.extend(true, [], file.calcChain),\n                'curCalc': calc,\n                'funcData': funcData,\n                'filterObj': {\n                    'filter_select': $.extend(true, {}, file.filter_select),\n                    'filter': $.extend(true, {}, file.filter)\n                },\n                'curFilterObj': filterObj,\n                'cf': $.extend(true, [], file.luckysheet_conditionformat_save),\n                'curCf': cf,\n                'dataVerification': $.extend(true, {}, file.dataVerification),\n                'curDataVerification': dataVerification,\n                'hyperlink': $.extend(true, {}, file.hyperlink),\n                'curHyperlink': hyperlink,\n                'dataRange': [...file.luckysheet_select_save]\n            });\n        }    //Store.flowdata\n        //Store.flowdata\n        Store.flowdata = data;\n        editor.webWorkerFlowDataCache(Store.flowdata);    //worker存数据\n        //worker存数据\n        file.data = data;    //共享编辑模式\n        //共享编辑模式\n        if (server.allowUpdate) {\n            let type = ctrl.type, str = ctrl.str, edr = ctrl.edr, stc = ctrl.stc, edc = ctrl.edc;\n            let range;\n            if (type == 'moveUp') {\n                range = {\n                    'row': [\n                        str,\n                        data.length - 1\n                    ],\n                    'column': [\n                        stc,\n                        edc\n                    ]\n                };\n            } else if (type == 'moveLeft') {\n                range = {\n                    'row': [\n                        str,\n                        edr\n                    ],\n                    'column': [\n                        stc,\n                        data[0].length - 1\n                    ]\n                };\n            }\n            server.historyParam(Store.flowdata, Store.currentSheetIndex, range);\n        }    //config\n        //config\n        Store.config = cfg;\n        file.config = Store.config;\n        server.saveParam('all', Store.currentSheetIndex, cfg, { 'k': 'config' });    //mcData\n        //mcData\n        for (let i = 0; i < mcData.length; i++) {\n            let mcData_r = mcData[i].r, mcData_c = mcData[i].c;\n            server.saveParam('v', Store.currentSheetIndex, Store.flowdata[mcData_r][mcData_c], {\n                'r': mcData_r,\n                'c': mcData_c\n            });\n        }    //公式链中公式范围改变对应单元格值的改变\n        //公式链中公式范围改变对应单元格值的改变\n        if (calc.length > 0) {\n            // formula.execFunctionGroupData = data;\n            for (let i = 0; i < calc.length; i++) {\n                let clc = calc[i];\n                let clc_r = clc.r, clc_c = clc.c, clc_i = clc.index, clc_funcStr = getcellFormula(clc_r, clc_c, clc_i, data);\n                let clc_result = formula.execfunction(clc_funcStr, clc_r, clc_c, clc_i, null, true);\n                clc.func = clc_result;\n                if (data[clc_r][clc_c].f == clc_funcStr) {\n                    setcellvalue(clc_r, clc_c, data, clc_result[1]);    // funcData.push({ \"r\": clc_r, \"c\": clc_c });\n                }\n            }\n        }    //calc函数链\n        // funcData.push({ \"r\": clc_r, \"c\": clc_c });\n        //calc函数链\n        file.calcChain = calc;\n        server.saveParam('all', Store.currentSheetIndex, calc, { 'k': 'calcChain' });\n        for (let i = 0; i < funcData.length; i++) {\n            let funcData_r = funcData[i].r, funcData_c = funcData[i].c;\n            server.saveParam('v', Store.currentSheetIndex, Store.flowdata[funcData_r][funcData_c], {\n                'r': funcData_r,\n                'c': funcData_c\n            });\n        }    //筛选配置\n        //筛选配置\n        if (filterObj != null) {\n            file.filter_select = filterObj.filter_select;\n            file.filter = filterObj.filter;\n        } else {\n            file.filter_select = null;\n            file.filter = null;\n        }\n        createFilterOptions(file.filter_select, file.filter);\n        server.saveParam('all', Store.currentSheetIndex, file.filter_select, { 'k': 'filter_select' });\n        server.saveParam('all', Store.currentSheetIndex, file.filter, { 'k': 'filter' });    //条件格式配置\n        //条件格式配置\n        file.luckysheet_conditionformat_save = cf;\n        server.saveParam('all', Store.currentSheetIndex, file.luckysheet_conditionformat_save, { 'k': 'luckysheet_conditionformat_save' });    //数据验证\n        //数据验证\n        dataVerificationCtrl.dataVerification = dataVerification;\n        file.dataVerification = dataVerification;\n        server.saveParam('all', Store.currentSheetIndex, file.dataVerification, { 'k': 'dataVerification' });    //超链接\n        //超链接\n        hyperlinkCtrl.hyperlink = hyperlink;\n        file.hyperlink = hyperlink;\n        server.saveParam('all', Store.currentSheetIndex, file.hyperlink, { 'k': 'hyperlink' });\n        refreshCanvasTimeOut = setTimeout(function () {\n            luckysheetrefreshgrid();\n        }, 1);\n    }    //复制剪切 刷新表格\n    //复制剪切 刷新表格\n    function jfrefreshgrid_pastcut(source, target, RowlChange) {\n        //单元格数据更新联动\n        let execF_rc = {};\n        formula.execFunctionExist = [];\n        clearTimeout(refreshCanvasTimeOut);\n        for (let r = source['range'].row[0]; r <= source['range'].row[1]; r++) {\n            for (let c = source['range'].column[0]; c <= source['range'].column[1]; c++) {\n                if (r + '_' + c + '_' + source['sheetIndex'] in execF_rc) {\n                    continue;\n                }\n                execF_rc[r + '_' + c + '_' + source['sheetIndex']] = 0;\n                formula.execFunctionExist.push({\n                    'r': r,\n                    'c': c,\n                    'i': source['sheetIndex']\n                });\n            }\n        }\n        for (let r = target['range'].row[0]; r <= target['range'].row[1]; r++) {\n            for (let c = target['range'].column[0]; c <= target['range'].column[1]; c++) {\n                if (r + '_' + c + '_' + target['sheetIndex'] in execF_rc) {\n                    continue;\n                }\n                execF_rc[r + '_' + c + '_' + target['sheetIndex']] = 0;\n                formula.execFunctionExist.push({\n                    'r': r,\n                    'c': c,\n                    'i': target['sheetIndex']\n                });\n            }\n        }\n        if (Store.clearjfundo) {\n            Store.jfundo.length = 0;\n            Store.jfredo.push({\n                'type': 'pasteCut',\n                'source': source,\n                'target': target,\n                'RowlChange': RowlChange\n            });\n        }    //config\n        //config\n        let rowHeight;\n        if (Store.currentSheetIndex == source['sheetIndex']) {\n            Store.config = source['curConfig'];\n            rowHeight = source['curData'].length;\n            Store.luckysheetfile[getSheetIndex(target['sheetIndex'])]['config'] = target['curConfig'];\n        } else if (Store.currentSheetIndex == target['sheetIndex']) {\n            Store.config = target['curConfig'];\n            rowHeight = target['curData'].length;\n            Store.luckysheetfile[getSheetIndex(source['sheetIndex'])]['config'] = source['curConfig'];\n        }\n        if (RowlChange) {\n            Store.visibledatarow = [];\n            Store.rh_height = 0;\n            for (let i = 0; i < rowHeight; i++) {\n                let rowlen = Store.defaultrowlen;\n                if (Store.config['rowlen'] != null && Store.config['rowlen'][i] != null) {\n                    rowlen = Store.config['rowlen'][i];\n                }\n                if (Store.config['rowhidden'] != null && Store.config['rowhidden'][i] != null) {\n                    rowlen = Store.config['rowhidden'][i];\n                    Store.visibledatarow.push(Store.rh_height);\n                    continue;\n                } else {\n                    Store.rh_height += rowlen + 1;\n                }\n                Store.visibledatarow.push(Store.rh_height);    //行的临时长度分布\n            }\n            //行的临时长度分布\n            Store.rh_height += 110;    // sheetmanage.showSheet();\n            // sheetmanage.showSheet();\n            if (Store.currentSheetIndex == source['sheetIndex']) {\n                let rowlenArr = computeRowlenArr(target['curData'].length, target['curConfig']);\n                Store.luckysheetfile[getSheetIndex(target['sheetIndex'])]['visibledatarow'] = rowlenArr;\n            } else if (Store.currentSheetIndex == target['sheetIndex']) {\n                let rowlenArr = computeRowlenArr(source['curData'].length, source['curConfig']);\n                Store.luckysheetfile[getSheetIndex(source['sheetIndex'])]['visibledatarow'] = rowlenArr;\n            }\n        }    //Store.flowdata\n        //Store.flowdata\n        if (Store.currentSheetIndex == source['sheetIndex']) {\n            Store.flowdata = source['curData'];\n            Store.luckysheetfile[getSheetIndex(target['sheetIndex'])]['data'] = target['curData'];\n        } else if (Store.currentSheetIndex == target['sheetIndex']) {\n            Store.flowdata = target['curData'];\n            Store.luckysheetfile[getSheetIndex(source['sheetIndex'])]['data'] = source['curData'];\n        }\n        editor.webWorkerFlowDataCache(Store.flowdata);    //worker存数据\n        //worker存数据\n        Store.luckysheetfile[getSheetIndex(Store.currentSheetIndex)].data = Store.flowdata;    //luckysheet_select_save\n        //luckysheet_select_save\n        if (Store.currentSheetIndex == target['sheetIndex']) {\n            Store.luckysheet_select_save = [{\n                    'row': target['range'].row,\n                    'column': target['range'].column\n                }];\n        } else {\n            Store.luckysheet_select_save = [{\n                    'row': source['range'].row,\n                    'column': source['range'].column\n                }];\n        }\n        if (Store.luckysheet_select_save.length > 0) {\n            //有选区时，刷新一下选区\n            selectHightlightShow();\n        }    //条件格式\n        //条件格式\n        Store.luckysheetfile[getSheetIndex(source['sheetIndex'])].luckysheet_conditionformat_save = source['curCdformat'];\n        Store.luckysheetfile[getSheetIndex(target['sheetIndex'])].luckysheet_conditionformat_save = target['curCdformat'];    //数据验证\n        //数据验证\n        if (Store.currentSheetIndex == source['sheetIndex']) {\n            dataVerificationCtrl.dataVerification = source['curDataVerification'];\n        } else if (Store.currentSheetIndex == target['sheetIndex']) {\n            dataVerificationCtrl.dataVerification = target['curDataVerification'];\n        }\n        Store.luckysheetfile[getSheetIndex(source['sheetIndex'])].dataVerification = source['curDataVerification'];\n        Store.luckysheetfile[getSheetIndex(target['sheetIndex'])].dataVerification = target['curDataVerification'];\n        formula.execFunctionExist.reverse();\n        formula.execFunctionGroup(null, null, null, null, target['curData']);\n        formula.execFunctionGlobalData = null;\n        refreshCanvasTimeOut = setTimeout(function () {\n            luckysheetrefreshgrid();\n        }, 1);\n        sheetmanage.storeSheetParamALL();    //saveparam\n                                             //来源表\n        //saveparam\n        //来源表\n        server.saveParam('all', source['sheetIndex'], source['curConfig'], { 'k': 'config' });    //目的表\n        //目的表\n        server.saveParam('all', target['sheetIndex'], target['curConfig'], { 'k': 'config' });    //来源表\n        //来源表\n        server.historyParam(source['curData'], source['sheetIndex'], {\n            'row': source['range']['row'],\n            'column': source['range']['column']\n        });    //目的表\n        //目的表\n        server.historyParam(target['curData'], target['sheetIndex'], {\n            'row': target['range']['row'],\n            'column': target['range']['column']\n        });    //来源表\n        //来源表\n        server.saveParam('all', source['sheetIndex'], source['curCdformat'], { 'k': 'luckysheet_conditionformat_save' });    //目的表\n        //目的表\n        server.saveParam('all', target['sheetIndex'], target['curCdformat'], { 'k': 'luckysheet_conditionformat_save' });    //来源表\n        //来源表\n        server.saveParam('all', source['sheetIndex'], source['curDataVerification'], { 'k': 'dataVerification' });    //目的表\n        //目的表\n        server.saveParam('all', target['sheetIndex'], target['curDataVerification'], { 'k': 'dataVerification' });\n    }    //行高、列宽改变 刷新表格\n    //行高、列宽改变 刷新表格\n    function jfrefreshgrid_rhcw(rowheight, colwidth, isRefreshCanvas = true) {\n        rhchInit(rowheight, colwidth);\n        clearTimeout(refreshCanvasTimeOut);\n        sheetmanage.storeSheetParam();    //行高列宽改变时 重新计算sparklines\n        //行高列宽改变时 重新计算sparklines\n        let calcChain = Store.luckysheetfile[getSheetIndex(Store.currentSheetIndex)].calcChain;\n        if (calcChain != null && calcChain.length > 0) {\n            if (Store.config['rowlen'] == null) {\n                Store.config['rowlen'] = {};\n            }\n            if (Store.config['columnlen'] == null) {\n                Store.config['columnlen'] = {};\n            }\n            for (let i = 0; i < calcChain.length; i++) {\n                let r = calcChain[i].r, c = calcChain[i].c, index = calcChain[i].index;\n                if (index == Store.currentSheetIndex && Store.flowdata[r][c] != null && Store.flowdata[r][c].spl != null && (r in Store.config['rowlen'] || c in Store.config['columnlen'])) {\n                    window.luckysheetCurrentRow = r;\n                    window.luckysheetCurrentColumn = c;\n                    window.luckysheetCurrentFunction = Store.flowdata[r][c].f;\n                    let fp = $.trim(formula.functionParserExe(Store.flowdata[r][c].f));\n                    let sparklines = new Function('return ' + fp)();\n                    Store.flowdata[r][c].spl = sparklines;\n                    server.saveParam('v', Store.currentSheetIndex, Store.flowdata[r][c], {\n                        'r': r,\n                        'c': c\n                    });\n                }\n            }\n            Store.luckysheetfile[getSheetIndex(Store.currentSheetIndex)].data = Store.flowdata;\n        }    //批注框同步\n        //批注框同步\n        luckysheetPostil.positionSync();    //选区同步\n        //选区同步\n        selectHightlightShow();    // 协同提示框同步\n        // 协同提示框同步\n        collaborativeEditBox();    //改变单元格行高，复制虚线框同步\n        //改变单元格行高，复制虚线框同步\n        if ($('.luckysheet-selection-copy').is(':visible')) {\n            selectionCopyShow();\n        }    //改变单元格行高，选区下拉icon隐藏\n        //改变单元格行高，选区下拉icon隐藏\n        if ($('#luckysheet-dropCell-icon').is(':visible')) {\n            $('#luckysheet-dropCell-icon').remove();\n        }    //有冻结状态时，同步行高、列宽\n        //有冻结状态时，同步行高、列宽\n        if (luckysheetFreezen.freezenhorizontaldata != null && luckysheetFreezen.freezenverticaldata != null) {\n            let row_st = luckysheetFreezen.freezenhorizontaldata[1] - 1;\n            let col_st = luckysheetFreezen.freezenverticaldata[1] - 1;\n            let scrollTop = luckysheetFreezen.freezenhorizontaldata[2];\n            let scrollLeft = luckysheetFreezen.freezenverticaldata[2];\n            let top = Store.visibledatarow[row_st] - 2 - scrollTop + Store.columnHeaderHeight;\n            let freezenhorizontaldata = [\n                Store.visibledatarow[row_st],\n                row_st + 1,\n                scrollTop,\n                luckysheetFreezen.cutVolumn(Store.visibledatarow, row_st + 1),\n                top\n            ];\n            let left = Store.visibledatacolumn[col_st] - 2 - scrollLeft + Store.rowHeaderWidth;\n            let freezenverticaldata = [\n                Store.visibledatacolumn[col_st],\n                col_st + 1,\n                scrollLeft,\n                luckysheetFreezen.cutVolumn(Store.visibledatacolumn, col_st + 1),\n                left\n            ];\n            luckysheetFreezen.saveFreezen(freezenhorizontaldata, top, freezenverticaldata, left);\n            luckysheetFreezen.createFreezenHorizontal(freezenhorizontaldata, top);\n            luckysheetFreezen.createFreezenVertical(freezenverticaldata, left);\n            luckysheetFreezen.createAssistCanvas();\n        } else if (luckysheetFreezen.freezenhorizontaldata != null) {\n            let row_st = luckysheetFreezen.freezenhorizontaldata[1] - 1;\n            let scrollTop = luckysheetFreezen.freezenhorizontaldata[2];\n            let top = Store.visibledatarow[row_st] - 2 - scrollTop + Store.columnHeaderHeight;\n            let freezenhorizontaldata = [\n                Store.visibledatarow[row_st],\n                row_st + 1,\n                scrollTop,\n                luckysheetFreezen.cutVolumn(Store.visibledatarow, row_st + 1),\n                top\n            ];\n            luckysheetFreezen.saveFreezen(freezenhorizontaldata, top, null, null);\n            luckysheetFreezen.createFreezenHorizontal(freezenhorizontaldata, top);\n            luckysheetFreezen.createAssistCanvas();\n        } else if (luckysheetFreezen.freezenverticaldata != null) {\n            let col_st = luckysheetFreezen.freezenverticaldata[1] - 1;\n            let scrollLeft = luckysheetFreezen.freezenverticaldata[2];\n            let left = Store.visibledatacolumn[col_st] - 2 - scrollLeft + Store.rowHeaderWidth;\n            let freezenverticaldata = [\n                Store.visibledatacolumn[col_st],\n                col_st + 1,\n                scrollLeft,\n                luckysheetFreezen.cutVolumn(Store.visibledatacolumn, col_st + 1),\n                left\n            ];\n            luckysheetFreezen.saveFreezen(null, null, freezenverticaldata, left);\n            luckysheetFreezen.createFreezenVertical(freezenverticaldata, left);\n            luckysheetFreezen.createAssistCanvas();\n        } else {\n            //有筛选标志时，同步筛选按钮和筛选范围位置\n            if ($('#luckysheet-filter-options-sheet' + Store.currentSheetIndex + ' .luckysheet-filter-options').length > 0) {\n                $('#luckysheet-filter-options-sheet' + Store.currentSheetIndex + ' .luckysheet-filter-options').each(function (i, e) {\n                    let str = $(e).data('str'), cindex = $(e).data('cindex');\n                    let left = Store.visibledatacolumn[cindex] - 20;\n                    let top = str - 1 == -1 ? 0 : Store.visibledatarow[str - 1];\n                    $(e).css({\n                        'left': left,\n                        'top': top\n                    });\n                });\n            }\n        }\n        if ($('#luckysheet-filter-selected-sheet' + Store.currentSheetIndex).length > 0) {\n            let luckysheet_filter_save = Store.luckysheetfile[getSheetIndex(Store.currentSheetIndex)].filter_select;\n            let r1 = luckysheet_filter_save.row[0], r2 = luckysheet_filter_save.row[1];\n            let c1 = luckysheet_filter_save.column[0], c2 = luckysheet_filter_save.column[1];\n            let row = Store.visibledatarow[r2], row_pre = r1 - 1 == -1 ? 0 : Store.visibledatarow[r1 - 1];\n            let col = Store.visibledatacolumn[c2], col_pre = c1 - 1 == -1 ? 0 : Store.visibledatacolumn[c1 - 1];\n            $('#luckysheet-filter-selected-sheet' + Store.currentSheetIndex).css({\n                'left': col_pre,\n                'width': col - col_pre - 1,\n                'top': row_pre,\n                'height': row - row_pre - 1\n            });\n        }\n        sheetmanage.showSheet();\n        if (isRefreshCanvas) {\n            refreshCanvasTimeOut = setTimeout(function () {\n                luckysheetrefreshgrid();\n            }, 1);\n        }\n    }    //Refresh the canvas display data according to scrollHeight and scrollWidth\n    //Refresh the canvas display data according to scrollHeight and scrollWidth\n    function luckysheetrefreshgrid(scrollWidth, scrollHeight) {\n        formula.groupValuesRefresh();\n        if (scrollWidth == null) {\n            scrollWidth = $('#luckysheet-cell-main').scrollLeft();\n        }\n        if (scrollHeight == null) {\n            scrollHeight = $('#luckysheet-cell-main').scrollTop();\n        }\n        if (luckysheetFreezen.freezenverticaldata != null || luckysheetFreezen.freezenhorizontaldata != null) {\n            let freezen_horizon_px, freezen_horizon_ed, freezen_horizon_scrollTop;\n            let freezen_vertical_px, freezen_vertical_ed, freezen_vertical_scrollTop;\n            let drawWidth = Store.luckysheetTableContentHW[0], drawHeight = Store.luckysheetTableContentHW[1];\n            if (luckysheetFreezen.freezenverticaldata != null && luckysheetFreezen.freezenhorizontaldata != null) {\n                freezen_horizon_px = luckysheetFreezen.freezenhorizontaldata[0];\n                freezen_horizon_ed = luckysheetFreezen.freezenhorizontaldata[1];\n                freezen_horizon_scrollTop = luckysheetFreezen.freezenhorizontaldata[2];\n                freezen_vertical_px = luckysheetFreezen.freezenverticaldata[0];\n                freezen_vertical_ed = luckysheetFreezen.freezenverticaldata[1];\n                freezen_vertical_scrollTop = luckysheetFreezen.freezenverticaldata[2];    //左上canvas freezen_3\n                //左上canvas freezen_3\n                luckysheetDrawMain(freezen_vertical_scrollTop, freezen_horizon_scrollTop, freezen_vertical_px, freezen_horizon_px, 1, 1, null, null, 'freezen_3');    //上右canvas freezen_4\n                //上右canvas freezen_4\n                luckysheetDrawMain(scrollWidth + freezen_vertical_px - freezen_vertical_scrollTop, freezen_horizon_scrollTop, drawWidth - freezen_vertical_px + freezen_vertical_scrollTop, freezen_horizon_px, 1, 1, null, null, 'freezen_4');    //左下canvas freezen_7\n                //左下canvas freezen_7\n                luckysheetDrawMain(freezen_vertical_scrollTop, scrollHeight + freezen_horizon_px - freezen_horizon_scrollTop, freezen_vertical_px, drawHeight - freezen_horizon_px + freezen_horizon_scrollTop, 1, 1, null, null, 'freezen_7');    //右下canvas luckysheetTableContent\n                //右下canvas luckysheetTableContent\n                luckysheetDrawMain(scrollWidth + freezen_vertical_px - freezen_vertical_scrollTop, scrollHeight + freezen_horizon_px - freezen_horizon_scrollTop, drawWidth - freezen_vertical_px + freezen_vertical_scrollTop, drawHeight - freezen_horizon_px + freezen_horizon_scrollTop, freezen_vertical_px - freezen_vertical_scrollTop + Store.rowHeaderWidth, freezen_horizon_px - freezen_horizon_scrollTop + Store.columnHeaderHeight);    //标题\n                //标题\n                luckysheetDrawgridColumnTitle(freezen_vertical_scrollTop, freezen_vertical_px, Store.rowHeaderWidth);\n                luckysheetDrawgridColumnTitle(scrollWidth + freezen_vertical_px - freezen_vertical_scrollTop, drawWidth - freezen_vertical_px + freezen_vertical_scrollTop, freezen_vertical_px - freezen_vertical_scrollTop + Store.rowHeaderWidth);\n                luckysheetDrawgridRowTitle(freezen_horizon_scrollTop, freezen_horizon_px, Store.columnHeaderHeight);\n                luckysheetDrawgridRowTitle(scrollHeight + freezen_horizon_px - freezen_horizon_scrollTop, drawHeight - freezen_horizon_px + freezen_horizon_scrollTop, freezen_horizon_px - freezen_horizon_scrollTop + Store.columnHeaderHeight);\n            } else if (luckysheetFreezen.freezenhorizontaldata != null) {\n                freezen_horizon_px = luckysheetFreezen.freezenhorizontaldata[0];\n                freezen_horizon_ed = luckysheetFreezen.freezenhorizontaldata[1];\n                freezen_horizon_scrollTop = luckysheetFreezen.freezenhorizontaldata[2];\n                luckysheetDrawMain(scrollWidth, freezen_horizon_scrollTop, drawWidth, freezen_horizon_px, 1, 1, null, null, 'freezen_h');\n                luckysheetDrawMain(scrollWidth, scrollHeight + freezen_horizon_px - freezen_horizon_scrollTop, drawWidth, drawHeight - freezen_horizon_px + freezen_horizon_scrollTop, null, freezen_horizon_px - freezen_horizon_scrollTop + Store.columnHeaderHeight);\n                luckysheetDrawgridColumnTitle(scrollWidth, drawWidth, null);\n                luckysheetDrawgridRowTitle(freezen_horizon_scrollTop, freezen_horizon_px, Store.columnHeaderHeight);\n                luckysheetDrawgridRowTitle(scrollHeight + freezen_horizon_px - freezen_horizon_scrollTop, drawHeight - freezen_horizon_px + freezen_horizon_scrollTop, freezen_horizon_px - freezen_horizon_scrollTop + Store.columnHeaderHeight);\n            } else if (luckysheetFreezen.freezenverticaldata != null) {\n                freezen_vertical_px = luckysheetFreezen.freezenverticaldata[0];\n                freezen_vertical_ed = luckysheetFreezen.freezenverticaldata[1];\n                freezen_vertical_scrollTop = luckysheetFreezen.freezenverticaldata[2];\n                luckysheetDrawMain(freezen_vertical_scrollTop, scrollHeight, freezen_vertical_px, drawHeight, 1, 1, null, null, 'freezen_v');\n                luckysheetDrawMain(scrollWidth + freezen_vertical_px - freezen_vertical_scrollTop, scrollHeight, drawWidth - freezen_vertical_px + freezen_vertical_scrollTop, drawHeight, freezen_vertical_px - freezen_vertical_scrollTop + Store.rowHeaderWidth, null);\n                luckysheetDrawgridRowTitle(scrollHeight, drawHeight, null);\n                luckysheetDrawgridColumnTitle(freezen_vertical_scrollTop, freezen_vertical_px, Store.rowHeaderWidth);\n                luckysheetDrawgridColumnTitle(scrollWidth + freezen_vertical_px - freezen_vertical_scrollTop, drawWidth - freezen_vertical_px + freezen_vertical_scrollTop, freezen_vertical_px - freezen_vertical_scrollTop + Store.rowHeaderWidth);\n            }\n        } else {\n            if ($('#luckysheetTableContent').length == 0) {\n                return;\n            }\n            let luckysheetTableContent = $('#luckysheetTableContent').get(0).getContext('2d');\n            luckysheetDrawMain(scrollWidth, scrollHeight);    // luckysheetTableContent.clearRect(0, 0, 46, 20);\n            // luckysheetTableContent.clearRect(0, 0, 46, 20);\n            luckysheetDrawgridColumnTitle(scrollWidth);\n            luckysheetDrawgridRowTitle(scrollHeight);    //清除canvas左上角区域 防止列标题栏序列号溢出显示\n            //清除canvas左上角区域 防止列标题栏序列号溢出显示\n            luckysheetTableContent.clearRect(0, 0, Store.rowHeaderWidth * Store.devicePixelRatio - 1, Store.columnHeaderHeight * Store.devicePixelRatio - 1);\n        }\n    }\n    return {\n        jfrefreshgrid,\n        jfrefreshgridall,\n        jfrefreshrange,\n        jfrefreshgrid_adRC,\n        jfrefreshgrid_deleteCell,\n        jfrefreshgrid_pastcut,\n        jfrefreshgrid_rhcw,\n        luckysheetrefreshgrid\n    };\n});"]}