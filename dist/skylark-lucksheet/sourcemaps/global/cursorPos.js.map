{"version":3,"sources":["global/cursorPos.js"],"names":["define","Store","isInPage","node","document","body","contains","luckysheetRangeLast","obj","range","createRange","innerHTML","innerText","focus","window","getSelection","selectAllChildren","collapseToEnd","len","length","selectNodeContents","setStart","childNodes","collapse","selection","removeAllRanges","addRange","createTextRange","moveToElementText","select","getCursortPosition","textDom","cursorPos","selectRange","moveStart","value","text","selectionStart","hideMenuByCancel","event","target","classList","$","hasClass","filter","hide","luckysheet_cols_menu_status","selectTextContent","ele","content","firstChild","setEnd","startContainer","selectTextDom","selectTextContentCross","sEle","eEle","sContent","eContent","selectTextContentCollapse","index"],"mappings":"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","file":"../../global/cursorPos.js","sourcesContent":["define(['../store'], function (Store) {\n    'use strict';\n    function luckysheetRangeLast(obj) {\n        let range;\n        if (document.createRange) {\n            //chrome, firefox, opera, safari, ie9+\n            if (obj.innerHTML != obj.innerText || obj.innerHTML == '') {\n                obj.focus();    //解决ff不获取焦点无法定位问题\n                //解决ff不获取焦点无法定位问题\n                range = window.getSelection();    //创建range\n                //创建range\n                range.selectAllChildren(obj);    //range 选择obj下所有子内容\n                //range 选择obj下所有子内容\n                range.collapseToEnd();    //光标移至最后\n            } else\n                //光标移至最后\n                {\n                    let len = obj.innerText.length;\n                    range = document.createRange();\n                    range.selectNodeContents(obj);\n                    range.setStart(obj.childNodes[0], len);\n                    range.collapse(true);\n                    let selection = window.getSelection();\n                    selection.removeAllRanges();\n                    selection.addRange(range);\n                }\n        } else if (document.selection) {\n            //ie8 and lower\n            range = document.body.createTextRange();\n            range.moveToElementText(obj);\n            range.collapse(false);\n            range.select();\n        }\n    }\n    function getCursortPosition(textDom) {\n        let cursorPos = 0;\n        if (document.selection) {\n            textDom.focus();\n            let selectRange = document.selection.createRange();\n            selectRange.moveStart('character', -textDom.value.length);\n            cursorPos = selectRange.text.length;\n        } else if (textDom.selectionStart || textDom.selectionStart == '0') {\n            cursorPos = textDom.selectionStart;\n        }\n        return cursorPos;\n    }\n    function hideMenuByCancel(event) {\n        // Right-click the menu in the title bar, and click on the elements whose class is luckysheet-cols-rows-shift-left and luckysheet-cols-rows-shift-right will trigger the hiding of the menu bar. It should be prohibited. Exclude these two elements. There may be more Other elements will also jump here for more testing\n        if (event.target.classList.contains('luckysheet-cols-rows-shift-left') || event.target.classList.contains('luckysheet-cols-rows-shift-right')) {\n            return;\n        }\n        if (!$(event.target).hasClass('luckysheet-mousedown-cancel') && $(event.target).filter(\"[class*='sp-palette']\").length == 0 && $(event.target).filter(\"[class*='sp-thumb']\").length == 0 && $(event.target).filter(\"[class*='sp-']\").length == 0) {\n            $('#luckysheet-rightclick-menu').hide();\n            $('#luckysheet-cols-h-hover').hide();\n            $('#luckysheet-cols-menu-btn').hide();    // $(\"#luckysheet-rightclick-menu\").hide();\n            // $(\"#luckysheet-rightclick-menu\").hide();\n            $('#luckysheet-sheet-list, #luckysheet-rightclick-sheet-menu, #luckysheet-user-menu').hide();\n            $('body > .luckysheet-filter-menu, body > .luckysheet-filter-submenu, body > .luckysheet-cols-menu').hide();    //$(\"body > luckysheet-menuButton\").hide();\n            //$(\"body > luckysheet-menuButton\").hide();\n            Store.luckysheet_cols_menu_status = false;\n        }\n    }\n    function selectTextDom(ele) {\n        if (window.getSelection) {\n            let range = document.createRange();\n            range.selectNodeContents(ele);\n            if (range.startContainer && isInPage(range.startContainer)) {\n                window.getSelection().removeAllRanges();\n                window.getSelection().addRange(range);\n            }\n        } else if (document.selection) {\n            let range = document.body.createTextRange();\n            range.moveToElementText(ele);\n            range.select();\n        }\n    }\n    function selectTextContent(ele) {\n        if (window.getSelection) {\n            let range = document.createRange();\n            var content = ele.firstChild;\n            range.setStart(content, 0);\n            range.setEnd(content, content.length);\n            if (range.startContainer && isInPage(range.startContainer)) {\n                window.getSelection().removeAllRanges();\n                window.getSelection().addRange(range);\n            }\n        } else if (document.selection) {\n            let range = document.body.createTextRange();\n            range.moveToElementText(ele);\n            range.select();\n        }\n    }\n    function selectTextContentCross(sEle, eEle) {\n        if (window.getSelection) {\n            let range = document.createRange();\n            var sContent = sEle.firstChild, eContent = eEle.firstChild;\n            range.setStart(sContent, 0);\n            range.setEnd(eContent, eContent.length);\n            if (range.startContainer && isInPage(range.startContainer)) {\n                window.getSelection().removeAllRanges();\n                window.getSelection().addRange(range);\n            }\n        }\n    }\n    function selectTextContentCollapse(sEle, index) {\n        if (window.getSelection) {\n            let range = document.createRange();\n            var sContent = sEle.firstChild;\n            if (index > sContent.length) {\n                index = sContent.length;\n            } else if (index < 0) {\n                index = 0;\n            }\n            range.setStart(sContent, index);\n            range.collapse(true);\n            if (range.startContainer && isInPage(range.startContainer)) {\n                window.getSelection().removeAllRanges();\n                window.getSelection().addRange(range);\n            }\n        }\n    }\n    function isInPage(node) {\n        return node === document.body ? false : document.body.contains(node);\n    }\n    return {\n        luckysheetRangeLast,\n        getCursortPosition,\n        hideMenuByCancel,\n        selectTextContent,\n        selectTextDom,\n        selectTextContentCross,\n        selectTextContentCollapse\n    };\n});"]}