/**
 * skylark-lucksheet - A version of lucksheet.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["../methods/get","../utils/util","../methods/formula_methods","../methods/validate","../methods/getdata","../methods/format","../methods/luckysheetConfigsetting","../locale/locale","../methods/protection_methods","../store","skylark-moment"],function(o,l,r,t,e,n,u,c,a,m,w){"use strict";const{getSheetIndex:f,getRangetxt:i}=o,{replaceHtml:s,getObjType:p,chatatABC:_}=l,{isRealNull:g}=t,{isEditMode:h}=u,{getcellvalue:v}=e,{genarate:d}=n,{checkProtectionFormatCells:C}=a;return{fileClone:[],editorRule:null,selectRange:[],selectStatus:!1,dataBarList:[{format:["#638ec6","#ffffff"]},{format:["#63c384","#ffffff"]},{format:["#ff555a","#ffffff"]},{format:["#ffb628","#ffffff"]},{format:["#008aef","#ffffff"]},{format:["#d6007b","#ffffff"]},{format:["#638ec6"]},{format:["#63c384"]},{format:["#ff555a"]},{format:["#ffb628"]},{format:["#008aef"]},{format:["#d6007b"]}],colorGradationList:[{format:["rgb(99, 190, 123)","rgb(255, 235, 132)","rgb(248, 105, 107)"]},{format:["rgb(248, 105, 107)","rgb(255, 235, 132)","rgb(99, 190, 123)"]},{format:["rgb(99, 190, 123)","rgb(252, 252, 255)","rgb(248, 105, 107)"]},{format:["rgb(248, 105, 107)","rgb(252, 252, 255)","rgb(99, 190, 123)"]},{format:["rgb(90, 138, 198)","rgb(252, 252, 255)","rgb(248, 105, 107)"]},{format:["rgb(248, 105, 107)","rgb(252, 252, 255)","rgb(90, 138, 198)"]},{format:["rgb(252, 252, 255)","rgb(248, 105, 107)"]},{format:["rgb(248, 105, 107)","rgb(252, 252, 255)"]},{format:["rgb(99, 190, 123)","rgb(252, 252, 255)"]},{format:["rgb(252, 252, 255)","rgb(99, 190, 123)"]},{format:["rgb(99, 190, 123)","rgb(255, 235, 132)"]},{format:["rgb(255, 235, 132)","rgb(99, 190, 123)"]}],getTxtByRange:function(o){if(o.length>0){let l=[];for(let r=0;r<o.length;r++){let t=o[r].row[0],e=o[r].row[1],n=o[r].column[0],u=o[r].column[1];l.push(i(m.currentSheetIndex,{row:[t,e],column:[n,u]},m.currentSheetIndex))}return l.join(",")}},getRangeByTxt:function(o){let l=[];if(-1!=(o=o.toString()).indexOf(",")){let t=o.split(",");for(let o=0;o<t.length;o++){if(!r.iscelldata(t[o])){l=[];break}l.push(r.getcellrange(t[o]))}}else r.iscelldata(o)&&l.push(r.getcellrange(o));return l},CFSplitRange:function(o,l,r,t){let e=[],n=r.row[0]-l.row[0],u=r.column[0]-l.column[0],c=o.row[0],a=o.row[1],m=o.column[0],w=o.column[1];return c>=l.row[0]&&a<=l.row[1]&&m>=l.column[0]&&w<=l.column[1]?"allPart"==t?e=[{row:[c+n,a+n],column:[m+u,w+u]}]:"restPart"==t?e=[]:"operatePart"==t&&(e=[{row:[c+n,a+n],column:[m+u,w+u]}]):c>=l.row[0]&&c<=l.row[1]&&m>=l.column[0]&&w<=l.column[1]?"allPart"==t?e=[{row:[l.row[1]+1,a],column:[m,w]},{row:[c+n,l.row[1]+n],column:[m+u,w+u]}]:"restPart"==t?e=[{row:[l.row[1]+1,a],column:[m,w]}]:"operatePart"==t&&(e=[{row:[c+n,l.row[1]+n],column:[m+u,w+u]}]):a>=l.row[0]&&a<=l.row[1]&&m>=l.column[0]&&w<=l.column[1]?"allPart"==t?e=[{row:[c,l.row[0]-1],column:[m,w]},{row:[l.row[0]+n,a+n],column:[m+u,w+u]}]:"restPart"==t?e=[{row:[c,l.row[0]-1],column:[m,w]}]:"operatePart"==t&&(e=[{row:[l.row[0]+n,a+n],column:[m+u,w+u]}]):c<l.row[0]&&a>l.row[1]&&m>=l.column[0]&&w<=l.column[1]?"allPart"==t?e=[{row:[c,l.row[0]-1],column:[m,w]},{row:[l.row[1]+1,a],column:[m,w]},{row:[l.row[0]+n,l.row[1]+n],column:[m+u,w+u]}]:"restPart"==t?e=[{row:[c,l.row[0]-1],column:[m,w]},{row:[l.row[1]+1,a],column:[m,w]}]:"operatePart"==t&&(e=[{row:[l.row[0]+n,l.row[1]+n],column:[m+u,w+u]}]):m>=l.column[0]&&m<=l.column[1]&&c>=l.row[0]&&a<=l.row[1]?"allPart"==t?e=[{row:[c,a],column:[l.column[1]+1,w]},{row:[c+n,a+n],column:[m+u,l.column[1]+u]}]:"restPart"==t?e=[{row:[c,a],column:[l.column[1]+1,w]}]:"operatePart"==t&&(e=[{row:[c+n,a+n],column:[m+u,l.column[1]+u]}]):w>=l.column[0]&&w<=l.column[1]&&c>=l.row[0]&&a<=l.row[1]?"allPart"==t?e=[{row:[c,a],column:[m,l.column[0]-1]},{row:[c+n,a+n],column:[l.column[0]+u,w+u]}]:"restPart"==t?e=[{row:[c,a],column:[m,l.column[0]-1]}]:"operatePart"==t&&(e=[{row:[c+n,a+n],column:[l.column[0]+u,w+u]}]):m<l.column[0]&&w>l.column[1]&&c>=l.row[0]&&a<=l.row[1]?"allPart"==t?e=[{row:[c,a],column:[m,l.column[0]-1]},{row:[c,a],column:[l.column[1]+1,w]},{row:[c+n,a+n],column:[l.column[0]+u,l.column[1]+u]}]:"restPart"==t?e=[{row:[c,a],column:[m,l.column[0]-1]},{row:[c,a],column:[l.column[1]+1,w]}]:"operatePart"==t&&(e=[{row:[c+n,a+n],column:[l.column[0]+u,l.column[1]+u]}]):c>=l.row[0]&&c<=l.row[1]&&m>=l.column[0]&&m<=l.column[1]?"allPart"==t?e=[{row:[c,l.row[1]],column:[l.column[1]+1,w]},{row:[l.row[1]+1,a],column:[m,w]},{row:[c+n,l.row[1]+n],column:[m+u,l.column[1]+u]}]:"restPart"==t?e=[{row:[c,l.row[1]],column:[l.column[1]+1,w]},{row:[l.row[1]+1,a],column:[m,w]}]:"operatePart"==t&&(e=[{row:[c+n,l.row[1]+n],column:[m+u,l.column[1]+u]}]):c>=l.row[0]&&c<=l.row[1]&&w>=l.column[0]&&w<=l.column[1]?"allPart"==t?e=[{row:[c,l.row[1]],column:[m,l.column[0]-1]},{row:[l.row[1]+1,a],column:[m,w]},{row:[c+n,l.row[1]+n],column:[l.column[0]+u,w+u]}]:"restPart"==t?e=[{row:[c,l.row[1]],column:[m,l.column[0]-1]},{row:[l.row[1]+1,a],column:[m,w]}]:"operatePart"==t&&(e=[{row:[c+n,l.row[1]+n],column:[l.column[0]+u,w+u]}]):a>=l.row[0]&&a<=l.row[1]&&m>=l.column[0]&&m<=l.column[1]?"allPart"==t?e=[{row:[c,l.row[0]-1],column:[m,w]},{row:[l.row[0],a],column:[l.column[1]+1,w]},{row:[l.row[0]+n,a+n],column:[m+u,l.column[1]+u]}]:"restPart"==t?e=[{row:[c,l.row[0]-1],column:[m,w]},{row:[l.row[0],a],column:[l.column[1]+1,w]}]:"operatePart"==t&&(e=[{row:[l.row[0]+n,a+n],column:[m+u,l.column[1]+u]}]):a>=l.row[0]&&a<=l.row[1]&&w>=l.column[0]&&w<=l.column[1]?"allPart"==t?e=[{row:[c,l.row[0]-1],column:[m,w]},{row:[l.row[0],a],column:[m,l.column[0]-1]},{row:[l.row[0]+n,a+n],column:[l.column[0]+u,w+u]}]:"restPart"==t?e=[{row:[c,l.row[0]-1],column:[m,w]},{row:[l.row[0],a],column:[m,l.column[0]-1]}]:"operatePart"==t&&(e=[{row:[l.row[0]+n,a+n],column:[l.column[0]+u,w+u]}]):c<l.row[0]&&a>l.row[1]&&m>=l.column[0]&&m<=l.column[1]?"allPart"==t?e=[{row:[c,l.row[0]-1],column:[m,w]},{row:[l.row[0],l.row[1]],column:[l.column[1]+1,w]},{row:[l.row[1]+1,a],column:[m,w]},{row:[l.row[0]+n,l.row[1]+n],column:[m+u,l.column[1]+u]}]:"restPart"==t?e=[{row:[c,l.row[0]-1],column:[m,w]},{row:[l.row[0],l.row[1]],column:[l.column[1]+1,w]},{row:[l.row[1]+1,a],column:[m,w]}]:"operatePart"==t&&(e=[{row:[l.row[0]+n,l.row[1]+n],column:[m+u,l.column[1]+u]}]):c<l.row[0]&&a>l.row[1]&&w>=l.column[0]&&w<=l.column[1]?"allPart"==t?e=[{row:[c,l.row[0]-1],column:[m,w]},{row:[l.row[0],l.row[1]],column:[m,l.column[0]-1]},{row:[l.row[1]+1,a],column:[m,w]},{row:[l.row[0]+n,l.row[1]+n],column:[l.column[0]+u,w+u]}]:"restPart"==t?e=[{row:[c,l.row[0]-1],column:[m,w]},{row:[l.row[0],l.row[1]],column:[m,l.column[0]-1]},{row:[l.row[1]+1,a],column:[m,w]}]:"operatePart"==t&&(e=[{row:[l.row[0]+n,l.row[1]+n],column:[l.column[0]+u,w+u]}]):m<l.column[0]&&w>l.column[1]&&c>=l.row[0]&&c<=l.row[1]?"allPart"==t?e=[{row:[c,l.row[1]],column:[m,l.column[0]-1]},{row:[c,l.row[1]],column:[l.column[1]+1,w]},{row:[l.row[1]+1,a],column:[m,w]},{row:[c+n,l.row[1]+n],column:[l.column[0]+u,l.column[1]+u]}]:"restPart"==t?e=[{row:[c,l.row[1]],column:[m,l.column[0]-1]},{row:[c,l.row[1]],column:[l.column[1]+1,w]},{row:[l.row[1]+1,a],column:[m,w]}]:"operatePart"==t&&(e=[{row:[c+n,l.row[1]+n],column:[l.column[0]+u,l.column[1]+u]}]):m<l.column[0]&&w>l.column[1]&&a>=l.row[0]&&a<=l.row[1]?"allPart"==t?e=[{row:[c,l.row[0]-1],column:[m,w]},{row:[l.row[0],a],column:[m,l.column[0]-1]},{row:[l.row[0],a],column:[l.column[1]+1,w]},{row:[l.row[0]+n,a+n],column:[l.column[0]+u,l.column[1]+u]}]:"restPart"==t?e=[{row:[c,l.row[0]-1],column:[m,w]},{row:[l.row[0],a],column:[m,l.column[0]-1]},{row:[l.row[0],a],column:[l.column[1]+1,w]}]:"operatePart"==t&&(e=[{row:[l.row[0]+n,a+n],column:[l.column[0]+u,l.column[1]+u]}]):c<l.row[0]&&a>l.row[1]&&m<l.column[0]&&w>l.column[1]?"allPart"==t?e=[{row:[c,l.row[0]-1],column:[m,w]},{row:[l.row[0],l.row[1]],column:[m,l.column[0]-1]},{row:[l.row[0],l.row[1]],column:[l.column[1]+1,w]},{row:[l.row[1]+1,a],column:[m,w]},{row:[l.row[0]+n,l.row[1]+n],column:[l.column[0]+u,l.column[1]+u]}]:"restPart"==t?e=[{row:[c,l.row[0]-1],column:[m,w]},{row:[l.row[0],l.row[1]],column:[m,l.column[0]-1]},{row:[l.row[0],l.row[1]],column:[l.column[1]+1,w]},{row:[l.row[1]+1,a],column:[m,w]}]:"operatePart"==t&&(e=[{row:[l.row[0]+n,l.row[1]+n],column:[l.column[0]+u,l.column[1]+u]}]):"allPart"==t?e=[{row:[c,a],column:[m,w]}]:"restPart"==t?e=[{row:[c,a],column:[m,w]}]:"operatePart"==t&&(e=[]),e},getcolorGradation:function(o,l,r,t,e){let n=o.split(","),u=parseInt(n[0].split("(")[1]),c=parseInt(n[1]),a=parseInt(n[2].split(")")[0]),m=l.split(","),w=parseInt(m[0].split("(")[1]),f=parseInt(m[1]),i=parseInt(m[2].split(")")[0]);return"rgb("+Math.round(u-(u-w)/(r-t)*(r-e))+", "+Math.round(c-(c-f)/(r-t)*(r-e))+", "+Math.round(a-(a-i)/(r-t)*(r-e))+")"},getCFPartRange:function(o,l,r){let t=[],e=m.luckysheetfile[f(o)].luckysheet_conditionformat_save;if(null!=e&&e.length>0)o:for(let o=0;o<e.length;o++){let l=e[o].cellrange;for(let r=0;r<l.length;r++){let n=l[r].row[0],u=l[r].row[1],c=l[r].column[0],a=l[r].column[1];for(let l=0;l<range.length;l++)if(range[l].row[0]>=n&&range[l].row[0]<=u||range[l].row[1]>=n&&range[l].row[1]<=u||range[l].column[0]>=c&&range[l].column[0]<=a||range[l].column[1]>=c&&range[l].column[1]<=a){t.push(e[o]);continue o}}}return t},checksCF:function(o,l,r){return null!=r&&o+"_"+l in r?r[o+"_"+l]:null},getComputeMap:function(o){let l=f(m.currentSheetIndex);null!=o&&(l=f(o));let r=m.luckysheetfile[l].luckysheet_conditionformat_save,t=m.luckysheetfile[l].data;return null==t?null:this.compute(r,t)},compute:function(o,l){let t=this;null==o&&(o=[]);let e={};if(o.length>0)for(let n=0;n<o.length;n++){let u=o[n].type,c=o[n].cellrange,a=o[n].format;if("dataBar"==u){let o=null,r=null;for(let t=0;t<c.length;t++)for(let e=c[t].row[0];e<=c[t].row[1];e++)for(let n=c[t].column[0];n<=c[t].column[1];n++){if(null==l[e]||null==l[e][n])continue;let t=l[e][n];"object"==p(t)&&null!=t.ct&&"n"==t.ct.t&&null!=t.v&&((null==o||parseInt(t.v)>o)&&(o=parseInt(t.v)),(null==r||parseInt(t.v)<r)&&(r=parseInt(t.v)))}if(null!=o&&null!=r)if(r<0){let t=Math.round(o/(o-r)*10)/10,n=Math.round(Math.abs(r)/(o-r)*10)/10;for(let u=0;u<c.length;u++)for(let m=c[u].row[0];m<=c[u].row[1];m++)for(let w=c[u].column[0];w<=c[u].column[1];w++){if(null==l[m]||null==l[m][w])continue;let u=l[m][w];if("object"==p(u)&&null!=u.ct&&"n"==u.ct.t&&null!=u.v){if(parseInt(u.v)<0){let o=Math.round(Math.abs(parseInt(u.v))/Math.abs(r)*100)/100;m+"_"+w in e?e[m+"_"+w].dataBar={valueType:"minus",minusLen:n,valueLen:o,format:a}:e[m+"_"+w]={dataBar:{valueType:"minus",minusLen:n,valueLen:o,format:a}}}if(parseInt(u.v)>0){let l=Math.round(parseInt(u.v)/o*100)/100;m+"_"+w in e?e[m+"_"+w].dataBar={valueType:"plus",plusLen:t,minusLen:n,valueLen:l,format:a}:e[m+"_"+w]={dataBar:{valueType:"plus",plusLen:t,minusLen:n,valueLen:l,format:a}}}}}}else{let r=1;for(let t=0;t<c.length;t++)for(let n=c[t].row[0];n<=c[t].row[1];n++)for(let u=c[t].column[0];u<=c[t].column[1];u++){if(null==l[n]||null==l[n][u])continue;let t=l[n][u];if("object"==p(t)&&null!=t.ct&&"n"==t.ct.t&&null!=t.v){let l;l=0==o?1:Math.round(parseInt(t.v)/o*100)/100,n+"_"+u in e?e[n+"_"+u].dataBar={valueType:"plus",plusLen:r,valueLen:l,format:a}:e[n+"_"+u]={dataBar:{valueType:"plus",plusLen:r,valueLen:l,format:a}}}}}}else if("colorGradation"==u){let o=null,r=null,n=0,u=0;for(let t=0;t<c.length;t++)for(let e=c[t].row[0];e<=c[t].row[1];e++)for(let a=c[t].column[0];a<=c[t].column[1];a++){if(null==l[e]||null==l[e][a])continue;let t=l[e][a];"object"==p(t)&&null!=t.ct&&"n"==t.ct.t&&null!=t.v&&(u++,n+=parseInt(t.v),(null==o||parseInt(t.v)>o)&&(o=parseInt(t.v)),(null==r||parseInt(t.v)<r)&&(r=parseInt(t.v)))}if(null!=o&&null!=r)if(3==a.length){let m=Math.floor(n/u);for(let n=0;n<c.length;n++)for(let u=c[n].row[0];u<=c[n].row[1];u++)for(let w=c[n].column[0];w<=c[n].column[1];w++){if(null==l[u]||null==l[u][w])continue;let n=l[u][w];"object"==p(n)&&null!=n.ct&&"n"==n.ct.t&&null!=n.v&&(parseInt(n.v)==r?u+"_"+w in e?e[u+"_"+w].cellColor=a[2]:e[u+"_"+w]={cellColor:a[2]}:parseInt(n.v)>r&&parseInt(n.v)<m?u+"_"+w in e?e[u+"_"+w].cellColor=t.getcolorGradation(a[2],a[1],r,m,parseInt(n.v)):e[u+"_"+w]={cellColor:t.getcolorGradation(a[2],a[1],r,m,parseInt(n.v))}:parseInt(n.v)==m?u+"_"+w in e?e[u+"_"+w].cellColor=a[1]:e[u+"_"+w]={cellColor:a[1]}:parseInt(n.v)>m&&parseInt(n.v)<o?u+"_"+w in e?e[u+"_"+w].cellColor=t.getcolorGradation(a[1],a[0],m,o,parseInt(n.v)):e[u+"_"+w]={cellColor:t.getcolorGradation(a[1],a[0],m,o,parseInt(n.v))}:parseInt(n.v)==o&&(u+"_"+w in e?e[u+"_"+w].cellColor=a[0]:e[u+"_"+w]={cellColor:a[0]}))}}else if(2==a.length)for(let n=0;n<c.length;n++)for(let u=c[n].row[0];u<=c[n].row[1];u++)for(let m=c[n].column[0];m<=c[n].column[1];m++){if(null==l[u]||null==l[u][m])continue;let n=l[u][m];"object"==p(n)&&null!=n.ct&&"n"==n.ct.t&&null!=n.v&&(parseInt(n.v)==r?u+"_"+m in e?e[u+"_"+m].cellColor=a[1]:e[u+"_"+m]={cellColor:a[1]}:parseInt(n.v)>r&&parseInt(n.v)<o?u+"_"+m in e?e[u+"_"+m].cellColor=t.getcolorGradation(a[1],a[0],r,o,parseInt(n.v)):e[u+"_"+m]={cellColor:t.getcolorGradation(a[1],a[0],r,o,parseInt(n.v))}:parseInt(n.v)==o&&(u+"_"+m in e?e[u+"_"+m].cellColor=a[0]:e[u+"_"+m]={cellColor:a[0]}))}}else if("icons"==u){let o=parseInt(a.len),r=parseInt(a.leftMin),t=parseInt(a.top),n=null,u=null;for(let o=0;o<c.length;o++)for(let r=c[o].row[0];r<=c[o].row[1];r++)for(let t=c[o].column[0];t<=c[o].column[1];t++){if(null==l[r]||null==l[r][t])continue;let o=l[r][t];"object"==p(o)&&null!=o.ct&&"n"==o.ct.t&&null!=o.v&&((null==n||parseInt(o.v)>n)&&(n=parseInt(o.v)),(null==u||parseInt(o.v)<u)&&(u=parseInt(o.v)))}if(null!=n&&null!=u){let a=Math.floor((n-u+1)/o),m=(n-u+1)%o;if(3==o){let o,w,f;2==m?(o=[u,u+a],w=[u+a+1,u+2*a],f=[u+2*a+1,n]):(o=[u,u+a-1],w=[u+a,u+2*a-1],f=[u+2*a,n]);for(let n=0;n<c.length;n++)for(let u=c[n].row[0];u<=c[n].row[1];u++)for(let a=c[n].column[0];a<=c[n].column[1];a++){if(null==l[u]||null==l[u][a])continue;let n=l[u][a];"object"==p(n)&&null!=n.ct&&"n"==n.ct.t&&null!=n.v&&(parseInt(n.v)>=o[0]&&parseInt(n.v)<=o[1]?u+"_"+a in e?e[u+"_"+a].icons={left:r+2,top:t}:e[u+"_"+a]={icons:{left:r+2,top:t}}:parseInt(n.v)>=w[0]&&parseInt(n.v)<=w[1]?u+"_"+a in e?e[u+"_"+a].icons={left:r+1,top:t}:e[u+"_"+a]={icons:{left:r+1,top:t}}:parseInt(n.v)>=f[0]&&parseInt(n.v)<=f[1]&&(u+"_"+a in e?e[u+"_"+a].icons={left:r,top:t}:e[u+"_"+a]={icons:{left:r,top:t}}))}}else if(4==o){let o,w,f,i;2==m?(o=[u,u+a],w=[u+a+1,u+2*a],f=[u+2*a+1,u+3*a],i=[u+3*a+1,n]):3==m?(o=[u,u+a],w=[u+a+1,u+2*a],f=[u+2*a+1,u+3*a+1],i=[u+3*a+2,n]):(o=[u,u+a-1],w=[u+a,u+2*a-1],f=[u+2*a,u+3*a-1],i=[u+3*a,n]);for(let n=0;n<c.length;n++)for(let u=c[n].row[0];u<=c[n].row[1];u++)for(let a=c[n].column[0];a<=c[n].column[1];a++){if(null==l[u]||null==l[u][a])continue;let n=l[u][a];"object"==p(n)&&null!=n.ct&&"n"==n.ct.t&&null!=n.v&&(parseInt(n.v)>=o[0]&&parseInt(n.v)<=o[1]?u+"_"+a in e?e[u+"_"+a].icons={left:r+3,top:t}:e[u+"_"+a]={icons:{left:r+3,top:t}}:parseInt(n.v)>=w[0]&&parseInt(n.v)<=w[1]?u+"_"+a in e?e[u+"_"+a].icons={left:r+2,top:t}:e[u+"_"+a]={icons:{left:r+2,top:t}}:parseInt(n.v)>=f[0]&&parseInt(n.v)<=f[1]?u+"_"+a in e?e[u+"_"+a].icons={left:r+1,top:t}:e[u+"_"+a]={icons:{left:r+1,top:t}}:parseInt(n.v)>=i[0]&&parseInt(n.v)<=i[1]&&(u+"_"+a in e?e[u+"_"+a].icons={left:r,top:t}:e[u+"_"+a]={icons:{left:r,top:t}}))}}else if(5==o){let o,w,f,i,s;2==m?(o=[u,u+a],w=[u+a+1,u+2*a],f=[u+2*a+1,u+3*a],i=[u+3*a+1,u+4*a],s=[u+4*a+1,n]):3==m?(o=[u,u+a],w=[u+a+1,u+2*a],f=[u+2*a+1,u+3*a+1],i=[u+3*a+2,u+4*a+1],s=[u+4*a+2,n]):4==m?(o=[u,u+a],w=[u+a+1,u+2*a+1],f=[u+2*a+2,u+3*a+1],i=[u+3*a+2,u+4*a+2],s=[u+4*a+3,n]):(o=[u,u+a-1],w=[u+a,u+2*a-1],f=[u+2*a,u+3*a-1],i=[u+3*a,u+4*a-1],s=[u+4*a,n]);for(let n=0;n<c.length;n++)for(let u=c[n].row[0];u<=c[n].row[1];u++)for(let a=c[n].column[0];a<=c[n].column[1];a++){if(null==l[u]||null==l[u][a])continue;let n=l[u][a];"object"==p(n)&&null!=n.ct&&"n"==n.ct.t&&null!=n.v&&(parseInt(n.v)>=o[0]&&parseInt(n.v)<=o[1]?u+"_"+a in e?e[u+"_"+a].icons={left:r+4,top:t}:e[u+"_"+a]={icons:{left:r+4,top:t}}:parseInt(n.v)>=w[0]&&parseInt(n.v)<=w[1]?u+"_"+a in e?e[u+"_"+a].icons={left:r+3,top:t}:e[u+"_"+a]={icons:{left:r+3,top:t}}:parseInt(n.v)>=f[0]&&parseInt(n.v)<=f[1]?u+"_"+a in e?e[u+"_"+a].icons={left:r+2,top:t}:e[u+"_"+a]={icons:{left:r+2,top:t}}:parseInt(n.v)>=i[0]&&parseInt(n.v)<=i[1]?u+"_"+a in e?e[u+"_"+a].icons={left:r+1,top:t}:e[u+"_"+a]={icons:{left:r+1,top:t}}:parseInt(n.v)>=s[0]&&parseInt(n.v)<=s[1]&&(u+"_"+a in e?e[u+"_"+a].icons={left:r,top:t}:e[u+"_"+a]={icons:{left:r,top:t}}))}}}}else{let t=o[n].conditionName,u=o[n].conditionValue[0],m=o[n].conditionValue[1],w=a.textColor,f=a.cellColor;for(let o=0;o<c.length;o++)if("greaterThan"==t||"lessThan"==t||"equal"==t||"textContains"==t)for(let r=c[o].row[0];r<=c[o].row[1];r++)for(let n=c[o].column[0];n<=c[o].column[1];n++){if(null==l[r]||null==l[r][n])continue;let o=l[r][n];"object"!=p(o)||g(o.v)||("greaterThan"==t&&o.v>u?r+"_"+n in e?(e[r+"_"+n].textColor=w,e[r+"_"+n].cellColor=f):e[r+"_"+n]={textColor:w,cellColor:f}:"lessThan"==t&&o.v<u?r+"_"+n in e?(e[r+"_"+n].textColor=w,e[r+"_"+n].cellColor=f):e[r+"_"+n]={textColor:w,cellColor:f}:"equal"==t&&o.v==u?r+"_"+n in e?(e[r+"_"+n].textColor=w,e[r+"_"+n].cellColor=f):e[r+"_"+n]={textColor:w,cellColor:f}:"textContains"==t&&-1!=o.v.toString().indexOf(u)&&(r+"_"+n in e?(e[r+"_"+n].textColor=w,e[r+"_"+n].cellColor=f):e[r+"_"+n]={textColor:w,cellColor:f}))}else if("betweenness"==t){let r,t;u>m?(r=u,t=m):(r=m,t=u);for(let n=c[o].row[0];n<=c[o].row[1];n++)for(let u=c[o].column[0];u<=c[o].column[1];u++){if(null==l[n]||null==l[n][u])continue;let o=l[n][u];"object"!=p(o)||g(o.v)||o.v>=t&&o.v<=r&&(n+"_"+u in e?(e[n+"_"+u].textColor=w,e[n+"_"+u].cellColor=f):e[n+"_"+u]={textColor:w,cellColor:f})}}else if("occurrenceDate"==t){let r,t;if(-1==u.toString().indexOf("-"))r=d(u)[2],t=d(u)[2];else{let o=u.toString().split("-");r=d(o[1].trim())[2],t=d(o[0].trim())[2]}for(let n=c[o].row[0];n<=c[o].row[1];n++)for(let u=c[o].column[0];u<=c[o].column[1];u++)if(null!=l[n]&&null!=l[n][u]&&null!=l[n][u].ct&&"d"==l[n][u].ct.t){let o=v(n,u,l);o>=t&&o<=r&&(n+"_"+u in e?(e[n+"_"+u].textColor=w,e[n+"_"+u].cellColor=f):e[n+"_"+u]={textColor:w,cellColor:f})}}else if("duplicateValue"==t){let r={};for(let t=c[o].row[0];t<=c[o].row[1];t++)for(let e=c[o].column[0];e<=c[o].column[1];e++){let o=v(t,e,l);o in r||(r[o]=[]),r[o].push({r:t,c:e})}if("0"==u)for(let o in r)if("null"!=o&&"undefined"!=o&&r[o].length>1)for(let l=0;l<r[o].length;l++)r[o][l].r+"_"+r[o][l].c in e?(e[r[o][l].r+"_"+r[o][l].c].textColor=w,e[r[o][l].r+"_"+r[o][l].c].cellColor=f):e[r[o][l].r+"_"+r[o][l].c]={textColor:w,cellColor:f};if("1"==u)for(let o in r)"null"!=o&&"undefined"!=o&&1==r[o].length&&(r[o][0].r+"_"+r[o][0].c in e?(e[r[o][0].r+"_"+r[o][0].c].textColor=w,e[r[o][0].r+"_"+r[o][0].c].cellColor=f):e[r[o][0].r+"_"+r[o][0].c]={textColor:w,cellColor:f})}else if("top10"==t||"top10%"==t||"last10"==t||"last10%"==t||"AboveAverage"==t||"SubAverage"==t){let r=[];for(let t=c[o].row[0];t<=c[o].row[1];t++)for(let e=c[o].column[0];e<=c[o].column[1];e++)null!=l[t]&&null!=l[t][e]&&null!=l[t][e].ct&&"n"==l[t][e].ct.t&&r.push(v(t,e,l));if("top10"==t||"top10%"==t||"last10"==t||"last10%"==t){for(let o=0;o<r.length;o++)for(let l=0;l<r.length-1-o;l++)if(r[l]<r[l+1]){let o=r[l];r[l]=r[l+1],r[l+1]=o}let n;"top10"==t?n=r.slice(0,u):"top10%"==t?n=r.slice(0,Math.floor(u*r.length/100)):"last10"==t?n=r.slice(r.length-u,r.length):"last10%"==t&&(n=r.slice(r.length-Math.floor(u*r.length/100),r.length));for(let r=c[o].row[0];r<=c[o].row[1];r++)for(let t=c[o].column[0];t<=c[o].column[1];t++){if(null==l[r]||null==l[r][t])continue;let o=v(r,t,l);-1!=n.indexOf(o)&&(r+"_"+t in e?(e[r+"_"+t].textColor=w,e[r+"_"+t].cellColor=f):e[r+"_"+t]={textColor:w,cellColor:f})}}else if("AboveAverage"==t||"SubAverage"==t){let n=0;for(let o=0;o<r.length;o++)n+=r[o];let u=n/r.length;if("AboveAverage"==t)for(let r=c[o].row[0];r<=c[o].row[1];r++)for(let t=c[o].column[0];t<=c[o].column[1];t++){if(null==l[r]||null==l[r][t])continue;v(r,t,l)>u&&(r+"_"+t in e?(e[r+"_"+t].textColor=w,e[r+"_"+t].cellColor=f):e[r+"_"+t]={textColor:w,cellColor:f})}else if("SubAverage"==t)for(let r=c[o].row[0];r<=c[o].row[1];r++)for(let t=c[o].column[0];t<=c[o].column[1];t++){if(null==l[r]||null==l[r][t])continue;v(r,t,l)<u&&(r+"_"+t in e?(e[r+"_"+t].textColor=w,e[r+"_"+t].cellColor=f):e[r+"_"+t]={textColor:w,cellColor:f})}}}else if("formula"==t){let l=c[o].row[0],t=c[o].row[1],n=c[o].column[0],a=c[o].column[1],m=u;"="!=u.toString().slice(0,1)&&(m="="+u);for(let o=l;o<=t;o++)for(let t=n;t<=a;t++){let u=m,c=o-l,a=t-n;c>0&&(u="="+r.functionCopy(u,"down",c)),a>0&&(u="="+r.functionCopy(u,"right",a));let i=r.execfunction(u)[1];"boolean"!=typeof i&&(i=!!Number(i)),i&&(o+"_"+t in e?(e[o+"_"+t].textColor=w,e[o+"_"+t].cellColor=f):e[o+"_"+t]={textColor:w,cellColor:f})}}}}return e},updateItem:function(o,l,r){if(!C(m.currentSheetIndex))return;let t,e=f(m.currentSheetIndex),n=$.extend(!0,[],m.luckysheetfile),u=this.getHistoryRules(n);if("delSheet"==o)t=[];else{let n={type:o,cellrange:l,format:r};(t=null==m.luckysheetfile[e].luckysheet_conditionformat_save?[]:m.luckysheetfile[e].luckysheet_conditionformat_save).push(n)}m.luckysheetfile[e].luckysheet_conditionformat_save=t;let c=$.extend(!0,[],m.luckysheetfile),a=this.getCurrentRules(c);this.ref(u,a),m.allowUpdate&&m.saveParam("all",m.currentSheetIndex,t,{k:"luckysheet_conditionformat_save"})},getHistoryRules:function(o){let l=[];for(let r=0;r<o.length;r++)l.push({sheetIndex:o[r].index,luckysheet_conditionformat_save:o[r].luckysheet_conditionformat_save});return l},getCurrentRules:function(o){let l=[];for(let r=0;r<o.length;r++)l.push({sheetIndex:o[r].index,luckysheet_conditionformat_save:o[r].luckysheet_conditionformat_save});return l},ref:function(o,l){if(m.clearjfundo){m.jfundo.length=0;let r={type:"updateCF"};r.data={historyRules:o,currentRules:l},m.jfredo.push(r)}m.refresh()}}});
//# sourceMappingURL=../sourcemaps/methods/conditionformat_methods.js.map
