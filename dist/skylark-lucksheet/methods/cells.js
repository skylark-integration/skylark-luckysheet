/**
 * skylark-lucksheet - A version of lucksheet.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["./get","../utils/util","../store","./conditionformat_methods","./alternateformat_methods","../locale/locale"],function(l,e,n,t,r,u){"use strict";const{getSheetIndex:o}=l,{getObjType:i}=e,c={borderfix:function(l,e,n){return null==l[e][n]?[-1,0,0,-1]:null==l[e][n].bg||""==l[e][n].bg?[-1,0,0,-1]:[-2,-1,1,0]},mergeborer:function(l,e,t){if(null==l||null==l[e])return console.warn("Merge info is null",e,t),null;let r=l[e][t];if("object"==i(r)&&"mc"in r){let u=r.mc;if(null==u)return console.warn("Merge info is null",e,t),null;if(t=u.c,null==l[e=u.r][t])return console.warn("Main merge Cell info is null",e,t),null;let o,i,c,s,a,f,g,h,m=l[e][t].mc.cs,d=l[e][t].mc.rs,b=l[e][t].mc;for(let l=e;l<b.rs+e;l++)o=0==l?-1:n.visibledatarow[l-1]-1,i=n.visibledatarow[l],null==s?(s=o,c=i):c+=i-o-1;for(let l=t;l<b.cs+t;l++)a=0==l?0:n.visibledatacolumn[l-1],f=n.visibledatacolumn[l],null==h?(h=a,g=f):g+=f-a;return{row:[s,c,e,e+d-1],column:[h,g,t,t+m-1]}}return null},getCellRealSize:function(l,e,t){let r=this,u=n.defaultcollen,i=n.defaultrowlen,c=l[e][t];if(c&&null!=c.mc){let e=c.mc,n=r.mergeborer(l,e.r,e.c);if(n){let l=n.row[1],e=n.row[0],t=(n.row[2],n.row[3],n.column[1]),r=n.column[0];n.column[2],n.column[3];u=t-r-1,i=l-e-1}}else{let l=getluckysheetfile()[o(n.currentSheetIndex)].config;null!=l.columnlen&&null!=l.columnlen[t]&&(u=l.columnlen[t]),null!=l.rowlen&&null!=l.rowlen[e]&&(i=l.rowlen[e])}return[u,i]},getTextHeightCache:{},getTextSize:function(l,e){let n=u().fontarray,t=e||"10pt "+n[0],r=this;if(t in r.getTextHeightCache)return r.getTextHeightCache[t];0==$("#luckysheetTextSizeTest").length&&$('<span id="luckysheetTextSizeTest" style="float:left;white-space:nowrap;visibility:hidden;margin:0;padding:0;">'+l+"</span>").appendTo($("body"));let o=$("#luckysheetTextSizeTest").text(l).css({font:t}),i=o.innerWidth(),c=o.innerHeight();return r.getTextHeightCache[t]=[i,c],[i,c]},getStyleByCell:function(l,e,n){let o=this,s="",a=r.getComputeMap(),f=r.checksAF(e,n,a),g=t.getComputeMap(),h=t.checksCF(e,n,g);u().fontarray;let m=l[e][n],d=(m.ct,!1);c.isInlineStringCell(m)&&(d=!0);for(let t in m){let r=o.checkstatus(l,e,n,t);(null!=f||null!=h&&null!=h.cellColor)&&(null!=h&&null!=h.cellColor?s+="background: "+h.cellColor+";":null!=f&&(s+="background: "+f[1]+";")),"object"!=i(r)&&(("bg"==t||null!=f||null!=h&&null!=h.cellColor)&&(null!=h&&null!=h.cellColor?s+="background: "+h.cellColor+";":s+=null!=f?"background: "+f[1]+";":"background: "+r+";"),"ht"==t&&"1"!=r&&("0"==r?s+="text-align: center;":"2"==r&&(s+="text-align: right;")),"vt"==t&&"1"!=r&&("0"==r?s+="align-items: center;":"2"==r&&(s+="align-items: flex-end;")))}return d||(s+=c.getFontStyleByCell(m,f,h)),s},mergeMoveData:{},mergeMoveMain:function(l,e,t,r,u,o,i){let c=this,s=n.getSheetMerge();if(null==s)return;let a=[];for(let l in s)a.push(l);e[0]>e[1]&&(e[1]=e[0]),l[0]>l[1]&&(l[1]=l[0]);let f=!0;for(c.mergeMoveData={};f;){f=!1;for(let n=0;n<a.length;n++){let g=a[n],h=s[g];if(g in c.mergeMoveData)continue;let m=c.mergeMove(h,l,e,t,r,u,o,i);null!=m?(c.mergeMoveData[g]=h,l=m[0],e=m[1],r=m[2],u=m[3],o=m[4],i=m[5],f=!0):delete c.mergeMoveData[g]}}return[l,e,r,u,o,i]},mergeMove:function(l,e,t,r,u,o,i,c){let s=this,a=l.r,f=l.r+l.rs-1,g=l.c,h=l.c+l.cs-1,m=!1;if(e[1]<e[0]&&(e[0]=e[1]),t[1]<t[0]&&(t[0]=t[1]),e[0]<=g&&e[1]>=h&&t[0]<=a&&t[1]>=f||!(e[1]<g||e[0]>h)&&!(t[1]<a||t[0]>f)){let d=s.mergeborer(n.flowdata,l.r,l.c);if(d){let l=d.row[1],n=d.row[0],s=(d.row[2],d.column[1]),b=d.column[0];d.column[2];e[1]<g||e[0]>h||(t[0]<=f&&t[0]>=a&&(o+=u-n,u=n,t[0]=a),t[1]>=a&&t[1]<=f&&(o=(r.row_focus>=a&&r.row_focus,l-u),t[1]=f)),t[1]<a||t[0]>f||(e[0]<=h&&e[0]>=g&&(c+=i-b,i=b,e[0]=g),e[1]>=g&&e[1]<=h&&(c=(r.column_focus>=g&&r.column_focus,s-i),e[1]=h)),m=!0}}return m?[e,t,u,o,i,c]:null},isInlineStringCell:function(l){return l&&null!=l.ct&&"inlineStr"==l.ct.t&&null!=l.ct.s&&l.ct.s.length>0},isInlineStringCT:function(l){return null!=l&&"inlineStr"==l.t&&null!=l.s&&l.s.length>0},getFontStyleByCell:function(l,e,n,t=!0){if(null==l)return;let r="";const o=u().fontarray;for(let u in l){let i=l[u];if(t&&(i=c.checkstatusByCell(l,u)),"bl"==u&&"0"!=i&&(r+="font-weight: bold;"),"it"==u&&"0"!=i&&(r+="font-style:italic;"),"ff"==u){let l=i;r+="font-family: "+(l=isNaN(parseInt(i))?i:o[parseInt(i)])+";"}if("fs"==u&&"10"!=i&&(r+="font-size: "+i+"pt;"),("fc"==u&&"#000000"!=i||null!=e||null!=n&&null!=n.textColor)&&(null!=n&&null!=n.textColor?r+="color: "+n.textColor+";":r+=null!=e?"color: "+e[0]+";":"color: "+i+";"),"cl"==u&&"0"!=i&&(r+="text-decoration: line-through;"),"un"==u&&("1"==i||"3"==i)){let e=l._color;null==e&&(e=l.fc);let n=l._fontSize;null==n&&(n=l.fs),r+="border-bottom: "+Math.floor(n/9)+"px solid "+e+";"}}return r},checkstatusByCell:function(l,e){let n=l;return e in{bl:1,it:1,ff:1,cl:1,un:1}||"fs"==e&&c.isInlineStringCell(l)?null==n?n="0":null==(n=n[e])&&(n="0"):"fc"==e?null==n?n="#000000":(null==(n=n[e])&&(n="#000000"),n.indexOf("rgba")>-1&&(n=rgbTohex(n))):"bg"==e?null==n?n=null:null==(n=n[e])?n=null:n.toString().indexOf("rgba")>-1&&(n=rgbTohex(n)):"bs"==e.substr(0,2)?null==n?n="none":null==(n=n[e])&&(n="none"):"bc"==e.substr(0,2)?null==n?n="#000000":null==(n=n[e])&&(n="#000000"):"ht"==e?(null==n?n="1":null==(n=n[e])&&(n="1"),-1==["0","1","2"].indexOf(n.toString())&&(n="1")):"vt"==e?(null==n?n="0":null==(n=n[e])&&(n="0"),-1==["0","1","2"].indexOf(n.toString())&&(n="0")):"ct"==e?null==n?n=null:null==(n=n[e])&&(n=null):"fs"==e?null==n?n="10":null==(n=n[e])&&(n="10"):"tb"==e?null==n?n="0":null==(n=n[e])&&(n="0"):"tr"==e?null==n?n="0":null==(n=n[e])&&(n="0"):"rt"==e&&(null==n?n=null:null==(n=n[e])&&(n=null)),n},checkstatus:function(l,e,n,t){if(null==l||null==l[e])return console.warn("It's incorrect data",e,n),null;let r=l[e][n];return c.checkstatusByCell(r,t)}};return c});
//# sourceMappingURL=../sourcemaps/methods/cells.js.map
