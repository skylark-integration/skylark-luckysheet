/**
 * skylark-lucksheet - A version of lucksheet.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["../utils/util","../methods/get","../global/validate","../global/tooltip","./constant","./select","./conditionformat","../store","../locale/locale"],function(l,e,t,o,c,n,a,i,s){"use strict";const{replaceHtml:u}=l,{getSheetIndex:r}=e,{isRealNull:d,isEditMode:h}=t,{modelHTML:m}=c,{selectHightlightShow:b}=n;return{createDialog:function(){$("#luckysheet-modal-dialog-mask").show(),$("#luckysheet-locationCell-dialog").remove();const l=s(),e=l.findAndReplace,t=l.button;let o='<div class="listbox"><div class="listItem"><input type="radio" name="locationType" checked="checked" id="locationConstant"><label for="locationConstant">'+e.locationConstant+'</label><div class="subbox"><div class="subItem"><input type="checkbox" checked="checked" class="date" id="locationConstantDate"><label for="locationConstantDate">'+e.locationDate+'</label></div><div class="subItem"><input type="checkbox" checked="checked" class="number" id="locationConstantNumber"><label for="locationConstantNumber">'+e.locationDigital+'</label></div><div class="subItem"><input type="checkbox" checked="checked" class="string" id="locationConstantString"><label for="locationConstantString">'+e.locationString+'</label></div><div class="subItem"><input type="checkbox" checked="checked" class="boolean" id="locationConstantBoolean"><label for="locationConstantBoolean">'+e.locationBool+'</label></div><div class="subItem"><input type="checkbox" checked="checked" class="error" id="locationConstantError"><label for="locationConstantError">'+e.locationBool+'</label></div></div></div><div class="listItem"><input type="radio" name="locationType" id="locationFormula"><label for="locationFormula">'+e.locationFormula+'</label><div class="subbox"><div class="subItem"><input type="checkbox" checked="checked" class="date" id="locationFormulaDate" disabled="true"><label for="locationFormulaDate" style="color: #666">'+e.locationDate+'</label></div><div class="subItem"><input type="checkbox" checked="checked" class="number" id="locationFormulaNumber" disabled="true"><label for="locationFormulaNumber" style="color: #666">'+e.locationDigital+'</label></div><div class="subItem"><input type="checkbox" checked="checked" class="string" id="locationFormulaString" disabled="true"><label for="locationFormulaString" style="color: #666">'+e.locationString+'</label></div><div class="subItem"><input type="checkbox" checked="checked" class="boolean" id="locationFormulaBoolean" disabled="true"><label for="locationFormulaBoolean" style="color: #666">'+e.locationBool+'</label></div><div class="subItem"><input type="checkbox" checked="checked" class="error" id="locationFormulaError" disabled="true"><label for="locationFormulaError" style="color: #666">'+e.locationError+'</label></div></div></div><div class="listItem"><input type="radio" name="locationType" id="locationNull"><label for="locationNull">'+e.locationNull+'</label></div><div class="listItem"><input type="radio" name="locationType" id="locationCF"><label for="locationCF">'+e.locationCondition+'</label></div><div class="listItem"><input type="radio" name="locationType" id="locationStepRow"><label for="locationStepRow">'+e.locationRowSpan+'</label></div><div class="listItem"><input type="radio" name="locationType" id="locationStepColumn"><label for="locationStepColumn">'+e.locationColumnSpan+"</label></div></div>";$("body").append(u(m,{id:"luckysheet-locationCell-dialog",addclass:"luckysheet-locationCell-dialog",title:e.location,content:o,botton:'<button id="luckysheet-locationCell-dialog-confirm" class="btn btn-primary">'+t.confirm+'</button><button class="btn btn-default luckysheet-model-close-btn">'+t.cancel+"</button>",style:"z-index:100003"}));let c=$("#luckysheet-locationCell-dialog").find(".luckysheet-modal-dialog-content").css("min-width",400).end(),n=c.outerHeight(),a=c.outerWidth(),i=$(window).width(),r=$(window).height(),d=$(document).scrollLeft(),h=$(document).scrollTop();$("#luckysheet-locationCell-dialog").css({left:(i+d-a)/2,top:(r+h-n)/3}).show()},init:function(){let l=this;const e=s().findAndReplace;$(document).on("click","#luckysheet-locationCell-dialog .listItem input:radio",function(l){$("#luckysheet-locationCell-dialog .listItem input:checkbox").prop("disabled",!0),$("#luckysheet-locationCell-dialog .listItem .subbox label").css("color","#666"),$(this).siblings(".subbox").find("input:checkbox").removeAttr("disabled"),$(this).siblings(".subbox").find("label").css("color","#000")}),$(document).off("click.locationCellConfirm").on("click.locationCellConfirm","#luckysheet-locationCell-dialog #luckysheet-locationCell-dialog-confirm",function(){$("#luckysheet-modal-dialog-mask").hide(),$("#luckysheet-locationCell-dialog").hide();let t=$("#luckysheet-locationCell-dialog .listItem input:radio:checked"),c=t.attr("id");if("locationConstant"==c||"locationFormula"==c){let e,o,n=t.siblings(".subbox").find("input:checkbox:checked");if(0==n.length)return;if(5==n.length)e="all";else{let l=[];for(let e=0;e<n.length;e++)$(n[e]).hasClass("date")?l.push("d"):$(n[e]).hasClass("number")?l.push("n"):$(n[e]).hasClass("string")?l.push("s,g"):$(n[e]).hasClass("boolean")?l.push("b"):$(n[e]).hasClass("error")&&l.push("e");e=l.join(",")}o=0==i.luckysheet_select_save.length||1==i.luckysheet_select_save.length&&i.luckysheet_select_save[0].row[0]==i.luckysheet_select_save[0].row[1]&&i.luckysheet_select_save[0].column[0]==i.luckysheet_select_save[0].column[1]?[{row:[0,i.flowdata.length-1],column:[0,i.flowdata[0].length-1]}]:$.extend(!0,[],i.luckysheet_select_save),l.apply(o,c,e)}else if("locationStepRow"==c){if(0==i.luckysheet_select_save.length||1==i.luckysheet_select_save.length&&i.luckysheet_select_save[0].row[0]==i.luckysheet_select_save[0].row[1])return void(h()?alert(e.locationTiplessTwoRow):o.info("",e.locationTiplessTwoRow));let t=$.extend(!0,[],i.luckysheet_select_save);l.apply(t,"locationStepRow")}else if("locationStepColumn"==c){if(0==i.luckysheet_select_save.length||1==i.luckysheet_select_save.length&&i.luckysheet_select_save[0].column[0]==i.luckysheet_select_save[0].column[1])return void(h()?alert(e.locationTiplessTwoColumn):o.info("",e.locationTiplessTwoColumn));let t=$.extend(!0,[],i.luckysheet_select_save);l.apply(t,"locationStepColumn")}else{let e;e=0==i.luckysheet_select_save.length||1==i.luckysheet_select_save.length&&i.luckysheet_select_save[0].row[0]==i.luckysheet_select_save[0].row[1]&&i.luckysheet_select_save[0].column[0]==i.luckysheet_select_save[0].column[1]?[{row:[0,i.flowdata.length-1],column:[0,i.flowdata[0].length-1]}]:$.extend(!0,[],i.luckysheet_select_save),l.apply(e,c)}})},apply:function(l,e,t){const c=s().findAndReplace;let n=[];if("locationFormula"==e||"locationConstant"==e||"locationNull"==e){let o=null,c=null,a=null,s=null,u={};for(let n=0;n<l.length;n++){let r=l[n].row[0],h=l[n].row[1],m=l[n].column[0],b=l[n].column[1];(null==o||o<r)&&(o=r),(null==c||c>h)&&(c=h),(null==a||a<m)&&(a=m),(null==s||s>b)&&(s=b);for(let l=r;l<=h;l++)for(let o=m;o<=b;o++){let c=i.flowdata[l][o];null!=c&&null!=c.mc&&(c=i.flowdata[c.mc.r][c.mc.c]),"locationFormula"==e&&null!=c&&!d(c.v)&&null!=c.f&&("all"==t||null!=c.ct&&t.indexOf(c.ct.t)>-1)?u[l+"_"+o]=0:"locationConstant"==e&&null!=c&&!d(c.v)&&("all"==t||null!=c.ct&&t.indexOf(c.ct.t)>-1)?u[l+"_"+o]=0:"locationNull"!=e||null!=c&&!d(c.v)||(u[l+"_"+o]=0)}}n=this.getRangeArr(o,c,a,s,u,n)}else if("locationCF"==e){let e=r(i.currentSheetIndex),t=i.luckysheetfile[e].luckysheet_conditionformat_save,s=i.luckysheetfile[e].data;if(null==t||0==t.length)return void(h()?alert(c.locationTipNotFindCell):o.info("",c.locationTipNotFindCell));if(computeMap=a.compute(t,s),0==Object.keys(computeMap).length)return void(h()?alert(c.locationTipNotFindCell):o.info("",c.locationTipNotFindCell));let u=null,d=null,m=null,b=null,p={};for(let e=0;e<l.length;e++){let t=l[e].row[0],o=l[e].row[1],c=l[e].column[0],n=l[e].column[1];(null==u||u<t)&&(u=t),(null==d||d>o)&&(d=o),(null==m||m<c)&&(m=c),(null==b||b>n)&&(b=n);for(let l=t;l<=o;l++)for(let e=c;e<=n;e++)l+"_"+e in computeMap&&(p[l+"_"+e]=0)}n=this.getRangeArr(u,d,m,b,p,n)}else if("locationStepRow"==e)for(let e=0;e<l.length;e++){if(l[e].row[0]==l[e].row[1])continue;let t=l[e].row[0],o=l[e].row[1],c=l[e].column[0],a=l[e].column[1];for(let l=t;l<=o;l++)(l-t)%2==0&&n.push({row:[l,l],column:[c,a]})}else if("locationStepColumn"==e)for(let e=0;e<l.length;e++){if(l[e].column[0]==l[e].column[1])continue;let t=l[e].row[0],o=l[e].row[1],c=l[e].column[0],a=l[e].column[1];for(let l=c;l<=a;l++)(l-c)%2==0&&n.push({row:[t,o],column:[l,l]})}if(0==n.length)h()?alert(c.locationTipNotFindCell):o.info("",c.locationTipNotFindCell);else{i.luckysheet_select_save=n,b();let l=$("#luckysheet-cell-main").scrollLeft(),e=$("#luckysheet-cell-main").scrollTop(),t=$("#luckysheet-cell-main").height(),o=$("#luckysheet-cell-main").width(),c=i.luckysheet_select_save[0].row[0],a=i.luckysheet_select_save[0].row[1],s=i.luckysheet_select_save[0].column[0],u=i.luckysheet_select_save[0].column[1],r=i.visibledatarow[a],d=c-1==-1?0:i.visibledatarow[c-1],h=i.visibledatacolumn[u],m=s-1==-1?0:i.visibledatacolumn[s-1];h-l-o+20>0?$("#luckysheet-scrollbar-x").scrollLeft(h-o+20):m-l-20<0&&$("#luckysheet-scrollbar-x").scrollLeft(m-20),r-e-t+20>0?$("#luckysheet-scrollbar-y").scrollTop(r-t+20):d-e-20<0&&$("#luckysheet-scrollbar-y").scrollTop(d-20)}},getRangeArr(l,e,t,o,c,n){if(0==Object.keys(c).length)return n;let a=this,s=null,u=null,r=null,d=null;for(let h=l;h<=e;h++)for(let m=t;m<=o;m++){let b=i.flowdata[h][m];if(h+"_"+m in c){if(null!=b&&null!=b.mc){if(null==r){let i={row:[b.mc.r,b.mc.r+b.mc.rs-1],column:[b.mc.c,b.mc.c+b.mc.cs-1]};return n.push(i),c=a.deleteCellInSave(c,i),a.getRangeArr(l,e,t,o,c,n)}if(m<d){let i={row:[s,u],column:[r,d]};return n.push(i),c=a.deleteCellInSave(c,i),a.getRangeArr(l,e,t,o,c,n)}break}null==r?(r=m,d=m,s=h,u=h):m>d&&(d=m)}else if(null!=r){if(null!=b&&null!=b.mc)break;if(m<r);else{if(m<=d){let i={row:[s,u],column:[r,d]};return n.push(i),c=a.deleteCellInSave(c,i),a.getRangeArr(l,e,t,o,c,n)}u=h}}}if(null!=r){let i={row:[s,u],column:[r,d]};return n.push(i),c=a.deleteCellInSave(c,i),a.getRangeArr(l,e,t,o,c,n)}},deleteCellInSave(l,e){for(let t=e.row[0];t<=e.row[1];t++)for(let o=e.column[0];o<=e.column[1];o++)delete l[t+"_"+o];return l}}});
//# sourceMappingURL=../sourcemaps/controllers/locationCell.js.map
