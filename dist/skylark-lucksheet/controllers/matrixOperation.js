/**
 * skylark-lucksheet - A version of lucksheet.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["./selection","../utils/util","../global/validate","../global/getdata","../global/tooltip","../global/editor","../locale/locale","../store"],function(e,l,t,n,o,s,u,c){"use strict";const{getObjType:r,chatatABC:i,numFormat:h,luckysheetContainerFocus:a}=l,{hasPartMC:f,isEditMode:y}=t,{getdatabyselection:g,getcellvalue:v}=n;return{initialMatrixOperation:function(){const l=u().drag;$("#luckysheet-copy-json-head").click(function(t){if($("body .luckysheet-cols-menu").hide(),a(),c.luckysheet_select_save.length>1)return void(y()?alert(l.noMulti):o.info(l.noMulti,""));if(null!=c.config.merge){let e=!1;for(let l=0;l<c.luckysheet_select_save.length;l++){let t=c.luckysheet_select_save[l].row[0],n=c.luckysheet_select_save[l].row[1],o=c.luckysheet_select_save[l].column[0],s=c.luckysheet_select_save[l].column[1];if(e=f(c.config,t,n,o,s))break}if(e)return void(y()?alert(l.noPartMerge):o.info(l.noPartMerge,""))}let n=g(c.luckysheet_select_save[0]),s=[];if(0!=n.length){if(1==n.length){let e={};for(let l=0;l<n[0].length;l++)e[v(0,l,n)]="";s.push(e)}else for(let e=1;e<n.length;e++){let l={};for(let t=0;t<n[0].length;t++)void 0==v(0,t,n)?l[""]=v(e,t,n):l[v(0,t,n)]=v(e,t,n);s.push(l)}e.copybyformat(t,JSON.stringify(s))}}),$("#luckysheet-copy-json-nohead").click(function(t){if($("body .luckysheet-cols-menu").hide(),a(),c.luckysheet_select_save.length>1)return void(y()?alert(l.noMulti):o.info(l.noMulti,""));if(null!=c.config.merge){let e=!1;for(let l=0;l<c.luckysheet_select_save.length;l++){let t=c.luckysheet_select_save[l].row[0],n=c.luckysheet_select_save[l].row[1],o=c.luckysheet_select_save[l].column[0],s=c.luckysheet_select_save[l].column[1];if(e=f(c.config,t,n,o,s))break}if(e)return void(y()?alert(l.noPartMerge):o.info(l.noPartMerge,""))}let n=g(c.luckysheet_select_save[0]),s=[];if(0==n.length)return;let u=c.luckysheet_select_save[0].column[0];for(let e=0;e<n.length;e++){let l={};for(let t=0;t<n[0].length;t++)l[i(t+u)]=v(e,t,n);s.push(l)}e.copybyformat(t,JSON.stringify(s))}),$("#luckysheet-copy-array1").click(function(t){if($("body .luckysheet-cols-menu").hide(),a(),c.luckysheet_select_save.length>1)return void(y()?alert(l.noMulti):o.info(l.noMulti,""));if(null!=c.config.merge){let e=!1;for(let l=0;l<c.luckysheet_select_save.length;l++){let t=c.luckysheet_select_save[l].row[0],n=c.luckysheet_select_save[l].row[1],o=c.luckysheet_select_save[l].column[0],s=c.luckysheet_select_save[l].column[1];if(e=f(c.config,t,n,o,s))break}if(e)return void(y()?alert(l.noPartMerge):o.info(l.noPartMerge,""))}let n=g(c.luckysheet_select_save[0]),s=[];if(0!=n.length){for(let e=0;e<n.length;e++)for(let l=0;l<n[0].length;l++)s.push(v(e,l,n));e.copybyformat(t,JSON.stringify(s))}}),$("#luckysheet-copy-array2").click(function(t){if($("body .luckysheet-cols-menu").hide(),a(),c.luckysheet_select_save.length>1)return void(y()?alert(l.noMulti):o.info(l.noMulti,""));if(null!=c.config.merge){let e=!1;for(let l=0;l<c.luckysheet_select_save.length;l++){let t=c.luckysheet_select_save[l].row[0],n=c.luckysheet_select_save[l].row[1],o=c.luckysheet_select_save[l].column[0],s=c.luckysheet_select_save[l].column[1];if(e=f(c.config,t,n,o,s))break}if(e)return void(y()?alert(l.noPartMerge):o.info(l.noPartMerge,""))}let n=g(c.luckysheet_select_save[0]),s=[];if(0!=n.length){for(let e=0;e<n.length;e++){let l=[];for(let t=0;t<n[0].length;t++)l.push(v(e,t,n));s.push(l)}e.copybyformat(t,JSON.stringify(s))}}),$("#luckysheet-copy-arraymore-confirm").click(function(t){if("INPUT"===t.target.nodeName)return;if($("body .luckysheet-cols-menu").hide(),c.luckysheet_select_save.length>1)return void(y()?alert(l.noMulti):o.info(l.noMulti,""));if(null!=c.config.merge){let e=!1;for(let l=0;l<c.luckysheet_select_save.length;l++){let t=c.luckysheet_select_save[l].row[0],n=c.luckysheet_select_save[l].row[1],o=c.luckysheet_select_save[l].column[0],s=c.luckysheet_select_save[l].column[1];if(e=f(c.config,t,n,o,s))break}if(e)return void(y()?alert(l.noPartMerge):o.info(l.noPartMerge,""))}let n=g(c.luckysheet_select_save[0]),s=[];if(0==n.length)return;for(let e=0;e<n.length;e++)for(let l=0;l<n[0].length;l++)s.push(n[e][l]);let u=$("#luckysheet-copy-arraymore-row").val(),r=$("#luckysheet-copy-arraymore-col").val();if(""==u&&""==r)return e.copybyformat(t,JSON.stringify(s)),void $("body .luckysheet-cols-menu").hide();if(""==u?u=1:null==(u=parseInt(u))&&(u=1),""==r?r=1:null==(r=parseInt(r))&&(r=1),"NaN"==u.toString()||"NaN"==r.toString())return void(y()?alert(l.inputCorrect):o.info(l.inputCorrect,""));if(u<1||r<1)return void(y()?alert(l.notLessOne):o.info(l.notLessOne,""));let i=s.length,h=0,a=[];for(let l=0;l<u;l++){let l=[];for(let n=0;n<r;n++)if(l.push(s[h++]),h>=i)return e.copybyformat(t,JSON.stringify(a)),void $("body .luckysheet-cols-menu").hide();a.push(l)}e.copybyformat(t,JSON.stringify(a))}),$("#luckysheet-copy-diagonal").click(function(t){if($("body .luckysheet-cols-menu").hide(),a(),c.luckysheet_select_save.length>1)return void(y()?alert(l.noMulti):o.info(l.noMulti,""));if(null!=c.config.merge){let e=!1;for(let l=0;l<c.luckysheet_select_save.length;l++){let t=c.luckysheet_select_save[l].row[0],n=c.luckysheet_select_save[l].row[1],o=c.luckysheet_select_save[l].column[0],s=c.luckysheet_select_save[l].column[1];if(e=f(c.config,t,n,o,s))break}if(e)return void(y()?alert(l.noPartMerge):o.info(l.noPartMerge,""))}let n=g(c.luckysheet_select_save[0]),s=[];if(0==n.length)return;let u=n[0].length;for(let e=0;e<n.length&&!(e>=u);e++)s.push(n[e][e]);e.copybyformat(t,JSON.stringify(s))}),$("#luckysheet-copy-antidiagonal").click(function(t){if($("body .luckysheet-cols-menu").hide(),a(),c.luckysheet_select_save.length>1)return void(y()?alert(l.noMulti):o.info(l.noMulti,""));if(null!=c.config.merge){let e=!1;for(let l=0;l<c.luckysheet_select_save.length;l++){let t=c.luckysheet_select_save[l].row[0],n=c.luckysheet_select_save[l].row[1],o=c.luckysheet_select_save[l].column[0],s=c.luckysheet_select_save[l].column[1];if(e=f(c.config,t,n,o,s))break}if(e)return void(y()?alert(l.noPartMerge):o.info(l.noPartMerge,""))}let n=g(c.luckysheet_select_save[0]),s=[];if(0==n.length)return;let u=n[0].length;for(let e=0;e<n.length&&!(e>=u);e++)s.push(n[e][u-e-1]);e.copybyformat(t,JSON.stringify(s))}),$("#luckysheet-copy-diagonaloffset").click(function(t){if("INPUT"===t.target.nodeName)return;if($("body .luckysheet-cols-menu").hide(),a(),c.luckysheet_select_save.length>1)return void(y()?alert(l.noMulti):o.info(l.noMulti,""));if(null!=c.config.merge){let e=!1;for(let l=0;l<c.luckysheet_select_save.length;l++){let t=c.luckysheet_select_save[l].row[0],n=c.luckysheet_select_save[l].row[1],o=c.luckysheet_select_save[l].column[0],s=c.luckysheet_select_save[l].column[1];if(e=f(c.config,t,n,o,s))break}if(e)return void(y()?alert(l.noPartMerge):o.info(l.noPartMerge,""))}let n=g(c.luckysheet_select_save[0]),s=[];if(0==n.length)return;let u=n[0].length,r=parseInt($("#luckysheet-copy-diagonaloffset-value").val());if("NaN"!=r.toString())if(r<0)y()?alert(l.offsetColumnLessZero):o.info(l.offsetColumnLessZero,"");else{null==r&&(r=1);for(let e=0;e<n.length&&!(e+r>=u);e++)s.push(n[e][e+r]);e.copybyformat(t,JSON.stringify(s))}else y()?alert(l.inputCorrect):o.info(l.inputCorrect,"")}),$("#luckysheet-copy-boolvalue").click(function(t){if($("body .luckysheet-cols-menu").hide(),a(),c.luckysheet_select_save.length>1)return void(y()?alert(l.noMulti):o.info(l.noMulti,""));if(null!=c.config.merge){let e=!1;for(let l=0;l<c.luckysheet_select_save.length;l++){let t=c.luckysheet_select_save[l].row[0],n=c.luckysheet_select_save[l].row[1],o=c.luckysheet_select_save[l].column[0],s=c.luckysheet_select_save[l].column[1];if(e=f(c.config,t,n,o,s))break}if(e)return void(y()?alert(l.noPartMerge):o.info(l.noPartMerge,""))}let n=g(c.luckysheet_select_save[0]),s=[];if(0!=n.length){for(let e=0;e<n.length;e++){let l=[];for(let t=0;t<n[0].length;t++){let o,s=!1;s=null!=(o="object"==r(n[e][t])?n[e][t].v:n[e][t])&&""!=o&&(null==(o=parseInt(o))||o>0),l.push(s)}s.push(l)}e.copybyformat(t,JSON.stringify(s))}}),$("#luckysheet-matrix-turn-up").click(function(e){if($("body .luckysheet-cols-menu").hide(),a(),c.luckysheet_select_save.length>1)return void(y()?alert(l.noMulti):o.info(l.noMulti,""));let t=g(c.luckysheet_select_save[0]);if(0==t.length)return;let n=[];for(let e=t.length-1;e>=0;e--){let l=[];for(let n=0;n<t[0].length;n++){let o="";null!=t[e]&&null!=t[e][n]&&(o=t[e][n]),l.push(o)}n.push(l)}s.controlHandler(n)}),$("#luckysheet-matrix-turn-left").click(function(e){if($("body .luckysheet-cols-menu").hide(),a(),c.luckysheet_select_save.length>1)return void(y()?alert(l.noMulti):o.info(l.noMulti,""));let t=g(c.luckysheet_select_save[0]);if(0==t.length)return;let n=[];for(let e=0;e<t.length;e++){let l=[];for(let n=t[0].length-1;n>=0;n--){let o="";null!=t[e]&&null!=t[e][n]&&(o=t[e][n]),l.push(o)}n.push(l)}s.controlHandler(n)}),$("#luckysheet-matrix-turn-cw").click(function(e){if($("body .luckysheet-cols-menu").hide(),a(),c.luckysheet_select_save.length>1)return void(y()?alert(l.noMulti):o.info(l.noMulti,""));let t=g(c.luckysheet_select_save[0]);if(0==t.length)return;let n=[];for(let e=0;e<t[0].length;e++){let l=[];for(let n=t.length-1;n>=0;n--){let o="";null!=t[n]&&null!=t[n][e]&&(o=t[n][e]),l.push(o)}n.push(l)}s.controlHandlerD(n)}),$("#luckysheet-matrix-turn-anticw").click(function(e){if($("body .luckysheet-cols-menu").hide(),a(),c.luckysheet_select_save.length>1)return void(y()?alert(l.noMulti):o.info(l.noMulti,""));let t=g(c.luckysheet_select_save[0]);if(0==t.length)return;let n=[];for(let e=t[0].length-1;e>=0;e--){let l=[];for(let n=0;n<t.length;n++){let o="";null!=t[n]&&null!=t[n][e]&&(o=t[n][e]),l.push(o)}n.push(l)}s.controlHandlerD(n)}),$("#luckysheet-matrix-turn-trans").click(function(e){if($("body .luckysheet-cols-menu").hide(),a(),c.luckysheet_select_save.length>1)return void(y()?alert(l.noMulti):o.info(l.noMulti,""));let t=g(c.luckysheet_select_save[0]);if(0==t.length)return;let n=[];for(let e=0;e<t[0].length;e++){let l=[];for(let n=0;n<t.length;n++){let o="";null!=t[n]&&null!=t[n][e]&&(o=t[n][e]),l.push(o)}n.push(l)}s.controlHandlerD(n)});let t=function(e,l){if(0==e)return 0;let t,n;for(n=(l-1)*(t=e)/l+e/(Math.pow(t,l-1)*l);Math.abs(n-t)>1e-6;)n=(l-1)*(t=n)/l+e/(Math.pow(t,l-1)*l);return n};$("#luckysheet-matrix-cal-confirm").click(function(e){if("INPUT"===e.target.nodeName||"SELECT"===e.target.nodeName)return;if($("body .luckysheet-cols-menu").hide(),a(),c.luckysheet_select_save.length>1)return void(y()?alert(l.noMulti):o.info(l.noMulti,""));let n=g(c.luckysheet_select_save[0]);if(0==n.length)return;let u=$("#luckysheet-matrix-cal-type").val(),r=parseInt($("#luckysheet-matrix-cal-value").val());if("NaN"==r.toString())return void(y()?alert(l.inputCorrect):o.info(l.inputCorrect,""));null==r&&(r=2);let i=[];for(let e=0;e<n.length;e++){let l=[];for(let o=0;o<n[0].length;o++){let s="";null!=n[e]&&null!=n[e][o]&&(s=n[e][o],null!=parseInt(s)&&void 0!=n[e][o].ct&&"n"==n[e][o].ct.t&&("minus"==u?s.v=s.v-r:"multiply"==u?s.v=s.v*r:"divided"==u?s.v=h(s.v/r,4):"power"==u?s.v=Math.pow(s.v,r):"root"==u?2==r?s.v=h(Math.sqrt(s.v),4):3==r&&Math.cbrt?s.v=h(Math.cbrt(s.v),4):s.v=h(t(s.v,r),4):s.v="log"==u?h(1e4*Math.log(s.v)/Math.log(Math.abs(r)),4):s.v+r,null==s.v?s.m="":s.m=s.v.toString())),l.push(s)}i.push(l)}s.controlHandler(i)}),$("#luckysheet-matrix-delezero-row").click(function(e){if($("body .luckysheet-cols-menu").hide(),a(),c.luckysheet_select_save.length>1)return void(y()?alert(l.noMulti):o.info(l.noMulti,""));let t=g(c.luckysheet_select_save[0]);if(0==t.length)return;let n=[],u=t[0].length;for(let e=0;e<t.length;e++){let l=[],o=!0,s=!0;for(let n=0;n<u;n++){let s="";if(null!=t[e]&&null!=t[e][n]){if(("0"==(s=t[e][n]).v||0==s.v)&&o)continue;o=!1}l.push(s)}let c=[];if(l.length==u)c=l;else{for(let e=l.length-1;e>=0;e--){let t="";if(null!=l[e]){if(("0"==(t=l[e]).v||0==t.v)&&s)continue;s=!1}c.unshift(t)}let e=u-c.length;for(let l=0;l<e;l++)c.push("")}n.push(c)}s.controlHandler(n)}),$("#luckysheet-matrix-delezero-column").click(function(e){if($("body .luckysheet-cols-menu").hide(),a(),c.luckysheet_select_save.length>1)return void(y()?alert(l.noMulti):o.info(l.noMulti,""));let t=g(c.luckysheet_select_save[0]);if(0==t.length)return;let n=[],u=t.length,r=t[0].length;for(let e=0;e<r;e++){let l=[],o=!0,s=!0;for(let n=0;n<u;n++){let s="";if(null!=t[n]&&null!=t[n][e]){if(("0"==(s=t[n][e]).v||0==s.v)&&o)continue;o=!1}l.push(s)}let c=[];if(l.length==u)c=l;else{for(let e=l.length-1;e>=0;e--){let t="";if(null!=l[e]){if(("0"==(t=l[e]).v||0==t.v)&&s)continue;s=!1}c.unshift(t)}let e=u-c.length;for(let l=0;l<e;l++)c.push("")}n.push(c)}let i=[];for(let e=0;e<n[0].length;e++){let l=[];for(let t=0;t<n.length;t++){let o="";null!=n[t]&&null!=n[t][e]&&(o=n[t][e]),l.push(o)}i.push(l)}s.controlHandler(i)}),$("#luckysheet-matrix-delerpt-row").click(function(e){if($("body .luckysheet-cols-menu").hide(),a(),c.luckysheet_select_save.length>1)return void(y()?alert(l.noMulti):o.info(l.noMulti,""));let t=g(c.luckysheet_select_save[0]);if(0==t.length)return;let n=[],u=t[0].length;for(let e=0;e<t.length;e++){let l=[],o={};for(let l=0;l<u;l++){let n=null;null!=t[e]&&null!=t[e][l]&&((n=t[e][l]).v in o?o[n.v].push(n):(o[n.v]=[],o[n.v].push(n)))}for(let n=0;n<u;n++){let s=null;null!=t[e]&&null!=t[e][n]&&1==o[(s=t[e][n]).v].length&&l.push(s)}let s=u-l.length;for(let e=0;e<s;e++)l.push(null);n.push(l)}s.controlHandler(n)}),$("#luckysheet-matrix-delerpt-column").click(function(e){if($("body .luckysheet-cols-menu").hide(),a(),c.luckysheet_select_save.length>1)return void(y()?alert(l.noMulti):o.info(l.noMulti,""));let t=g(c.luckysheet_select_save[0]);if(0==t.length)return;let n=[],u=t.length,r=t[0].length;for(let e=0;e<r;e++){let l=[],o={};for(let l=0;l<u;l++){let n=null;null!=t[l]&&null!=t[l][e]&&((n=t[l][e]).v in o?o[n.v].push(n):(o[n.v]=[],o[n.v].push(n)))}for(let n=0;n<u;n++){let s=null;null!=t[n]&&null!=t[n][e]&&1==o[(s=t[n][e]).v].length&&l.push(s)}a1=l;let s=u-a1.length;for(let e=0;e<s;e++)a1.push(null);n.push(a1)}let i=[];for(let e=0;e<n[0].length;e++){let l=[];for(let t=0;t<n.length;t++){let o=null;null!=n[t]&&null!=n[t][e]&&(o=n[t][e]),l.push(o)}i.push(l)}s.controlHandler(i)})}}});
//# sourceMappingURL=../sourcemaps/controllers/matrixOperation.js.map
