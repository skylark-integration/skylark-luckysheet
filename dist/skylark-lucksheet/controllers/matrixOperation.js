/**
 * skylark-lucksheet - A version of lucksheet.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["./selection","../methods/luckysheetConfigsetting","../utils/util","../methods/validate","../methods/getdata","../widgets/tooltip","./editor","../locale/locale","../store"],function(e,t,l,n,o,s,u,c,r){"use strict";const{getObjType:i,chatatABC:h,numFormat:a,luckysheetContainerFocus:f}=l,{hasPartMC:y}=n,g=t.isEditMode,{getdatabyselection:v,getcellvalue:_}=o;return{initialMatrixOperation:function(){const t=c().drag;$("#luckysheet-copy-json-head").click(function(l){if($("body .luckysheet-cols-menu").hide(),f(),r.luckysheet_select_save.length>1)return void(g()?alert(t.noMulti):s.info(t.noMulti,""));if(null!=r.config.merge){let e=!1;for(let t=0;t<r.luckysheet_select_save.length;t++){let l=r.luckysheet_select_save[t].row[0],n=r.luckysheet_select_save[t].row[1],o=r.luckysheet_select_save[t].column[0],s=r.luckysheet_select_save[t].column[1];if(e=y(r.config,l,n,o,s))break}if(e)return void(g()?alert(t.noPartMerge):s.info(t.noPartMerge,""))}let n=v(r.luckysheet_select_save[0]),o=[];if(0!=n.length){if(1==n.length){let e={};for(let t=0;t<n[0].length;t++)e[_(0,t,n)]="";o.push(e)}else for(let e=1;e<n.length;e++){let t={};for(let l=0;l<n[0].length;l++)void 0==_(0,l,n)?t[""]=_(e,l,n):t[_(0,l,n)]=_(e,l,n);o.push(t)}e.copybyformat(l,JSON.stringify(o))}}),$("#luckysheet-copy-json-nohead").click(function(l){if($("body .luckysheet-cols-menu").hide(),f(),r.luckysheet_select_save.length>1)return void(g()?alert(t.noMulti):s.info(t.noMulti,""));if(null!=r.config.merge){let e=!1;for(let t=0;t<r.luckysheet_select_save.length;t++){let l=r.luckysheet_select_save[t].row[0],n=r.luckysheet_select_save[t].row[1],o=r.luckysheet_select_save[t].column[0],s=r.luckysheet_select_save[t].column[1];if(e=y(r.config,l,n,o,s))break}if(e)return void(g()?alert(t.noPartMerge):s.info(t.noPartMerge,""))}let n=v(r.luckysheet_select_save[0]),o=[];if(0==n.length)return;let u=r.luckysheet_select_save[0].column[0];for(let e=0;e<n.length;e++){let t={};for(let l=0;l<n[0].length;l++)t[h(l+u)]=_(e,l,n);o.push(t)}e.copybyformat(l,JSON.stringify(o))}),$("#luckysheet-copy-array1").click(function(l){if($("body .luckysheet-cols-menu").hide(),f(),r.luckysheet_select_save.length>1)return void(g()?alert(t.noMulti):s.info(t.noMulti,""));if(null!=r.config.merge){let e=!1;for(let t=0;t<r.luckysheet_select_save.length;t++){let l=r.luckysheet_select_save[t].row[0],n=r.luckysheet_select_save[t].row[1],o=r.luckysheet_select_save[t].column[0],s=r.luckysheet_select_save[t].column[1];if(e=y(r.config,l,n,o,s))break}if(e)return void(g()?alert(t.noPartMerge):s.info(t.noPartMerge,""))}let n=v(r.luckysheet_select_save[0]),o=[];if(0!=n.length){for(let e=0;e<n.length;e++)for(let t=0;t<n[0].length;t++)o.push(_(e,t,n));e.copybyformat(l,JSON.stringify(o))}}),$("#luckysheet-copy-array2").click(function(l){if($("body .luckysheet-cols-menu").hide(),f(),r.luckysheet_select_save.length>1)return void(g()?alert(t.noMulti):s.info(t.noMulti,""));if(null!=r.config.merge){let e=!1;for(let t=0;t<r.luckysheet_select_save.length;t++){let l=r.luckysheet_select_save[t].row[0],n=r.luckysheet_select_save[t].row[1],o=r.luckysheet_select_save[t].column[0],s=r.luckysheet_select_save[t].column[1];if(e=y(r.config,l,n,o,s))break}if(e)return void(g()?alert(t.noPartMerge):s.info(t.noPartMerge,""))}let n=v(r.luckysheet_select_save[0]),o=[];if(0!=n.length){for(let e=0;e<n.length;e++){let t=[];for(let l=0;l<n[0].length;l++)t.push(_(e,l,n));o.push(t)}e.copybyformat(l,JSON.stringify(o))}}),$("#luckysheet-copy-arraymore-confirm").click(function(l){if("INPUT"===l.target.nodeName)return;if($("body .luckysheet-cols-menu").hide(),r.luckysheet_select_save.length>1)return void(g()?alert(t.noMulti):s.info(t.noMulti,""));if(null!=r.config.merge){let e=!1;for(let t=0;t<r.luckysheet_select_save.length;t++){let l=r.luckysheet_select_save[t].row[0],n=r.luckysheet_select_save[t].row[1],o=r.luckysheet_select_save[t].column[0],s=r.luckysheet_select_save[t].column[1];if(e=y(r.config,l,n,o,s))break}if(e)return void(g()?alert(t.noPartMerge):s.info(t.noPartMerge,""))}let n=v(r.luckysheet_select_save[0]),o=[];if(0==n.length)return;for(let e=0;e<n.length;e++)for(let t=0;t<n[0].length;t++)o.push(n[e][t]);let u=$("#luckysheet-copy-arraymore-row").val(),c=$("#luckysheet-copy-arraymore-col").val();if(""==u&&""==c)return e.copybyformat(l,JSON.stringify(o)),void $("body .luckysheet-cols-menu").hide();if(""==u?u=1:null==(u=parseInt(u))&&(u=1),""==c?c=1:null==(c=parseInt(c))&&(c=1),"NaN"==u.toString()||"NaN"==c.toString())return void(g()?alert(t.inputCorrect):s.info(t.inputCorrect,""));if(u<1||c<1)return void(g()?alert(t.notLessOne):s.info(t.notLessOne,""));let i=o.length,h=0,a=[];for(let t=0;t<u;t++){let t=[];for(let n=0;n<c;n++)if(t.push(o[h++]),h>=i)return e.copybyformat(l,JSON.stringify(a)),void $("body .luckysheet-cols-menu").hide();a.push(t)}e.copybyformat(l,JSON.stringify(a))}),$("#luckysheet-copy-diagonal").click(function(l){if($("body .luckysheet-cols-menu").hide(),f(),r.luckysheet_select_save.length>1)return void(g()?alert(t.noMulti):s.info(t.noMulti,""));if(null!=r.config.merge){let e=!1;for(let t=0;t<r.luckysheet_select_save.length;t++){let l=r.luckysheet_select_save[t].row[0],n=r.luckysheet_select_save[t].row[1],o=r.luckysheet_select_save[t].column[0],s=r.luckysheet_select_save[t].column[1];if(e=y(r.config,l,n,o,s))break}if(e)return void(g()?alert(t.noPartMerge):s.info(t.noPartMerge,""))}let n=v(r.luckysheet_select_save[0]),o=[];if(0==n.length)return;let u=n[0].length;for(let e=0;e<n.length&&!(e>=u);e++)o.push(n[e][e]);e.copybyformat(l,JSON.stringify(o))}),$("#luckysheet-copy-antidiagonal").click(function(l){if($("body .luckysheet-cols-menu").hide(),f(),r.luckysheet_select_save.length>1)return void(g()?alert(t.noMulti):s.info(t.noMulti,""));if(null!=r.config.merge){let e=!1;for(let t=0;t<r.luckysheet_select_save.length;t++){let l=r.luckysheet_select_save[t].row[0],n=r.luckysheet_select_save[t].row[1],o=r.luckysheet_select_save[t].column[0],s=r.luckysheet_select_save[t].column[1];if(e=y(r.config,l,n,o,s))break}if(e)return void(g()?alert(t.noPartMerge):s.info(t.noPartMerge,""))}let n=v(r.luckysheet_select_save[0]),o=[];if(0==n.length)return;let u=n[0].length;for(let e=0;e<n.length&&!(e>=u);e++)o.push(n[e][u-e-1]);e.copybyformat(l,JSON.stringify(o))}),$("#luckysheet-copy-diagonaloffset").click(function(l){if("INPUT"===l.target.nodeName)return;if($("body .luckysheet-cols-menu").hide(),f(),r.luckysheet_select_save.length>1)return void(g()?alert(t.noMulti):s.info(t.noMulti,""));if(null!=r.config.merge){let e=!1;for(let t=0;t<r.luckysheet_select_save.length;t++){let l=r.luckysheet_select_save[t].row[0],n=r.luckysheet_select_save[t].row[1],o=r.luckysheet_select_save[t].column[0],s=r.luckysheet_select_save[t].column[1];if(e=y(r.config,l,n,o,s))break}if(e)return void(g()?alert(t.noPartMerge):s.info(t.noPartMerge,""))}let n=v(r.luckysheet_select_save[0]),o=[];if(0==n.length)return;let u=n[0].length,c=parseInt($("#luckysheet-copy-diagonaloffset-value").val());if("NaN"!=c.toString())if(c<0)g()?alert(t.offsetColumnLessZero):s.info(t.offsetColumnLessZero,"");else{null==c&&(c=1);for(let e=0;e<n.length&&!(e+c>=u);e++)o.push(n[e][e+c]);e.copybyformat(l,JSON.stringify(o))}else g()?alert(t.inputCorrect):s.info(t.inputCorrect,"")}),$("#luckysheet-copy-boolvalue").click(function(l){if($("body .luckysheet-cols-menu").hide(),f(),r.luckysheet_select_save.length>1)return void(g()?alert(t.noMulti):s.info(t.noMulti,""));if(null!=r.config.merge){let e=!1;for(let t=0;t<r.luckysheet_select_save.length;t++){let l=r.luckysheet_select_save[t].row[0],n=r.luckysheet_select_save[t].row[1],o=r.luckysheet_select_save[t].column[0],s=r.luckysheet_select_save[t].column[1];if(e=y(r.config,l,n,o,s))break}if(e)return void(g()?alert(t.noPartMerge):s.info(t.noPartMerge,""))}let n=v(r.luckysheet_select_save[0]),o=[];if(0!=n.length){for(let e=0;e<n.length;e++){let t=[];for(let l=0;l<n[0].length;l++){let o,s=!1;s=null!=(o="object"==i(n[e][l])?n[e][l].v:n[e][l])&&""!=o&&(null==(o=parseInt(o))||o>0),t.push(s)}o.push(t)}e.copybyformat(l,JSON.stringify(o))}}),$("#luckysheet-matrix-turn-up").click(function(e){if($("body .luckysheet-cols-menu").hide(),f(),r.luckysheet_select_save.length>1)return void(g()?alert(t.noMulti):s.info(t.noMulti,""));let l=v(r.luckysheet_select_save[0]);if(0==l.length)return;let n=[];for(let e=l.length-1;e>=0;e--){let t=[];for(let n=0;n<l[0].length;n++){let o="";null!=l[e]&&null!=l[e][n]&&(o=l[e][n]),t.push(o)}n.push(t)}u.controlHandler(n)}),$("#luckysheet-matrix-turn-left").click(function(e){if($("body .luckysheet-cols-menu").hide(),f(),r.luckysheet_select_save.length>1)return void(g()?alert(t.noMulti):s.info(t.noMulti,""));let l=v(r.luckysheet_select_save[0]);if(0==l.length)return;let n=[];for(let e=0;e<l.length;e++){let t=[];for(let n=l[0].length-1;n>=0;n--){let o="";null!=l[e]&&null!=l[e][n]&&(o=l[e][n]),t.push(o)}n.push(t)}u.controlHandler(n)}),$("#luckysheet-matrix-turn-cw").click(function(e){if($("body .luckysheet-cols-menu").hide(),f(),r.luckysheet_select_save.length>1)return void(g()?alert(t.noMulti):s.info(t.noMulti,""));let l=v(r.luckysheet_select_save[0]);if(0==l.length)return;let n=[];for(let e=0;e<l[0].length;e++){let t=[];for(let n=l.length-1;n>=0;n--){let o="";null!=l[n]&&null!=l[n][e]&&(o=l[n][e]),t.push(o)}n.push(t)}u.controlHandlerD(n)}),$("#luckysheet-matrix-turn-anticw").click(function(e){if($("body .luckysheet-cols-menu").hide(),f(),r.luckysheet_select_save.length>1)return void(g()?alert(t.noMulti):s.info(t.noMulti,""));let l=v(r.luckysheet_select_save[0]);if(0==l.length)return;let n=[];for(let e=l[0].length-1;e>=0;e--){let t=[];for(let n=0;n<l.length;n++){let o="";null!=l[n]&&null!=l[n][e]&&(o=l[n][e]),t.push(o)}n.push(t)}u.controlHandlerD(n)}),$("#luckysheet-matrix-turn-trans").click(function(e){if($("body .luckysheet-cols-menu").hide(),f(),r.luckysheet_select_save.length>1)return void(g()?alert(t.noMulti):s.info(t.noMulti,""));let l=v(r.luckysheet_select_save[0]);if(0==l.length)return;let n=[];for(let e=0;e<l[0].length;e++){let t=[];for(let n=0;n<l.length;n++){let o="";null!=l[n]&&null!=l[n][e]&&(o=l[n][e]),t.push(o)}n.push(t)}u.controlHandlerD(n)});let l=function(e,t){if(0==e)return 0;let l,n;for(n=(t-1)*(l=e)/t+e/(Math.pow(l,t-1)*t);Math.abs(n-l)>1e-6;)n=(t-1)*(l=n)/t+e/(Math.pow(l,t-1)*t);return n};$("#luckysheet-matrix-cal-confirm").click(function(e){if("INPUT"===e.target.nodeName||"SELECT"===e.target.nodeName)return;if($("body .luckysheet-cols-menu").hide(),f(),r.luckysheet_select_save.length>1)return void(g()?alert(t.noMulti):s.info(t.noMulti,""));let n=v(r.luckysheet_select_save[0]);if(0==n.length)return;let o=$("#luckysheet-matrix-cal-type").val(),c=parseInt($("#luckysheet-matrix-cal-value").val());if("NaN"==c.toString())return void(g()?alert(t.inputCorrect):s.info(t.inputCorrect,""));null==c&&(c=2);let i=[];for(let e=0;e<n.length;e++){let t=[];for(let s=0;s<n[0].length;s++){let u="";null!=n[e]&&null!=n[e][s]&&(u=n[e][s],null!=parseInt(u)&&void 0!=n[e][s].ct&&"n"==n[e][s].ct.t&&("minus"==o?u.v=u.v-c:"multiply"==o?u.v=u.v*c:"divided"==o?u.v=a(u.v/c,4):"power"==o?u.v=Math.pow(u.v,c):"root"==o?2==c?u.v=a(Math.sqrt(u.v),4):3==c&&Math.cbrt?u.v=a(Math.cbrt(u.v),4):u.v=a(l(u.v,c),4):u.v="log"==o?a(1e4*Math.log(u.v)/Math.log(Math.abs(c)),4):u.v+c,null==u.v?u.m="":u.m=u.v.toString())),t.push(u)}i.push(t)}u.controlHandler(i)}),$("#luckysheet-matrix-delezero-row").click(function(e){if($("body .luckysheet-cols-menu").hide(),f(),r.luckysheet_select_save.length>1)return void(g()?alert(t.noMulti):s.info(t.noMulti,""));let l=v(r.luckysheet_select_save[0]);if(0==l.length)return;let n=[],o=l[0].length;for(let e=0;e<l.length;e++){let t=[],s=!0,u=!0;for(let n=0;n<o;n++){let o="";if(null!=l[e]&&null!=l[e][n]){if(("0"==(o=l[e][n]).v||0==o.v)&&s)continue;s=!1}t.push(o)}let c=[];if(t.length==o)c=t;else{for(let e=t.length-1;e>=0;e--){let l="";if(null!=t[e]){if(("0"==(l=t[e]).v||0==l.v)&&u)continue;u=!1}c.unshift(l)}let e=o-c.length;for(let t=0;t<e;t++)c.push("")}n.push(c)}u.controlHandler(n)}),$("#luckysheet-matrix-delezero-column").click(function(e){if($("body .luckysheet-cols-menu").hide(),f(),r.luckysheet_select_save.length>1)return void(g()?alert(t.noMulti):s.info(t.noMulti,""));let l=v(r.luckysheet_select_save[0]);if(0==l.length)return;let n=[],o=l.length,c=l[0].length;for(let e=0;e<c;e++){let t=[],s=!0,u=!0;for(let n=0;n<o;n++){let o="";if(null!=l[n]&&null!=l[n][e]){if(("0"==(o=l[n][e]).v||0==o.v)&&s)continue;s=!1}t.push(o)}let c=[];if(t.length==o)c=t;else{for(let e=t.length-1;e>=0;e--){let l="";if(null!=t[e]){if(("0"==(l=t[e]).v||0==l.v)&&u)continue;u=!1}c.unshift(l)}let e=o-c.length;for(let t=0;t<e;t++)c.push("")}n.push(c)}let i=[];for(let e=0;e<n[0].length;e++){let t=[];for(let l=0;l<n.length;l++){let o="";null!=n[l]&&null!=n[l][e]&&(o=n[l][e]),t.push(o)}i.push(t)}u.controlHandler(i)}),$("#luckysheet-matrix-delerpt-row").click(function(e){if($("body .luckysheet-cols-menu").hide(),f(),r.luckysheet_select_save.length>1)return void(g()?alert(t.noMulti):s.info(t.noMulti,""));let l=v(r.luckysheet_select_save[0]);if(0==l.length)return;let n=[],o=l[0].length;for(let e=0;e<l.length;e++){let t=[],s={};for(let t=0;t<o;t++){let n=null;null!=l[e]&&null!=l[e][t]&&((n=l[e][t]).v in s?s[n.v].push(n):(s[n.v]=[],s[n.v].push(n)))}for(let n=0;n<o;n++){let o=null;null!=l[e]&&null!=l[e][n]&&1==s[(o=l[e][n]).v].length&&t.push(o)}let u=o-t.length;for(let e=0;e<u;e++)t.push(null);n.push(t)}u.controlHandler(n)}),$("#luckysheet-matrix-delerpt-column").click(function(e){if($("body .luckysheet-cols-menu").hide(),f(),r.luckysheet_select_save.length>1)return void(g()?alert(t.noMulti):s.info(t.noMulti,""));let l=v(r.luckysheet_select_save[0]);if(0==l.length)return;let n=[],o=l.length,c=l[0].length;for(let e=0;e<c;e++){let t=[],s={};for(let t=0;t<o;t++){let n=null;null!=l[t]&&null!=l[t][e]&&((n=l[t][e]).v in s?s[n.v].push(n):(s[n.v]=[],s[n.v].push(n)))}for(let n=0;n<o;n++){let o=null;null!=l[n]&&null!=l[n][e]&&1==s[(o=l[n][e]).v].length&&t.push(o)}a1=t;let u=o-a1.length;for(let e=0;e<u;e++)a1.push(null);n.push(a1)}let i=[];for(let e=0;e<n[0].length;e++){let t=[];for(let l=0;l<n.length;l++){let o=null;null!=n[l]&&null!=n[l][e]&&(o=n[l][e]),t.push(o)}i.push(t)}u.controlHandler(i)})}}});
//# sourceMappingURL=../sourcemaps/controllers/matrixOperation.js.map
