/**
 * skylark-lucksheet - A version of lucksheet.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["./updateCell","../widgets/constant","./sheetMove","../widgets/insertFormula","../methods/location","../methods/luckysheetConfigsetting","./formula","../widgets/tooltip","../locale/locale","../store"],function(e,t,l,s,c,a,i,o,u,n){"use strict";const{luckysheetupdateCell:r}=e,{keycode:h}=t,{luckysheetMoveHighlightCell:f}=l,{rowLocation:y,colLocation:k,mouseposition:m}=c,{isEditMode:d}=a;return{formulaBarInitial:function(){const e=u().formula;$("#luckysheet-functionbox-cell").focus(function(){if(!d()&&n.luckysheet_select_save.length>0){let e=n.luckysheet_select_save[n.luckysheet_select_save.length-1],t=e.row_focus,l=e.column_focus;r(t,l,n.flowdata,null,!0),i.rangeResizeTo=$("#luckysheet-functionbox-cell")}}).keydown(function(e){if(d())return;e.ctrlKey,e.altKey,e.shiftKey;let t=e.keyCode,l=$("#luckysheet-input-box");if(t==h.ENTER&&parseInt(l.css("top"))>0)$("#luckysheet-formula-search-c").is(":visible")&&null!=i.searchFunctionCell?i.searchFunctionEnter($("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item-active")):(i.updatecell(n.luckysheetCellUpdate[0],n.luckysheetCellUpdate[1]),n.luckysheet_select_save=[{row:[n.luckysheetCellUpdate[0],n.luckysheetCellUpdate[0]],column:[n.luckysheetCellUpdate[1],n.luckysheetCellUpdate[1]],row_focus:n.luckysheetCellUpdate[0],column_focus:n.luckysheetCellUpdate[1]}],f("down",1,"rangeOfSelect"),$("#luckysheet-rich-text-editor").focus()),e.preventDefault();else if(t==h.ESC&&parseInt(l.css("top"))>0)i.dontupdate(),f("down",0,"rangeOfSelect"),$("#luckysheet-rich-text-editor").focus(),e.preventDefault();else if(t==h.F4&&parseInt(l.css("top"))>0)i.setfreezonFuc(e),e.preventDefault();else if(t==h.UP&&parseInt(l.css("top"))>0){if($("#luckysheet-formula-search-c").is(":visible")){let t=$("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item-active").prev();0==t.length&&(t=$("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item").last()),$("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item").removeClass("luckysheet-formula-search-item-active"),t.addClass("luckysheet-formula-search-item-active"),e.preventDefault()}}else if(t==h.DOWN&&parseInt(l.css("top"))>0){if($("#luckysheet-formula-search-c").is(":visible")){let t=$("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item-active").next();0==t.length&&(t=$("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item").first()),$("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item").removeClass("luckysheet-formula-search-item-active"),t.addClass("luckysheet-formula-search-item-active"),e.preventDefault()}}else t==h.LEFT&&parseInt(l.css("top"))>0?i.rangeHightlightselected($("#luckysheet-functionbox-cell")):t==h.RIGHT&&parseInt(l.css("top"))>0?i.rangeHightlightselected($("#luckysheet-functionbox-cell")):(!(t>=112&&t<=123||t<=46||144==t||108==t||e.ctrlKey||e.altKey||e.shiftKey&&(37==t||38==t||39==t||40==t))||8==t||32==t||46==t||e.ctrlKey&&86==t)&&i.functionInputHanddler($("#luckysheet-rich-text-editor"),$("#luckysheet-functionbox-cell"),t)}).click(function(){d()||i.rangeHightlightselected($("#luckysheet-functionbox-cell"))}),$("#luckysheet-wa-functionbox-cancel").click(function(){$(this).hasClass("luckysheet-wa-calculate-active")&&($("#luckysheet-search-formula-parm").is(":visible")&&$("#luckysheet-search-formula-parm").hide(),$("#luckysheet-search-formula-parm-select").is(":visible")&&$("#luckysheet-search-formula-parm-select").hide(),i.dontupdate(),f("down",0,"rangeOfSelect"))}),$("#luckysheet-wa-functionbox-confirm").click(function(){$(this).hasClass("luckysheet-wa-calculate-active")&&($("#luckysheet-search-formula-parm").is(":visible")&&$("#luckysheet-search-formula-parm").hide(),$("#luckysheet-search-formula-parm-select").is(":visible")&&$("#luckysheet-search-formula-parm-select").hide(),i.updatecell(n.luckysheetCellUpdate[0],n.luckysheetCellUpdate[1]),f("down",0,"rangeOfSelect"))}),$("#luckysheet-wa-functionbox-fx").click(function(){if(0==n.luckysheet_select_save.length)return void(d()?alert(e.tipSelectCell):o.info(e.tipSelectCell,""));let t=n.luckysheet_select_save[n.luckysheet_select_save.length-1],l=t.row_focus,c=t.column_focus;r(l,c,n.flowdata);let a=n.flowdata[l][c];if(null!=a&&null!=a.f){let e=i.getfunctionParam(a.f);null!=e.fn?s.formulaParmDialog(e.fn,e.param):s.formulaListDialog()}else $("#luckysheet-rich-text-editor").html('<span dir="auto" class="luckysheet-formula-text-color">=</span>'),$("#luckysheet-functionbox-cell").html($("#luckysheet-rich-text-editor").html()),s.formulaListDialog();s.init()}),$("#luckysheet-formula-functionrange").on("mousedown",".luckysheet-copy",function(e){i.rangeMove=!0,n.luckysheet_scroll_status=!0,i.rangeMoveObj=$(this).parent(),i.rangeMoveIndex=$(this).parent().attr("rangeindex");let t=m(e.pageX,e.pageY),l=t[0]+$("#luckysheet-cell-main").scrollLeft(),s=t[1]+$("#luckysheet-cell-main").scrollTop();$("#luckysheet-formula-functionrange-highlight-"+i.rangeMoveIndex).find(".luckysheet-selection-copy-hc").css("opacity",.13);let c=$(this).data("type");"top"==c?s+=3:"right"==c?l-=3:"bottom"==c?s-=3:"left"==c&&(l+=3);let a=y(s)[2],o=k(l)[2];i.rangeMovexy=[a,o],$("#luckysheet-sheettable").css("cursor","move"),e.stopPropagation()}),$("#luckysheet-formula-functionrange").on("mousedown",".luckysheet-highlight",function(e){i.rangeResize=$(this).data("type"),i.rangeResizeIndex=$(this).parent().attr("rangeindex");let t=m(e.pageX,e.pageY),l=$("#luckysheet-cell-main").scrollLeft(),s=$("#luckysheet-cell-main").scrollTop(),c=t[0]+l,a=t[1]+s;i.rangeResizeObj=$(this).parent(),$("#luckysheet-formula-functionrange-highlight-"+i.rangeResizeIndex).find(".luckysheet-selection-copy-hc").css("opacity",.13),"lt"==i.rangeResize?(c+=3,a+=3):"lb"==i.rangeResize?(c+=3,a-=3):"rt"==i.rangeResize?(c-=3,a+=3):"rb"==i.rangeResize&&(c-=3,a-=3);let o=y(a),u=o[1],r=o[0],h=(o[2],k(c)),f=h[1],d=h[0],p=(h[2],i.rangeResizeObj.position());i.rangeResizexy=[d,r,i.rangeResizeObj.width(),i.rangeResizeObj.height(),p.left+l,p.top+s,f,u],i.rangeResizeWinH=$("#luckysheet-cell-main")[0].scrollHeight,i.rangeResizeWinW=$("#luckysheet-cell-main")[0].scrollWidth,n.luckysheet_scroll_status=!0,e.stopPropagation()})}}});
//# sourceMappingURL=../sourcemaps/controllers/formulaBar.js.map
