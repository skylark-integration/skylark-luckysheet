/**
 * skylark-lucksheet - A version of lucksheet.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["./menuButton","./updateCell","./constant","./sheetMove","./insertFormula","../global/location","../global/validate","../global/formula","../global/tooltip","../locale/locale","../store"],function(e,t,l,c,s,a,o,u,i,n,r){"use strict";const{luckysheetupdateCell:h}=t,{keycode:f}=l,{luckysheetMoveHighlightCell:y}=c,{rowLocation:k,colLocation:m,mouseposition:p}=a,{isEditMode:d}=o;return{formulaBarInitial:function(){const e=n().formula;$("#luckysheet-functionbox-cell").focus(function(){if(!d()&&r.luckysheet_select_save.length>0){let e=r.luckysheet_select_save[r.luckysheet_select_save.length-1],t=e.row_focus,l=e.column_focus;h(t,l,r.flowdata,null,!0),u.rangeResizeTo=$("#luckysheet-functionbox-cell")}}).keydown(function(e){if(d())return;e.ctrlKey,e.altKey,e.shiftKey;let t=e.keyCode,l=$("#luckysheet-input-box");if(t==f.ENTER&&parseInt(l.css("top"))>0)$("#luckysheet-formula-search-c").is(":visible")&&null!=u.searchFunctionCell?u.searchFunctionEnter($("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item-active")):(u.updatecell(r.luckysheetCellUpdate[0],r.luckysheetCellUpdate[1]),r.luckysheet_select_save=[{row:[r.luckysheetCellUpdate[0],r.luckysheetCellUpdate[0]],column:[r.luckysheetCellUpdate[1],r.luckysheetCellUpdate[1]],row_focus:r.luckysheetCellUpdate[0],column_focus:r.luckysheetCellUpdate[1]}],y("down",1,"rangeOfSelect"),$("#luckysheet-rich-text-editor").focus()),e.preventDefault();else if(t==f.ESC&&parseInt(l.css("top"))>0)u.dontupdate(),y("down",0,"rangeOfSelect"),$("#luckysheet-rich-text-editor").focus(),e.preventDefault();else if(t==f.F4&&parseInt(l.css("top"))>0)u.setfreezonFuc(e),e.preventDefault();else if(t==f.UP&&parseInt(l.css("top"))>0){if($("#luckysheet-formula-search-c").is(":visible")){let t=$("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item-active").prev();0==t.length&&(t=$("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item").last()),$("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item").removeClass("luckysheet-formula-search-item-active"),t.addClass("luckysheet-formula-search-item-active"),e.preventDefault()}}else if(t==f.DOWN&&parseInt(l.css("top"))>0){if($("#luckysheet-formula-search-c").is(":visible")){let t=$("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item-active").next();0==t.length&&(t=$("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item").first()),$("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item").removeClass("luckysheet-formula-search-item-active"),t.addClass("luckysheet-formula-search-item-active"),e.preventDefault()}}else t==f.LEFT&&parseInt(l.css("top"))>0?u.rangeHightlightselected($("#luckysheet-functionbox-cell")):t==f.RIGHT&&parseInt(l.css("top"))>0?u.rangeHightlightselected($("#luckysheet-functionbox-cell")):(!(t>=112&&t<=123||t<=46||144==t||108==t||e.ctrlKey||e.altKey||e.shiftKey&&(37==t||38==t||39==t||40==t))||8==t||32==t||46==t||e.ctrlKey&&86==t)&&u.functionInputHanddler($("#luckysheet-rich-text-editor"),$("#luckysheet-functionbox-cell"),t)}).click(function(){d()||u.rangeHightlightselected($("#luckysheet-functionbox-cell"))}),$("#luckysheet-wa-functionbox-cancel").click(function(){$(this).hasClass("luckysheet-wa-calculate-active")&&($("#luckysheet-search-formula-parm").is(":visible")&&$("#luckysheet-search-formula-parm").hide(),$("#luckysheet-search-formula-parm-select").is(":visible")&&$("#luckysheet-search-formula-parm-select").hide(),u.dontupdate(),y("down",0,"rangeOfSelect"))}),$("#luckysheet-wa-functionbox-confirm").click(function(){$(this).hasClass("luckysheet-wa-calculate-active")&&($("#luckysheet-search-formula-parm").is(":visible")&&$("#luckysheet-search-formula-parm").hide(),$("#luckysheet-search-formula-parm-select").is(":visible")&&$("#luckysheet-search-formula-parm-select").hide(),u.updatecell(r.luckysheetCellUpdate[0],r.luckysheetCellUpdate[1]),y("down",0,"rangeOfSelect"))}),$("#luckysheet-wa-functionbox-fx").click(function(){if(0==r.luckysheet_select_save.length)return void(d()?alert(e.tipSelectCell):i.info(e.tipSelectCell,""));let t=r.luckysheet_select_save[r.luckysheet_select_save.length-1],l=t.row_focus,c=t.column_focus;h(l,c,r.flowdata);let a=r.flowdata[l][c];if(null!=a&&null!=a.f){let e=u.getfunctionParam(a.f);null!=e.fn?s.formulaParmDialog(e.fn,e.param):s.formulaListDialog()}else $("#luckysheet-rich-text-editor").html('<span dir="auto" class="luckysheet-formula-text-color">=</span>'),$("#luckysheet-functionbox-cell").html($("#luckysheet-rich-text-editor").html()),s.formulaListDialog();s.init()}),$("#luckysheet-formula-functionrange").on("mousedown",".luckysheet-copy",function(e){u.rangeMove=!0,r.luckysheet_scroll_status=!0,u.rangeMoveObj=$(this).parent(),u.rangeMoveIndex=$(this).parent().attr("rangeindex");let t=p(e.pageX,e.pageY),l=t[0]+$("#luckysheet-cell-main").scrollLeft(),c=t[1]+$("#luckysheet-cell-main").scrollTop();$("#luckysheet-formula-functionrange-highlight-"+u.rangeMoveIndex).find(".luckysheet-selection-copy-hc").css("opacity",.13);let s=$(this).data("type");"top"==s?c+=3:"right"==s?l-=3:"bottom"==s?c-=3:"left"==s&&(l+=3);let a=k(c)[2],o=m(l)[2];u.rangeMovexy=[a,o],$("#luckysheet-sheettable").css("cursor","move"),e.stopPropagation()}),$("#luckysheet-formula-functionrange").on("mousedown",".luckysheet-highlight",function(e){u.rangeResize=$(this).data("type"),u.rangeResizeIndex=$(this).parent().attr("rangeindex");let t=p(e.pageX,e.pageY),l=$("#luckysheet-cell-main").scrollLeft(),c=$("#luckysheet-cell-main").scrollTop(),s=t[0]+l,a=t[1]+c;u.rangeResizeObj=$(this).parent(),$("#luckysheet-formula-functionrange-highlight-"+u.rangeResizeIndex).find(".luckysheet-selection-copy-hc").css("opacity",.13),"lt"==u.rangeResize?(s+=3,a+=3):"lb"==u.rangeResize?(s+=3,a-=3):"rt"==u.rangeResize?(s-=3,a+=3):"rb"==u.rangeResize&&(s-=3,a-=3);let o=k(a),i=o[1],n=o[0],h=(o[2],m(s)),f=h[1],y=h[0],d=(h[2],u.rangeResizeObj.position());u.rangeResizexy=[y,n,u.rangeResizeObj.width(),u.rangeResizeObj.height(),d.left+l,d.top+c,f,i],u.rangeResizeWinH=$("#luckysheet-cell-main")[0].scrollHeight,u.rangeResizeWinW=$("#luckysheet-cell-main")[0].scrollWidth,r.luckysheet_scroll_status=!0,e.stopPropagation()})}}});
//# sourceMappingURL=../sourcemaps/controllers/formulaBar.js.map
