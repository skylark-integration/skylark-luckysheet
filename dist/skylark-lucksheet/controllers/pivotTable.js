/**
 * skylark-lucksheet - A version of lucksheet.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["../methods/get","../utils/util","../methods/getdata","../methods/datecontroll","../methods/format","../methods/validate","../methods/pivotTable_methods","../methods/sort_methods","../widgets/tooltip","../widgets/cleargridelement","../methods/array","../methods/analysis","../widgets/select","../methods/luckysheetConfigsetting","../methods/sheetSearch","../widgets/constant","../methods/sheets","../widgets/resize","../methods/protection_methods","../store","../locale/locale","../vendors/numeral"],function(e,t,l,i,a,o,s,c,n,d,u,r,h,v,p,m,y,f,k,g,b,x){"use strict";const{getSheetIndex:T,getRangetxt:w}=e,{replaceHtml:F,getObjType:B,ABCatNum:S,numFormat:D,numfloatlen:P,showrightclickmenu:C,mouseclickposition:_}=t,{getdatabyselectionD:j,getcellvalue:I,datagridgrowth:N}=l,{isdatetime:L,diff:A,isdatatypemulti:M,isdatatype:q}=i,{genarate:O,update:R}=a,{isRealNull:Y}=o,H=v.isEditMode,{orderbydata1D:U}=c,{selectHightlightShow:J}=h,{luckysheet_searcharray:z}=p,{modelHTML:G,filtermenuHTML:W,filtersubmenuHTML:E,pivottableconfigHTML:X,pivottablesumHTML:Z,luckysheetPivotTableHTML:K}=m,{checkProtectionAuthorityNormal:Q}=k;return Object.assign(s,{showvaluecolrow:function(){let e=this;$("#luckysheet-modal-dialog-config-value .luckysheet-modal-dialog-slider-config-item").length>=2?($("#luckysheetpivottablevaluecolrowshow").show(),"column"==e.showType?($("#luckysheetpivottablevaluecolrow").prop("checked",!0),$("#luckysheetpivottablevaluecolrowshow label[for='luckysheetpivottablevaluecolrow']").addClass("ui-state-active"),$("#luckysheetpivottablevaluecolrow1").prop("checked",!1),$("#luckysheetpivottablevaluecolrowshow label[for='luckysheetpivottablevaluecolrow1']").removeClass("ui-state-active")):($("#luckysheetpivottablevaluecolrow1").prop("checked",!0),$("#luckysheetpivottablevaluecolrowshow label[for='luckysheetpivottablevaluecolrow1']").addClass("ui-state-active"),$("#luckysheetpivottablevaluecolrow").prop("checked",!1),$("#luckysheetpivottablevaluecolrowshow label[for='luckysheetpivottablevaluecolrow']").removeClass("ui-state-active"))):$("#luckysheetpivottablevaluecolrowshow").hide()},resetOrderby:function(e){let t=$("#luckysheet-modal-dialog-config-value .luckysheet-modal-dialog-slider-config-item").index(e);$("#luckysheet-modal-dialog-config-row, #luckysheet-modal-dialog-config-column").find(".luckysheet-modal-dialog-slider-config-item").each(function(){$(this).data("orderby")==t&&$(this).data("orderby","self")})},luckysheetsliderlistclearfilter:function(e){let t=e.parent(),l=t.data("index"),i={},a=this.origindata;t.data("rowhidden","").find(".luckysheet-slider-list-item-filtered").hide(),this.setDatatojsfile("selected",{},l),this.setDatatojsfile("rowhidden",null,l);let o=[];for(let e=0;e<a.length;e++)null==i[e]&&o.push([].concat(a[e]));this.celldata=o,this.refreshPivotTable(),$("#luckysheet-pivotTableFilter-menu, #luckysheet-pivotTableFilter-submenu").hide()},luckysheetsliderlistitemfilter:function(e){const t=b().filter;let l=e.parent(),i=l.offset(),a=$("#luckysheet-pivotTableFilter-menu"),o=$(window).height(),s=($(window).width(),l.data("index")),c=l.data("rowhidden");null==c||""==c?c={}:"string"==B(c)&&(c=JSON.parse(c)),$("body .luckysheet-cols-menu").hide(),$("#luckysheet-pivotTableFilter-menu, #luckysheet-pivotTableFilter-submenu").hide(),$("#luckysheet-pivotTableFilter-byvalue-input").val(""),$("#luckysheet-pivotTableFilter-bycondition").next().hide(),$("#luckysheet-pivotTableFilter-byvalue").next().show(),a.data("index",s),$("#luckysheet-pivotTableFilter-menu .luckysheet-pivotTableFilter-selected-input").hide().find("input").val(),$("#luckysheet-pivotTableFilter-selected span").data("type","0").data("type",null).text(t.filiterInputNone);let n=l.data("byconditiontype");if($("#luckysheet-pivotTableFilter-selected span").data("value",l.data("byconditionvalue")).data("type",n).text(l.data("byconditiontext")),"2"==n){let e=$("#luckysheet-pivotTableFilter-menu .luckysheet-pivotTableFilter-selected-input2").show().find("input");e.eq(0).val(l.data("byconditionvalue1")),e.eq(1).val(l.data("byconditionvalue2"))}else"1"==n&&$("#luckysheet-pivotTableFilter-menu .luckysheet-pivotTableFilter-selected-input").eq(0).show().find("input").val(l.data("byconditionvalue1"));$("#luckysheet-pivotTableFilter-byvalue-select").empty().html('<div style="width:100%;text-align:center;position:relative;top:45%;font-size: 14px;"> <div class="luckysheetLoaderGif"> </div> <span>'+t.filiterMoreDataTip+"</span></div>");let d={};$("#luckysheet-modal-dialog-pivotTable-list .luckysheet-modal-dialog-slider-list-item").not(l.get(0)).each(function(){let e=$(this).data("rowhidden");if(null==e||""==e)return!0;"string"==B(e)&&(e=JSON.parse(e));for(let t in e)d[t]=0});let u=this.origindata;setTimeout(function(){let e={},l={},a={},n={};for(let t=1;t<u.length;t++){if(t in d)continue;if(null==u[t])continue;let i=u[t][s];if(null!=i&&null!=i.ct&&"d"==i.ct.t){let a=R("YYYY-MM-DD",i.v),o=a.split("-")[0],s=a.split("-")[1],n=a.split("-")[2];o in e||(e[o]={}),s in e[o]||(e[o][s]={}),n in e[o][s]||(e[o][s][n]=0),e[o][s][n]++,t in c&&(l[o]=0,l[s]=0,l[n]=0)}else{let e,l;null==i||Y(i.v)?(e=null,l=null):(e=i.v,l=i.m),e in a||(a[e]={}),l in a[e]||(a[e][l]=0),a[e][l]++,t in c&&(n[e+"#$$$#"+l]=0)}}let r=[];if(JSON.stringify(e).length>2)for(let i in e){let a,o=0,s="";for(let a in e[i]){let c,n=0,d="";for(let t in e[i][a]){let o,s,c=e[i][a][t];n+=c,o=Number(a)<10?"0"+Number(a):a,s=Number(t)<10?"0"+Number(t):t,d+=i in l&&a in l&&t in l?'<div class="day luckysheet-mousedown-cancel cf" data-check="false" title="'+i+"-"+o+"-"+s+'"><input class="luckysheet-mousedown-cancel" type="checkbox"/><label class="luckysheet-mousedown-cancel">'+t+'</label><span class="count luckysheet-mousedown-cancel">( '+c+" )</span></div>":'<div class="day luckysheet-mousedown-cancel cf" data-check="true" title="'+i+"-"+o+"-"+s+'"><input class="luckysheet-mousedown-cancel" type="checkbox" checked="checked"/><label class="luckysheet-mousedown-cancel">'+t+'</label><span class="count luckysheet-mousedown-cancel">( '+c+" )</span></div>"}o+=n,c=Number(a)<10?"0"+Number(a):a,s+=i in l&&a in l?'<div class="monthBox luckysheet-mousedown-cancel"><div class="month luckysheet-mousedown-cancel cf" data-check="false" title="'+i+"-"+c+'"><i class="fa fa-caret-right luckysheet-mousedown-cancel" aria-hidden="true"></i><input class="luckysheet-mousedown-cancel" type="checkbox"/><label class="luckysheet-mousedown-cancel">'+a+t.filiterMonthText+'</label><span class="count luckysheet-mousedown-cancel">( '+n+' )</span></div><div class="dayList luckysheet-mousedown-cancel">'+d+"</div></div>":'<div class="monthBox luckysheet-mousedown-cancel"><div class="month luckysheet-mousedown-cancel cf" data-check="true" title="'+i+"-"+c+'"><i class="fa fa-caret-right luckysheet-mousedown-cancel" aria-hidden="true"></i><input class="luckysheet-mousedown-cancel" type="checkbox" checked="checked"/><label class="luckysheet-mousedown-cancel">'+a+t.filiterMonthText+'</label><span class="count luckysheet-mousedown-cancel">( '+n+' )</span></div><div class="dayList luckysheet-mousedown-cancel">'+d+"</div></div>"}a=i in l?'<div class="yearBox luckysheet-mousedown-cancel"><div class="year luckysheet-mousedown-cancel cf" data-check="false" title="'+i+'"><i class="fa fa-caret-right luckysheet-mousedown-cancel" aria-hidden="true"></i><input class="luckysheet-mousedown-cancel" type="checkbox"/><label class="luckysheet-mousedown-cancel">'+i+t.filiterYearText+'</label><span class="count luckysheet-mousedown-cancel">( '+o+' )</span></div><div class="monthList luckysheet-mousedown-cancel">'+s+"</div></div>":'<div class="yearBox luckysheet-mousedown-cancel"><div class="year luckysheet-mousedown-cancel cf" data-check="true" title="'+i+'"><i class="fa fa-caret-right luckysheet-mousedown-cancel" aria-hidden="true"></i><input class="luckysheet-mousedown-cancel" type="checkbox" checked="checked"/><label class="luckysheet-mousedown-cancel">'+i+t.filiterYearText+'</label><span class="count luckysheet-mousedown-cancel">( '+o+' )</span></div><div class="monthList luckysheet-mousedown-cancel">'+s+"</div></div>",r.unshift(a)}if(JSON.stringify(a).length>2){let e=Object.keys(a);e=U(e,!0);for(let l=0;l<e.length;l++){let i=e[l];for(let e in a[i]){let l,o;l=i+"#$$$#"+e=="null#$$$#null"?t.valueBlank:e,o=i+"#$$$#"+e in n?'<div class="textBox luckysheet-mousedown-cancel cf" data-check="false" data-filter="'+i+"#$$$#"+e+'" title="'+e+'"><input class="luckysheet-mousedown-cancel" type="checkbox"/><label class="luckysheet-mousedown-cancel">'+l+'</label><span class="luckysheet-mousedown-cancel count">( '+a[i][e]+" )</span></div>":'<div class="textBox luckysheet-mousedown-cancel cf" data-check="true" data-filter="'+i+"#$$$#"+e+'" title="'+e+'"><input class="luckysheet-mousedown-cancel" type="checkbox" checked="checked"/><label class="luckysheet-mousedown-cancel">'+l+'</label><span class="luckysheet-mousedown-cancel count">( '+a[i][e]+" )</span></div>",r.push(o)}}}$("#luckysheet-pivotTableFilter-byvalue-select").html("<div class='ListBox luckysheet-mousedown-cancel' style='max-height:"+(o-i.top-350)+"px;overflow-y:auto;overflow-x:hidden;'>"+r.join("")+"</div>")},1),C(a,i.left-250,i.top)},createPivotTable:function(e){if(H()||!1===g.allowEdit)return;let t=g.currentSheetIndex;const l=b().pivotTable;if(H())return void alert(l.errorNotAllowEdit);if(g.luckysheet_select_save.length>1)return void n.info("",l.errorNotAllowMulti);if(0==g.luckysheet_select_save.length||g.luckysheet_select_save[0].row[0]==g.luckysheet_select_save[0].row[1]||g.luckysheet_select_save[0].column[0]==g.luckysheet_select_save[0].column[1])return void n.info("",l.errorSelectRange);let i=$.extend(!0,{},g.luckysheet_select_save[0]);y.addNewSheet(e,!0),this.getCellData(g.currentSheetIndex,t,i),this.setDatatojsfile("pivot_select_save",i),this.setDatatojsfile("pivotDataSheetIndex",t),this.initialPivotManage()},changePivotTable:function(e){const t=b().pivotTable;let l=g.luckysheetfile[T(e)].pivotTable.pivotDataSheetIndex;null!=T(l)?(this.getCellData(e),this.initialPivotManage(!0),this.refreshPivotTable()):n.info(t.errorIsDamage,"")},refreshPivotTable:function(e=!0){let t=this,l={};l.pivotTable=s,l.data=g.deepCopyFlowData(g.flowdata),t.storePivotTableParam();let i=t.dataHandler(t.column,t.row,t.values,t.showType,t.celldata);t.setDatatojsfile("pivotDatas",i);let a=$.extend(!0,[],y.nulldata),o=a,c=0,n=0;if(0==i.length)t.setDatatojsfile("drawPivotTable",!0),t.setDatatojsfile("pivotTableBoundary",[12,6]);else{t.setDatatojsfile("drawPivotTable",!1),t.setDatatojsfile("pivotTableBoundary",[i.length,i[0].length]);let e=i.length,l=i[0].length;c=e-a.length,n=l-a[0].length,o=N(a,c+20,n+10,!0);for(let t=0;t<e;t++){let e=[].concat(o[t]);for(let a=0;a<l;a++){let l="";null!=i[t]&&null!=i[t][a]&&(l=I(t,a,i)),e[a]=l}o[t]=e}}l.type="pivotTable_change",l.curdata=$.extend(!0,[],o),l.sheetIndex=g.currentSheetIndex;let u=t.getPivotTableData();l.pivotTablecur=u,g.clearjfundo&&(g.jfundo.length=0,g.jfredo.push(l)),d(),g.clearjfundo=!1,c>0||n>0?g.refreshGridAll(o[0].length,o.length,o,null,g.luckysheet_select_save,"datachangeAll",void 0,void 0,e):(g.refreshGrid(o,g.luckysheet_select_save,{},null,e),J()),g.clearjfundo=!0},pivotclick:function(e,t,l){null==l&&(l=g.currentSheetIndex);let i=g.luckysheetfile[T(l)];if(!i.isPivotTable)return;let a=i.pivotTable.pivotDataSheetIndex;if(null==T(a))return;let o=$("#luckysheet-modal-dialog-slider-pivot"),s=this.isPivotRange(e,t);if(s&&o.is(":hidden")){if(!Q(l,"usePivotTablereports",!1))return;o.show(),f(),$("#luckysheet-sta-content").css("padding-right",260)}else!s&&o.is(":visible")&&(o.hide(),f(),$("#luckysheet-sta-content").css("padding-right",10))},storePivotTableParam:function(){let e=[],t=[],l=[],i=[];$("#luckysheet-modal-dialog-config-filter .luckysheet-modal-dialog-slider-config-item").each(function(){let e={};e.index=$(this).data("index"),e.name=$(this).data("name"),e.fullname=$(this).find(".luckysheet-modal-dialog-slider-config-item-txt").text(),l.push(e)}),$("#luckysheet-modal-dialog-config-row .luckysheet-modal-dialog-slider-config-item").each(function(){let e={};e.index=$(this).data("index"),e.name=$(this).data("name"),e.fullname=$(this).find(".luckysheet-modal-dialog-slider-config-item-txt").text(),e.order=$(this).data("order"),e.orderby=$(this).data("orderby"),e.stastic=$(this).data("stastic"),t.push(e)}),$("#luckysheet-modal-dialog-config-column .luckysheet-modal-dialog-slider-config-item").each(function(){let t={};t.index=$(this).data("index"),t.name=$(this).data("name"),t.fullname=$(this).find(".luckysheet-modal-dialog-slider-config-item-txt").text(),t.order=$(this).data("order"),t.orderby=$(this).data("orderby"),t.stastic=$(this).data("stastic"),e.push(t)}),$("#luckysheet-modal-dialog-config-value .luckysheet-modal-dialog-slider-config-item").each(function(){let e={};e.index=$(this).data("index"),e.name=$(this).data("name"),e.fullname=$(this).find(".luckysheet-modal-dialog-slider-config-item-txt").text(),e.sumtype=$(this).data("sumtype"),e.nameindex=$(this).data("nameindex"),i.push(e)}),this.setDatatojsfile("column",e),this.setDatatojsfile("row",t),this.setDatatojsfile("filter",l),this.setDatatojsfile("values",i);let a=$("#luckysheetpivottablevaluecolrow:checked, #luckysheetpivottablevaluecolrow1:checked").val();this.setDatatojsfile("showType","0"==a?"row":"column");let o=this.getPivotTableData();delete o.pivotDatas,g.saveParam("all",this.pivotSheetIndex,o,{k:"pivotTable"})},initialPivotManage:function(e){let t=this;const l=b(),i=l.pivotTable,a=l.button,o=l.filter;if(t.initial){t.initial=!1,$("body").append(K()),$("#luckysheet-modal-dialog-slider-close").click(function(){$("#luckysheet-modal-dialog-slider-pivot").hide(),f()}),$("body").append(F(G,{id:"luckysheet-data-pivotTable-selection",addclass:"luckysheet-data-pivotTable-selection",title:i.titleSelectionDataRange,content:'<input id="luckysheet-pivotTable-range-selection-input" class="luckysheet-datavisual-range-container" style="font-size: 14px;padding:5px;max-width:none;" spellcheck="false" aria-label="'+i.titleDataRange+'" placeholder="'+i.titleDataRange+'">',botton:'<button id="luckysheet-pivotTable-selection-confirm" class="btn btn-primary">'+a.confirm+'</button><button class="btn btn-default luckysheet-model-close-btn">'+a.cancel+"</button>"})),$("body").append(F(W(),{menuid:"pivotTableFilter"})),$("body").append(F(E(),{menuid:"pivotTableFilter"})),$("body").append(X()),$("body").append(Z()),$("#luckysheet-pivotTableFilter-orderby-asc").remove(),$("#luckysheet-pivotTableFilter-orderby-desc").next().remove(),$("#luckysheet-pivotTableFilter-orderby-desc").remove(),$("#luckysheet-pivotTableFilter-orderby-color").next().remove(),$("#luckysheet-pivotTableFilter-orderby-color").remove(),$("#luckysheetpivottablevaluecolrow, #luckysheetpivottablevaluecolrow1").checkboxradio({icon:!1}).change(function(){t.refreshPivotTable()});let e=null;$("#luckysheet-pivotTableFilter-menu").mouseover(function(){clearTimeout(e),e=setTimeout(function(){$("#luckysheet-pivotTableFilter-submenu").hide()},500)}),$(document).off("click.ptFilterCheckbox1").on("click.ptFilterCheckbox1","#luckysheet-pivotTableFilter-byvalue-select .textBox",function(){"true"==$(this).attr("data-check")?($(this).attr("data-check","false"),$(this).find("input[type='checkbox']").removeAttr("checked")):($(this).attr("data-check","true"),$(this).find("input[type='checkbox']").prop("checked",!0))}),$(document).off("click.ptFilterCheckbox2").on("click.ptFilterCheckbox2","#luckysheet-pivotTableFilter-byvalue-select .year",function(){"true"==$(this).attr("data-check")?($(this).attr("data-check","false"),$(this).parents(".yearBox").find(".month").attr("data-check","false"),$(this).parents(".yearBox").find(".day").attr("data-check","false"),$(this).parents(".yearBox").find("input[type='checkbox']").removeAttr("checked")):($(this).attr("data-check","true"),$(this).parents(".yearBox").find(".month").attr("data-check","true"),$(this).parents(".yearBox").find(".day").attr("data-check","true"),$(this).parents(".yearBox").find("input[type='checkbox']").prop("checked",!0))}),$(document).off("click.ptFilterCheckbox3").on("click.ptFilterCheckbox3","#luckysheet-pivotTableFilter-byvalue-select .month",function(){"true"==$(this).attr("data-check")?($(this).attr("data-check","false"),$(this).parents(".monthBox").find(".day").attr("data-check","false"),$(this).parents(".monthBox").find("input[type='checkbox']").removeAttr("checked")):($(this).attr("data-check","true"),$(this).parents(".monthBox").find(".day").attr("data-check","true"),$(this).parents(".monthBox").find("input[type='checkbox']").prop("checked",!0));let e=!0;$(this).parents(".yearBox").find(".day").each(function(t,l){"true"==$(l).attr("data-check")||(e=!1)}),e?($(this).parents(".yearBox").find(".year").attr("data-check","true"),$(this).parents(".yearBox").find(".year input[type='checkbox']").prop("checked",!0)):($(this).parents(".yearBox").find(".year").attr("data-check","false"),$(this).parents(".yearBox").find(".year input[type='checkbox']").removeAttr("checked"))}),$(document).off("click.ptFilterCheckbox4").on("click.ptFilterCheckbox4","#luckysheet-pivotTableFilter-byvalue-select .day",function(){"true"==$(this).attr("data-check")?($(this).attr("data-check","false"),$(this).find("input[type='checkbox']").removeAttr("checked")):($(this).attr("data-check","true"),$(this).find("input[type='checkbox']").prop("checked",!0));let e=!0;$(this).parents(".monthBox").find(".day").each(function(t,l){"true"==$(l).attr("data-check")||(e=!1)}),e?($(this).parents(".monthBox").find(".month").attr("data-check","true"),$(this).parents(".monthBox").find(".month input[type='checkbox']").prop("checked",!0)):($(this).parents(".monthBox").find(".month").attr("data-check","false"),$(this).parents(".monthBox").find(".month input[type='checkbox']").removeAttr("checked"));let t=!0;$(this).parents(".yearBox").find(".day").each(function(e,l){"true"==$(l).attr("data-check")||(t=!1)}),t?($(this).parents(".yearBox").find(".year").attr("data-check","true"),$(this).parents(".yearBox").find(".year input[type='checkbox']").prop("checked",!0)):($(this).parents(".yearBox").find(".year").attr("data-check","false"),$(this).parents(".yearBox").find(".year input[type='checkbox']").removeAttr("checked"))}),$(document).off("click.ptFilterYearDropdown").on("click.ptFilterYearDropdown","#luckysheet-pivotTableFilter-byvalue-select .yearBox .fa-caret-right",function(){let e=$(this).parents(".luckysheet-mousedown-cancel");e.hasClass("year")&&$(this).parents(".yearBox").find(".monthList").slideToggle(),e.hasClass("month")&&$(this).parents(".monthBox").find(".dayList").slideToggle()}),$("#luckysheet-pivotTableFilter-byvalue-btn-all").click(function(){$("#luckysheet-pivotTableFilter-byvalue-select .ListBox input[type='checkbox']").prop("checked",!0),$("#luckysheet-pivotTableFilter-byvalue-select .ListBox input[type='checkbox']").parents(".luckysheet-mousedown-cancel").attr("data-check","true")}),$("#luckysheet-pivotTableFilter-byvalue-btn-contra").click(function(){$("#luckysheet-pivotTableFilter-byvalue-select .ListBox input[type='checkbox']").each(function(e,t){$(t).is(":checked")?($(t).removeAttr("checked"),$(t).parents(".luckysheet-mousedown-cancel").attr("data-check","false")):($(t).prop("checked",!0),$(t).parents(".luckysheet-mousedown-cancel").attr("data-check","true"))}),$("#luckysheet-pivotTableFilter-byvalue-select .ListBox .monthBox").each(function(e,t){let l=!0;$(t).find(".day input[type='checkbox']").each(function(e,t){$(t).is(":checked")||(l=!1)}),l?($(t).find(".month input[type='checkbox']").prop("checked",!0),$(t).attr("data-check","true")):($(t).find(".month input[type='checkbox']").removeAttr("checked"),$(t).attr("data-check","false"))}),$("#luckysheet-pivotTableFilter-byvalue-select .ListBox .yearBox").each(function(e,t){let l=!0;$(t).find(".day input[type='checkbox']").each(function(e,t){$(t).is(":checked")||(l=!1)}),l?($(t).find(".year input[type='checkbox']").prop("checked",!0),$(t).attr("data-check","true")):($(t).find(".year input[type='checkbox']").removeAttr("checked"),$(t).attr("data-check","false"))})}),$("#luckysheet-pivotTableFilter-byvalue-btn-clear").click(function(){$("#luckysheet-pivotTableFilter-byvalue-select .ListBox input[type='checkbox']").removeAttr("checked"),$("#luckysheet-pivotTableFilter-byvalue-select .ListBox input[type='checkbox']").parents(".luckysheet-mousedown-cancel").attr("data-check","false")}),$("#luckysheet-pivotTableFilter-byvalue-input").on("input propertychange",function(){let e=$(this).val().toString();if($("#luckysheet-pivotTableFilter-byvalue-select .ListBox .luckysheet-mousedown-cancel").show(),""!=e){$("#luckysheet-pivotTableFilter-byvalue-select .ListBox input[type='checkbox']").each(function(t,l){let i=$(l).parents(".luckysheet-mousedown-cancel");if(i.hasClass("day")){let t=$(l).siblings("label").text().toString(),i=$(l).parents(".monthBox").find(".month label").text().toString();if(-1==($(l).parents(".yearBox").find(".year label").text().toString()+"-"+i+"-"+t).indexOf(e)){$(l).parents(".day").hide(),0==$(l).parents(".dayList").find(".day:visible").length&&$(l).parents(".monthBox").find(".month").hide(),0==$(l).parents(".monthList").find(".day:visible").length&&$(l).parents(".yearBox").find(".year").hide()}}if(i.hasClass("textBox")){-1==$(l).siblings("label").text().toString().indexOf(e)&&$(l).parents(".textBox").hide()}})}}),$("#luckysheet-pivotTableFilter-bycondition, #luckysheet-pivotTableFilter-byvalue").click(function(){let e=$(this);e.next().slideToggle(200),setTimeout(function(){"luckysheet-pivotTableFilter-bycondition"==e.attr("id")&&$("#luckysheet-pivotTableFilter-bycondition").next().is(":visible")&&$("#luckysheet-pivotTableFilter-selected span").text()!=o.filiterInputNone&&$("#luckysheet-pivotTableFilter-byvalue").next().slideUp(200),e.is($("#luckysheet-pivotTableFilter-bycondition"))&&$("#luckysheet-pivotTableFilter-bycondition").next().is(":hidden")&&$("#luckysheet-pivotTableFilter-byvalue").next().is(":hidden")&&$("#luckysheet-pivotTableFilter-byvalue").next().slideDown(200)},300)}),$("#luckysheet-pivotTableFilter-cancel").click(function(){$("#luckysheet-pivotTableFilter-menu, #luckysheet-pivotTableFilter-submenu").hide()}),$("#luckysheet-pivotTableFilter-selected").click(function(){let t=$(this).offset(),l=$("#luckysheet-pivotTableFilter-submenu");l.hide();let i=$(window).height(),a=$(window).width(),o=l.width(),s=(l.height(),t.top),c=t.left,n=i-t.top-20;t.left+o>a&&(c=t.left-o),t.top>i/2&&((s=i-t.top)<0&&(s=0),n=t.top-20),l.css({top:s,left:c,height:n}).show(),clearTimeout(e)}),$("#luckysheet-pivotTableFilter-submenu").mouseover(function(){clearTimeout(e)}).find(".luckysheet-cols-menuitem").click(function(e){$("#luckysheet-pivotTableFilter-selected span").html($(this).find(".luckysheet-cols-menuitem-content").text()).data("value",$(this).data("value")),$("#luckysheet-pivotTableFilter-menu .luckysheet-pivotTableFilter-selected-input").hide(),"2"==$(this).data("type")?($("#luckysheet-pivotTableFilter-selected span").data("type","2"),$("#luckysheet-pivotTableFilter-menu .luckysheet-pivotTableFilter-selected-input2").show()):"0"==$(this).data("type")?$("#luckysheet-pivotTableFilter-selected span").data("type","0"):($("#luckysheet-pivotTableFilter-selected span").data("type","1"),$("#luckysheet-pivotTableFilter-menu .luckysheet-pivotTableFilter-selected-input").eq(0).show(),"dateequal"==$(this).attr("data-value")||"datelessthan"==$(this).attr("data-value")||"datemorethan"==$(this).attr("data-value")?$("#luckysheet-pivotTableFilter-menu .luckysheet-pivotTableFilter-selected-input input").prop("type","date"):$("#luckysheet-pivotTableFilter-menu .luckysheet-pivotTableFilter-selected-input input").prop("type","text")),$("#luckysheet-pivotTableFilter-byvalue").next().slideUp(),$("#luckysheet-pivotTableFilter-submenu").hide()}),$("#luckysheet-modal-dialog-pivotTable-list").on("click"," .luckysheet-slider-list-item-filter",function(e){return t.luckysheetsliderlistitemfilter($(this)),e.stopPropagation(),!1}),$("#luckysheet-modal-dialog-pivotTable-list").on("click"," .luckysheet-slider-list-item-filtered",function(e){return t.luckysheetsliderlistclearfilter($(this).next()),e.stopPropagation(),!1}),$("#luckysheet-dialog-pivotTable-range-seleted").click(function(){$("#luckysheet-modal-dialog-slider-pivot").hide(),f();let e=$("#luckysheet-data-pivotTable-selection"),l=e.outerHeight(),i=e.outerWidth(),a=$(window).width(),o=$(window).height(),s=$(document).scrollLeft(),c=$(document).scrollTop();$("#luckysheet-data-pivotTable-selection").css({left:(a+s-i)/2,top:(o+c-l)/4}).show(),t.jgridCurrentPivotInput=$("#luckysheet-dialog-pivotTable-range").html(),$("#luckysheet-pivotTable-range-selection-input").val(t.jgridCurrentPivotInput),t.luckysheet_pivotTable_select_state=!0}),$("#luckysheet-pivotTableFilter-initial").click(function(){$("#luckysheet-modal-dialog-pivotTable-list .luckysheet-slider-list-item-filtered").hide(),$("#luckysheet-modal-dialog-pivotTable-list .luckysheet-modal-dialog-slider-list-item").data("rowhidden",""),$("#luckysheet-pivotTableFilter-menu, #luckysheet-pivotTableFilter-submenu").hide(),$("#luckysheet-pivotTableFilter-menu .luckysheet-pivotTableFilter-selected-input").hide().find("input").val(),$("#luckysheet-pivotTableFilter-selected span").data("type","0").data("type",null).text(o.filiterInputNone),t.setDatatojsfile("filterparm",null),t.celldata=t.origindata,t.refreshPivotTable()}),$("#luckysheet-modal-dialog-config-row, #luckysheet-modal-dialog-config-column").on("click",".luckysheet-modal-dialog-slider-config-item-icon",function(e){let t=$(e.target).closest(".luckysheet-modal-dialog-slider-config-item"),l=t.data("index"),i=t.offset(),a=t.data("order"),o=t.data("orderby"),s=t.data("stastic");null==a&&(a="default");let c='<option value="self">'+t.find(".luckysheet-modal-dialog-slider-config-item-txt").data("name")+"</option>";return $("#luckysheet-modal-dialog-config-value .luckysheet-modal-dialog-slider-config-item").each(function(e){c+='<option value="'+e+'">'+$(this).find(".luckysheet-modal-dialog-slider-config-item-txt").text()+"</option>"}),$("#luckysheet-pivotTable-config-option-orderby").empty().html(c),null==o&&(o="self"),null==s&&(s="1"),$("#luckysheet-pivotTable-config-option-order").val(a).data("index",l),$("#luckysheet-pivotTable-config-option-orderby").val(o).data("index",l),$("#luckysheet-pivotTable-config-option-stastic").val(s).data("index",l),_($("#luckysheet-pivotTable-config-option"),i.left+t.outerWidth(),i.top-13,"rightbottom"),e.stopPropagation(),!1}),$("#luckysheet-pivotTable-config-option-order,#luckysheet-pivotTable-config-option-orderby,#luckysheet-pivotTable-config-option-stastic").change(function(){let e=$(this),l=e.data("index");$("#luckysheet-modal-dialog-config-row, #luckysheet-modal-dialog-config-column").find(".luckysheet-modal-dialog-slider-config-item").each(function(){$(this).data("index")==l&&$(this).data(e.attr("id").replace("luckysheet-pivotTable-config-option-",""),e.val())}),t.refreshPivotTable()}),$("#luckysheet-modal-dialog-config-value").on("click",".luckysheet-modal-dialog-slider-config-item-icon",function(e){let l=$(e.target).closest(".luckysheet-modal-dialog-slider-config-item"),i=l.data("index"),a=l.offset(),o=l.data("sumtype"),s=t.pivot_data_type[i.toString()];null==o&&(o="num"==s?"SUM":"COUNTA");let c=$("#luckysheet-pivotTable-config-option-sumtype");return c.find(".luckysheet-submenu-arrow").hide(),c.find(".luckysheet-cols-menuitem[sumtype='"+o+"'] .luckysheet-submenu-arrow").css("display","inline"),c.data("item",l),_(c,a.left+l.outerWidth(),a.top-13,"rightbottom"),e.stopPropagation(),!1}),$("#luckysheet-pivotTable-config-option-sumtype .luckysheet-cols-menuitem").click(function(){let e=$("#luckysheet-pivotTable-config-option-sumtype").data("item"),l=$(this).attr("sumtype");e.data("sumtype",$(this).attr("sumtype"));let i=t.getSumTypeName(l)+":"+e.data("name");e.attr("title",i).find(".luckysheet-modal-dialog-slider-config-item-txt").html(i),$("#luckysheet-pivotTable-config-option-sumtype").hide(),t.refreshPivotTable()}),$("#luckysheet-modal-dialog-config-filter").on("click",".luckysheet-modal-dialog-slider-config-item-icon",function(e){let l=$(e.target).closest(".luckysheet-modal-dialog-slider-config-item").data("index");return t.luckysheetsliderlistitemfilter($("#luckysheet-modal-dialog-pivotTable-list .luckysheet-modal-dialog-slider-list-item").eq(l).find(".luckysheet-slider-list-item-filter")),e.stopPropagation(),!1}),$("#luckysheet-pivotTableFilter-confirm").click(function(){let e=$("#luckysheet-pivotTableFilter-menu").data("index"),l={};$("#luckysheet-modal-dialog-pivotTable-list .luckysheet-modal-dialog-slider-list-item").each(function(){let t=$(this),i=t.data("rowhidden");if(t.data("index")!=e){if(null==i||""==i)return!0;"string"==B(i)&&(i=JSON.parse(i));for(let e in i)l[e]=0}});let i=t.origindata,a={},s={},c={};if($("#luckysheet-pivotTableFilter-bycondition").next().is(":visible")&&$("#luckysheet-pivotTableFilter-byvalue").next().is(":hidden")&&"null"!=$("#luckysheet-pivotTableFilter-selected span").data("value")){let t=$("#luckysheet-pivotTableFilter-selected span"),a=t.data("type"),o=t.data("value");if(c.value=o,c.text=t.text(),"0"==a)c.type="0";else if("2"==a){let e=$("#luckysheet-pivotTableFilter-menu .luckysheet-pivotTableFilter-selected-input2 input");c.type="2",c.value1=e.eq(0).val(),c.value2=e.eq(1).val()}else c.type="1",c.value1=$("#luckysheet-pivotTableFilter-menu .luckysheet-pivotTableFilter-selected-input").eq(0).find("input").val();for(let t=1;t<i.length;t++){if(t in l)continue;if(null==i[t])continue;let a=i[t][e];if("cellnull"==o)null==a||Y(a.v)||(s[t]=0);else if("cellnonull"==o)(null==a||Y(a.v))&&(s[t]=0);else if("textinclude"==o){let e=c.value1;null==a||Y(a.v)?s[t]=0:-1==a.m.indexOf(e)&&(s[t]=0)}else if("textnotinclude"==o){let e=c.value1;null==a||Y(a.v)||a.m.indexOf(e)>-1&&(s[t]=0)}else if("textstart"==o){let e=c.value1,l=e.length;null==a||Y(a.v)?s[t]=0:a.m.substr(0,l)!=e&&(s[t]=0)}else if("textend"==o){let e=c.value1,l=e.length;null==a||Y(a.v)?s[t]=0:(l>a.m.length||a.m.substr(a.m.length-l,l)!=e)&&(s[t]=0)}else if("textequal"==o){let e=c.value1;null==a||Y(a.v)?s[t]=0:a.m!=e&&(s[t]=0)}else if("dateequal"==o){let e=O(c.value1)[2];null==a||Y(a.v)?s[t]=0:null!=a.ct&&"d"==a.ct.t?parseInt(a.v)!=e&&(s[t]=0):s[t]=0}else if("datelessthan"==o){let e=O(c.value1)[2];null==a||Y(a.v)?s[t]=0:null!=a.ct&&"d"==a.ct.t?parseInt(a.v)>=e&&(s[t]=0):s[t]=0}else if("datemorethan"==o){let e=O(c.value1)[2];null==a||Y(a.v)?s[t]=0:null!=a.ct&&"d"==a.ct.t?parseInt(a.v)<=e&&(s[t]=0):s[t]=0}else if("morethan"==o){let e=parseFloat(c.value1);null==a||Y(a.v)?s[t]=0:null!=a.ct&&"n"==a.ct.t?a.v<=e&&(s[t]=0):s[t]=0}else if("moreequalthan"==o){let e=parseFloat(c.value1);null==a||Y(a.v)?s[t]=0:null!=a.ct&&"n"==a.ct.t?a.v<e&&(s[t]=0):s[t]=0}else if("lessthan"==o){let e=parseFloat(c.value1);null==a||Y(a.v)?s[t]=0:null!=a.ct&&"n"==a.ct.t?a.v>=e&&(s[t]=0):s[t]=0}else if("lessequalthan"==o){let e=parseFloat(c.value1);null==a||Y(a.v)?s[t]=0:null!=a.ct&&"n"==a.ct.t?a.v>e&&(s[t]=0):s[t]=0}else if("equal"==o){let e=parseFloat(c.value1);null==a||Y(a.v)?s[t]=0:null!=a.ct&&"n"==a.ct.t?a.v!=e&&(s[t]=0):s[t]=0}else if("noequal"==o){let e=parseFloat(c.value1);null==a||Y(a.v)?s[t]=0:null!=a.ct&&"n"==a.ct.t?a.v==e&&(s[t]=0):s[t]=0}else if("include"==o){let e,l,i=parseFloat(c.value1),o=parseFloat(c.value2);i<o?(e=i,l=o):(l=i,e=o),null==a||Y(a.v)?s[t]=0:null!=a.ct&&"n"==a.ct.t?(a.v<e||a.v>l)&&(s[t]=0):s[t]=0}else if("noinclude"==o){let e,l,i=parseFloat(c.value1),o=parseFloat(c.value2);i<o?(e=i,l=o):(l=i,e=o),null==a||Y(a.v)?s[t]=0:null!=a.ct&&"n"==a.ct.t?a.v>=e&&a.v<=l&&(s[t]=0):s[t]=0}}}else{$("#luckysheet-pivotTableFilter-byvalue-select .ListBox input[type='checkbox']").each(function(e,t){if($(t).is(":visible")&&$(t).is(":checked"))return!0;if($(t).closest(".day").length>0){let e=$(t).siblings("label").text();Number(e)<10&&(e="0"+e);let l=$(t).closest(".monthBox").find(".month label").text().replace(o.filiterMonthText,"");Number(l)<10&&(l="0"+l);let i=$(t).closest(".yearBox").find(".year label").text().replace(o.filiterYearText,""),s=o.filterDateFormatTip+"#$$$#"+i+"-"+l+"-"+e;a[s]="1"}if($(t).closest(".textBox").length>0){let e=$(t).closest(".textBox").data("filter");a[e]="1"}});for(let t=1;t<i.length;t++){if(t in l)continue;if(null==i[t])continue;let c,n=i[t][e];if(null==n||Y(n.v))c="null#$$$#null";else if(null!=n.ct&&"d"==n.ct.t){let e=R("YYYY-MM-DD",n.v);c=o.filterDateFormatTip+"#$$$#"+e}else c=n.v+"#$$$#"+n.m;c in a&&(s[t]=0)}}let n=$("#luckysheet-modal-dialog-pivotTable-list .luckysheet-modal-dialog-slider-list-item").eq(e);$("#luckysheet-pivotTableFilter-byvalue-select .ListBox input[type='checkbox']:visible:checked").length<$("#luckysheet-pivotTableFilter-byvalue-select .ListBox input[type='checkbox']:visible").length||$("#luckysheet-pivotTableFilter-byvalue-input").val().length>0||$("#luckysheet-pivotTableFilter-bycondition").next().is(":visible")&&$("#luckysheet-pivotTableFilter-byvalue").next().is(":hidden")&&"null"!=$("#luckysheet-pivotTableFilter-selected span").data("value")?(n.data("rowhidden",JSON.stringify(s)).find(".luckysheet-slider-list-item-filtered").show(),t.setDatatojsfile("rowhidden",s,e),null!=c&&(n.data("byconditionvalue",c.value).data("byconditiontype",c.type).data("byconditiontext",c.text),null!=c.value1&&n.data("byconditionvalue1",c.value1),null!=c.value2&&n.data("byconditionvalue2",c.value2),t.setDatatojsfile("caljs",c,e))):(n.data("rowhidden","").find(".luckysheet-slider-list-item-filtered").hide(),t.setDatatojsfile("rowhidden",null,e));let u=[];for(let e=0;e<i.length;e++)e in s||e in l||u.push([].concat(i[e]));t.celldata=u,t.refreshPivotTable(),$("#luckysheet-pivotTableFilter-menu, #luckysheet-pivotTableFilter-submenu").hide(),d()}),$("#luckysheet-data-pivotTable-selection .luckysheet-model-close-btn, #luckysheet-data-pivotTable-selection .luckysheet-modal-dialog-title-close").click(function(){$("#luckysheet-modal-dialog-slider-pivot").show(),f(),$("#luckysheet-cell-main .luckysheet-pivotTable-selection-set div").show(),$("#luckysheet-data-pivotTable-selection").hide(),g.changeSheet(t.pivotSheetIndex),t.luckysheet_pivotTable_select_state=!1,d()}),$("#luckysheet-pivotTable-selection-confirm").click(function(){let e=$("#luckysheet-pivotTable-range-selection-input"),l=e.val();if(0==$.trim(l).length||$.trim(l).toUpperCase()==t.jgridCurrentPivotInput.toUpperCase())return e.val(t.jgridCurrentPivotInput),void $("#luckysheet-data-pivotTable-selection .luckysheet-model-close-btn").click();{let a=l.split("!"),o="",s="",c=-1;if(a.length>1){o=a[0],s=a[1];for(let e in g.luckysheetfile)if(o==g.luckysheetfile[e].name){c=g.luckysheetfile[e].index;break}-1==c&&(c=0)}else{let e=T(g.currentSheetIndex);o=g.luckysheetfile[e].name,c=g.luckysheetfile[e].index,s=a[0]}if(g.luckysheetfile[T(c)].isPivotTable)return H()?alert(i.errorNotAllowPivotData):n.info("",i.errorNotAllowPivotData),void e.val(t.jgridCurrentPivotInput);if(-1==s.indexOf(":"))return H()?alert(i.errorSelectionRange):n.info("",i.errorSelectionRange),void e.val(t.jgridCurrentPivotInput);s=s.split(":");let u=[],r=[];if(u[0]=parseInt(s[0].replace(/[^0-9]/g,""))-1,u[1]=parseInt(s[1].replace(/[^0-9]/g,""))-1,u[0]>u[1])return H()?alert(i.errorSelectionRange):n.info("",i.errorSelectionRange),void e.val(t.jgridCurrentPivotInput);if(r[0]=S(s[0].replace(/[^A-Za-z]/g,"")),r[1]=S(s[1].replace(/[^A-Za-z]/g,"")),r[0]>r[1])return H()?alert(i.errorSelectionRange):n.info(i.errorSelectionRange),void e.val(t.jgridCurrentPivotInput);g.changeSheet(t.pivotSheetIndex),t.setDatatojsfile("pivot_select_save",{row:u,column:r}),t.setDatatojsfile("pivotDataSheetIndex",c),t.getCellData(t.pivotSheetIndex,c,{row:u,column:r}),t.initialPivotManage(),$("#luckysheet-dialog-pivotTable-range").html(l),$("#luckysheet-modal-dialog-slider-pivot").show(),$("#luckysheet-data-pivotTable-selection").hide(),t.luckysheet_pivotTable_select_state=!1,t.refreshPivotTable(),f(),d()}}),$("#luckysheet-modal-dialog-slider-pivot").on("mousedown",".luckysheet-slider-list-item-name, .luckysheet-modal-dialog-slider-config-item-txt",function(e){let l=$(e.target);t.movestate=!0,t.movesave.obj=l.parent(),t.movesave.name=l.data("name"),t.movesave.containerid=l.parent().parent().attr("id"),t.movesave.index=l.data("index"),0==$("#luckysheet-modal-dialog-slider-pivot-move").length&&$("body").append('<div id="luckysheet-modal-dialog-slider-pivot-move">'+t.movesave.name+"</div>"),t.movesave.width=$("#luckysheet-modal-dialog-slider-pivot-move").outerWidth(),t.movesave.height=$("#luckysheet-modal-dialog-slider-pivot-move").outerHeight(),$("#luckysheet-modal-dialog-pivotTable-list, #luckysheet-modal-dialog-config-filter, #luckysheet-modal-dialog-config-row, #luckysheet-modal-dialog-config-column, #luckysheet-modal-dialog-config-value").css("cursor","default")}),$("#luckysheet-modal-dialog-config-filter, #luckysheet-modal-dialog-config-row, #luckysheet-modal-dialog-config-column, #luckysheet-modal-dialog-config-value").mousemove(function(e){if(t.movestate){0==t.moveitemposition.length&&(t.moveitemposition=[0],$(this).find(".luckysheet-modal-dialog-slider-config-item").each(function(e){let l=$(this).outerHeight();t.moveitemposition.push(t.moveitemposition[e]+l+2)}),$(this).append('<div id="luckysheet-modal-dialog-config-order-help" style="position:absolute;height:3px;width:100%;background:#007ACC;z-index:1;pointer-events: none;user-select:none;"></div>')),$("#luckysheet-modal-dialog-slider-pivot-move").css({background:"#FD8585",color:"#fff",border:"1px solid #FD7070"});event.pageX;let e=event.pageY,l=$(this),i=e-l.offset().top+l.scrollTop(),a=t.moveitemposition,o=z(a,i);-1==o?$("#luckysheet-modal-dialog-config-order-help").css({top:a[a.length-1]}):i-a[o-1]>(a[o]-a[o-1])/2?$("#luckysheet-modal-dialog-config-order-help").css({top:a[o]}):$("#luckysheet-modal-dialog-config-order-help").css({top:a[o-1]})}}).mouseleave(function(){t.movestate&&($("#luckysheet-modal-dialog-slider-pivot-move").css({background:"#fff",color:"#000",border:"1px dotted #000"}),t.moveitemposition=[],$("#luckysheet-modal-dialog-config-order-help").remove())}).mouseup(function(e){if(t.movestate){let l,a=$(this);if(t.movesave.containerid==a.attr("id"))l=t.movesave.obj.clone();else{let e=t.movesave.name,o="",s="";if("luckysheet-modal-dialog-config-value"==a.attr("id")){"num"==t.pivot_data_type[t.movesave.index.toString()]?(e=i.valueStatisticsSUM+":"+e,o="data-sumtype='SUM'",s="data-nameindex='0'"):(e=i.valueStatisticsCOUNTA+":"+e,o="data-sumtype='COUNTA'",s="data-nameindex='0'"),$("#luckysheet-modal-dialog-config-value").find(".luckysheet-modal-dialog-slider-config-item").each(function(){if($(this).find(".luckysheet-modal-dialog-slider-config-item-txt").text()==e){let t=parseFloat($(this).data("nameindex"))+1;return e+=t.toString(),$(this).data("nameindex",t),!1}})}l='<div title="'+e+'" class="luckysheet-modal-dialog-slider-config-item" '+s+" "+o+' data-index="'+t.movesave.index+'" data-name="'+t.movesave.name+'"><div class="luckysheet-modal-dialog-slider-config-item-txt" '+s+" "+o+' data-index="'+t.movesave.index+'" data-name="'+t.movesave.name+'">'+e+'</div><div class="luckysheet-modal-dialog-slider-config-item-icon"><i class="fa fa-sort-desc" aria-hidden="true"></i></div></div>'}event.pageX;let o=event.pageY,s=$(this),c=o-s.offset().top+s.scrollTop(),n=t.moveitemposition,d=z(n,c);("luckysheet-modal-dialog-pivotTable-list"==t.movesave.containerid||"luckysheet-modal-dialog-config-value"==t.movesave.containerid&&t.movesave.containerid!=a.attr("id"))&&$("#luckysheet-modal-dialog-config-filter, #luckysheet-modal-dialog-config-row, #luckysheet-modal-dialog-config-column").find(".luckysheet-modal-dialog-slider-config-item").each(function(){$(this).data("index")==t.movesave.index&&$(this).remove()}),-1==d?0==a.find(".luckysheet-modal-dialog-slider-config-item").length?a.append(l):a.find(".luckysheet-modal-dialog-slider-config-item").last().after(l):c-n[d-1]>(n[d]-n[d-1])/2?a.find(".luckysheet-modal-dialog-slider-config-item").eq(d-1).after(l):a.find(".luckysheet-modal-dialog-slider-config-item").eq(d-1).before(l),"luckysheet-modal-dialog-pivotTable-list"==t.movesave.containerid||"luckysheet-modal-dialog-config-value"==t.movesave.containerid&&t.movesave.containerid!=a.attr("id")||t.movesave.obj.remove(),$("#luckysheet-modal-dialog-pivotTable-list").find(".luckysheet-modal-dialog-slider-list-item").each(function(){let e=$(this).find(".luckysheet-slider-list-item-selected");$(this).data("index")==t.movesave.index&&0==e.find("i").length&&e.append('<i class="fa fa-check luckysheet-mousedown-cancel"></i>')}),t.refreshPivotTable(),$("#luckysheet-modal-dialog-slider-pivot-move").remove(),t.movestate=!1,$("#luckysheet-modal-dialog-pivotTable-list, #luckysheet-modal-dialog-config-filter, #luckysheet-modal-dialog-config-row, #luckysheet-modal-dialog-config-column, #luckysheet-modal-dialog-config-value").css("cursor","default"),t.moveitemposition=[],$("#luckysheet-modal-dialog-config-order-help").remove(),t.showvaluecolrow(),e.stopPropagation()}}),$("#luckysheet-modal-dialog-pivotTable-list").on("click",".luckysheet-slider-list-item-selected",function(){let e=$(this),l=e.parent(),i=l.data("index"),a=l.data("name");if(0==e.find("i").length){let l;if(e.append('<i class="fa fa-check luckysheet-mousedown-cancel"></i>'),"num"==t.pivot_data_type[i.toString()])l='<div title="'+a+'" class="luckysheet-modal-dialog-slider-config-item" data-nameindex="0" data-sumtype="SUM" data-index="'+i+'" data-name="'+a+'"><div class="luckysheet-modal-dialog-slider-config-item-txt" data-nameindex="0" data-sumtype="SUM" data-index="'+i+'" data-name="'+a+'">求和:'+a+'</div><div class="luckysheet-modal-dialog-slider-config-item-icon"><i class="fa fa-sort-desc" aria-hidden="true"></i></div></div>',$("#luckysheet-modal-dialog-config-value").append(l);else{l='<div title="'+a+'" class="luckysheet-modal-dialog-slider-config-item" data-index="'+i+'" data-name="'+a+'"><div class="luckysheet-modal-dialog-slider-config-item-txt" data-index="'+i+'" data-name="'+a+'">'+a+'</div><div class="luckysheet-modal-dialog-slider-config-item-icon"><i class="fa fa-sort-desc" aria-hidden="true"></i></div></div>';let e=$("#luckysheet-modal-dialog-config-column"),t=$("#luckysheet-modal-dialog-config-row"),o=e.find(".luckysheet-modal-dialog-slider-config-item"),s=t.find(".luckysheet-modal-dialog-slider-config-item");o.length<2?e.append(l):s.length<2?t.append(l):e.append(l)}}else e.find("i").remove(),$("#luckysheet-modal-dialog-config-filter, #luckysheet-modal-dialog-config-row, #luckysheet-modal-dialog-config-column, #luckysheet-modal-dialog-config-value").find(".luckysheet-modal-dialog-slider-config-item").each(function(){$(this).data("index")==i&&("luckysheet-modal-dialog-config-value"==$(this).parent().attr("id")&&t.resetOrderby($(this)),$(this).remove())});t.refreshPivotTable(),t.showvaluecolrow()}),$("#luckysheet-dialog-pivotTable-clearitem").click(function(){$("#luckysheet-modal-dialog-config-filter, #luckysheet-modal-dialog-config-row, #luckysheet-modal-dialog-config-column, #luckysheet-modal-dialog-config-value").find(".luckysheet-modal-dialog-slider-config-item").each(function(){$(this).remove()}),$("#luckysheet-modal-dialog-pivotTable-list").find(".luckysheet-modal-dialog-slider-list-item").each(function(){$(this).find(".luckysheet-slider-list-item-selected").find("i").remove()}),t.refreshPivotTable(),t.showvaluecolrow()})}null==e&&(e=!1),t.celldata.length<=1&&t.celldata[0].length<=1&&(H()?alert(i.errorIncreaseRange):n.info("",i.errorIncreaseRange));let s="",c=1,u={},r=1;for(let l=0;l<t.celldata[0].length;l++){let a;null!=(a=t.celldata[0][l]&&t.celldata[0][l].m?t.celldata[0][l].m:I(0,l,t.celldata))&&(a=a.toString()),null!=a&&0!=$.trim(a.toString()).length||(a=i.titleColumn+" "+r),r++,a in u&&(a+=c++)in u&&(a+=c++)in u&&(a+=c++),u[a]=1;let o="",n="";if(e&&null!=t.filterparm&&null!=t.filterparm[l.toString()]){let e=t.filterparm[l.toString()];if(null!=e.rowhidden&&(o+="data-rowhidden='"+JSON.stringify(e.rowhidden)+"'"),null!=e.selected&&(o+="data-selected='"+JSON.stringify(e.selected)+"'"),null!=e.caljs){let t=e.caljs;null!=t.value&&(o+="data-byconditionvalue='"+t.value+"'"),null!=t.type&&(o+="data-byconditiontype='"+t.type+"'"),null!=t.text&&(o+="data-byconditiontext='"+t.text+"'"),null!=t.value1&&(o+="data-byconditionvalue1='"+t.value1+"'"),null!=t.value2&&(o+="data-byconditionvalue2='"+t.value2+"'")}}o.length>0&&(n="display:block;"),s+='<div class="luckysheet-modal-dialog-slider-list-item" '+o+' data-index="'+l+'" data-name="'+a+'"><div title="'+i.titleAddColumn+'" class="luckysheet-slider-list-item-selected"><div></div></div><div title="'+i.titleMoveColumn+'" class="luckysheet-slider-list-item-name" '+o+' data-index="'+l+'" data-name="'+a+'">'+a+'</div><div title="'+i.titleClearColumnFilter+'" class="luckysheet-slider-list-item-filtered" style="'+n+'"><i class="fa fa-filter luckysheet-mousedown-cancel" aria-hidden="true"></i><i class="fa fa-times" aria-hidden="true"></i></div><div title="'+i.titleFilterColumn+'" class="luckysheet-slider-list-item-filter"><i class="fa fa-sort-desc" aria-hidden="true"></i></div></div>'}if($("#luckysheet-modal-dialog-pivotTable-list").html(s),$("#luckysheetpivottablevaluecolrowshow").hide(),$("#luckysheetpivottablevaluecolrow").prop("checked",!0),$("#luckysheetpivottablevaluecolrow1").prop("checked",!1),$("#luckysheet-modal-dialog-config-filter, #luckysheet-modal-dialog-config-row, #luckysheet-modal-dialog-config-column, #luckysheet-modal-dialog-config-value").empty(),e){if(null!=t.filter&&t.filter.length>0)for(let e=0;e<t.filter.length;e++){let l=t.filter[e],i='<div title="'+name+'" class="luckysheet-modal-dialog-slider-config-item" data-index="'+l.index+'" data-name="'+l.name+'"><div class="luckysheet-modal-dialog-slider-config-item-txt" data-index="'+l.index+'" data-name="'+l.name+'">'+l.name+'</div><div class="luckysheet-modal-dialog-slider-config-item-icon"><i class="fa fa-sort-desc" aria-hidden="true"></i></div></div>';$("#luckysheet-modal-dialog-config-filter").append(i);let a=$("#luckysheet-modal-dialog-pivotTable-list .luckysheet-modal-dialog-slider-list-item").eq(l.index).find(".luckysheet-slider-list-item-selected");0==a.find("i").length&&a.append('<i class="fa fa-check luckysheet-mousedown-cancel"></i>')}if(null!=t.row&&t.row.length>0)for(let e=0;e<t.row.length;e++){let l=t.row[e],i="";null!=l.order&&(i+="data-order = '"+l.order+"'"),null!=l.orderby&&(i+="data-orderby = '"+l.orderby+"'"),null!=l.order&&(i+="data-stastic = '"+l.stastic+"'");let a='<div title="'+name+'" class="luckysheet-modal-dialog-slider-config-item" '+i+' data-index="'+l.index+'" data-name="'+l.name+'"><div class="luckysheet-modal-dialog-slider-config-item-txt" '+i+' data-index="'+l.index+'" data-name="'+l.name+'">'+l.name+'</div><div class="luckysheet-modal-dialog-slider-config-item-icon"><i class="fa fa-sort-desc" aria-hidden="true"></i></div></div>';$("#luckysheet-modal-dialog-config-row").append(a);let o=$("#luckysheet-modal-dialog-pivotTable-list .luckysheet-modal-dialog-slider-list-item").eq(l.index).find(".luckysheet-slider-list-item-selected");0==o.find("i").length&&o.append('<i class="fa fa-check luckysheet-mousedown-cancel"></i>')}if(null!=t.column&&t.column.length>0)for(let e=0;e<t.column.length;e++){let l=t.column[e],i="";null!=l.order&&(i+="data-order = '"+l.order+"'"),null!=l.orderby&&(i+="data-orderby = '"+l.orderby+"'"),null!=l.order&&(i+="data-stastic = '"+l.stastic+"'");let a='<div title="'+name+'" class="luckysheet-modal-dialog-slider-config-item" '+i+' data-index="'+l.index+'" data-name="'+l.name+'"><div class="luckysheet-modal-dialog-slider-config-item-txt" '+i+' data-index="'+l.index+'" data-name="'+l.name+'">'+l.name+'</div><div class="luckysheet-modal-dialog-slider-config-item-icon"><i class="fa fa-sort-desc" aria-hidden="true"></i></div></div>';$("#luckysheet-modal-dialog-config-column").append(a);let o=$("#luckysheet-modal-dialog-pivotTable-list .luckysheet-modal-dialog-slider-list-item").eq(l.index).find(".luckysheet-slider-list-item-selected");0==o.find("i").length&&o.append('<i class="fa fa-check luckysheet-mousedown-cancel"></i>')}if(null!=t.values&&t.values.length>0){for(let e=0;e<t.values.length;e++){let l=t.values[e],i="";null!=l.sumtype&&(i+="data-sumtype = '"+l.sumtype+"'"),null!=l.nameindex&&(i+="data-nameindex = '"+l.nameindex+"'");let a='<div title="'+name+'" class="luckysheet-modal-dialog-slider-config-item" '+i+' data-index="'+l.index+'" data-name="'+l.name+'"><div class="luckysheet-modal-dialog-slider-config-item-txt" '+i+' data-index="'+l.index+'" data-name="'+l.name+'">'+t.getSumTypeName(l.sumtype)+":"+l.name+'</div><div class="luckysheet-modal-dialog-slider-config-item-icon"><i class="fa fa-sort-desc" aria-hidden="true"></i></div></div>';$("#luckysheet-modal-dialog-config-value").append(a);let o=$("#luckysheet-modal-dialog-pivotTable-list .luckysheet-modal-dialog-slider-list-item").eq(l.index).find(".luckysheet-slider-list-item-selected");0==o.find("i").length&&o.append('<i class="fa fa-check luckysheet-mousedown-cancel"></i>')}t.values.length>=2&&($("#luckysheetpivottablevaluecolrowshow").show(),"column"==t.showType?($("#luckysheetpivottablevaluecolrow").prop("checked",!0),$("#luckysheetpivottablevaluecolrowshow label[for='luckysheetpivottablevaluecolrow']").addClass("ui-state-active"),$("#luckysheetpivottablevaluecolrow1").prop("checked",!1),$("#luckysheetpivottablevaluecolrowshow label[for='luckysheetpivottablevaluecolrow1']").removeClass("ui-state-active")):($("#luckysheetpivottablevaluecolrow1").prop("checked",!0),$("#luckysheetpivottablevaluecolrowshow label[for='luckysheetpivottablevaluecolrow1']").addClass("ui-state-active"),$("#luckysheetpivottablevaluecolrow").prop("checked",!1),$("#luckysheetpivottablevaluecolrowshow label[for='luckysheetpivottablevaluecolrow']").removeClass("ui-state-active")))}}$("#luckysheet-dialog-pivotTable-range").html(w(t.pivotDataSheetIndex,t.pivot_select_save)),$("#luckysheet-modal-dialog-slider-pivot").show(),f(!1)},drillDown:function(e,t){if(!Q(g.currentSheetIndex,"usePivotTablereports"))return;let l=this,i=(l.pivotDatas[e][t],$.extend(!0,[],y.nulldata));const a=b(),o=a.filter,s=a.pivotTable;let c=1;for(let e=0;e<l.celldata[0].length;e++){let t;null!=(t=l.celldata[0][e]&&l.celldata[0][e].m?l.celldata[0][e].m:I(0,e,l.celldata))&&(t=t.toString()),null!=t&&0!=$.trim(t.toString()).length||(t=s.titleColumn+" "+c),c++,i[0][e]=t}let n={};if(null!=l.row&&l.row.length>0)for(let t=0;t<l.row.length;t++)n[l.row[t].index]=l.pivotDatas[e][t];if(null!=l.column&&l.column.length>0)for(let e=0;e<l.column.length;e++)n[l.column[e].index]=l.pivotDatas[e][t];let d=[];for(let e=1;e<l.celldata.length;e++){let t=!0;for(let i in n){let a;if((a=null!=(a=l.celldata[e][i]&&l.celldata[e][i].m?l.celldata[e][i].m:I(e,i,l.celldata))?a.toString():o.valueBlank)!=n[i]){t=!1;break}}t&&d.push(e)}for(let e=0;e<d.length;e++)for(let t=0;t<l.celldata[0].length;t++){let a;a=null!=(a=l.celldata[d[e]][t]&&l.celldata[d[e]][t].m?l.celldata[d[e]][t].m:I(d[e],t,l.celldata))?a.toString():"",i[e+1][t]=a}g.luckysheet_select_save=[{row:[0,d.length],column:[0,l.celldata[0].length-1]}],g.clearjfundo=!1,g.refreshGrid(i,g.luckysheet_select_save),J(),g.clearjfundo=!0}})});
//# sourceMappingURL=../sourcemaps/controllers/pivotTable.js.map
