/**
 * skylark-lucksheet - A version of lucksheet.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["../methods/get","../utils/util","../global/getdata","../global/datecontroll","../global/format","../global/validate","../global/sort","../global/refresh","../global/tooltip","../global/editor","../global/cleargridelement","../global/array","../global/analysis","./select","./sheetSearch","./constant","./sheetmanage","./resize","./server","./protection","../store","../locale/locale","../vendors/numeral"],function(e,t,l,i,a,o,n,s,c,d,u,r,h,p,v,f,m,y,g,k,b,x,T){"use strict";const{getSheetIndex:w,getRangetxt:F}=e,{replaceHtml:S,getObjType:D,ABCatNum:B,numFormat:N,numfloatlen:P,showrightclickmenu:C,mouseclickposition:_}=t,{getdatabyselectionD:I,getcellvalue:j,datagridgrowth:A}=l,{isdatetime:M,diff:U,isdatatypemulti:O,isdatatype:L}=i,{genarate:q,update:R}=a,{isRealNull:E,isEditMode:V}=o,{orderbydata1D:Y}=n,{jfrefreshgrid:H,jfrefreshgridall:G}=s,{selectHightlightShow:J}=p,{luckysheet_searcharray:z}=v,{modelHTML:X,filtermenuHTML:W,filtersubmenuHTML:Q,pivottableconfigHTML:Z,pivottablesumHTML:K,luckysheetPivotTableHTML:ee}=f,{checkProtectionAuthorityNormal:te}=k;return{pivotDatas:null,pivotSheetIndex:0,pivotDataSheetIndex:0,celldata:null,origindata:null,getCellData:function(e,t,l){let i,a=this;i=null!=e?e:b.currentSheetIndex;let o=w(i);"object"!=D(b.luckysheetfile[o].pivotTable)&&(b.luckysheetfile[o].pivotTable=new Function("return "+b.luckysheetfile[o].pivotTable)()),null!=b.luckysheetfile[o].pivotTable?(a.column=b.luckysheetfile[o].pivotTable.column,a.row=b.luckysheetfile[o].pivotTable.row,a.values=b.luckysheetfile[o].pivotTable.values,a.filter=b.luckysheetfile[o].pivotTable.filter,a.showType=b.luckysheetfile[o].pivotTable.showType,a.filterparm=b.luckysheetfile[o].pivotTable.filterparm,null!=b.luckysheetfile[o].pivotTable.drawPivotTable?a.drawPivotTable=b.luckysheetfile[o].pivotTable.drawPivotTable:a.drawPivotTable=!0,null!=b.luckysheetfile[o].pivotTable.pivotTableBoundary?a.pivotTableBoundary=b.luckysheetfile[o].pivotTable.pivotTableBoundary:a.pivotTableBoundary=[12,6],a.pivot_select_save=null!=l?l:b.luckysheetfile[o].pivotTable.pivot_select_save,a.pivotDataSheetIndex=null!=t?t:b.luckysheetfile[o].pivotTable.pivotDataSheetIndex):(a.column=null,a.row=null,a.values=null,a.filter=null,a.showType=null,a.filterparm=null,a.drawPivotTable=!0,a.pivotTableBoundary=[12,6],a.pivot_select_save=null!=l?l:b.luckysheet_select_save,a.pivotDataSheetIndex=null!=t?t:i);let n=w(a.pivotDataSheetIndex),s=b.luckysheetfile[n];null==s.data&&(s.data=m.buildGridData(s)),a.origindata=I(s.data,a.pivot_select_save);let c={};if(null!=a.filterparm)for(let e in a.filterparm)for(let t in a.filterparm[e])"rowhidden"===t&&null!=a.filterparm[e][t]&&(c=$.extend(!0,c,a.filterparm[e][t]));a.rowhidden=c,a.pivotSheetIndex=i;let d=[];for(let e=0;e<a.origindata.length;e++)null!=a.rowhidden&&null!=a.rowhidden[e]||d.push([].concat(a.origindata[e]));a.celldata=d,a.pivot_data_type={};for(let e=0;e<a.celldata[1].length;e++){let t=L(a.celldata[1][e]);a.pivot_data_type[e.toString()]=t}},pivot_data_type:{},pivot_select_save:null,column:null,row:null,values:null,filter:null,showType:null,rowhidden:null,selected:null,caljs:null,initial:!0,filterparm:null,luckysheet_pivotTable_select_state:!1,jgridCurrentPivotInput:null,movestate:!1,moveitemposition:[],movesave:{},showvaluecolrow:function(){let e=this;$("#luckysheet-modal-dialog-config-value .luckysheet-modal-dialog-slider-config-item").length>=2?($("#luckysheetpivottablevaluecolrowshow").show(),"column"==e.showType?($("#luckysheetpivottablevaluecolrow").prop("checked",!0),$("#luckysheetpivottablevaluecolrowshow label[for='luckysheetpivottablevaluecolrow']").addClass("ui-state-active"),$("#luckysheetpivottablevaluecolrow1").prop("checked",!1),$("#luckysheetpivottablevaluecolrowshow label[for='luckysheetpivottablevaluecolrow1']").removeClass("ui-state-active")):($("#luckysheetpivottablevaluecolrow1").prop("checked",!0),$("#luckysheetpivottablevaluecolrowshow label[for='luckysheetpivottablevaluecolrow1']").addClass("ui-state-active"),$("#luckysheetpivottablevaluecolrow").prop("checked",!1),$("#luckysheetpivottablevaluecolrowshow label[for='luckysheetpivottablevaluecolrow']").removeClass("ui-state-active"))):$("#luckysheetpivottablevaluecolrowshow").hide()},resetOrderby:function(e){let t=$("#luckysheet-modal-dialog-config-value .luckysheet-modal-dialog-slider-config-item").index(e);$("#luckysheet-modal-dialog-config-row, #luckysheet-modal-dialog-config-column").find(".luckysheet-modal-dialog-slider-config-item").each(function(){$(this).data("orderby")==t&&$(this).data("orderby","self")})},luckysheetsliderlistclearfilter:function(e){let t=e.parent(),l=t.data("index"),i={},a=this.origindata;t.data("rowhidden","").find(".luckysheet-slider-list-item-filtered").hide(),this.setDatatojsfile("selected",{},l),this.setDatatojsfile("rowhidden",null,l);let o=[];for(let e=0;e<a.length;e++)null==i[e]&&o.push([].concat(a[e]));this.celldata=o,this.refreshPivotTable(),$("#luckysheet-pivotTableFilter-menu, #luckysheet-pivotTableFilter-submenu").hide()},luckysheetsliderlistitemfilter:function(e){const t=x().filter;let l=e.parent(),i=l.offset(),a=$("#luckysheet-pivotTableFilter-menu"),o=$(window).height(),n=($(window).width(),l.data("index")),s=l.data("rowhidden");null==s||""==s?s={}:"string"==D(s)&&(s=JSON.parse(s)),$("body .luckysheet-cols-menu").hide(),$("#luckysheet-pivotTableFilter-menu, #luckysheet-pivotTableFilter-submenu").hide(),$("#luckysheet-pivotTableFilter-byvalue-input").val(""),$("#luckysheet-pivotTableFilter-bycondition").next().hide(),$("#luckysheet-pivotTableFilter-byvalue").next().show(),a.data("index",n),$("#luckysheet-pivotTableFilter-menu .luckysheet-pivotTableFilter-selected-input").hide().find("input").val(),$("#luckysheet-pivotTableFilter-selected span").data("type","0").data("type",null).text(t.filiterInputNone);let c=l.data("byconditiontype");if($("#luckysheet-pivotTableFilter-selected span").data("value",l.data("byconditionvalue")).data("type",c).text(l.data("byconditiontext")),"2"==c){let e=$("#luckysheet-pivotTableFilter-menu .luckysheet-pivotTableFilter-selected-input2").show().find("input");e.eq(0).val(l.data("byconditionvalue1")),e.eq(1).val(l.data("byconditionvalue2"))}else"1"==c&&$("#luckysheet-pivotTableFilter-menu .luckysheet-pivotTableFilter-selected-input").eq(0).show().find("input").val(l.data("byconditionvalue1"));$("#luckysheet-pivotTableFilter-byvalue-select").empty().html('<div style="width:100%;text-align:center;position:relative;top:45%;font-size: 14px;"> <div class="luckysheetLoaderGif"> </div> <span>'+t.filiterMoreDataTip+"</span></div>");let d={};$("#luckysheet-modal-dialog-pivotTable-list .luckysheet-modal-dialog-slider-list-item").not(l.get(0)).each(function(){let e=$(this).data("rowhidden");if(null==e||""==e)return!0;"string"==D(e)&&(e=JSON.parse(e));for(let t in e)d[t]=0});let u=this.origindata;setTimeout(function(){let e={},l={},a={},c={};for(let t=1;t<u.length;t++){if(t in d)continue;if(null==u[t])continue;let i=u[t][n];if(null!=i&&null!=i.ct&&"d"==i.ct.t){let a=R("YYYY-MM-DD",i.v),o=a.split("-")[0],n=a.split("-")[1],c=a.split("-")[2];o in e||(e[o]={}),n in e[o]||(e[o][n]={}),c in e[o][n]||(e[o][n][c]=0),e[o][n][c]++,t in s&&(l[o]=0,l[n]=0,l[c]=0)}else{let e,l;null==i||E(i.v)?(e=null,l=null):(e=i.v,l=i.m),e in a||(a[e]={}),l in a[e]||(a[e][l]=0),a[e][l]++,t in s&&(c[e+"#$$$#"+l]=0)}}let r=[];if(JSON.stringify(e).length>2)for(let i in e){let a,o=0,n="";for(let a in e[i]){let s,c=0,d="";for(let t in e[i][a]){let o,n,s=e[i][a][t];c+=s,o=Number(a)<10?"0"+Number(a):a,n=Number(t)<10?"0"+Number(t):t,d+=i in l&&a in l&&t in l?'<div class="day luckysheet-mousedown-cancel cf" data-check="false" title="'+i+"-"+o+"-"+n+'"><input class="luckysheet-mousedown-cancel" type="checkbox"/><label class="luckysheet-mousedown-cancel">'+t+'</label><span class="count luckysheet-mousedown-cancel">( '+s+" )</span></div>":'<div class="day luckysheet-mousedown-cancel cf" data-check="true" title="'+i+"-"+o+"-"+n+'"><input class="luckysheet-mousedown-cancel" type="checkbox" checked="checked"/><label class="luckysheet-mousedown-cancel">'+t+'</label><span class="count luckysheet-mousedown-cancel">( '+s+" )</span></div>"}o+=c,s=Number(a)<10?"0"+Number(a):a,n+=i in l&&a in l?'<div class="monthBox luckysheet-mousedown-cancel"><div class="month luckysheet-mousedown-cancel cf" data-check="false" title="'+i+"-"+s+'"><i class="fa fa-caret-right luckysheet-mousedown-cancel" aria-hidden="true"></i><input class="luckysheet-mousedown-cancel" type="checkbox"/><label class="luckysheet-mousedown-cancel">'+a+t.filiterMonthText+'</label><span class="count luckysheet-mousedown-cancel">( '+c+' )</span></div><div class="dayList luckysheet-mousedown-cancel">'+d+"</div></div>":'<div class="monthBox luckysheet-mousedown-cancel"><div class="month luckysheet-mousedown-cancel cf" data-check="true" title="'+i+"-"+s+'"><i class="fa fa-caret-right luckysheet-mousedown-cancel" aria-hidden="true"></i><input class="luckysheet-mousedown-cancel" type="checkbox" checked="checked"/><label class="luckysheet-mousedown-cancel">'+a+t.filiterMonthText+'</label><span class="count luckysheet-mousedown-cancel">( '+c+' )</span></div><div class="dayList luckysheet-mousedown-cancel">'+d+"</div></div>"}a=i in l?'<div class="yearBox luckysheet-mousedown-cancel"><div class="year luckysheet-mousedown-cancel cf" data-check="false" title="'+i+'"><i class="fa fa-caret-right luckysheet-mousedown-cancel" aria-hidden="true"></i><input class="luckysheet-mousedown-cancel" type="checkbox"/><label class="luckysheet-mousedown-cancel">'+i+t.filiterYearText+'</label><span class="count luckysheet-mousedown-cancel">( '+o+' )</span></div><div class="monthList luckysheet-mousedown-cancel">'+n+"</div></div>":'<div class="yearBox luckysheet-mousedown-cancel"><div class="year luckysheet-mousedown-cancel cf" data-check="true" title="'+i+'"><i class="fa fa-caret-right luckysheet-mousedown-cancel" aria-hidden="true"></i><input class="luckysheet-mousedown-cancel" type="checkbox" checked="checked"/><label class="luckysheet-mousedown-cancel">'+i+t.filiterYearText+'</label><span class="count luckysheet-mousedown-cancel">( '+o+' )</span></div><div class="monthList luckysheet-mousedown-cancel">'+n+"</div></div>",r.unshift(a)}if(JSON.stringify(a).length>2){let e=Object.keys(a);e=Y(e,!0);for(let l=0;l<e.length;l++){let i=e[l];for(let e in a[i]){let l,o;l=i+"#$$$#"+e=="null#$$$#null"?t.valueBlank:e,o=i+"#$$$#"+e in c?'<div class="textBox luckysheet-mousedown-cancel cf" data-check="false" data-filter="'+i+"#$$$#"+e+'" title="'+e+'"><input class="luckysheet-mousedown-cancel" type="checkbox"/><label class="luckysheet-mousedown-cancel">'+l+'</label><span class="luckysheet-mousedown-cancel count">( '+a[i][e]+" )</span></div>":'<div class="textBox luckysheet-mousedown-cancel cf" data-check="true" data-filter="'+i+"#$$$#"+e+'" title="'+e+'"><input class="luckysheet-mousedown-cancel" type="checkbox" checked="checked"/><label class="luckysheet-mousedown-cancel">'+l+'</label><span class="luckysheet-mousedown-cancel count">( '+a[i][e]+" )</span></div>",r.push(o)}}}$("#luckysheet-pivotTableFilter-byvalue-select").html("<div class='ListBox luckysheet-mousedown-cancel' style='max-height:"+(o-i.top-350)+"px;overflow-y:auto;overflow-x:hidden;'>"+r.join("")+"</div>")},1),C(a,i.left-250,i.top)},getSumTypeName:function(e){let t="";const l=x().pivotTable;return"SUM"==e?t=l.valueStatisticsSUM:"COUNT"==e?t=l.valueStatisticsCOUNT:"COUNTA"==e?t=l.valueStatisticsCOUNTA:"COUNTUNIQUE"==e?t=l.valueStatisticsCOUNTUNIQUE:"AVERAGE"==e?t=l.valueStatisticsAVERAGE:"MAX"==e?t=l.valueStatisticsMAX:"MIN"==e?t=l.valueStatisticsMIN:"MEDIAN"==e?t=l.valueStatisticsMEDIAN:"PRODUCT"==e?t=l.valueStatisticsPRODUCT:"STDEV"==e?t=l.valueStatisticsSTDEV:"STDEVP"==e?t=l.valueStatisticsSTDEVP:"let"==e?t=l.valueStatisticslet:"VARP"==e&&(t=l.valueStatisticsVARP),t},setDatatojsfile:function(e,t,l){let i=this,a=w(i.pivotSheetIndex);null==b.luckysheetfile[a].pivotTable&&(b.luckysheetfile[a].pivotTable={}),null==l?(b.luckysheetfile[a].pivotTable[e]=t,i[e]=t):(null==b.luckysheetfile[a].pivotTable.filterparm&&(b.luckysheetfile[a].pivotTable.filterparm={}),null==b.luckysheetfile[a].pivotTable.filterparm[l.toString()]&&(b.luckysheetfile[a].pivotTable.filterparm[l.toString()]={}),b.luckysheetfile[a].pivotTable.filterparm[l.toString()][e]=t,null==i.filterparm&&(i.filterparm={}),null==i.filterparm[l.toString()]&&(i.filterparm[l.toString()]={}),i.filterparm[l.toString()][e]=t)},createPivotTable:function(e){if(V()||!1===b.allowEdit)return;let t=b.currentSheetIndex;const l=x().pivotTable;if(V())return void alert(l.errorNotAllowEdit);if(b.luckysheet_select_save.length>1)return void c.info("",l.errorNotAllowMulti);if(0==b.luckysheet_select_save.length||b.luckysheet_select_save[0].row[0]==b.luckysheet_select_save[0].row[1]||b.luckysheet_select_save[0].column[0]==b.luckysheet_select_save[0].column[1])return void c.info("",l.errorSelectRange);let i=$.extend(!0,{},b.luckysheet_select_save[0]);m.addNewSheet(e,!0),this.getCellData(b.currentSheetIndex,t,i),this.setDatatojsfile("pivot_select_save",i),this.setDatatojsfile("pivotDataSheetIndex",t),this.initialPivotManage()},changePivotTable:function(e){const t=x().pivotTable;let l=b.luckysheetfile[w(e)].pivotTable.pivotDataSheetIndex;null!=w(l)?(this.getCellData(e),this.initialPivotManage(!0),this.refreshPivotTable()):c.info(t.errorIsDamage,"")},refreshPivotTable:function(e=!0){let t=this,l={};l.pivotTable=c,l.data=d.deepCopyFlowData(b.flowdata),t.storePivotTableParam();let i=t.dataHandler(t.column,t.row,t.values,t.showType,t.celldata);t.setDatatojsfile("pivotDatas",i);let a=$.extend(!0,[],m.nulldata),o=a,n=0,s=0;if(0==i.length)t.setDatatojsfile("drawPivotTable",!0),t.setDatatojsfile("pivotTableBoundary",[12,6]);else{t.setDatatojsfile("drawPivotTable",!1),t.setDatatojsfile("pivotTableBoundary",[i.length,i[0].length]);let e=i.length,l=i[0].length;n=e-a.length,s=l-a[0].length,o=A(a,n+20,s+10,!0);for(let t=0;t<e;t++){let e=[].concat(o[t]);for(let a=0;a<l;a++){let l="";null!=i[t]&&null!=i[t][a]&&(l=j(t,a,i)),e[a]=l}o[t]=e}}l.type="pivotTable_change",l.curdata=$.extend(!0,[],o),l.sheetIndex=b.currentSheetIndex;let c=t.getPivotTableData();l.pivotTablecur=c,b.clearjfundo&&(b.jfundo.length=0,b.jfredo.push(l)),u(),b.clearjfundo=!1,n>0||s>0?G(o[0].length,o.length,o,null,b.luckysheet_select_save,"datachangeAll",void 0,void 0,e):(H(o,b.luckysheet_select_save,{},null,e),J()),b.clearjfundo=!0},drawPivotTable:!0,pivotTableBoundary:[12,6],pivotclick:function(e,t,l){null==l&&(l=b.currentSheetIndex);let i=b.luckysheetfile[w(l)];if(!i.isPivotTable)return;let a=i.pivotTable.pivotDataSheetIndex;if(null==w(a))return;let o=$("#luckysheet-modal-dialog-slider-pivot"),n=this.isPivotRange(e,t);if(n&&o.is(":hidden")){if(!te(l,"usePivotTablereports",!1))return;o.show(),y(),$("#luckysheet-sta-content").css("padding-right",260)}else!n&&o.is(":visible")&&(o.hide(),y(),$("#luckysheet-sta-content").css("padding-right",10))},isPivotRange:function(e,t){let l=this;if(b.luckysheetcurrentisPivotTable)return e<l.pivotTableBoundary[0]&&t<l.pivotTableBoundary[1]},storePivotTableParam:function(){let e=[],t=[],l=[],i=[];$("#luckysheet-modal-dialog-config-filter .luckysheet-modal-dialog-slider-config-item").each(function(){let e={};e.index=$(this).data("index"),e.name=$(this).data("name"),e.fullname=$(this).find(".luckysheet-modal-dialog-slider-config-item-txt").text(),l.push(e)}),$("#luckysheet-modal-dialog-config-row .luckysheet-modal-dialog-slider-config-item").each(function(){let e={};e.index=$(this).data("index"),e.name=$(this).data("name"),e.fullname=$(this).find(".luckysheet-modal-dialog-slider-config-item-txt").text(),e.order=$(this).data("order"),e.orderby=$(this).data("orderby"),e.stastic=$(this).data("stastic"),t.push(e)}),$("#luckysheet-modal-dialog-config-column .luckysheet-modal-dialog-slider-config-item").each(function(){let t={};t.index=$(this).data("index"),t.name=$(this).data("name"),t.fullname=$(this).find(".luckysheet-modal-dialog-slider-config-item-txt").text(),t.order=$(this).data("order"),t.orderby=$(this).data("orderby"),t.stastic=$(this).data("stastic"),e.push(t)}),$("#luckysheet-modal-dialog-config-value .luckysheet-modal-dialog-slider-config-item").each(function(){let e={};e.index=$(this).data("index"),e.name=$(this).data("name"),e.fullname=$(this).find(".luckysheet-modal-dialog-slider-config-item-txt").text(),e.sumtype=$(this).data("sumtype"),e.nameindex=$(this).data("nameindex"),i.push(e)}),this.setDatatojsfile("column",e),this.setDatatojsfile("row",t),this.setDatatojsfile("filter",l),this.setDatatojsfile("values",i);let a=$("#luckysheetpivottablevaluecolrow:checked, #luckysheetpivottablevaluecolrow1:checked").val();this.setDatatojsfile("showType","0"==a?"row":"column");let o=this.getPivotTableData();delete o.pivotDatas,g.saveParam("all",this.pivotSheetIndex,o,{k:"pivotTable"})},getPivotTableData:function(e){null==e&&(e=this.pivotSheetIndex);let t=w(e),l=b.luckysheetfile[t].pivotTable;return l="object"==D(l)?$.extend(!0,{},b.luckysheetfile[t].pivotTable):new Function("return "+l)()},addValuesToTitle:function(e,t){let l=e.length*t.length,i=e[0].length+1,a=[];if(0==e.length&&t.length>0){for(let e=0;e<t.length;e++)a.push(t[e].fullname);return a}if(0==t.length&&e.length>0)return e;for(let o=0;o<l;o++){a[o]=new Array(i);for(let l=0;l<i-1;l++)a[o][l]=e[Math.floor(o/t.length)][l];a[o][i-1]=t[o%t.length].fullname}return a},initialPivotManage:function(e){let t=this;const l=x(),i=l.pivotTable,a=l.button,o=l.filter;if(t.initial){t.initial=!1,$("body").append(ee()),$("#luckysheet-modal-dialog-slider-close").click(function(){$("#luckysheet-modal-dialog-slider-pivot").hide(),y()}),$("body").append(S(X,{id:"luckysheet-data-pivotTable-selection",addclass:"luckysheet-data-pivotTable-selection",title:i.titleSelectionDataRange,content:'<input id="luckysheet-pivotTable-range-selection-input" class="luckysheet-datavisual-range-container" style="font-size: 14px;padding:5px;max-width:none;" spellcheck="false" aria-label="'+i.titleDataRange+'" placeholder="'+i.titleDataRange+'">',botton:'<button id="luckysheet-pivotTable-selection-confirm" class="btn btn-primary">'+a.confirm+'</button><button class="btn btn-default luckysheet-model-close-btn">'+a.cancel+"</button>"})),$("body").append(S(W(),{menuid:"pivotTableFilter"})),$("body").append(S(Q(),{menuid:"pivotTableFilter"})),$("body").append(Z()),$("body").append(K()),$("#luckysheet-pivotTableFilter-orderby-asc").remove(),$("#luckysheet-pivotTableFilter-orderby-desc").next().remove(),$("#luckysheet-pivotTableFilter-orderby-desc").remove(),$("#luckysheet-pivotTableFilter-orderby-color").next().remove(),$("#luckysheet-pivotTableFilter-orderby-color").remove(),$("#luckysheetpivottablevaluecolrow, #luckysheetpivottablevaluecolrow1").checkboxradio({icon:!1}).change(function(){t.refreshPivotTable()});let e=null;$("#luckysheet-pivotTableFilter-menu").mouseover(function(){clearTimeout(e),e=setTimeout(function(){$("#luckysheet-pivotTableFilter-submenu").hide()},500)}),$(document).off("click.ptFilterCheckbox1").on("click.ptFilterCheckbox1","#luckysheet-pivotTableFilter-byvalue-select .textBox",function(){"true"==$(this).attr("data-check")?($(this).attr("data-check","false"),$(this).find("input[type='checkbox']").removeAttr("checked")):($(this).attr("data-check","true"),$(this).find("input[type='checkbox']").prop("checked",!0))}),$(document).off("click.ptFilterCheckbox2").on("click.ptFilterCheckbox2","#luckysheet-pivotTableFilter-byvalue-select .year",function(){"true"==$(this).attr("data-check")?($(this).attr("data-check","false"),$(this).parents(".yearBox").find(".month").attr("data-check","false"),$(this).parents(".yearBox").find(".day").attr("data-check","false"),$(this).parents(".yearBox").find("input[type='checkbox']").removeAttr("checked")):($(this).attr("data-check","true"),$(this).parents(".yearBox").find(".month").attr("data-check","true"),$(this).parents(".yearBox").find(".day").attr("data-check","true"),$(this).parents(".yearBox").find("input[type='checkbox']").prop("checked",!0))}),$(document).off("click.ptFilterCheckbox3").on("click.ptFilterCheckbox3","#luckysheet-pivotTableFilter-byvalue-select .month",function(){"true"==$(this).attr("data-check")?($(this).attr("data-check","false"),$(this).parents(".monthBox").find(".day").attr("data-check","false"),$(this).parents(".monthBox").find("input[type='checkbox']").removeAttr("checked")):($(this).attr("data-check","true"),$(this).parents(".monthBox").find(".day").attr("data-check","true"),$(this).parents(".monthBox").find("input[type='checkbox']").prop("checked",!0));let e=!0;$(this).parents(".yearBox").find(".day").each(function(t,l){"true"==$(l).attr("data-check")||(e=!1)}),e?($(this).parents(".yearBox").find(".year").attr("data-check","true"),$(this).parents(".yearBox").find(".year input[type='checkbox']").prop("checked",!0)):($(this).parents(".yearBox").find(".year").attr("data-check","false"),$(this).parents(".yearBox").find(".year input[type='checkbox']").removeAttr("checked"))}),$(document).off("click.ptFilterCheckbox4").on("click.ptFilterCheckbox4","#luckysheet-pivotTableFilter-byvalue-select .day",function(){"true"==$(this).attr("data-check")?($(this).attr("data-check","false"),$(this).find("input[type='checkbox']").removeAttr("checked")):($(this).attr("data-check","true"),$(this).find("input[type='checkbox']").prop("checked",!0));let e=!0;$(this).parents(".monthBox").find(".day").each(function(t,l){"true"==$(l).attr("data-check")||(e=!1)}),e?($(this).parents(".monthBox").find(".month").attr("data-check","true"),$(this).parents(".monthBox").find(".month input[type='checkbox']").prop("checked",!0)):($(this).parents(".monthBox").find(".month").attr("data-check","false"),$(this).parents(".monthBox").find(".month input[type='checkbox']").removeAttr("checked"));let t=!0;$(this).parents(".yearBox").find(".day").each(function(e,l){"true"==$(l).attr("data-check")||(t=!1)}),t?($(this).parents(".yearBox").find(".year").attr("data-check","true"),$(this).parents(".yearBox").find(".year input[type='checkbox']").prop("checked",!0)):($(this).parents(".yearBox").find(".year").attr("data-check","false"),$(this).parents(".yearBox").find(".year input[type='checkbox']").removeAttr("checked"))}),$(document).off("click.ptFilterYearDropdown").on("click.ptFilterYearDropdown","#luckysheet-pivotTableFilter-byvalue-select .yearBox .fa-caret-right",function(){let e=$(this).parents(".luckysheet-mousedown-cancel");e.hasClass("year")&&$(this).parents(".yearBox").find(".monthList").slideToggle(),e.hasClass("month")&&$(this).parents(".monthBox").find(".dayList").slideToggle()}),$("#luckysheet-pivotTableFilter-byvalue-btn-all").click(function(){$("#luckysheet-pivotTableFilter-byvalue-select .ListBox input[type='checkbox']").prop("checked",!0),$("#luckysheet-pivotTableFilter-byvalue-select .ListBox input[type='checkbox']").parents(".luckysheet-mousedown-cancel").attr("data-check","true")}),$("#luckysheet-pivotTableFilter-byvalue-btn-contra").click(function(){$("#luckysheet-pivotTableFilter-byvalue-select .ListBox input[type='checkbox']").each(function(e,t){$(t).is(":checked")?($(t).removeAttr("checked"),$(t).parents(".luckysheet-mousedown-cancel").attr("data-check","false")):($(t).prop("checked",!0),$(t).parents(".luckysheet-mousedown-cancel").attr("data-check","true"))}),$("#luckysheet-pivotTableFilter-byvalue-select .ListBox .monthBox").each(function(e,t){let l=!0;$(t).find(".day input[type='checkbox']").each(function(e,t){$(t).is(":checked")||(l=!1)}),l?($(t).find(".month input[type='checkbox']").prop("checked",!0),$(t).attr("data-check","true")):($(t).find(".month input[type='checkbox']").removeAttr("checked"),$(t).attr("data-check","false"))}),$("#luckysheet-pivotTableFilter-byvalue-select .ListBox .yearBox").each(function(e,t){let l=!0;$(t).find(".day input[type='checkbox']").each(function(e,t){$(t).is(":checked")||(l=!1)}),l?($(t).find(".year input[type='checkbox']").prop("checked",!0),$(t).attr("data-check","true")):($(t).find(".year input[type='checkbox']").removeAttr("checked"),$(t).attr("data-check","false"))})}),$("#luckysheet-pivotTableFilter-byvalue-btn-clear").click(function(){$("#luckysheet-pivotTableFilter-byvalue-select .ListBox input[type='checkbox']").removeAttr("checked"),$("#luckysheet-pivotTableFilter-byvalue-select .ListBox input[type='checkbox']").parents(".luckysheet-mousedown-cancel").attr("data-check","false")}),$("#luckysheet-pivotTableFilter-byvalue-input").on("input propertychange",function(){let e=$(this).val().toString();if($("#luckysheet-pivotTableFilter-byvalue-select .ListBox .luckysheet-mousedown-cancel").show(),""!=e){$("#luckysheet-pivotTableFilter-byvalue-select .ListBox input[type='checkbox']").each(function(t,l){let i=$(l).parents(".luckysheet-mousedown-cancel");if(i.hasClass("day")){let t=$(l).siblings("label").text().toString(),i=$(l).parents(".monthBox").find(".month label").text().toString();if(-1==($(l).parents(".yearBox").find(".year label").text().toString()+"-"+i+"-"+t).indexOf(e)){$(l).parents(".day").hide(),0==$(l).parents(".dayList").find(".day:visible").length&&$(l).parents(".monthBox").find(".month").hide(),0==$(l).parents(".monthList").find(".day:visible").length&&$(l).parents(".yearBox").find(".year").hide()}}if(i.hasClass("textBox")){-1==$(l).siblings("label").text().toString().indexOf(e)&&$(l).parents(".textBox").hide()}})}}),$("#luckysheet-pivotTableFilter-bycondition, #luckysheet-pivotTableFilter-byvalue").click(function(){let e=$(this);e.next().slideToggle(200),setTimeout(function(){"luckysheet-pivotTableFilter-bycondition"==e.attr("id")&&$("#luckysheet-pivotTableFilter-bycondition").next().is(":visible")&&$("#luckysheet-pivotTableFilter-selected span").text()!=o.filiterInputNone&&$("#luckysheet-pivotTableFilter-byvalue").next().slideUp(200),e.is($("#luckysheet-pivotTableFilter-bycondition"))&&$("#luckysheet-pivotTableFilter-bycondition").next().is(":hidden")&&$("#luckysheet-pivotTableFilter-byvalue").next().is(":hidden")&&$("#luckysheet-pivotTableFilter-byvalue").next().slideDown(200)},300)}),$("#luckysheet-pivotTableFilter-cancel").click(function(){$("#luckysheet-pivotTableFilter-menu, #luckysheet-pivotTableFilter-submenu").hide()}),$("#luckysheet-pivotTableFilter-selected").click(function(){let t=$(this).offset(),l=$("#luckysheet-pivotTableFilter-submenu");l.hide();let i=$(window).height(),a=$(window).width(),o=l.width(),n=(l.height(),t.top),s=t.left,c=i-t.top-20;t.left+o>a&&(s=t.left-o),t.top>i/2&&((n=i-t.top)<0&&(n=0),c=t.top-20),l.css({top:n,left:s,height:c}).show(),clearTimeout(e)}),$("#luckysheet-pivotTableFilter-submenu").mouseover(function(){clearTimeout(e)}).find(".luckysheet-cols-menuitem").click(function(e){$("#luckysheet-pivotTableFilter-selected span").html($(this).find(".luckysheet-cols-menuitem-content").text()).data("value",$(this).data("value")),$("#luckysheet-pivotTableFilter-menu .luckysheet-pivotTableFilter-selected-input").hide(),"2"==$(this).data("type")?($("#luckysheet-pivotTableFilter-selected span").data("type","2"),$("#luckysheet-pivotTableFilter-menu .luckysheet-pivotTableFilter-selected-input2").show()):"0"==$(this).data("type")?$("#luckysheet-pivotTableFilter-selected span").data("type","0"):($("#luckysheet-pivotTableFilter-selected span").data("type","1"),$("#luckysheet-pivotTableFilter-menu .luckysheet-pivotTableFilter-selected-input").eq(0).show(),"dateequal"==$(this).attr("data-value")||"datelessthan"==$(this).attr("data-value")||"datemorethan"==$(this).attr("data-value")?$("#luckysheet-pivotTableFilter-menu .luckysheet-pivotTableFilter-selected-input input").prop("type","date"):$("#luckysheet-pivotTableFilter-menu .luckysheet-pivotTableFilter-selected-input input").prop("type","text")),$("#luckysheet-pivotTableFilter-byvalue").next().slideUp(),$("#luckysheet-pivotTableFilter-submenu").hide()}),$("#luckysheet-modal-dialog-pivotTable-list").on("click"," .luckysheet-slider-list-item-filter",function(e){return t.luckysheetsliderlistitemfilter($(this)),e.stopPropagation(),!1}),$("#luckysheet-modal-dialog-pivotTable-list").on("click"," .luckysheet-slider-list-item-filtered",function(e){return t.luckysheetsliderlistclearfilter($(this).next()),e.stopPropagation(),!1}),$("#luckysheet-dialog-pivotTable-range-seleted").click(function(){$("#luckysheet-modal-dialog-slider-pivot").hide(),y();let e=$("#luckysheet-data-pivotTable-selection"),l=e.outerHeight(),i=e.outerWidth(),a=$(window).width(),o=$(window).height(),n=$(document).scrollLeft(),s=$(document).scrollTop();$("#luckysheet-data-pivotTable-selection").css({left:(a+n-i)/2,top:(o+s-l)/4}).show(),t.jgridCurrentPivotInput=$("#luckysheet-dialog-pivotTable-range").html(),$("#luckysheet-pivotTable-range-selection-input").val(t.jgridCurrentPivotInput),t.luckysheet_pivotTable_select_state=!0}),$("#luckysheet-pivotTableFilter-initial").click(function(){$("#luckysheet-modal-dialog-pivotTable-list .luckysheet-slider-list-item-filtered").hide(),$("#luckysheet-modal-dialog-pivotTable-list .luckysheet-modal-dialog-slider-list-item").data("rowhidden",""),$("#luckysheet-pivotTableFilter-menu, #luckysheet-pivotTableFilter-submenu").hide(),$("#luckysheet-pivotTableFilter-menu .luckysheet-pivotTableFilter-selected-input").hide().find("input").val(),$("#luckysheet-pivotTableFilter-selected span").data("type","0").data("type",null).text(o.filiterInputNone),t.setDatatojsfile("filterparm",null),t.celldata=t.origindata,t.refreshPivotTable()}),$("#luckysheet-modal-dialog-config-row, #luckysheet-modal-dialog-config-column").on("click",".luckysheet-modal-dialog-slider-config-item-icon",function(e){let t=$(e.target).closest(".luckysheet-modal-dialog-slider-config-item"),l=t.data("index"),i=t.offset(),a=t.data("order"),o=t.data("orderby"),n=t.data("stastic");null==a&&(a="default");let s='<option value="self">'+t.find(".luckysheet-modal-dialog-slider-config-item-txt").data("name")+"</option>";return $("#luckysheet-modal-dialog-config-value .luckysheet-modal-dialog-slider-config-item").each(function(e){s+='<option value="'+e+'">'+$(this).find(".luckysheet-modal-dialog-slider-config-item-txt").text()+"</option>"}),$("#luckysheet-pivotTable-config-option-orderby").empty().html(s),null==o&&(o="self"),null==n&&(n="1"),$("#luckysheet-pivotTable-config-option-order").val(a).data("index",l),$("#luckysheet-pivotTable-config-option-orderby").val(o).data("index",l),$("#luckysheet-pivotTable-config-option-stastic").val(n).data("index",l),_($("#luckysheet-pivotTable-config-option"),i.left+t.outerWidth(),i.top-13,"rightbottom"),e.stopPropagation(),!1}),$("#luckysheet-pivotTable-config-option-order,#luckysheet-pivotTable-config-option-orderby,#luckysheet-pivotTable-config-option-stastic").change(function(){let e=$(this),l=e.data("index");$("#luckysheet-modal-dialog-config-row, #luckysheet-modal-dialog-config-column").find(".luckysheet-modal-dialog-slider-config-item").each(function(){$(this).data("index")==l&&$(this).data(e.attr("id").replace("luckysheet-pivotTable-config-option-",""),e.val())}),t.refreshPivotTable()}),$("#luckysheet-modal-dialog-config-value").on("click",".luckysheet-modal-dialog-slider-config-item-icon",function(e){let l=$(e.target).closest(".luckysheet-modal-dialog-slider-config-item"),i=l.data("index"),a=l.offset(),o=l.data("sumtype"),n=t.pivot_data_type[i.toString()];null==o&&(o="num"==n?"SUM":"COUNTA");let s=$("#luckysheet-pivotTable-config-option-sumtype");return s.find(".luckysheet-submenu-arrow").hide(),s.find(".luckysheet-cols-menuitem[sumtype='"+o+"'] .luckysheet-submenu-arrow").css("display","inline"),s.data("item",l),_(s,a.left+l.outerWidth(),a.top-13,"rightbottom"),e.stopPropagation(),!1}),$("#luckysheet-pivotTable-config-option-sumtype .luckysheet-cols-menuitem").click(function(){let e=$("#luckysheet-pivotTable-config-option-sumtype").data("item"),l=$(this).attr("sumtype");e.data("sumtype",$(this).attr("sumtype"));let i=t.getSumTypeName(l)+":"+e.data("name");e.attr("title",i).find(".luckysheet-modal-dialog-slider-config-item-txt").html(i),$("#luckysheet-pivotTable-config-option-sumtype").hide(),t.refreshPivotTable()}),$("#luckysheet-modal-dialog-config-filter").on("click",".luckysheet-modal-dialog-slider-config-item-icon",function(e){let l=$(e.target).closest(".luckysheet-modal-dialog-slider-config-item").data("index");return t.luckysheetsliderlistitemfilter($("#luckysheet-modal-dialog-pivotTable-list .luckysheet-modal-dialog-slider-list-item").eq(l).find(".luckysheet-slider-list-item-filter")),e.stopPropagation(),!1}),$("#luckysheet-pivotTableFilter-confirm").click(function(){let e=$("#luckysheet-pivotTableFilter-menu").data("index"),l={};$("#luckysheet-modal-dialog-pivotTable-list .luckysheet-modal-dialog-slider-list-item").each(function(){let t=$(this),i=t.data("rowhidden");if(t.data("index")!=e){if(null==i||""==i)return!0;"string"==D(i)&&(i=JSON.parse(i));for(let e in i)l[e]=0}});let i=t.origindata,a={},n={},s={};if($("#luckysheet-pivotTableFilter-bycondition").next().is(":visible")&&$("#luckysheet-pivotTableFilter-byvalue").next().is(":hidden")&&"null"!=$("#luckysheet-pivotTableFilter-selected span").data("value")){let t=$("#luckysheet-pivotTableFilter-selected span"),a=t.data("type"),o=t.data("value");if(s.value=o,s.text=t.text(),"0"==a)s.type="0";else if("2"==a){let e=$("#luckysheet-pivotTableFilter-menu .luckysheet-pivotTableFilter-selected-input2 input");s.type="2",s.value1=e.eq(0).val(),s.value2=e.eq(1).val()}else s.type="1",s.value1=$("#luckysheet-pivotTableFilter-menu .luckysheet-pivotTableFilter-selected-input").eq(0).find("input").val();for(let t=1;t<i.length;t++){if(t in l)continue;if(null==i[t])continue;let a=i[t][e];if("cellnull"==o)null==a||E(a.v)||(n[t]=0);else if("cellnonull"==o)(null==a||E(a.v))&&(n[t]=0);else if("textinclude"==o){let e=s.value1;null==a||E(a.v)?n[t]=0:-1==a.m.indexOf(e)&&(n[t]=0)}else if("textnotinclude"==o){let e=s.value1;null==a||E(a.v)||a.m.indexOf(e)>-1&&(n[t]=0)}else if("textstart"==o){let e=s.value1,l=e.length;null==a||E(a.v)?n[t]=0:a.m.substr(0,l)!=e&&(n[t]=0)}else if("textend"==o){let e=s.value1,l=e.length;null==a||E(a.v)?n[t]=0:(l>a.m.length||a.m.substr(a.m.length-l,l)!=e)&&(n[t]=0)}else if("textequal"==o){let e=s.value1;null==a||E(a.v)?n[t]=0:a.m!=e&&(n[t]=0)}else if("dateequal"==o){let e=q(s.value1)[2];null==a||E(a.v)?n[t]=0:null!=a.ct&&"d"==a.ct.t?parseInt(a.v)!=e&&(n[t]=0):n[t]=0}else if("datelessthan"==o){let e=q(s.value1)[2];null==a||E(a.v)?n[t]=0:null!=a.ct&&"d"==a.ct.t?parseInt(a.v)>=e&&(n[t]=0):n[t]=0}else if("datemorethan"==o){let e=q(s.value1)[2];null==a||E(a.v)?n[t]=0:null!=a.ct&&"d"==a.ct.t?parseInt(a.v)<=e&&(n[t]=0):n[t]=0}else if("morethan"==o){let e=parseFloat(s.value1);null==a||E(a.v)?n[t]=0:null!=a.ct&&"n"==a.ct.t?a.v<=e&&(n[t]=0):n[t]=0}else if("moreequalthan"==o){let e=parseFloat(s.value1);null==a||E(a.v)?n[t]=0:null!=a.ct&&"n"==a.ct.t?a.v<e&&(n[t]=0):n[t]=0}else if("lessthan"==o){let e=parseFloat(s.value1);null==a||E(a.v)?n[t]=0:null!=a.ct&&"n"==a.ct.t?a.v>=e&&(n[t]=0):n[t]=0}else if("lessequalthan"==o){let e=parseFloat(s.value1);null==a||E(a.v)?n[t]=0:null!=a.ct&&"n"==a.ct.t?a.v>e&&(n[t]=0):n[t]=0}else if("equal"==o){let e=parseFloat(s.value1);null==a||E(a.v)?n[t]=0:null!=a.ct&&"n"==a.ct.t?a.v!=e&&(n[t]=0):n[t]=0}else if("noequal"==o){let e=parseFloat(s.value1);null==a||E(a.v)?n[t]=0:null!=a.ct&&"n"==a.ct.t?a.v==e&&(n[t]=0):n[t]=0}else if("include"==o){let e,l,i=parseFloat(s.value1),o=parseFloat(s.value2);i<o?(e=i,l=o):(l=i,e=o),null==a||E(a.v)?n[t]=0:null!=a.ct&&"n"==a.ct.t?(a.v<e||a.v>l)&&(n[t]=0):n[t]=0}else if("noinclude"==o){let e,l,i=parseFloat(s.value1),o=parseFloat(s.value2);i<o?(e=i,l=o):(l=i,e=o),null==a||E(a.v)?n[t]=0:null!=a.ct&&"n"==a.ct.t?a.v>=e&&a.v<=l&&(n[t]=0):n[t]=0}}}else{$("#luckysheet-pivotTableFilter-byvalue-select .ListBox input[type='checkbox']").each(function(e,t){if($(t).is(":visible")&&$(t).is(":checked"))return!0;if($(t).closest(".day").length>0){let e=$(t).siblings("label").text();Number(e)<10&&(e="0"+e);let l=$(t).closest(".monthBox").find(".month label").text().replace(o.filiterMonthText,"");Number(l)<10&&(l="0"+l);let i=$(t).closest(".yearBox").find(".year label").text().replace(o.filiterYearText,""),n=o.filterDateFormatTip+"#$$$#"+i+"-"+l+"-"+e;a[n]="1"}if($(t).closest(".textBox").length>0){let e=$(t).closest(".textBox").data("filter");a[e]="1"}});for(let t=1;t<i.length;t++){if(t in l)continue;if(null==i[t])continue;let s,c=i[t][e];if(null==c||E(c.v))s="null#$$$#null";else if(null!=c.ct&&"d"==c.ct.t){let e=R("YYYY-MM-DD",c.v);s=o.filterDateFormatTip+"#$$$#"+e}else s=c.v+"#$$$#"+c.m;s in a&&(n[t]=0)}}let c=$("#luckysheet-modal-dialog-pivotTable-list .luckysheet-modal-dialog-slider-list-item").eq(e);$("#luckysheet-pivotTableFilter-byvalue-select .ListBox input[type='checkbox']:visible:checked").length<$("#luckysheet-pivotTableFilter-byvalue-select .ListBox input[type='checkbox']:visible").length||$("#luckysheet-pivotTableFilter-byvalue-input").val().length>0||$("#luckysheet-pivotTableFilter-bycondition").next().is(":visible")&&$("#luckysheet-pivotTableFilter-byvalue").next().is(":hidden")&&"null"!=$("#luckysheet-pivotTableFilter-selected span").data("value")?(c.data("rowhidden",JSON.stringify(n)).find(".luckysheet-slider-list-item-filtered").show(),t.setDatatojsfile("rowhidden",n,e),null!=s&&(c.data("byconditionvalue",s.value).data("byconditiontype",s.type).data("byconditiontext",s.text),null!=s.value1&&c.data("byconditionvalue1",s.value1),null!=s.value2&&c.data("byconditionvalue2",s.value2),t.setDatatojsfile("caljs",s,e))):(c.data("rowhidden","").find(".luckysheet-slider-list-item-filtered").hide(),t.setDatatojsfile("rowhidden",null,e));let d=[];for(let e=0;e<i.length;e++)e in n||e in l||d.push([].concat(i[e]));t.celldata=d,t.refreshPivotTable(),$("#luckysheet-pivotTableFilter-menu, #luckysheet-pivotTableFilter-submenu").hide(),u()}),$("#luckysheet-data-pivotTable-selection .luckysheet-model-close-btn, #luckysheet-data-pivotTable-selection .luckysheet-modal-dialog-title-close").click(function(){$("#luckysheet-modal-dialog-slider-pivot").show(),y(),$("#luckysheet-cell-main .luckysheet-pivotTable-selection-set div").show(),$("#luckysheet-data-pivotTable-selection").hide(),m.changeSheetExec(t.pivotSheetIndex),t.luckysheet_pivotTable_select_state=!1,u()}),$("#luckysheet-pivotTable-selection-confirm").click(function(){let e=$("#luckysheet-pivotTable-range-selection-input"),l=e.val();if(0==$.trim(l).length||$.trim(l).toUpperCase()==t.jgridCurrentPivotInput.toUpperCase())return e.val(t.jgridCurrentPivotInput),void $("#luckysheet-data-pivotTable-selection .luckysheet-model-close-btn").click();{let a=l.split("!"),o="",n="",s=-1;if(a.length>1){o=a[0],n=a[1];for(let e in b.luckysheetfile)if(o==b.luckysheetfile[e].name){s=b.luckysheetfile[e].index;break}-1==s&&(s=0)}else{let e=w(b.currentSheetIndex);o=b.luckysheetfile[e].name,s=b.luckysheetfile[e].index,n=a[0]}if(b.luckysheetfile[w(s)].isPivotTable)return V()?alert(i.errorNotAllowPivotData):c.info("",i.errorNotAllowPivotData),void e.val(t.jgridCurrentPivotInput);if(-1==n.indexOf(":"))return V()?alert(i.errorSelectionRange):c.info("",i.errorSelectionRange),void e.val(t.jgridCurrentPivotInput);n=n.split(":");let d=[],r=[];if(d[0]=parseInt(n[0].replace(/[^0-9]/g,""))-1,d[1]=parseInt(n[1].replace(/[^0-9]/g,""))-1,d[0]>d[1])return V()?alert(i.errorSelectionRange):c.info("",i.errorSelectionRange),void e.val(t.jgridCurrentPivotInput);if(r[0]=B(n[0].replace(/[^A-Za-z]/g,"")),r[1]=B(n[1].replace(/[^A-Za-z]/g,"")),r[0]>r[1])return V()?alert(i.errorSelectionRange):c.info(i.errorSelectionRange),void e.val(t.jgridCurrentPivotInput);m.changeSheetExec(t.pivotSheetIndex),t.setDatatojsfile("pivot_select_save",{row:d,column:r}),t.setDatatojsfile("pivotDataSheetIndex",s),t.getCellData(t.pivotSheetIndex,s,{row:d,column:r}),t.initialPivotManage(),$("#luckysheet-dialog-pivotTable-range").html(l),$("#luckysheet-modal-dialog-slider-pivot").show(),$("#luckysheet-data-pivotTable-selection").hide(),t.luckysheet_pivotTable_select_state=!1,t.refreshPivotTable(),y(),u()}}),$("#luckysheet-modal-dialog-slider-pivot").on("mousedown",".luckysheet-slider-list-item-name, .luckysheet-modal-dialog-slider-config-item-txt",function(e){let l=$(e.target);t.movestate=!0,t.movesave.obj=l.parent(),t.movesave.name=l.data("name"),t.movesave.containerid=l.parent().parent().attr("id"),t.movesave.index=l.data("index"),0==$("#luckysheet-modal-dialog-slider-pivot-move").length&&$("body").append('<div id="luckysheet-modal-dialog-slider-pivot-move">'+t.movesave.name+"</div>"),t.movesave.width=$("#luckysheet-modal-dialog-slider-pivot-move").outerWidth(),t.movesave.height=$("#luckysheet-modal-dialog-slider-pivot-move").outerHeight(),$("#luckysheet-modal-dialog-pivotTable-list, #luckysheet-modal-dialog-config-filter, #luckysheet-modal-dialog-config-row, #luckysheet-modal-dialog-config-column, #luckysheet-modal-dialog-config-value").css("cursor","default")}),$("#luckysheet-modal-dialog-config-filter, #luckysheet-modal-dialog-config-row, #luckysheet-modal-dialog-config-column, #luckysheet-modal-dialog-config-value").mousemove(function(e){if(t.movestate){0==t.moveitemposition.length&&(t.moveitemposition=[0],$(this).find(".luckysheet-modal-dialog-slider-config-item").each(function(e){let l=$(this).outerHeight();t.moveitemposition.push(t.moveitemposition[e]+l+2)}),$(this).append('<div id="luckysheet-modal-dialog-config-order-help" style="position:absolute;height:3px;width:100%;background:#007ACC;z-index:1;pointer-events: none;user-select:none;"></div>')),$("#luckysheet-modal-dialog-slider-pivot-move").css({background:"#FD8585",color:"#fff",border:"1px solid #FD7070"});event.pageX;let e=event.pageY,l=$(this),i=e-l.offset().top+l.scrollTop(),a=t.moveitemposition,o=z(a,i);-1==o?$("#luckysheet-modal-dialog-config-order-help").css({top:a[a.length-1]}):i-a[o-1]>(a[o]-a[o-1])/2?$("#luckysheet-modal-dialog-config-order-help").css({top:a[o]}):$("#luckysheet-modal-dialog-config-order-help").css({top:a[o-1]})}}).mouseleave(function(){t.movestate&&($("#luckysheet-modal-dialog-slider-pivot-move").css({background:"#fff",color:"#000",border:"1px dotted #000"}),t.moveitemposition=[],$("#luckysheet-modal-dialog-config-order-help").remove())}).mouseup(function(e){if(t.movestate){let l,a=$(this);if(t.movesave.containerid==a.attr("id"))l=t.movesave.obj.clone();else{let e=t.movesave.name,o="",n="";if("luckysheet-modal-dialog-config-value"==a.attr("id")){"num"==t.pivot_data_type[t.movesave.index.toString()]?(e=i.valueStatisticsSUM+":"+e,o="data-sumtype='SUM'",n="data-nameindex='0'"):(e=i.valueStatisticsCOUNTA+":"+e,o="data-sumtype='COUNTA'",n="data-nameindex='0'"),$("#luckysheet-modal-dialog-config-value").find(".luckysheet-modal-dialog-slider-config-item").each(function(){if($(this).find(".luckysheet-modal-dialog-slider-config-item-txt").text()==e){let t=parseFloat($(this).data("nameindex"))+1;return e+=t.toString(),$(this).data("nameindex",t),!1}})}l='<div title="'+e+'" class="luckysheet-modal-dialog-slider-config-item" '+n+" "+o+' data-index="'+t.movesave.index+'" data-name="'+t.movesave.name+'"><div class="luckysheet-modal-dialog-slider-config-item-txt" '+n+" "+o+' data-index="'+t.movesave.index+'" data-name="'+t.movesave.name+'">'+e+'</div><div class="luckysheet-modal-dialog-slider-config-item-icon"><i class="fa fa-sort-desc" aria-hidden="true"></i></div></div>'}event.pageX;let o=event.pageY,n=$(this),s=o-n.offset().top+n.scrollTop(),c=t.moveitemposition,d=z(c,s);("luckysheet-modal-dialog-pivotTable-list"==t.movesave.containerid||"luckysheet-modal-dialog-config-value"==t.movesave.containerid&&t.movesave.containerid!=a.attr("id"))&&$("#luckysheet-modal-dialog-config-filter, #luckysheet-modal-dialog-config-row, #luckysheet-modal-dialog-config-column").find(".luckysheet-modal-dialog-slider-config-item").each(function(){$(this).data("index")==t.movesave.index&&$(this).remove()}),-1==d?0==a.find(".luckysheet-modal-dialog-slider-config-item").length?a.append(l):a.find(".luckysheet-modal-dialog-slider-config-item").last().after(l):s-c[d-1]>(c[d]-c[d-1])/2?a.find(".luckysheet-modal-dialog-slider-config-item").eq(d-1).after(l):a.find(".luckysheet-modal-dialog-slider-config-item").eq(d-1).before(l),"luckysheet-modal-dialog-pivotTable-list"==t.movesave.containerid||"luckysheet-modal-dialog-config-value"==t.movesave.containerid&&t.movesave.containerid!=a.attr("id")||t.movesave.obj.remove(),$("#luckysheet-modal-dialog-pivotTable-list").find(".luckysheet-modal-dialog-slider-list-item").each(function(){let e=$(this).find(".luckysheet-slider-list-item-selected");$(this).data("index")==t.movesave.index&&0==e.find("i").length&&e.append('<i class="fa fa-check luckysheet-mousedown-cancel"></i>')}),t.refreshPivotTable(),$("#luckysheet-modal-dialog-slider-pivot-move").remove(),t.movestate=!1,$("#luckysheet-modal-dialog-pivotTable-list, #luckysheet-modal-dialog-config-filter, #luckysheet-modal-dialog-config-row, #luckysheet-modal-dialog-config-column, #luckysheet-modal-dialog-config-value").css("cursor","default"),t.moveitemposition=[],$("#luckysheet-modal-dialog-config-order-help").remove(),t.showvaluecolrow(),e.stopPropagation()}}),$("#luckysheet-modal-dialog-pivotTable-list").on("click",".luckysheet-slider-list-item-selected",function(){let e=$(this),l=e.parent(),i=l.data("index"),a=l.data("name");if(0==e.find("i").length){let l;if(e.append('<i class="fa fa-check luckysheet-mousedown-cancel"></i>'),"num"==t.pivot_data_type[i.toString()])l='<div title="'+a+'" class="luckysheet-modal-dialog-slider-config-item" data-nameindex="0" data-sumtype="SUM" data-index="'+i+'" data-name="'+a+'"><div class="luckysheet-modal-dialog-slider-config-item-txt" data-nameindex="0" data-sumtype="SUM" data-index="'+i+'" data-name="'+a+'">求和:'+a+'</div><div class="luckysheet-modal-dialog-slider-config-item-icon"><i class="fa fa-sort-desc" aria-hidden="true"></i></div></div>',$("#luckysheet-modal-dialog-config-value").append(l);else{l='<div title="'+a+'" class="luckysheet-modal-dialog-slider-config-item" data-index="'+i+'" data-name="'+a+'"><div class="luckysheet-modal-dialog-slider-config-item-txt" data-index="'+i+'" data-name="'+a+'">'+a+'</div><div class="luckysheet-modal-dialog-slider-config-item-icon"><i class="fa fa-sort-desc" aria-hidden="true"></i></div></div>';let e=$("#luckysheet-modal-dialog-config-column"),t=$("#luckysheet-modal-dialog-config-row"),o=e.find(".luckysheet-modal-dialog-slider-config-item"),n=t.find(".luckysheet-modal-dialog-slider-config-item");o.length<2?e.append(l):n.length<2?t.append(l):e.append(l)}}else e.find("i").remove(),$("#luckysheet-modal-dialog-config-filter, #luckysheet-modal-dialog-config-row, #luckysheet-modal-dialog-config-column, #luckysheet-modal-dialog-config-value").find(".luckysheet-modal-dialog-slider-config-item").each(function(){$(this).data("index")==i&&("luckysheet-modal-dialog-config-value"==$(this).parent().attr("id")&&t.resetOrderby($(this)),$(this).remove())});t.refreshPivotTable(),t.showvaluecolrow()}),$("#luckysheet-dialog-pivotTable-clearitem").click(function(){$("#luckysheet-modal-dialog-config-filter, #luckysheet-modal-dialog-config-row, #luckysheet-modal-dialog-config-column, #luckysheet-modal-dialog-config-value").find(".luckysheet-modal-dialog-slider-config-item").each(function(){$(this).remove()}),$("#luckysheet-modal-dialog-pivotTable-list").find(".luckysheet-modal-dialog-slider-list-item").each(function(){$(this).find(".luckysheet-slider-list-item-selected").find("i").remove()}),t.refreshPivotTable(),t.showvaluecolrow()})}null==e&&(e=!1),t.celldata.length<=1&&t.celldata[0].length<=1&&(V()?alert(i.errorIncreaseRange):c.info("",i.errorIncreaseRange));let n="",s=1,d={},r=1;for(let l=0;l<t.celldata[0].length;l++){let a;null!=(a=t.celldata[0][l]&&t.celldata[0][l].m?t.celldata[0][l].m:j(0,l,t.celldata))&&(a=a.toString()),null!=a&&0!=$.trim(a.toString()).length||(a=i.titleColumn+" "+r),r++,a in d&&(a+=s++)in d&&(a+=s++)in d&&(a+=s++),d[a]=1;let o="",c="";if(e&&null!=t.filterparm&&null!=t.filterparm[l.toString()]){let e=t.filterparm[l.toString()];if(null!=e.rowhidden&&(o+="data-rowhidden='"+JSON.stringify(e.rowhidden)+"'"),null!=e.selected&&(o+="data-selected='"+JSON.stringify(e.selected)+"'"),null!=e.caljs){let t=e.caljs;null!=t.value&&(o+="data-byconditionvalue='"+t.value+"'"),null!=t.type&&(o+="data-byconditiontype='"+t.type+"'"),null!=t.text&&(o+="data-byconditiontext='"+t.text+"'"),null!=t.value1&&(o+="data-byconditionvalue1='"+t.value1+"'"),null!=t.value2&&(o+="data-byconditionvalue2='"+t.value2+"'")}}o.length>0&&(c="display:block;"),n+='<div class="luckysheet-modal-dialog-slider-list-item" '+o+' data-index="'+l+'" data-name="'+a+'"><div title="'+i.titleAddColumn+'" class="luckysheet-slider-list-item-selected"><div></div></div><div title="'+i.titleMoveColumn+'" class="luckysheet-slider-list-item-name" '+o+' data-index="'+l+'" data-name="'+a+'">'+a+'</div><div title="'+i.titleClearColumnFilter+'" class="luckysheet-slider-list-item-filtered" style="'+c+'"><i class="fa fa-filter luckysheet-mousedown-cancel" aria-hidden="true"></i><i class="fa fa-times" aria-hidden="true"></i></div><div title="'+i.titleFilterColumn+'" class="luckysheet-slider-list-item-filter"><i class="fa fa-sort-desc" aria-hidden="true"></i></div></div>'}if($("#luckysheet-modal-dialog-pivotTable-list").html(n),$("#luckysheetpivottablevaluecolrowshow").hide(),$("#luckysheetpivottablevaluecolrow").prop("checked",!0),$("#luckysheetpivottablevaluecolrow1").prop("checked",!1),$("#luckysheet-modal-dialog-config-filter, #luckysheet-modal-dialog-config-row, #luckysheet-modal-dialog-config-column, #luckysheet-modal-dialog-config-value").empty(),e){if(null!=t.filter&&t.filter.length>0)for(let e=0;e<t.filter.length;e++){let l=t.filter[e],i='<div title="'+name+'" class="luckysheet-modal-dialog-slider-config-item" data-index="'+l.index+'" data-name="'+l.name+'"><div class="luckysheet-modal-dialog-slider-config-item-txt" data-index="'+l.index+'" data-name="'+l.name+'">'+l.name+'</div><div class="luckysheet-modal-dialog-slider-config-item-icon"><i class="fa fa-sort-desc" aria-hidden="true"></i></div></div>';$("#luckysheet-modal-dialog-config-filter").append(i);let a=$("#luckysheet-modal-dialog-pivotTable-list .luckysheet-modal-dialog-slider-list-item").eq(l.index).find(".luckysheet-slider-list-item-selected");0==a.find("i").length&&a.append('<i class="fa fa-check luckysheet-mousedown-cancel"></i>')}if(null!=t.row&&t.row.length>0)for(let e=0;e<t.row.length;e++){let l=t.row[e],i="";null!=l.order&&(i+="data-order = '"+l.order+"'"),null!=l.orderby&&(i+="data-orderby = '"+l.orderby+"'"),null!=l.order&&(i+="data-stastic = '"+l.stastic+"'");let a='<div title="'+name+'" class="luckysheet-modal-dialog-slider-config-item" '+i+' data-index="'+l.index+'" data-name="'+l.name+'"><div class="luckysheet-modal-dialog-slider-config-item-txt" '+i+' data-index="'+l.index+'" data-name="'+l.name+'">'+l.name+'</div><div class="luckysheet-modal-dialog-slider-config-item-icon"><i class="fa fa-sort-desc" aria-hidden="true"></i></div></div>';$("#luckysheet-modal-dialog-config-row").append(a);let o=$("#luckysheet-modal-dialog-pivotTable-list .luckysheet-modal-dialog-slider-list-item").eq(l.index).find(".luckysheet-slider-list-item-selected");0==o.find("i").length&&o.append('<i class="fa fa-check luckysheet-mousedown-cancel"></i>')}if(null!=t.column&&t.column.length>0)for(let e=0;e<t.column.length;e++){let l=t.column[e],i="";null!=l.order&&(i+="data-order = '"+l.order+"'"),null!=l.orderby&&(i+="data-orderby = '"+l.orderby+"'"),null!=l.order&&(i+="data-stastic = '"+l.stastic+"'");let a='<div title="'+name+'" class="luckysheet-modal-dialog-slider-config-item" '+i+' data-index="'+l.index+'" data-name="'+l.name+'"><div class="luckysheet-modal-dialog-slider-config-item-txt" '+i+' data-index="'+l.index+'" data-name="'+l.name+'">'+l.name+'</div><div class="luckysheet-modal-dialog-slider-config-item-icon"><i class="fa fa-sort-desc" aria-hidden="true"></i></div></div>';$("#luckysheet-modal-dialog-config-column").append(a);let o=$("#luckysheet-modal-dialog-pivotTable-list .luckysheet-modal-dialog-slider-list-item").eq(l.index).find(".luckysheet-slider-list-item-selected");0==o.find("i").length&&o.append('<i class="fa fa-check luckysheet-mousedown-cancel"></i>')}if(null!=t.values&&t.values.length>0){for(let e=0;e<t.values.length;e++){let l=t.values[e],i="";null!=l.sumtype&&(i+="data-sumtype = '"+l.sumtype+"'"),null!=l.nameindex&&(i+="data-nameindex = '"+l.nameindex+"'");let a='<div title="'+name+'" class="luckysheet-modal-dialog-slider-config-item" '+i+' data-index="'+l.index+'" data-name="'+l.name+'"><div class="luckysheet-modal-dialog-slider-config-item-txt" '+i+' data-index="'+l.index+'" data-name="'+l.name+'">'+t.getSumTypeName(l.sumtype)+":"+l.name+'</div><div class="luckysheet-modal-dialog-slider-config-item-icon"><i class="fa fa-sort-desc" aria-hidden="true"></i></div></div>';$("#luckysheet-modal-dialog-config-value").append(a);let o=$("#luckysheet-modal-dialog-pivotTable-list .luckysheet-modal-dialog-slider-list-item").eq(l.index).find(".luckysheet-slider-list-item-selected");0==o.find("i").length&&o.append('<i class="fa fa-check luckysheet-mousedown-cancel"></i>')}t.values.length>=2&&($("#luckysheetpivottablevaluecolrowshow").show(),"column"==t.showType?($("#luckysheetpivottablevaluecolrow").prop("checked",!0),$("#luckysheetpivottablevaluecolrowshow label[for='luckysheetpivottablevaluecolrow']").addClass("ui-state-active"),$("#luckysheetpivottablevaluecolrow1").prop("checked",!1),$("#luckysheetpivottablevaluecolrowshow label[for='luckysheetpivottablevaluecolrow1']").removeClass("ui-state-active")):($("#luckysheetpivottablevaluecolrow1").prop("checked",!0),$("#luckysheetpivottablevaluecolrowshow label[for='luckysheetpivottablevaluecolrow1']").addClass("ui-state-active"),$("#luckysheetpivottablevaluecolrow").prop("checked",!1),$("#luckysheetpivottablevaluecolrowshow label[for='luckysheetpivottablevaluecolrow']").removeClass("ui-state-active")))}}$("#luckysheet-dialog-pivotTable-range").html(F(t.pivotDataSheetIndex,t.pivot_select_save)),$("#luckysheet-modal-dialog-slider-pivot").show(),y(!1)},getComposeArray:function(e){if(0==e.length)return[];let t=[];for(let l=0;l<e.length;l++){let i="";for(let t=0;t<=l;t++)e[t]&&e[t].m?i+=e[t].m:i+=j(t,null,e);t.push(i)}return t},getnameArray:function(e,t){if(0==e.length)return[];if(0==t.length)return[];let l=[];for(let i=0;i<t.length;i++){let a;a=e[t[i].index]&&e[t[i].index].m?e[t[i].index].m:j(t[i].index,null,e),l.push(a)}return l},getTitleFromGroup:function(e,t,l){let i=this.orderbygroup(e,t,l);return this.generategrouparraymain(i,t)},orderbygroup:function(e,t,l){let i=this,a=[];if(0==e.length)return[];let o=null,n=(a=e).length,s=a.length,c=0;for(;0!=n;)if(n--,null!=(o=a[c++]).children&&o.children.length>0){o.children=i.orderbygroupchildren(o.children,t[o.index].orderby,t[o.index].order,l);for(let e=0;e<o.children.length;e++)a.push(o.children[e]),n++}return e.splice(0,s)},orderbygroupchildren:function(e,t,l,i){if(0==e.length)return[];let a=!1;null!=l&&"asc"!=l||(a=!0);const o=x().filter;let n=function(e,l){let a=null,n=null;if("self"==t||null==t){if(a=null==e.name?o.valueBlank:e.name.toString(),n=null==l.name?o.valueBlank:l.name.toString(),M(a)&&M(n))return U(a,n)}else a=parseFloat(i[e.orderby].result),n=parseFloat(i[l.orderby].result);return isNaN(a)||isNaN(n)?isNaN(a)&&isNaN(n)?a.localeCompare(n):isNaN(a)?1:isNaN(n)?-1:void 0:T(a).value()-T(n).value()},s=function(e,l){let a=null,n=null;if("self"==t||null==t){if(a=null==e.name?o.valueBlank:e.name.toString(),n=null==l.name?o.valueBlank:l.name.toString(),M(a)&&M(n))return U(a,n)}else a=parseFloat(i[e.orderby].result),n=parseFloat(i[l.orderby].result);return isNaN(a)||isNaN(n)?isNaN(a)&&isNaN(n)?n.localeCompare(a):isNaN(a)?-1:isNaN(n)?1:void 0:T(n).value()-T(a).value()};return a?e.sort(n):e.sort(s)},generategroupaddstatic:function(e,t){let l=[];const i=x().pivotTable;for(let a=0;a<e[0].length;a++)0==a?t==i.valueSum?l.push(t):l.push({name:t,issum:!0}):l.push("");return l},generategrouparraymain:function(e,t){let l=this,i=[];for(let a=0;a<e.length;a++){let o=e[a].name,n=l.generategrouparray(e[a].children,t,1);"1"!=t[0].stastic&&null!=t[0].stastic||n.push(l.generategroupaddstatic(n,o)),i=i.concat(n)}return i},generategrouparray:function(e,t,l){let i=this,a=[];for(let o=0;o<e.length;o++){let n,s=e[o].name;if(0==e[o].children||0==e[o].children.length)n=[s],a.push(n);else{n=i.generategrouparray(e[o].children,t,l+1);for(let e=0;e<n.length;e++)n[e].unshift(s);"1"!=t[l].stastic&&null!=t[l].stastic||n.push(i.generategroupaddstatic(n,s)),a=a.concat(n)}}return a},addStatisticsData:function(e,t,l,i){if(null==e[l]&&(e[l]={data:[],count:0,max:-1/0,min:1/0,counta:0,countunique:0,countuniquedata:{},sum:0,digitaldata:[],sumtype:t.sumtype,index:t.index,name:t.fullname,acc:0}),!0===O(i).num){let t=N(i);e[l].digitaldata.push(t),e[l].count+=1,e[l].sum+=t,t>e[l].max&&(e[l].max=t),t<e[l].min&&(e[l].min=t);let a=P(t);a>e[l].acc&&(e[l].acc=a)}""!=i&&(e[l].data.push(i),e[l].counta+=1,i in e[l].countuniquedata||(e[l].countuniquedata[i]=1,e[l].countunique+=1))},dataHandler:function(e,t,l,i,a){let o=this;const n=x(),s=n.filter,c=n.pivotTable;if(null==i&&(i="column"),0==e.length&&0==t.length&&0==l.length||0==a.length)return o.pivotDatas=[],[];let d={},u=a,p=[],v=[],f={},m=[],y=[],g={};for(let a=1;a<u.length;a++){let n=u[a],r=[],h=[],p=[],m=[];h=o.getnameArray(n,t),m=o.getnameArray(n,e),r=o.getComposeArray(h),p=o.getComposeArray(m),r.length>0&&r.unshift(c.valueSum),p.length>0&&p.unshift(c.valueSum);let k=f,b=v;for(let e=0;e<r.length;e++){let a=r[e],o=0==e?c.valueSum:h[e-1];if(null!=k[e.toString()]&&null!=k[e.toString()][a])b=b[k[e.toString()][a]].children;else{let n=0==e?"self":"self"==t[e-1].orderby||null==t[e-1].orderby?a:"column"==i?a+l[parseInt(t[e-1].orderby)].fullname:a+c.valueSum;null==o&&(o=s.valueBlank),b.push({name:o,fullname:a,index:e,orderby:n,children:[]}),null==k[e.toString()]&&(k[e.toString()]={}),null==k[e.toString()][a]&&(k[e.toString()][a]=b.length-1),b=b[b.length-1].children}}let $=g,x=y;for(let t=0;t<p.length;t++){let a=p[t],o=0==t?c.valueSum:m[t-1];if(null!=$[t.toString()]&&null!=$[t.toString()][a])x=x[$[t.toString()][a]].children;else{let n=0==t?"self":"self"==e[t-1].orderby||null==e[t-1].orderby?a:"column"==i?c.valueSum+a:l[parseInt(e[t-1].orderby)].fullname+a;null==o&&(o=s.valueBlank),x.push({name:o,fullname:a,index:t,orderby:n,children:[]}),null==$[t.toString()]&&($[t.toString()]={}),null==$[t.toString()][a]&&($[t.toString()][a]=x.length-1),x=x[x.length-1].children}}for(let e=0;e<l.length;e++){let t=j(l[e].index,null,n),a=[].concat(p),s=[].concat(r);"column"==i?a.length>0?(a.push(""),a=a.join(l[e].fullname+"|||").split("|||").slice(0,a.length-1)):a.push(l[e].fullname):s.length>0?(s.push(""),s=s.join(l[e].fullname+"|||").split("|||").slice(0,s.length-1)):s.push(l[e].fullname),0==a.length&&a.push(""),0==s.length&&s.push("");for(let i=0;i<s.length;i++)for(let n=0;n<a.length;n++){let c=s[i]+a[n];o.addStatisticsData(d,l[e],c,t)}}}for(let e in d){let t=d[e];if("SUM"==t.sumtype)t.result=t.sum;else if("COUNT"==t.sumtype)t.result=t.count;else if("COUNTA"==t.sumtype)t.result=t.counta;else if("COUNTUNIQUE"==t.sumtype)t.result=t.countunique;else if("AVERAGE"==t.sumtype)t.result=N(t.sum/t.count);else if("MAX"==t.sumtype)t.result=t.max;else if("MIN"==t.sumtype)t.result=t.min;else if("MEDIAN"==t.sumtype){let e=t.digitaldata.sort(function(e,t){return e-t}),l=e.length,i=parseInt(l/2);t.result=l%2==0?(e[i-1]+e[i])/2:e[i]}else if("PRODUCT"==t.sumtype)t.result=new Function("return "+t.digitaldata.join("*"))();else if("STDEV"==t.sumtype){let e=t.sum/t.count;t.result=h.STDEV(e,t.digitaldata)}else if("STDEVP"==t.sumtype){let e=t.sum/t.count;t.result=h.STDEVP(e,t.digitaldata)}else if("let"==t.sumtype){let e=t.sum/t.count;t.result=h.let(e,t.digitaldata)}else if("VARP"==t.sumtype){let e=t.sum/t.count;t.result=h.VARP(e,t.digitaldata)}let l=P(t.result);l>t.acc&&(t.acc=l),t.result=N(t.result,t.acc)}if(p=o.getTitleFromGroup(v,t,d),m=o.getTitleFromGroup(y,e,d),"column"==i)if(m.length>0&&m[0].length>0)m=o.addValuesToTitle(m,l);else for(let e=0;e<l.length;e++)m.push([l[e].fullname]);else if(p.length>0&&p[0].length>0)p=o.addValuesToTitle(p,l);else for(let e=0;e<l.length;e++)p.push([l[e].fullname]);let k=m;m=r.transpose(m,!1);let b=0==l.length?0:1,$=(0==m.length?b:m.length)+(0==p.length?b:p.length),T=(0==m.length?b:m[0].length)+(0==p.length?b:p[0].length),w=m.length,F=0==p.length?0:p[0].length,S=[];for(let e=0;e<$;e++){S[e]=new Array(T);for(let t=0;t<T;t++){let l=p[e-w];if(e<w&&t<F)S[e][t]="";else if(e<w&&t>=F)null!=m[e]?"object"==D(m[e][t-F])?S[e][t]=m[e][t-F].name+c.valueSum:S[e][t]=m[e][t-F]:S[e][t]="";else if(e>=w&&t<F)null!=l?"object"==D(l[t])?S[e][t]=l[t].name+c.valueSum:S[e][t]=l[t]:S[e][t]="";else{let i="";if(null!=l)if(l instanceof Array&&1!=l.length)for(let e=0;e<l.length;e++)"object"==D(l[e])?i+=l[e].name:i+=l[e];else i=l instanceof Array?l[0]:l;let a="",o=k[t-F];if(null!=o)if(o instanceof Array&&1!=o.length)for(let e=0;e<o.length;e++)"object"==D(o[e])?a+=o[e].name:a+=o[e];else a=o instanceof Array?o[0]:o;let n=i;""!=i&&""!=a?n=i+a:""==i&&(n=a),S[e][t]=null==d[n]?"":d[n].result}}}if(1==l.length&&e.length>0&&t.length>0)S[0][0]=l[0].fullname,S.splice(e.length,1);else if(1==l.length&&e.length>0){let t=S.splice(e.length,1),l=[];for(let e=0;e<S.length;e++){let i=[];e==S.length-1?i.push(t[0][0]):i.push("");for(let t=0;t<S[e].length-1;t++)i.push(S[e][t]);l.push(i)}S=l}return o.pivotDatas=S,S},drillDown:function(e,t){if(!te(b.currentSheetIndex,"usePivotTablereports"))return;let l=this,i=(l.pivotDatas[e][t],$.extend(!0,[],m.nulldata));const a=x(),o=a.filter,n=a.pivotTable;let s=1;for(let e=0;e<l.celldata[0].length;e++){let t;null!=(t=l.celldata[0][e]&&l.celldata[0][e].m?l.celldata[0][e].m:j(0,e,l.celldata))&&(t=t.toString()),null!=t&&0!=$.trim(t.toString()).length||(t=n.titleColumn+" "+s),s++,i[0][e]=t}let c={};if(null!=l.row&&l.row.length>0)for(let t=0;t<l.row.length;t++)c[l.row[t].index]=l.pivotDatas[e][t];if(null!=l.column&&l.column.length>0)for(let e=0;e<l.column.length;e++)c[l.column[e].index]=l.pivotDatas[e][t];let d=[];for(let e=1;e<l.celldata.length;e++){let t=!0;for(let i in c){let a;if((a=null!=(a=l.celldata[e][i]&&l.celldata[e][i].m?l.celldata[e][i].m:j(e,i,l.celldata))?a.toString():o.valueBlank)!=c[i]){t=!1;break}}t&&d.push(e)}for(let e=0;e<d.length;e++)for(let t=0;t<l.celldata[0].length;t++){let a;a=null!=(a=l.celldata[d[e]][t]&&l.celldata[d[e]][t].m?l.celldata[d[e]][t].m:j(d[e],t,l.celldata))?a.toString():"",i[e+1][t]=a}b.luckysheet_select_save=[{row:[0,d.length],column:[0,l.celldata[0].length-1]}],b.clearjfundo=!1,H(i,b.luckysheet_select_save),J(),b.clearjfundo=!0}}});
//# sourceMappingURL=../sourcemaps/controllers/pivotTable.js.map
