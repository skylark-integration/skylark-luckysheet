/**
 * skylark-lucksheet - A version of lucksheet.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["../store"],function(t){"use strict";let e=function(){let t,e;return t=function(){this.init.apply(this,arguments)},arguments.length>1?(arguments[0]?(t.prototype=$.extend(new arguments[0],arguments[arguments.length-1]),t._super=arguments[0].prototype):t.prototype=arguments[arguments.length-1],arguments.length>2&&((e=Array.prototype.slice.call(arguments,1,-1)).unshift(t.prototype),$.extend.apply($,e))):t.prototype=arguments[0],t.prototype.cls=t,t},i=e({fre:/\{\{([\w.]+?)(:(.+?))?\}\}/g,precre:/(\w+)\.(\d+)/,init:function(t,e){this.format=t,this.fclass=e},render:function(t,e,i){let h,a,s,n,r,o=this,d=t;return this.format.replace(this.fre,function(){let t;return a=arguments[1],s=arguments[3],(h=o.precre.exec(a))?(r=h[2],a=h[1]):r=!1,void 0===(n=d[a])?"":s&&e&&e[s]?(t=e[s]).get?e[s].get(n)||n:e[s][n]||n:(l(n)&&(n=i.get("numberFormatter")?i.get("numberFormatter")(n):g(n,r,i.get("numberDigitGroupCount"),i.get("numberDigitGroupSep"),i.get("numberDecimalMark"))),n)})}});$.spformat=function(t,e){return new i(t,e)};let h=function(t,e,i){return t<e?e:t>i?i:t},a=function(t,e){let i;return 2===e?(i=Math.floor(t.length/2),t.length%2?t[i]:(t[i-1]+t[i])/2):t.length%2?(i=(t.length*e+e)/4)%1?(t[Math.floor(i)]+t[Math.floor(i)-1])/2:t[i-1]:(i=(t.length*e+2)/4)%1?(t[Math.floor(i)]+t[Math.floor(i)-1])/2:t[i-1]},s=function(t){let e;switch(t){case"undefined":t=void 0;break;case"null":t=null;break;case"true":t=!0;break;case"false":t=!1;break;default:t==(e=parseFloat(t))&&(t=e)}return t},n=function(t){let e,i=[];for(e=t.length;e--;)i[e]=s(t[e]);return i},r=function(t,e,i){let h;for(h=e.length;h--;)if((!i||null!==e[h])&&e[h]!==t)return!1;return!0},o=function(t,e){let i,h,a=[];for(i=0,h=t.length;i<h;i++)t[i]!==e&&a.push(t[i]);return a},l=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},g=function(t,e,i,h,a){let s,n;for(t=(!1===e?parseFloat(t).toString():t.toFixed(e)).split(""),(s=(s=$.inArray(".",t))<0?t.length:s)<t.length&&(t[s]=a),n=s-i;n>0;n-=i)t.splice(n,0,h);return t.join("")},d=e({init:function(t){let e,i,h=[];for(e in t)t.hasOwnProperty(e)&&"string"==typeof e&&e.indexOf(":")>-1&&((i=e.split(":"))[0]=0===i[0].length?-1/0:parseFloat(i[0]),i[1]=0===i[1].length?1/0:parseFloat(i[1]),i[2]=t[e],h.push(i));this.map=t,this.rangelist=h||!1},get:function(t){let e,i,h,a=this.rangelist;if(void 0!==(h=this.map[t]))return h;if(a)for(e=a.length;e--;)if((i=a[e])[0]<=t&&i[1]>=t)return i[2]}});$.range_map=function(t){return new d(t)};const u={defaultOption:{common:{type:"line",lineColor:"#2ec7c9",fillColor:"#CCF3F4",defaultPixelsPerValue:3,width:"auto",height:"auto",composite:!1,tagValuesAttribute:"values",tagOptionsPrefix:"spark",enableTagOptions:!1,enableHighlight:!0,highlightLighten:1.4,tooltipSkipNull:!0,tooltipPrefix:"",tooltipSuffix:"",disableHiddenCheck:!1,numberFormatter:!1,numberDigitGroupCount:3,numberDigitGroupSep:",",numberDecimalMark:".",disableTooltips:!0,disableInteraction:!0,offsetX:0,offsetY:0},line:{spotColor:0,highlightSpotColor:"#5f5",highlightLineColor:"#f22",spotRadius:1.5,minSpotColor:0,maxSpotColor:0,lineWidth:1,normalRangeMin:void 0,normalRangeMax:void 0,normalRangeColor:"#ccc",drawNormalOnTop:!0,chartRangeMin:void 0,chartRangeMax:void 0,chartRangeMinX:void 0,chartRangeMaxX:void 0},bar:{barColor:"#fc5c5c",negBarColor:"#97b552",stackedBarColor:["#2ec7c9","#fc5c5c","#5ab1ef","#ffb980","#d87a80","#8d98b3","#e5cf0d","#97b552","#95706d","#dc69aa","#07a2a4","#9a7fd1","#588dd5","#f5994e","#c05050","#59678c","#c9ab00","#7eb00a","#6f5553","#c14089"],zeroColor:void 0,nullColor:void 0,zeroAxis:!0,barWidth:4,barSpacing:1,chartRangeMax:void 0,chartRangeMin:void 0,chartRangeClip:!1,colorMap:void 0},column:{barColor:"#fc5c5c",negBarColor:"#97b552",stackedBarColor:["#2ec7c9","#fc5c5c","#5ab1ef","#ffb980","#d87a80","#8d98b3","#e5cf0d","#97b552","#95706d","#dc69aa","#07a2a4","#9a7fd1","#588dd5","#f5994e","#c05050","#59678c","#c9ab00","#7eb00a","#6f5553","#c14089"],zeroColor:void 0,nullColor:void 0,zeroAxis:!0,barWidth:4,barSpacing:1,chartRangeMax:void 0,chartRangeMin:void 0,chartRangeClip:!1,colorMap:void 0},tristate:{barWidth:4,barSpacing:1,posBarColor:"#fc5c5c",negBarColor:"#97b552",zeroBarColor:"#999",colorMap:{}},discrete:{lineHeight:"auto",thresholdColor:"#fc5c5c",thresholdValue:0,chartRangeMax:void 0,chartRangeMin:void 0,chartRangeClip:!1},bullet:{targetColor:"#f33",targetWidth:3,performanceColor:"#33f",rangeColors:["#d3dafe","#a8b6ff","#7f94ff","#6D87FF","#5876FF","#4465FF","#2F54FF","#1A43FF","#0532FF"],base:void 0},pie:{offset:0,sliceColors:["#2ec7c9","#fc5c5c","#5ab1ef","#ffb980","#d87a80","#8d98b3","#e5cf0d","#97b552","#95706d","#dc69aa","#07a2a4","#9a7fd1","#588dd5","#f5994e","#c05050","#59678c","#c9ab00","#7eb00a","#6f5553","#c14089"],borderWidth:0,borderColor:"#000"},box:{raw:!1,boxLineColor:"#000",boxFillColor:"#cdf",whiskerColor:"#000",outlierLineColor:"#5E5E5E",outlierFillColor:"#fff",medianColor:"#f00",showOutliers:!0,outlierIQR:1.5,spotRadius:1.5,target:void 0,targetColor:"#4a2",chartRangeMax:void 0,chartRangeMin:void 0}},line:{type:"line",init:function(t,e,i,h,a){this.vertices=[],this.regionMap=[],this.xvalues=[],this.yvalues=[],this.yminmax=[],this.hightlightSpotId=null,this.lastShapeId=null},getRegion:function(t,e,i){let h,a=this.regionMap;for(h=a.length;h--;)if(null!==a[h]&&e>=a[h][0]&&e<=a[h][1])return a[h][2]},getCurrentRegionFields:function(){let t=this.currentRegion;return{isNull:null===this.yvalues[t],x:this.xvalues[t],y:this.yvalues[t],color:this.options.get("lineColor"),fillColor:this.options.get("fillColor"),offset:t}},renderHighlight:function(){let t,e,i=this.currentRegion,h=this.target,a=this.vertices[i],s=this.options,n=s.get("spotRadius"),r=s.get("highlightSpotColor"),o=s.get("highlightLineColor");a&&(n&&r&&(t=h.drawCircle(a[0],a[1],n,void 0,r),this.highlightSpotId=t.id,h.insertAfterShape(this.lastShapeId,t)),o&&(e=h.drawLine(a[0],this.canvasTop,a[0],this.canvasTop+this.canvasHeight,o),this.highlightLineId=e.id,h.insertAfterShape(this.lastShapeId,e)))},removeHighlight:function(){let t=this.target;this.highlightSpotId&&(t.removeShapeId(this.highlightSpotId),this.highlightSpotId=null),this.highlightLineId&&(t.removeShapeId(this.highlightLineId),this.highlightLineId=null)},scanValues:function(){let t,e,i,h,a,s=this.values,n=s.length,r=this.xvalues,o=this.yvalues,l=this.yminmax;for(t=0;t<n;t++)e=s[t],i="string"==typeof s[t],h="object"==typeof s[t]&&s[t]instanceof Array,a=i&&s[t].split(":"),i&&2===a.length?(r.push(Number(a[0])),o.push(Number(a[1])),l.push(Number(a[1]))):h?(r.push(e[0]),o.push(e[1]),l.push(e[1])):(r.push(t),null===s[t]||"null"===s[t]?o.push(null):(o.push(Number(e)),l.push(Number(e))));this.options.get("xvalues")&&(r=this.options.get("xvalues")),this.maxy=this.maxyorg=Math.max.apply(Math,l),this.miny=this.minyorg=Math.min.apply(Math,l),this.maxx=Math.max.apply(Math,r),this.minx=Math.min.apply(Math,r),this.xvalues=r,this.yvalues=o,this.yminmax=l},processRangeOptions:function(){let t=this.options,e=t.get("normalRangeMin"),i=t.get("normalRangeMax");void 0!==e&&(e<this.miny&&(this.miny=e),i>this.maxy&&(this.maxy=i)),void 0!==t.get("chartRangeMin")&&(t.get("chartRangeClip")||t.get("chartRangeMin")<this.miny)&&(this.miny=t.get("chartRangeMin")),void 0!==t.get("chartRangeMax")&&(t.get("chartRangeClip")||t.get("chartRangeMax")>this.maxy)&&(this.maxy=t.get("chartRangeMax")),void 0!==t.get("chartRangeMinX")&&(t.get("chartRangeClipX")||t.get("chartRangeMinX")<this.minx)&&(this.minx=t.get("chartRangeMinX")),void 0!==t.get("chartRangeMaxX")&&(t.get("chartRangeClipX")||t.get("chartRangeMaxX")>this.maxx)&&(this.maxx=t.get("chartRangeMaxX"))},drawNormalRange:function(t,e,i,h,a){let s=this.options.get("normalRangeMin"),n=this.options.get("normalRangeMax"),r=e+Math.round(i-i*((n-this.miny)/a)),o=Math.round(i*(n-s)/a);0==o&&s==n&&(o=1),this.target.drawRect(t,r,h,o,void 0,this.options.get("normalRangeColor")).append()},render:function(t,e){this.vertices=[],this.regionMap=[],this.xvalues=[],this.yvalues=[],this.yminmax=[],this.hightlightSpotId=null,this.lastShapeId=null,this.values=e;let i,h,a,s,n,r,o,l,g,u,p,c,f,M,m,v,C,x,y,R,b,w,S,O,W,H=this.options,I=this.target,B=t.mergedOptions.width,k=t.mergedOptions.height,F=this.vertices,A=H.get("spotRadius"),N=this.regionMap;if(this.scanValues(),this.processRangeOptions(),S=this.xvalues,O=this.yvalues,this.yminmax.length&&!(this.yvalues.length<2)){for(s=n=0,i=this.maxx-this.minx==0?1:this.maxx-this.minx,h=this.maxy-this.miny==0?1:this.maxy-this.miny,a=this.yvalues.length-1,A&&(B<4*A||k<4*A)&&(A=0),A&&(((b=H.get("highlightSpotColor")&&!H.get("disableInteraction"))||H.get("minSpotColor")||H.get("spotColor")&&O[a]===this.miny)&&(k-=Math.ceil(A)),(b||H.get("maxSpotColor")||H.get("spotColor")&&O[a]===this.maxy)&&(k-=Math.ceil(A),s+=Math.ceil(A)),(b||(H.get("minSpotColor")||H.get("maxSpotColor"))&&(O[0]===this.miny||O[0]===this.maxy))&&(n+=Math.ceil(A),B-=Math.ceil(A)),(b||H.get("spotColor")||H.get("minSpotColor")||H.get("maxSpotColor")&&(O[a]===this.miny||O[a]===this.maxy))&&(B-=Math.ceil(A))),k--,void 0===H.get("normalRangeMin")||H.get("drawNormalOnTop")||this.drawNormalRange(n,s,k,B,h),l=[o=[]],M=m=null,v=O.length,W=0;W<v;W++)g=S[W],p=S[W+1],u=O[W],m=(c=n+Math.round((g-this.minx)*(B/i)))+((f=W<v-1?n+Math.round((p-this.minx)*(B/i)):B)-c)/2,N[W]=[M||0,m,W],M=m,null===u?W&&(null!==O[W-1]&&(o=[],l.push(o)),F.push(null)):(u<this.miny&&(u=this.miny),u>this.maxy&&(u=this.maxy),o.length||o.push([c,s+k]),r=[c,s+Math.round(k-k*((u-this.miny)/h))],o.push(r),F.push(r));for(C=[],x=[],y=l.length,W=0;W<y;W++)(o=l[W]).length&&(H.get("fillColor")&&(o.push([o[o.length-1][0],s+k]),x.push(o.slice(0)),o.pop()),o.length>2&&(o[0]=[o[0][0],o[1][1]]),C.push(o));for(y=x.length,W=0;W<y;W++)I.drawShape(x[W],H.get("fillColor"),H.get("fillColor")).append();for(y=C.length,W=0;W<y;W++)I.drawShape(C[W],H.get("lineColor"),void 0,H.get("lineWidth")).append();if(void 0!==H.get("normalRangeMin")&&H.get("drawNormalOnTop")&&this.drawNormalRange(n,s,k,B,h),A&&H.get("valueSpots"))for(void 0===(R=H.get("valueSpots")).get&&(R=new d(R)),W=0;W<v;W++)(w=R.get(O[W]))&&I.drawCircle(n+Math.round((S[W]-this.minx)*(B/i)),s+Math.round(k-k*((O[W]-this.miny)/h)),A,void 0,w).append();A&&H.get("spotColor")&&null!==O[a]&&I.drawCircle(n+Math.round((S[S.length-1]-this.minx)*(B/i)),s+Math.round(k-k*((O[a]-this.miny)/h)),A,void 0,H.get("spotColor")).append(),this.maxy!==this.minyorg&&(A&&H.get("minSpotColor")&&(g=S[$.inArray(this.minyorg,O)],I.drawCircle(n+Math.round((g-this.minx)*(B/i)),s+Math.round(k-k*((this.minyorg-this.miny)/h)),A,void 0,H.get("minSpotColor")).append()),A&&H.get("maxSpotColor")&&(g=S[$.inArray(this.maxyorg,O)],I.drawCircle(n+Math.round((g-this.minx)*(B/i)),s+Math.round(k-k*((this.maxyorg-this.miny)/h)),A,void 0,H.get("maxSpotColor")).append()))}}},bar:{type:"bar",init:function(t,e){let i=this.options,a=t.mergedOptions.height;t.mergedOptions.width;this.canvasWidth=t.mergedOptions.height,this.canvasHeight=t.mergedOptions.width;parseInt(i.get("barWidth"),10);let r,l,g,u,p,c,f,M,m,v,C,x,y,R,b,w,S,O,W,H,I,B=parseInt(i.get("barSpacing"),10),k=i.get("chartRangeMin"),F=i.get("chartRangeMax"),A=i.get("chartRangeClip"),N=1/0,X=-1/0;for(this.values=e,c=0,f=e.length;c<f;c++)((r="string"==typeof(H=e[c])&&H.indexOf(":")>-1)||$.isArray(H))&&(b=!0,r&&(H=e[c]=n(H.split(":"))),H=o(H,null),l=Math.min.apply(Math,H),g=Math.max.apply(Math,H),l<N&&(N=l),g>X&&(X=g));this.stacked=b,this.regionShapes={},this.barWidth=Math.floor(a/e.length)-B,this.barSpacing=B,this.totalBarWidth=this.barWidth+B,this.width=a,A&&(y=void 0===k?-1/0:k,R=void 0===F?1/0:F),p=[],u=b?[]:p;let P=[],V=[];for(c=0,f=e.length;c<f;c++)if(b)for(w=e[c],e[c]=W=[],P[c]=0,u[c]=V[c]=0,S=0,O=w.length;S<O;S++)null!==(H=W[S]=A?h(w[S],y,R):w[S])&&(H>0&&(P[c]+=H),N<0&&X>0?H<0?V[c]+=Math.abs(H):u[c]+=H:u[c]+=Math.abs(H),p.push(H));else H=A?h(e[c],y,R):e[c],null!==(H=e[c]=s(H))&&p.push(H);this.max=x=Math.max.apply(Math,p),this.min=C=Math.min.apply(Math,p),this.stackMax=X=b?Math.max.apply(Math,P):x,this.stackMin=N=b?Math.min.apply(Math,p):C,void 0!==i.get("chartRangeMin")&&(i.get("chartRangeClip")||i.get("chartRangeMin")<C)&&(C=i.get("chartRangeMin")),void 0!==i.get("chartRangeMax")&&(i.get("chartRangeClip")||i.get("chartRangeMax")>x)&&(x=i.get("chartRangeMax")),this.zeroAxis=m=i.get("zeroAxis",!0),v=C<=0&&x>=0&&m?0:0==m?C:C>0?0:x,this.xaxisOffset=v,M=b?Math.max.apply(Math,u)+Math.max.apply(Math,V):x-v,this.canvasHeightEf=m&&C<0?this.canvasHeight-2:this.canvasHeight-1,this.isNeg=!1,C<v?(I=Math.floor(this.canvasHeight/2),this.isNeg=!0,I!==Math.ceil(I)&&(this.canvasHeightEf-=2,I=Math.ceil(I))):I=0,this.yoffset=I,$.isArray(i.get("colorMap"))?(this.colorMapByIndex=i.get("colorMap"),this.colorMapByValue=null):(this.colorMapByIndex=null,this.colorMapByValue=i.get("colorMap"),this.colorMapByValue&&void 0===this.colorMapByValue.get&&(this.colorMapByValue=new d(this.colorMapByValue))),this.range=M},getRegion:function(t,e,i){let h=Math.floor(e/this.totalBarWidth);return h<0||h>=this.values.length?void 0:h},getCurrentRegionFields:function(){let t,e,i=this.currentRegion,h=ensureArray(this.values[i]),a=[];for(e=h.length;e--;)t=h[e],a.push({isNull:null===t,value:t,color:this.calcColor(e,t,i),offset:i});return a},calcColor:function(t,e,i){let h,a,s=this.colorMapByIndex,n=this.colorMapByValue,r=this.options;return h=this.stacked?r.get("stackedBarColor"):e<0?r.get("negBarColor"):r.get("barColor"),0===e&&void 0!==r.get("zeroColor")&&(h=r.get("zeroColor")),n&&(a=n.get(e))?h=a:s&&s.length>i&&(h=s[i]),$.isArray(h)?h[t%h.length]:h},renderRegion:function(t,e){let i,h,a,s,n,o,l,g,d,u,p=this.values[t],c=this.options,f=this.xaxisOffset,M=[],m=this.range,v=this.stacked,C=this.target,x=t*this.totalBarWidth,y=this.canvasHeightEf,R=this.yoffset;if(l=(p=$.isArray(p)?p:[p]).length,g=p[0],s=r(null,p),u=r(f,p,!0),s)return c.get("nullColor")?(a=e?c.get("nullColor"):this.calcHighlightColor(c.get("nullColor"),c),i=R>0?R-1:R,C.drawRect(i,x,0,this.barWidth-1,a,a)):void 0;for(n=R,this.isNeg&&(y=Math.floor(y/2)),o=0;o<l;o++){if(g=p[o],v&&g===f){if(!u||d)continue;d=!0}h=m>0?Math.floor(y*(Math.abs(g-f)/m)):y,g<f||g===f&&0===R?(i=n-h,n+=h):v?(i=R,R+=h):(i=R,R-=h),a=this.calcColor(o,g,t),e&&(a=this.calcHighlightColor(a,c)),M.push(C.drawRect(i,x,h-1,this.barWidth-1,a,a))}return 1===M.length?M[0]:M}},column:{type:"column",init:function(t,e){let i=this.options,a=t.mergedOptions.width;t.mergedOptions.height;this.canvasWidth=t.mergedOptions.width,this.canvasHeight=t.mergedOptions.height;parseInt(i.get("barWidth"),10);let r,l,g,u,p,c,f,M,m,v,C,x,y,R,b,w,S,O,W,H,I,B=parseInt(i.get("barSpacing"),10),k=i.get("chartRangeMin"),F=i.get("chartRangeMax"),A=i.get("chartRangeClip"),N=1/0,X=-1/0;for(this.values=e,c=0,f=e.length;c<f;c++)((r="string"==typeof(H=e[c])&&H.indexOf(":")>-1)||$.isArray(H))&&(b=!0,r&&(H=e[c]=n(H.split(":"))),H=o(H,null),l=Math.min.apply(Math,H),g=Math.max.apply(Math,H),l<N&&(N=l),g>X&&(X=g));this.stacked=b,this.regionShapes={},this.barWidth=Math.floor(a/e.length)-B,this.barSpacing=B,this.totalBarWidth=this.barWidth+B,this.width=a,A&&(y=void 0===k?-1/0:k,R=void 0===F?1/0:F),p=[],u=b?[]:p;let P=[],V=[];for(c=0,f=e.length;c<f;c++)if(b)for(w=e[c],e[c]=W=[],P[c]=0,u[c]=V[c]=0,S=0,O=w.length;S<O;S++)null!==(H=W[S]=A?h(w[S],y,R):w[S])&&(H>0&&(P[c]+=H),N<0&&X>0?H<0?V[c]+=Math.abs(H):u[c]+=H:u[c]+=Math.abs(H),p.push(H));else H=A?h(e[c],y,R):e[c],null!==(H=e[c]=s(H))&&p.push(H);this.max=x=Math.max.apply(Math,p),this.min=C=Math.min.apply(Math,p),this.stackMax=X=b?Math.max.apply(Math,P):x,this.stackMin=N=b?Math.min.apply(Math,p):C,void 0!==i.get("chartRangeMin")&&(i.get("chartRangeClip")||i.get("chartRangeMin")<C)&&(C=i.get("chartRangeMin")),void 0!==i.get("chartRangeMax")&&(i.get("chartRangeClip")||i.get("chartRangeMax")>x)&&(x=i.get("chartRangeMax")),this.zeroAxis=m=i.get("zeroAxis",!0),v=C<=0&&x>=0&&m?0:0==m?C:C>0?0:x,this.xaxisOffset=v,M=b?Math.max.apply(Math,u)+Math.max.apply(Math,V):x-v,this.canvasHeightEf=m&&C<0?this.canvasHeight-2:this.canvasHeight-1,this.isNeg=!1,C<v?(I=Math.floor(this.canvasHeight/2),this.isNeg=!0,I!==Math.ceil(I)&&(this.canvasHeightEf-=2,I=Math.ceil(I))):I=this.canvasHeight,this.yoffset=I,$.isArray(i.get("colorMap"))?(this.colorMapByIndex=i.get("colorMap"),this.colorMapByValue=null):(this.colorMapByIndex=null,this.colorMapByValue=i.get("colorMap"),this.colorMapByValue&&void 0===this.colorMapByValue.get&&(this.colorMapByValue=new d(this.colorMapByValue))),this.range=M},getRegion:function(t,e,i){let h=Math.floor(e/this.totalBarWidth);return h<0||h>=this.values.length?void 0:h},getCurrentRegionFields:function(){let t,e,i=this.currentRegion,h=ensureArray(this.values[i]),a=[];for(e=h.length;e--;)t=h[e],a.push({isNull:null===t,value:t,color:this.calcColor(e,t,i),offset:i});return a},calcColor:function(t,e,i){let h,a,s=this.colorMapByIndex,n=this.colorMapByValue,r=this.options;return h=this.stacked?r.get("stackedBarColor"):e<0?r.get("negBarColor"):r.get("barColor"),0===e&&void 0!==r.get("zeroColor")&&(h=r.get("zeroColor")),n&&(a=n.get(e))?h=a:s&&s.length>i&&(h=s[i]),$.isArray(h)?h[t%h.length]:h},renderRegion:function(t,e){let i,h,a,s,n,o,l,g,d,u,p=this.values[t],c=this.options,f=this.xaxisOffset,M=[],m=this.range,v=this.stacked,C=this.target,x=t*this.totalBarWidth,y=this.canvasHeightEf,R=this.yoffset;if(l=(p=$.isArray(p)?p:[p]).length,g=p[0],s=r(null,p),u=r(f,p,!0),s)return c.get("nullColor")?(a=e?c.get("nullColor"):this.calcHighlightColor(c.get("nullColor"),c),i=R>0?R-1:R,C.drawRect(x,i,this.barWidth-1,0,a,a)):void 0;for(n=R,this.isNeg&&(y=Math.floor(y/2)),o=0;o<l;o++){if(g=p[o],v&&g===f){if(!u||d)continue;d=!0}h=m>0?Math.floor(y*(Math.abs(g-f)/m)):y,g<f||g===f&&0===R?(i=n,n+=h):(i=R-h,R-=h),a=this.calcColor(o,g,t),e&&(a=this.calcHighlightColor(a,c)),M.push(C.drawRect(x,i,this.barWidth-1,h-1,a,a))}return 1===M.length?M[0]:M}},tristate:{type:"tristate",init:function(t,e){let i=this.options,h=t.mergedOptions.width;t.mergedOptions.height;this.canvasWidth=t.mergedOptions.width,this.canvasHeight=t.mergedOptions.height;let a=parseInt(i.get("barWidth"),10),s=parseInt(i.get("barSpacing"),10);this.regionShapes={},this.barWidth=a,this.barSpacing=s,this.totalBarWidth=a+s,this.values=$.map(e,Number),this.width=h=e.length*a+(e.length-1)*s,$.isArray(i.get("colorMap"))?(this.colorMapByIndex=i.get("colorMap"),this.colorMapByValue=null):(this.colorMapByIndex=null,this.colorMapByValue=i.get("colorMap"),this.colorMapByValue&&void 0===this.colorMapByValue.get&&(this.colorMapByValue=new d(this.colorMapByValue)))},getRegion:function(t,e,i){return Math.floor(e/this.totalBarWidth)},getCurrentRegionFields:function(){let t=this.currentRegion;return{isNull:void 0===this.values[t],value:this.values[t],color:this.calcColor(this.values[t],t),offset:t}},calcColor:function(t,e){let i,h,a=this.values,s=this.options,n=this.colorMapByIndex,r=this.colorMapByValue;return i=r&&(h=r.get(t))?h:n&&n.length>e?n[e]:a[e]<0?s.get("negBarColor"):a[e]>0?s.get("posBarColor"):s.get("zeroBarColor")},renderRegion:function(t,e){let i,h,a,s,n,r,o=this.values,l=this.options,g=this.target;if(i=this.canvasHeight,a=Math.round(i/2),s=t*this.totalBarWidth,o[t]<0?(n=a,h=a-1):o[t]>0?(n=0,h=a-1):(n=a-1,h=2),null!==(r=this.calcColor(o[t],t)))return e&&(r=this.calcHighlightColor(r,l)),g.drawRect(s,n,this.barWidth-1,h-1,r,r)}},discrete:{type:"discrete",init:function(t,e){let i=this.options,h=t.mergedOptions.width;t.mergedOptions.height;this.canvasWidth=t.mergedOptions.width,this.canvasHeight=t.mergedOptions.height,this.regionShapes={},this.values=e=$.map(e,Number),this.min=Math.min.apply(Math,e),this.max=Math.max.apply(Math,e),this.range=this.max-this.min,this.width=h,this.interval=Math.floor(h/e.length),this.itemWidth=h/e.length,void 0!==i.get("chartRangeMin")&&(i.get("chartRangeClip")||i.get("chartRangeMin")<this.min)&&(this.min=i.get("chartRangeMin")),void 0!==i.get("chartRangeMax")&&(i.get("chartRangeClip")||i.get("chartRangeMax")>this.max)&&(this.max=i.get("chartRangeMax")),this.target&&(this.lineHeight="auto"===i.get("lineHeight")?Math.round(.3*this.canvasHeight):i.get("lineHeight"))},getRegion:function(t,e,i){return Math.floor(e/this.itemWidth)},getCurrentRegionFields:function(){let t=this.currentRegion;return{isNull:void 0===this.values[t],value:this.values[t],offset:t}},renderRegion:function(t,e){let i,a,s,n,r=this.values,o=this.options,l=this.min,g=this.max,d=this.range,u=this.interval,p=(this.target,this.canvasHeight),c=this.lineHeight,f=p-c;return a=h(r[t],l,g),n=t*u,i=Math.round(f-f*((a-l)/d)),s=o.get("thresholdColor")&&a<o.get("thresholdValue")?o.get("thresholdColor"):o.get("lineColor"),e&&(s=this.calcHighlightColor(s,o)),this.target.drawRect(n,i,u<=2?1:u-2,c,s,s)}},bullet:{type:"bullet",init:function(t,e){let i,h,a,s=this.options,r=t.mergedOptions.width;t.mergedOptions.height;this.canvasWidth=t.mergedOptions.width,this.canvasHeight=t.mergedOptions.height,this.values=e=n(e),(a=e.slice())[0]=null===a[0]?a[2]:a[0],a[1]=null===e[1]?a[2]:a[1],i=Math.min.apply(Math,e),h=Math.max.apply(Math,e),i=void 0===s.get("base")?i<0?i:0:s.get("base"),this.min=i,this.max=h,this.range=h-i,this.shapes={},this.valueShapes={},this.regiondata={},this.width=r,e.length||(this.disabled=!0)},getRegion:function(t,e,i){let h=this.target.getShapeAt(t,e,i);return void 0!==h&&void 0!==this.shapes[h]?this.shapes[h]:void 0},getCurrentRegionFields:function(){let t=this.currentRegion;return{fieldkey:t.substr(0,1),value:this.values[t.substr(1)],region:t}},changeHighlight:function(t){let e,i=this.currentRegion,h=this.valueShapes[i];switch(delete this.shapes[h],i.substr(0,1)){case"r":e=this.renderRange(i.substr(1),t);break;case"p":e=this.renderPerformance(t);break;case"t":e=this.renderTarget(t)}this.valueShapes[i]=e.id,this.shapes[e.id]=i,this.target.replaceWithShape(h,e)},renderRange:function(t,e){let i=this.values[t],h=Math.round(this.canvasWidth*((i-this.min)/this.range)),a=this.options.get("rangeColors")[t-2];return e&&(a=this.calcHighlightColor(a,this.options)),this.target.drawRect(0,0,h-1,this.canvasHeight-1,a,a)},renderPerformance:function(t){let e=this.values[1],i=Math.round(this.canvasWidth*((e-this.min)/this.range)),h=this.options.get("performanceColor");return t&&(h=this.calcHighlightColor(h,this.options)),this.target.drawRect(0,Math.round(.3*this.canvasHeight),i-1,Math.round(.4*this.canvasHeight)-1,h,h)},renderTarget:function(t){let e=this.values[0],i=Math.round(this.canvasWidth*((e-this.min)/this.range)-this.options.get("targetWidth")/2),h=Math.round(.1*this.canvasHeight),a=this.canvasHeight-2*h,s=this.options.get("targetColor");return t&&(s=this.calcHighlightColor(s,this.options)),this.target.drawRect(i,h,this.options.get("targetWidth")-1,a-1,s,s)},render:function(t,e){this.init(t,e);let i,h,a=this.values.length;this.target;for(i=2;i<a;i++)h=this.renderRange(i).append(),this.shapes[h.id]="r"+i,this.valueShapes["r"+i]=h.id;null!==this.values[1]&&(h=this.renderPerformance().append(),this.shapes[h.id]="p1",this.valueShapes.p1=h.id),null!==this.values[0]&&(h=this.renderTarget().append(),this.shapes[h.id]="t0",this.valueShapes.t0=h.id)}},pie:{type:"pie",init:function(t,e){let i=this.options;t.mergedOptions.width,t.mergedOptions.height;this.canvasWidth=t.mergedOptions.width,this.canvasHeight=t.mergedOptions.height;let h,a=0;if(this.shapes={},this.valueShapes={},this.values=e=$.map(e,Number),"auto"===i.get("width")&&(this.width=this.height),e.length>0)for(h=e.length;h--;)a+=e[h];this.total=a,this.radius=Math.floor(Math.min(this.canvasWidth,this.canvasHeight)/2)},getRegion:function(t,e,i){let h=this.target.getShapeAt(t,e,i);return void 0!==h&&void 0!==this.shapes[h]?this.shapes[h]:void 0},getCurrentRegionFields:function(){let t=this.currentRegion;return{isNull:void 0===this.values[t],value:this.values[t],percent:this.values[t]/this.total*100,color:this.options.get("sliceColors")[t%this.options.get("sliceColors").length],offset:t}},changeHighlight:function(t){let e=this.currentRegion,i=this.renderSlice(e,t),h=this.valueShapes[e];delete this.shapes[h],this.target.replaceWithShape(h,i),this.valueShapes[e]=i.id,this.shapes[i.id]=e},renderSlice:function(t,e){let i,h,a,s,n,r=this.target,o=this.options,l=this.radius,g=o.get("borderWidth"),d=o.get("offset"),u=2*Math.PI,p=this.values,c=this.total,f=d?2*Math.PI*(d/360):0;for(s=p.length,a=0;a<s;a++){if(i=f,h=f,c>0&&(h=f+u*(p[a]/c)),t===a)return n=o.get("sliceColors")[a%o.get("sliceColors").length],e&&(n=this.calcHighlightColor(n,o)),r.drawPieSlice(l,l,l-g,i,h,void 0,n);f=h}},render:function(t,e){this.init(t,e);let i,h,a=this.target,s=this.values,n=this.options,r=this.radius,o=n.get("borderWidth");for(o&&a.drawCircle(r,r,Math.floor(r-o/2),n.get("borderColor"),void 0,o).append(),h=s.length;h--;)s[h]&&(i=this.renderSlice(h).append(),this.valueShapes[h]=i.id,this.shapes[i.id]=h)}},box:{type:"box",init:function(t,e){let i=this.options,h=t.mergedOptions.width;t.mergedOptions.height;this.canvasWidth=t.mergedOptions.width,this.canvasHeight=t.mergedOptions.height,this.values=$.map(e,Number),this.width="auto"===i.get("width")?"4.0em":h,this.values.length||(this.disabled=1)},getRegion:function(){return 1},getCurrentRegionFields:function(){let t=[{field:"lq",value:this.quartiles[0]},{field:"med",value:this.quartiles[1]},{field:"uq",value:this.quartiles[2]}];return void 0!==this.loutlier&&t.push({field:"lo",value:this.loutlier}),void 0!==this.routlier&&t.push({field:"ro",value:this.routlier}),void 0!==this.lwhisker&&t.push({field:"lw",value:this.lwhisker}),void 0!==this.rwhisker&&t.push({field:"rw",value:this.rwhisker}),t},render:function(t,e){this.init(t,e);let i,h,s,n,r,o,l,g,d,u,p,c=this.target,f=this.values,M=f.length,m=this.options,v=this.canvasWidth,C=this.canvasHeight,x=void 0===m.get("chartRangeMin")?Math.min.apply(Math,f):m.get("chartRangeMin"),y=void 0===m.get("chartRangeMax")?Math.max.apply(Math,f):m.get("chartRangeMax"),R=0;if(m.get("raw"))m.get("showOutliers")&&f.length>5?(h=f[0],i=f[1],n=f[2],r=f[3],o=f[4],l=f[5],g=f[6]):(i=f[0],n=f[1],r=f[2],o=f[3],l=f[4]);else if(f.sort(function(t,e){return t-e}),n=a(f,1),r=a(f,2),s=(o=a(f,3))-n,m.get("showOutliers")){for(i=l=void 0,d=0;d<M;d++)void 0===i&&f[d]>n-s*m.get("outlierIQR")&&(i=f[d]),f[d]<o+s*m.get("outlierIQR")&&(l=f[d]);h=f[0],g=f[M-1]}else i=f[0],l=f[M-1];this.quartiles=[n,r,o],this.lwhisker=i,this.rwhisker=l,this.loutlier=h,this.routlier=g,p=v/(y-x+1),m.get("showOutliers")&&(R=Math.ceil(m.get("spotRadius")),p=(v-=2*Math.ceil(m.get("spotRadius")))/(y-x+1),h<i&&c.drawCircle((h-x)*p+R,C/2,m.get("spotRadius"),m.get("outlierLineColor"),m.get("outlierFillColor")).append(),g>l&&c.drawCircle((g-x)*p+R,C/2,m.get("spotRadius"),m.get("outlierLineColor"),m.get("outlierFillColor")).append()),c.drawRect(Math.round((n-x)*p+R),Math.round(.1*C),Math.round((o-n)*p),Math.round(.8*C),m.get("boxLineColor"),m.get("boxFillColor")).append(),c.drawLine(Math.round((i-x)*p+R),Math.round(C/2),Math.round((n-x)*p+R),Math.round(C/2),m.get("lineColor")).append(),c.drawLine(Math.round((i-x)*p+R),Math.round(C/4),Math.round((i-x)*p+R),Math.round(C-C/4),m.get("whiskerColor")).append(),c.drawLine(Math.round((l-x)*p+R),Math.round(C/2),Math.round((o-x)*p+R),Math.round(C/2),m.get("lineColor")).append(),c.drawLine(Math.round((l-x)*p+R),Math.round(C/4),Math.round((l-x)*p+R),Math.round(C-C/4),m.get("whiskerColor")).append(),c.drawLine(Math.round((r-x)*p+R),Math.round(.1*C),Math.round((r-x)*p+R),Math.round(.9*C),m.get("medianColor")).append(),m.get("target")&&(u=Math.ceil(m.get("spotRadius")),c.drawLine(Math.round((m.get("target")-x)*p+R),Math.round(C/2-u),Math.round((m.get("target")-x)*p+R),Math.round(C/2+u),m.get("targetColor")).append(),c.drawLine(Math.round((m.get("target")-x)*p+R-u),Math.round(C/2),Math.round((m.get("target")-x)*p+R+u),Math.round(C/2),m.get("targetColor")).append())}},shapeCount:0,shapes:{},shapeseq:[],lastShapeId:null,mergedOptions:null,init:function(t,e){let i,h,a;e=e||{};return a=(h=this.defaultOption).common,i=h[e.type||a.type],this.shapeCount=0,this.shapes={},this.shapeseq=[],this.lastShapeId=null,this.mergedOptions=$.extend({},a,i,e),this.mergedOptions.width=this.mergedOptions.width,this.mergedOptions.height=this.mergedOptions.height,this[this.mergedOptions.type].render(this,t),{shapes:this.shapes,shapeseq:this.shapeseq,offsetX:this.mergedOptions.offsetX,offsetY:this.mergedOptions.offsetY,pixelWidth:this.mergedOptions.width,pixelHeight:this.mergedOptions.height}},_getContext:function(t,e,i){let h;return h=null!=this.ctx?this.ctx:$("#"+this._canvasID).get(0).getContext("2d"),void 0!==t&&(h.strokeStyle=t),h.lineWidth=void 0===i?1:i,void 0!==e&&(h.fillStyle=e),h},reset:function(){this._getContext().clearRect(0,0,this.pixelWidth,this.pixelHeight),this.shapes={},this.shapeseq=[],this.currentTargetShapeId=void 0},_drawShape:function(t,e,i,h,a){let s,n,r=this._getContext(i,h,a);for(r.beginPath(),r.moveTo(e[0][0]+.5+this.offsetX,e[0][1]+.5+this.offsetY),s=1,n=e.length;s<n;s++)r.lineTo(e[s][0]+.5+this.offsetX,e[s][1]+.5+this.offsetY);void 0!==i&&r.stroke(),void 0!==h&&r.fill(),void 0!==this.targetX&&void 0!==this.targetY&&r.isPointInPath(this.targetX+this.offsetX,this.targetY+this.offsetY)&&(this.currentTargetShapeId=t)},_drawCircle:function(t,e,i,h,a,s,n){let r=this._getContext(a,s,n);r.beginPath(),e+=this.offsetX,i+=this.offsetY,r.arc(e,i,h,0,2*Math.PI,!1),void 0!==this.targetX&&void 0!==this.targetY&&r.isPointInPath(this.targetX+this.offsetX,this.targetY+this.offsetY)&&(this.currentTargetShapeId=t),void 0!==a&&r.stroke(),void 0!==s&&r.fill()},_drawPieSlice:function(t,e,i,h,a,s,n,r){let o=this._getContext(n,r);e+=this.offsetX,i+=this.offsetY,o.beginPath(),o.moveTo(e,i),o.arc(e,i,h,a,s,!1),o.lineTo(e,i),o.closePath(),void 0!==n&&o.stroke(),r&&o.fill(),void 0!==this.targetX&&void 0!==this.targetY&&o.isPointInPath(this.targetX+this.offsetX,this.targetY+this.offsetY)&&(this.currentTargetShapeId=t)},_drawRect:function(t,e,i,h,a,s,n){return this._drawShape(t,[[e,i],[e+h,i],[e+h,i+a],[e,i+a],[e,i]],s,n)},appendShape:function(t){return this.shapes[t.id]=t,this.shapeseq.push(t.id),this.lastShapeId=t.id,t.id},replaceWithShape:function(t,e){let i,h=this.shapeseq;for(this.shapes[e.id]=e,i=h.length;i--;)h[i]==t&&(h[i]=e.id);delete this.shapes[t]},replaceWithShapes:function(t,e){let i,h,a,s=this.shapeseq,n={};for(h=t.length;h--;)n[t[h]]=!0;for(h=s.length;h--;)n[i=s[h]]&&(s.splice(h,1),delete this.shapes[i],a=h);for(h=e.length;h--;)s.splice(a,0,e[h].id),this.shapes[e[h].id]=e[h]},insertAfterShape:function(t,e){let i,h=this.shapeseq;for(i=h.length;i--;)if(h[i]===t)return h.splice(i+1,0,e.id),void(this.shapes[e.id]=e)},removeShapeId:function(t){let e,i=this.shapeseq;for(e=i.length;e--;)if(i[e]===t){i.splice(e,1);break}delete this.shapes[t]},getShapeAt:function(t,e,i){return this.targetX=e,this.targetY=i,this.render(),this.currentTargetShapeId},_canvasID:"luckysheetTableContent",render:function(t,e,i,h,a,s,n,r){null==n&&(n="luckysheetTableContent"),this._canvasID=n,null!=r&&(this.ctx=r);let o,l,g,d=t.length;this._getContext();for(this.offsetX=i,this.offsetY=h,this.pixelWidth=a,this.pixelHeight=s,g=0;g<d;g++)this["_draw"+(l=e[o=t[g]]).type].apply(this,l.args)},drawLine:function(t,e,i,h,a,s){return this.drawShape([[t,e],[i,h]],a,s)},drawShape:function(t,e,i,h){return this._genShape("Shape",[t,e,i,h])},drawCircle:function(t,e,i,h,a,s){return this._genShape("Circle",[t,e,i,h,a,s])},drawPieSlice:function(t,e,i,h,a,s,n){return this._genShape("PieSlice",[t,e,i,h,a,s,n])},drawRect:function(t,e,i,h,a,s){return this._genShape("Rect",[t,e,i,h,a,s])},_genShape:function(t,e){let i=this.shapeCount++;e.unshift(i);let h={id:i,type:t,args:e};return this.shapes[i]=h,this.shapeseq.push(i),this.lastShapeId=i,{append:function(){return h},get:function(){return i}}}};let p=function(t){let e,i=this.currentRegion,h=this.target,a=this.regionShapes[i];a&&(e=this.renderRegion(i,t),$.isArray(e)||$.isArray(a)?(h.replaceWithShapes(a,e),this.regionShapes[i]=$.map(e,function(t){return t.id})):(h.replaceWithShape(a,e),this.regionShapes[i]=e.id))},c=function(t,e){this.init(t,e);let i,h,a,s,n=this.values,r=(this.target,this.regionShapes);for(a=n.length;a--;)if(i=this.renderRegion(a))if($.isArray(i)){for(h=[],s=i.length;s--;)i[s].append(),h.push(i[s].id);r[a]=h}else i.append(),r[a]=i.id;else r[a]=null},f={get:function(t){return u.mergedOptions[t]}},M={drawLine:function(t,e,i,h,a,s){return u.drawLine(t,e,i,h,a,s)},drawShape:function(t,e,i,h){return u.drawShape(t,e,i,h)},drawCircle:function(t,e,i,h,a,s){return u.drawCircle(t,e,i,h,a,s)},drawPieSlice:function(t,e,i,h,a,s,n){return u.drawPieSlice(t,e,i,h,a,s,n)},drawRect:function(t,e,i,h,a,s){return u.drawRect(t,e,i,h,a,s)}};for(let t in u)t in{line:null,bar:null,column:null,tristate:null,discrete:null,bullet:null,pie:null,box:null}&&(u[t].options=f,u[t].target=M),t in{bar:null,column:null,tristate:null,discrete:null}&&(u[t].changeHighlight=p,u[t].render=c);return u});
//# sourceMappingURL=../sourcemaps/controllers/sparkline.js.map
