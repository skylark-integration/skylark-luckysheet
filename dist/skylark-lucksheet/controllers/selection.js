/**
 * skylark-lucksheet - A version of lucksheet.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["../widgets/select","./conditionformat","../methods/protection_methods","../methods/luckysheetConfigsetting","../widgets/tooltip","../methods/formula_methods","../methods/border","../methods/getdata","../methods/getRowlen","../methods/validate","../methods/format","../methods/get","../methods/cells","../utils/util","../store","../locale/locale"],function(e,l,t,n,o,r,c,a,i,u,f,s,d,g,h,m){"use strict";const{selectHightlightShow:y,selectionCopyShow:_}=e,{checkProtectionLockedRangeList:p}=t,{getBorderInfoCompute:w}=c,{getdatabyselection:b,getcellvalue:x,datagridgrowth:v}=a,{rowlenByRange:I}=u,{hasPartMC:k,isRealNum:S}=f,C=n.isEditMode,{genarate:R,update:D}=s,{getSheetIndex:H}=d,{replaceHtml:T,getObjType:V,luckysheetfontformat:M}=g;return{clearcopy:function(e){let l=window.clipboardData;l||e&&(l=e.originalEvent.clipboardData);if(h.luckysheet_selection_range=[],_(),l)return l.setData("Text"," "),!1;{let e=$("#luckysheet-copy-content").css("visibility","hidden");e.val(" "),e.focus(),e.select(),setTimeout(function(){e.blur().css("visibility","visible")},10)}},getHtmlBorderStyle:function(e,l){let t="";return(e={0:"none",1:"Thin",2:"Hair",3:"Dotted",4:"Dashed",5:"DashDot",6:"DashDotDot",7:"Double",8:"Medium",9:"MediumDashed",10:"MediumDashDot",11:"MediumDashDotDot",12:"SlantedDashDot",13:"Thick"}[e.toString()]).indexOf("Medium")>-1?t+="1pt ":t+="Thick"==e?"1.5pt ":"0.5pt ","Hair"==e?t+="double ":e.indexOf("DashDotDot")>-1?t+="dotted ":e.indexOf("DashDot")>-1?t+="dashed ":e.indexOf("Dotted")>-1?t+="dotted ":e.indexOf("Dashed")>-1?t+="dashed ":t+="solid ",t+l+";"},copy:function(e){let l=window.clipboardData;l||(l=e.originalEvent.clipboardData),h.luckysheet_selection_range=[];let t=[],n=[],o=[],r=!1,c=!1;for(let e=0;e<h.luckysheet_select_save.length;e++){let l=h.luckysheet_select_save[e],a=l.row[0],i=l.row[1],u=l.column[0],f=l.column[1];for(let e=a;e<=i;e++)if(null==h.config.rowhidden||null==h.config.rowhidden[e]){t.includes(e)||t.push(e),null!=h.config.rowlen&&e in h.config.rowlen&&(r=!0);for(let l=u;l<=f;l++){if(null!=h.config.colhidden&&null!=h.config.colhidden[l])continue;n.includes(l)||n.push(l);let t=h.flowdata[e][l];"object"==V(t)&&"mc"in t&&null!=t.mc.rs&&(c=!0)}}h.luckysheet_selection_range.push({row:l.row,column:l.column}),o.push({row:l.row,column:l.column})}_(),h.luckysheet_copy_save={dataSheetIndex:h.currentSheetIndex,copyRange:o,RowlChange:r,HasMC:c};let a,u=this;h.config.borderInfo&&h.config.borderInfo.length>0&&(a=w());let f="",s=h.deepCopyFlowData(h.flowdata),d="";for(let e=0;e<t.length;e++){let l=t[e];if(null==h.config.rowhidden||null==h.config.rowhidden[l]){f+="<tr>";for(let e=0;e<n.length;e++){let o=n[e];if(null!=h.config.colhidden&&null!=h.config.colhidden[o])continue;let r='<td ${span} style="${style}">';if(null!=s[l]&&null!=s[l][o]){let e="",c="";l==t[0]&&(null==h.config||null==h.config.columnlen||null==h.config.columnlen[o.toString()]?d+='<colgroup width="72px"></colgroup>':d+='<colgroup width="'+h.config.columnlen[o.toString()]+'px"></colgroup>'),o==n[0]&&(null==h.config||null==h.config.rowlen||null==h.config.rowlen[l.toString()]?e+="height:19px;":e+="height:"+h.config.rowlen[l.toString()]+"px;");let f,g=/^(w|W)((0?)|(0\.0+))$/;if(f=null!=s[l][o].ct&&null!=s[l][o].ct.fa&&s[l][o].ct.fa.match(g)?x(l,o,s):x(l,o,s,"m"),e+=i.getStyleByCell(s,l,o),"object"==V(s[l][o])&&"mc"in s[l][o]){if(!("rs"in s[l][o].mc))continue;if(c='rowspan="'+s[l][o].mc.rs+'" colspan="'+s[l][o].mc.cs+'"',a&&a[l+"_"+o]){let t={color:{},style:{}},n={color:{},style:{}},r={color:{},style:{}},c={color:{},style:{}};for(let e=l;e<l+s[l][o].mc.rs;e++)for(let i=o;i<o+s[l][o].mc.cs;i++){if(e==l&&a[e+"_"+i]&&a[e+"_"+i].t){let l=a[e+"_"+i].t.style,t=a[e+"_"+i].t.color;null==r.style[l]?r.style[l]=1:r.style[l]=r.style[l]+1,null==r.color[t]?r.color[t]=1:r.color[t]=r.color[t]+1}if(e==l+s[l][o].mc.rs-1&&a[e+"_"+i]&&a[e+"_"+i].b){let l=a[e+"_"+i].b.style,t=a[e+"_"+i].b.color;null==c.style[l]?c.style[l]=1:c.style[l]=c.style[l]+1,null==c.color[t]?c.color[t]=1:c.color[t]=c.color[t]+1}if(i==o&&a[e+"_"+i]&&a[e+"_"+i].l){let n=a[l+"_"+o].l.style,r=a[e+"_"+i].l.color;null==t.style[n]?t.style[n]=1:t.style[n]=t.style[n]+1,null==t.color[r]?t.color[r]=1:t.color[r]=t.color[r]+1}if(i==o+s[l][o].mc.cs-1&&a[e+"_"+i]&&a[e+"_"+i].r){let l=a[e+"_"+i].r.style,t=a[e+"_"+i].r.color;null==n.style[l]?n.style[l]=1:n.style[l]=n.style[l]+1,null==n.color[t]?n.color[t]=1:n.color[t]=n.color[t]+1}}let i=s[l][o].mc.rs,f=s[l][o].mc.cs;if(JSON.stringify(t).length>23){let l=null,n=null;for(let e in t.color)t.color[e]>=i/2&&(l=e);for(let e in t.style)t.style[e]>=i/2&&(n=e);null!=l&&null!=n&&(e+="border-left:"+u.getHtmlBorderStyle(n,l))}if(JSON.stringify(n).length>23){let l=null,t=null;for(let e in n.color)n.color[e]>=i/2&&(l=e);for(let e in n.style)n.style[e]>=i/2&&(t=e);null!=l&&null!=t&&(e+="border-right:"+u.getHtmlBorderStyle(t,l))}if(JSON.stringify(r).length>23){let l=null,t=null;for(let e in r.color)r.color[e]>=f/2&&(l=e);for(let e in r.style)r.style[e]>=f/2&&(t=e);null!=l&&null!=t&&(e+="border-top:"+u.getHtmlBorderStyle(t,l))}if(JSON.stringify(c).length>23){let l=null,t=null;for(let e in c.color)c.color[e]>=f/2&&(l=e);for(let e in c.style)c.style[e]>=f/2&&(t=e);null!=l&&null!=t&&(e+="border-bottom:"+u.getHtmlBorderStyle(t,l))}}}else if(a&&a[l+"_"+o]){if(a[l+"_"+o].l){let t=a[l+"_"+o].l.style,n=a[l+"_"+o].l.color;e+="border-left:"+u.getHtmlBorderStyle(t,n)}if(a[l+"_"+o].r){let t=a[l+"_"+o].r.style,n=a[l+"_"+o].r.color;e+="border-right:"+u.getHtmlBorderStyle(t,n)}if(a[l+"_"+o].b){let t=a[l+"_"+o].b.style,n=a[l+"_"+o].b.color;e+="border-bottom:"+u.getHtmlBorderStyle(t,n)}if(a[l+"_"+o].t){let t=a[l+"_"+o].t.style,n=a[l+"_"+o].t.color;e+="border-top:"+u.getHtmlBorderStyle(t,n)}}r=T(r,{style:e,span:c}),null==f&&(f=x(l,o,s)),null==f&&(f=""),r+=f}else{let e="";if(a&&a[l+"_"+o]){if(a[l+"_"+o].l){let t=a[l+"_"+o].l.style,n=a[l+"_"+o].l.color;e+="border-left:"+u.getHtmlBorderStyle(t,n)}if(a[l+"_"+o].r){let t=a[l+"_"+o].r.style,n=a[l+"_"+o].r.color;e+="border-right:"+u.getHtmlBorderStyle(t,n)}if(a[l+"_"+o].b){let t=a[l+"_"+o].b.style,n=a[l+"_"+o].b.color;e+="border-bottom:"+u.getHtmlBorderStyle(t,n)}if(a[l+"_"+o].t){let t=a[l+"_"+o].t.style,n=a[l+"_"+o].t.color;e+="border-top:"+u.getHtmlBorderStyle(t,n)}}r+="",l==t[0]&&(null==h.config||null==h.config.columnlen||null==h.config.columnlen[o.toString()]?d+='<colgroup width="72px"></colgroup>':d+='<colgroup width="'+h.config.columnlen[o.toString()]+'px"></colgroup>'),o==n[0]&&(null==h.config||null==h.config.rowlen||null==h.config.rowlen[l.toString()]?e+="height:19px;":e+="height:"+h.config.rowlen[l.toString()]+"px;"),r=T(r,{style:e,span:""}),r+=""}f+=r+="</td>"}f+="</tr>"}}if(f='<table data-type="luckysheet_copy_action_table">'+d+f+"</table>",h.iscopyself=!0,l)return l.setData("Text",f),!1;var g=document.createElement("input");g.setAttribute("readonly","readonly"),g.value=f,document.body.appendChild(g),g.select(),document.execCommand("Copy"),g.style.display="none",document.body.removeChild(g)},copybyformat:function(e,l){let t=window.clipboardData;t||(t=e.originalEvent&&e.originalEvent.clipboardData),h.luckysheet_selection_range=[{row:h.luckysheet_select_save[0].row,column:h.luckysheet_select_save[0].column}],_();let n=l;if(h.iscopyself=!0,t)return t.setData("Text",n),!1;{let e=$("#luckysheet-copy-content");e.text(n),e.focus(),e.select(),document.execCommand("selectAll"),document.execCommand("Copy"),setTimeout(function(){e.blur()},10)}},isPasteAction:!1,paste:function(e,l){let t=this;if(!1===h.allowEdit)return;const n=m().drag;let r=$("#luckysheet-copy-content");r.focus(),r.select(),setTimeout(function(){let c=r.html();c.indexOf("luckysheet_copy_action_table")>-1&&null!=h.luckysheet_copy_save.copyRange&&h.luckysheet_copy_save.copyRange.length>0?h.luckysheet_paste_iscut?(h.luckysheet_paste_iscut=!1,t.pasteHandlerOfCutPaste(h.luckysheet_copy_save),t.clearcopy(e)):t.pasteHandlerOfCopyPaste(h.luckysheet_copy_save):"btn"!=l?t.pasteHandler(c):C()?alert(n.pasteMustKeybordAlert):o.info(n.pasteMustKeybordAlertHTMLTitle,n.pasteMustKeybordAlertHTML)},10)},pasteHandler:function(e,l){if(p(h.luckysheet_select_save,h.currentSheetIndex)&&!1!==h.allowEdit)if(h.luckysheet_select_save.length>1&&(C()?alert("不能对多重选择区域执行此操作，请选择单个区域，然后再试"):o.info('<i class="fa fa-exclamation-triangle"></i>提示',"不能对多重选择区域执行此操作，请选择单个区域，然后再试")),"object"==typeof e){if(0==e.length)return;let t=$.extend(!0,{},h.config);null==t.merge&&(t.merge={}),JSON.stringify(l).length>2&&null==t.borderInfo&&(t.borderInfo=[]);let n=e.length,r=e[0].length,c=h.luckysheet_select_save[0].row[0],a=c+n-1,u=h.luckysheet_select_save[0].column[0],f=u+r-1,s=!1;if(null!=t.merge&&(s=k(t,c,a,u,f)),s)return void(C()?alert("不能对合并单元格做部分更改"):o.info('<i class="fa fa-exclamation-triangle"></i>提示',"不能对合并单元格做部分更改"));let d=h.deepCopyFlowData(h.flowdata),g=a-d.length+1,m=f-d[0].length+1;(g>0||m>0)&&(d=v([].concat(d),g,m,!0)),null==t.rowlen&&(t.rowlen={});let _=!1,p={};for(let n=c;n<=a;n++){let o=[].concat(d[n]),r=h.defaultrowlen;null!=t.rowlen[n]&&(r=t.rowlen[n]);for(let a=u;a<=f;a++){"object"==V(o[a])&&"mc"in o[a]&&("rs"in o[a].mc&&delete t.merge[o[a].mc.r+"_"+o[a].mc.c],delete o[a].mc);let f=null;if(null!=e[n-c]&&null!=e[n-c][a-u]&&(f=e[n-c][a-u]),o[a]=$.extend(!0,{},f),null!=f&&"mc"in o[a]&&(null!=o[a].mc.rs?(o[a].mc.r=n,o[a].mc.c=a,t.merge[o[a].mc.r+"_"+o[a].mc.c]=o[a].mc,p[f.mc.r+"_"+f.mc.c]=[o[a].mc.r,o[a].mc.c]):o[a]={mc:{r:p[f.mc.r+"_"+f.mc.c][0],c:p[f.mc.r+"_"+f.mc.c][1]}}),l[n-c+"_"+(a-u)]){let e={rangeType:"cell",value:{row_index:n,col_index:a,l:l[n-c+"_"+(a-u)].l,r:l[n-c+"_"+(a-u)].r,t:l[n-c+"_"+(a-u)].t,b:l[n-c+"_"+(a-u)].b}};t.borderInfo.push(e)}let s=M(o[a]),d=i.getTextSize("田",s)[1];d>r&&(r=d,_=!0)}d[n]=o,r!=h.defaultrowlen&&(t.rowlen[n]=r)}if(h.luckysheet_select_save=[{row:[c,a],column:[u,f]}],g>0||m>0||_){let e={cfg:t,RowlChange:!0};h.refreshRange(d,h.luckysheet_select_save,e)}else{let e={cfg:t};h.refreshRange(d,h.luckysheet_select_save,e),y()}}else{let l=[],t=(e=e.replace(/\r/g,"")).split("\n"),n=t[0].split("\t").length;for(let e=0;e<t.length;e++)t[e].split("\t").length<n||l.push(t[e].split("\t"));let c=h.deepCopyFlowData(h.flowdata),a=h.luckysheet_select_save[h.luckysheet_select_save.length-1],i=null==a.row?0:a.row[0],u=null==a.column?0:a.column[0],f=l.length,s=l[0].length,d=!1;if(null!=h.config.merge&&(d=k(h.config,i,i+f-1,u,u+s-1)),d)return void(C()?alert("不能对合并单元格做部分更改"):o.info('<i class="fa fa-exclamation-triangle"></i>提示',"不能对合并单元格做部分更改"));let g=i+f-c.length,m=u+s-c[0].length;(g>0||m>0)&&(c=v([].concat(c),g,m,!0));for(let e=0;e<f;e++){let t=[].concat(c[e+i]);for(let n=0;n<s;n++){let o=t[n+u],c=l[e][n];if(S(c)&&(c=o&&o.ct&&"@"===o.ct.fa?String(c):parseFloat(c)),o instanceof Object)o.v=c,null!=o.ct&&null!=o.ct.fa?o.m=D(o.ct.fa,c):o.m=c,null!=o.f&&o.f.length>0&&(o.f="",r.delFunctionGroup(e+i,n+u,h.currentSheetIndex));else{let e={},l=R(c);e.v=l[2],e.ct=l[1],e.m=l[0],t[n+u]=e}}c[e+i]=t}if(a.row=[i,i+f-1],a.column=[u,u+s-1],g>0||m>0){let e={RowlChange:!0};h.refreshRange(c,h.luckysheet_select_save,e)}else h.refreshRange(c,h.luckysheet_select_save),y()}},pasteHandlerOfCutPaste:function(e){if(!p(h.luckysheet_select_save,h.currentSheetIndex))return;if(!1===h.allowEdit)return;let t=$.extend(!0,{},h.config);null==t.merge&&(t.merge={});let n=e.HasMC,r=e.RowlChange,c=e.dataSheetIndex,a=e.copyRange[0].row[0],i=e.copyRange[0].row[1],u=e.copyRange[0].column[0],f=e.copyRange[0].column[1],s=$.extend(!0,[],b({row:[a,i],column:[u,f]},c)),d=s.length,g=s[0].length,m=h.luckysheet_select_save[h.luckysheet_select_save.length-1],y=m.row_focus,_=y+d-1,x=m.column_focus,S=x+g-1,R=!1;if(null!=t.merge&&(R=k(t,y,_,x,S)),R)return void(C()?alert("不能对合并单元格做部分更改"):o.info('<i class="fa fa-exclamation-triangle"></i>提示',"不能对合并单元格做部分更改"));let D=h.deepCopyFlowData(h.flowdata),T=d+y-D.length,M=g+x-D[0].length;(T>0||M>0)&&(D=v([].concat(D),T,M,!0));let O=w(c),B=$.extend(!0,{},h.luckysheetfile[H(c)].dataVerification),F=$.extend(!0,{},h.luckysheetfile[H(h.currentSheetIndex)].dataVerification);if(h.currentSheetIndex==c){for(let e=a;e<=i;e++)for(let l=u;l<=f;l++){let n=D[e][l];"object"==V(n)&&"mc"in n&&("rs"in n.mc&&delete t.merge[n.mc.r+"_"+n.mc.c],delete n.mc),D[e][l]=null,delete F[e+"_"+l]}if(t.borderInfo&&t.borderInfo.length>0){let e=[];for(let n=0;n<t.borderInfo.length;n++){let o=t.borderInfo[n].rangeType;if("range"==o){let o=t.borderInfo[n].range,r=[];for(let e=0;e<o.length;e++)r=r.concat(l.CFSplitRange(o[e],{row:[a,i],column:[u,f]},{row:[y,_],column:[x,S]},"restPart"));t.borderInfo[n].range=r,e.push(t.borderInfo[n])}else if("cell"==o){let l=t.borderInfo[n].value.row_index,o=t.borderInfo[n].value.col_index;l>=a&&l<=i&&o>=u&&o<=f||e.push(t.borderInfo[n])}}t.borderInfo=e}}let P,j,E={};for(let e=y;e<=_;e++){let l=[].concat(D[e]);for(let o=x;o<=S;o++){if(O[a+e-y+"_"+(u+o-x)]){let l={rangeType:"cell",value:{row_index:e,col_index:o,l:O[a+e-y+"_"+(u+o-x)].l,r:O[a+e-y+"_"+(u+o-x)].r,t:O[a+e-y+"_"+(u+o-x)].t,b:O[a+e-y+"_"+(u+o-x)].b}};null==t.borderInfo&&(t.borderInfo=[]),t.borderInfo.push(l)}else if(O[e+"_"+o]){let l={rangeType:"cell",value:{row_index:e,col_index:o,l:null,r:null,t:null,b:null}};null==t.borderInfo&&(t.borderInfo=[]),t.borderInfo.push(l)}B[a+e-y+"_"+(u+o-x)]&&(F[e+"_"+o]=B[a+e-y+"_"+(u+o-x)]),"object"==V(l[o])&&"mc"in l[o]&&("rs"in l[o].mc&&delete t.merge[l[o].mc.r+"_"+l[o].mc.c],delete l[o].mc);let r=null;null!=s[e-y]&&null!=s[e-y][o-x]&&(r=s[e-y][o-x]),l[o]=$.extend(!0,{},r),null!=r&&n&&"mc"in l[o]&&(null!=l[o].mc.rs?(l[o].mc.r=e,l[o].mc.c=o,t.merge[l[o].mc.r+"_"+l[o].mc.c]=l[o].mc,E[r.mc.r+"_"+r.mc.c]=[l[o].mc.r,l[o].mc.c]):l[o]={mc:{r:E[r.mc.r+"_"+r.mc.c][0],c:E[r.mc.r+"_"+r.mc.c][1]}})}D[e]=l}if(m.row=[y,_],m.column=[x,S],r&&(h.currentSheetIndex!=c?t=I(D,y,_,t):(t=I(D,a,i,t),t=I(D,y,_,t))),h.currentSheetIndex!=c){let e=$.extend(!0,[],h.luckysheetfile[H(c)].data),n=$.extend(!0,{},h.luckysheetfile[H(c)].config),o=$.extend(!0,[],e),s=$.extend(!0,{},n);null==s.merge&&(s.merge={});for(let e=a;e<=i;e++)for(let l=u;l<=f;l++){let t=o[e][l];"object"==V(t)&&"mc"in t&&("rs"in t.mc&&delete s.merge[t.mc.r+"_"+t.mc.c],delete t.mc),o[e][l]=null}if(r&&(s=I(o,a,i,s)),s.borderInfo&&s.borderInfo.length>0){let e=[];for(let t=0;t<s.borderInfo.length;t++){let n=s.borderInfo[t].rangeType;if("range"==n){let n=s.borderInfo[t].range,o=[];for(let e=0;e<n.length;e++)o=o.concat(l.CFSplitRange(n[e],{row:[a,i],column:[u,f]},{row:[y,_],column:[x,S]},"restPart"));s.borderInfo[t].range=o,e.push(s.borderInfo[t])}else if("cell"==n){let l=s.borderInfo[t].value.row_index,n=s.borderInfo[t].value.col_index;l>=a&&l<=i&&n>=u&&n<=f||e.push(s.borderInfo[t])}}s.borderInfo=e}let d=$.extend(!0,[],h.luckysheetfile[H(c)].luckysheet_conditionformat_save),g=$.extend(!0,[],d),m=[];if(null!=g&&g.length>0)for(let e=0;e<g.length;e++){let t=g[e].cellrange,n=[],o=[];for(let e=0;e<t.length;e++){let r=l.CFSplitRange(t[e],{row:[a,i],column:[u,f]},{row:[y,_],column:[x,S]},"restPart");n=n.concat(r);let c=l.CFSplitRange(t[e],{row:[a,i],column:[u,f]},{row:[y,_],column:[x,S]},"operatePart");c.length>0&&(o=o.concat(c))}if(g[e].cellrange=n,o.length>0){let l=$.extend(!0,{},g[e]);l.cellrange=o,m.push(l)}}let p=$.extend(!0,[],h.luckysheetfile[H(h.currentSheetIndex)].luckysheet_conditionformat_save),w=$.extend(!0,[],p);m.length>0&&(w=w.concat(m));for(let e=a;e<=i;e++)for(let l=u;l<=f;l++)delete B[e+"_"+l];P={sheetIndex:c,data:e,curData:o,config:n,curConfig:s,cdformat:d,curCdformat:g,dataVerification:$.extend(!0,{},h.luckysheetfile[H(c)].dataVerification),curDataVerification:B,range:{row:[a,i],column:[u,f]}},j={sheetIndex:h.currentSheetIndex,data:h.flowdata,curData:D,config:$.extend(!0,{},h.config),curConfig:t,cdformat:p,curCdformat:w,dataVerification:$.extend(!0,{},h.luckysheetfile[H(h.currentSheetIndex)].dataVerification),curDataVerification:F,range:{row:[y,_],column:[x,S]}}}else{let e=$.extend(!0,[],h.luckysheetfile[H(h.currentSheetIndex)].luckysheet_conditionformat_save),n=$.extend(!0,[],e);if(null!=n&&n.length>0)for(let e=0;e<n.length;e++){let t=n[e].cellrange,o=[];for(let e=0;e<t.length;e++){let n=l.CFSplitRange(t[e],{row:[a,i],column:[u,f]},{row:[y,_],column:[x,S]},"allPart");o=o.concat(n)}n[e].cellrange=o}P={sheetIndex:h.currentSheetIndex,data:h.flowdata,curData:D,config:$.extend(!0,{},h.config),curConfig:t,cdformat:e,curCdformat:n,dataVerification:$.extend(!0,{},h.luckysheetfile[H(h.currentSheetIndex)].dataVerification),curDataVerification:F,range:{row:[a,i],column:[u,f]}},j={sheetIndex:h.currentSheetIndex,data:h.flowdata,curData:D,config:$.extend(!0,{},h.config),curConfig:t,cdformat:e,curCdformat:n,dataVerification:$.extend(!0,{},h.luckysheetfile[H(h.currentSheetIndex)].dataVerification),curDataVerification:F,range:{row:[y,_],column:[x,S]}}}T>0||M>0?h.refreshGrid_pastcut(P,j,!0):h.refreshGrid_pastcut(P,j,r)},pasteHandlerOfCopyPaste:function(e){if(!p(h.luckysheet_select_save,h.currentSheetIndex))return;let t=$.extend(!0,{},h.config);null==t.merge&&(t.merge={});let n=e.HasMC,c=e.RowlChange,a=e.dataSheetIndex,i=e.copyRange[0].row[0],u=e.copyRange[0].row[1],f=e.copyRange[0].column[0],s=e.copyRange[0].column[1],d=[],g=!1;for(let l=0;l<e.copyRange.length;l++){let t=b({row:e.copyRange[l].row,column:e.copyRange[l].column},a);e.copyRange.length>1?i==e.copyRange[1].row[0]&&u==e.copyRange[1].row[1]?(t=t[0].map(function(e,l){return t.map(function(e){return e[l]})}),d=d.concat(t),g=!0):f==e.copyRange[1].column[0]&&s==e.copyRange[1].column[1]&&(d=d.concat(t)):d=t}g&&(d=d[0].map(function(e,l){return d.map(function(e){return e[l]})}));let m=$.extend(!0,[],d);if(e.copyRange.length>1)for(let e=0;e<m.length;e++)for(let l=0;l<m[e].length;l++)null!=m[e][l]&&null!=m[e][l].f&&(delete m[e][l].f,delete m[e][l].spl);let _=m.length,x=m[0].length,S=h.luckysheet_select_save[h.luckysheet_select_save.length-1],R=S.row[0],T=S.row[1],M=S.column[0],O=S.column[1];0==(T-R+1)%_&&0==(O-M+1)%x||(T=R+_-1,O=M+x-1);let B=!1;if(null!=t.merge&&(B=k(t,R,T,M,O)),B)return void(C()?alert("不能对合并单元格做部分更改"):o.info('<i class="fa fa-exclamation-triangle"></i>提示',"不能对合并单元格做部分更改"));let F=(T-R+1)/_,P=(O-M+1)/x,j=h.deepCopyFlowData(h.flowdata),E=_+R-j.length,A=x+M-j[0].length;(E>0||A>0)&&(j=v([].concat(j),E,A,!0));let N=w(a),J=$.extend(!0,{},h.luckysheetfile[H(a)].dataVerification),L=null,G=0,K=0,z=0,W=0;for(let e=1;e<=F;e++)for(let l=1;l<=P;l++){W=R+e*_,z=M+l*x;let o=(G=R+(e-1)*_)-i,c=(K=M+(l-1)*x)-f,a={};for(let e=G;e<W;e++){let l=[].concat(j[e]);for(let u=K;u<z;u++){if(N[i+e-G+"_"+(f+u-K)]){let l={rangeType:"cell",value:{row_index:e,col_index:u,l:N[i+e-G+"_"+(f+u-K)].l,r:N[i+e-G+"_"+(f+u-K)].r,t:N[i+e-G+"_"+(f+u-K)].t,b:N[i+e-G+"_"+(f+u-K)].b}};null==t.borderInfo&&(t.borderInfo=[]),t.borderInfo.push(l)}else if(N[e+"_"+u]){let l={rangeType:"cell",value:{row_index:e,col_index:u,l:null,r:null,t:null,b:null}};null==t.borderInfo&&(t.borderInfo=[]),t.borderInfo.push(l)}J[i+e-G+"_"+(f+u-K)]&&(null==L&&(L=$.extend(!0,{},h.luckysheetfile[H(h.currentSheetIndex)].dataVerification)),L[e+"_"+u]=J[i+e-G+"_"+(f+u-K)]),"object"==V(l[u])&&"mc"in l[u]&&("rs"in l[u].mc&&delete t.merge[l[u].mc.r+"_"+l[u].mc.c],delete l[u].mc);let s=null;if(null!=m[e-G]&&null!=m[e-G][u-K]&&(s=$.extend(!0,{},m[e-G][u-K])),null!=s&&null!=s.f){let l=s.f;o>0&&(l="="+r.functionCopy(l,"down",o)),o<0&&(l="="+r.functionCopy(l,"up",Math.abs(o))),c>0&&(l="="+r.functionCopy(l,"right",c)),c<0&&(l="="+r.functionCopy(l,"left",Math.abs(c)));let t=r.execfunction(l,e,u,void 0,!0);null!=s.spl?(s.f=t[2],s.v=t[1],s.spl=t[3].data):(s.f=t[2],s.v=t[1],null!=s.ct&&null!=s.ct.fa&&(s.m=D(s.ct.fa,t[1])))}l[u]=$.extend(!0,{},s),null!=s&&n&&"mc"in l[u]&&(null!=l[u].mc.rs?(l[u].mc.r=e,l[u].mc.c=u,t.merge[l[u].mc.r+"_"+l[u].mc.c]=l[u].mc,a[s.mc.r+"_"+s.mc.c]=[l[u].mc.r,l[u].mc.c]):l[u]={mc:{r:a[s.mc.r+"_"+s.mc.c][0],c:a[s.mc.r+"_"+s.mc.c][1]}})}j[e]=l}}let q=null;if(1==e.copyRange.length){let e=h.luckysheetfile[H(a)],t=h.luckysheetfile[H(h.currentSheetIndex)],n=$.extend(!0,[],e.luckysheet_conditionformat_save);if(null!=n&&n.length>0){q=$.extend(!0,[],t.luckysheet_conditionformat_save);for(let e=0;e<n.length;e++){let t=n[e].cellrange,o=[];for(let e=1;e<=F;e++)for(let n=1;n<=P;n++){G=R+(e-1)*_,K=M+(n-1)*x,W=R+e*_,z=M+n*x;for(let e=0;e<t.length;e++){let n=l.CFSplitRange(t[e],{row:[i,u],column:[f,s]},{row:[G,W-1],column:[K,z-1]},"operatePart");n.length>0&&(o=o.concat(n))}}o.length>0&&(n[e].cellrange=o,q.push(n[e]))}}}if(S.row=[R,T],S.column=[M,O],c||E>0||A>0){let e={cfg:t=I(j,R,T,t),RowlChange:!0,cdformat:q,dataVerification:L};h.refreshRange(j,h.luckysheet_select_save,e)}else{let e={cfg:t,cdformat:q,dataVerification:L};h.refreshRange(j,h.luckysheet_select_save,e),y()}},pasteHandlerOfPaintModel:function(e){if(!p(h.luckysheet_select_save,h.currentSheetIndex))return;let t=$.extend(!0,{},h.config);null==t.merge&&(t.merge={});let n=e.HasMC,r=e.RowlChange,c=e.dataSheetIndex,a=e.copyRange[0].row[0],i=e.copyRange[0].row[1],u=e.copyRange[0].column[0],f=e.copyRange[0].column[1],s=$.extend(!0,[],b({row:[a,i],column:[u,f]},c)),d=h.luckysheet_select_save[h.luckysheet_select_save.length-1],g=d.row[0],m=d.row[1],_=d.column[0],x=d.column[1],v=s.length,S=s[0].length;if(g==m&&_==x){let e=!1;if(null!=t.merge&&(e=k(t,g,g+v-1,_,_+S-1)),e)return void(C()?alert("不能对合并单元格做部分更改"):o.info('<i class="fa fa-exclamation-triangle"></i>提示',"不能对合并单元格做部分更改"));m=g+v-1,x=_+S-1}let R=Math.ceil((m-g+1)/v),T=Math.ceil((x-_+1)/S),M=h.deepCopyFlowData(h.flowdata),O=M[0].length,B=M.length,F=w(c),P=$.extend(!0,{},h.luckysheetfile[H(c)].dataVerification),j=null,E=0,A=0,N=0,J=0;for(let e=1;e<=R;e++)for(let l=1;l<=T;l++){E=g+(e-1)*v,A=_+(l-1)*S,(J=g+e*v>B?B:g+e*v)>m+1&&(J=m+1),(N=_+l*S>O?O:_+l*S)>x+1&&(N=x+1);let o={};for(let e=E;e<J;e++){let l=[].concat(M[e]);for(let r=A;r<N;r++){if(F[a+e-E+"_"+(u+r-A)]){let l={rangeType:"cell",value:{row_index:e,col_index:r,l:F[a+e-E+"_"+(u+r-A)].l,r:F[a+e-E+"_"+(u+r-A)].r,t:F[a+e-E+"_"+(u+r-A)].t,b:F[a+e-E+"_"+(u+r-A)].b}};null==t.borderInfo&&(t.borderInfo=[]),t.borderInfo.push(l)}else if(F[e+"_"+r]){let l={rangeType:"cell",value:{row_index:e,col_index:r,l:null,r:null,t:null,b:null}};null==t.borderInfo&&(t.borderInfo=[]),t.borderInfo.push(l)}P[a+e-E+"_"+(u+r-A)]&&(null==j&&(j=$.extend(!0,{},h.luckysheetfile[H(h.currentSheetIndex)].dataVerification)),j[e+"_"+r]=P[a+e-E+"_"+(u+r-A)]),"object"==V(l[r])&&"mc"in l[r]&&("rs"in l[r].mc&&delete t.merge[l[r].mc.r+"_"+l[r].mc.c],delete l[r].mc);let c=null;if(null!=s[e-E]&&null!=s[e-E][r-A]&&(c=s[e-E][r-A]),null!=c&&(delete c.v,delete c.m,delete c.f,delete c.spl,c.ct&&"inlineStr"==c.ct.t&&delete c.ct,"object"==V(l[r])||(l[r]={v:l[r]}),l[r]=$.extend(!0,l[r],c),n&&"mc"in l[r]&&(null!=l[r].mc.rs?(l[r].mc.r=e,l[r].mc.rs+e>=J&&(l[r].mc.rs=J-e),l[r].mc.c=r,l[r].mc.cs+r>=N&&(l[r].mc.cs=N-r),t.merge[l[r].mc.r+"_"+l[r].mc.c]=l[r].mc,o[c.mc.r+"_"+c.mc.c]=[l[r].mc.r,l[r].mc.c]):l[r]={mc:{r:o[c.mc.r+"_"+c.mc.c][0],c:o[c.mc.r+"_"+c.mc.c][1]}}),null!=l[r].v&&null!=c.ct&&null!=c.ct.fa)){let e=D(c.ct.fa,l[r].v);l[r].m=e}}M[e]=l}}let L=null,G=$.extend(!0,[],h.luckysheetfile[H(c)].luckysheet_conditionformat_save);if(null!=G&&G.length>0){L=$.extend(!0,[],h.luckysheetfile[H(h.currentSheetIndex)].luckysheet_conditionformat_save);for(let e=0;e<G.length;e++){let t=G[e].cellrange,n=[];for(let e=0;e<t.length;e++){let o=l.CFSplitRange(t[e],{row:[a,i],column:[u,f]},{row:[g,m],column:[_,x]},"operatePart");o.length>0&&(n=n.concat(o))}n.length>0&&(G[e].cellrange=[{row:[g,m],column:[_,x]}],L.push(G[e]))}}if(d.row=[g,m],d.column=[_,x],r){let e={cfg:t=I(M,g,m,t),RowlChange:!0,cdformat:L,dataVerification:j};h.refreshRange(M,h.luckysheet_select_save,e)}else{let e={cfg:t,cdformat:L,dataVerification:j};h.refreshRange(M,h.luckysheet_select_save,e),y()}},matchcopy:function(e,l){let t,n,o=[],r=[];if("object"==typeof e)o=e;else{o=e.split("\n");for(let e=0;e<o.length;e++)o[e]=o[e].split("\t")}if(t=o.length,"object"==typeof l)r=l;else{r=l.split("\n");for(let e=0;e<r.length;e++)r[e]=r[e].split("\t")}if(t!=(n=r.length))return!1;for(let e=0;e<t;e++)if(null==h.config.rowhidden||null==h.config.rowhidden[e])for(let l=0;l<n;l++)if(o[e].length!=r[l].length)return!1;for(let e=0;e<t;e++)if(null==h.config.rowhidden||null==h.config.rowhidden[e])for(let l=0;l<o[0].length;l++)if(x(e,l,o)!=x(e,l,r))return!1;return!0}}});
//# sourceMappingURL=../sourcemaps/controllers/selection.js.map
