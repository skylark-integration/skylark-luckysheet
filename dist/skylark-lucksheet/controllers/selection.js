/**
 * skylark-lucksheet - A version of lucksheet.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["./select","./menuButton","./conditionformat","./protection","../global/editor","../global/tooltip","../global/formula","../global/border","../global/getdata","../global/getRowlen","../global/validate","../global/refresh","../global/format","../methods/get","../utils/util","../store","../locale/locale"],function(e,l,t,n,o,c,r,a,i,u,f,s,d,g,m,h,y){"use strict";const{selectHightlightShow:_,selectionCopyShow:p}=e,{checkProtectionLockedRangeList:b}=n,{getBorderInfoCompute:w}=a,{getdatabyselection:x,getcellvalue:v,datagridgrowth:I}=i,{rowlenByRange:k}=u,{isEditMode:S,hasPartMC:C,isRealNum:D}=f,{jfrefreshgrid:R,jfrefreshgrid_pastcut:H}=s,{genarate:T,update:V}=d,{getSheetIndex:M}=g,{replaceHtml:O,getObjType:B,luckysheetfontformat:j}=m;return{clearcopy:function(e){let l=window.clipboardData;l||e&&(l=e.originalEvent.clipboardData);if(h.luckysheet_selection_range=[],p(),l)return l.setData("Text"," "),!1;{let e=$("#luckysheet-copy-content").css("visibility","hidden");e.val(" "),e.focus(),e.select(),setTimeout(function(){e.blur().css("visibility","visible")},10)}},getHtmlBorderStyle:function(e,l){let t="";return(e={0:"none",1:"Thin",2:"Hair",3:"Dotted",4:"Dashed",5:"DashDot",6:"DashDotDot",7:"Double",8:"Medium",9:"MediumDashed",10:"MediumDashDot",11:"MediumDashDotDot",12:"SlantedDashDot",13:"Thick"}[e.toString()]).indexOf("Medium")>-1?t+="1pt ":t+="Thick"==e?"1.5pt ":"0.5pt ","Hair"==e?t+="double ":e.indexOf("DashDotDot")>-1?t+="dotted ":e.indexOf("DashDot")>-1?t+="dashed ":e.indexOf("Dotted")>-1?t+="dotted ":e.indexOf("Dashed")>-1?t+="dashed ":t+="solid ",t+l+";"},copy:function(e){let t=window.clipboardData;t||(t=e.originalEvent.clipboardData),h.luckysheet_selection_range=[];let n=[],c=[],r=[],a=!1,i=!1;for(let e=0;e<h.luckysheet_select_save.length;e++){let l=h.luckysheet_select_save[e],t=l.row[0],o=l.row[1],u=l.column[0],f=l.column[1];for(let e=t;e<=o;e++)if(null==h.config.rowhidden||null==h.config.rowhidden[e]){n.includes(e)||n.push(e),null!=h.config.rowlen&&e in h.config.rowlen&&(a=!0);for(let l=u;l<=f;l++){if(null!=h.config.colhidden&&null!=h.config.colhidden[l])continue;c.includes(l)||c.push(l);let t=h.flowdata[e][l];"object"==B(t)&&"mc"in t&&null!=t.mc.rs&&(i=!0)}}h.luckysheet_selection_range.push({row:l.row,column:l.column}),r.push({row:l.row,column:l.column})}p(),h.luckysheet_copy_save={dataSheetIndex:h.currentSheetIndex,copyRange:r,RowlChange:a,HasMC:i};let u,f=this;h.config.borderInfo&&h.config.borderInfo.length>0&&(u=w());let s="",d=o.deepCopyFlowData(h.flowdata),g="";for(let e=0;e<n.length;e++){let t=n[e];if(null==h.config.rowhidden||null==h.config.rowhidden[t]){s+="<tr>";for(let e=0;e<c.length;e++){let o=c[e];if(null!=h.config.colhidden&&null!=h.config.colhidden[o])continue;let r='<td ${span} style="${style}">';if(null!=d[t]&&null!=d[t][o]){let e="",a="";t==n[0]&&(null==h.config||null==h.config.columnlen||null==h.config.columnlen[o.toString()]?g+='<colgroup width="72px"></colgroup>':g+='<colgroup width="'+h.config.columnlen[o.toString()]+'px"></colgroup>'),o==c[0]&&(null==h.config||null==h.config.rowlen||null==h.config.rowlen[t.toString()]?e+="height:19px;":e+="height:"+h.config.rowlen[t.toString()]+"px;");let i,s=/^(w|W)((0?)|(0\.0+))$/;if(i=null!=d[t][o].ct&&null!=d[t][o].ct.fa&&d[t][o].ct.fa.match(s)?v(t,o,d):v(t,o,d,"m"),e+=l.getStyleByCell(d,t,o),"object"==B(d[t][o])&&"mc"in d[t][o]){if(!("rs"in d[t][o].mc))continue;if(a='rowspan="'+d[t][o].mc.rs+'" colspan="'+d[t][o].mc.cs+'"',u&&u[t+"_"+o]){let l={color:{},style:{}},n={color:{},style:{}},c={color:{},style:{}},r={color:{},style:{}};for(let e=t;e<t+d[t][o].mc.rs;e++)for(let a=o;a<o+d[t][o].mc.cs;a++){if(e==t&&u[e+"_"+a]&&u[e+"_"+a].t){let l=u[e+"_"+a].t.style,t=u[e+"_"+a].t.color;null==c.style[l]?c.style[l]=1:c.style[l]=c.style[l]+1,null==c.color[t]?c.color[t]=1:c.color[t]=c.color[t]+1}if(e==t+d[t][o].mc.rs-1&&u[e+"_"+a]&&u[e+"_"+a].b){let l=u[e+"_"+a].b.style,t=u[e+"_"+a].b.color;null==r.style[l]?r.style[l]=1:r.style[l]=r.style[l]+1,null==r.color[t]?r.color[t]=1:r.color[t]=r.color[t]+1}if(a==o&&u[e+"_"+a]&&u[e+"_"+a].l){let n=u[t+"_"+o].l.style,c=u[e+"_"+a].l.color;null==l.style[n]?l.style[n]=1:l.style[n]=l.style[n]+1,null==l.color[c]?l.color[c]=1:l.color[c]=l.color[c]+1}if(a==o+d[t][o].mc.cs-1&&u[e+"_"+a]&&u[e+"_"+a].r){let l=u[e+"_"+a].r.style,t=u[e+"_"+a].r.color;null==n.style[l]?n.style[l]=1:n.style[l]=n.style[l]+1,null==n.color[t]?n.color[t]=1:n.color[t]=n.color[t]+1}}let a=d[t][o].mc.rs,i=d[t][o].mc.cs;if(JSON.stringify(l).length>23){let t=null,n=null;for(let e in l.color)l.color[e]>=a/2&&(t=e);for(let e in l.style)l.style[e]>=a/2&&(n=e);null!=t&&null!=n&&(e+="border-left:"+f.getHtmlBorderStyle(n,t))}if(JSON.stringify(n).length>23){let l=null,t=null;for(let e in n.color)n.color[e]>=a/2&&(l=e);for(let e in n.style)n.style[e]>=a/2&&(t=e);null!=l&&null!=t&&(e+="border-right:"+f.getHtmlBorderStyle(t,l))}if(JSON.stringify(c).length>23){let l=null,t=null;for(let e in c.color)c.color[e]>=i/2&&(l=e);for(let e in c.style)c.style[e]>=i/2&&(t=e);null!=l&&null!=t&&(e+="border-top:"+f.getHtmlBorderStyle(t,l))}if(JSON.stringify(r).length>23){let l=null,t=null;for(let e in r.color)r.color[e]>=i/2&&(l=e);for(let e in r.style)r.style[e]>=i/2&&(t=e);null!=l&&null!=t&&(e+="border-bottom:"+f.getHtmlBorderStyle(t,l))}}}else if(u&&u[t+"_"+o]){if(u[t+"_"+o].l){let l=u[t+"_"+o].l.style,n=u[t+"_"+o].l.color;e+="border-left:"+f.getHtmlBorderStyle(l,n)}if(u[t+"_"+o].r){let l=u[t+"_"+o].r.style,n=u[t+"_"+o].r.color;e+="border-right:"+f.getHtmlBorderStyle(l,n)}if(u[t+"_"+o].b){let l=u[t+"_"+o].b.style,n=u[t+"_"+o].b.color;e+="border-bottom:"+f.getHtmlBorderStyle(l,n)}if(u[t+"_"+o].t){let l=u[t+"_"+o].t.style,n=u[t+"_"+o].t.color;e+="border-top:"+f.getHtmlBorderStyle(l,n)}}r=O(r,{style:e,span:a}),null==i&&(i=v(t,o,d)),null==i&&(i=""),r+=i}else{let e="";if(u&&u[t+"_"+o]){if(u[t+"_"+o].l){let l=u[t+"_"+o].l.style,n=u[t+"_"+o].l.color;e+="border-left:"+f.getHtmlBorderStyle(l,n)}if(u[t+"_"+o].r){let l=u[t+"_"+o].r.style,n=u[t+"_"+o].r.color;e+="border-right:"+f.getHtmlBorderStyle(l,n)}if(u[t+"_"+o].b){let l=u[t+"_"+o].b.style,n=u[t+"_"+o].b.color;e+="border-bottom:"+f.getHtmlBorderStyle(l,n)}if(u[t+"_"+o].t){let l=u[t+"_"+o].t.style,n=u[t+"_"+o].t.color;e+="border-top:"+f.getHtmlBorderStyle(l,n)}}r+="",t==n[0]&&(null==h.config||null==h.config.columnlen||null==h.config.columnlen[o.toString()]?g+='<colgroup width="72px"></colgroup>':g+='<colgroup width="'+h.config.columnlen[o.toString()]+'px"></colgroup>'),o==c[0]&&(null==h.config||null==h.config.rowlen||null==h.config.rowlen[t.toString()]?e+="height:19px;":e+="height:"+h.config.rowlen[t.toString()]+"px;"),r=O(r,{style:e,span:""}),r+=""}s+=r+="</td>"}s+="</tr>"}}if(s='<table data-type="luckysheet_copy_action_table">'+g+s+"</table>",h.iscopyself=!0,t)return t.setData("Text",s),!1;var m=document.createElement("input");m.setAttribute("readonly","readonly"),m.value=s,document.body.appendChild(m),m.select(),document.execCommand("Copy"),m.style.display="none",document.body.removeChild(m)},copybyformat:function(e,l){let t=window.clipboardData;t||(t=e.originalEvent&&e.originalEvent.clipboardData),h.luckysheet_selection_range=[{row:h.luckysheet_select_save[0].row,column:h.luckysheet_select_save[0].column}],p();let n=l;if(h.iscopyself=!0,t)return t.setData("Text",n),!1;{let e=$("#luckysheet-copy-content");e.text(n),e.focus(),e.select(),document.execCommand("selectAll"),document.execCommand("Copy"),setTimeout(function(){e.blur()},10)}},isPasteAction:!1,paste:function(e,l){let t=this;if(!1===h.allowEdit)return;const n=y().drag;let o=$("#luckysheet-copy-content");o.focus(),o.select(),setTimeout(function(){let r=o.html();r.indexOf("luckysheet_copy_action_table")>-1&&null!=h.luckysheet_copy_save.copyRange&&h.luckysheet_copy_save.copyRange.length>0?h.luckysheet_paste_iscut?(h.luckysheet_paste_iscut=!1,t.pasteHandlerOfCutPaste(h.luckysheet_copy_save),t.clearcopy(e)):t.pasteHandlerOfCopyPaste(h.luckysheet_copy_save):"btn"!=l?t.pasteHandler(r):S()?alert(n.pasteMustKeybordAlert):c.info(n.pasteMustKeybordAlertHTMLTitle,n.pasteMustKeybordAlertHTML)},10)},pasteHandler:function(e,t){if(b(h.luckysheet_select_save,h.currentSheetIndex)&&!1!==h.allowEdit)if(h.luckysheet_select_save.length>1&&(S()?alert("不能对多重选择区域执行此操作，请选择单个区域，然后再试"):c.info('<i class="fa fa-exclamation-triangle"></i>提示',"不能对多重选择区域执行此操作，请选择单个区域，然后再试")),"object"==typeof e){if(0==e.length)return;let n=$.extend(!0,{},h.config);null==n.merge&&(n.merge={}),JSON.stringify(t).length>2&&null==n.borderInfo&&(n.borderInfo=[]);let r=e.length,a=e[0].length,i=h.luckysheet_select_save[0].row[0],u=i+r-1,f=h.luckysheet_select_save[0].column[0],s=f+a-1,d=!1;if(null!=n.merge&&(d=C(n,i,u,f,s)),d)return void(S()?alert("不能对合并单元格做部分更改"):c.info('<i class="fa fa-exclamation-triangle"></i>提示',"不能对合并单元格做部分更改"));let g=o.deepCopyFlowData(h.flowdata),m=u-g.length+1,y=s-g[0].length+1;(m>0||y>0)&&(g=I([].concat(g),m,y,!0)),null==n.rowlen&&(n.rowlen={});let p=!1,b={};for(let o=i;o<=u;o++){let c=[].concat(g[o]),r=h.defaultrowlen;null!=n.rowlen[o]&&(r=n.rowlen[o]);for(let a=f;a<=s;a++){"object"==B(c[a])&&"mc"in c[a]&&("rs"in c[a].mc&&delete n.merge[c[a].mc.r+"_"+c[a].mc.c],delete c[a].mc);let u=null;if(null!=e[o-i]&&null!=e[o-i][a-f]&&(u=e[o-i][a-f]),c[a]=$.extend(!0,{},u),null!=u&&"mc"in c[a]&&(null!=c[a].mc.rs?(c[a].mc.r=o,c[a].mc.c=a,n.merge[c[a].mc.r+"_"+c[a].mc.c]=c[a].mc,b[u.mc.r+"_"+u.mc.c]=[c[a].mc.r,c[a].mc.c]):c[a]={mc:{r:b[u.mc.r+"_"+u.mc.c][0],c:b[u.mc.r+"_"+u.mc.c][1]}}),t[o-i+"_"+(a-f)]){let e={rangeType:"cell",value:{row_index:o,col_index:a,l:t[o-i+"_"+(a-f)].l,r:t[o-i+"_"+(a-f)].r,t:t[o-i+"_"+(a-f)].t,b:t[o-i+"_"+(a-f)].b}};n.borderInfo.push(e)}let s=j(c[a]),d=l.getTextSize("田",s)[1];d>r&&(r=d,p=!0)}g[o]=c,r!=h.defaultrowlen&&(n.rowlen[o]=r)}if(h.luckysheet_select_save=[{row:[i,u],column:[f,s]}],m>0||y>0||p){let e={cfg:n,RowlChange:!0};R(g,h.luckysheet_select_save,e)}else{let e={cfg:n};R(g,h.luckysheet_select_save,e),_()}}else{let l=[],t=(e=e.replace(/\r/g,"")).split("\n"),n=t[0].split("\t").length;for(let e=0;e<t.length;e++)t[e].split("\t").length<n||l.push(t[e].split("\t"));let a=o.deepCopyFlowData(h.flowdata),i=h.luckysheet_select_save[h.luckysheet_select_save.length-1],u=null==i.row?0:i.row[0],f=null==i.column?0:i.column[0],s=l.length,d=l[0].length,g=!1;if(null!=h.config.merge&&(g=C(h.config,u,u+s-1,f,f+d-1)),g)return void(S()?alert("不能对合并单元格做部分更改"):c.info('<i class="fa fa-exclamation-triangle"></i>提示',"不能对合并单元格做部分更改"));let m=u+s-a.length,y=f+d-a[0].length;(m>0||y>0)&&(a=I([].concat(a),m,y,!0));for(let e=0;e<s;e++){let t=[].concat(a[e+u]);for(let n=0;n<d;n++){let o=t[n+f],c=l[e][n];if(D(c)&&(c=o&&o.ct&&"@"===o.ct.fa?String(c):parseFloat(c)),o instanceof Object)o.v=c,null!=o.ct&&null!=o.ct.fa?o.m=V(o.ct.fa,c):o.m=c,null!=o.f&&o.f.length>0&&(o.f="",r.delFunctionGroup(e+u,n+f,h.currentSheetIndex));else{let e={},l=T(c);e.v=l[2],e.ct=l[1],e.m=l[0],t[n+f]=e}}a[e+u]=t}if(i.row=[u,u+s-1],i.column=[f,f+d-1],m>0||y>0){let e={RowlChange:!0};R(a,h.luckysheet_select_save,e)}else R(a,h.luckysheet_select_save),_()}},pasteHandlerOfCutPaste:function(e){if(!b(h.luckysheet_select_save,h.currentSheetIndex))return;if(!1===h.allowEdit)return;let l=$.extend(!0,{},h.config);null==l.merge&&(l.merge={});let n=e.HasMC,r=e.RowlChange,a=e.dataSheetIndex,i=e.copyRange[0].row[0],u=e.copyRange[0].row[1],f=e.copyRange[0].column[0],s=e.copyRange[0].column[1],d=$.extend(!0,[],x({row:[i,u],column:[f,s]},a)),g=d.length,m=d[0].length,y=h.luckysheet_select_save[h.luckysheet_select_save.length-1],_=y.row_focus,p=_+g-1,v=y.column_focus,D=v+m-1,R=!1;if(null!=l.merge&&(R=C(l,_,p,v,D)),R)return void(S()?alert("不能对合并单元格做部分更改"):c.info('<i class="fa fa-exclamation-triangle"></i>提示',"不能对合并单元格做部分更改"));let T=o.deepCopyFlowData(h.flowdata),V=g+_-T.length,O=m+v-T[0].length;(V>0||O>0)&&(T=I([].concat(T),V,O,!0));let j=w(a),F=$.extend(!0,{},h.luckysheetfile[M(a)].dataVerification),P=$.extend(!0,{},h.luckysheetfile[M(h.currentSheetIndex)].dataVerification);if(h.currentSheetIndex==a){for(let e=i;e<=u;e++)for(let t=f;t<=s;t++){let n=T[e][t];"object"==B(n)&&"mc"in n&&("rs"in n.mc&&delete l.merge[n.mc.r+"_"+n.mc.c],delete n.mc),T[e][t]=null,delete P[e+"_"+t]}if(l.borderInfo&&l.borderInfo.length>0){let e=[];for(let n=0;n<l.borderInfo.length;n++){let o=l.borderInfo[n].rangeType;if("range"==o){let o=l.borderInfo[n].range,c=[];for(let e=0;e<o.length;e++)c=c.concat(t.CFSplitRange(o[e],{row:[i,u],column:[f,s]},{row:[_,p],column:[v,D]},"restPart"));l.borderInfo[n].range=c,e.push(l.borderInfo[n])}else if("cell"==o){let t=l.borderInfo[n].value.row_index,o=l.borderInfo[n].value.col_index;t>=i&&t<=u&&o>=f&&o<=s||e.push(l.borderInfo[n])}}l.borderInfo=e}}let E,A,N={};for(let e=_;e<=p;e++){let t=[].concat(T[e]);for(let o=v;o<=D;o++){if(j[i+e-_+"_"+(f+o-v)]){let t={rangeType:"cell",value:{row_index:e,col_index:o,l:j[i+e-_+"_"+(f+o-v)].l,r:j[i+e-_+"_"+(f+o-v)].r,t:j[i+e-_+"_"+(f+o-v)].t,b:j[i+e-_+"_"+(f+o-v)].b}};null==l.borderInfo&&(l.borderInfo=[]),l.borderInfo.push(t)}else if(j[e+"_"+o]){let t={rangeType:"cell",value:{row_index:e,col_index:o,l:null,r:null,t:null,b:null}};null==l.borderInfo&&(l.borderInfo=[]),l.borderInfo.push(t)}F[i+e-_+"_"+(f+o-v)]&&(P[e+"_"+o]=F[i+e-_+"_"+(f+o-v)]),"object"==B(t[o])&&"mc"in t[o]&&("rs"in t[o].mc&&delete l.merge[t[o].mc.r+"_"+t[o].mc.c],delete t[o].mc);let c=null;null!=d[e-_]&&null!=d[e-_][o-v]&&(c=d[e-_][o-v]),t[o]=$.extend(!0,{},c),null!=c&&n&&"mc"in t[o]&&(null!=t[o].mc.rs?(t[o].mc.r=e,t[o].mc.c=o,l.merge[t[o].mc.r+"_"+t[o].mc.c]=t[o].mc,N[c.mc.r+"_"+c.mc.c]=[t[o].mc.r,t[o].mc.c]):t[o]={mc:{r:N[c.mc.r+"_"+c.mc.c][0],c:N[c.mc.r+"_"+c.mc.c][1]}})}T[e]=t}if(y.row=[_,p],y.column=[v,D],r&&(h.currentSheetIndex!=a?l=k(T,_,p,l):(l=k(T,i,u,l),l=k(T,_,p,l))),h.currentSheetIndex!=a){let e=$.extend(!0,[],h.luckysheetfile[M(a)].data),n=$.extend(!0,{},h.luckysheetfile[M(a)].config),o=$.extend(!0,[],e),c=$.extend(!0,{},n);null==c.merge&&(c.merge={});for(let e=i;e<=u;e++)for(let l=f;l<=s;l++){let t=o[e][l];"object"==B(t)&&"mc"in t&&("rs"in t.mc&&delete c.merge[t.mc.r+"_"+t.mc.c],delete t.mc),o[e][l]=null}if(r&&(c=k(o,i,u,c)),c.borderInfo&&c.borderInfo.length>0){let e=[];for(let l=0;l<c.borderInfo.length;l++){let n=c.borderInfo[l].rangeType;if("range"==n){let n=c.borderInfo[l].range,o=[];for(let e=0;e<n.length;e++)o=o.concat(t.CFSplitRange(n[e],{row:[i,u],column:[f,s]},{row:[_,p],column:[v,D]},"restPart"));c.borderInfo[l].range=o,e.push(c.borderInfo[l])}else if("cell"==n){let t=c.borderInfo[l].value.row_index,n=c.borderInfo[l].value.col_index;t>=i&&t<=u&&n>=f&&n<=s||e.push(c.borderInfo[l])}}c.borderInfo=e}let d=$.extend(!0,[],h.luckysheetfile[M(a)].luckysheet_conditionformat_save),g=$.extend(!0,[],d),m=[];if(null!=g&&g.length>0)for(let e=0;e<g.length;e++){let l=g[e].cellrange,n=[],o=[];for(let e=0;e<l.length;e++){let c=t.CFSplitRange(l[e],{row:[i,u],column:[f,s]},{row:[_,p],column:[v,D]},"restPart");n=n.concat(c);let r=t.CFSplitRange(l[e],{row:[i,u],column:[f,s]},{row:[_,p],column:[v,D]},"operatePart");r.length>0&&(o=o.concat(r))}if(g[e].cellrange=n,o.length>0){let l=$.extend(!0,{},g[e]);l.cellrange=o,m.push(l)}}let y=$.extend(!0,[],h.luckysheetfile[M(h.currentSheetIndex)].luckysheet_conditionformat_save),b=$.extend(!0,[],y);m.length>0&&(b=b.concat(m));for(let e=i;e<=u;e++)for(let l=f;l<=s;l++)delete F[e+"_"+l];E={sheetIndex:a,data:e,curData:o,config:n,curConfig:c,cdformat:d,curCdformat:g,dataVerification:$.extend(!0,{},h.luckysheetfile[M(a)].dataVerification),curDataVerification:F,range:{row:[i,u],column:[f,s]}},A={sheetIndex:h.currentSheetIndex,data:h.flowdata,curData:T,config:$.extend(!0,{},h.config),curConfig:l,cdformat:y,curCdformat:b,dataVerification:$.extend(!0,{},h.luckysheetfile[M(h.currentSheetIndex)].dataVerification),curDataVerification:P,range:{row:[_,p],column:[v,D]}}}else{let e=$.extend(!0,[],h.luckysheetfile[M(h.currentSheetIndex)].luckysheet_conditionformat_save),n=$.extend(!0,[],e);if(null!=n&&n.length>0)for(let e=0;e<n.length;e++){let l=n[e].cellrange,o=[];for(let e=0;e<l.length;e++){let n=t.CFSplitRange(l[e],{row:[i,u],column:[f,s]},{row:[_,p],column:[v,D]},"allPart");o=o.concat(n)}n[e].cellrange=o}E={sheetIndex:h.currentSheetIndex,data:h.flowdata,curData:T,config:$.extend(!0,{},h.config),curConfig:l,cdformat:e,curCdformat:n,dataVerification:$.extend(!0,{},h.luckysheetfile[M(h.currentSheetIndex)].dataVerification),curDataVerification:P,range:{row:[i,u],column:[f,s]}},A={sheetIndex:h.currentSheetIndex,data:h.flowdata,curData:T,config:$.extend(!0,{},h.config),curConfig:l,cdformat:e,curCdformat:n,dataVerification:$.extend(!0,{},h.luckysheetfile[M(h.currentSheetIndex)].dataVerification),curDataVerification:P,range:{row:[_,p],column:[v,D]}}}H(E,A,V>0||O>0||r)},pasteHandlerOfCopyPaste:function(e){if(!b(h.luckysheet_select_save,h.currentSheetIndex))return;let l=$.extend(!0,{},h.config);null==l.merge&&(l.merge={});let n=e.HasMC,a=e.RowlChange,i=e.dataSheetIndex,u=e.copyRange[0].row[0],f=e.copyRange[0].row[1],s=e.copyRange[0].column[0],d=e.copyRange[0].column[1],g=[],m=!1;for(let l=0;l<e.copyRange.length;l++){let t=x({row:e.copyRange[l].row,column:e.copyRange[l].column},i);e.copyRange.length>1?u==e.copyRange[1].row[0]&&f==e.copyRange[1].row[1]?(t=t[0].map(function(e,l){return t.map(function(e){return e[l]})}),g=g.concat(t),m=!0):s==e.copyRange[1].column[0]&&d==e.copyRange[1].column[1]&&(g=g.concat(t)):g=t}m&&(g=g[0].map(function(e,l){return g.map(function(e){return e[l]})}));let y=$.extend(!0,[],g);if(e.copyRange.length>1)for(let e=0;e<y.length;e++)for(let l=0;l<y[e].length;l++)null!=y[e][l]&&null!=y[e][l].f&&(delete y[e][l].f,delete y[e][l].spl);let p=y.length,v=y[0].length,D=h.luckysheet_select_save[h.luckysheet_select_save.length-1],H=D.row[0],T=D.row[1],O=D.column[0],j=D.column[1];0==(T-H+1)%p&&0==(j-O+1)%v||(T=H+p-1,j=O+v-1);let F=!1;if(null!=l.merge&&(F=C(l,H,T,O,j)),F)return void(S()?alert("不能对合并单元格做部分更改"):c.info('<i class="fa fa-exclamation-triangle"></i>提示',"不能对合并单元格做部分更改"));let P=(T-H+1)/p,E=(j-O+1)/v,A=o.deepCopyFlowData(h.flowdata),N=p+H-A.length,J=v+O-A[0].length;(N>0||J>0)&&(A=I([].concat(A),N,J,!0));let L=w(i),K=$.extend(!0,{},h.luckysheetfile[M(i)].dataVerification),z=null,G=0,W=0,q=0,Q=0;for(let e=1;e<=P;e++)for(let t=1;t<=E;t++){Q=H+e*p,q=O+t*v;let o=(G=H+(e-1)*p)-u,c=(W=O+(t-1)*v)-s,a={};for(let e=G;e<Q;e++){let t=[].concat(A[e]);for(let i=W;i<q;i++){if(L[u+e-G+"_"+(s+i-W)]){let t={rangeType:"cell",value:{row_index:e,col_index:i,l:L[u+e-G+"_"+(s+i-W)].l,r:L[u+e-G+"_"+(s+i-W)].r,t:L[u+e-G+"_"+(s+i-W)].t,b:L[u+e-G+"_"+(s+i-W)].b}};null==l.borderInfo&&(l.borderInfo=[]),l.borderInfo.push(t)}else if(L[e+"_"+i]){let t={rangeType:"cell",value:{row_index:e,col_index:i,l:null,r:null,t:null,b:null}};null==l.borderInfo&&(l.borderInfo=[]),l.borderInfo.push(t)}K[u+e-G+"_"+(s+i-W)]&&(null==z&&(z=$.extend(!0,{},h.luckysheetfile[M(h.currentSheetIndex)].dataVerification)),z[e+"_"+i]=K[u+e-G+"_"+(s+i-W)]),"object"==B(t[i])&&"mc"in t[i]&&("rs"in t[i].mc&&delete l.merge[t[i].mc.r+"_"+t[i].mc.c],delete t[i].mc);let f=null;if(null!=y[e-G]&&null!=y[e-G][i-W]&&(f=$.extend(!0,{},y[e-G][i-W])),null!=f&&null!=f.f){let l=f.f;o>0&&(l="="+r.functionCopy(l,"down",o)),o<0&&(l="="+r.functionCopy(l,"up",Math.abs(o))),c>0&&(l="="+r.functionCopy(l,"right",c)),c<0&&(l="="+r.functionCopy(l,"left",Math.abs(c)));let t=r.execfunction(l,e,i,void 0,!0);null!=f.spl?(f.f=t[2],f.v=t[1],f.spl=t[3].data):(f.f=t[2],f.v=t[1],null!=f.ct&&null!=f.ct.fa&&(f.m=V(f.ct.fa,t[1])))}t[i]=$.extend(!0,{},f),null!=f&&n&&"mc"in t[i]&&(null!=t[i].mc.rs?(t[i].mc.r=e,t[i].mc.c=i,l.merge[t[i].mc.r+"_"+t[i].mc.c]=t[i].mc,a[f.mc.r+"_"+f.mc.c]=[t[i].mc.r,t[i].mc.c]):t[i]={mc:{r:a[f.mc.r+"_"+f.mc.c][0],c:a[f.mc.r+"_"+f.mc.c][1]}})}A[e]=t}}let U=null;if(1==e.copyRange.length){let e=h.luckysheetfile[M(i)],l=h.luckysheetfile[M(h.currentSheetIndex)],n=$.extend(!0,[],e.luckysheet_conditionformat_save);if(null!=n&&n.length>0){U=$.extend(!0,[],l.luckysheet_conditionformat_save);for(let e=0;e<n.length;e++){let l=n[e].cellrange,o=[];for(let e=1;e<=P;e++)for(let n=1;n<=E;n++){G=H+(e-1)*p,W=O+(n-1)*v,Q=H+e*p,q=O+n*v;for(let e=0;e<l.length;e++){let n=t.CFSplitRange(l[e],{row:[u,f],column:[s,d]},{row:[G,Q-1],column:[W,q-1]},"operatePart");n.length>0&&(o=o.concat(n))}}o.length>0&&(n[e].cellrange=o,U.push(n[e]))}}}if(D.row=[H,T],D.column=[O,j],a||N>0||J>0){let e={cfg:l=k(A,H,T,l),RowlChange:!0,cdformat:U,dataVerification:z};R(A,h.luckysheet_select_save,e)}else{let e={cfg:l,cdformat:U,dataVerification:z};R(A,h.luckysheet_select_save,e),_()}},pasteHandlerOfPaintModel:function(e){if(!b(h.luckysheet_select_save,h.currentSheetIndex))return;let l=$.extend(!0,{},h.config);null==l.merge&&(l.merge={});let n=e.HasMC,r=e.RowlChange,a=e.dataSheetIndex,i=e.copyRange[0].row[0],u=e.copyRange[0].row[1],f=e.copyRange[0].column[0],s=e.copyRange[0].column[1],d=$.extend(!0,[],x({row:[i,u],column:[f,s]},a)),g=h.luckysheet_select_save[h.luckysheet_select_save.length-1],m=g.row[0],y=g.row[1],p=g.column[0],v=g.column[1],I=d.length,D=d[0].length;if(m==y&&p==v){let e=!1;if(null!=l.merge&&(e=C(l,m,m+I-1,p,p+D-1)),e)return void(S()?alert("不能对合并单元格做部分更改"):c.info('<i class="fa fa-exclamation-triangle"></i>提示',"不能对合并单元格做部分更改"));y=m+I-1,v=p+D-1}let H=Math.ceil((y-m+1)/I),T=Math.ceil((v-p+1)/D),O=o.deepCopyFlowData(h.flowdata),j=O[0].length,F=O.length,P=w(a),E=$.extend(!0,{},h.luckysheetfile[M(a)].dataVerification),A=null,N=0,J=0,L=0,K=0;for(let e=1;e<=H;e++)for(let t=1;t<=T;t++){N=m+(e-1)*I,J=p+(t-1)*D,(K=m+e*I>F?F:m+e*I)>y+1&&(K=y+1),(L=p+t*D>j?j:p+t*D)>v+1&&(L=v+1);let o={};for(let e=N;e<K;e++){let t=[].concat(O[e]);for(let c=J;c<L;c++){if(P[i+e-N+"_"+(f+c-J)]){let t={rangeType:"cell",value:{row_index:e,col_index:c,l:P[i+e-N+"_"+(f+c-J)].l,r:P[i+e-N+"_"+(f+c-J)].r,t:P[i+e-N+"_"+(f+c-J)].t,b:P[i+e-N+"_"+(f+c-J)].b}};null==l.borderInfo&&(l.borderInfo=[]),l.borderInfo.push(t)}else if(P[e+"_"+c]){let t={rangeType:"cell",value:{row_index:e,col_index:c,l:null,r:null,t:null,b:null}};null==l.borderInfo&&(l.borderInfo=[]),l.borderInfo.push(t)}E[i+e-N+"_"+(f+c-J)]&&(null==A&&(A=$.extend(!0,{},h.luckysheetfile[M(h.currentSheetIndex)].dataVerification)),A[e+"_"+c]=E[i+e-N+"_"+(f+c-J)]),"object"==B(t[c])&&"mc"in t[c]&&("rs"in t[c].mc&&delete l.merge[t[c].mc.r+"_"+t[c].mc.c],delete t[c].mc);let r=null;if(null!=d[e-N]&&null!=d[e-N][c-J]&&(r=d[e-N][c-J]),null!=r&&(delete r.v,delete r.m,delete r.f,delete r.spl,r.ct&&"inlineStr"==r.ct.t&&delete r.ct,"object"==B(t[c])||(t[c]={v:t[c]}),t[c]=$.extend(!0,t[c],r),n&&"mc"in t[c]&&(null!=t[c].mc.rs?(t[c].mc.r=e,t[c].mc.rs+e>=K&&(t[c].mc.rs=K-e),t[c].mc.c=c,t[c].mc.cs+c>=L&&(t[c].mc.cs=L-c),l.merge[t[c].mc.r+"_"+t[c].mc.c]=t[c].mc,o[r.mc.r+"_"+r.mc.c]=[t[c].mc.r,t[c].mc.c]):t[c]={mc:{r:o[r.mc.r+"_"+r.mc.c][0],c:o[r.mc.r+"_"+r.mc.c][1]}}),null!=t[c].v&&null!=r.ct&&null!=r.ct.fa)){let e=V(r.ct.fa,t[c].v);t[c].m=e}}O[e]=t}}let z=null,G=$.extend(!0,[],h.luckysheetfile[M(a)].luckysheet_conditionformat_save);if(null!=G&&G.length>0){z=$.extend(!0,[],h.luckysheetfile[M(h.currentSheetIndex)].luckysheet_conditionformat_save);for(let e=0;e<G.length;e++){let l=G[e].cellrange,n=[];for(let e=0;e<l.length;e++){let o=t.CFSplitRange(l[e],{row:[i,u],column:[f,s]},{row:[m,y],column:[p,v]},"operatePart");o.length>0&&(n=n.concat(o))}n.length>0&&(G[e].cellrange=[{row:[m,y],column:[p,v]}],z.push(G[e]))}}if(g.row=[m,y],g.column=[p,v],r){let e={cfg:l=k(O,m,y,l),RowlChange:!0,cdformat:z,dataVerification:A};R(O,h.luckysheet_select_save,e)}else{let e={cfg:l,cdformat:z,dataVerification:A};R(O,h.luckysheet_select_save,e),_()}},matchcopy:function(e,l){let t,n,o=[],c=[];if("object"==typeof e)o=e;else{o=e.split("\n");for(let e=0;e<o.length;e++)o[e]=o[e].split("\t")}if(t=o.length,"object"==typeof l)c=l;else{c=l.split("\n");for(let e=0;e<c.length;e++)c[e]=c[e].split("\t")}if(t!=(n=c.length))return!1;for(let e=0;e<t;e++)if(null==h.config.rowhidden||null==h.config.rowhidden[e])for(let l=0;l<n;l++)if(o[e].length!=c[l].length)return!1;for(let e=0;e<t;e++)if(null==h.config.rowhidden||null==h.config.rowhidden[e])for(let l=0;l<o[0].length;l++)if(v(e,l,o)!=v(e,l,c))return!1;return!0}}});
//# sourceMappingURL=../sourcemaps/controllers/selection.js.map
