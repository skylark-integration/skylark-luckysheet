/**
 * skylark-lucksheet - A version of lucksheet.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["../utils/util","./constant","./select","../global/tooltip","../global/editor","../global/setdata","../global/getdata","../global/refresh","../store","../locale/locale"],function(t,e,l,i,o,n,s,u,a,c){"use strict";const{replaceHtml:p}=t,{modelHTML:h}=e,{selectHightlightShow:d}=l,{setcellvalue:r}=n,{getcellvalue:g}=s,{jfrefreshgrid:m}=u;return{createDialog:function(){const t=c(),e=t.splitText,l=t.punctuation,i=t.button;$("#luckysheet-modal-dialog-mask").show(),$("#luckysheet-splitColumn-dialog").remove();let o='<div class="box"><div class="boxTitle">'+e.splitDelimiters+'</div><div class="boxMain"><div style="height: 22px;line-height: 22px;"><input id="splitColumn_type_01" type="checkbox"/><label for="splitColumn_type_01">'+l.tab+'</label></div><div style="height: 22px;line-height: 22px;"><input id="splitColumn_type_02" type="checkbox"/><label for="splitColumn_type_02">'+l.semicolon+'</label></div><div style="height: 22px;line-height: 22px;"><input id="splitColumn_type_03" type="checkbox"/><label for="splitColumn_type_03">'+l.comma+'</label></div><div style="height: 22px;line-height: 22px;"><input id="splitColumn_type_04" type="checkbox"/><label for="splitColumn_type_04">'+l.space+'</label></div><div style="height: 22px;line-height: 22px;"><input id="splitColumn_type_05" type="checkbox"/><label for="splitColumn_type_05">'+e.splitOther+'</label><input type="text" class="formulaInputFocus" maxlength="1"/></div></div><div style="height: 22px;line-height: 22px;"><input id="splitColumn_type_06" type="checkbox"/><label for="splitColumn_type_06">'+e.splitContinueSymbol+'</label></div><div class="boxTitle" style="margin-top: 10px;">'+e.splitDataPreview+'</div><div class="boxMain" id="splitColumnData"></div></div>';$("body").append(p(h,{id:"luckysheet-splitColumn-dialog",addclass:"luckysheet-splitColumn-dialog",title:e.splitTextTitle,content:o,botton:'<button id="luckysheet-splitColumn-dialog-confirm" class="btn btn-primary">'+i.confirm+'</button><button class="btn btn-default luckysheet-model-close-btn">'+i.cancel+"</button>",style:"z-index:100003"}));let n=$("#luckysheet-splitColumn-dialog").find(".luckysheet-modal-dialog-content").css("min-width",400).end(),s=n.outerHeight(),u=n.outerWidth(),a=$(window).width(),d=$(window).height(),r=$(document).scrollLeft(),g=$(document).scrollTop();$("#luckysheet-splitColumn-dialog").css({left:(a+r-u)/2,top:(d+g-s)/3}).show();let m=this.getDataArr();this.dataPreview(m)},init:function(){let t=this;const e=c().splitText;$(document).off("change.SPCinpcheckbox").on("change.SPCcheckbox","#luckysheet-splitColumn-dialog .box input[type='checkbox']",function(){let e=t.getRegStr(),l=t.getDataArr(e);t.dataPreview(l)}),$(document).off("keyup.SPCinptext").on("keyup.SPCinptext","#luckysheet-splitColumn-dialog .box input[type='text']",function(){if($(this).siblings("input[type='checkbox']").is(":checked")){let e=t.getRegStr(),l=t.getDataArr(e);t.dataPreview(l)}}),$(document).off("click.SPCconfirm").on("click.SPCconfirm","#luckysheet-splitColumn-dialog #luckysheet-splitColumn-dialog-confirm",function(){$("#luckysheet-modal-dialog-mask").hide(),$("#luckysheet-splitColumn-dialog").hide();let l=t.getRegStr(),o=t.getDataArr(l),n=a.luckysheet_select_save[0].row[0],s=a.luckysheet_select_save[0].column[0];if(1==o[0].length)return;let u=!1;for(let t=0;t<o.length;t++)for(let e=1;e<o[0].length;e++){let l=a.flowdata[n+t][s+e];if(null!=l&&null!=l.v){u=!0;break}}if(u){let l=function(){t.update(n,s,o)};i.confirm("",e.splitConfirmToExe,l)}else t.update(n,s,o)})},update:function(t,e,l){let i=o.deepCopyFlowData(a.flowdata);for(let o=0;o<l.length;o++)for(let n=0;n<l[0].length;n++){let s=l[o][n];r(t+o,e+n,i,s)}let n=a.luckysheet_select_save[0].row[0],s=a.luckysheet_select_save[0].column[0],u=[{row:[n,n+l.length-1],column:[s,s+l[0].length-1]}];m(i,u),d()},dataPreview:function(t){$("#luckysheet-splitColumn-dialog #splitColumnData").empty();let e="";for(let l=0;l<t.length;l++){let i="";for(let e=0;e<t[0].length;e++)i+="<td>"+t[l][e]+"</td>";e+="<tr>"+i+"</tr>"}let l="<table>"+e+"</table>";$("#luckysheet-splitColumn-dialog #splitColumnData").append(l)},getRegStr:function(){let t="",e=0;return $("#luckysheet-splitColumn-dialog .box input[type='checkbox']:checked").each(function(l,i){let o=$(i).attr("id");if("splitColumn_type_01"==o)t+="\\t",e++;else if("splitColumn_type_02"==o)e>0&&(t+="|"),t+=";",e++;else if("splitColumn_type_03"==o)e>0&&(t+="|"),t+=",",e++;else if("splitColumn_type_04"==o)e>0&&(t+="|"),t+="\\s",e++;else if("splitColumn_type_05"==o){let l=$(i).siblings("input[type='text']").val().trim();""!=l&&(e>0&&(t+="|"),t+=l)}else"splitColumn_type_06"==o&&(t="["+t+"]+")}),t},getDataArr:function(t){let e=this,l=[],i=a.luckysheet_select_save[0].row[0],o=a.luckysheet_select_save[0].row[1],n=a.luckysheet_select_save[0].column[0];if(null!=t&&""!=t){let s=new RegExp(t,"g"),u=[];for(let t=i;t<=o;t++){let e,l=[],i=a.flowdata[t][n];null==(e=null!=i&&null!=i.m?i.m:g(t,n,a.flowdata))&&(e=""),l=e.toString().split(s),u.push(l)}let c=u.length,p=0;for(let t=0;t<c;t++)u[t].length>p&&(p=u[t].length);l=e.getNullData(c,p);for(let t=0;t<l.length;t++)for(let e=0;e<l[0].length;e++)null!=u[t][e]&&(l[t][e]=u[t][e])}else for(let t=i;t<=o;t++){let e,i=[],o=a.flowdata[t][n];null==(e=null!=o&&null!=o.m?o.m:g(t,n,a.flowdata))&&(e=""),i.push(e),l.push(i)}return l},getNullData:function(t,e){let l=[];for(let i=0;i<t;i++){let t=[];for(let l=0;l<e;l++)t.push("");l.push(t)}return l}}});
//# sourceMappingURL=../sourcemaps/controllers/splitColumn.js.map
