/**
 * skylark-lucksheet - A version of lucksheet.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["../methods/get","./sheetSearch","./select","./filter","./server","./menuButton","./postil","./dropCell","../global/location","../store","../locale/locale"],function(e,l,t,s,i,a,o,c,n,r,h){"use strict";const{getSheetIndex:d}=e,{luckysheet_searcharray:u}=l,{selectHightlightShow:f}=t,{createFilterOptions:z}=s,{rowLocationByIndex:v,colLocationByIndex:y}=n,w={freezenHorizontalHTML:'<div id="luckysheet-freezebar-horizontal" class="luckysheet-freezebar" tabindex="0"><div class="luckysheet-freezebar-handle luckysheet-freezebar-horizontal-handle" ><div class="luckysheet-freezebar-handle-bar luckysheet-freezebar-horizontal-handle-title" ></div><div class="luckysheet-freezebar-handle-bar luckysheet-freezebar-horizontal-handle-bar" ></div></div><div class="luckysheet-freezebar-drop luckysheet-freezebar-horizontal-drop" ><div class="luckysheet-freezebar-drop-bar luckysheet-freezebar-horizontal-drop-title" ></div><div class="luckysheet-freezebar-drop-bar luckysheet-freezebar-horizontal-drop-bar" >&nbsp;</div></div></div>',freezenVerticalHTML:'<div id="luckysheet-freezebar-vertical" class="luckysheet-freezebar" tabindex="0"><div class="luckysheet-freezebar-handle luckysheet-freezebar-vertical-handle" ><div class="luckysheet-freezebar-handle-bar luckysheet-freezebar-vertical-handle-title" ></div><div class="luckysheet-freezebar-handle-bar luckysheet-freezebar-vertical-handle-bar" ></div></div><div class="luckysheet-freezebar-drop luckysheet-freezebar-vertical-drop" ><div class="luckysheet-freezebar-drop-bar luckysheet-freezebar-vertical-drop-title" ></div><div class="luckysheet-freezebar-drop-bar luckysheet-freezebar-vertical-drop-bar" >&nbsp;</div></div></div>',initialHorizontal:!0,initialVertical:!0,horizontalmovestate:!1,horizontalmoveposition:null,verticalmovestate:!1,verticalmoveposition:null,windowHeight:null,windowWidth:null,freezenhorizontaldata:null,freezenverticaldata:null,cutVolumn:function(e,l){if(l<=0)return e;let t=e.slice(0,l);t[t.length-1];return e.slice(l)},cancelFreezenVertical:function(e){const l=h().freezen;$("#luckysheet-freezen-btn-vertical").html('<i class="fa fa-indent"></i> '+l.freezenColumn),this.freezenverticaldata=null;let t=$("#luckysheet-freezebar-vertical").is(":visible");$("#luckysheet-freezebar-vertical").hide(),null==e&&(e=r.currentSheetIndex);let s=r.luckysheetfile[d(e)];null!=s.freezen&&(s.freezen.vertical=null),null!=s.frozen&&t&&i.saveParam("all",e,s.frozen,{k:"frozen"})},createFreezenVertical:function(e,l){let t=this;if(t.initialVertical){t.initialVertical=!1,$("#luckysheet-grid-window-1").append(t.freezenVerticalHTML),$("#luckysheet-freezebar-vertical").find(".luckysheet-freezebar-vertical-drop").hover(function(){$(this).parent().addClass("luckysheet-freezebar-hover")},function(){$(this).parent().removeClass("luckysheet-freezebar-hover")}),$("#luckysheet-freezebar-vertical").find(".luckysheet-freezebar-vertical-drop").mousedown(function(){t.verticalmovestate=!0,t.verticalmoveposition=$(this).position().left,t.windowWidth=$("#luckysheet-grid-window-1").width(),$(this).parent().addClass("luckysheet-freezebar-active"),$("#luckysheet-freezebar-vertical").find(".luckysheet-freezebar-vertical-handle").css("cursor","-webkit-grabbing")});let e=$("#luckysheet-grid-window-1").height();$("#luckysheet-freezebar-vertical").find(".luckysheet-freezebar-vertical-handle").css({height:e-10,width:"4px",cursor:"-webkit-grab",top:"0px"}).end().find(".luckysheet-freezebar-vertical-drop").css({height:e-10,width:"4px",top:"0px",cursor:"-webkit-grab"})}if(null==e){let s=$("#luckysheet-cell-main").scrollLeft(),i=u(r.visibledatacolumn,s);-1==i&&(i=0),l=r.visibledatacolumn[i]-2-s+r.rowHeaderWidth,e=[r.visibledatacolumn[i],i+1,s,t.cutVolumn(r.visibledatacolumn,i+1),l],t.saveFreezen(null,null,e,l)}t.freezenverticaldata=e;const s=`\n            <div class="luckysheet-toolbar-button-outer-box luckysheet-inline-block"\n            style="user-select: none;">\n                <div class="luckysheet-toolbar-button-inner-box luckysheet-inline-block"\n                style="user-select: none;">\n                    <div class="luckysheet-icon luckysheet-inline-block " style="user-select: none;">\n                        <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-function iconfont luckysheet-iconfont-dongjie1"\n                        style="user-select: none;">\n                        </div>\n                    </div>\n                    <div class="luckysheet-toolbar-menu-button-caption luckysheet-inline-block"\n                    style="user-select: none;">\n                        ${h().freezen.freezenCancel}\n                    </div>\n                </div>\n            </div>\n        `;$("#luckysheet-freezen-btn-horizontal").html(s),$("#luckysheet-freezebar-vertical").show().find(".luckysheet-freezebar-vertical-handle").css({left:l}).end().find(".luckysheet-freezebar-vertical-drop").css({left:l})},saveFreezen:function(e,l,t,s){let a=r.luckysheetfile[d(r.currentSheetIndex)];null==a.freezen&&(a.freezen={}),null!=e&&(null==a.freezen.horizontal&&(a.freezen.horizontal={}),a.freezen.horizontal.freezenhorizontaldata=e,a.freezen.horizontal.top=l),null!=t&&(null==a.freezen.vertical&&(a.freezen.vertical={}),a.freezen.vertical.freezenverticaldata=t,a.freezen.vertical.left=s),null!=a.frozen&&i.saveParam("all",r.currentSheetIndex,a.frozen,{k:"frozen"})},initialFreezen:function(e){let l=this;l.frozenTofreezen();let t=r.luckysheetfile[d(e)];null!=t.freezen&&null!=t.freezen.horizontal&&null!=t.freezen.horizontal.freezenhorizontaldata?l.createFreezenHorizontal(t.freezen.horizontal.freezenhorizontaldata,t.freezen.horizontal.top):l.cancelFreezenHorizontal(e),null!=t.freezen&&null!=t.freezen.vertical&&null!=t.freezen.vertical.freezenverticaldata?l.createFreezenVertical(t.freezen.vertical.freezenverticaldata,t.freezen.vertical.left):l.cancelFreezenVertical(e),l.createAssistCanvas()},changeFreezenIndex:function(e,l){let t=this;if("v"==l&&null!=t.freezenverticaldata){let l=t.freezenverticaldata[1],s=u(r.visibledatacolumn,$("#luckysheet-cell-main").scrollLeft());e-s<l&&(e-=s)}else if("h"==l&&null!=t.freezenhorizontaldata){let l=t.freezenhorizontaldata[1],s=u(r.visibledatarow,$("#luckysheet-cell-main").scrollTop());e-s<l&&(e-=s)}return e},scrollFreezen:function(){let e,l,t=this,s=r.luckysheet_select_save[0].row_focus;s==r.luckysheet_select_save[0].row[0]?e=r.luckysheet_select_save[0].row[1]:s==r.luckysheet_select_save[0].row[1]&&(e=r.luckysheet_select_save[0].row[0]);let i=r.luckysheet_select_save[0].column_focus;if(i==r.luckysheet_select_save[0].column[0]?l=r.luckysheet_select_save[0].column[1]:i==r.luckysheet_select_save[0].column[1]&&(l=r.luckysheet_select_save[0].column[0]),null!=t.freezenverticaldata){let e=t.freezenverticaldata[1],s=u(t.freezenverticaldata[3],$("#luckysheet-cell-main").scrollLeft()),i=t.freezenverticaldata[4];e+=s,l>=r.visibledatacolumn.length&&(l=r.visibledatacolumn.length-1),e>=r.visibledatacolumn.length&&(e=r.visibledatacolumn.length-1),r.visibledatacolumn[l]<=r.visibledatacolumn[e]+i&&(console.log(1111),setTimeout(function(){$("#luckysheet-scrollbar-x").scrollLeft(0)},100))}if(null!=t.freezenhorizontaldata){let l=t.freezenhorizontaldata[1],s=u(t.freezenhorizontaldata[3],$("#luckysheet-cell-main").scrollTop()),i=t.freezenhorizontaldata[4];l+=s,e>=r.visibledatarow.length&&(e=r.visibledatarow.length-1),l>=r.visibledatarow.length&&(l=r.visibledatarow.length-1),r.visibledatarow[e]<=r.visibledatarow[l]+i&&setTimeout(function(){$("#luckysheet-scrollbar-y").scrollTop(0)},100)}},cancelFreezenHorizontal:function(e){const l=`\n            <div class="luckysheet-toolbar-button-outer-box luckysheet-inline-block"\n            style="user-select: none;">\n                <div class="luckysheet-toolbar-button-inner-box luckysheet-inline-block"\n                style="user-select: none;">\n                    <div class="luckysheet-icon luckysheet-inline-block " style="user-select: none;">\n                        <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-function iconfont luckysheet-iconfont-dongjie1"\n                        style="user-select: none;">\n                        </div>\n                    </div>\n                    <div class="luckysheet-toolbar-menu-button-caption luckysheet-inline-block"\n                    style="user-select: none;">\n                        ${h().freezen.default}\n                    </div>\n                </div>\n            </div>\n        `;$("#luckysheet-freezen-btn-horizontal").html(l),this.freezenhorizontaldata=null;let t=$("#luckysheet-freezebar-horizontal").is(":visible");$("#luckysheet-freezebar-horizontal").hide(),null==e&&(e=r.currentSheetIndex);let s=r.luckysheetfile[d(e)];null!=s.freezen&&(s.freezen.horizontal=null),null!=s.frozen&&t&&i.saveParam("all",e,s.frozen,{k:"frozen"})},createFreezenHorizontal:function(e,l){let t=this;if(t.initialHorizontal){t.initialHorizontal=!1,$("#luckysheet-grid-window-1").append(t.freezenHorizontalHTML),$("#luckysheet-freezebar-horizontal").find(".luckysheet-freezebar-horizontal-drop").hover(function(){$(this).parent().addClass("luckysheet-freezebar-hover")},function(){$(this).parent().removeClass("luckysheet-freezebar-hover")}),$("#luckysheet-freezebar-horizontal").find(".luckysheet-freezebar-horizontal-drop").mousedown(function(){t.horizontalmovestate=!0,t.horizontalmoveposition=$(this).position().top,t.windowHeight=$("#luckysheet-grid-window-1").height(),$(this).parent().addClass("luckysheet-freezebar-active"),$("#luckysheet-freezebar-horizontal").find(".luckysheet-freezebar-horizontal-handle").css("cursor","-webkit-grabbing")});let e=$("#luckysheet-grid-window-1").width();$("#luckysheet-freezebar-horizontal").find(".luckysheet-freezebar-horizontal-handle").css({width:e-10,height:"4px",cursor:"-webkit-grab",left:"0px"}).end().find(".luckysheet-freezebar-horizontal-drop").css({width:e-10,height:"4px",left:"0px",cursor:"-webkit-grab"})}if(null==e){let s=$("#luckysheet-cell-main").scrollTop(),i=u(r.visibledatarow,s);-1==i&&(i=0),l=r.visibledatarow[i]-2-s+r.columnHeaderHeight,e=[r.visibledatarow[i],i+1,s,t.cutVolumn(r.visibledatarow,i+1),l],t.saveFreezen(e,l,null,null)}t.freezenhorizontaldata=e;const s=`\n            <div class="luckysheet-toolbar-button-outer-box luckysheet-inline-block"\n            style="user-select: none;">\n                <div class="luckysheet-toolbar-button-inner-box luckysheet-inline-block"\n                style="user-select: none;">\n                    <div class="luckysheet-icon luckysheet-inline-block " style="user-select: none;">\n                        <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-function iconfont luckysheet-iconfont-dongjie1"\n                        style="user-select: none;">\n                        </div>\n                    </div>\n                    <div class="luckysheet-toolbar-menu-button-caption luckysheet-inline-block"\n                    style="user-select: none;">\n                        ${h().freezen.freezenCancel}\n                    </div>\n                </div>\n            </div>\n        `;$("#luckysheet-freezen-btn-horizontal").html(s),$("#luckysheet-freezebar-horizontal").show().find(".luckysheet-freezebar-horizontal-handle").css({top:l}).end().find(".luckysheet-freezebar-horizontal-drop").css({top:l})},createAssistCanvas:function(){let e=this;if(e.removeAssistCanvas(),null!=e.freezenverticaldata||null!=e.freezenhorizontaldata){let l,t,s,i,a,o,c=r.luckysheetTableContentHW[0],n=r.luckysheetTableContentHW[1];null!=e.freezenverticaldata&&null!=e.freezenhorizontaldata?(l=e.freezenhorizontaldata[0],t=e.freezenhorizontaldata[1],s=e.freezenhorizontaldata[2],i=e.freezenverticaldata[0],a=e.freezenverticaldata[1],o=e.freezenverticaldata[2],e.createCanvas("freezen_3",i-o,l-s+1,r.rowHeaderWidth-1,r.columnHeaderHeight-1),e.createCanvas("freezen_4",c-i+o,l-s+1,i-o+r.rowHeaderWidth-1,r.columnHeaderHeight-1),e.createCanvas("freezen_7",i-o,n-l+s-r.columnHeaderHeight,r.rowHeaderWidth-1,l-s+r.columnHeaderHeight-1)):null!=e.freezenhorizontaldata?(l=e.freezenhorizontaldata[0],t=e.freezenhorizontaldata[1],s=e.freezenhorizontaldata[2],e.createCanvas("freezen_h",c,l-s+1,r.rowHeaderWidth-1,r.columnHeaderHeight-1)):null!=e.freezenverticaldata&&(i=e.freezenverticaldata[0],a=e.freezenverticaldata[1],o=e.freezenverticaldata[2],e.createCanvas("freezen_v",i-o,n,r.rowHeaderWidth-1,r.columnHeaderHeight-1)),e.scrollAdapt()}},createCanvas:function(e,l,t,s,i){$("<canvas/>").appendTo("#luckysheet-grid-window-1").attr({id:e,width:Math.ceil(l*r.devicePixelRatio),height:Math.ceil(t*r.devicePixelRatio)}).css({"user-select":"none",postion:"absolute",left:s,top:i,width:l,height:t,"z-index":10,"pointer-events":"none"})},removeAssistCanvas:function(){$("#luckysheet-grid-window-1 > canvas").not($("#luckysheetTableContent")).remove(),$("#luckysheet-cell-selected").css("z-index",15)},scrollAdapt:function(){let e=this;if(null!=r.luckysheet_select_save&&r.luckysheet_select_save.length>0&&e.scrollAdaptOfselect(),$("#luckysheet-cell-main .luckysheet-data-visualization-chart").length>0){const l=r.luckysheetfile[d(r.currentSheetIndex)].chart;null!=l&&l.length>0&&e.scrollAdaptOfchart()}$("#luckysheet-postil-showBoxs .luckysheet-postil-show").length>0&&e.scrollAdaptOfpostil(),$("#luckysheet-dropCell-icon").length>0&&e.scrollAdaptOfdpicon(),$("#luckysheet-filter-options-sheet"+r.currentSheetIndex+" .luckysheet-filter-options").length>0&&e.scrollAdaptOffilteroptions()},scrollAdaptOfselect:function(){let e=this;$("#luckysheet-row-count-show").is(":visible")&&$("#luckysheet-row-count-show").hide(),$("#luckysheet-column-count-show").is(":visible")&&$("#luckysheet-column-count-show").hide(),$("#luckysheet-rows-h-selected").empty(),$("#luckysheet-cols-h-selected").empty();let l=$("#luckysheet-cell-main").scrollTop(),t=$("#luckysheet-cell-main").scrollLeft();if(null!=e.freezenhorizontaldata&&null!=e.freezenverticaldata){let s=e.freezenhorizontaldata[0],i=e.freezenhorizontaldata[1],o=l-e.freezenhorizontaldata[2],c=e.freezenverticaldata[0],n=e.freezenverticaldata[1],h=t-e.freezenverticaldata[2];for(let e=0;e<r.luckysheet_select_save.length;e++){let l=$.extend(!0,{},r.luckysheet_select_save[e]),t=l.row[0],d=l.row[1],u=r.visibledatarow[d],f=t-1==-1?0:r.visibledatarow[t-1],z=f,v=u-f-1,y=!0;t>=i?z+v<s+o?y=!1:z<s+o?$("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").eq(e).show().css({top:s+o,height:v-(s+o-z)}):$("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").eq(e).show().css({top:z,height:v}):d>=i?z+v<s+o?$("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").eq(e).show().css({top:z+o,height:s-z}):$("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").eq(e).show().css({top:z+o,height:v-o}):$("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").eq(e).show().css("top",z+o);let w=l.column[0],k=l.column[1],b=r.visibledatacolumn[k],p=w-1==-1?0:r.visibledatacolumn[w-1],m=p,g=b-p-1;if(w>=n?m+g<c+h?y=!1:m<c+h?$("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").eq(e).show().css({left:c+h,width:g-(c+h-m)}):$("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").eq(e).show().css({left:m,width:g}):k>=n?m+g<c+h?$("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").eq(e).show().css({left:m+h,width:c-m}):$("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").eq(e).show().css({left:m+h,width:g-h}):$("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").eq(e).show().css("left",m+h),y||$("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").eq(e).hide(),e==r.luckysheet_select_save.length-1){let e=null==l.row_focus?t:l.row_focus,i=null==l.column_focus?w:l.column_focus,n=r.visibledatarow[e],d=e-1==-1?0:r.visibledatarow[e-1],u=r.visibledatacolumn[i],f=i-1==-1?0:r.visibledatacolumn[i-1],z=a.mergeborer(r.flowdata,e,i);z&&(n=z.row[1],d=z.row[0],u=z.column[1],f=z.column[0]);let v=d,y=n-d-1,k=f,b=u-f-1,p=!0;v>=s?v+y<s+o?p=!1:v<s+o?$("#luckysheet-cell-selected-focus").show().css({top:s+o,height:y-(s+o-v)}):$("#luckysheet-cell-selected-focus").show().css({top:v,height:y}):v+y>=s?v+y<s+o?$("#luckysheet-cell-selected-focus").show().css({top:v+o,height:s-v}):$("#luckysheet-cell-selected-focus").show().css({top:v+o,height:y-o}):$("#luckysheet-cell-selected-focus").show().css("top",v+o),k>=c?k+b<c+h?p=!1:k<c+h?$("#luckysheet-cell-selected-focus").show().css({left:c+h,width:b-(c+h-k)}):$("#luckysheet-cell-selected-focus").show().css({left:k,width:b}):k+b>=c?k+b<c+h?$("#luckysheet-cell-selected-focus").show().css({left:k+h,width:c-k}):$("#luckysheet-cell-selected-focus").show().css({left:k+h,width:b-h}):$("#luckysheet-cell-selected-focus").show().css("left",k+h),p||$("#luckysheet-cell-selected-focus").hide()}}}else if(null!=e.freezenhorizontaldata){let t=e.freezenhorizontaldata[0],s=e.freezenhorizontaldata[1],i=l-e.freezenhorizontaldata[2];for(let e=0;e<r.luckysheet_select_save.length;e++){let l=$.extend(!0,{},r.luckysheet_select_save[e]),o=l.row[0],c=l.row[1],n=r.visibledatarow[c],h=o-1==-1?0:r.visibledatarow[o-1],d=h,u=n-h-1;if(o>=s?d+u<t+i?$("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").eq(e).hide():d<t+i?$("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").eq(e).show().css({top:t+i,height:u-(t+i-d)}):$("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").eq(e).show().css({top:d,height:u}):c>=s?d+u<t+i?$("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").eq(e).show().css({top:d+i,height:t-d}):$("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").eq(e).show().css({top:d+i,height:u-i}):$("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").eq(e).show().css("top",d+i),e==r.luckysheet_select_save.length-1){let e=null==l.row_focus?o:l.row_focus,s=null==l.column_focus?l.column[0]:l.column_focus,c=r.visibledatarow[e],n=e-1==-1?0:r.visibledatarow[e-1],h=a.mergeborer(r.flowdata,e,s);h&&(c=h.row[1],n=h.row[0]);let d=n,u=c-n-1;d>=t?d+u<t+i?$("#luckysheet-cell-selected-focus").hide():d<t+i?$("#luckysheet-cell-selected-focus").show().css({top:t+i,height:u-(t+i-d)}):$("#luckysheet-cell-selected-focus").show().css({top:d,height:u}):d+u>=t?d+u<t+i?$("#luckysheet-cell-selected-focus").show().css({top:d+i,height:t-d}):$("#luckysheet-cell-selected-focus").show().css({top:d+i,height:u-i}):$("#luckysheet-cell-selected-focus").show().css("top",d+i)}}}else if(null!=e.freezenverticaldata){let l=e.freezenverticaldata[0],s=e.freezenverticaldata[1],i=t-e.freezenverticaldata[2];for(let e=0;e<r.luckysheet_select_save.length;e++){let t=$.extend(!0,{},r.luckysheet_select_save[e]),o=t.column[0],c=t.column[1],n=r.visibledatacolumn[c],h=o-1==-1?0:r.visibledatacolumn[o-1],d=h,u=n-h-1;if(o>=s?d+u<l+i?$("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").eq(e).hide():d<l+i?$("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").eq(e).show().css({left:l+i,width:u-(l+i-d)}):$("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").eq(e).show().css({left:d,width:u}):c>=s?d+u<l+i?$("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").eq(e).show().css({left:d+i,width:l-d}):$("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").eq(e).show().css({left:d+i,width:u-i}):$("#luckysheet-cell-selected-boxs").find(".luckysheet-cell-selected").eq(e).show().css("left",d+i),e==r.luckysheet_select_save.length-1){let e=null==t.row_focus?t.row[0]:t.row_focus,s=null==t.column_focus?o:t.column_focus,c=r.visibledatacolumn[s],n=s-1==-1?0:r.visibledatacolumn[s-1],h=a.mergeborer(r.flowdata,e,s);h&&(c=h.column[1],n=h.column[0]);let d=n,u=c-n-1;d>=l?d+u<l+i?$("#luckysheet-cell-selected-focus").hide():d<l+i?$("#luckysheet-cell-selected-focus").show().css({left:l+i,width:u-(l+i-d)}):$("#luckysheet-cell-selected-focus").show().css({left:d,width:u}):d+u>=l?d+u<l+i?$("#luckysheet-cell-selected-focus").show().css({left:d+i,width:l-d}):$("#luckysheet-cell-selected-focus").show().css({left:d+i,width:u-i}):$("#luckysheet-cell-selected-focus").show().css("left",d+i)}}}else f()},scrollAdaptOfchart:function(){let e=this,l=$("#luckysheet-cell-main").scrollTop(),t=$("#luckysheet-cell-main").scrollLeft();if(null!=e.freezenhorizontaldata&&null!=e.freezenverticaldata){let s=e.freezenhorizontaldata[0]-e.freezenhorizontaldata[2],i=e.freezenverticaldata[0]-e.freezenverticaldata[2];$("#luckysheet-cell-main .luckysheet-data-visualization-chart").each(function(e,a){let o=$(a).position(),c=$(a).width(),n=$(a).height(),r=$(a).find("canvas").width(),h=$(a).find("canvas").height(),d=h-n,u=r-c;if(o.top-d<s){let e=s-(o.top-d);e>h+40+2?$(a).css("visibility","hidden"):($(a).css({top:s+l,height:h-e,visibility:"visible"}),$(a).find("canvas").css("top",-e))}else $(a).css({top:o.top-d+l,height:h,visibility:"visible"}),$(a).find("canvas").css("top",0);if(o.left-u<i){let e=i-(o.left-u);e>r+20+2?$(a).css("visibility","hidden"):($(a).css({left:i+t,width:r-e,visibility:"visible"}),$(a).find("canvas").css("left",-e))}else $(a).css({left:o.left-u+t,width:r,visibility:"visible"}),$(a).find("canvas").css("left",0)})}else if(null!=e.freezenhorizontaldata){let t=e.freezenhorizontaldata[0]-e.freezenhorizontaldata[2];$("#luckysheet-cell-main .luckysheet-data-visualization-chart").each(function(e,s){let i=$(s).position(),a=$(s).height(),o=$(s).find("canvas").height(),c=o-a;if(i.top-c<t){let e=t-(i.top-c);e>o+40+2?$(s).css("visibility","hidden"):($(s).css({top:t+l,height:o-e,visibility:"visible"}),$(s).find("canvas").css("top",-e))}else $(s).css({top:i.top-c+l,height:o,visibility:"visible"}),$(s).find("canvas").css("top",0)})}else if(null!=e.freezenverticaldata){let l=e.freezenverticaldata[0]-e.freezenverticaldata[2];$("#luckysheet-cell-main .luckysheet-data-visualization-chart").each(function(e,s){let i=$(s).position(),a=$(s).width(),o=$(s).find("canvas").width(),c=o-a;if(i.left-c<l){let e=l-(i.left-c);e>o+20+2?$(s).css("visibility","hidden"):($(s).css({left:l+t,width:o-e,visibility:"visible"}),$(s).find("canvas").css("left",-e))}else $(s).css({left:i.left-c+t,width:o,visibility:"visible"}),$(s).find("canvas").css("left",0)})}else $("#luckysheet-cell-main .luckysheet-data-visualization-chart").each(function(e,s){let i=$(s).position(),a=$(s).width(),o=$(s).height(),c=$(s).find("canvas").width(),n=$(s).find("canvas").height(),r=n-o,h=c-a;$(s).css({top:i.top-r+l,height:n,left:i.left-h+t,width:c,visibility:"visible"}),$(s).find("canvas").css({top:0,left:0})})},scrollAdaptOfpostil:function(){let e=this,l=$("#luckysheet-cell-main").scrollTop(),t=$("#luckysheet-cell-main").scrollLeft();if(null!=e.freezenhorizontaldata&&null!=e.freezenverticaldata){let s=e.freezenhorizontaldata[0],i=e.freezenverticaldata[0],c=l-e.freezenhorizontaldata[2],n=t-e.freezenverticaldata[2];$("#luckysheet-postil-showBoxs .luckysheet-postil-show").each(function(l,t){let h=$(t).attr("id"),d=h.split("luckysheet-postil-show_")[1].split("_")[0],u=h.split("luckysheet-postil-show_")[1].split("_")[1],f=r.flowdata[d][u].ps,z=r.visibledatarow[d],v=d-1==-1?0:r.visibledatarow[d-1],y=r.visibledatacolumn[u],w=u-1==-1?0:r.visibledatacolumn[u-1],k=a.mergeborer(r.flowdata,d,u);k&&(z=k.row[1],v=k.row[0],y=k.column[1],w=k.column[0]);let b=y,p=v,m=null==f.left?b+18:f.left,g=null==f.top?p-18:f.top,_=null==f.width?o.defaultWidth:f.width,x=null==f.height?o.defaultHeight:f.height;g<0&&(g=2);let C=o.getArrowCanvasSize(m,g,b,p),H=!0,T=!0;d>=e.freezenhorizontaldata[1]?g+x<s?($(t).show().find(".luckysheet-postil-show-main").css("top",g+c),$(t).show().find(".arrowCanvas").css("top",C[1]+c)):g<s+c?g+x<=s+c?H=!1:($(t).show().find(".luckysheet-postil-show-main").css({top:s+c,height:x-(s+c-g)}),$(t).show().find(".formulaInputFocus").css("margin-top",-(s+c-g)),$(t).show().find(".arrowCanvas").hide(),T=!1):($(t).show().find(".luckysheet-postil-show-main").css({top:g,height:x}),$(t).show().find(".formulaInputFocus").css("margin-top",0),$(t).show().find(".arrowCanvas").css("top",C[1])):($(t).show().find(".luckysheet-postil-show-main").css("top",g+c),$(t).show().find(".arrowCanvas").css("top",C[1]+c)),u>=e.freezenverticaldata[1]?m+_<i?($(t).show().find(".luckysheet-postil-show-main").css("left",m+n),$(t).show().find(".arrowCanvas").css("left",C[0]+n)):m<i+n?m+_<=i+n?H=!1:($(t).show().find(".luckysheet-postil-show-main").css({left:i+n,width:_-(i+n-m)}),$(t).show().find(".formulaInputFocus").css("margin-left",-(i+n-m)),$(t).show().find(".arrowCanvas").hide(),T=!1):($(t).show().find(".luckysheet-postil-show-main").css({left:m,width:_}),$(t).show().find(".formulaInputFocus").css("margin-left",0),$(t).show().find(".arrowCanvas").css("left",C[0])):($(t).show().find(".luckysheet-postil-show-main").css("left",m+n),$(t).show().find(".arrowCanvas").css("left",C[0]+n)),H||$(t).hide(),H&&T&&$(t).show().find(".arrowCanvas").show()})}else if(null!=e.freezenhorizontaldata){let t=e.freezenhorizontaldata[0],s=l-e.freezenhorizontaldata[2];$("#luckysheet-postil-showBoxs .luckysheet-postil-show").each(function(l,i){let c=$(i).attr("id"),n=c.split("luckysheet-postil-show_")[1].split("_")[0],h=c.split("luckysheet-postil-show_")[1].split("_")[1],d=r.flowdata[n][h].ps,u=r.visibledatarow[n],f=n-1==-1?0:r.visibledatarow[n-1],z=r.visibledatacolumn[h],v=h-1==-1?0:r.visibledatacolumn[h-1],y=a.mergeborer(r.flowdata,n,h);y&&(u=y.row[1],f=y.row[0],z=y.column[1],v=y.column[0]);let w=z,k=f,b=null==d.left?w+18:d.left,p=null==d.top?k-18:d.top,m=(null==d.width?o.defaultWidth:d.width,null==d.height?o.defaultHeight:d.height);p<0&&(p=2);let g=o.getArrowCanvasSize(b,p,w,k);n>=e.freezenhorizontaldata[1]?p+m<t?($(i).show().find(".luckysheet-postil-show-main").css("top",p+s),$(i).show().find(".arrowCanvas").css("top",g[1]+s)):p<t+s?p+m<=t+s?$(i).hide():($(i).show().find(".luckysheet-postil-show-main").css({top:t+s,height:m-(t+s-p)}),$(i).show().find(".formulaInputFocus").css("margin-top",-(t+s-p)),$(i).show().find(".arrowCanvas").hide()):o.buildPs(n,h,d):($(i).show().find(".luckysheet-postil-show-main").css("top",p+s),$(i).show().find(".arrowCanvas").css("top",g[1]+s))})}else if(null!=e.freezenverticaldata){let l=e.freezenverticaldata[0],s=t-e.freezenverticaldata[2];$("#luckysheet-postil-showBoxs .luckysheet-postil-show").each(function(t,i){let c=$(i).attr("id"),n=c.split("luckysheet-postil-show_")[1].split("_")[0],h=c.split("luckysheet-postil-show_")[1].split("_")[1],d=r.flowdata[n][h].ps,u=r.visibledatarow[n],f=n-1==-1?0:r.visibledatarow[n-1],z=r.visibledatacolumn[h],v=h-1==-1?0:r.visibledatacolumn[h-1],y=a.mergeborer(r.flowdata,n,h);y&&(u=y.row[1],f=y.row[0],z=y.column[1],v=y.column[0]);let w=z,k=f,b=null==d.left?w+18:d.left,p=null==d.top?k-18:d.top,m=null==d.width?o.defaultWidth:d.width;null==d.height?o.defaultHeight:d.height;p<0&&(p=2);let g=o.getArrowCanvasSize(b,p,w,k);h>=e.freezenverticaldata[1]?b+m<l?($(i).show().find(".luckysheet-postil-show-main").css("left",b+s),$(i).show().find(".arrowCanvas").css("left",g[0]+s)):b<l+s?b+m<=l+s?$(i).hide():($(i).show().find(".luckysheet-postil-show-main").css({left:l+s,width:m-(l+s-b)}),$(i).show().find(".formulaInputFocus").css("margin-left",-(l+s-b)),$(i).show().find(".arrowCanvas").hide()):o.buildPs(n,h,d):($(i).show().find(".luckysheet-postil-show-main").css("left",b+s),$(i).show().find(".arrowCanvas").css("left",g[0]+s))})}else $("#luckysheet-postil-showBoxs .luckysheet-postil-show").each(function(e,l){let t=$(l).attr("id"),s=t.split("luckysheet-postil-show_")[1].split("_")[0],i=t.split("luckysheet-postil-show_")[1].split("_")[1],a=r.flowdata[s][i].ps;o.buildPs(s,i,a)})},scrollAdaptOfdpicon:function(){let e,l,t=this,s=c.copyRange.row[1],i=c.copyRange.column[1],a=c.applyRange.row[1],o=c.applyRange.column[1];if(a>=s&&o>=i?(e=a,l=o):(e=s,l=i),null!=t.freezenhorizontaldata&&null!=t.freezenverticaldata){let s=t.freezenhorizontaldata[1],i=u(t.freezenhorizontaldata[3],$("#luckysheet-cell-main").scrollTop()-t.freezenhorizontaldata[2]),a=t.freezenverticaldata[1],o=u(t.freezenverticaldata[3],$("#luckysheet-cell-main").scrollLeft()-t.freezenverticaldata[2]);if(e>=s&&l>=a)e<s+i-1||l<a+o-1?$("#luckysheet-dropCell-icon").hide():$("#luckysheet-dropCell-icon").show();else if(e>=s)if(e<s+i-1)$("#luckysheet-dropCell-icon").hide();else{let e=y(l+o)[1];$("#luckysheet-dropCell-icon").show().css("left",e)}else if(l>=a)if(l<a+o-1)$("#luckysheet-dropCell-icon").hide();else{let l=v(e+i)[1];$("#luckysheet-dropCell-icon").show().css("top",l)}else{let t=v(e+i)[1],s=y(l+o)[1];$("#luckysheet-dropCell-icon").show().css({left:s,top:t})}}else if(null!=t.freezenhorizontaldata){let l=t.freezenhorizontaldata[1],s=u(t.freezenhorizontaldata[3],$("#luckysheet-cell-main").scrollTop()-t.freezenhorizontaldata[2]);if(e>=l)e<l+s-1?$("#luckysheet-dropCell-icon").hide():$("#luckysheet-dropCell-icon").show();else{let l=v(e+s)[1];$("#luckysheet-dropCell-icon").show().css("top",l)}}else if(null!=t.freezenverticaldata){let e=t.freezenverticaldata[1],s=u(t.freezenverticaldata[3],$("#luckysheet-cell-main").scrollLeft()-t.freezenverticaldata[2]);if(l>=e)l<e+s-1?$("#luckysheet-dropCell-icon").hide():$("#luckysheet-dropCell-icon").show();else{let e=y(l+s)[1];$("#luckysheet-dropCell-icon").show().css("left",e)}}else{let t=v(e)[1],s=y(l)[1];$("#luckysheet-dropCell-icon").show().css({left:s,top:t})}},scrollAdaptOffilteroptions:function(){let e=this;if(null!=e.freezenhorizontaldata&&null!=e.freezenverticaldata){let l=e.freezenhorizontaldata[1],t=e.freezenhorizontaldata[0]+$("#luckysheet-cell-main").scrollTop(),s=e.freezenverticaldata[1],i=u(e.freezenverticaldata[3],$("#luckysheet-cell-main").scrollLeft()-e.freezenverticaldata[2]);$("#luckysheet-filter-options-sheet"+r.currentSheetIndex+" .luckysheet-filter-options").each(function(e,a){let o=$(a).data("str"),c=o-1==-1?0:r.visibledatarow[o-1],n=$(a).data("cindex");if(o>=l&&n>=s)c<t||n<s+i?$(a).hide():$(a).show();else if(o>=l)if(c<t)$(a).hide();else{let e=r.visibledatacolumn[n+i]-20;$(a).show().css("left",e)}else if(n>=s)n<s+i?$(a).hide():$(a).show().css("top",c+$("#luckysheet-cell-main").scrollTop());else{let e=r.visibledatacolumn[n+i]-20;$(a).show().css({left:e,top:c+$("#luckysheet-cell-main").scrollTop()})}})}else if(null!=e.freezenhorizontaldata){let l=e.freezenhorizontaldata[1],t=e.freezenhorizontaldata[0]+$("#luckysheet-cell-main").scrollTop();$("#luckysheet-filter-options-sheet"+r.currentSheetIndex+" .luckysheet-filter-options").each(function(e,s){let i=$(s).data("str"),a=i-1==-1?0:r.visibledatarow[i-1];i>=l?a<t?$(s).hide():$(s).show():$(s).show().css("top",a+$("#luckysheet-cell-main").scrollTop())})}else if(null!=e.freezenverticaldata){let l=e.freezenverticaldata[1],t=u(e.freezenverticaldata[3],$("#luckysheet-cell-main").scrollLeft()-e.freezenverticaldata[2]);$("#luckysheet-filter-options-sheet"+r.currentSheetIndex+" .luckysheet-filter-options").each(function(e,s){let i=$(s).data("cindex");if(i>=l)i<l+t?$(s).hide():$(s).show();else{let e=r.visibledatacolumn[i+t]-20;$(s).show().css("left",e)}})}else $("#luckysheet-filter-options-sheet"+r.currentSheetIndex).empty(),z(r.luckysheetfile[d(r.currentSheetIndex)].filter_select)},saveFrozen:function(e,l,t={}){null==l&&(l=d(r.currentSheetIndex));const s=r.luckysheet_select_save[r.luckysheet_select_save.length-1],i=null==s.row_focus?s.row[0]:s.row_focus,a=null==s.column_focus?s.column[0]:s.column_focus,o={row_focus:t.row_focus||i,column_focus:t.column_focus||a},c={freezenRow:{type:"row"},freezenColumn:{type:"column"},freezenRC:{type:"both"},freezenRowRange:{type:"rangeRow",range:o},freezenColumnRange:{type:"rangeColumn",range:o},freezenRCRange:{type:"rangeBoth",range:o},freezenCancel:{type:"cancel"}};r.luckysheetfile[l].frozen=c[e]},frozenTofreezen:function(){let e=r.luckysheetfile[d(r.currentSheetIndex)];const l=e.frozen;if(null==l)return;let t=null;if("row"===l.type){let e=0,l=u(r.visibledatarow,e);-1==l&&(l=0);let s=r.visibledatarow[l]-2-e+r.columnHeaderHeight;t={horizontal:{freezenhorizontaldata:[r.visibledatarow[l],l+1,e,w.cutVolumn(r.visibledatarow,l+1),s],top:s}}}else if("column"===l.type){let e=0,l=u(r.visibledatacolumn,e);-1==l&&(l=0);let s=r.visibledatacolumn[l]-2-e+r.rowHeaderWidth;t={vertical:{freezenverticaldata:[r.visibledatacolumn[l],l+1,e,w.cutVolumn(r.visibledatacolumn,l+1),s],left:s}}}else if("both"===l.type){let e=0,l=u(r.visibledatarow,e);-1==l&&(l=0);let s=r.visibledatarow[l]-2-e+r.columnHeaderHeight,i=[r.visibledatarow[l],l+1,e,w.cutVolumn(r.visibledatarow,l+1),s],a=0,o=u(r.visibledatacolumn,a);-1==o&&(o=0);let c=r.visibledatacolumn[o]-2-a+r.rowHeaderWidth;t={horizontal:{freezenhorizontaldata:i,top:s},vertical:{freezenverticaldata:[r.visibledatacolumn[o],o+1,a,w.cutVolumn(r.visibledatacolumn,o+1),c],left:c}}}else if("rangeRow"===l.type){let e=0,s=u(r.visibledatarow,e),i=l.range.row_focus;i>s&&(s=i),-1==s&&(s=0);let a=r.visibledatarow[s]-2-e+r.columnHeaderHeight;t={horizontal:{freezenhorizontaldata:[r.visibledatarow[s],s+1,e,w.cutVolumn(r.visibledatarow,s+1),a],top:a}}}else if("rangeColumn"===l.type){let e=0,s=u(r.visibledatacolumn,e),i=l.range.column_focus;i>s&&(s=i),-1==s&&(s=0);let a=r.visibledatacolumn[s]-2-e+r.rowHeaderWidth;t={vertical:{freezenverticaldata:[r.visibledatacolumn[s],s+1,e,w.cutVolumn(r.visibledatacolumn,s+1),a],left:a}}}else if("rangeBoth"===l.type){let e=0,s=u(r.visibledatarow,e),i=l.range.row_focus;i>s&&(s=i),-1==s&&(s=0);let a=r.visibledatarow[s]-2-e+r.columnHeaderHeight,o=[r.visibledatarow[s],s+1,e,w.cutVolumn(r.visibledatarow,s+1),a],c=0,n=u(r.visibledatacolumn,c),h=l.range.column_focus;h>n&&(n=h),-1==n&&(n=0);let d=r.visibledatacolumn[n]-2-c+r.rowHeaderWidth;t={horizontal:{freezenhorizontaldata:o,top:a},vertical:{freezenverticaldata:[r.visibledatacolumn[n],n+1,c,w.cutVolumn(r.visibledatacolumn,n+1),d],left:d}}}else"cancel"===l.type&&(t={horizontal:null,vertical:null});e.freezen=t}};return w});
//# sourceMappingURL=../sourcemaps/controllers/freezen.js.map
