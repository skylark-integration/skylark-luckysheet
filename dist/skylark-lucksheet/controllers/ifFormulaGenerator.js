/**
 * skylark-lucksheet - A version of lucksheet.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["../global/formula","../global/editor","./updateCell","./constant","../utils/util","../store","../locale/locale"],function(e,l,t,o,i,a,n){"use strict";const{luckysheetupdateCell:s}=t,{modelHTML:u}=o,{replaceHtml:c}=i;return{singleRangeFocus:!1,init:function(){let t=this;const o=n(),i=o.formula;o.button;$(document).off("focus.IFcompareValue").on("focus.IFcompareValue","#luckysheet-ifFormulaGenerator-dialog #compareValue",function(){$("#luckysheet-modal-dialog-mask").hide(),t.singleRangeFocus=!0}),$(document).off("click.IFsingRange").on("click.IFsingRange","#luckysheet-ifFormulaGenerator-dialog .singRange",function(){let l=$("#luckysheet-ifFormulaGenerator-dialog #compareValue").val().trim();e.iscelldata(l)?t.singleRangeDialog(l):t.singleRangeDialog()}),$(document).off("click.IFsingRangeConfirm").on("click.IFsingRangeConfirm","#luckysheet-ifFormulaGenerator-singleRange-confirm",function(){$("#luckysheet-formula-functionrange-select").hide(),$("#luckysheet-ifFormulaGenerator-singleRange-dialog").hide(),$("#luckysheet-modal-dialog-mask").show(),$("#luckysheet-ifFormulaGenerator-dialog").show();let e=$(this).parents("#luckysheet-ifFormulaGenerator-singleRange-dialog").find("input").val().trim();$("#luckysheet-ifFormulaGenerator-dialog #compareValue").val(e),t.singleRangeFocus=!1}),$(document).off("click.IFsingRangeCancel").on("click.IFsingRangeCancel","#luckysheet-ifFormulaGenerator-singleRange-cancel",function(){$("#luckysheet-formula-functionrange-select").hide(),$("#luckysheet-ifFormulaGenerator-singleRange-dialog").hide(),$("#luckysheet-modal-dialog-mask").show(),$("#luckysheet-ifFormulaGenerator-dialog").show(),t.singleRangeFocus=!1}),$(document).off("click.IFsingRangeClose").on("click.IFsingRangeClose","#luckysheet-ifFormulaGenerator-singleRange-dialog .luckysheet-modal-dialog-title-close",function(){$("#luckysheet-formula-functionrange-select").hide(),$("#luckysheet-modal-dialog-mask").show(),$("#luckysheet-ifFormulaGenerator-dialog").show(),t.singleRangeFocus=!1}),$(document).off("click.IFmultiRange").on("click.IFmultiRange","#luckysheet-ifFormulaGenerator-dialog .multiRange",function(){t.multiRangeDialog(),t.singleRangeFocus=!1}),$(document).off("click.IFmultiRangeConfirm").on("click.IFmultiRangeConfirm","#luckysheet-ifFormulaGenerator-multiRange-confirm",function(){$("#luckysheet-formula-functionrange-select").hide(),$("#luckysheet-row-count-show").hide(),$("#luckysheet-column-count-show").hide(),$("#luckysheet-ifFormulaGenerator-multiRange-dialog").hide(),$("#luckysheet-modal-dialog-mask").show(),$("#luckysheet-ifFormulaGenerator-dialog").show();let t=$(this).parents("#luckysheet-ifFormulaGenerator-multiRange-dialog").find("input").val().trim(),o=e.getcellrange(t),i=o.row[0],n=o.row[1],s=o.column[0],u=o.column[1],c=l.deepCopyFlowData(a.flowdata),r=[];for(let e=i;e<=n;e++)for(let l=s;l<=u;l++)null!=c[e]&&null!=c[e][l]&&null!=c[e][l].ct&&"n"==c[e][l].ct.t&&r.push(c[e][l].v);for(let e=0;e<r.length;e++)for(let l=0;l<r.length-1-e;l++)if(r[l]<r[l+1]){let e=r[l];r[l]=r[l+1],r[l+1]=e}let d=r[0],f=r[r.length-1];$("#luckysheet-ifFormulaGenerator-dialog #smallRange").val(f),$("#luckysheet-ifFormulaGenerator-dialog #largeRange").val(d)}),$(document).off("click.IFmultiRangeCancel").on("click.IFmultiRangeCancel","#luckysheet-ifFormulaGenerator-multiRange-cancel",function(){$("#luckysheet-formula-functionrange-select").hide(),$("#luckysheet-row-count-show").hide(),$("#luckysheet-column-count-show").hide(),$("#luckysheet-ifFormulaGenerator-multiRange-dialog").hide(),$("#luckysheet-modal-dialog-mask").show(),$("#luckysheet-ifFormulaGenerator-dialog").show()}),$(document).off("click.IFmultiRangeClose").on("click.IFmultiRangeClose","#luckysheet-ifFormulaGenerator-multiRange-dialog .luckysheet-modal-dialog-title-close",function(){$("#luckysheet-formula-functionrange-select").hide(),$("#luckysheet-row-count-show").hide(),$("#luckysheet-column-count-show").hide(),$("#luckysheet-modal-dialog-mask").show(),$("#luckysheet-ifFormulaGenerator-dialog").show()}),$(document).on("change","#DivisionMethod",function(){"2"==$(this).find("option:selected").val()?$("#DivisionMethodVal").hide():$("#DivisionMethodVal").show(),$("#luckysheet-ifFormulaGenerator-dialog .ifList").empty()}),$(document).off("click.IFcreateBtn").on("click.IFcreateBtn","#luckysheet-ifFormulaGenerator-dialog #createBtn",function(){let e=$(this).parents("#luckysheet-ifFormulaGenerator-dialog").find("#compareValue").val().trim();if(""==e)return void t.info(i.ifGenTipNotNullValue);let l=$(this).parents("#luckysheet-ifFormulaGenerator-dialog").find("#DivisionMethod option:selected").val();if("2"==l){let l='<div class="item"><input type="number" class="smallNum formulaInputFocus"/><select class="operator"><option value="0"> <= </option><option value="1"> < </option></select><span class="compareValue">'+e+'</span><select class="operator2"><option value="0"> <= </option><option value="1" selected="selected"> < </option></select><input type="number" class="largeNum formulaInputFocus"/><span>'+i.ifGenTipLableTitile+'：</span><input type="text" class="markText formulaInputFocus" value=""><i class="fa fa-remove" aria-hidden="true"></i></div>';$("#luckysheet-ifFormulaGenerator-dialog .ifList").append(l)}else{let o=$(this).parents("#luckysheet-ifFormulaGenerator-dialog").find("#smallRange").val().trim(),a=$(this).parents("#luckysheet-ifFormulaGenerator-dialog").find("#largeRange").val().trim(),n=$(this).parents("#luckysheet-ifFormulaGenerator-dialog").find("#DivisionMethodVal").val().trim();if(""==o||""==a)return void t.info(i.ifGenTipRangeNotforNull);if(""==n)return void t.info(i.ifGenTipCutValueNotforNull);t.getIfList(e,o,a,l,n)}}),$(document).on("click","#luckysheet-ifFormulaGenerator-dialog .item .fa-remove",function(){$(this).parents(".item").remove()}),$(document).off("click.IFconfirmBtn").on("click.IFconfirmBtn","#luckysheet-ifFormulaGenerator-dialog-confirm",function(){let e=$(this).parents("#luckysheet-ifFormulaGenerator-dialog").find(".ifList .item"),l="";if($(e.toArray().reverse()).each(function(t,o){let a,n,s,u=$(o).find(".smallNum").val().trim(),c=$(o).find(".largeNum").val().trim(),r=$(o).find(".operator option:selected").val(),d=$(o).find(".operator2 option:selected").val(),f=$(o).find(".compareValue").text(),m=$(o).find(".markText").val().trim();if(""==m&&(m=i.ifGenTipLableTitile+(t+1)),""==u&&""==c)return!0;a="0"==r?f+">="+u:f+">"+u,n="0"==d?f+"<="+c:f+"<"+c,s=0==t&&""==c?a:t==e.length-1&&""==u?n:"and("+a+","+n+")",l=0==t?"if("+s+',"'+m+'")':"if("+s+',"'+m+'",'+l+")"}),0==l.length)return void t.info(i.ifGenTipNotGenCondition);$("#luckysheet-modal-dialog-mask").hide(),$("#luckysheet-ifFormulaGenerator-dialog").hide();let o=a.luckysheet_select_save[a.luckysheet_select_save.length-1],n=o.row_focus,u=o.column_focus;s(n,u,a.flowdata),$("#luckysheet-rich-text-editor").html("="+l),$("#luckysheet-functionbox-cell").html($("#luckysheet-rich-text-editor").html()),$("#luckysheet-wa-functionbox-confirm").click()}),$(document).on("click","#luckysheet-ifFormulaGenerator-info .luckysheet-model-close-btn",function(){$("#luckysheet-modal-dialog-mask").show()}),$(document).on("click","#luckysheet-ifFormulaGenerator-info .luckysheet-modal-dialog-title-close",function(){$("#luckysheet-modal-dialog-mask").show()})},ifFormulaDialog:function(e){let l=this;const t=n(),o=t.formula,i=t.button;$("#luckysheet-modal-dialog-mask").show(),$("#luckysheet-ifFormulaGenerator-dialog").remove();let a="",s="";if(e){let t=e.split("if(");for(let e=1;e<t.length;e++){let i,n,u,c=t[e].replace("and(","").replace(/\)/g,"").replace(/\"/g,"").split(",");c=l.clearArr(c),a=l.splitTxt(c[0])[0],3==c.length?(i=l.splitTxt(c[0])[1],n=l.splitTxt(c[1])[2],u=c[2]):(i=l.splitTxt(c[0])[1],n=l.splitTxt(c[0])[2],u=c[1]),s+='<div class="item"><input type="number" class="smallNum formulaInputFocus" value="'+i+'"/><select class="operator"><option value="0"> <= </option><option value="1"> < </option></select><span class="compareValue">'+a+'</span><select class="operator2"><option value="0"> <= </option><option value="1" selected="selected"> < </option></select><input type="number" class="largeNum formulaInputFocus" value="'+n+'"/><span>'+o.ifGenTipLableTitile+'：</span><input type="text" class="markText formulaInputFocus" value="'+u+'"><i class="fa fa-remove" aria-hidden="true"></i></div>'}}let r='<div class="ifAttr"><div class="attrBox"><label for="compareValue"> '+o.ifGenCompareValueTitle+' </label><div class="inpBox"><input id="compareValue" class="formulaInputFocus" value="'+a+'"/><i class="singRange fa fa-table" aria-hidden="true" title="'+o.ifGenSelectCellTitle+'"></i></div></div><div class="attrBox"><label for="smallRange"> '+o.ifGenRangeTitle+' </label><input type="number" id="smallRange" class="formulaInputFocus"/><span class="text"> '+o.ifGenRangeTo+' </span><input type="number" id="largeRange" class="formulaInputFocus"/><div id="rangeAssess"><span> '+o.ifGenRangeEvaluate+' </span><i class="multiRange fa fa-table" aria-hidden="true" title="'+o.ifGenSelectRangeTitle+'"></i></div></div><div class="attrBox"><label for="DivisionMethod"> '+o.ifGenCutWay+' </label><select id="DivisionMethod"><option value="0"> '+o.ifGenCutSame+' </option><option value="1"> '+o.ifGenCutNpiece+' </option><option value="2"> '+o.ifGenCutCustom+' </option></select><input id="DivisionMethodVal" class="formulaInputFocus"/><div id="createBtn"> '+o.ifGenCutSame+' </div></div></div><div class="ifList">'+s+"</div>";$("body").append(c(u,{id:"luckysheet-ifFormulaGenerator-dialog",addclass:"luckysheet-ifFormulaGenerator-dialog",title:o.ifGenerate,content:r,botton:'<button id="luckysheet-ifFormulaGenerator-dialog-confirm" class="btn btn-primary">'+i.confirm+'</button><button class="btn btn-default luckysheet-model-close-btn">'+i.cancel+"</button>",style:"z-index:100003"}));let d=$("#luckysheet-ifFormulaGenerator-dialog").find(".luckysheet-modal-dialog-content").css("min-width",590).end(),f=d.outerHeight(),m=d.outerWidth(),h=$(window).width(),g=$(window).height(),p=$(document).scrollLeft(),k=$(document).scrollTop();$("#luckysheet-ifFormulaGenerator-dialog").css({left:(h+p-m)/2,top:(g+k-f)/3}).show()},clearArr:function(e){for(let l=0;l<e.length;l++)""!=e[l]&&null!=e[l]&&void 0!=e[l]||e.splice(l,1);return e},splitTxt:function(e){let l,t,o;return-1!=e.indexOf(">=")?[l=e.split(">=")[0],t=e.split(">=")[1],o]:-1!=e.indexOf(">")?[l=e.split(">")[0],t=e.split(">")[1],o]:-1!=e.indexOf("<=")?[l=e.split("<=")[0],t,o=e.split("<=")[1]]:-1!=e.indexOf("<")?[l=e.split("<")[0],t,o=e.split("<")[1]]:void 0},singleRangeDialog:function(e){$("#luckysheet-modal-dialog-mask").hide(),$("#luckysheet-ifFormulaGenerator-dialog").hide(),$("#luckysheet-ifFormulaGenerator-singleRange-dialog").remove();const l=n(),t=l.formula,o=l.button;null==e&&(e=""),$("body").append(c(u,{id:"luckysheet-ifFormulaGenerator-singleRange-dialog",addclass:"luckysheet-ifFormulaGenerator-singleRange-dialog",title:t.ifGenTipSelectCell,content:'<input readonly="readonly" placeholder="'+t.ifGenTipSelectCellPlace+'" value="'+e+'">',botton:'<button id="luckysheet-ifFormulaGenerator-singleRange-confirm" class="btn btn-primary">'+o.confirm+'</button><button id="luckysheet-ifFormulaGenerator-singleRange-cancel" class="btn btn-default">'+o.cancel+"</button>",style:"z-index:100003"}));let i=$("#luckysheet-ifFormulaGenerator-singleRange-dialog").find(".luckysheet-modal-dialog-content").css("min-width",400).end(),a=i.outerHeight(),s=i.outerWidth(),r=$(window).width(),d=$(window).height(),f=$(document).scrollLeft(),m=$(document).scrollTop();$("#luckysheet-ifFormulaGenerator-singleRange-dialog").css({left:(r+f-s)/2,top:(d+m-a)/3}).show()},multiRangeDialog:function(){$("#luckysheet-modal-dialog-mask").hide(),$("#luckysheet-ifFormulaGenerator-dialog").hide(),$("#luckysheet-ifFormulaGenerator-multiRange-dialog").remove();const e=n(),l=e.formula,t=e.button;$("body").append(c(u,{id:"luckysheet-ifFormulaGenerator-multiRange-dialog",addclass:"luckysheet-ifFormulaGenerator-multiRange-dialog",title:l.ifGenTipSelectRange,content:'<input readonly="readonly" placeholder="'+l.ifGenTipSelectRangePlace+'" value="">',botton:'<button id="luckysheet-ifFormulaGenerator-multiRange-confirm" class="btn btn-primary">'+t.confirm+'</button><button id="luckysheet-ifFormulaGenerator-multiRange-cancel" class="btn btn-default">'+t.cancel+"</button>",style:"z-index:100003"}));let o=$("#luckysheet-ifFormulaGenerator-multiRange-dialog").find(".luckysheet-modal-dialog-content").css("min-width",400).end(),i=o.outerHeight(),a=o.outerWidth(),s=$(window).width(),r=$(window).height(),d=$(document).scrollLeft(),f=$(document).scrollTop();$("#luckysheet-ifFormulaGenerator-multiRange-dialog").css({left:(s+d-a)/2,top:(r+f-i)/3}).show()},getIfList:function(e,l,t,o,i){const a=n().formula;$("#luckysheet-ifFormulaGenerator-dialog .ifList").empty(),l=parseInt(l),t=parseInt(t),i=parseInt(i);let s=[];if("0"==o){let e=Math.ceil((t-l)/i);for(let o=0;o<=e;o++){let e=l+i*o;0==o||e>=t?s.push(""):s.push(e)}}else if("1"==o){let e=Math.ceil((t-l)/i);for(let o=0;o<=i;o++){let i=l+e*o;0==o||i>=t?s.push(""):s.push(i)}}for(let l=0;l<s.length-1;l++){let t;t=0==l?"小于"+s[l+1]:l==s.length-2?"大于等于"+s[l]:s[l]+"到"+s[l+1];let o='<div class="item"><input type="number" class="smallNum formulaInputFocus" value="'+s[l]+'"/><select class="operator"><option value="0"> <= </option><option value="1"> < </option></select><span class="compareValue">'+e+'</span><select class="operator2"><option value="0"> <= </option><option value="1" selected="selected"> < </option></select><input type="number" class="largeNum formulaInputFocus" value="'+s[l+1]+'"/><span>'+a.ifGenTipLableTitile+'：</span><input type="text" class="markText formulaInputFocus" value="'+t+'"><i class="fa fa-remove" aria-hidden="true"></i></div>';$("#luckysheet-ifFormulaGenerator-dialog .ifList").append(o)}},info:function(e){$("#luckysheet-modal-dialog-mask").show(),$("#luckysheet-ifFormulaGenerator-info").remove();const l=n().button;$("body").append(c(u,{id:"luckysheet-ifFormulaGenerator-info",addclass:"",title:e,content:"",botton:'<button class="btn btn-default luckysheet-model-close-btn">&nbsp;&nbsp;'+l.close+"&nbsp;&nbsp;</button>",style:"z-index:100003"}));let t=$("#luckysheet-ifFormulaGenerator-info").find(".luckysheet-modal-dialog-content").css("min-width",300).end(),o=t.outerHeight(),i=t.outerWidth(),a=$(window).width(),s=$(window).height(),r=$(document).scrollLeft(),d=$(document).scrollTop();$("#luckysheet-ifFormulaGenerator-info").css({left:(a+r-i)/2,top:(s+d-o)/3}).show()}}});
//# sourceMappingURL=../sourcemaps/controllers/ifFormulaGenerator.js.map
