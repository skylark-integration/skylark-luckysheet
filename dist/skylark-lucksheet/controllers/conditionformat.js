/**
 * skylark-lucksheet - A version of lucksheet.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["../methods/get","../utils/util","../methods/formula_methods","../methods/validate","../widgets/tooltip","../methods/getdata","../methods/format","../methods/conditionformat_methods","../widgets/constant","../widgets/select","../locale/locale","../methods/protection_methods","../methods/luckysheetConfigsetting","../store","skylark-moment"],function(e,t,i,o,l,n,a,d,s,c,r,u,h,g,f){"use strict";const{getSheetIndex:p,getRangetxt:m}=e,{replaceHtml:y,getObjType:v,chatatABC:k}=t,{isRealNull:x}=o,{isEditMode:C}=h,{getcellvalue:R}=n,{genarate:w}=a,{modelHTML:b,luckysheet_CFiconsImg:S}=s,{selectionCopyShow:B}=c,{checkProtectionFormatCells:T}=u;return Object.assign(d,{ruleTypeHtml:function(){const e=r().conditionformat;return`<div class="ruleTypeBox">\n                    <div class="ruleTypeItem">\n                        <span class="icon iconfont luckysheet-iconfont-youjiantou"></span>\n                        <span>${e.ruleTypeItem1}</span>\n                    </div>\n                    <div class="ruleTypeItem">\n                        <span class="icon iconfont luckysheet-iconfont-youjiantou"></span>\n                        <span>${e.ruleTypeItem2}</span>\n                    </div>\n                    <div class="ruleTypeItem">\n                        <span class="icon iconfont luckysheet-iconfont-youjiantou"></span>\n                        <span>${e.ruleTypeItem3}</span>\n                    </div>\n                    <div class="ruleTypeItem">\n                        <span class="icon iconfont luckysheet-iconfont-youjiantou"></span>\n                        <span>${e.ruleTypeItem4}</span>\n                    </div>\n                    <div class="ruleTypeItem">\n                        <span class="icon iconfont luckysheet-iconfont-youjiantou"></span>\n                        <span>${e.ruleTypeItem5}</span>\n                    </div>\n                    <div class="ruleTypeItem">\n                        <span class="icon iconfont luckysheet-iconfont-youjiantou"></span>\n                        <span>${e.ruleTypeItem6}</span>\n                    </div>\n                </div>`},textCellColorHtml:function(){const e=r().conditionformat;return`<div id="textCellColor">\n                    <div class="colorbox">\n                        <input id="checkTextColor" type="checkbox" checked="checked">\n                        <label for="checkTextColor">${e.textColor}：</label>\n                        <input id="textcolorshow" data-tips="${e.textColor}" data-func="background" class="luckysheet-conditionformat-config-color" type="text" value="#9c0006" style="display: none;">\n                    </div>\n                    <div class="colorbox">\n                        <input id="checkCellColor" type="checkbox" checked="checked">\n                        <label for="checkCellColor">${e.cellColor}：</label>\n                        <input id="cellcolorshow" data-tips="${e.cellColor}" data-func="background" class="luckysheet-conditionformat-config-color" type="text" value="#ffc7ce" style="display: none;">\n                    </div>\n                </div>`},init:function(){let e=this;const t=r().conditionformat;$(document).off("change.CFchooseSheet").on("change.CFchooseSheet","#luckysheet-administerRule-dialog .chooseSheet",function(){let t=$("#luckysheet-administerRule-dialog .chooseSheet option:selected").val();e.getConditionRuleList(t)}),$(document).off("click.CFadministerRuleItem").on("click.CFadministerRuleItem","#luckysheet-administerRule-dialog .ruleList .listBox .item",function(){$(this).addClass("on").siblings().removeClass("on")}),$(document).off("click.CFadministerRuleConfirm").on("click.CFadministerRuleConfirm","#luckysheet-administerRule-dialog-confirm",function(){if(!T(g.currentSheetIndex))return;let t=$.extend(!0,[],g.luckysheetfile),i=e.getHistoryRules(t),o=$.extend(!0,[],e.fileClone);for(let e=0;e<o.length;e++){let t=o[e].index;g.luckysheetfile[p(t)].luckysheet_conditionformat_save=o[p(t)].luckysheet_conditionformat_save}let l=$.extend(!0,[],g.luckysheetfile),n=e.getCurrentRules(l);if(e.ref(i,n),$("#luckysheet-modal-dialog-mask").hide(),$("#luckysheet-administerRule-dialog").hide(),g.allowUpdate){let e=$.extend(!0,[],g.luckysheetfile);for(let t=0;t<e.length;t++)g.saveParam("all",e[t].index,e[t].luckysheet_conditionformat_save,{k:"luckysheet_conditionformat_save"})}}),$(document).off("click.CFadministerRuleClose").on("click.CFadministerRuleClose","#luckysheet-administerRule-dialog-close",function(){$("#luckysheet-modal-dialog-mask").hide(),$("#luckysheet-administerRule-dialog").hide(),e.fileClone=[]}),$(document).off("click.CFadministerRuleFa").on("click.CFadministerRuleFa","#luckysheet-administerRule-dialog .item .fa-table",function(){$(this).parents("#luckysheet-administerRule-dialog").hide();let t=$("#luckysheet-administerRule-dialog .chooseSheet select option:selected").val();t!=g.currentSheetIndex&&g.changeSheet(t);let i=$(this).siblings("input").val().trim(),o=$(this).parents(".item").attr("data-item");e.multiRangeDialog(o,i),e.selectRange=[];let l=e.getRangeByTxt(i);if(l.length>0)for(let t=0;t<l.length;t++){let i=l[t].row[0],o=l[t].row[1],n=l[t].column[0],a=l[t].column[1],d=g.visibledatarow[o],s=i-1==-1?0:g.visibledatarow[i-1],c=g.visibledatacolumn[a],r=n-1==-1?0:g.visibledatacolumn[n-1];e.selectRange.push({left:r,width:c-r-1,top:s,height:d-s-1,left_move:r,width_move:c-r-1,top_move:s,height_move:d-s-1,row:[i,o],column:[n,a],row_focus:i,column_focus:n})}B(e.selectRange)}),$(document).off("click.CFmultiRangeConfirm").on("click.CFmultiRangeConfirm","#luckysheet-multiRange-dialog-confirm",function(){$(this).parents("#luckysheet-multiRange-dialog").hide();let t=$(this).attr("data-item"),i=$(this).parents("#luckysheet-multiRange-dialog").find("input").val();$("#luckysheet-administerRule-dialog .item[data-item="+t+"] input").val(i);let o=$("#luckysheet-administerRule-dialog .chooseSheet option:selected").val();e.fileClone[p(o)].luckysheet_conditionformat_save[t].cellrange=e.getRangeByTxt(i),$("#luckysheet-modal-dialog-mask").show(),$("#luckysheet-administerRule-dialog").show();B([])}),$(document).off("click.CFmultiRangeClose").on("click.CFmultiRangeClose","#luckysheet-multiRange-dialog-close",function(){$(this).parents("#luckysheet-multiRange-dialog").hide(),$("#luckysheet-modal-dialog-mask").show(),$("#luckysheet-administerRule-dialog").show(),$("#luckysheet-formula-functionrange-select").hide(),$("#luckysheet-row-count-show").hide(),$("#luckysheet-column-count-show").hide();B([])}),$(document).off("click.CFnewConditionRule").on("click.CFnewConditionRule","#newConditionRule",function(){let i=$("#luckysheet-administerRule-dialog .chooseSheet option:selected").val();T(i)&&(0!=g.luckysheet_select_save.length?e.newConditionRuleDialog(1):C()?alert(t.pleaseSelectRange):l.info(t.pleaseSelectRange,""))}),$(document).off("click.CFnewConditionRuleConfirm").on("click.CFnewConditionRuleConfirm","#luckysheet-newConditionRule-dialog-confirm",function(){if(!T(g.currentSheetIndex))return;let i,o,l=$("#luckysheet-newConditionRule-dialog .ruleTypeItem.on").index(),n=$("#luckysheet-newConditionRule-dialog #type1 option:selected").val(),a=$("#luckysheet-newConditionRule-dialog ."+n+"Box #type2 option:selected").val();if(0==l){if("dataBar"==n){let e=$(this).parents("#luckysheet-newConditionRule-dialog").find(".dataBarBox .luckysheet-conditionformat-config-color").spectrum("get").toHexString();"gradient"==a?i=[e,"#ffffff"]:"solid"==a&&(i=[e]),o={type:"dataBar",cellrange:$.extend(!0,[],g.luckysheet_select_save),format:i}}else if("colorGradation"==n){let e=$(this).parents("#luckysheet-newConditionRule-dialog").find(".colorGradationBox .maxVal .luckysheet-conditionformat-config-color").spectrum("get").toRgbString(),t=$(this).parents("#luckysheet-newConditionRule-dialog").find(".colorGradationBox .midVal .luckysheet-conditionformat-config-color").spectrum("get").toRgbString(),l=$(this).parents("#luckysheet-newConditionRule-dialog").find(".colorGradationBox .minVal .luckysheet-conditionformat-config-color").spectrum("get").toRgbString();"threeColor"==a?i=[e,t,l]:"twoColor"==a&&(i=[e,l]),o={type:"colorGradation",cellrange:$.extend(!0,[],g.luckysheet_select_save),format:i}}else if("icons"==n){i={len:$(this).parents("#luckysheet-newConditionRule-dialog").find(".iconsBox .model").attr("data-len"),leftMin:$(this).parents("#luckysheet-newConditionRule-dialog").find(".iconsBox .model").attr("data-leftmin"),top:$(this).parents("#luckysheet-newConditionRule-dialog").find(".iconsBox .model").attr("data-top")},o={type:"icons",cellrange:$.extend(!0,[],g.luckysheet_select_save),format:i}}}else{let d,s,c="",r=[],u=[];if(1==l){if("number"==n)if(c=a,"betweenness"==a){let i=$("#luckysheet-newConditionRule-dialog #conditionVal input").val().trim(),o=$("#luckysheet-newConditionRule-dialog #conditionVal2 input").val().trim(),l=e.getRangeByTxt(i);if(l.length>1)return void e.infoDialog(t.onlySingleCell,"");if(1==l.length){let o=l[0].row[0],n=l[0].row[1],a=l[0].column[0],d=l[0].column[1];if(o!=n||a!=d)return void e.infoDialog(t.onlySingleCell,"");i=R(o,a,g.flowdata),r.push({row:l[0].row,column:l[0].column}),u.push(i)}else if(0==l.length){if(isNaN(i)||""==i)return void e.infoDialog(t.conditionValueCanOnly,"");u.push(i)}let n=e.getRangeByTxt(o);if(n.length>1)return void e.infoDialog(t.onlySingleCell,"");if(1==n.length){let i=n[0].row[0],l=n[0].row[1],a=n[0].column[0],d=n[0].column[1];if(i!=l||a!=d)return void e.infoDialog(t.onlySingleCell,"");o=R(i,a,g.flowdata),r.push({row:n[0].row,column:n[0].column}),u.push(o)}else if(0==n.length){if(isNaN(o)||""==o)return void e.infoDialog(t.conditionValueCanOnly,"");u.push(o)}}else{let i=$("#luckysheet-newConditionRule-dialog #conditionVal input").val().trim(),o=e.getRangeByTxt(i);if(o.length>1)return void e.infoDialog(t.onlySingleCell,"");if(1==o.length){let l=o[0].row[0],n=o[0].row[1],a=o[0].column[0],d=o[0].column[1];if(l!=n||a!=d)return void e.infoDialog(t.onlySingleCell,"");i=R(l,a,g.flowdata),r.push({row:o[0].row,column:o[0].column}),u.push(i)}else if(0==o.length){if(isNaN(i)||""==i)return void e.infoDialog(t.conditionValueCanOnly,"");u.push(i)}}else if("text"==n){c="textContains";let i=$("#luckysheet-newConditionRule-dialog #conditionVal input").val().trim(),o=e.getRangeByTxt(i);if(o.length>1)return void e.infoDialog(t.onlySingleCell,"");if(1==o.length){let l=o[0].row[0],n=o[0].row[1],a=o[0].column[0],d=o[0].column[1];if(l!=n||a!=d)return void e.infoDialog(t.onlySingleCell,"");i=R(l,a,g.flowdata),r.push({row:o[0].row,column:o[0].column}),u.push(i)}else if(0==o.length){if(""==i)return void e.infoDialog(t.conditionValueCanOnly,"");u.push(i)}}else if("date"==n){c="occurrenceDate";let i=$("#luckysheet-newConditionRule-dialog #daterange-btn").val();if(""==i||null==i)return void e.infoDialog(t.pleaseSelectADate,"");u.push(i)}}else if(2==l){"top"==n?c=$("#luckysheet-newConditionRule-dialog #isPercent").is(":selected")?"top10%":"top10":"last"==n&&(c=$("#luckysheet-newConditionRule-dialog #isPercent").is(":selected")?"last10%":"last10");let i=$("#luckysheet-newConditionRule-dialog #conditionVal input").val().trim();if(parseInt(i)!=i||parseInt(i)<1||parseInt(i)>1e3)return void e.infoDialog(t.pleaseEnterInteger,"");u.push(parseInt(i))}else if(3==l)"AboveAverage"==n?(c="AboveAverage",u.push("AboveAverage")):"SubAverage"==n&&(c="SubAverage",u.push("SubAverage"));else if(4==l)c="duplicateValue",u.push(n);else if(5==l){c="formula";let t=$("#luckysheet-newConditionRule-dialog #formulaConditionVal input").val().trim();if(""==t)return void e.infoDialog("Condition value cannot be empty!","");u.push(t)}i={textColor:d=$("#luckysheet-newConditionRule-dialog #checkTextColor").is(":checked")?$("#luckysheet-newConditionRule-dialog #textcolorshow").spectrum("get").toHexString():null,cellColor:s=$("#luckysheet-newConditionRule-dialog #checkCellColor").is(":checked")?$("#luckysheet-newConditionRule-dialog #cellcolorshow").spectrum("get").toHexString():null},o={type:"default",cellrange:$.extend(!0,[],g.luckysheet_select_save),format:i,conditionName:c,conditionRange:r,conditionValue:u}}$("#luckysheet-newConditionRule-dialog").hide();let d=$(this).attr("data-source");if(0==d){$("#luckysheet-modal-dialog-mask").hide();let t=$.extend(!0,[],g.luckysheetfile),i=e.getHistoryRules(t),l=void 0==g.luckysheetfile[p(g.currentSheetIndex)].luckysheet_conditionformat_save?[]:g.luckysheetfile[p(g.currentSheetIndex)].luckysheet_conditionformat_save;l.push(o),g.luckysheetfile[p(g.currentSheetIndex)].luckysheet_conditionformat_save=l;let n=$.extend(!0,[],g.luckysheetfile),a=e.getCurrentRules(n);e.ref(i,a),g.allowUpdate&&g.saveParam("all",g.currentSheetIndex,l,{k:"luckysheet_conditionformat_save"})}else if(1==d){let t=e.fileClone[p(g.currentSheetIndex)].luckysheet_conditionformat_save?e.fileClone[p(g.currentSheetIndex)].luckysheet_conditionformat_save:[];t.push(o),e.fileClone[p(g.currentSheetIndex)].luckysheet_conditionformat_save=t,e.administerRuleDialog()}}),$(document).off("click.CFnewConditionRuleClose").on("click.CFnewConditionRuleClose","#luckysheet-newConditionRule-dialog-close",function(){let e=$(this).attr("data-source");0==e&&$("#luckysheet-modal-dialog-mask").hide(),1==e&&$("#luckysheet-administerRule-dialog").show(),$("#luckysheet-newConditionRule-dialog").hide(),$("#luckysheet-formula-functionrange-select").hide(),$("#luckysheet-row-count-show").hide(),$("#luckysheet-column-count-show").hide()}),$(document).off("click.CFeditorConditionRule").on("click.CFeditorConditionRule","#editorConditionRule",function(){let t=$("#luckysheet-administerRule-dialog .chooseSheet option:selected").val();if(!T(t))return;let i=$("#luckysheet-administerRule-dialog .ruleList .listBox .item.on").attr("data-item"),o={sheetIndex:t,itemIndex:i,data:e.fileClone[p(t)].luckysheet_conditionformat_save[i]};e.editorRule=o,e.editorConditionRuleDialog()}),$(document).off("click.CFeditorConditionRuleConfirm").on("click.CFeditorConditionRuleConfirm","#luckysheet-editorConditionRule-dialog-confirm",function(){let i,o,l=$("#luckysheet-editorConditionRule-dialog .ruleTypeItem.on").index(),n=$("#luckysheet-editorConditionRule-dialog #type1 option:selected").val(),a=$("#luckysheet-editorConditionRule-dialog ."+n+"Box #type2 option:selected").val(),d=e.editorRule.data.cellrange;if(0==l){if("dataBar"==n){let e=$(this).parents("#luckysheet-editorConditionRule-dialog").find(".dataBarBox .luckysheet-conditionformat-config-color").spectrum("get").toHexString();"gradient"==a?i=[e,"#ffffff"]:"solid"==a&&(i=[e]),o={type:"dataBar",cellrange:d,format:i}}else if("colorGradation"==n){let e=$(this).parents("#luckysheet-editorConditionRule-dialog").find(".colorGradationBox .maxVal .luckysheet-conditionformat-config-color").spectrum("get").toRgbString(),t=$(this).parents("#luckysheet-editorConditionRule-dialog").find(".colorGradationBox .midVal .luckysheet-conditionformat-config-color").spectrum("get").toRgbString(),l=$(this).parents("#luckysheet-editorConditionRule-dialog").find(".colorGradationBox .minVal .luckysheet-conditionformat-config-color").spectrum("get").toRgbString();"threeColor"==a?i=[e,t,l]:"twoColor"==a&&(i=[e,l]),o={type:"colorGradation",cellrange:d,format:i}}else if("icons"==n){o={type:"icons",cellrange:d,format:i={len:$(this).parents("#luckysheet-editorConditionRule-dialog").find(".iconsBox .model").attr("data-len"),leftMin:$(this).parents("#luckysheet-editorConditionRule-dialog").find(".iconsBox .model").attr("data-leftmin"),top:$(this).parents("#luckysheet-editorConditionRule-dialog").find(".iconsBox .model").attr("data-top")}}}}else{let s,c,r="",u=[],h=[];if(1==l){if("number"==n)if(r=a,"betweenness"==a){let i=$("#luckysheet-editorConditionRule-dialog #conditionVal input").val().trim(),o=$("#luckysheet-editorConditionRule-dialog #conditionVal2 input").val().trim(),l=e.getRangeByTxt(i);if(l.length>1)return void e.infoDialog(t.onlySingleCell,"");if(1==l.length){let o=l[0].row[0],n=l[0].row[1],a=l[0].column[0],d=l[0].column[1];if(o!=n||a!=d)return void e.infoDialog(t.onlySingleCell,"");i=R(o,a,g.flowdata),u.push({row:l[0].row,column:l[0].column}),h.push(i)}else if(0==l.length){if(isNaN(i)||""==i)return void e.infoDialog(t.conditionValueCanOnly,"");h.push(i)}let n=e.getRangeByTxt(o);if(n.length>1)return void e.infoDialog(t.onlySingleCell,"");if(1==n.length){let i=n[0].row[0],l=n[0].row[1],a=n[0].column[0],d=n[0].column[1];if(i!=l||a!=d)return void e.infoDialog(t.onlySingleCell,"");o=R(i,a,g.flowdata),u.push({row:n[0].row,column:n[0].column}),h.push(o)}else if(0==n.length){if(isNaN(o)||""==o)return void e.infoDialog(t.conditionValueCanOnly,"");h.push(o)}}else{let i=$("#luckysheet-editorConditionRule-dialog #conditionVal input").val().trim(),o=e.getRangeByTxt(i);if(o.length>1)return void e.infoDialog(t.onlySingleCell,"");if(1==o.length){let l=o[0].row[0],n=o[0].row[1],a=o[0].column[0],d=o[0].column[1];if(l!=n||a!=d)return void e.infoDialog(t.onlySingleCell,"");i=R(l,a,g.flowdata),u.push({row:o[0].row,column:o[0].column}),h.push(i)}else if(0==o.length){if(isNaN(i)||""==i)return void e.infoDialog(t.conditionValueCanOnly,"");h.push(i)}}else if("text"==n){r="textContains";let i=$("#luckysheet-editorConditionRule-dialog #conditionVal input").val().trim(),o=e.getRangeByTxt(i);if(o.length>1)return void e.infoDialog(t.onlySingleCell,"");if(1==o.length){let l=o[0].row[0],n=o[0].row[1],a=o[0].column[0],d=o[0].column[1];if(l!=n||a!=d)return void e.infoDialog(t.onlySingleCell,"");i=R(l,a,g.flowdata),u.push({row:o[0].row,column:o[0].column}),h.push(i)}else if(0==o.length){if(isNaN(i)||""==i)return void e.infoDialog(t.conditionValueCanOnly,"");h.push(i)}}else if("date"==n){r="occurrenceDate";let i=$("#luckysheet-editorConditionRule-dialog #daterange-btn").val();if(""==i||null==i)return void e.infoDialog(t.pleaseSelectADate,"");h.push(i)}}else if(2==l){"top"==n?r=$("#luckysheet-editorConditionRule-dialog #isPercent").is(":selected")?"top10%":"top10":"last"==n&&(r=$("#luckysheet-editorConditionRule-dialog #isPercent").is(":selected")?"last10%":"last10");let i=$("#luckysheet-editorConditionRule-dialog #conditionVal input").val().trim();if(parseInt(i)!=i||parseInt(i)<1||parseInt(i)>1e3)return void e.infoDialog(t.pleaseEnterInteger,"");h.push(i)}else if(3==l)"AboveAverage"==n?(r="AboveAverage",h.push("AboveAverage")):"SubAverage"==n&&(r="SubAverage",h.push("SubAverage"));else if(4==l)r="duplicateValue",h.push(n);else if(5==l){r="formula";let t=$("#luckysheet-editorConditionRule-dialog #formulaConditionVal input").val().trim();if(console.log(t),""==t)return void e.infoDialog("Condition value cannot be empty!","");h.push(t)}o={type:"default",cellrange:d,format:i={textColor:s=$("#luckysheet-editorConditionRule-dialog #checkTextColor").is(":checked")?$("#luckysheet-editorConditionRule-dialog #textcolorshow").spectrum("get").toHexString():null,cellColor:c=$("#luckysheet-editorConditionRule-dialog #checkCellColor").is(":checked")?$("#luckysheet-editorConditionRule-dialog #cellcolorshow").spectrum("get").toHexString():null},conditionName:r,conditionRange:u,conditionValue:h}}let s=e.editorRule.sheetIndex,c=e.editorRule.itemIndex;e.fileClone[p(s)].luckysheet_conditionformat_save[c]=o,$("#luckysheet-editorConditionRule-dialog").hide(),e.administerRuleDialog()}),$(document).off("click.CFeditorConditionRuleClose").on("click.CFeditorConditionRuleClose","#luckysheet-editorConditionRule-dialog-close",function(){$("#luckysheet-editorConditionRule-dialog").hide(),$("#luckysheet-administerRule-dialog").show(),$("#luckysheet-formula-functionrange-select").hide(),$("#luckysheet-row-count-show").hide(),$("#luckysheet-column-count-show").hide()}),$(document).off("click.CFnewEditorRuleItem").on("click.CFnewEditorRuleItem",".luckysheet-newEditorRule-dialog .ruleTypeItem",function(){$(this).addClass("on").siblings().removeClass("on");let t=$(this).index();$(this).parents(".luckysheet-newEditorRule-dialog").find(".ruleExplainBox").html(e.getRuleExplain(t)),e.colorSelectInit()}),$(document).off("change.CFnewEditorRuleType1").on("change.CFnewEditorRuleType1",".luckysheet-newEditorRule-dialog #type1",function(){let t=$(this).find("option:selected").val();"dataBar"!=t&&"colorGradation"!=t&&"icons"!=t&&"number"!=t&&"text"!=t&&"date"!=t||$(this).parents(".luckysheet-newEditorRule-dialog").find("."+t+"Box").show().siblings().hide(),"date"==t&&e.daterangeInit($(this).parents(".luckysheet-newEditorRule-dialog").attr("id"))}),$(document).off("change.CFnewEditorRuleType2").on("change.CFnewEditorRuleType2",".luckysheet-newEditorRule-dialog #type2",function(){let e=$(this).parents(".luckysheet-newEditorRule-dialog").find("#type1 option:selected").val();if("colorGradation"==e){"threeColor"==$(this).find("option:selected").val()?$(this).parents(".luckysheet-newEditorRule-dialog").find(".midVal").show():$(this).parents(".luckysheet-newEditorRule-dialog").find(".midVal").hide()}else if("number"==e){"betweenness"==$(this).find("option:selected").val()?($(this).parents(".luckysheet-newEditorRule-dialog").find(".txt").show(),$(this).parents(".luckysheet-newEditorRule-dialog").find("#conditionVal2").show()):($(this).parents(".luckysheet-newEditorRule-dialog").find(".txt").hide(),$(this).parents(".luckysheet-newEditorRule-dialog").find("#conditionVal2").hide())}}),$(document).off("click.CFiconsShowbox").on("click.CFiconsShowbox",".luckysheet-newEditorRule-dialog .iconsBox .showbox",function(){$(this).parents(".iconsBox").find("ul").toggle()}),$(document).off("click.CFiconsLi").on("click.CFiconsLi",".luckysheet-newEditorRule-dialog .iconsBox li",function(){let e=$(this).find("div").attr("data-len"),t=$(this).find("div").attr("data-leftmin"),i=$(this).find("div").attr("data-top"),o=$(this).find("div").attr("title"),l=$(this).find("div").css("background-position");$(this).parents(".iconsBox").find(".showbox .model").css("background-position",l),$(this).parents(".iconsBox").find(".showbox .model").attr("data-len",e),$(this).parents(".iconsBox").find(".showbox .model").attr("data-leftmin",t),$(this).parents(".iconsBox").find(".showbox .model").attr("data-top",i),$(this).parents(".iconsBox").find(".showbox .model").attr("title",o),$(this).parents("ul").hide()}),$(document).off("click.CFdeleteConditionRule").on("click.CFdeleteConditionRule","#deleteConditionRule",function(){let t=$("#luckysheet-administerRule-dialog .chooseSheet option:selected").val();if(!T(t))return;let i=$("#luckysheet-administerRule-dialog .ruleList .listBox .item.on").attr("data-item");e.fileClone[p(t)].luckysheet_conditionformat_save.splice(i,1),e.administerRuleDialog()}),$(document).off("click.CFdefault").on("click.CFdefault","#luckysheet-conditionformat-dialog-confirm",function(){if(!T(g.currentSheetIndex))return;let i,o,l=$("#luckysheet-conditionformat-dialog .box").attr("data-itemvalue"),n=[],a=[];if("greaterThan"==l||"lessThan"==l||"equal"==l||"textContains"==l){let i=$("#luckysheet-conditionformat-dialog #conditionVal").val().trim(),o=e.getRangeByTxt(i);if(o.length>1)return void e.infoDialog(t.onlySingleCell,"");if(1==o.length){let l=o[0].row[0],d=o[0].row[1],s=o[0].column[0],c=o[0].column[1];if(l!=d||s!=c)return void e.infoDialog(t.onlySingleCell,"");i=R(l,s,g.flowdata),n.push({row:o[0].row,column:o[0].column}),a.push(i)}else if(0==o.length){if(isNaN(i)||""==i)return void e.infoDialog(t.conditionValueCanOnly,"");a.push(i)}}else if("betweenness"==l){let i=$("#luckysheet-conditionformat-dialog #conditionVal").val().trim(),o=$("#luckysheet-conditionformat-dialog #conditionVal2").val().trim(),l=e.getRangeByTxt(i);if(l.length>1)return void e.infoDialog(t.onlySingleCell,"");if(1==l.length){let o=l[0].row[0],d=l[0].row[1],s=l[0].column[0],c=l[0].column[1];if(o!=d||s!=c)return void e.infoDialog(t.onlySingleCell,"");i=R(o,s,g.flowdata),n.push({row:l[0].row,column:l[0].column}),a.push(i)}else if(0==l.length){if(isNaN(i)||""==i)return void e.infoDialog(t.conditionValueCanOnly,"");a.push(i)}let d=e.getRangeByTxt(o);if(d.length>1)return void e.infoDialog(t.onlySingleCell,"");if(1==d.length){let i=d[0].row[0],l=d[0].row[1],s=d[0].column[0],c=d[0].column[1];if(i!=l||s!=c)return void e.infoDialog(t.onlySingleCell,"");o=R(i,s,g.flowdata),n.push({row:d[0].row,column:d[0].column}),a.push(o)}else if(0==d.length){if(isNaN(o)||""==o)return void e.infoDialog(t.conditionValueCanOnly,"");a.push(o)}}else if("occurrenceDate"==l){let i=$("#luckysheet-conditionformat-dialog #daterange-btn").val();if(""==i||null==i)return void e.infoDialog(t.pleaseSelectADate,"");a.push(i)}else if("duplicateValue"==l)a.push($("#luckysheet-conditionformat-dialog #conditionVal option:selected").val());else if("top10"==l||"top10%"==l||"last10"==l||"last10%"==l){let i=$("#luckysheet-conditionformat-dialog #conditionVal").val().trim();if(parseInt(i)!=i||parseInt(i)<1||parseInt(i)>1e3)return void e.infoDialog(t.pleaseEnterInteger,"");a.push(i)}else"AboveAverage"==l?a.push("AboveAverage"):"SubAverage"==l&&a.push("SubAverage");i=$("#checkTextColor").is(":checked")?$("#textcolorshow").spectrum("get").toHexString():null,o=$("#checkCellColor").is(":checked")?$("#cellcolorshow").spectrum("get").toHexString():null;let d=$.extend(!0,[],g.luckysheetfile),s=e.getHistoryRules(d),c={type:"default",cellrange:$.extend(!0,[],g.luckysheet_select_save),format:{textColor:i,cellColor:o},conditionName:l,conditionRange:n,conditionValue:a},r=void 0==g.luckysheetfile[p(g.currentSheetIndex)].luckysheet_conditionformat_save?[]:g.luckysheetfile[p(g.currentSheetIndex)].luckysheet_conditionformat_save;r.push(c),g.luckysheetfile[p(g.currentSheetIndex)].luckysheet_conditionformat_save=r;let u=$.extend(!0,[],g.luckysheetfile),h=e.getCurrentRules(u);e.ref(s,h),$("#luckysheet-modal-dialog-mask").hide(),$("#luckysheet-conditionformat-dialog").hide(),g.allowUpdate&&g.saveParam("all",g.currentSheetIndex,r,{k:"luckysheet_conditionformat_save"})}),$(document).off("click.CFicons").on("click.CFicons","#luckysheet-CFicons-dialog .item",function(){if($("#luckysheet-modal-dialog-mask").hide(),$("#luckysheet-CFicons-dialog").hide(),g.luckysheet_select_save.length>0){let t=$.extend(!0,[],g.luckysheet_select_save),i={len:$(this).attr("data-len"),leftMin:$(this).attr("data-leftMin"),top:$(this).attr("data-top")};e.updateItem("icons",t,i)}}),$(document).on("click",".range .fa-table",function(){let t,i=$(this).parents(".luckysheet-modal-dialog").attr("id");if($("#"+i).hide(),"luckysheet-conditionformat-dialog"==i){t="conditionVal"==$(this).siblings("input").attr("id")?"0_1":"0_2"}else if("luckysheet-newConditionRule-dialog"==i){let e=$(this).parents(".range").attr("id");t="formulaConditionVal"==e?"1_0":"conditionVal"==e?"1_1":"1_2"}else if("luckysheet-editorConditionRule-dialog"==i){let e=$(this).parents(".range").attr("id");t="formulaConditionVal"==e?"2_0":"conditionVal"==e?"2_1":"2_2"}let o=$(this).siblings("input").val();e.singleRangeDialog(t,o),B(e.getRangeByTxt(o))}),$(document).on("click","#luckysheet-singleRange-dialog-confirm",function(){$("#luckysheet-modal-dialog-mask").show(),$(this).parents("#luckysheet-singleRange-dialog").hide();let e=$(this).attr("data-source"),t=$(this).parents("#luckysheet-singleRange-dialog").find("input").val();"0_1"==e?($("#luckysheet-conditionformat-dialog").show(),$("#luckysheet-conditionformat-dialog #conditionVal").val(t)):"0_2"==e?($("#luckysheet-conditionformat-dialog").show(),$("#luckysheet-conditionformat-dialog #conditionVal2").val(t)):"1_0"==e?($("#luckysheet-newConditionRule-dialog").show(),$("#luckysheet-newConditionRule-dialog #formulaConditionVal input").val(t)):"1_1"==e?($("#luckysheet-newConditionRule-dialog").show(),$("#luckysheet-newConditionRule-dialog #conditionVal input").val(t)):"1_2"==e?($("#luckysheet-newConditionRule-dialog").show(),$("#luckysheet-newConditionRule-dialog #conditionVal2 input").val(t)):"2_0"==e?($("#luckysheet-editorConditionRule-dialog").show(),$("#luckysheet-editorConditionRule-dialog #formulaConditionVal input").val(t)):"2_1"==e?($("#luckysheet-editorConditionRule-dialog").show(),$("#luckysheet-editorConditionRule-dialog #conditionVal input").val(t)):"2_2"==e&&($("#luckysheet-editorConditionRule-dialog").show(),$("#luckysheet-editorConditionRule-dialog #conditionVal2 input").val(t));B([])}),$(document).on("click","#luckysheet-singleRange-dialog-close",function(){$("#luckysheet-modal-dialog-mask").show(),$(this).parents("#luckysheet-singleRange-dialog").hide();let e=$(this).attr("data-source");"0_1"==e||"0_2"==e?$("#luckysheet-conditionformat-dialog").show():"1_0"==e||"1_1"==e||"1_2"==e?$("#luckysheet-newConditionRule-dialog").show():"2_0"!=e&&"2_1"!=e&&"2_2"!=e||$("#luckysheet-editorConditionRule-dialog").show();B([])}),$(document).on("click",".luckysheet-modal-dialog-title-close",function(){let e=$(this).parents(".luckysheet-modal-dialog").attr("id");if("luckysheet-newConditionRule-dialog"==e){1==$("#"+e).find("#luckysheet-newConditionRule-dialog-close").attr("data-source")&&$("#luckysheet-administerRule-dialog").show()}if("luckysheet-editorConditionRule-dialog"==e&&$("#luckysheet-administerRule-dialog").show(),"luckysheet-singleRange-dialog"==e){$("#luckysheet-modal-dialog-mask").show();let e=$(this).parents("#luckysheet-singleRange-dialog").find("#luckysheet-singleRange-dialog-confirm").attr("data-source");"0_1"==e||"0_2"==e?$("#luckysheet-conditionformat-dialog").show():"1_1"==e||"1_2"==e?$("#luckysheet-newConditionRule-dialog").show():"2_1"!=e&&"2_2"!=e||$("#luckysheet-editorConditionRule-dialog").show(),B([])}if("luckysheet-multiRange-dialog"==e){$("#luckysheet-modal-dialog-mask").show(),$("#luckysheet-administerRule-dialog").show(),B([])}"luckysheet-conditionformat-info-dialog"==e&&$("#luckysheet-modal-dialog-mask").show()}),$(document).on("click","#luckysheet-conditionformat-info-dialog-close",function(){$(this).parents("#luckysheet-conditionformat-info-dialog").hide()})},singleRangeDialog:function(e,t){$("#luckysheet-modal-dialog-mask").hide(),$("#luckysheet-singleRange-dialog").remove();const i=r().conditionformat;$("body").append(y(b,{id:"luckysheet-singleRange-dialog",addclass:"luckysheet-singleRange-dialog",title:i.selectCell,content:`<input readonly="readonly" placeholder="${i.pleaseSelectCell}" value="${t}"/>`,botton:`<button id="luckysheet-singleRange-dialog-confirm" class="btn btn-primary" data-source="${e}">${i.confirm}</button>\n                        <button id="luckysheet-singleRange-dialog-close" class="btn btn-default" data-source="${e}">${i.cancel}</button>`,style:"z-index:100003"}));let o=$("#luckysheet-singleRange-dialog").find(".luckysheet-modal-dialog-content").css("min-width",300).end(),l=o.outerHeight(),n=o.outerWidth(),a=$(window).width(),d=$(window).height(),s=$(document).scrollLeft(),c=$(document).scrollTop();$("#luckysheet-singleRange-dialog").css({left:(a+s-n)/2,top:(d+c-l)/3}).show()},multiRangeDialog:function(e,t){$("#luckysheet-modal-dialog-mask").hide(),$("#luckysheet-multiRange-dialog").remove();const i=r().conditionformat;$("body").append(y(b,{id:"luckysheet-multiRange-dialog",addclass:"luckysheet-multiRange-dialog",title:i.selectRange,content:`<input readonly="readonly" placeholder="${i.pleaseSelectRange}" value="${t}"/>`,botton:`<button id="luckysheet-multiRange-dialog-confirm" class="btn btn-primary" data-item="${e}">${i.confirm}</button>\n                        <button id="luckysheet-multiRange-dialog-close" class="btn btn-default">${i.cancel}</button>`,style:"z-index:100003"}));let o=$("#luckysheet-multiRange-dialog").find(".luckysheet-modal-dialog-content").css("min-width",300).end(),l=o.outerHeight(),n=o.outerWidth(),a=$(window).width(),d=$(window).height(),s=$(document).scrollLeft(),c=$(document).scrollTop();$("#luckysheet-multiRange-dialog").css({left:(a+s-n)/2,top:(d+c-l)/3}).show(),B(this.getRangeByTxt(t))},colorSelectInit:function(){const e=r().conditionformat;$(".luckysheet-conditionformat-config-color").spectrum({showPalette:!0,showPaletteOnly:!0,preferredFormat:"hex",clickoutFiresChange:!1,showInitial:!0,showInput:!0,hideAfterPaletteSelect:!0,showSelectionPalette:!0,maxPaletteSize:8,maxSelectionSize:8,cancelText:e.cancel,chooseText:e.confirmColor,togglePaletteMoreText:"自定义",togglePaletteLessText:"收起",togglePaletteOnly:!0,clearText:e.clearColorSelect,noColorSelectedText:"没有颜色被选择",localStorageKey:"spectrum.textcolor"+g.gridKey,palette:[["#000","#444","#666","#999","#ccc","#eee","#f3f3f3","#fff"],["#f00","#f90","#ff0","#0f0","#0ff","#00f","#90f","#f0f"],["#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d0e0e3","#cfe2f3","#d9d2e9","#ead1dc"],["#ea9999","#f9cb9c","#ffe599","#b6d7a8","#a2c4c9","#9fc5e8","#b4a7d6","#d5a6bd"],["#e06666","#f6b26b","#ffd966","#93c47d","#76a5af","#6fa8dc","#8e7cc3","#c27ba0"],["#c00","#e69138","#f1c232","#6aa84f","#45818e","#3d85c6","#674ea7","#a64d79"],["#900","#b45f06","#bf9000","#38761d","#134f5c","#0b5394","#351c75","#741b47"],["#600","#783f04","#7f6000","#274e13","#0c343d","#073763","#20124d","#4c1130"]],change:function(e){null!=e&&(e=e.toHexString())}})},conditionformatDialog:function(e,t){let i=this;$("#luckysheet-modal-dialog-mask").show(),$("#luckysheet-conditionformat-dialog").remove();const o=r().conditionformat;$("body").append(y(b,{id:"luckysheet-conditionformat-dialog",addclass:"luckysheet-conditionformat-dialog",title:e,content:t,botton:`<button id="luckysheet-conditionformat-dialog-confirm" class="btn btn-primary">${o.confirm}</button>\n                        <button class="btn btn-default luckysheet-model-close-btn">${o.cancel}</button>`,style:"z-index:9999"}));let l=$("#luckysheet-conditionformat-dialog").find(".luckysheet-modal-dialog-content").css("min-width",300).end(),n=l.outerHeight(),a=l.outerWidth(),d=$(window).width(),s=$(window).height(),c=$(document).scrollLeft(),u=$(document).scrollTop();$("#luckysheet-conditionformat-dialog").css({left:(d+c-a)/2,top:(s+u-n)/3}).show(),i.init(),i.colorSelectInit(),e==r().conditionformat.conditionformat_occurrenceDate&&i.daterangeInit("luckysheet-conditionformat-dialog")},CFiconsDialog:function(){$("#luckysheet-modal-dialog-mask").show(),$("#luckysheet-CFicons-dialog").remove();const e=r().conditionformat;let t=`<div class="box">\n                            <div style="margin-bottom: 10px;">${e.pleaseSelectIcon}</div>\n                            <div class="title">${e.direction}</div>\n                            <div class="list">\n                                <div class="left">\n                                    <div class="item" data-len="3" data-leftMin="0" data-top="0" title="${e.threeWayArrow}(${e.multicolor})"><div style="background-position:0 0;"></div></div>\n                                    <div class="item" data-len="3" data-leftMin="0" data-top="1" title="${e.threeTriangles}"><div style="background-position:0 -20px;"></div></div>\n                                    <div class="item" data-len="4" data-leftMin="0" data-top="2" title="${e.fourWayArrow}(${e.multicolor})"><div style="background-position:0 -40px;"></div></div>\n                                    <div class="item" data-len="5" data-leftMin="0" data-top="3" title="${e.fiveWayArrow}(${e.multicolor})"><div style="background-position:0 -60px;"></div></div>\n                                </div>\n                                <div class="right">\n                                    <div class="item" data-len="3" data-leftMin="5" data-top="0" title="${e.threeWayArrow}(${e.grayColor})"><div style="background-position:-131px 0;"></div></div>\n                                    <div class="item" data-len="4" data-leftMin="5" data-top="1" title="${e.fourWayArrow}(${e.grayColor})"><div style="background-position:-131px -20px;"></div></div>\n                                    <div class="item" data-len="5" data-leftMin="5" data-top="2" title="${e.fiveWayArrow}(${e.grayColor})"><div style="background-position:-131px -40px;"></div></div>\n                                </div>\n                                <div style="clear:both;"></div>\n                            </div>\n                            <div class="title">${e.shape}</div>\n                            <div class="list">\n                                <div class="left">\n                                    <div class="item" data-len="3" data-leftMin="0" data-top="4" title="${e.threeColorTrafficLight}(${e.rimless})"><div style="background-position:0 -80px;"></div></div>\n                                    <div class="item" data-len="3" data-leftMin="0" data-top="5" title="${e.threeSigns}"><div style="background-position:0 -100px;"></div></div>\n                                    <div class="item" data-len="4" data-leftMin="0" data-top="6" title="${e.greenRedBlackGradient}"><div style="background-position:0 -120px;"></div></div>\n                                </div>\n                                <div class="right">\n                                    <div class="item" data-len="3" data-leftMin="5" data-top="4" title="${e.threeColorTrafficLight}(${e.bordered})"><div style="background-position:-131px -80px;"></div></div>\n                                    <div class="item" data-len="4" data-leftMin="5" data-top="5" title="${e.fourColorTrafficLight}"><div style="background-position:-131px -100px;"></div></div>\n                                </div>\n                                <div style="clear:both;"></div>\n                            </div>\n                            <div class="title">${e.mark}</div>\n                            <div class="list">\n                                <div class="left">\n                                    <div class="item" data-len="3" data-leftMin="0" data-top="7" title="${e.threeSymbols}(${e.circled})"><div style="background-position:0 -140px;"></div></div>\n                                    <div class="item" data-len="3" data-leftMin="0" data-top="8" title="${e.tricolorFlag}"><div style="background-position:0 -160px;"></div></div>\n                                </div>\n                                <div class="right">\n                                    <div class="item" data-len="3" data-leftMin="5" data-top="7" title="${e.threeSymbols}(${e.noCircle})"><div style="background-position:-131px -140px;"></div></div>\n                                </div>\n                                <div style="clear:both;"></div>\n                            </div>\n                            <div class="title">${e.grade}</div>\n                            <div class="list">\n                                <div class="left">\n                                    <div class="item" data-len="3" data-leftMin="0" data-top="9" title="${e.threeStars}"><div style="background-position:0 -180px;"></div></div>\n                                    <div class="item" data-len="5" data-leftMin="0" data-top="10" title="${e.fiveQuadrantDiagram}"><div style="background-position:0 -200px;"></div></div>\n                                    <div class="item" data-len="5" data-leftMin="0" data-top="11" title="${e.fiveBoxes}"><div style="background-position:0 -220px;"></div></div>\n                                </div>\n                                <div class="right">\n                                    <div class="item" data-len="4" data-leftMin="5" data-top="9" title="${e.grade4}"><div style="background-position:-131px -180px;"></div></div>\n                                    <div class="item" data-len="5" data-leftMin="5" data-top="10" title="${e.grade5}"><div style="background-position:-131px -200px;"></div></div>\n                                </div>\n                                <div style="clear:both;"></div>\n                            </div>\n                        </div>`;$("body").append(y(b,{id:"luckysheet-CFicons-dialog",addclass:"luckysheet-CFicons-dialog",title:e.icons,content:t,botton:`<button class="btn btn-default luckysheet-model-close-btn">${e.close}</button>`,style:"z-index:100003"}));let i=$("#luckysheet-CFicons-dialog").find(".luckysheet-modal-dialog-content").css("min-width",400).end(),o=i.outerHeight(),l=i.outerWidth(),n=$(window).width(),a=$(window).height(),d=$(document).scrollLeft(),s=$(document).scrollTop();$("#luckysheet-CFicons-dialog").css({left:(n+d-l)/2,top:(a+s-o)/3}).show()},administerRuleDialog:function(){$("#luckysheet-modal-dialog-mask").show(),$("#luckysheet-administerRule-dialog").remove();const e=r().conditionformat;let t="";for(let i=0;i<g.luckysheetfile.length;i++)"1"==g.luckysheetfile[i].status?t+=`<option value="${g.luckysheetfile[i].index}" selected="selected">\n                                ${e.currentSheet}：${g.luckysheetfile[i].name}\n                            </option>`:t+=`<option value="${g.luckysheetfile[i].index}">\n                                ${e.sheet}：${g.luckysheetfile[i].name}\n                            </option>`;let i=`<div class="chooseSheet">\n                            <label>${e.showRules}：</label>\n                            <select>${t}</select>\n                        </div>\n                        <div class="ruleBox">\n                            <div class="ruleBtn">\n                                <button id="newConditionRule" class="btn btn-default">${e.newRule}</button>\n                                <button id="editorConditionRule" class="btn btn-default">${e.editRule}</button>\n                                <button id="deleteConditionRule" class="btn btn-default">${e.deleteRule}</button>\n                            </div>\n                            <div class="ruleList">\n                                <div class="listTitle">\n                                    <span>${e.rule}</span>\n                                    <span>${e.format}</span>\n                                    <span>${e.applyRange}</span>\n                                </div>\n                                <div class="listBox"></div>\n                            </div>\n                        </div>`;$("body").append(y(b,{id:"luckysheet-administerRule-dialog",addclass:"luckysheet-administerRule-dialog",title:e.conditionformatManageRules,content:i,botton:`<button id="luckysheet-administerRule-dialog-confirm" class="btn btn-primary">${e.confirm}</button>\n                        <button id="luckysheet-administerRule-dialog-close" class="btn btn-default">${e.close}</button>`,style:"z-index:100003"}));let o=$("#luckysheet-administerRule-dialog").find(".luckysheet-modal-dialog-content").css("min-width",400).end(),l=o.outerHeight(),n=o.outerWidth(),a=$(window).width(),d=$(window).height(),s=$(document).scrollLeft(),c=$(document).scrollTop();$("#luckysheet-administerRule-dialog").css({left:(a+s-n)/2,top:(d+c-l)/3}).show();let u=$("#luckysheet-administerRule-dialog .chooseSheet option:selected").val();this.getConditionRuleList(u)},getConditionRuleList:function(e){let t=this;$("#luckysheet-administerRule-dialog .ruleList .listBox").empty();let i=t.fileClone[p(e)].luckysheet_conditionformat_save;if(null!=i&&i.length>0){const e=r().conditionformat;for(let o=0;o<i.length;o++){let l,n=i[o].type,a=i[o].format,d=i[o].cellrange,s="";"dataBar"==n?(l=e.dataBar,s='<canvas width="46" height="18" style="width: 46px;height: 18px;margin: 3px 0 0 5px;"></canvas>'):"colorGradation"==n?(l=e.colorGradation,s='<canvas width="46" height="18" style="width: 46px;height: 18px;margin: 3px 0 0 5px;"></canvas>'):"icons"==n?(l=e.icons,s='<canvas width="46" height="18" style="width: 46px;height: 18px;margin: 3px 0 0 5px;"></canvas>'):(l=t.getConditionRuleName(i[o].conditionName,i[o].conditionRange,i[o].conditionValue),null!=a.textColor&&(s+='<span class="colorbox" title="'+e.textColor+'" style="background-color:'+a.textColor+'"></span>'),null!=a.cellColor&&(s+='<span class="colorbox" title="'+e.cellColor+'" style="background-color:'+a.cellColor+'"></span>'));let c=[];for(let e=0;e<d.length;e++){let t=d[e].row[0],i=d[e].row[1],o=d[e].column[0],l=d[e].column[1];c.push(k(o)+(t+1)+":"+k(l)+(i+1))}let r='<div class="item" data-item="'+o+'"><div class="ruleName" title="'+l+'">'+l+'</div><div class="format">'+s+'</div><div class="ruleRange"><input class="formulaInputFocus" readonly="true" value="'+c.join(",")+'"/><i class="fa fa-table" aria-hidden="true" title="'+e.selectRange+'"></i></div></div>';$("#luckysheet-administerRule-dialog .ruleList .listBox").prepend(r)}$("#luckysheet-administerRule-dialog .ruleList .listBox .item canvas").each(function(e){let t=$(this).closest(".item").attr("data-item"),o=i[t].type,l=i[t].format,n=$(this).get(0).getContext("2d");if("dataBar"==o)if(2==l.length){let e=n.createLinearGradient(0,0,46,0);e.addColorStop(0,l[0]),e.addColorStop(1,l[1]),n.fillStyle=e,n.fillRect(0,0,46,18),n.beginPath(),n.moveTo(0,0),n.lineTo(0,18),n.lineTo(46,18),n.lineTo(46,0),n.lineTo(0,0),n.lineWidth=g.devicePixelRatio,n.strokeStyle=l[0],n.stroke(),n.closePath()}else 1==l.length&&(n.fillStyle=l[0],n.fillRect(0,0,46,18),n.beginPath(),n.moveTo(0,0),n.lineTo(0,18),n.lineTo(46,18),n.lineTo(46,0),n.lineTo(0,0),n.lineWidth=g.devicePixelRatio,n.strokeStyle=l[0],n.stroke(),n.closePath());else if("colorGradation"==o){let e=n.createLinearGradient(0,0,46,0);3==l.length?(e.addColorStop(0,l[0]),e.addColorStop(.5,l[1]),e.addColorStop(1,l[2])):2==l.length&&(e.addColorStop(0,l[0]),e.addColorStop(1,l[1])),n.fillStyle=e,n.fillRect(0,0,46,18)}else if("icons"==o){let e=l.len,t=l.leftMin,i=l.top,o=32*e+10*(e-1),a=32,d=46,s=1472/o;"0"==t?n.drawImage(S,0,32*i,o,a,0,(18-s)/2,d,s):"5"==t&&n.drawImage(S,210,32*i,o,a,0,(18-s)/2,d,s)}}),$("#luckysheet-administerRule-dialog .ruleList .listBox .item").eq(0).addClass("on")}},newConditionRuleDialog:function(e){const t=r().conditionformat;let i=this.getRuleExplain(0);$("#luckysheet-modal-dialog-mask").show(),$("#luckysheet-administerRule-dialog").hide(),$("#luckysheet-newConditionRule-dialog").remove();let o='<div><div class="boxTitle">'+t.chooseRuleType+"：</div>"+this.ruleTypeHtml()+'<div class="boxTitle">'+t.editRuleDescription+'：</div><div class="ruleExplainBox">'+i+"</div></div>";$("body").append(y(b,{id:"luckysheet-newConditionRule-dialog",addclass:"luckysheet-newEditorRule-dialog",title:t.newFormatRule,content:o,botton:`<button id="luckysheet-newConditionRule-dialog-confirm" class="btn btn-primary" data-source="${e}">${t.confirm}</button>\n                        <button id="luckysheet-newConditionRule-dialog-close" class="btn btn-default" data-source="${e}">${t.cancel}</button>`,style:"z-index:100003"}));let l=$("#luckysheet-newConditionRule-dialog").find(".luckysheet-modal-dialog-content").css("min-width",400).end(),n=l.outerHeight(),a=l.outerWidth(),d=$(window).width(),s=$(window).height(),c=$(document).scrollLeft(),u=$(document).scrollTop();$("#luckysheet-newConditionRule-dialog").css({left:(d+c-a)/2,top:(s+u-n)/3}).show(),$("#luckysheet-newConditionRule-dialog .ruleTypeBox .ruleTypeItem:eq(0)").addClass("on").siblings().removeClass("on"),this.colorSelectInit()},editorConditionRuleDialog:function(){let e=this;const t=r().conditionformat;let i=e.editorRule.data;if(null==i)return;let o,l,n=i.type,a=i.format,d=i.conditionName;"dataBar"==n||"colorGradation"==n||"icons"==n?(o=0,l=n):"greaterThan"==d||"lessThan"==d||"betweenness"==d||"equal"==d||"textContains"==d||"occurrenceDate"==d?(o=1,"greaterThan"==d||"lessThan"==d||"betweenness"==d||"equal"==d?l="number":"textContains"==d?l="text":"occurrenceDate"==d&&(l="date")):"top10"==d||"top10%"==d||"last10"==d||"last10%"==d?(o=2,"top10"==d||"top10%"==d?l="top":"last10"!=d&&"last10%"!=d||(l="last")):"AboveAverage"==d||"SubAverage"==d?(o=3,l=d):"duplicateValue"==d?(o=4,l=i.conditionValue):"formula"==d&&(o=5);let s=e.getRuleExplain(o);$("#luckysheet-modal-dialog-mask").show(),$("#luckysheet-administerRule-dialog").hide(),$("#luckysheet-editorConditionRule-dialog").remove();let c='<div><div class="boxTitle">'+t.chooseRuleType+"：</div>"+e.ruleTypeHtml()+'<div class="boxTitle">'+t.editRuleDescription+'：</div><div class="ruleExplainBox">'+s+"</div></div>";$("body").append(y(b,{id:"luckysheet-editorConditionRule-dialog",addclass:"luckysheet-newEditorRule-dialog",title:t.editFormatRule,content:c,botton:`<button id="luckysheet-editorConditionRule-dialog-confirm" class="btn btn-primary">${t.confirm}</button>\n                        <button id="luckysheet-editorConditionRule-dialog-close" class="btn btn-default">${t.cancel}</button>`,style:"z-index:100003"}));let u=$("#luckysheet-editorConditionRule-dialog").find(".luckysheet-modal-dialog-content").css("min-width",400).end(),h=u.outerHeight(),f=u.outerWidth(),p=$(window).width(),v=$(window).height(),k=$(document).scrollLeft(),x=$(document).scrollTop();if($("#luckysheet-editorConditionRule-dialog").css({left:(p+k-f)/2,top:(v+x-h)/3}).show(),e.colorSelectInit(),$("#luckysheet-editorConditionRule-dialog .ruleTypeBox .ruleTypeItem:eq("+o+")").addClass("on").siblings().removeClass("on"),$("#luckysheet-editorConditionRule-dialog #type1").val(l),"dataBar"!=l&&"colorGradation"!=l&&"icons"!=l&&"number"!=l&&"text"!=l&&"date"!=l||($("#luckysheet-editorConditionRule-dialog ."+l+"Box").show(),$("#luckysheet-editorConditionRule-dialog ."+l+"Box").siblings().hide()),"date"==l&&e.daterangeInit("luckysheet-editorConditionRule-dialog"),"dataBar"==n||"colorGradation"==n||"icons"==n){if("dataBar"==l)2==a.length?$("#luckysheet-editorConditionRule-dialog .dataBarBox #type2").val("gradient"):1==a.length&&$("#luckysheet-editorConditionRule-dialog .dataBarBox #type2").val("solid"),$("#luckysheet-editorConditionRule-dialog .dataBarBox .luckysheet-conditionformat-config-color").spectrum("set",a[0]);else if("colorGradation"==l)3==a.length?($("#luckysheet-editorConditionRule-dialog .colorGradationBox #type2").val("threeColor"),$("#luckysheet-editorConditionRule-dialog .colorGradationBox .midVal").show(),$("#luckysheet-editorConditionRule-dialog .colorGradationBox .maxVal .luckysheet-conditionformat-config-color").spectrum("set",a[0]),$("#luckysheet-editorConditionRule-dialog .colorGradationBox .midVal .luckysheet-conditionformat-config-color").spectrum("set",a[1]),$("#luckysheet-editorConditionRule-dialog .colorGradationBox .minVal .luckysheet-conditionformat-config-color").spectrum("set",a[2])):2==a.length&&($("#luckysheet-editorConditionRule-dialog .colorGradationBox #type2").val("twoColor"),$("#luckysheet-editorConditionRule-dialog .colorGradationBox .midVal").hide(),$("#luckysheet-editorConditionRule-dialog .colorGradationBox .maxVal .luckysheet-conditionformat-config-color").spectrum("set",a[0]),$("#luckysheet-editorConditionRule-dialog .colorGradationBox .minVal .luckysheet-conditionformat-config-color").spectrum("set",a[1]));else if("icons"==l){let e=a.len,t=a.leftMin,i=a.top;$("#luckysheet-editorConditionRule-dialog .iconsBox li").each(function(o,l){if($(l).find("div").attr("data-len")==e&&$(l).find("div").attr("data-leftmin")==t&&$(l).find("div").attr("data-top")==i)return $("#luckysheet-editorConditionRule-dialog .iconsBox .showbox .model").css("background-position",$(l).find("div").css("background-position")),$("#luckysheet-editorConditionRule-dialog .iconsBox .showbox .model").attr("data-len",$(l).find("div").attr("data-len")),$("#luckysheet-editorConditionRule-dialog .iconsBox .showbox .model").attr("data-leftmin",$(l).find("div").attr("data-leftmin")),$("#luckysheet-editorConditionRule-dialog .iconsBox .showbox .model").attr("data-top",$(l).find("div").attr("data-leftmin")),$("#luckysheet-editorConditionRule-dialog .iconsBox .showbox .model").attr("title",$(l).find("div").attr("title")),!0})}}else{if("number"==l){let e;if($("#luckysheet-editorConditionRule-dialog .numberBox #type2").val(d),e=null!=i.conditionRange[0]?m(g.currentSheetIndex,{row:i.conditionRange[0].row,column:i.conditionRange[0].column},g.currentSheetIndex):i.conditionValue[0],$("#luckysheet-editorConditionRule-dialog .numberBox #conditionVal input").val(e),"betweenness"==d){let e;$("#luckysheet-editorConditionRule-dialog .numberBox .txt").show(),$("#luckysheet-editorConditionRule-dialog .numberBox #conditionVal2").show(),e=null!=i.conditionRange[1]?m(g.currentSheetIndex,{row:i.conditionRange[1].row,column:i.conditionRange[1].column},g.currentSheetIndex):i.conditionValue[1],$("#luckysheet-editorConditionRule-dialog .numberBox #conditionVal2 input").val(e)}else $("#luckysheet-editorConditionRule-dialog .numberBox .txt").hide(),$("#luckysheet-editorConditionRule-dialog .numberBox #conditionVal2").hide()}else if("text"==l){let e;e=null!=i.conditionRange[0]?m(g.currentSheetIndex,{row:i.conditionRange[0].row,column:i.conditionRange[0].column},g.currentSheetIndex):i.conditionValue[0],$("#luckysheet-editorConditionRule-dialog .textBox #conditionVal input").val(e)}else if("date"==l){e.daterangeInit("luckysheet-editorConditionRule-dialog");let t=i.conditionValue[0];$("#luckysheet-editorConditionRule-dialog .dateBox #daterange-btn").val(t)}else if("top"==l||"last"==l){i.conditionValue[0];"top10%"!=d&&"last10%"!=d||$("#luckysheet-editorConditionRule-dialog #isPercent").attr("checked","checked")}else if("formula"==d){let e=i.conditionValue[0];$("#luckysheet-editorConditionRule-dialog #formulaConditionVal input").val(e)}$("#luckysheet-editorConditionRule-dialog #textcolorshow").spectrum("set",a.textColor),$("#luckysheet-editorConditionRule-dialog #cellcolorshow").spectrum("set",a.cellColor)}},infoDialog:function(e,t){$("#luckysheet-modal-dialog-mask").show(),$("#luckysheet-conditionformat-info-dialog").remove(),$("body").append(y(b,{id:"luckysheet-conditionformat-info-dialog",addclass:"",title:e,content:t,botton:`<button id="luckysheet-conditionformat-info-dialog-close" class="btn btn-default">${r().conditionformat.close}</button>`,style:"z-index:100003"}));let i=$("#luckysheet-conditionformat-info-dialog").find(".luckysheet-modal-dialog-content").css("min-width",300).end(),o=i.outerHeight(),l=i.outerWidth(),n=$(window).width(),a=$(window).height(),d=$(document).scrollLeft(),s=$(document).scrollTop();$("#luckysheet-conditionformat-info-dialog").css({left:(n+d-l)/2,top:(a+s-o)/3}).show()},getRuleExplain:function(e){const t=r().conditionformat;let i,o=this.textCellColorHtml();switch(e){case 0:i=`<div class="title">${t.ruleTypeItem1}：</div>\n                                    <div style="height: 30px;margin-bottom: 5px;">\n                                        <label style="display: block;width: 80px;height: 30px;line-height: 30px;float: left;">${t.formatStyle}：</label>\n                                        <select id="type1">\n                                            <option value="dataBar">${t.dataBar}</option>\n                                            <option value="colorGradation">${t.colorGradation}</option>\n                                            <option value="icons">${t.icons}</option>\n                                        </select>\n                                    </div>\n                                    <div>\n                                        <div class="type1Box dataBarBox">\n                                            <div style="height: 30px;margin-bottom: 5px;">\n                                                <label style="display: block;width: 80px;height: 30px;line-height: 30px;float: left;">${t.fillType}：</label>\n                                                <select id="type2">\n                                                    <option value="gradient">${t.gradient}</option>\n                                                    <option value="solid">${t.solid}</option>\n                                                </select>\n                                            </div>\n                                            <div style="height: 30px;margin-bottom: 5px;">\n                                                <label style="display: block;width: 80px;height: 30px;line-height: 30px;float: left;">${t.color}：</label>\n                                                <input data-tips="${t.dataBarColor}" data-func="background" class="luckysheet-conditionformat-config-color" type="text" value="#638ec6" style="display: none;"> \n                                            </div>\n                                        </div>\n                                        <div class="type1Box colorGradationBox" style="display: none;">\n                                            <div style="height: 30px;margin-bottom: 5px;">\n                                                <label style="display: block;width: 80px;height: 30px;line-height: 30px;float: left;">${t.fillType}：</label>\n                                                <select id="type2">\n                                                    <option value="threeColor">${t.tricolor}</option>\n                                                    <option value="twoColor">${t.twocolor}</option>\n                                                </select>\n                                            </div>\n                                            <div class="maxVal" style="height: 30px;margin-bottom: 5px;">\n                                                <label style="display: block;width: 80px;height: 30px;line-height: 30px;float: left;">${t.maxValue}：</label>\n                                                <input data-tips="${t.maxValue} ${t.color}" data-func="background" class="luckysheet-conditionformat-config-color" type="text" value="rgb(99, 190, 123)" style="display: none;">\n                                            </div>\n                                            <div class="midVal" style="height: 30px;margin-bottom: 5px;">\n                                                <label style="display: block;width: 80px;height: 30px;line-height: 30px;float: left;">${t.medianValue}：</label>\n                                                <input data-tips="${t.medianValue} ${t.color}" data-func="background" class="luckysheet-conditionformat-config-color" type="text" value="rgb(255, 235, 132)" style="display: none;">\n                                            </div>\n                                            <div class="minVal" style="height: 30px;margin-bottom: 5px;">\n                                                <label style="display: block;width: 80px;height: 30px;line-height: 30px;float: left;">${t.minValue}：</label>\n                                                <input data-tips="${t.minValue} ${t.color}" data-func="background" class="luckysheet-conditionformat-config-color" type="text" value="rgb(248, 105, 107)" style="display: none;">\n                                            </div>\n                                        </div>\n                                        <div class="type1Box iconsBox" style="display: none;">\n                                            <label>${t.fillType}：</label>\n                                            <div class="showbox">\n                                                <div class="model" data-len="3" data-leftmin="0" data-top="0" title="${t.threeWayArrow}(${t.multicolor})" style="background-position: 0 0;"></div>\n                                                <span class="ui-selectmenu-icon ui-icon ui-icon-triangle-1-s" style="margin-top: 2px;"></span>\n                                            </div>\n                                            <ul>\n                                                <li><div data-len="3" data-leftmin="0" data-top="0" title="${t.threeWayArrow}(${t.multicolor})" style="background-position: 0 0;"></div></li>\n                                                <li><div data-len="3" data-leftmin="5" data-top="0" title="${t.threeWayArrow}(${t.grayColor})" style="background-position: -131px 0;"></div></li>\n                                                <li><div data-len="3" data-leftmin="0" data-top="1" title="${t.threeTriangles}" style="background-position: 0 -20px;"></div></li>\n                                                <li><div data-len="4" data-leftmin="0" data-top="2" title="${t.fourWayArrow}(${t.multicolor})" style="background-position: 0 -40px;"></div></li>\n                                                <li><div data-len="4" data-leftmin="5" data-top="1" title="${t.fourWayArrow}(${t.grayColor})" style="background-position: -131px -20px;"></div></li>\n                                                <li><div data-len="5" data-leftmin="0" data-top="3" title="${t.fiveWayArrow}(${t.multicolor})" style="background-position: 0 -60px;"></div></li>\n                                                <li><div data-len="5" data-leftmin="5" data-top="2" title="${t.fiveWayArrow}(${t.grayColor})" style="background-position: -131px -40px;"></div></li>\n                                                <li><div data-len="3" data-leftmin="0" data-top="4" title="${t.threeColorTrafficLight}(${t.rimless})" style="background-position: 0 -80px;"></div></li>\n                                                <li><div data-len="3" data-leftmin="5" data-top="4" title="${t.threeColorTrafficLight}(${t.bordered})" style="background-position: -131px -80px;"></div></li>\n                                                <li><div data-len="3" data-leftmin="0" data-top="5" title="${t.threeSigns}" style="background-position: 0 -100px;"></div></li>\n                                                <li><div data-len="4" data-leftmin="5" data-top="5" title="${t.fourColorTrafficLight}" style="background-position: -131px -100px;"></div></li>\n                                                <li><div data-len="4" data-leftmin="0" data-top="6" title="${t.greenRedBlackGradient}" style="background-position: 0 -120px;"></div></li>\n                                                <li><div data-len="3" data-leftmin="0" data-top="7" title="${t.threeSymbols}(${t.circled})" style="background-position: 0 -140px;"></div></li>\n                                                <li><div data-len="3" data-leftmin="5" data-top="7" title="${t.threeSymbols}(${t.noCircle})" style="background-position: -131px -140px;"></div></li>\n                                                <li><div data-len="3" data-leftmin="0" data-top="8" title="${t.tricolorFlag}" style="background-position: 0 -160px;"></div></li>\n                                                <li><div data-len="3" data-leftmin="0" data-top="9" title="${t.threeStars}" style="background-position: 0 -180px;"></div></li>\n                                                <li><div data-len="5" data-leftmin="0" data-top="10" title="${t.fiveQuadrantDiagram}" style="background-position: 0 -200px;"></div></li>\n                                                <li><div data-len="5" data-leftmin="0" data-top="11" title="${t.fiveBoxes}" style="background-position: 0 -220px;"></div></li>\n                                                <li><div data-len="4" data-leftmin="5" data-top="9" title="${t.grade4}" style="background-position: -131px -180px;"></div></li>\n                                                <li><div data-len="5" data-leftmin="5" data-top="10" title="${t.grade5}" style="background-position: -131px -200px;"></div></li>\n                                            </ul>\n                                        </div>\n                                    </div>`;break;case 1:i=`<div class="title">${t.ruleTypeItem2_title}：</div>\n                                    <div style="height: 30px;margin-bottom: 10px;">\n                                        <select id="type1">\n                                            <option value="number">${t.cellValue}</option>\n                                            <option value="text">${t.specificText}</option>\n                                            <option value="date">${t.occurrence}</option>\n                                        </select>\n                                        <div>\n                                            <div class="type1Box numberBox">\n                                                <select id="type2">\n                                                    <option value="greaterThan">${t.greaterThan}</option>\n                                                    <option value="lessThan">${t.lessThan}</option>\n                                                    <option value="betweenness">${t.between}</option>\n                                                    <option value="equal">${t.equal}</option>\n                                                </select>\n                                                <div class="inpbox range" id="conditionVal">\n                                                    <input class="formulaInputFocus"/>\n                                                    <i class="fa fa-table" aria-hidden="true" title="${t.selectCell}"></i>\n                                                </div>\n                                                <span class="txt" style="display: none;">${t.in}</span>\n                                                <div class="inpbox range" id="conditionVal2" style="display: none;">\n                                                    <input class="formulaInputFocus"/>\n                                                    <i class="fa fa-table" aria-hidden="true" title="${t.selectDataRange}"></i>\n                                                </div>\n                                            </div>\n                                            <div class="type1Box textBox" style="display: none;">\n                                                <select id="type2">\n                                                    <option value="">${t.contain}</option>\n                                                </select>\n                                                <div class="inpbox range" id="conditionVal">\n                                                    <input class="formulaInputFocus"/>\n                                                    <i class="fa fa-table" aria-hidden="true" title="${t.selectCell}"></i>\n                                                </div>\n                                            </div>\n                                            <div class="type1Box dateBox" style="display: none;">\n                                                <div style="width: 162px;" class="inpbox">\n                                                    <input style="width: 150px;" id="daterange-btn" readonly="readonly" placeholder="${t.pleaseSelectADate}"/>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                    <div class="title">${t.setFormat}: </div>${o}`;break;case 2:i=`<div class="title">${t.ruleTypeItem3_title}：</div>\n                                    <div style="height: 30px;margin-bottom: 10px;">\n                                        <select id="type1">\n                                            <option value="top">${t.top}</option>\n                                            <option value="last">${t.last}</option>\n                                        </select>\n                                        <div class="inpbox" id="conditionVal">\n                                            <input class="formulaInputFocus" type="number" value="10"/>\n                                        </div>\n                                        <input id="isPercent" type="checkbox"/>\n                                        <label for="isPercent" class="txt">${t.selectRange_percent}</label>\n                                    </div>\n                                    <div class="title">${t.setFormat}：</div>${o}`;break;case 3:i=`<div class="title">${t.ruleTypeItem4_title}：</div>\n                                    <div style="height: 30px;margin-bottom: 10px;">\n                                        <select id="type1">\n                                            <option value="AboveAverage">${t.above}</option>\n                                            <option value="SubAverage">${t.below}</option>\n                                        </select>\n                                        <span class="txt">${t.selectRange_average}</span>\n                                    </div>\n                                    <div class="title">${t.setFormat}：</div>${o}`;break;case 4:i=`<div class="title">${t.all}：</div>\n                                    <div style="height: 30px;margin-bottom: 10px;">\n                                        <select id="type1">\n                                            <option value="0">${t.duplicateValue}</option>\n                                            <option value="1">${t.uniqueValue}</option>\n                                        </select>\n                                        <span class="txt">${t.selectRange_value}</span>\n                                    </div>\n                                    <div class="title">${t.setFormat}：</div>${o}`;break;case 5:i=`<div class="title">${t.ruleTypeItem2_title}：</div>\n                                    <div style="height: 30px;margin-bottom: 10px;">\n                                        <div class="inpbox range" id="formulaConditionVal" style="width: 250px;">\n                                            <input class="formulaInputFocus" style="width: 200px;"/>\n                                            <i class="fa fa-table" aria-hidden="true" title="${t.selectCell}"></i>\n                                        </div>\n                                    </div>\n                                    <div class="title">${t.setFormat}: </div>${o}`}return i},daterangeInit:function(e){const t=r().conditionformat;$(".ranges_1 ul").remove(),$("#"+e).find("#daterange-btn").flatpickr({mode:"range",onChange:function(e,i){const[o,l]=e;let n=[t.yesterday,t.today],a=[t.lastWeek,t.thisWeek,t.lastMonth,t.thisMonth,t.lastYear,t.thisYear,t.last7days,t.last30days];i==t.all?$("#daterange-btn").val(""):n.indexOf(i)>-1?$("#daterange-btn").val(f(o).format("YYYY/MM/DD")):a.indexOf(i)>-1&&$("#daterange-btn").val(f(o).format("YYYY/MM/DD")+"-"+f(l).format("YYYY/MM/DD"))}})}})});
//# sourceMappingURL=../sourcemaps/controllers/conditionformat.js.map
