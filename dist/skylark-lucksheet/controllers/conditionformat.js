/**
 * skylark-lucksheet - A version of lucksheet.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["../methods/get","../utils/util","../global/formula","../global/validate","../global/tooltip","../global/refresh","../global/getdata","../global/format","./constant","./server","./select","./sheetmanage","../locale/locale","./protection","../store","skylark-moment"],function(e,t,o,l,n,i,a,r,c,d,s,u,f,h,m,g){"use strict";const{getSheetIndex:p,getRangetxt:y}=e,{replaceHtml:v,getObjType:w,chatatABC:k}=t,{isRealNull:C,isEditMode:x}=l,{luckysheetrefreshgrid:b}=i,{getcellvalue:R}=a,{genarate:_}=r,{modelHTML:I,luckysheet_CFiconsImg:S}=c,{selectionCopyShow:B}=s,{checkProtectionFormatCells:T}=h;return{fileClone:[],editorRule:null,ruleTypeHtml:function(){const e=f().conditionformat;return`<div class="ruleTypeBox">\n                    <div class="ruleTypeItem">\n                        <span class="icon iconfont luckysheet-iconfont-youjiantou"></span>\n                        <span>${e.ruleTypeItem1}</span>\n                    </div>\n                    <div class="ruleTypeItem">\n                        <span class="icon iconfont luckysheet-iconfont-youjiantou"></span>\n                        <span>${e.ruleTypeItem2}</span>\n                    </div>\n                    <div class="ruleTypeItem">\n                        <span class="icon iconfont luckysheet-iconfont-youjiantou"></span>\n                        <span>${e.ruleTypeItem3}</span>\n                    </div>\n                    <div class="ruleTypeItem">\n                        <span class="icon iconfont luckysheet-iconfont-youjiantou"></span>\n                        <span>${e.ruleTypeItem4}</span>\n                    </div>\n                    <div class="ruleTypeItem">\n                        <span class="icon iconfont luckysheet-iconfont-youjiantou"></span>\n                        <span>${e.ruleTypeItem5}</span>\n                    </div>\n                    <div class="ruleTypeItem">\n                        <span class="icon iconfont luckysheet-iconfont-youjiantou"></span>\n                        <span>${e.ruleTypeItem6}</span>\n                    </div>\n                </div>`},textCellColorHtml:function(){const e=f().conditionformat;return`<div id="textCellColor">\n                    <div class="colorbox">\n                        <input id="checkTextColor" type="checkbox" checked="checked">\n                        <label for="checkTextColor">${e.textColor}：</label>\n                        <input id="textcolorshow" data-tips="${e.textColor}" data-func="background" class="luckysheet-conditionformat-config-color" type="text" value="#9c0006" style="display: none;">\n                    </div>\n                    <div class="colorbox">\n                        <input id="checkCellColor" type="checkbox" checked="checked">\n                        <label for="checkCellColor">${e.cellColor}：</label>\n                        <input id="cellcolorshow" data-tips="${e.cellColor}" data-func="background" class="luckysheet-conditionformat-config-color" type="text" value="#ffc7ce" style="display: none;">\n                    </div>\n                </div>`},selectRange:[],selectStatus:!1,dataBarList:[{format:["#638ec6","#ffffff"]},{format:["#63c384","#ffffff"]},{format:["#ff555a","#ffffff"]},{format:["#ffb628","#ffffff"]},{format:["#008aef","#ffffff"]},{format:["#d6007b","#ffffff"]},{format:["#638ec6"]},{format:["#63c384"]},{format:["#ff555a"]},{format:["#ffb628"]},{format:["#008aef"]},{format:["#d6007b"]}],colorGradationList:[{format:["rgb(99, 190, 123)","rgb(255, 235, 132)","rgb(248, 105, 107)"]},{format:["rgb(248, 105, 107)","rgb(255, 235, 132)","rgb(99, 190, 123)"]},{format:["rgb(99, 190, 123)","rgb(252, 252, 255)","rgb(248, 105, 107)"]},{format:["rgb(248, 105, 107)","rgb(252, 252, 255)","rgb(99, 190, 123)"]},{format:["rgb(90, 138, 198)","rgb(252, 252, 255)","rgb(248, 105, 107)"]},{format:["rgb(248, 105, 107)","rgb(252, 252, 255)","rgb(90, 138, 198)"]},{format:["rgb(252, 252, 255)","rgb(248, 105, 107)"]},{format:["rgb(248, 105, 107)","rgb(252, 252, 255)"]},{format:["rgb(99, 190, 123)","rgb(252, 252, 255)"]},{format:["rgb(252, 252, 255)","rgb(99, 190, 123)"]},{format:["rgb(99, 190, 123)","rgb(255, 235, 132)"]},{format:["rgb(255, 235, 132)","rgb(99, 190, 123)"]}],init:function(){let e=this;const t=f().conditionformat;$(document).off("change.CFchooseSheet").on("change.CFchooseSheet","#luckysheet-administerRule-dialog .chooseSheet",function(){let t=$("#luckysheet-administerRule-dialog .chooseSheet option:selected").val();e.getConditionRuleList(t)}),$(document).off("click.CFadministerRuleItem").on("click.CFadministerRuleItem","#luckysheet-administerRule-dialog .ruleList .listBox .item",function(){$(this).addClass("on").siblings().removeClass("on")}),$(document).off("click.CFadministerRuleConfirm").on("click.CFadministerRuleConfirm","#luckysheet-administerRule-dialog-confirm",function(){if(!T(m.currentSheetIndex))return;let t=$.extend(!0,[],m.luckysheetfile),o=e.getHistoryRules(t),l=$.extend(!0,[],e.fileClone);for(let e=0;e<l.length;e++){let t=l[e].index;m.luckysheetfile[p(t)].luckysheet_conditionformat_save=l[p(t)].luckysheet_conditionformat_save}let n=$.extend(!0,[],m.luckysheetfile),i=e.getCurrentRules(n);if(e.ref(o,i),$("#luckysheet-modal-dialog-mask").hide(),$("#luckysheet-administerRule-dialog").hide(),d.allowUpdate){let e=$.extend(!0,[],m.luckysheetfile);for(let t=0;t<e.length;t++)d.saveParam("all",e[t].index,e[t].luckysheet_conditionformat_save,{k:"luckysheet_conditionformat_save"})}}),$(document).off("click.CFadministerRuleClose").on("click.CFadministerRuleClose","#luckysheet-administerRule-dialog-close",function(){$("#luckysheet-modal-dialog-mask").hide(),$("#luckysheet-administerRule-dialog").hide(),e.fileClone=[]}),$(document).off("click.CFadministerRuleFa").on("click.CFadministerRuleFa","#luckysheet-administerRule-dialog .item .fa-table",function(){$(this).parents("#luckysheet-administerRule-dialog").hide();let t=$("#luckysheet-administerRule-dialog .chooseSheet select option:selected").val();t!=m.currentSheetIndex&&u.changeSheetExec(t);let o=$(this).siblings("input").val().trim(),l=$(this).parents(".item").attr("data-item");e.multiRangeDialog(l,o),e.selectRange=[];let n=e.getRangeByTxt(o);if(n.length>0)for(let t=0;t<n.length;t++){let o=n[t].row[0],l=n[t].row[1],i=n[t].column[0],a=n[t].column[1],r=m.visibledatarow[l],c=o-1==-1?0:m.visibledatarow[o-1],d=m.visibledatacolumn[a],s=i-1==-1?0:m.visibledatacolumn[i-1];e.selectRange.push({left:s,width:d-s-1,top:c,height:r-c-1,left_move:s,width_move:d-s-1,top_move:c,height_move:r-c-1,row:[o,l],column:[i,a],row_focus:o,column_focus:i})}B(e.selectRange)}),$(document).off("click.CFmultiRangeConfirm").on("click.CFmultiRangeConfirm","#luckysheet-multiRange-dialog-confirm",function(){$(this).parents("#luckysheet-multiRange-dialog").hide();let t=$(this).attr("data-item"),o=$(this).parents("#luckysheet-multiRange-dialog").find("input").val();$("#luckysheet-administerRule-dialog .item[data-item="+t+"] input").val(o);let l=$("#luckysheet-administerRule-dialog .chooseSheet option:selected").val();e.fileClone[p(l)].luckysheet_conditionformat_save[t].cellrange=e.getRangeByTxt(o),$("#luckysheet-modal-dialog-mask").show(),$("#luckysheet-administerRule-dialog").show();B([])}),$(document).off("click.CFmultiRangeClose").on("click.CFmultiRangeClose","#luckysheet-multiRange-dialog-close",function(){$(this).parents("#luckysheet-multiRange-dialog").hide(),$("#luckysheet-modal-dialog-mask").show(),$("#luckysheet-administerRule-dialog").show(),$("#luckysheet-formula-functionrange-select").hide(),$("#luckysheet-row-count-show").hide(),$("#luckysheet-column-count-show").hide();B([])}),$(document).off("click.CFnewConditionRule").on("click.CFnewConditionRule","#newConditionRule",function(){let o=$("#luckysheet-administerRule-dialog .chooseSheet option:selected").val();T(o)&&(0!=m.luckysheet_select_save.length?e.newConditionRuleDialog(1):x()?alert(t.pleaseSelectRange):n.info(t.pleaseSelectRange,""))}),$(document).off("click.CFnewConditionRuleConfirm").on("click.CFnewConditionRuleConfirm","#luckysheet-newConditionRule-dialog-confirm",function(){if(!T(m.currentSheetIndex))return;let o,l,n=$("#luckysheet-newConditionRule-dialog .ruleTypeItem.on").index(),i=$("#luckysheet-newConditionRule-dialog #type1 option:selected").val(),a=$("#luckysheet-newConditionRule-dialog ."+i+"Box #type2 option:selected").val();if(0==n){if("dataBar"==i){let e=$(this).parents("#luckysheet-newConditionRule-dialog").find(".dataBarBox .luckysheet-conditionformat-config-color").spectrum("get").toHexString();"gradient"==a?o=[e,"#ffffff"]:"solid"==a&&(o=[e]),l={type:"dataBar",cellrange:$.extend(!0,[],m.luckysheet_select_save),format:o}}else if("colorGradation"==i){let e=$(this).parents("#luckysheet-newConditionRule-dialog").find(".colorGradationBox .maxVal .luckysheet-conditionformat-config-color").spectrum("get").toRgbString(),t=$(this).parents("#luckysheet-newConditionRule-dialog").find(".colorGradationBox .midVal .luckysheet-conditionformat-config-color").spectrum("get").toRgbString(),n=$(this).parents("#luckysheet-newConditionRule-dialog").find(".colorGradationBox .minVal .luckysheet-conditionformat-config-color").spectrum("get").toRgbString();"threeColor"==a?o=[e,t,n]:"twoColor"==a&&(o=[e,n]),l={type:"colorGradation",cellrange:$.extend(!0,[],m.luckysheet_select_save),format:o}}else if("icons"==i){o={len:$(this).parents("#luckysheet-newConditionRule-dialog").find(".iconsBox .model").attr("data-len"),leftMin:$(this).parents("#luckysheet-newConditionRule-dialog").find(".iconsBox .model").attr("data-leftmin"),top:$(this).parents("#luckysheet-newConditionRule-dialog").find(".iconsBox .model").attr("data-top")},l={type:"icons",cellrange:$.extend(!0,[],m.luckysheet_select_save),format:o}}}else{let r,c,d="",s=[],u=[];if(1==n){if("number"==i)if(d=a,"betweenness"==a){let o=$("#luckysheet-newConditionRule-dialog #conditionVal input").val().trim(),l=$("#luckysheet-newConditionRule-dialog #conditionVal2 input").val().trim(),n=e.getRangeByTxt(o);if(n.length>1)return void e.infoDialog(t.onlySingleCell,"");if(1==n.length){let l=n[0].row[0],i=n[0].row[1],a=n[0].column[0],r=n[0].column[1];if(l!=i||a!=r)return void e.infoDialog(t.onlySingleCell,"");o=R(l,a,m.flowdata),s.push({row:n[0].row,column:n[0].column}),u.push(o)}else if(0==n.length){if(isNaN(o)||""==o)return void e.infoDialog(t.conditionValueCanOnly,"");u.push(o)}let i=e.getRangeByTxt(l);if(i.length>1)return void e.infoDialog(t.onlySingleCell,"");if(1==i.length){let o=i[0].row[0],n=i[0].row[1],a=i[0].column[0],r=i[0].column[1];if(o!=n||a!=r)return void e.infoDialog(t.onlySingleCell,"");l=R(o,a,m.flowdata),s.push({row:i[0].row,column:i[0].column}),u.push(l)}else if(0==i.length){if(isNaN(l)||""==l)return void e.infoDialog(t.conditionValueCanOnly,"");u.push(l)}}else{let o=$("#luckysheet-newConditionRule-dialog #conditionVal input").val().trim(),l=e.getRangeByTxt(o);if(l.length>1)return void e.infoDialog(t.onlySingleCell,"");if(1==l.length){let n=l[0].row[0],i=l[0].row[1],a=l[0].column[0],r=l[0].column[1];if(n!=i||a!=r)return void e.infoDialog(t.onlySingleCell,"");o=R(n,a,m.flowdata),s.push({row:l[0].row,column:l[0].column}),u.push(o)}else if(0==l.length){if(isNaN(o)||""==o)return void e.infoDialog(t.conditionValueCanOnly,"");u.push(o)}}else if("text"==i){d="textContains";let o=$("#luckysheet-newConditionRule-dialog #conditionVal input").val().trim(),l=e.getRangeByTxt(o);if(l.length>1)return void e.infoDialog(t.onlySingleCell,"");if(1==l.length){let n=l[0].row[0],i=l[0].row[1],a=l[0].column[0],r=l[0].column[1];if(n!=i||a!=r)return void e.infoDialog(t.onlySingleCell,"");o=R(n,a,m.flowdata),s.push({row:l[0].row,column:l[0].column}),u.push(o)}else if(0==l.length){if(""==o)return void e.infoDialog(t.conditionValueCanOnly,"");u.push(o)}}else if("date"==i){d="occurrenceDate";let o=$("#luckysheet-newConditionRule-dialog #daterange-btn").val();if(""==o||null==o)return void e.infoDialog(t.pleaseSelectADate,"");u.push(o)}}else if(2==n){"top"==i?d=$("#luckysheet-newConditionRule-dialog #isPercent").is(":selected")?"top10%":"top10":"last"==i&&(d=$("#luckysheet-newConditionRule-dialog #isPercent").is(":selected")?"last10%":"last10");let o=$("#luckysheet-newConditionRule-dialog #conditionVal input").val().trim();if(parseInt(o)!=o||parseInt(o)<1||parseInt(o)>1e3)return void e.infoDialog(t.pleaseEnterInteger,"");u.push(parseInt(o))}else if(3==n)"AboveAverage"==i?(d="AboveAverage",u.push("AboveAverage")):"SubAverage"==i&&(d="SubAverage",u.push("SubAverage"));else if(4==n)d="duplicateValue",u.push(i);else if(5==n){d="formula";let t=$("#luckysheet-newConditionRule-dialog #formulaConditionVal input").val().trim();if(""==t)return void e.infoDialog("Condition value cannot be empty!","");u.push(t)}o={textColor:r=$("#luckysheet-newConditionRule-dialog #checkTextColor").is(":checked")?$("#luckysheet-newConditionRule-dialog #textcolorshow").spectrum("get").toHexString():null,cellColor:c=$("#luckysheet-newConditionRule-dialog #checkCellColor").is(":checked")?$("#luckysheet-newConditionRule-dialog #cellcolorshow").spectrum("get").toHexString():null},l={type:"default",cellrange:$.extend(!0,[],m.luckysheet_select_save),format:o,conditionName:d,conditionRange:s,conditionValue:u}}$("#luckysheet-newConditionRule-dialog").hide();let r=$(this).attr("data-source");if(0==r){$("#luckysheet-modal-dialog-mask").hide();let t=$.extend(!0,[],m.luckysheetfile),o=e.getHistoryRules(t),n=void 0==m.luckysheetfile[p(m.currentSheetIndex)].luckysheet_conditionformat_save?[]:m.luckysheetfile[p(m.currentSheetIndex)].luckysheet_conditionformat_save;n.push(l),m.luckysheetfile[p(m.currentSheetIndex)].luckysheet_conditionformat_save=n;let i=$.extend(!0,[],m.luckysheetfile),a=e.getCurrentRules(i);e.ref(o,a),d.allowUpdate&&d.saveParam("all",m.currentSheetIndex,n,{k:"luckysheet_conditionformat_save"})}else if(1==r){let t=e.fileClone[p(m.currentSheetIndex)].luckysheet_conditionformat_save?e.fileClone[p(m.currentSheetIndex)].luckysheet_conditionformat_save:[];t.push(l),e.fileClone[p(m.currentSheetIndex)].luckysheet_conditionformat_save=t,e.administerRuleDialog()}}),$(document).off("click.CFnewConditionRuleClose").on("click.CFnewConditionRuleClose","#luckysheet-newConditionRule-dialog-close",function(){let e=$(this).attr("data-source");0==e&&$("#luckysheet-modal-dialog-mask").hide(),1==e&&$("#luckysheet-administerRule-dialog").show(),$("#luckysheet-newConditionRule-dialog").hide(),$("#luckysheet-formula-functionrange-select").hide(),$("#luckysheet-row-count-show").hide(),$("#luckysheet-column-count-show").hide()}),$(document).off("click.CFeditorConditionRule").on("click.CFeditorConditionRule","#editorConditionRule",function(){let t=$("#luckysheet-administerRule-dialog .chooseSheet option:selected").val();if(!T(t))return;let o=$("#luckysheet-administerRule-dialog .ruleList .listBox .item.on").attr("data-item"),l={sheetIndex:t,itemIndex:o,data:e.fileClone[p(t)].luckysheet_conditionformat_save[o]};e.editorRule=l,e.editorConditionRuleDialog()}),$(document).off("click.CFeditorConditionRuleConfirm").on("click.CFeditorConditionRuleConfirm","#luckysheet-editorConditionRule-dialog-confirm",function(){let o,l,n=$("#luckysheet-editorConditionRule-dialog .ruleTypeItem.on").index(),i=$("#luckysheet-editorConditionRule-dialog #type1 option:selected").val(),a=$("#luckysheet-editorConditionRule-dialog ."+i+"Box #type2 option:selected").val(),r=e.editorRule.data.cellrange;if(0==n){if("dataBar"==i){let e=$(this).parents("#luckysheet-editorConditionRule-dialog").find(".dataBarBox .luckysheet-conditionformat-config-color").spectrum("get").toHexString();"gradient"==a?o=[e,"#ffffff"]:"solid"==a&&(o=[e]),l={type:"dataBar",cellrange:r,format:o}}else if("colorGradation"==i){let e=$(this).parents("#luckysheet-editorConditionRule-dialog").find(".colorGradationBox .maxVal .luckysheet-conditionformat-config-color").spectrum("get").toRgbString(),t=$(this).parents("#luckysheet-editorConditionRule-dialog").find(".colorGradationBox .midVal .luckysheet-conditionformat-config-color").spectrum("get").toRgbString(),n=$(this).parents("#luckysheet-editorConditionRule-dialog").find(".colorGradationBox .minVal .luckysheet-conditionformat-config-color").spectrum("get").toRgbString();"threeColor"==a?o=[e,t,n]:"twoColor"==a&&(o=[e,n]),l={type:"colorGradation",cellrange:r,format:o}}else if("icons"==i){l={type:"icons",cellrange:r,format:o={len:$(this).parents("#luckysheet-editorConditionRule-dialog").find(".iconsBox .model").attr("data-len"),leftMin:$(this).parents("#luckysheet-editorConditionRule-dialog").find(".iconsBox .model").attr("data-leftmin"),top:$(this).parents("#luckysheet-editorConditionRule-dialog").find(".iconsBox .model").attr("data-top")}}}}else{let c,d,s="",u=[],f=[];if(1==n){if("number"==i)if(s=a,"betweenness"==a){let o=$("#luckysheet-editorConditionRule-dialog #conditionVal input").val().trim(),l=$("#luckysheet-editorConditionRule-dialog #conditionVal2 input").val().trim(),n=e.getRangeByTxt(o);if(n.length>1)return void e.infoDialog(t.onlySingleCell,"");if(1==n.length){let l=n[0].row[0],i=n[0].row[1],a=n[0].column[0],r=n[0].column[1];if(l!=i||a!=r)return void e.infoDialog(t.onlySingleCell,"");o=R(l,a,m.flowdata),u.push({row:n[0].row,column:n[0].column}),f.push(o)}else if(0==n.length){if(isNaN(o)||""==o)return void e.infoDialog(t.conditionValueCanOnly,"");f.push(o)}let i=e.getRangeByTxt(l);if(i.length>1)return void e.infoDialog(t.onlySingleCell,"");if(1==i.length){let o=i[0].row[0],n=i[0].row[1],a=i[0].column[0],r=i[0].column[1];if(o!=n||a!=r)return void e.infoDialog(t.onlySingleCell,"");l=R(o,a,m.flowdata),u.push({row:i[0].row,column:i[0].column}),f.push(l)}else if(0==i.length){if(isNaN(l)||""==l)return void e.infoDialog(t.conditionValueCanOnly,"");f.push(l)}}else{let o=$("#luckysheet-editorConditionRule-dialog #conditionVal input").val().trim(),l=e.getRangeByTxt(o);if(l.length>1)return void e.infoDialog(t.onlySingleCell,"");if(1==l.length){let n=l[0].row[0],i=l[0].row[1],a=l[0].column[0],r=l[0].column[1];if(n!=i||a!=r)return void e.infoDialog(t.onlySingleCell,"");o=R(n,a,m.flowdata),u.push({row:l[0].row,column:l[0].column}),f.push(o)}else if(0==l.length){if(isNaN(o)||""==o)return void e.infoDialog(t.conditionValueCanOnly,"");f.push(o)}}else if("text"==i){s="textContains";let o=$("#luckysheet-editorConditionRule-dialog #conditionVal input").val().trim(),l=e.getRangeByTxt(o);if(l.length>1)return void e.infoDialog(t.onlySingleCell,"");if(1==l.length){let n=l[0].row[0],i=l[0].row[1],a=l[0].column[0],r=l[0].column[1];if(n!=i||a!=r)return void e.infoDialog(t.onlySingleCell,"");o=R(n,a,m.flowdata),u.push({row:l[0].row,column:l[0].column}),f.push(o)}else if(0==l.length){if(isNaN(o)||""==o)return void e.infoDialog(t.conditionValueCanOnly,"");f.push(o)}}else if("date"==i){s="occurrenceDate";let o=$("#luckysheet-editorConditionRule-dialog #daterange-btn").val();if(""==o||null==o)return void e.infoDialog(t.pleaseSelectADate,"");f.push(o)}}else if(2==n){"top"==i?s=$("#luckysheet-editorConditionRule-dialog #isPercent").is(":selected")?"top10%":"top10":"last"==i&&(s=$("#luckysheet-editorConditionRule-dialog #isPercent").is(":selected")?"last10%":"last10");let o=$("#luckysheet-editorConditionRule-dialog #conditionVal input").val().trim();if(parseInt(o)!=o||parseInt(o)<1||parseInt(o)>1e3)return void e.infoDialog(t.pleaseEnterInteger,"");f.push(o)}else if(3==n)"AboveAverage"==i?(s="AboveAverage",f.push("AboveAverage")):"SubAverage"==i&&(s="SubAverage",f.push("SubAverage"));else if(4==n)s="duplicateValue",f.push(i);else if(5==n){s="formula";let t=$("#luckysheet-editorConditionRule-dialog #formulaConditionVal input").val().trim();if(console.log(t),""==t)return void e.infoDialog("Condition value cannot be empty!","");f.push(t)}l={type:"default",cellrange:r,format:o={textColor:c=$("#luckysheet-editorConditionRule-dialog #checkTextColor").is(":checked")?$("#luckysheet-editorConditionRule-dialog #textcolorshow").spectrum("get").toHexString():null,cellColor:d=$("#luckysheet-editorConditionRule-dialog #checkCellColor").is(":checked")?$("#luckysheet-editorConditionRule-dialog #cellcolorshow").spectrum("get").toHexString():null},conditionName:s,conditionRange:u,conditionValue:f}}let c=e.editorRule.sheetIndex,d=e.editorRule.itemIndex;e.fileClone[p(c)].luckysheet_conditionformat_save[d]=l,$("#luckysheet-editorConditionRule-dialog").hide(),e.administerRuleDialog()}),$(document).off("click.CFeditorConditionRuleClose").on("click.CFeditorConditionRuleClose","#luckysheet-editorConditionRule-dialog-close",function(){$("#luckysheet-editorConditionRule-dialog").hide(),$("#luckysheet-administerRule-dialog").show(),$("#luckysheet-formula-functionrange-select").hide(),$("#luckysheet-row-count-show").hide(),$("#luckysheet-column-count-show").hide()}),$(document).off("click.CFnewEditorRuleItem").on("click.CFnewEditorRuleItem",".luckysheet-newEditorRule-dialog .ruleTypeItem",function(){$(this).addClass("on").siblings().removeClass("on");let t=$(this).index();$(this).parents(".luckysheet-newEditorRule-dialog").find(".ruleExplainBox").html(e.getRuleExplain(t)),e.colorSelectInit()}),$(document).off("change.CFnewEditorRuleType1").on("change.CFnewEditorRuleType1",".luckysheet-newEditorRule-dialog #type1",function(){let t=$(this).find("option:selected").val();"dataBar"!=t&&"colorGradation"!=t&&"icons"!=t&&"number"!=t&&"text"!=t&&"date"!=t||$(this).parents(".luckysheet-newEditorRule-dialog").find("."+t+"Box").show().siblings().hide(),"date"==t&&e.daterangeInit($(this).parents(".luckysheet-newEditorRule-dialog").attr("id"))}),$(document).off("change.CFnewEditorRuleType2").on("change.CFnewEditorRuleType2",".luckysheet-newEditorRule-dialog #type2",function(){let e=$(this).parents(".luckysheet-newEditorRule-dialog").find("#type1 option:selected").val();if("colorGradation"==e){"threeColor"==$(this).find("option:selected").val()?$(this).parents(".luckysheet-newEditorRule-dialog").find(".midVal").show():$(this).parents(".luckysheet-newEditorRule-dialog").find(".midVal").hide()}else if("number"==e){"betweenness"==$(this).find("option:selected").val()?($(this).parents(".luckysheet-newEditorRule-dialog").find(".txt").show(),$(this).parents(".luckysheet-newEditorRule-dialog").find("#conditionVal2").show()):($(this).parents(".luckysheet-newEditorRule-dialog").find(".txt").hide(),$(this).parents(".luckysheet-newEditorRule-dialog").find("#conditionVal2").hide())}}),$(document).off("click.CFiconsShowbox").on("click.CFiconsShowbox",".luckysheet-newEditorRule-dialog .iconsBox .showbox",function(){$(this).parents(".iconsBox").find("ul").toggle()}),$(document).off("click.CFiconsLi").on("click.CFiconsLi",".luckysheet-newEditorRule-dialog .iconsBox li",function(){let e=$(this).find("div").attr("data-len"),t=$(this).find("div").attr("data-leftmin"),o=$(this).find("div").attr("data-top"),l=$(this).find("div").attr("title"),n=$(this).find("div").css("background-position");$(this).parents(".iconsBox").find(".showbox .model").css("background-position",n),$(this).parents(".iconsBox").find(".showbox .model").attr("data-len",e),$(this).parents(".iconsBox").find(".showbox .model").attr("data-leftmin",t),$(this).parents(".iconsBox").find(".showbox .model").attr("data-top",o),$(this).parents(".iconsBox").find(".showbox .model").attr("title",l),$(this).parents("ul").hide()}),$(document).off("click.CFdeleteConditionRule").on("click.CFdeleteConditionRule","#deleteConditionRule",function(){let t=$("#luckysheet-administerRule-dialog .chooseSheet option:selected").val();if(!T(t))return;let o=$("#luckysheet-administerRule-dialog .ruleList .listBox .item.on").attr("data-item");e.fileClone[p(t)].luckysheet_conditionformat_save.splice(o,1),e.administerRuleDialog()}),$(document).off("click.CFdefault").on("click.CFdefault","#luckysheet-conditionformat-dialog-confirm",function(){if(!T(m.currentSheetIndex))return;let o,l,n=$("#luckysheet-conditionformat-dialog .box").attr("data-itemvalue"),i=[],a=[];if("greaterThan"==n||"lessThan"==n||"equal"==n||"textContains"==n){let o=$("#luckysheet-conditionformat-dialog #conditionVal").val().trim(),l=e.getRangeByTxt(o);if(l.length>1)return void e.infoDialog(t.onlySingleCell,"");if(1==l.length){let n=l[0].row[0],r=l[0].row[1],c=l[0].column[0],d=l[0].column[1];if(n!=r||c!=d)return void e.infoDialog(t.onlySingleCell,"");o=R(n,c,m.flowdata),i.push({row:l[0].row,column:l[0].column}),a.push(o)}else if(0==l.length){if(isNaN(o)||""==o)return void e.infoDialog(t.conditionValueCanOnly,"");a.push(o)}}else if("betweenness"==n){let o=$("#luckysheet-conditionformat-dialog #conditionVal").val().trim(),l=$("#luckysheet-conditionformat-dialog #conditionVal2").val().trim(),n=e.getRangeByTxt(o);if(n.length>1)return void e.infoDialog(t.onlySingleCell,"");if(1==n.length){let l=n[0].row[0],r=n[0].row[1],c=n[0].column[0],d=n[0].column[1];if(l!=r||c!=d)return void e.infoDialog(t.onlySingleCell,"");o=R(l,c,m.flowdata),i.push({row:n[0].row,column:n[0].column}),a.push(o)}else if(0==n.length){if(isNaN(o)||""==o)return void e.infoDialog(t.conditionValueCanOnly,"");a.push(o)}let r=e.getRangeByTxt(l);if(r.length>1)return void e.infoDialog(t.onlySingleCell,"");if(1==r.length){let o=r[0].row[0],n=r[0].row[1],c=r[0].column[0],d=r[0].column[1];if(o!=n||c!=d)return void e.infoDialog(t.onlySingleCell,"");l=R(o,c,m.flowdata),i.push({row:r[0].row,column:r[0].column}),a.push(l)}else if(0==r.length){if(isNaN(l)||""==l)return void e.infoDialog(t.conditionValueCanOnly,"");a.push(l)}}else if("occurrenceDate"==n){let o=$("#luckysheet-conditionformat-dialog #daterange-btn").val();if(""==o||null==o)return void e.infoDialog(t.pleaseSelectADate,"");a.push(o)}else if("duplicateValue"==n)a.push($("#luckysheet-conditionformat-dialog #conditionVal option:selected").val());else if("top10"==n||"top10%"==n||"last10"==n||"last10%"==n){let o=$("#luckysheet-conditionformat-dialog #conditionVal").val().trim();if(parseInt(o)!=o||parseInt(o)<1||parseInt(o)>1e3)return void e.infoDialog(t.pleaseEnterInteger,"");a.push(o)}else"AboveAverage"==n?a.push("AboveAverage"):"SubAverage"==n&&a.push("SubAverage");o=$("#checkTextColor").is(":checked")?$("#textcolorshow").spectrum("get").toHexString():null,l=$("#checkCellColor").is(":checked")?$("#cellcolorshow").spectrum("get").toHexString():null;let r=$.extend(!0,[],m.luckysheetfile),c=e.getHistoryRules(r),s={type:"default",cellrange:$.extend(!0,[],m.luckysheet_select_save),format:{textColor:o,cellColor:l},conditionName:n,conditionRange:i,conditionValue:a},u=void 0==m.luckysheetfile[p(m.currentSheetIndex)].luckysheet_conditionformat_save?[]:m.luckysheetfile[p(m.currentSheetIndex)].luckysheet_conditionformat_save;u.push(s),m.luckysheetfile[p(m.currentSheetIndex)].luckysheet_conditionformat_save=u;let f=$.extend(!0,[],m.luckysheetfile),h=e.getCurrentRules(f);e.ref(c,h),$("#luckysheet-modal-dialog-mask").hide(),$("#luckysheet-conditionformat-dialog").hide(),d.allowUpdate&&d.saveParam("all",m.currentSheetIndex,u,{k:"luckysheet_conditionformat_save"})}),$(document).off("click.CFicons").on("click.CFicons","#luckysheet-CFicons-dialog .item",function(){if($("#luckysheet-modal-dialog-mask").hide(),$("#luckysheet-CFicons-dialog").hide(),m.luckysheet_select_save.length>0){let t=$.extend(!0,[],m.luckysheet_select_save),o={len:$(this).attr("data-len"),leftMin:$(this).attr("data-leftMin"),top:$(this).attr("data-top")};e.updateItem("icons",t,o)}}),$(document).on("click",".range .fa-table",function(){let t,o=$(this).parents(".luckysheet-modal-dialog").attr("id");if($("#"+o).hide(),"luckysheet-conditionformat-dialog"==o){t="conditionVal"==$(this).siblings("input").attr("id")?"0_1":"0_2"}else if("luckysheet-newConditionRule-dialog"==o){let e=$(this).parents(".range").attr("id");t="formulaConditionVal"==e?"1_0":"conditionVal"==e?"1_1":"1_2"}else if("luckysheet-editorConditionRule-dialog"==o){let e=$(this).parents(".range").attr("id");t="formulaConditionVal"==e?"2_0":"conditionVal"==e?"2_1":"2_2"}let l=$(this).siblings("input").val();e.singleRangeDialog(t,l),B(e.getRangeByTxt(l))}),$(document).on("click","#luckysheet-singleRange-dialog-confirm",function(){$("#luckysheet-modal-dialog-mask").show(),$(this).parents("#luckysheet-singleRange-dialog").hide();let e=$(this).attr("data-source"),t=$(this).parents("#luckysheet-singleRange-dialog").find("input").val();"0_1"==e?($("#luckysheet-conditionformat-dialog").show(),$("#luckysheet-conditionformat-dialog #conditionVal").val(t)):"0_2"==e?($("#luckysheet-conditionformat-dialog").show(),$("#luckysheet-conditionformat-dialog #conditionVal2").val(t)):"1_0"==e?($("#luckysheet-newConditionRule-dialog").show(),$("#luckysheet-newConditionRule-dialog #formulaConditionVal input").val(t)):"1_1"==e?($("#luckysheet-newConditionRule-dialog").show(),$("#luckysheet-newConditionRule-dialog #conditionVal input").val(t)):"1_2"==e?($("#luckysheet-newConditionRule-dialog").show(),$("#luckysheet-newConditionRule-dialog #conditionVal2 input").val(t)):"2_0"==e?($("#luckysheet-editorConditionRule-dialog").show(),$("#luckysheet-editorConditionRule-dialog #formulaConditionVal input").val(t)):"2_1"==e?($("#luckysheet-editorConditionRule-dialog").show(),$("#luckysheet-editorConditionRule-dialog #conditionVal input").val(t)):"2_2"==e&&($("#luckysheet-editorConditionRule-dialog").show(),$("#luckysheet-editorConditionRule-dialog #conditionVal2 input").val(t));B([])}),$(document).on("click","#luckysheet-singleRange-dialog-close",function(){$("#luckysheet-modal-dialog-mask").show(),$(this).parents("#luckysheet-singleRange-dialog").hide();let e=$(this).attr("data-source");"0_1"==e||"0_2"==e?$("#luckysheet-conditionformat-dialog").show():"1_0"==e||"1_1"==e||"1_2"==e?$("#luckysheet-newConditionRule-dialog").show():"2_0"!=e&&"2_1"!=e&&"2_2"!=e||$("#luckysheet-editorConditionRule-dialog").show();B([])}),$(document).on("click",".luckysheet-modal-dialog-title-close",function(){let e=$(this).parents(".luckysheet-modal-dialog").attr("id");if("luckysheet-newConditionRule-dialog"==e){1==$("#"+e).find("#luckysheet-newConditionRule-dialog-close").attr("data-source")&&$("#luckysheet-administerRule-dialog").show()}if("luckysheet-editorConditionRule-dialog"==e&&$("#luckysheet-administerRule-dialog").show(),"luckysheet-singleRange-dialog"==e){$("#luckysheet-modal-dialog-mask").show();let e=$(this).parents("#luckysheet-singleRange-dialog").find("#luckysheet-singleRange-dialog-confirm").attr("data-source");"0_1"==e||"0_2"==e?$("#luckysheet-conditionformat-dialog").show():"1_1"==e||"1_2"==e?$("#luckysheet-newConditionRule-dialog").show():"2_1"!=e&&"2_2"!=e||$("#luckysheet-editorConditionRule-dialog").show(),B([])}if("luckysheet-multiRange-dialog"==e){$("#luckysheet-modal-dialog-mask").show(),$("#luckysheet-administerRule-dialog").show(),B([])}"luckysheet-conditionformat-info-dialog"==e&&$("#luckysheet-modal-dialog-mask").show()}),$(document).on("click","#luckysheet-conditionformat-info-dialog-close",function(){$(this).parents("#luckysheet-conditionformat-info-dialog").hide()})},singleRangeDialog:function(e,t){$("#luckysheet-modal-dialog-mask").hide(),$("#luckysheet-singleRange-dialog").remove();const o=f().conditionformat;$("body").append(v(I,{id:"luckysheet-singleRange-dialog",addclass:"luckysheet-singleRange-dialog",title:o.selectCell,content:`<input readonly="readonly" placeholder="${o.pleaseSelectCell}" value="${t}"/>`,botton:`<button id="luckysheet-singleRange-dialog-confirm" class="btn btn-primary" data-source="${e}">${o.confirm}</button>\n                        <button id="luckysheet-singleRange-dialog-close" class="btn btn-default" data-source="${e}">${o.cancel}</button>`,style:"z-index:100003"}));let l=$("#luckysheet-singleRange-dialog").find(".luckysheet-modal-dialog-content").css("min-width",300).end(),n=l.outerHeight(),i=l.outerWidth(),a=$(window).width(),r=$(window).height(),c=$(document).scrollLeft(),d=$(document).scrollTop();$("#luckysheet-singleRange-dialog").css({left:(a+c-i)/2,top:(r+d-n)/3}).show()},multiRangeDialog:function(e,t){$("#luckysheet-modal-dialog-mask").hide(),$("#luckysheet-multiRange-dialog").remove();const o=f().conditionformat;$("body").append(v(I,{id:"luckysheet-multiRange-dialog",addclass:"luckysheet-multiRange-dialog",title:o.selectRange,content:`<input readonly="readonly" placeholder="${o.pleaseSelectRange}" value="${t}"/>`,botton:`<button id="luckysheet-multiRange-dialog-confirm" class="btn btn-primary" data-item="${e}">${o.confirm}</button>\n                        <button id="luckysheet-multiRange-dialog-close" class="btn btn-default">${o.cancel}</button>`,style:"z-index:100003"}));let l=$("#luckysheet-multiRange-dialog").find(".luckysheet-modal-dialog-content").css("min-width",300).end(),n=l.outerHeight(),i=l.outerWidth(),a=$(window).width(),r=$(window).height(),c=$(document).scrollLeft(),d=$(document).scrollTop();$("#luckysheet-multiRange-dialog").css({left:(a+c-i)/2,top:(r+d-n)/3}).show(),B(this.getRangeByTxt(t))},getTxtByRange:function(e){if(e.length>0){let t=[];for(let o=0;o<e.length;o++){let l=e[o].row[0],n=e[o].row[1],i=e[o].column[0],a=e[o].column[1];t.push(y(m.currentSheetIndex,{row:[l,n],column:[i,a]},m.currentSheetIndex))}return t.join(",")}},getRangeByTxt:function(e){let t=[];if(-1!=(e=e.toString()).indexOf(",")){let l=e.split(",");for(let e=0;e<l.length;e++){if(!o.iscelldata(l[e])){t=[];break}t.push(o.getcellrange(l[e]))}}else o.iscelldata(e)&&t.push(o.getcellrange(e));return t},colorSelectInit:function(){const e=f().conditionformat;$(".luckysheet-conditionformat-config-color").spectrum({showPalette:!0,showPaletteOnly:!0,preferredFormat:"hex",clickoutFiresChange:!1,showInitial:!0,showInput:!0,hideAfterPaletteSelect:!0,showSelectionPalette:!0,maxPaletteSize:8,maxSelectionSize:8,cancelText:e.cancel,chooseText:e.confirmColor,togglePaletteMoreText:"自定义",togglePaletteLessText:"收起",togglePaletteOnly:!0,clearText:e.clearColorSelect,noColorSelectedText:"没有颜色被选择",localStorageKey:"spectrum.textcolor"+d.gridKey,palette:[["#000","#444","#666","#999","#ccc","#eee","#f3f3f3","#fff"],["#f00","#f90","#ff0","#0f0","#0ff","#00f","#90f","#f0f"],["#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d0e0e3","#cfe2f3","#d9d2e9","#ead1dc"],["#ea9999","#f9cb9c","#ffe599","#b6d7a8","#a2c4c9","#9fc5e8","#b4a7d6","#d5a6bd"],["#e06666","#f6b26b","#ffd966","#93c47d","#76a5af","#6fa8dc","#8e7cc3","#c27ba0"],["#c00","#e69138","#f1c232","#6aa84f","#45818e","#3d85c6","#674ea7","#a64d79"],["#900","#b45f06","#bf9000","#38761d","#134f5c","#0b5394","#351c75","#741b47"],["#600","#783f04","#7f6000","#274e13","#0c343d","#073763","#20124d","#4c1130"]],change:function(e){null!=e&&(e=e.toHexString())}})},conditionformatDialog:function(e,t){let o=this;$("#luckysheet-modal-dialog-mask").show(),$("#luckysheet-conditionformat-dialog").remove();const l=f().conditionformat;$("body").append(v(I,{id:"luckysheet-conditionformat-dialog",addclass:"luckysheet-conditionformat-dialog",title:e,content:t,botton:`<button id="luckysheet-conditionformat-dialog-confirm" class="btn btn-primary">${l.confirm}</button>\n                        <button class="btn btn-default luckysheet-model-close-btn">${l.cancel}</button>`,style:"z-index:9999"}));let n=$("#luckysheet-conditionformat-dialog").find(".luckysheet-modal-dialog-content").css("min-width",300).end(),i=n.outerHeight(),a=n.outerWidth(),r=$(window).width(),c=$(window).height(),d=$(document).scrollLeft(),s=$(document).scrollTop();$("#luckysheet-conditionformat-dialog").css({left:(r+d-a)/2,top:(c+s-i)/3}).show(),o.init(),o.colorSelectInit(),e==f().conditionformat.conditionformat_occurrenceDate&&o.daterangeInit("luckysheet-conditionformat-dialog")},CFiconsDialog:function(){$("#luckysheet-modal-dialog-mask").show(),$("#luckysheet-CFicons-dialog").remove();const e=f().conditionformat;let t=`<div class="box">\n                            <div style="margin-bottom: 10px;">${e.pleaseSelectIcon}</div>\n                            <div class="title">${e.direction}</div>\n                            <div class="list">\n                                <div class="left">\n                                    <div class="item" data-len="3" data-leftMin="0" data-top="0" title="${e.threeWayArrow}(${e.multicolor})"><div style="background-position:0 0;"></div></div>\n                                    <div class="item" data-len="3" data-leftMin="0" data-top="1" title="${e.threeTriangles}"><div style="background-position:0 -20px;"></div></div>\n                                    <div class="item" data-len="4" data-leftMin="0" data-top="2" title="${e.fourWayArrow}(${e.multicolor})"><div style="background-position:0 -40px;"></div></div>\n                                    <div class="item" data-len="5" data-leftMin="0" data-top="3" title="${e.fiveWayArrow}(${e.multicolor})"><div style="background-position:0 -60px;"></div></div>\n                                </div>\n                                <div class="right">\n                                    <div class="item" data-len="3" data-leftMin="5" data-top="0" title="${e.threeWayArrow}(${e.grayColor})"><div style="background-position:-131px 0;"></div></div>\n                                    <div class="item" data-len="4" data-leftMin="5" data-top="1" title="${e.fourWayArrow}(${e.grayColor})"><div style="background-position:-131px -20px;"></div></div>\n                                    <div class="item" data-len="5" data-leftMin="5" data-top="2" title="${e.fiveWayArrow}(${e.grayColor})"><div style="background-position:-131px -40px;"></div></div>\n                                </div>\n                                <div style="clear:both;"></div>\n                            </div>\n                            <div class="title">${e.shape}</div>\n                            <div class="list">\n                                <div class="left">\n                                    <div class="item" data-len="3" data-leftMin="0" data-top="4" title="${e.threeColorTrafficLight}(${e.rimless})"><div style="background-position:0 -80px;"></div></div>\n                                    <div class="item" data-len="3" data-leftMin="0" data-top="5" title="${e.threeSigns}"><div style="background-position:0 -100px;"></div></div>\n                                    <div class="item" data-len="4" data-leftMin="0" data-top="6" title="${e.greenRedBlackGradient}"><div style="background-position:0 -120px;"></div></div>\n                                </div>\n                                <div class="right">\n                                    <div class="item" data-len="3" data-leftMin="5" data-top="4" title="${e.threeColorTrafficLight}(${e.bordered})"><div style="background-position:-131px -80px;"></div></div>\n                                    <div class="item" data-len="4" data-leftMin="5" data-top="5" title="${e.fourColorTrafficLight}"><div style="background-position:-131px -100px;"></div></div>\n                                </div>\n                                <div style="clear:both;"></div>\n                            </div>\n                            <div class="title">${e.mark}</div>\n                            <div class="list">\n                                <div class="left">\n                                    <div class="item" data-len="3" data-leftMin="0" data-top="7" title="${e.threeSymbols}(${e.circled})"><div style="background-position:0 -140px;"></div></div>\n                                    <div class="item" data-len="3" data-leftMin="0" data-top="8" title="${e.tricolorFlag}"><div style="background-position:0 -160px;"></div></div>\n                                </div>\n                                <div class="right">\n                                    <div class="item" data-len="3" data-leftMin="5" data-top="7" title="${e.threeSymbols}(${e.noCircle})"><div style="background-position:-131px -140px;"></div></div>\n                                </div>\n                                <div style="clear:both;"></div>\n                            </div>\n                            <div class="title">${e.grade}</div>\n                            <div class="list">\n                                <div class="left">\n                                    <div class="item" data-len="3" data-leftMin="0" data-top="9" title="${e.threeStars}"><div style="background-position:0 -180px;"></div></div>\n                                    <div class="item" data-len="5" data-leftMin="0" data-top="10" title="${e.fiveQuadrantDiagram}"><div style="background-position:0 -200px;"></div></div>\n                                    <div class="item" data-len="5" data-leftMin="0" data-top="11" title="${e.fiveBoxes}"><div style="background-position:0 -220px;"></div></div>\n                                </div>\n                                <div class="right">\n                                    <div class="item" data-len="4" data-leftMin="5" data-top="9" title="${e.grade4}"><div style="background-position:-131px -180px;"></div></div>\n                                    <div class="item" data-len="5" data-leftMin="5" data-top="10" title="${e.grade5}"><div style="background-position:-131px -200px;"></div></div>\n                                </div>\n                                <div style="clear:both;"></div>\n                            </div>\n                        </div>`;$("body").append(v(I,{id:"luckysheet-CFicons-dialog",addclass:"luckysheet-CFicons-dialog",title:e.icons,content:t,botton:`<button class="btn btn-default luckysheet-model-close-btn">${e.close}</button>`,style:"z-index:100003"}));let o=$("#luckysheet-CFicons-dialog").find(".luckysheet-modal-dialog-content").css("min-width",400).end(),l=o.outerHeight(),n=o.outerWidth(),i=$(window).width(),a=$(window).height(),r=$(document).scrollLeft(),c=$(document).scrollTop();$("#luckysheet-CFicons-dialog").css({left:(i+r-n)/2,top:(a+c-l)/3}).show()},administerRuleDialog:function(){$("#luckysheet-modal-dialog-mask").show(),$("#luckysheet-administerRule-dialog").remove();const e=f().conditionformat;let t="";for(let o=0;o<m.luckysheetfile.length;o++)"1"==m.luckysheetfile[o].status?t+=`<option value="${m.luckysheetfile[o].index}" selected="selected">\n                                ${e.currentSheet}：${m.luckysheetfile[o].name}\n                            </option>`:t+=`<option value="${m.luckysheetfile[o].index}">\n                                ${e.sheet}：${m.luckysheetfile[o].name}\n                            </option>`;let o=`<div class="chooseSheet">\n                            <label>${e.showRules}：</label>\n                            <select>${t}</select>\n                        </div>\n                        <div class="ruleBox">\n                            <div class="ruleBtn">\n                                <button id="newConditionRule" class="btn btn-default">${e.newRule}</button>\n                                <button id="editorConditionRule" class="btn btn-default">${e.editRule}</button>\n                                <button id="deleteConditionRule" class="btn btn-default">${e.deleteRule}</button>\n                            </div>\n                            <div class="ruleList">\n                                <div class="listTitle">\n                                    <span>${e.rule}</span>\n                                    <span>${e.format}</span>\n                                    <span>${e.applyRange}</span>\n                                </div>\n                                <div class="listBox"></div>\n                            </div>\n                        </div>`;$("body").append(v(I,{id:"luckysheet-administerRule-dialog",addclass:"luckysheet-administerRule-dialog",title:e.conditionformatManageRules,content:o,botton:`<button id="luckysheet-administerRule-dialog-confirm" class="btn btn-primary">${e.confirm}</button>\n                        <button id="luckysheet-administerRule-dialog-close" class="btn btn-default">${e.close}</button>`,style:"z-index:100003"}));let l=$("#luckysheet-administerRule-dialog").find(".luckysheet-modal-dialog-content").css("min-width",400).end(),n=l.outerHeight(),i=l.outerWidth(),a=$(window).width(),r=$(window).height(),c=$(document).scrollLeft(),d=$(document).scrollTop();$("#luckysheet-administerRule-dialog").css({left:(a+c-i)/2,top:(r+d-n)/3}).show();let s=$("#luckysheet-administerRule-dialog .chooseSheet option:selected").val();this.getConditionRuleList(s)},getConditionRuleList:function(e){let t=this;$("#luckysheet-administerRule-dialog .ruleList .listBox").empty();let o=t.fileClone[p(e)].luckysheet_conditionformat_save;if(null!=o&&o.length>0){const e=f().conditionformat;for(let l=0;l<o.length;l++){let n,i=o[l].type,a=o[l].format,r=o[l].cellrange,c="";"dataBar"==i?(n=e.dataBar,c='<canvas width="46" height="18" style="width: 46px;height: 18px;margin: 3px 0 0 5px;"></canvas>'):"colorGradation"==i?(n=e.colorGradation,c='<canvas width="46" height="18" style="width: 46px;height: 18px;margin: 3px 0 0 5px;"></canvas>'):"icons"==i?(n=e.icons,c='<canvas width="46" height="18" style="width: 46px;height: 18px;margin: 3px 0 0 5px;"></canvas>'):(n=t.getConditionRuleName(o[l].conditionName,o[l].conditionRange,o[l].conditionValue),null!=a.textColor&&(c+='<span class="colorbox" title="'+e.textColor+'" style="background-color:'+a.textColor+'"></span>'),null!=a.cellColor&&(c+='<span class="colorbox" title="'+e.cellColor+'" style="background-color:'+a.cellColor+'"></span>'));let d=[];for(let e=0;e<r.length;e++){let t=r[e].row[0],o=r[e].row[1],l=r[e].column[0],n=r[e].column[1];d.push(k(l)+(t+1)+":"+k(n)+(o+1))}let s='<div class="item" data-item="'+l+'"><div class="ruleName" title="'+n+'">'+n+'</div><div class="format">'+c+'</div><div class="ruleRange"><input class="formulaInputFocus" readonly="true" value="'+d.join(",")+'"/><i class="fa fa-table" aria-hidden="true" title="'+e.selectRange+'"></i></div></div>';$("#luckysheet-administerRule-dialog .ruleList .listBox").prepend(s)}$("#luckysheet-administerRule-dialog .ruleList .listBox .item canvas").each(function(e){let t=$(this).closest(".item").attr("data-item"),l=o[t].type,n=o[t].format,i=$(this).get(0).getContext("2d");if("dataBar"==l)if(2==n.length){let e=i.createLinearGradient(0,0,46,0);e.addColorStop(0,n[0]),e.addColorStop(1,n[1]),i.fillStyle=e,i.fillRect(0,0,46,18),i.beginPath(),i.moveTo(0,0),i.lineTo(0,18),i.lineTo(46,18),i.lineTo(46,0),i.lineTo(0,0),i.lineWidth=m.devicePixelRatio,i.strokeStyle=n[0],i.stroke(),i.closePath()}else 1==n.length&&(i.fillStyle=n[0],i.fillRect(0,0,46,18),i.beginPath(),i.moveTo(0,0),i.lineTo(0,18),i.lineTo(46,18),i.lineTo(46,0),i.lineTo(0,0),i.lineWidth=m.devicePixelRatio,i.strokeStyle=n[0],i.stroke(),i.closePath());else if("colorGradation"==l){let e=i.createLinearGradient(0,0,46,0);3==n.length?(e.addColorStop(0,n[0]),e.addColorStop(.5,n[1]),e.addColorStop(1,n[2])):2==n.length&&(e.addColorStop(0,n[0]),e.addColorStop(1,n[1])),i.fillStyle=e,i.fillRect(0,0,46,18)}else if("icons"==l){let e=n.len,t=n.leftMin,o=n.top,l=32*e+10*(e-1),a=32,r=46,c=1472/l;"0"==t?i.drawImage(S,0,32*o,l,a,0,(18-c)/2,r,c):"5"==t&&i.drawImage(S,210,32*o,l,a,0,(18-c)/2,r,c)}}),$("#luckysheet-administerRule-dialog .ruleList .listBox .item").eq(0).addClass("on")}},getConditionRuleName:function(e,t,o){let l;l=null!=t[0]?k(t[0].column[0])+(t[0].row[0]+1):o[0];const n=f().conditionformat;if("greaterThan"==e)return n.cellValue+" > "+l;if("lessThan"==e)return n.cellValue+" < "+l;if("betweenness"==e){let e;return e=null!=t[1]?k(t[1].column[0])+(t[1].row[0]+1):o[1],n.cellValue+" "+n.between+" "+l+" "+n.in+" "+e+" "+n.between2}if("equal"==e)return n.cellValue+" = "+l;if("textContains"==e)return n.cellValue+n.contain+" ="+l;if("occurrenceDate"==e)return o;if("duplicateValue"==e){if("0"==o)return n.duplicateValue;if("1"==o)return n.uniqueValue}else{if("top10"==e)return n.top+" "+l+" "+n.oneself;if("top10%"==e)return n.top+" "+l+"% "+n.oneself;if("last10"==e)return n.last+" "+l+" "+n.oneself;if("last10%"==e)return n.last+" "+l+"% "+n.oneself;if("AboveAverage"==e)return n.aboveAverage;if("SubAverage"==e)return n.belowAverage;if("formula"==e)return"="!=l.slice(0,1)&&(l="="+l),n.formula+": "+l}},newConditionRuleDialog:function(e){const t=f().conditionformat;let o=this.getRuleExplain(0);$("#luckysheet-modal-dialog-mask").show(),$("#luckysheet-administerRule-dialog").hide(),$("#luckysheet-newConditionRule-dialog").remove();let l='<div><div class="boxTitle">'+t.chooseRuleType+"：</div>"+this.ruleTypeHtml()+'<div class="boxTitle">'+t.editRuleDescription+'：</div><div class="ruleExplainBox">'+o+"</div></div>";$("body").append(v(I,{id:"luckysheet-newConditionRule-dialog",addclass:"luckysheet-newEditorRule-dialog",title:t.newFormatRule,content:l,botton:`<button id="luckysheet-newConditionRule-dialog-confirm" class="btn btn-primary" data-source="${e}">${t.confirm}</button>\n                        <button id="luckysheet-newConditionRule-dialog-close" class="btn btn-default" data-source="${e}">${t.cancel}</button>`,style:"z-index:100003"}));let n=$("#luckysheet-newConditionRule-dialog").find(".luckysheet-modal-dialog-content").css("min-width",400).end(),i=n.outerHeight(),a=n.outerWidth(),r=$(window).width(),c=$(window).height(),d=$(document).scrollLeft(),s=$(document).scrollTop();$("#luckysheet-newConditionRule-dialog").css({left:(r+d-a)/2,top:(c+s-i)/3}).show(),$("#luckysheet-newConditionRule-dialog .ruleTypeBox .ruleTypeItem:eq(0)").addClass("on").siblings().removeClass("on"),this.colorSelectInit()},editorConditionRuleDialog:function(){let e=this;const t=f().conditionformat;let o=e.editorRule.data;if(null==o)return;let l,n,i=o.type,a=o.format,r=o.conditionName;"dataBar"==i||"colorGradation"==i||"icons"==i?(l=0,n=i):"greaterThan"==r||"lessThan"==r||"betweenness"==r||"equal"==r||"textContains"==r||"occurrenceDate"==r?(l=1,"greaterThan"==r||"lessThan"==r||"betweenness"==r||"equal"==r?n="number":"textContains"==r?n="text":"occurrenceDate"==r&&(n="date")):"top10"==r||"top10%"==r||"last10"==r||"last10%"==r?(l=2,"top10"==r||"top10%"==r?n="top":"last10"!=r&&"last10%"!=r||(n="last")):"AboveAverage"==r||"SubAverage"==r?(l=3,n=r):"duplicateValue"==r?(l=4,n=o.conditionValue):"formula"==r&&(l=5);let c=e.getRuleExplain(l);$("#luckysheet-modal-dialog-mask").show(),$("#luckysheet-administerRule-dialog").hide(),$("#luckysheet-editorConditionRule-dialog").remove();let d='<div><div class="boxTitle">'+t.chooseRuleType+"：</div>"+e.ruleTypeHtml()+'<div class="boxTitle">'+t.editRuleDescription+'：</div><div class="ruleExplainBox">'+c+"</div></div>";$("body").append(v(I,{id:"luckysheet-editorConditionRule-dialog",addclass:"luckysheet-newEditorRule-dialog",title:t.editFormatRule,content:d,botton:`<button id="luckysheet-editorConditionRule-dialog-confirm" class="btn btn-primary">${t.confirm}</button>\n                        <button id="luckysheet-editorConditionRule-dialog-close" class="btn btn-default">${t.cancel}</button>`,style:"z-index:100003"}));let s=$("#luckysheet-editorConditionRule-dialog").find(".luckysheet-modal-dialog-content").css("min-width",400).end(),u=s.outerHeight(),h=s.outerWidth(),g=$(window).width(),p=$(window).height(),w=$(document).scrollLeft(),k=$(document).scrollTop();if($("#luckysheet-editorConditionRule-dialog").css({left:(g+w-h)/2,top:(p+k-u)/3}).show(),e.colorSelectInit(),$("#luckysheet-editorConditionRule-dialog .ruleTypeBox .ruleTypeItem:eq("+l+")").addClass("on").siblings().removeClass("on"),$("#luckysheet-editorConditionRule-dialog #type1").val(n),"dataBar"!=n&&"colorGradation"!=n&&"icons"!=n&&"number"!=n&&"text"!=n&&"date"!=n||($("#luckysheet-editorConditionRule-dialog ."+n+"Box").show(),$("#luckysheet-editorConditionRule-dialog ."+n+"Box").siblings().hide()),"date"==n&&e.daterangeInit("luckysheet-editorConditionRule-dialog"),"dataBar"==i||"colorGradation"==i||"icons"==i){if("dataBar"==n)2==a.length?$("#luckysheet-editorConditionRule-dialog .dataBarBox #type2").val("gradient"):1==a.length&&$("#luckysheet-editorConditionRule-dialog .dataBarBox #type2").val("solid"),$("#luckysheet-editorConditionRule-dialog .dataBarBox .luckysheet-conditionformat-config-color").spectrum("set",a[0]);else if("colorGradation"==n)3==a.length?($("#luckysheet-editorConditionRule-dialog .colorGradationBox #type2").val("threeColor"),$("#luckysheet-editorConditionRule-dialog .colorGradationBox .midVal").show(),$("#luckysheet-editorConditionRule-dialog .colorGradationBox .maxVal .luckysheet-conditionformat-config-color").spectrum("set",a[0]),$("#luckysheet-editorConditionRule-dialog .colorGradationBox .midVal .luckysheet-conditionformat-config-color").spectrum("set",a[1]),$("#luckysheet-editorConditionRule-dialog .colorGradationBox .minVal .luckysheet-conditionformat-config-color").spectrum("set",a[2])):2==a.length&&($("#luckysheet-editorConditionRule-dialog .colorGradationBox #type2").val("twoColor"),$("#luckysheet-editorConditionRule-dialog .colorGradationBox .midVal").hide(),$("#luckysheet-editorConditionRule-dialog .colorGradationBox .maxVal .luckysheet-conditionformat-config-color").spectrum("set",a[0]),$("#luckysheet-editorConditionRule-dialog .colorGradationBox .minVal .luckysheet-conditionformat-config-color").spectrum("set",a[1]));else if("icons"==n){let e=a.len,t=a.leftMin,o=a.top;$("#luckysheet-editorConditionRule-dialog .iconsBox li").each(function(l,n){if($(n).find("div").attr("data-len")==e&&$(n).find("div").attr("data-leftmin")==t&&$(n).find("div").attr("data-top")==o)return $("#luckysheet-editorConditionRule-dialog .iconsBox .showbox .model").css("background-position",$(n).find("div").css("background-position")),$("#luckysheet-editorConditionRule-dialog .iconsBox .showbox .model").attr("data-len",$(n).find("div").attr("data-len")),$("#luckysheet-editorConditionRule-dialog .iconsBox .showbox .model").attr("data-leftmin",$(n).find("div").attr("data-leftmin")),$("#luckysheet-editorConditionRule-dialog .iconsBox .showbox .model").attr("data-top",$(n).find("div").attr("data-leftmin")),$("#luckysheet-editorConditionRule-dialog .iconsBox .showbox .model").attr("title",$(n).find("div").attr("title")),!0})}}else{if("number"==n){let e;if($("#luckysheet-editorConditionRule-dialog .numberBox #type2").val(r),e=null!=o.conditionRange[0]?y(m.currentSheetIndex,{row:o.conditionRange[0].row,column:o.conditionRange[0].column},m.currentSheetIndex):o.conditionValue[0],$("#luckysheet-editorConditionRule-dialog .numberBox #conditionVal input").val(e),"betweenness"==r){let e;$("#luckysheet-editorConditionRule-dialog .numberBox .txt").show(),$("#luckysheet-editorConditionRule-dialog .numberBox #conditionVal2").show(),e=null!=o.conditionRange[1]?y(m.currentSheetIndex,{row:o.conditionRange[1].row,column:o.conditionRange[1].column},m.currentSheetIndex):o.conditionValue[1],$("#luckysheet-editorConditionRule-dialog .numberBox #conditionVal2 input").val(e)}else $("#luckysheet-editorConditionRule-dialog .numberBox .txt").hide(),$("#luckysheet-editorConditionRule-dialog .numberBox #conditionVal2").hide()}else if("text"==n){let e;e=null!=o.conditionRange[0]?y(m.currentSheetIndex,{row:o.conditionRange[0].row,column:o.conditionRange[0].column},m.currentSheetIndex):o.conditionValue[0],$("#luckysheet-editorConditionRule-dialog .textBox #conditionVal input").val(e)}else if("date"==n){e.daterangeInit("luckysheet-editorConditionRule-dialog");let t=o.conditionValue[0];$("#luckysheet-editorConditionRule-dialog .dateBox #daterange-btn").val(t)}else if("top"==n||"last"==n){o.conditionValue[0];"top10%"!=r&&"last10%"!=r||$("#luckysheet-editorConditionRule-dialog #isPercent").attr("checked","checked")}else if("formula"==r){let e=o.conditionValue[0];$("#luckysheet-editorConditionRule-dialog #formulaConditionVal input").val(e)}$("#luckysheet-editorConditionRule-dialog #textcolorshow").spectrum("set",a.textColor),$("#luckysheet-editorConditionRule-dialog #cellcolorshow").spectrum("set",a.cellColor)}},infoDialog:function(e,t){$("#luckysheet-modal-dialog-mask").show(),$("#luckysheet-conditionformat-info-dialog").remove(),$("body").append(v(I,{id:"luckysheet-conditionformat-info-dialog",addclass:"",title:e,content:t,botton:`<button id="luckysheet-conditionformat-info-dialog-close" class="btn btn-default">${f().conditionformat.close}</button>`,style:"z-index:100003"}));let o=$("#luckysheet-conditionformat-info-dialog").find(".luckysheet-modal-dialog-content").css("min-width",300).end(),l=o.outerHeight(),n=o.outerWidth(),i=$(window).width(),a=$(window).height(),r=$(document).scrollLeft(),c=$(document).scrollTop();$("#luckysheet-conditionformat-info-dialog").css({left:(i+r-n)/2,top:(a+c-l)/3}).show()},getRuleExplain:function(e){const t=f().conditionformat;let o,l=this.textCellColorHtml();switch(e){case 0:o=`<div class="title">${t.ruleTypeItem1}：</div>\n                                    <div style="height: 30px;margin-bottom: 5px;">\n                                        <label style="display: block;width: 80px;height: 30px;line-height: 30px;float: left;">${t.formatStyle}：</label>\n                                        <select id="type1">\n                                            <option value="dataBar">${t.dataBar}</option>\n                                            <option value="colorGradation">${t.colorGradation}</option>\n                                            <option value="icons">${t.icons}</option>\n                                        </select>\n                                    </div>\n                                    <div>\n                                        <div class="type1Box dataBarBox">\n                                            <div style="height: 30px;margin-bottom: 5px;">\n                                                <label style="display: block;width: 80px;height: 30px;line-height: 30px;float: left;">${t.fillType}：</label>\n                                                <select id="type2">\n                                                    <option value="gradient">${t.gradient}</option>\n                                                    <option value="solid">${t.solid}</option>\n                                                </select>\n                                            </div>\n                                            <div style="height: 30px;margin-bottom: 5px;">\n                                                <label style="display: block;width: 80px;height: 30px;line-height: 30px;float: left;">${t.color}：</label>\n                                                <input data-tips="${t.dataBarColor}" data-func="background" class="luckysheet-conditionformat-config-color" type="text" value="#638ec6" style="display: none;"> \n                                            </div>\n                                        </div>\n                                        <div class="type1Box colorGradationBox" style="display: none;">\n                                            <div style="height: 30px;margin-bottom: 5px;">\n                                                <label style="display: block;width: 80px;height: 30px;line-height: 30px;float: left;">${t.fillType}：</label>\n                                                <select id="type2">\n                                                    <option value="threeColor">${t.tricolor}</option>\n                                                    <option value="twoColor">${t.twocolor}</option>\n                                                </select>\n                                            </div>\n                                            <div class="maxVal" style="height: 30px;margin-bottom: 5px;">\n                                                <label style="display: block;width: 80px;height: 30px;line-height: 30px;float: left;">${t.maxValue}：</label>\n                                                <input data-tips="${t.maxValue} ${t.color}" data-func="background" class="luckysheet-conditionformat-config-color" type="text" value="rgb(99, 190, 123)" style="display: none;">\n                                            </div>\n                                            <div class="midVal" style="height: 30px;margin-bottom: 5px;">\n                                                <label style="display: block;width: 80px;height: 30px;line-height: 30px;float: left;">${t.medianValue}：</label>\n                                                <input data-tips="${t.medianValue} ${t.color}" data-func="background" class="luckysheet-conditionformat-config-color" type="text" value="rgb(255, 235, 132)" style="display: none;">\n                                            </div>\n                                            <div class="minVal" style="height: 30px;margin-bottom: 5px;">\n                                                <label style="display: block;width: 80px;height: 30px;line-height: 30px;float: left;">${t.minValue}：</label>\n                                                <input data-tips="${t.minValue} ${t.color}" data-func="background" class="luckysheet-conditionformat-config-color" type="text" value="rgb(248, 105, 107)" style="display: none;">\n                                            </div>\n                                        </div>\n                                        <div class="type1Box iconsBox" style="display: none;">\n                                            <label>${t.fillType}：</label>\n                                            <div class="showbox">\n                                                <div class="model" data-len="3" data-leftmin="0" data-top="0" title="${t.threeWayArrow}(${t.multicolor})" style="background-position: 0 0;"></div>\n                                                <span class="ui-selectmenu-icon ui-icon ui-icon-triangle-1-s" style="margin-top: 2px;"></span>\n                                            </div>\n                                            <ul>\n                                                <li><div data-len="3" data-leftmin="0" data-top="0" title="${t.threeWayArrow}(${t.multicolor})" style="background-position: 0 0;"></div></li>\n                                                <li><div data-len="3" data-leftmin="5" data-top="0" title="${t.threeWayArrow}(${t.grayColor})" style="background-position: -131px 0;"></div></li>\n                                                <li><div data-len="3" data-leftmin="0" data-top="1" title="${t.threeTriangles}" style="background-position: 0 -20px;"></div></li>\n                                                <li><div data-len="4" data-leftmin="0" data-top="2" title="${t.fourWayArrow}(${t.multicolor})" style="background-position: 0 -40px;"></div></li>\n                                                <li><div data-len="4" data-leftmin="5" data-top="1" title="${t.fourWayArrow}(${t.grayColor})" style="background-position: -131px -20px;"></div></li>\n                                                <li><div data-len="5" data-leftmin="0" data-top="3" title="${t.fiveWayArrow}(${t.multicolor})" style="background-position: 0 -60px;"></div></li>\n                                                <li><div data-len="5" data-leftmin="5" data-top="2" title="${t.fiveWayArrow}(${t.grayColor})" style="background-position: -131px -40px;"></div></li>\n                                                <li><div data-len="3" data-leftmin="0" data-top="4" title="${t.threeColorTrafficLight}(${t.rimless})" style="background-position: 0 -80px;"></div></li>\n                                                <li><div data-len="3" data-leftmin="5" data-top="4" title="${t.threeColorTrafficLight}(${t.bordered})" style="background-position: -131px -80px;"></div></li>\n                                                <li><div data-len="3" data-leftmin="0" data-top="5" title="${t.threeSigns}" style="background-position: 0 -100px;"></div></li>\n                                                <li><div data-len="4" data-leftmin="5" data-top="5" title="${t.fourColorTrafficLight}" style="background-position: -131px -100px;"></div></li>\n                                                <li><div data-len="4" data-leftmin="0" data-top="6" title="${t.greenRedBlackGradient}" style="background-position: 0 -120px;"></div></li>\n                                                <li><div data-len="3" data-leftmin="0" data-top="7" title="${t.threeSymbols}(${t.circled})" style="background-position: 0 -140px;"></div></li>\n                                                <li><div data-len="3" data-leftmin="5" data-top="7" title="${t.threeSymbols}(${t.noCircle})" style="background-position: -131px -140px;"></div></li>\n                                                <li><div data-len="3" data-leftmin="0" data-top="8" title="${t.tricolorFlag}" style="background-position: 0 -160px;"></div></li>\n                                                <li><div data-len="3" data-leftmin="0" data-top="9" title="${t.threeStars}" style="background-position: 0 -180px;"></div></li>\n                                                <li><div data-len="5" data-leftmin="0" data-top="10" title="${t.fiveQuadrantDiagram}" style="background-position: 0 -200px;"></div></li>\n                                                <li><div data-len="5" data-leftmin="0" data-top="11" title="${t.fiveBoxes}" style="background-position: 0 -220px;"></div></li>\n                                                <li><div data-len="4" data-leftmin="5" data-top="9" title="${t.grade4}" style="background-position: -131px -180px;"></div></li>\n                                                <li><div data-len="5" data-leftmin="5" data-top="10" title="${t.grade5}" style="background-position: -131px -200px;"></div></li>\n                                            </ul>\n                                        </div>\n                                    </div>`;break;case 1:o=`<div class="title">${t.ruleTypeItem2_title}：</div>\n                                    <div style="height: 30px;margin-bottom: 10px;">\n                                        <select id="type1">\n                                            <option value="number">${t.cellValue}</option>\n                                            <option value="text">${t.specificText}</option>\n                                            <option value="date">${t.occurrence}</option>\n                                        </select>\n                                        <div>\n                                            <div class="type1Box numberBox">\n                                                <select id="type2">\n                                                    <option value="greaterThan">${t.greaterThan}</option>\n                                                    <option value="lessThan">${t.lessThan}</option>\n                                                    <option value="betweenness">${t.between}</option>\n                                                    <option value="equal">${t.equal}</option>\n                                                </select>\n                                                <div class="inpbox range" id="conditionVal">\n                                                    <input class="formulaInputFocus"/>\n                                                    <i class="fa fa-table" aria-hidden="true" title="${t.selectCell}"></i>\n                                                </div>\n                                                <span class="txt" style="display: none;">${t.in}</span>\n                                                <div class="inpbox range" id="conditionVal2" style="display: none;">\n                                                    <input class="formulaInputFocus"/>\n                                                    <i class="fa fa-table" aria-hidden="true" title="${t.selectDataRange}"></i>\n                                                </div>\n                                            </div>\n                                            <div class="type1Box textBox" style="display: none;">\n                                                <select id="type2">\n                                                    <option value="">${t.contain}</option>\n                                                </select>\n                                                <div class="inpbox range" id="conditionVal">\n                                                    <input class="formulaInputFocus"/>\n                                                    <i class="fa fa-table" aria-hidden="true" title="${t.selectCell}"></i>\n                                                </div>\n                                            </div>\n                                            <div class="type1Box dateBox" style="display: none;">\n                                                <div style="width: 162px;" class="inpbox">\n                                                    <input style="width: 150px;" id="daterange-btn" readonly="readonly" placeholder="${t.pleaseSelectADate}"/>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                    <div class="title">${t.setFormat}: </div>${l}`;break;case 2:o=`<div class="title">${t.ruleTypeItem3_title}：</div>\n                                    <div style="height: 30px;margin-bottom: 10px;">\n                                        <select id="type1">\n                                            <option value="top">${t.top}</option>\n                                            <option value="last">${t.last}</option>\n                                        </select>\n                                        <div class="inpbox" id="conditionVal">\n                                            <input class="formulaInputFocus" type="number" value="10"/>\n                                        </div>\n                                        <input id="isPercent" type="checkbox"/>\n                                        <label for="isPercent" class="txt">${t.selectRange_percent}</label>\n                                    </div>\n                                    <div class="title">${t.setFormat}：</div>${l}`;break;case 3:o=`<div class="title">${t.ruleTypeItem4_title}：</div>\n                                    <div style="height: 30px;margin-bottom: 10px;">\n                                        <select id="type1">\n                                            <option value="AboveAverage">${t.above}</option>\n                                            <option value="SubAverage">${t.below}</option>\n                                        </select>\n                                        <span class="txt">${t.selectRange_average}</span>\n                                    </div>\n                                    <div class="title">${t.setFormat}：</div>${l}`;break;case 4:o=`<div class="title">${t.all}：</div>\n                                    <div style="height: 30px;margin-bottom: 10px;">\n                                        <select id="type1">\n                                            <option value="0">${t.duplicateValue}</option>\n                                            <option value="1">${t.uniqueValue}</option>\n                                        </select>\n                                        <span class="txt">${t.selectRange_value}</span>\n                                    </div>\n                                    <div class="title">${t.setFormat}：</div>${l}`;break;case 5:o=`<div class="title">${t.ruleTypeItem2_title}：</div>\n                                    <div style="height: 30px;margin-bottom: 10px;">\n                                        <div class="inpbox range" id="formulaConditionVal" style="width: 250px;">\n                                            <input class="formulaInputFocus" style="width: 200px;"/>\n                                            <i class="fa fa-table" aria-hidden="true" title="${t.selectCell}"></i>\n                                        </div>\n                                    </div>\n                                    <div class="title">${t.setFormat}: </div>${l}`}return o},daterangeInit:function(e){const t=f().conditionformat;$(".ranges_1 ul").remove(),$("#"+e).find("#daterange-btn").flatpickr({mode:"range",onChange:function(e,o){const[l,n]=e;let i=[t.yesterday,t.today],a=[t.lastWeek,t.thisWeek,t.lastMonth,t.thisMonth,t.lastYear,t.thisYear,t.last7days,t.last30days];o==t.all?$("#daterange-btn").val(""):i.indexOf(o)>-1?$("#daterange-btn").val(g(l).format("YYYY/MM/DD")):a.indexOf(o)>-1&&$("#daterange-btn").val(g(l).format("YYYY/MM/DD")+"-"+g(n).format("YYYY/MM/DD"))}})},CFSplitRange:function(e,t,o,l){let n=[],i=o.row[0]-t.row[0],a=o.column[0]-t.column[0],r=e.row[0],c=e.row[1],d=e.column[0],s=e.column[1];return r>=t.row[0]&&c<=t.row[1]&&d>=t.column[0]&&s<=t.column[1]?"allPart"==l?n=[{row:[r+i,c+i],column:[d+a,s+a]}]:"restPart"==l?n=[]:"operatePart"==l&&(n=[{row:[r+i,c+i],column:[d+a,s+a]}]):r>=t.row[0]&&r<=t.row[1]&&d>=t.column[0]&&s<=t.column[1]?"allPart"==l?n=[{row:[t.row[1]+1,c],column:[d,s]},{row:[r+i,t.row[1]+i],column:[d+a,s+a]}]:"restPart"==l?n=[{row:[t.row[1]+1,c],column:[d,s]}]:"operatePart"==l&&(n=[{row:[r+i,t.row[1]+i],column:[d+a,s+a]}]):c>=t.row[0]&&c<=t.row[1]&&d>=t.column[0]&&s<=t.column[1]?"allPart"==l?n=[{row:[r,t.row[0]-1],column:[d,s]},{row:[t.row[0]+i,c+i],column:[d+a,s+a]}]:"restPart"==l?n=[{row:[r,t.row[0]-1],column:[d,s]}]:"operatePart"==l&&(n=[{row:[t.row[0]+i,c+i],column:[d+a,s+a]}]):r<t.row[0]&&c>t.row[1]&&d>=t.column[0]&&s<=t.column[1]?"allPart"==l?n=[{row:[r,t.row[0]-1],column:[d,s]},{row:[t.row[1]+1,c],column:[d,s]},{row:[t.row[0]+i,t.row[1]+i],column:[d+a,s+a]}]:"restPart"==l?n=[{row:[r,t.row[0]-1],column:[d,s]},{row:[t.row[1]+1,c],column:[d,s]}]:"operatePart"==l&&(n=[{row:[t.row[0]+i,t.row[1]+i],column:[d+a,s+a]}]):d>=t.column[0]&&d<=t.column[1]&&r>=t.row[0]&&c<=t.row[1]?"allPart"==l?n=[{row:[r,c],column:[t.column[1]+1,s]},{row:[r+i,c+i],column:[d+a,t.column[1]+a]}]:"restPart"==l?n=[{row:[r,c],column:[t.column[1]+1,s]}]:"operatePart"==l&&(n=[{row:[r+i,c+i],column:[d+a,t.column[1]+a]}]):s>=t.column[0]&&s<=t.column[1]&&r>=t.row[0]&&c<=t.row[1]?"allPart"==l?n=[{row:[r,c],column:[d,t.column[0]-1]},{row:[r+i,c+i],column:[t.column[0]+a,s+a]}]:"restPart"==l?n=[{row:[r,c],column:[d,t.column[0]-1]}]:"operatePart"==l&&(n=[{row:[r+i,c+i],column:[t.column[0]+a,s+a]}]):d<t.column[0]&&s>t.column[1]&&r>=t.row[0]&&c<=t.row[1]?"allPart"==l?n=[{row:[r,c],column:[d,t.column[0]-1]},{row:[r,c],column:[t.column[1]+1,s]},{row:[r+i,c+i],column:[t.column[0]+a,t.column[1]+a]}]:"restPart"==l?n=[{row:[r,c],column:[d,t.column[0]-1]},{row:[r,c],column:[t.column[1]+1,s]}]:"operatePart"==l&&(n=[{row:[r+i,c+i],column:[t.column[0]+a,t.column[1]+a]}]):r>=t.row[0]&&r<=t.row[1]&&d>=t.column[0]&&d<=t.column[1]?"allPart"==l?n=[{row:[r,t.row[1]],column:[t.column[1]+1,s]},{row:[t.row[1]+1,c],column:[d,s]},{row:[r+i,t.row[1]+i],column:[d+a,t.column[1]+a]}]:"restPart"==l?n=[{row:[r,t.row[1]],column:[t.column[1]+1,s]},{row:[t.row[1]+1,c],column:[d,s]}]:"operatePart"==l&&(n=[{row:[r+i,t.row[1]+i],column:[d+a,t.column[1]+a]}]):r>=t.row[0]&&r<=t.row[1]&&s>=t.column[0]&&s<=t.column[1]?"allPart"==l?n=[{row:[r,t.row[1]],column:[d,t.column[0]-1]},{row:[t.row[1]+1,c],column:[d,s]},{row:[r+i,t.row[1]+i],column:[t.column[0]+a,s+a]}]:"restPart"==l?n=[{row:[r,t.row[1]],column:[d,t.column[0]-1]},{row:[t.row[1]+1,c],column:[d,s]}]:"operatePart"==l&&(n=[{row:[r+i,t.row[1]+i],column:[t.column[0]+a,s+a]}]):c>=t.row[0]&&c<=t.row[1]&&d>=t.column[0]&&d<=t.column[1]?"allPart"==l?n=[{row:[r,t.row[0]-1],column:[d,s]},{row:[t.row[0],c],column:[t.column[1]+1,s]},{row:[t.row[0]+i,c+i],column:[d+a,t.column[1]+a]}]:"restPart"==l?n=[{row:[r,t.row[0]-1],column:[d,s]},{row:[t.row[0],c],column:[t.column[1]+1,s]}]:"operatePart"==l&&(n=[{row:[t.row[0]+i,c+i],column:[d+a,t.column[1]+a]}]):c>=t.row[0]&&c<=t.row[1]&&s>=t.column[0]&&s<=t.column[1]?"allPart"==l?n=[{row:[r,t.row[0]-1],column:[d,s]},{row:[t.row[0],c],column:[d,t.column[0]-1]},{row:[t.row[0]+i,c+i],column:[t.column[0]+a,s+a]}]:"restPart"==l?n=[{row:[r,t.row[0]-1],column:[d,s]},{row:[t.row[0],c],column:[d,t.column[0]-1]}]:"operatePart"==l&&(n=[{row:[t.row[0]+i,c+i],column:[t.column[0]+a,s+a]}]):r<t.row[0]&&c>t.row[1]&&d>=t.column[0]&&d<=t.column[1]?"allPart"==l?n=[{row:[r,t.row[0]-1],column:[d,s]},{row:[t.row[0],t.row[1]],column:[t.column[1]+1,s]},{row:[t.row[1]+1,c],column:[d,s]},{row:[t.row[0]+i,t.row[1]+i],column:[d+a,t.column[1]+a]}]:"restPart"==l?n=[{row:[r,t.row[0]-1],column:[d,s]},{row:[t.row[0],t.row[1]],column:[t.column[1]+1,s]},{row:[t.row[1]+1,c],column:[d,s]}]:"operatePart"==l&&(n=[{row:[t.row[0]+i,t.row[1]+i],column:[d+a,t.column[1]+a]}]):r<t.row[0]&&c>t.row[1]&&s>=t.column[0]&&s<=t.column[1]?"allPart"==l?n=[{row:[r,t.row[0]-1],column:[d,s]},{row:[t.row[0],t.row[1]],column:[d,t.column[0]-1]},{row:[t.row[1]+1,c],column:[d,s]},{row:[t.row[0]+i,t.row[1]+i],column:[t.column[0]+a,s+a]}]:"restPart"==l?n=[{row:[r,t.row[0]-1],column:[d,s]},{row:[t.row[0],t.row[1]],column:[d,t.column[0]-1]},{row:[t.row[1]+1,c],column:[d,s]}]:"operatePart"==l&&(n=[{row:[t.row[0]+i,t.row[1]+i],column:[t.column[0]+a,s+a]}]):d<t.column[0]&&s>t.column[1]&&r>=t.row[0]&&r<=t.row[1]?"allPart"==l?n=[{row:[r,t.row[1]],column:[d,t.column[0]-1]},{row:[r,t.row[1]],column:[t.column[1]+1,s]},{row:[t.row[1]+1,c],column:[d,s]},{row:[r+i,t.row[1]+i],column:[t.column[0]+a,t.column[1]+a]}]:"restPart"==l?n=[{row:[r,t.row[1]],column:[d,t.column[0]-1]},{row:[r,t.row[1]],column:[t.column[1]+1,s]},{row:[t.row[1]+1,c],column:[d,s]}]:"operatePart"==l&&(n=[{row:[r+i,t.row[1]+i],column:[t.column[0]+a,t.column[1]+a]}]):d<t.column[0]&&s>t.column[1]&&c>=t.row[0]&&c<=t.row[1]?"allPart"==l?n=[{row:[r,t.row[0]-1],column:[d,s]},{row:[t.row[0],c],column:[d,t.column[0]-1]},{row:[t.row[0],c],column:[t.column[1]+1,s]},{row:[t.row[0]+i,c+i],column:[t.column[0]+a,t.column[1]+a]}]:"restPart"==l?n=[{row:[r,t.row[0]-1],column:[d,s]},{row:[t.row[0],c],column:[d,t.column[0]-1]},{row:[t.row[0],c],column:[t.column[1]+1,s]}]:"operatePart"==l&&(n=[{row:[t.row[0]+i,c+i],column:[t.column[0]+a,t.column[1]+a]}]):r<t.row[0]&&c>t.row[1]&&d<t.column[0]&&s>t.column[1]?"allPart"==l?n=[{row:[r,t.row[0]-1],column:[d,s]},{row:[t.row[0],t.row[1]],column:[d,t.column[0]-1]},{row:[t.row[0],t.row[1]],column:[t.column[1]+1,s]},{row:[t.row[1]+1,c],column:[d,s]},{row:[t.row[0]+i,t.row[1]+i],column:[t.column[0]+a,t.column[1]+a]}]:"restPart"==l?n=[{row:[r,t.row[0]-1],column:[d,s]},{row:[t.row[0],t.row[1]],column:[d,t.column[0]-1]},{row:[t.row[0],t.row[1]],column:[t.column[1]+1,s]},{row:[t.row[1]+1,c],column:[d,s]}]:"operatePart"==l&&(n=[{row:[t.row[0]+i,t.row[1]+i],column:[t.column[0]+a,t.column[1]+a]}]):"allPart"==l?n=[{row:[r,c],column:[d,s]}]:"restPart"==l?n=[{row:[r,c],column:[d,s]}]:"operatePart"==l&&(n=[]),n},getcolorGradation:function(e,t,o,l,n){let i=e.split(","),a=parseInt(i[0].split("(")[1]),r=parseInt(i[1]),c=parseInt(i[2].split(")")[0]),d=t.split(","),s=parseInt(d[0].split("(")[1]),u=parseInt(d[1]),f=parseInt(d[2].split(")")[0]);return"rgb("+Math.round(a-(a-s)/(o-l)*(o-n))+", "+Math.round(r-(r-u)/(o-l)*(o-n))+", "+Math.round(c-(c-f)/(o-l)*(o-n))+")"},getCFPartRange:function(e,t,o){let l=[],n=m.luckysheetfile[p(e)].luckysheet_conditionformat_save;if(null!=n&&n.length>0)e:for(let e=0;e<n.length;e++){let t=n[e].cellrange;for(let o=0;o<t.length;o++){let i=t[o].row[0],a=t[o].row[1],r=t[o].column[0],c=t[o].column[1];for(let t=0;t<range.length;t++)if(range[t].row[0]>=i&&range[t].row[0]<=a||range[t].row[1]>=i&&range[t].row[1]<=a||range[t].column[0]>=r&&range[t].column[0]<=c||range[t].column[1]>=r&&range[t].column[1]<=c){l.push(n[e]);continue e}}}return l},checksCF:function(e,t,o){return null!=o&&e+"_"+t in o?o[e+"_"+t]:null},getComputeMap:function(e){let t=p(m.currentSheetIndex);null!=e&&(t=p(e));let o=m.luckysheetfile[t].luckysheet_conditionformat_save,l=m.luckysheetfile[t].data;return null==l?null:this.compute(o,l)},compute:function(e,t){let l=this;null==e&&(e=[]);let n={};if(e.length>0)for(let i=0;i<e.length;i++){let a=e[i].type,r=e[i].cellrange,c=e[i].format;if("dataBar"==a){let e=null,o=null;for(let l=0;l<r.length;l++)for(let n=r[l].row[0];n<=r[l].row[1];n++)for(let i=r[l].column[0];i<=r[l].column[1];i++){if(null==t[n]||null==t[n][i])continue;let l=t[n][i];"object"==w(l)&&null!=l.ct&&"n"==l.ct.t&&null!=l.v&&((null==e||parseInt(l.v)>e)&&(e=parseInt(l.v)),(null==o||parseInt(l.v)<o)&&(o=parseInt(l.v)))}if(null!=e&&null!=o)if(o<0){let l=Math.round(e/(e-o)*10)/10,i=Math.round(Math.abs(o)/(e-o)*10)/10;for(let a=0;a<r.length;a++)for(let d=r[a].row[0];d<=r[a].row[1];d++)for(let s=r[a].column[0];s<=r[a].column[1];s++){if(null==t[d]||null==t[d][s])continue;let a=t[d][s];if("object"==w(a)&&null!=a.ct&&"n"==a.ct.t&&null!=a.v){if(parseInt(a.v)<0){let e=Math.round(Math.abs(parseInt(a.v))/Math.abs(o)*100)/100;d+"_"+s in n?n[d+"_"+s].dataBar={valueType:"minus",minusLen:i,valueLen:e,format:c}:n[d+"_"+s]={dataBar:{valueType:"minus",minusLen:i,valueLen:e,format:c}}}if(parseInt(a.v)>0){let t=Math.round(parseInt(a.v)/e*100)/100;d+"_"+s in n?n[d+"_"+s].dataBar={valueType:"plus",plusLen:l,minusLen:i,valueLen:t,format:c}:n[d+"_"+s]={dataBar:{valueType:"plus",plusLen:l,minusLen:i,valueLen:t,format:c}}}}}}else{let o=1;for(let l=0;l<r.length;l++)for(let i=r[l].row[0];i<=r[l].row[1];i++)for(let a=r[l].column[0];a<=r[l].column[1];a++){if(null==t[i]||null==t[i][a])continue;let l=t[i][a];if("object"==w(l)&&null!=l.ct&&"n"==l.ct.t&&null!=l.v){let t;t=0==e?1:Math.round(parseInt(l.v)/e*100)/100,i+"_"+a in n?n[i+"_"+a].dataBar={valueType:"plus",plusLen:o,valueLen:t,format:c}:n[i+"_"+a]={dataBar:{valueType:"plus",plusLen:o,valueLen:t,format:c}}}}}}else if("colorGradation"==a){let e=null,o=null,i=0,a=0;for(let l=0;l<r.length;l++)for(let n=r[l].row[0];n<=r[l].row[1];n++)for(let c=r[l].column[0];c<=r[l].column[1];c++){if(null==t[n]||null==t[n][c])continue;let l=t[n][c];"object"==w(l)&&null!=l.ct&&"n"==l.ct.t&&null!=l.v&&(a++,i+=parseInt(l.v),(null==e||parseInt(l.v)>e)&&(e=parseInt(l.v)),(null==o||parseInt(l.v)<o)&&(o=parseInt(l.v)))}if(null!=e&&null!=o)if(3==c.length){let d=Math.floor(i/a);for(let i=0;i<r.length;i++)for(let a=r[i].row[0];a<=r[i].row[1];a++)for(let s=r[i].column[0];s<=r[i].column[1];s++){if(null==t[a]||null==t[a][s])continue;let i=t[a][s];"object"==w(i)&&null!=i.ct&&"n"==i.ct.t&&null!=i.v&&(parseInt(i.v)==o?a+"_"+s in n?n[a+"_"+s].cellColor=c[2]:n[a+"_"+s]={cellColor:c[2]}:parseInt(i.v)>o&&parseInt(i.v)<d?a+"_"+s in n?n[a+"_"+s].cellColor=l.getcolorGradation(c[2],c[1],o,d,parseInt(i.v)):n[a+"_"+s]={cellColor:l.getcolorGradation(c[2],c[1],o,d,parseInt(i.v))}:parseInt(i.v)==d?a+"_"+s in n?n[a+"_"+s].cellColor=c[1]:n[a+"_"+s]={cellColor:c[1]}:parseInt(i.v)>d&&parseInt(i.v)<e?a+"_"+s in n?n[a+"_"+s].cellColor=l.getcolorGradation(c[1],c[0],d,e,parseInt(i.v)):n[a+"_"+s]={cellColor:l.getcolorGradation(c[1],c[0],d,e,parseInt(i.v))}:parseInt(i.v)==e&&(a+"_"+s in n?n[a+"_"+s].cellColor=c[0]:n[a+"_"+s]={cellColor:c[0]}))}}else if(2==c.length)for(let i=0;i<r.length;i++)for(let a=r[i].row[0];a<=r[i].row[1];a++)for(let d=r[i].column[0];d<=r[i].column[1];d++){if(null==t[a]||null==t[a][d])continue;let i=t[a][d];"object"==w(i)&&null!=i.ct&&"n"==i.ct.t&&null!=i.v&&(parseInt(i.v)==o?a+"_"+d in n?n[a+"_"+d].cellColor=c[1]:n[a+"_"+d]={cellColor:c[1]}:parseInt(i.v)>o&&parseInt(i.v)<e?a+"_"+d in n?n[a+"_"+d].cellColor=l.getcolorGradation(c[1],c[0],o,e,parseInt(i.v)):n[a+"_"+d]={cellColor:l.getcolorGradation(c[1],c[0],o,e,parseInt(i.v))}:parseInt(i.v)==e&&(a+"_"+d in n?n[a+"_"+d].cellColor=c[0]:n[a+"_"+d]={cellColor:c[0]}))}}else if("icons"==a){let e=parseInt(c.len),o=parseInt(c.leftMin),l=parseInt(c.top),i=null,a=null;for(let e=0;e<r.length;e++)for(let o=r[e].row[0];o<=r[e].row[1];o++)for(let l=r[e].column[0];l<=r[e].column[1];l++){if(null==t[o]||null==t[o][l])continue;let e=t[o][l];"object"==w(e)&&null!=e.ct&&"n"==e.ct.t&&null!=e.v&&((null==i||parseInt(e.v)>i)&&(i=parseInt(e.v)),(null==a||parseInt(e.v)<a)&&(a=parseInt(e.v)))}if(null!=i&&null!=a){let c=Math.floor((i-a+1)/e),d=(i-a+1)%e;if(3==e){let e,s,u;2==d?(e=[a,a+c],s=[a+c+1,a+2*c],u=[a+2*c+1,i]):(e=[a,a+c-1],s=[a+c,a+2*c-1],u=[a+2*c,i]);for(let i=0;i<r.length;i++)for(let a=r[i].row[0];a<=r[i].row[1];a++)for(let c=r[i].column[0];c<=r[i].column[1];c++){if(null==t[a]||null==t[a][c])continue;let i=t[a][c];"object"==w(i)&&null!=i.ct&&"n"==i.ct.t&&null!=i.v&&(parseInt(i.v)>=e[0]&&parseInt(i.v)<=e[1]?a+"_"+c in n?n[a+"_"+c].icons={left:o+2,top:l}:n[a+"_"+c]={icons:{left:o+2,top:l}}:parseInt(i.v)>=s[0]&&parseInt(i.v)<=s[1]?a+"_"+c in n?n[a+"_"+c].icons={left:o+1,top:l}:n[a+"_"+c]={icons:{left:o+1,top:l}}:parseInt(i.v)>=u[0]&&parseInt(i.v)<=u[1]&&(a+"_"+c in n?n[a+"_"+c].icons={left:o,top:l}:n[a+"_"+c]={icons:{left:o,top:l}}))}}else if(4==e){let e,s,u,f;2==d?(e=[a,a+c],s=[a+c+1,a+2*c],u=[a+2*c+1,a+3*c],f=[a+3*c+1,i]):3==d?(e=[a,a+c],s=[a+c+1,a+2*c],u=[a+2*c+1,a+3*c+1],f=[a+3*c+2,i]):(e=[a,a+c-1],s=[a+c,a+2*c-1],u=[a+2*c,a+3*c-1],f=[a+3*c,i]);for(let i=0;i<r.length;i++)for(let a=r[i].row[0];a<=r[i].row[1];a++)for(let c=r[i].column[0];c<=r[i].column[1];c++){if(null==t[a]||null==t[a][c])continue;let i=t[a][c];"object"==w(i)&&null!=i.ct&&"n"==i.ct.t&&null!=i.v&&(parseInt(i.v)>=e[0]&&parseInt(i.v)<=e[1]?a+"_"+c in n?n[a+"_"+c].icons={left:o+3,top:l}:n[a+"_"+c]={icons:{left:o+3,top:l}}:parseInt(i.v)>=s[0]&&parseInt(i.v)<=s[1]?a+"_"+c in n?n[a+"_"+c].icons={left:o+2,top:l}:n[a+"_"+c]={icons:{left:o+2,top:l}}:parseInt(i.v)>=u[0]&&parseInt(i.v)<=u[1]?a+"_"+c in n?n[a+"_"+c].icons={left:o+1,top:l}:n[a+"_"+c]={icons:{left:o+1,top:l}}:parseInt(i.v)>=f[0]&&parseInt(i.v)<=f[1]&&(a+"_"+c in n?n[a+"_"+c].icons={left:o,top:l}:n[a+"_"+c]={icons:{left:o,top:l}}))}}else if(5==e){let e,s,u,f,h;2==d?(e=[a,a+c],s=[a+c+1,a+2*c],u=[a+2*c+1,a+3*c],f=[a+3*c+1,a+4*c],h=[a+4*c+1,i]):3==d?(e=[a,a+c],s=[a+c+1,a+2*c],u=[a+2*c+1,a+3*c+1],f=[a+3*c+2,a+4*c+1],h=[a+4*c+2,i]):4==d?(e=[a,a+c],s=[a+c+1,a+2*c+1],u=[a+2*c+2,a+3*c+1],f=[a+3*c+2,a+4*c+2],h=[a+4*c+3,i]):(e=[a,a+c-1],s=[a+c,a+2*c-1],u=[a+2*c,a+3*c-1],f=[a+3*c,a+4*c-1],h=[a+4*c,i]);for(let i=0;i<r.length;i++)for(let a=r[i].row[0];a<=r[i].row[1];a++)for(let c=r[i].column[0];c<=r[i].column[1];c++){if(null==t[a]||null==t[a][c])continue;let i=t[a][c];"object"==w(i)&&null!=i.ct&&"n"==i.ct.t&&null!=i.v&&(parseInt(i.v)>=e[0]&&parseInt(i.v)<=e[1]?a+"_"+c in n?n[a+"_"+c].icons={left:o+4,top:l}:n[a+"_"+c]={icons:{left:o+4,top:l}}:parseInt(i.v)>=s[0]&&parseInt(i.v)<=s[1]?a+"_"+c in n?n[a+"_"+c].icons={left:o+3,top:l}:n[a+"_"+c]={icons:{left:o+3,top:l}}:parseInt(i.v)>=u[0]&&parseInt(i.v)<=u[1]?a+"_"+c in n?n[a+"_"+c].icons={left:o+2,top:l}:n[a+"_"+c]={icons:{left:o+2,top:l}}:parseInt(i.v)>=f[0]&&parseInt(i.v)<=f[1]?a+"_"+c in n?n[a+"_"+c].icons={left:o+1,top:l}:n[a+"_"+c]={icons:{left:o+1,top:l}}:parseInt(i.v)>=h[0]&&parseInt(i.v)<=h[1]&&(a+"_"+c in n?n[a+"_"+c].icons={left:o,top:l}:n[a+"_"+c]={icons:{left:o,top:l}}))}}}}else{let l=e[i].conditionName,a=e[i].conditionValue[0],d=e[i].conditionValue[1],s=c.textColor,u=c.cellColor;for(let e=0;e<r.length;e++)if("greaterThan"==l||"lessThan"==l||"equal"==l||"textContains"==l)for(let o=r[e].row[0];o<=r[e].row[1];o++)for(let i=r[e].column[0];i<=r[e].column[1];i++){if(null==t[o]||null==t[o][i])continue;let e=t[o][i];"object"!=w(e)||C(e.v)||("greaterThan"==l&&e.v>a?o+"_"+i in n?(n[o+"_"+i].textColor=s,n[o+"_"+i].cellColor=u):n[o+"_"+i]={textColor:s,cellColor:u}:"lessThan"==l&&e.v<a?o+"_"+i in n?(n[o+"_"+i].textColor=s,n[o+"_"+i].cellColor=u):n[o+"_"+i]={textColor:s,cellColor:u}:"equal"==l&&e.v==a?o+"_"+i in n?(n[o+"_"+i].textColor=s,n[o+"_"+i].cellColor=u):n[o+"_"+i]={textColor:s,cellColor:u}:"textContains"==l&&-1!=e.v.toString().indexOf(a)&&(o+"_"+i in n?(n[o+"_"+i].textColor=s,n[o+"_"+i].cellColor=u):n[o+"_"+i]={textColor:s,cellColor:u}))}else if("betweenness"==l){let o,l;a>d?(o=a,l=d):(o=d,l=a);for(let i=r[e].row[0];i<=r[e].row[1];i++)for(let a=r[e].column[0];a<=r[e].column[1];a++){if(null==t[i]||null==t[i][a])continue;let e=t[i][a];"object"!=w(e)||C(e.v)||e.v>=l&&e.v<=o&&(i+"_"+a in n?(n[i+"_"+a].textColor=s,n[i+"_"+a].cellColor=u):n[i+"_"+a]={textColor:s,cellColor:u})}}else if("occurrenceDate"==l){let o,l;if(-1==a.toString().indexOf("-"))o=_(a)[2],l=_(a)[2];else{let e=a.toString().split("-");o=_(e[1].trim())[2],l=_(e[0].trim())[2]}for(let i=r[e].row[0];i<=r[e].row[1];i++)for(let a=r[e].column[0];a<=r[e].column[1];a++)if(null!=t[i]&&null!=t[i][a]&&null!=t[i][a].ct&&"d"==t[i][a].ct.t){let e=R(i,a,t);e>=l&&e<=o&&(i+"_"+a in n?(n[i+"_"+a].textColor=s,n[i+"_"+a].cellColor=u):n[i+"_"+a]={textColor:s,cellColor:u})}}else if("duplicateValue"==l){let o={};for(let l=r[e].row[0];l<=r[e].row[1];l++)for(let n=r[e].column[0];n<=r[e].column[1];n++){let e=R(l,n,t);e in o||(o[e]=[]),o[e].push({r:l,c:n})}if("0"==a)for(let e in o)if("null"!=e&&"undefined"!=e&&o[e].length>1)for(let t=0;t<o[e].length;t++)o[e][t].r+"_"+o[e][t].c in n?(n[o[e][t].r+"_"+o[e][t].c].textColor=s,n[o[e][t].r+"_"+o[e][t].c].cellColor=u):n[o[e][t].r+"_"+o[e][t].c]={textColor:s,cellColor:u};if("1"==a)for(let e in o)"null"!=e&&"undefined"!=e&&1==o[e].length&&(o[e][0].r+"_"+o[e][0].c in n?(n[o[e][0].r+"_"+o[e][0].c].textColor=s,n[o[e][0].r+"_"+o[e][0].c].cellColor=u):n[o[e][0].r+"_"+o[e][0].c]={textColor:s,cellColor:u})}else if("top10"==l||"top10%"==l||"last10"==l||"last10%"==l||"AboveAverage"==l||"SubAverage"==l){let o=[];for(let l=r[e].row[0];l<=r[e].row[1];l++)for(let n=r[e].column[0];n<=r[e].column[1];n++)null!=t[l]&&null!=t[l][n]&&null!=t[l][n].ct&&"n"==t[l][n].ct.t&&o.push(R(l,n,t));if("top10"==l||"top10%"==l||"last10"==l||"last10%"==l){for(let e=0;e<o.length;e++)for(let t=0;t<o.length-1-e;t++)if(o[t]<o[t+1]){let e=o[t];o[t]=o[t+1],o[t+1]=e}let i;"top10"==l?i=o.slice(0,a):"top10%"==l?i=o.slice(0,Math.floor(a*o.length/100)):"last10"==l?i=o.slice(o.length-a,o.length):"last10%"==l&&(i=o.slice(o.length-Math.floor(a*o.length/100),o.length));for(let o=r[e].row[0];o<=r[e].row[1];o++)for(let l=r[e].column[0];l<=r[e].column[1];l++){if(null==t[o]||null==t[o][l])continue;let e=R(o,l,t);-1!=i.indexOf(e)&&(o+"_"+l in n?(n[o+"_"+l].textColor=s,n[o+"_"+l].cellColor=u):n[o+"_"+l]={textColor:s,cellColor:u})}}else if("AboveAverage"==l||"SubAverage"==l){let i=0;for(let e=0;e<o.length;e++)i+=o[e];let a=i/o.length;if("AboveAverage"==l)for(let o=r[e].row[0];o<=r[e].row[1];o++)for(let l=r[e].column[0];l<=r[e].column[1];l++){if(null==t[o]||null==t[o][l])continue;R(o,l,t)>a&&(o+"_"+l in n?(n[o+"_"+l].textColor=s,n[o+"_"+l].cellColor=u):n[o+"_"+l]={textColor:s,cellColor:u})}else if("SubAverage"==l)for(let o=r[e].row[0];o<=r[e].row[1];o++)for(let l=r[e].column[0];l<=r[e].column[1];l++){if(null==t[o]||null==t[o][l])continue;R(o,l,t)<a&&(o+"_"+l in n?(n[o+"_"+l].textColor=s,n[o+"_"+l].cellColor=u):n[o+"_"+l]={textColor:s,cellColor:u})}}}else if("formula"==l){let t=r[e].row[0],l=r[e].row[1],i=r[e].column[0],c=r[e].column[1],d=a;"="!=a.toString().slice(0,1)&&(d="="+a);for(let e=t;e<=l;e++)for(let l=i;l<=c;l++){let a=d,r=e-t,c=l-i;r>0&&(a="="+o.functionCopy(a,"down",r)),c>0&&(a="="+o.functionCopy(a,"right",c));let f=o.execfunction(a)[1];"boolean"!=typeof f&&(f=!!Number(f)),f&&(e+"_"+l in n?(n[e+"_"+l].textColor=s,n[e+"_"+l].cellColor=u):n[e+"_"+l]={textColor:s,cellColor:u})}}}}return n},updateItem:function(e,t,o){if(!T(m.currentSheetIndex))return;let l,n=p(m.currentSheetIndex),i=$.extend(!0,[],m.luckysheetfile),a=this.getHistoryRules(i);if("delSheet"==e)l=[];else{let i={type:e,cellrange:t,format:o};(l=null==m.luckysheetfile[n].luckysheet_conditionformat_save?[]:m.luckysheetfile[n].luckysheet_conditionformat_save).push(i)}m.luckysheetfile[n].luckysheet_conditionformat_save=l;let r=$.extend(!0,[],m.luckysheetfile),c=this.getCurrentRules(r);this.ref(a,c),d.allowUpdate&&d.saveParam("all",m.currentSheetIndex,l,{k:"luckysheet_conditionformat_save"})},getHistoryRules:function(e){let t=[];for(let o=0;o<e.length;o++)t.push({sheetIndex:e[o].index,luckysheet_conditionformat_save:e[o].luckysheet_conditionformat_save});return t},getCurrentRules:function(e){let t=[];for(let o=0;o<e.length;o++)t.push({sheetIndex:e[o].index,luckysheet_conditionformat_save:e[o].luckysheet_conditionformat_save});return t},ref:function(e,t){if(m.clearjfundo){m.jfundo.length=0;let o={type:"updateCF"};o.data={historyRules:e,currentRules:t},m.jfredo.push(o)}setTimeout(function(){b()},1)}}});
//# sourceMappingURL=../sourcemaps/controllers/conditionformat.js.map
