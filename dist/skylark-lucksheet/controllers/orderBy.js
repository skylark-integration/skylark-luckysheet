/**
 * skylark-lucksheet - A version of lucksheet.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["./constant","./select","./protection","../utils/util","../global/getRowlen","../global/validate","../global/cleargridelement","../global/refresh","../global/getdata","../global/sort","../global/tooltip","../global/editor","../global/datecontroll","../store","../locale/locale"],function(e,t,o,l,a,s,c,n,r,i,d,u,h,p,y){"use strict";const{modelHTML:k}=e,{selectHightlightShow:g}=t,{checkProtectionAuthorityNormal:m}=o,{replaceHtml:f,chatatABC:v}=l,{rowlenByRange:b}=a,{isEditMode:w}=s,{jfrefreshgrid:_}=n,{getcellvalue:x}=r,{orderbydata:T,sortColumnSeletion:R}=i,{isdatatype:A}=h;return{orderByInitial:function(){const e=y();$("#luckysheetorderbyasc, #luckysheetorderbyasc_t").mousedown(function(e){c(e),R(p.orderbyindex,!0),g()}),$("#luckysheetorderbydesc, #luckysheetorderbydesc_t").click(function(e){c(e),R(p.orderbyindex,!1),g()});let t=!0;$("#luckysheetorderby").click(function(){if(!m(p.currentSheetIndex,"sort"))return;$("body .luckysheet-cols-menu").hide();const o=e.sort;if(p.luckysheet_select_save.length>1)return void(w()?alert(o.noRangeError):d.info(o.noRangeError,""));let l=p.luckysheet_select_save[0],a=l.row[0],s=l.row[1],c=l.column[0],n=l.column[1];if(t){t=!1;let l=`<div style="overflow: hidden;" class="luckysheet-sort-modal"><div><label><input type="checkbox" id="luckysheet-sort-haveheader"/><span>${o.hasTitle}</span></label></div><div style="overflow-y:auto;" id="luckysheet-sort-dialog-tablec"><table data-itemcount="0" cellspacing="0"> <tr><td>${o.hasTitle} <select name="sort_0"> <option value="1">1</option> <option value="2">2</option> <option value="3">3</option> <option value="4">4</option> </select> </td> <td> <div><label><input value="asc" type="radio" checked="checked" name="sort_0"><span>${o.asc}A-Z</span></label></div> <div><label><input value="desc" type="radio" name="sort_0"><span>${o.desc}Z-A</span></label></div></td></tr></table></div><div style="background: #e5e5e5;border-top: 1px solid #f5f5f5; height: 1px; width: 100%;margin:2px 0px;margin-bottom:10px;"></div> <div> <span style="font-weight: bold; text-decoration: underline;text-align:center;color: blue;cursor: pointer;" class="luckysheet-sort-dialog-additem">+ ${o.addOthers}</span> </div> </div>`;$("body").append(f(k,{id:"luckysheet-sort-dialog",addclass:"",title:e.sort.sortTitle,content:l,botton:`<button id="luckysheet-sort-modal-confirm" class="btn btn-primary">${o.confirm}</button><button class="btn btn-default luckysheet-model-close-btn">${o.close}</button>`})),$("#luckysheet-sort-dialog .luckysheet-sort-dialog-additem").click(function(){let e=p.luckysheet_select_save[0],t=e.row[0],l=(e.row[1],e.column[0]),a=e.column[1],s="",c=$("#luckysheet-sort-dialog table").data("itemcount")+1,n=$("#luckysheet-sort-haveheader").is(":checked");for(let e=l;e<=a;e++)if(n){let a=x(t,e,p.flowdata,"m");null==a&&(a=o.columnOperation+(e-l+1)),s+='<option value="'+e+'">'+a+"</option>"}else s+='<option value="'+e+'">'+v(e)+"</option>";$("#luckysheet-sort-dialog table").append(`\n                    <tr class="luckysheet-sort-dialog-tr">\n                        <td><span class="luckysheet-sort-item-close" onclick="$(this).parent().parent().remove();"><i class="fa fa-times"\n                                    aria-hidden="true"></i></span>${o.secondaryTitle} <select\n                                name="sort_${c}">${s}</select> </td>\n                        <td>\n                            <div><label><input value="asc" type="radio" checked="checked"\n                                        name="sort_${c}"><span>${o.asc}A-Z</span></label></div>\n                            <div><label><input value="desc" type="radio" name="sort_${c}"><span>${o.desc}Z-A</span></label>\n                            </div>\n                        </td>\n                    </tr>\n                `),$("#luckysheet-sort-dialog table").data("itemcount",c)}),$("#luckysheet-sort-haveheader").change(function(){let e=p.luckysheet_select_save[0],t=e.row[0],l=(e.row[1],e.column[0]),a=e.column[1],s=$(this).is(":checked"),c="";for(let e=l;e<=a;e++)if(s){let a=x(t,e,p.flowdata,"m");null==a&&(a=o.columnOperation+(e-l+1)),c+='<option value="'+e+'">'+a+"</option>"}else c+='<option value="'+e+'">'+v(e)+"</option>";$("#luckysheet-sort-dialog tr select").each(function(){$(this).html(c)})}),$("#luckysheet-sort-modal-confirm").click(function(){if(p.luckysheet_select_save.length>1)return void(w()?alert(o.noRangeError):d.info(o.noRangeError,""));let e,t=u.deepCopyFlowData(p.flowdata),l=p.luckysheet_select_save[0],a=l.row[0],s=l.row[1],c=l.column[0],n=l.column[1],r=!1,i=[];for(let o=e=$("#luckysheet-sort-haveheader").is(":checked")?a+1:a;o<=s;o++){let e=[];for(let l=c;l<=n;l++){if(null!=t[o][l]&&null!=t[o][l].mc){r=!0;break}e.push(t[o][l])}i.push(e)}if(r)return void(w()?alert(o.mergeError):d.info(o.mergeError,""));$($("#luckysheet-sort-dialog table tr").toArray().reverse()).each(function(){let e=$(this).find("select").val(),t=$(this).find("input:radio:checked").val();e-=c,t="asc"==t,i=T([].concat(i),e,t)});for(let o=e;o<=s;o++)for(let l=c;l<=n;l++)t[o][l]=i[o-e][l-c];let h={};if(null!=p.config.rowlen){let o=$.extend(!0,{},p.config);h={cfg:o=b(t,e,s,o),RowlChange:!0}}_(t,[{row:[e,s],column:[c,n]}],h),$("#luckysheet-sort-dialog").hide(),$("#luckysheet-modal-dialog-mask").hide()})}let r="";for(let e=c;e<=n;e++)r+='<option value="'+e+'">'+v(e)+"</option>";$("#luckysheet-sort-dialog select").html(r),$("#luckysheet-sort-dialog .luckysheet-sort-dialog-tr").remove(),$("#luckysheet-sort-haveheader").prop("checked",!1),$("#luckysheet-sort-dialog input:radio:first").prop("checked","checked"),$("#luckysheet-sort-dialog .luckysheet-modal-dialog-title-text").html(o.sortRangeTitle+"<span>"+v(c)+(a+1)+"</span>"+o.sortRangeTitleTo+"<span>"+v(n)+(s+1)+"</span>");let i=$("#luckysheet-sort-dialog"),h=i.outerHeight(),y=i.outerWidth(),g=$(window).width(),R=$(window).height(),E=$(document).scrollLeft(),C=$(document).scrollTop();$("#luckysheet-sort-dialog-tablec").css("max-height",(R-h)/2),$("#luckysheet-sort-dialog").css({left:(g+E-y)/2,top:(R+C-h)/2}).show(),$("#luckysheet-modal-dialog-mask").show(),a<s&&setTimeout(function(){let e=p.flowdata[a],t=p.flowdata[a+1],o=!1;for(let l=c;l<=n;l++)A(e[l])!=A(t[l])&&(o=!0);o&&$("#luckysheet-sort-haveheader").prop("checked",!0).change()},10)})}}});
//# sourceMappingURL=../sourcemaps/controllers/orderBy.js.map
