/**
 * skylark-lucksheet - A version of lucksheet.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["../widgets/constant","../widgets/select","../methods/protection_methods","../utils/util","../methods/getRowlen","../methods/luckysheetConfigsetting","../widgets/cleargridelement","../methods/getdata","../controllers/sort","../widgets/tooltip","../methods/datecontroll","../store","../locale/locale"],function(e,t,o,l,s,a,n,c,i,r,d,u,h){"use strict";const{modelHTML:p}=e,{selectHightlightShow:y}=t,{checkProtectionAuthorityNormal:k}=o,{replaceHtml:m,chatatABC:g}=l,{rowlenByRange:f}=s,{isEditMode:v}=a,{getcellvalue:b}=c,{orderbydata:w,sortColumnSeletion:_}=i,{isdatatype:x}=d;return{orderByInitial:function(){const e=h();$("#luckysheetorderbyasc, #luckysheetorderbyasc_t").mousedown(function(e){n(e),_(u.orderbyindex,!0),y()}),$("#luckysheetorderbydesc, #luckysheetorderbydesc_t").click(function(e){n(e),_(u.orderbyindex,!1),y()});let t=!0;$("#luckysheetorderby").click(function(){if(!k(u.currentSheetIndex,"sort"))return;$("body .luckysheet-cols-menu").hide();const o=e.sort;if(u.luckysheet_select_save.length>1)return void(v()?alert(o.noRangeError):r.info(o.noRangeError,""));let l=u.luckysheet_select_save[0],s=l.row[0],a=l.row[1],n=l.column[0],c=l.column[1];if(t){t=!1;let l=`<div style="overflow: hidden;" class="luckysheet-sort-modal"><div><label><input type="checkbox" id="luckysheet-sort-haveheader"/><span>${o.hasTitle}</span></label></div><div style="overflow-y:auto;" id="luckysheet-sort-dialog-tablec"><table data-itemcount="0" cellspacing="0"> <tr><td>${o.hasTitle} <select name="sort_0"> <option value="1">1</option> <option value="2">2</option> <option value="3">3</option> <option value="4">4</option> </select> </td> <td> <div><label><input value="asc" type="radio" checked="checked" name="sort_0"><span>${o.asc}A-Z</span></label></div> <div><label><input value="desc" type="radio" name="sort_0"><span>${o.desc}Z-A</span></label></div></td></tr></table></div><div style="background: #e5e5e5;border-top: 1px solid #f5f5f5; height: 1px; width: 100%;margin:2px 0px;margin-bottom:10px;"></div> <div> <span style="font-weight: bold; text-decoration: underline;text-align:center;color: blue;cursor: pointer;" class="luckysheet-sort-dialog-additem">+ ${o.addOthers}</span> </div> </div>`;$("body").append(m(p,{id:"luckysheet-sort-dialog",addclass:"",title:e.sort.sortTitle,content:l,botton:`<button id="luckysheet-sort-modal-confirm" class="btn btn-primary">${o.confirm}</button><button class="btn btn-default luckysheet-model-close-btn">${o.close}</button>`})),$("#luckysheet-sort-dialog .luckysheet-sort-dialog-additem").click(function(){let e=u.luckysheet_select_save[0],t=e.row[0],l=(e.row[1],e.column[0]),s=e.column[1],a="",n=$("#luckysheet-sort-dialog table").data("itemcount")+1,c=$("#luckysheet-sort-haveheader").is(":checked");for(let e=l;e<=s;e++)if(c){let s=b(t,e,u.flowdata,"m");null==s&&(s=o.columnOperation+(e-l+1)),a+='<option value="'+e+'">'+s+"</option>"}else a+='<option value="'+e+'">'+g(e)+"</option>";$("#luckysheet-sort-dialog table").append(`\n                    <tr class="luckysheet-sort-dialog-tr">\n                        <td><span class="luckysheet-sort-item-close" onclick="$(this).parent().parent().remove();"><i class="fa fa-times"\n                                    aria-hidden="true"></i></span>${o.secondaryTitle} <select\n                                name="sort_${n}">${a}</select> </td>\n                        <td>\n                            <div><label><input value="asc" type="radio" checked="checked"\n                                        name="sort_${n}"><span>${o.asc}A-Z</span></label></div>\n                            <div><label><input value="desc" type="radio" name="sort_${n}"><span>${o.desc}Z-A</span></label>\n                            </div>\n                        </td>\n                    </tr>\n                `),$("#luckysheet-sort-dialog table").data("itemcount",n)}),$("#luckysheet-sort-haveheader").change(function(){let e=u.luckysheet_select_save[0],t=e.row[0],l=(e.row[1],e.column[0]),s=e.column[1],a=$(this).is(":checked"),n="";for(let e=l;e<=s;e++)if(a){let s=b(t,e,u.flowdata,"m");null==s&&(s=o.columnOperation+(e-l+1)),n+='<option value="'+e+'">'+s+"</option>"}else n+='<option value="'+e+'">'+g(e)+"</option>";$("#luckysheet-sort-dialog tr select").each(function(){$(this).html(n)})}),$("#luckysheet-sort-modal-confirm").click(function(){if(u.luckysheet_select_save.length>1)return void(v()?alert(o.noRangeError):r.info(o.noRangeError,""));let e,t=u.deepCopyFlowData(u.flowdata),l=u.luckysheet_select_save[0],s=l.row[0],a=l.row[1],n=l.column[0],c=l.column[1],i=!1,d=[];for(let o=e=$("#luckysheet-sort-haveheader").is(":checked")?s+1:s;o<=a;o++){let e=[];for(let l=n;l<=c;l++){if(null!=t[o][l]&&null!=t[o][l].mc){i=!0;break}e.push(t[o][l])}d.push(e)}if(i)return void(v()?alert(o.mergeError):r.info(o.mergeError,""));$($("#luckysheet-sort-dialog table tr").toArray().reverse()).each(function(){let e=$(this).find("select").val(),t=$(this).find("input:radio:checked").val();e-=n,t="asc"==t,d=w([].concat(d),e,t)});for(let o=e;o<=a;o++)for(let l=n;l<=c;l++)t[o][l]=d[o-e][l-n];let h={};if(null!=u.config.rowlen){let o=$.extend(!0,{},u.config);h={cfg:o=f(t,e,a,o),RowlChange:!0}}u.refreshRange(t,[{row:[e,a],column:[n,c]}],h),$("#luckysheet-sort-dialog").hide(),$("#luckysheet-modal-dialog-mask").hide()})}let i="";for(let e=n;e<=c;e++)i+='<option value="'+e+'">'+g(e)+"</option>";$("#luckysheet-sort-dialog select").html(i),$("#luckysheet-sort-dialog .luckysheet-sort-dialog-tr").remove(),$("#luckysheet-sort-haveheader").prop("checked",!1),$("#luckysheet-sort-dialog input:radio:first").prop("checked","checked"),$("#luckysheet-sort-dialog .luckysheet-modal-dialog-title-text").html(o.sortRangeTitle+"<span>"+g(n)+(s+1)+"</span>"+o.sortRangeTitleTo+"<span>"+g(c)+(a+1)+"</span>");let d=$("#luckysheet-sort-dialog"),h=d.outerHeight(),y=d.outerWidth(),_=$(window).width(),R=$(window).height(),T=$(document).scrollLeft(),A=$(document).scrollTop();$("#luckysheet-sort-dialog-tablec").css("max-height",(R-h)/2),$("#luckysheet-sort-dialog").css({left:(_+T-y)/2,top:(R+A-h)/2}).show(),$("#luckysheet-modal-dialog-mask").show(),s<a&&setTimeout(function(){let e=u.flowdata[s],t=u.flowdata[s+1],o=!1;for(let l=n;l<=c;l++)x(e[l])!=x(t[l])&&(o=!0);o&&$("#luckysheet-sort-haveheader").prop("checked",!0).change()},10)})}}});
//# sourceMappingURL=../sourcemaps/controllers/orderBy.js.map
