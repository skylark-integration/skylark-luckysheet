/**
 * skylark-lucksheet - A version of lucksheet.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["./pivotTable","./postil","../widgets/imageCtrl","../methods/cells","../widgets/select","../methods/luckysheetConfigsetting","../utils/util","../methods/get","../methods/location","../methods/validate","../methods/count","./formula","../widgets/extend","../methods/getdata","../widgets/tooltip","../locale/locale","../methods/getRowlen","../methods/sheetSearch","../methods/protection_methods","../store"],function(e,t,l,s,c,o,n,i,u,h,r,a,d,k,y,f,m,g,_,w){"use strict";const{selectHightlightShow:p,luckysheet_count_show:v,selectHelpboxFill:x}=c,{getObjType:b,showrightclickmenu:I,luckysheetContainerFocus:C,luckysheetfontformat:R,$$:S}=n,{getSheetIndex:H,getRangetxt:M}=i,{rowLocation:z,rowLocationByIndex:P,colLocation:T,colLocationByIndex:L,mouseposition:A}=u,{isRealNull:N,isRealNum:W,hasPartMC:j}=h,F=o.isEditMode,{countfunc:G}=r,{luckysheetextendtable:U,luckysheetdeletetable:K,luckysheetDeleteCell:X}=d,{getcellvalue:Y}=k,{getMeasureText:E,getCellTextInfo:O}=m,{luckysheet_searcharray:D}=g,{isInlineStringCell:B}=s,{checkProtectionLockedRangeList:V,checkProtectionAllSelected:q,checkProtectionAuthorityNormal:J}=_;return{rowColumnOperationInitial:function(){$("#luckysheet-rows-h").mousedown(function(e){if(!q(w.currentSheetIndex))return;t.removeActivePs(),($("#luckysheet-modal-dialog-activeImage").is(":visible")||$("#luckysheet-modal-dialog-cropping").is(":visible"))&&l.cancelActiveImgItem();let c=A(e.pageX,e.pageY)[1]+$("#luckysheet-rows-h").scrollTop(),o=z(c),n=o[1],i=o[0],u=o[2],h=w.visibledatacolumn.length-1,r=w.visibledatacolumn[h];if($("#luckysheet-rightclick-menu").hide(),$("#luckysheet-sheet-list, #luckysheet-rightclick-sheet-menu").hide(),"3"==e.which){let e=!1;for(let t=0;t<w.luckysheet_select_save.length;t++){let l=w.luckysheet_select_save[t];if(null!=l.row&&u>=l.row[0]&&u<=l.row[1]&&0==l.column[0]&&l.column[1]==w.flowdata[0].length-1){e=!0;break}}if(e)return}let d=i,k=n-i-1,y=[u,u];w.luckysheet_scroll_status=!0;let f=$("#luckysheet-input-box");if(parseInt(f.css("top"))>0){if(a.rangestart||a.rangedrag_column_start||a.rangedrag_row_start||a.israngeseleciton()||$("#luckysheet-ifFormulaGenerator-multiRange-dialog").is(":visible")){let t=s.mergeMoveMain([0,h],y,{row_focus:u,column_focus:0},d,k,0,r);if(null!=t&&(y=t[1],d=t[2],k=t[3]),e.shiftKey){let e=a.func_selectedrange,t=0,l=0,c=[];e.top>i?(t=i,l=e.top+e.height-i,e.row[1]>e.row_focus&&(e.row[1]=e.row_focus),c=[u,e.row[1]]):e.top==i?(t=i,l=e.top+e.height-i,c=[u,e.row[0]]):(t=e.top,l=n-e.top-1,e.row[0]<e.row_focus&&(e.row[0]=e.row_focus),c=[e.row[0],u]);let o=s.mergeMoveMain([0,h],c,{row_focus:u,column_focus:0},t,l,0,r);null!=o&&(c=o[1],t=o[2],l=o[3]),e.row=c,e.top_move=t,e.height_move=l,a.func_selectedrange=e}else if(e.ctrlKey&&","!=$("#luckysheet-rich-text-editor").find("span").last().text()){let e=$("#luckysheet-rich-text-editor").text()+",";if(e.length>0&&"="==e.substr(0,1)){if(e=a.functionHTMLGenerate(e),window.getSelection){let e=window.getSelection();a.functionRangeIndex=[$(e.anchorNode).parent().index(),e.anchorOffset]}else{let e=document.selection.createRange();a.functionRangeIndex=e}$("#luckysheet-rich-text-editor").html(e),a.canceFunctionrangeSelected(),a.createRangeHightlight()}a.rangestart=!1,a.rangedrag_column_start=!1,a.rangedrag_row_start=!1,$("#luckysheet-functionbox-cell").html(e),a.rangeHightlightselected($("#luckysheet-rich-text-editor")),a.israngeseleciton(),a.func_selectedrange={left:L(0)[0],width:L(0)[1]-L(0)[0]-1,top:d,height:k,left_move:0,width_move:r-0-1,top_move:d,height_move:k,row:y,column:[0,h],row_focus:u,column_focus:0}}else a.func_selectedrange={left:L(0)[0],width:L(0)[1]-L(0)[0]-1,top:d,height:k,left_move:0,width_move:r-0-1,top_move:d,height_move:k,row:y,column:[0,h],row_focus:u,column_focus:0};if(a.rangestart||a.rangedrag_column_start||a.rangedrag_row_start||a.israngeseleciton())a.rangeSetValue({row:y,column:[null,null]});else if($("#luckysheet-ifFormulaGenerator-multiRange-dialog").is(":visible")){let e=M(w.currentSheetIndex,{row:y,column:[0,h]},w.currentSheetIndex);$("#luckysheet-ifFormulaGenerator-multiRange-dialog input").val(e)}return a.rangedrag_row_start=!0,a.rangestart=!1,a.rangedrag_column_start=!1,$("#luckysheet-formula-functionrange-select").css({left:0,width:r-0-1,top:d,height:k}).show(),$("#luckysheet-formula-help-c").hide(),v(0,d,r-0-1,k,y,[0,h]),void setTimeout(function(){let e,t=window.getSelection().anchorNode;$("#luckysheet-search-formula-parm").is(":visible")||$("#luckysheet-search-formula-parm-select").is(":visible")?(e=$("#luckysheet-rich-text-editor"),a.rangechangeindex=a.data_parm_index):e=$(t).closest("div");let l=e.find("span[rangeindex='"+a.rangechangeindex+"']");a.setCaretPosition(l.get(0),0,l.html().length)},1)}a.updatecell(w.luckysheetCellUpdate[0],w.luckysheetCellUpdate[1]),w.luckysheet_rows_selected_status=!0}else w.luckysheet_rows_selected_status=!0;if(w.luckysheet_rows_selected_status){if(e.shiftKey){let e=$.extend(!0,{},w.luckysheet_select_save[w.luckysheet_select_save.length-1]),t=0,l=0,s=[];e.top>i?(t=i,l=e.top+e.height-i,e.row[1]>e.row_focus&&(e.row[1]=e.row_focus),s=[u,e.row[1]]):e.top==i?(t=i,l=e.top+e.height-i,s=[u,e.row[0]]):(t=e.top,l=n-e.top-1,e.row[0]<e.row_focus&&(e.row[0]=e.row_focus),s=[e.row[0],u]),e.row=s,e.top_move=t,e.height_move=l,w.luckysheet_select_save[w.luckysheet_select_save.length-1]=e}else e.ctrlKey?w.luckysheet_select_save.push({left:L(0)[0],width:L(0)[1]-L(0)[0]-1,top:d,height:k,left_move:0,width_move:r-0-1,top_move:d,height_move:k,row:y,column:[0,h],row_focus:u,column_focus:0,row_select:!0}):(w.luckysheet_select_save.length=0,w.luckysheet_select_save.push({left:L(0)[0],width:L(0)[1]-L(0)[0]-1,top:d,height:k,left_move:0,width_move:r-0-1,top_move:d,height_move:k,row:y,column:[0,h],row_focus:u,column_focus:0,row_select:!0}));p(),w.saveParam("mv",w.currentSheetIndex,w.luckysheet_select_save)}x(),setTimeout(function(){clearTimeout(w.countfuncTimeout),G()},101)}).mousemove(function(e){if(w.luckysheet_rows_selected_status||w.luckysheet_rows_change_size||w.luckysheet_select_status)return void $("#luckysheet-rows-h-hover").hide();let t=A(e.pageX,e.pageY)[1]+$("#luckysheet-rows-h").scrollTop(),l=z(t),s=l[1],c=l[0];l[2],$("#luckysheet-rows-h-hover").css({top:c,height:s-c-1,display:"block"}),t<s-1&&t>=s-5?$("#luckysheet-rows-change-size").css({top:s-3,opacity:0}):$("#luckysheet-rows-change-size").css("opacity",0)}).mouseleave(function(e){$("#luckysheet-rows-h-hover").hide(),$("#luckysheet-rows-change-size").css("opacity",0)}).mouseup(function(e){if(3==e.which){if(F())return;$("#luckysheet-cols-rows-shift").hide(),w.luckysheetRightHeadClickIs="row",$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-word").text(f().rightclick.row),$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-size").text(f().rightclick.height),$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-left").text(f().rightclick.top),$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-right").text(f().rightclick.bottom),$("#luckysheet-cols-rows-add").show(),$("#luckysheet-cols-rows-data").show(),$("#luckysheet-cols-rows-shift").hide(),$("#luckysheet-cols-rows-handleincell").hide(),S("#luckysheet-cols-rows-add .luckysheet-menuseparator").style.display="block",S("#luckysheet-cols-rows-data .luckysheet-menuseparator").style.display="block";const t=o.cellRightClickConfig;if(!(t.copy||t.copyAs||t.paste||t.insertRow||t.deleteRow||t.hideRow||t.rowHeight||t.clear||t.matrix||t.sort||t.filter||t.chart||t.image||t.link||t.data||t.cellFormat))return;S("#luckysheet-top-left-add-selected").style.display=t.insertRow?"block":"none",S("#luckysheet-bottom-right-add-selected").style.display=t.insertRow?"block":"none",S("#luckysheet-del-selected").style.display=t.deleteRow?"block":"none",S("#luckysheet-hide-selected").style.display=t.hideRow?"block":"none",S("#luckysheet-show-selected").style.display=t.hideRow?"block":"none",S("#luckysheet-column-row-width-selected").style.display=t.rowHeight?"block":"none",t.copy||t.copyAs||t.paste||(S("#luckysheet-cols-rows-add .luckysheet-menuseparator").style.display="none",t.insertRow||t.deleteRow||t.hideRow||t.rowHeight||(S("#luckysheet-cols-rows-data .luckysheet-menuseparator").style.display="none")),t.insertRow||t.deleteRow||t.hideRow||t.rowHeight||(S("#luckysheet-cols-rows-add .luckysheet-menuseparator").style.display="none"),t.clear||t.matrix||t.sort||t.filter||t.chart||t.image||t.link||t.data||t.cellFormat||(S("#luckysheet-cols-rows-data .luckysheet-menuseparator").style.display="none"),I($("#luckysheet-rightclick-menu"),$(this).offset().left+46,e.pageY),w.luckysheet_cols_menu_status=!0;let l=$.extend(!0,{},w.config);null==l.rowlen&&(l.rowlen={});let s=null==l.rowlen[w.luckysheet_select_save[0].row[0]]?w.defaultrowlen:l.rowlen[w.luckysheet_select_save[0].row[0]],c=!0;for(let e=0;e<w.luckysheet_select_save.length;e++){let t=w.luckysheet_select_save[e],o=t.row[0],n=t.row[1];for(let e=o;e<=n;e++)if((null==l.rowlen[e]?w.defaultrowlen:l.rowlen[e])!=s){c=!1;break}}c?$("#luckysheet-cols-rows-add").find("input[type='number'].rcsize").val(s):$("#luckysheet-cols-rows-add").find("input[type='number'].rcsize").val("")}}),$("#luckysheet-cols-h-c").mousedown(function(e){if(!q(w.currentSheetIndex))return;t.removeActivePs(),($("#luckysheet-modal-dialog-activeImage").is(":visible")||$("#luckysheet-modal-dialog-cropping").is(":visible"))&&l.cancelActiveImgItem();let c=A(e.pageX,e.pageY)[0]+$(this).scrollLeft(),o=w.visibledatarow.length-1,n=w.visibledatarow[o],i=T(c),u=i[1],h=i[0],r=i[2];if(w.orderbyindex=r,$("#luckysheet-rightclick-menu").hide(),$("#luckysheet-sheet-list, #luckysheet-rightclick-sheet-menu").hide(),$("#luckysheet-filter-menu, #luckysheet-filter-submenu").hide(),"3"==e.which){let e=!1;for(let t=0;t<w.luckysheet_select_save.length;t++){let l=w.luckysheet_select_save[t];if(null!=l.column&&r>=l.column[0]&&r<=l.column[1]&&0==l.row[0]&&l.row[1]==w.flowdata.length-1){e=!0;break}}if(e)return}let d=h,k=u-h-1,y=[r,r];w.luckysheet_scroll_status=!0;let f=$("#luckysheet-input-box");if(parseInt(f.css("top"))>0){if(a.rangestart||a.rangedrag_column_start||a.rangedrag_row_start||a.israngeseleciton()||$("#luckysheet-ifFormulaGenerator-multiRange-dialog").is(":visible")){let t=s.mergeMoveMain(y,[0,o],{row_focus:0,column_focus:r},0,n,d,k);if(null!=t&&(y=t[0],d=t[4],k=t[5]),e.shiftKey){let e=a.func_selectedrange,t=0,l=0,c=[];e.left>h?(t=h,l=e.left+e.width-h,e.column[1]>e.column_focus&&(e.column[1]=e.column_focus),c=[r,e.column[1]]):e.left==h?(t=h,l=e.left+e.width-h,c=[r,e.column[0]]):(t=e.left,l=u-e.left-1,e.column[0]<e.column_focus&&(e.column[0]=e.column_focus),c=[e.column[0],r]);let i=s.mergeMoveMain(c,[0,o],{row_focus:0,column_focus:r},0,n,t,l);null!=i&&(c=i[0],t=i[4],l=i[5]),e.column=c,e.left_move=t,e.width_move=l,a.func_selectedrange=e}else if(e.ctrlKey&&","!=$("#luckysheet-rich-text-editor").find("span").last().text()){let e=$("#luckysheet-rich-text-editor").text()+",";if(e.length>0&&"="==e.substr(0,1)){if(e=a.functionHTMLGenerate(e),window.getSelection){let e=window.getSelection();a.functionRangeIndex=[$(e.anchorNode).parent().index(),e.anchorOffset]}else{let e=document.selection.createRange();a.functionRangeIndex=e}$("#luckysheet-rich-text-editor").html(e),a.canceFunctionrangeSelected(),a.createRangeHightlight()}a.rangestart=!1,a.rangedrag_column_start=!1,a.rangedrag_row_start=!1,$("#luckysheet-functionbox-cell").html(e),a.rangeHightlightselected($("#luckysheet-rich-text-editor")),a.israngeseleciton(),a.func_selectedrange={left:d,width:k,top:P(0)[0],height:P(0)[1]-P(0)[0]-1,left_move:d,width_move:k,top_move:0,height_move:n-0-1,row:[0,o],column:y,row_focus:0,column_focus:r}}else a.func_selectedrange={left:d,width:k,top:P(0)[0],height:P(0)[1]-P(0)[0]-1,left_move:d,width_move:k,top_move:0,height_move:n-0-1,row:[0,o],column:y,row_focus:0,column_focus:r};if(a.rangestart||a.rangedrag_column_start||a.rangedrag_row_start||a.israngeseleciton())a.rangeSetValue({row:[null,null],column:y});else if($("#luckysheet-ifFormulaGenerator-multiRange-dialog").is(":visible")){let e=M(w.currentSheetIndex,{row:[0,o],column:y},w.currentSheetIndex);$("#luckysheet-ifFormulaGenerator-multiRange-dialog input").val(e)}return a.rangedrag_column_start=!0,a.rangestart=!1,a.rangedrag_row_start=!1,$("#luckysheet-formula-functionrange-select").css({left:d,width:k,top:0,height:n-0-1}).show(),$("#luckysheet-formula-help-c").hide(),void v(d,0,k,n-0-1,[0,o],y)}a.updatecell(w.luckysheetCellUpdate[0],w.luckysheetCellUpdate[1]),w.luckysheet_cols_selected_status=!0}else w.luckysheet_cols_selected_status=!0;if(w.luckysheet_cols_selected_status){if(e.shiftKey){let e=$.extend(!0,{},w.luckysheet_select_save[w.luckysheet_select_save.length-1]),t=0,l=0,s=[];e.left>h?(t=h,l=e.left+e.width-h,e.column[1]>e.column_focus&&(e.column[1]=e.column_focus),s=[r,e.column[1]]):e.left==h?(t=h,l=e.left+e.width-h,s=[r,e.column[0]]):(t=e.left,l=u-e.left-1,e.column[0]<e.column_focus&&(e.column[0]=e.column_focus),s=[e.column[0],r]),e.column=s,e.left_move=t,e.width_move=l,w.luckysheet_select_save[w.luckysheet_select_save.length-1]=e}else e.ctrlKey?w.luckysheet_select_save.push({left:d,width:k,top:P(0)[0],height:P(0)[1]-P(0)[0]-1,left_move:d,width_move:k,top_move:0,height_move:n-0-1,row:[0,o],column:y,row_focus:0,column_focus:r,column_select:!0}):(w.luckysheet_select_save.length=0,w.luckysheet_select_save.push({left:d,width:k,top:P(0)[0],height:P(0)[1]-P(0)[0]-1,left_move:d,width_move:k,top_move:0,height_move:n-0-1,row:[0,o],column:y,row_focus:0,column_focus:r,column_select:!0}));p(),w.saveParam("mv",w.currentSheetIndex,w.luckysheet_select_save)}x(),setTimeout(function(){clearTimeout(w.countfuncTimeout),G()},101),w.luckysheet_cols_menu_status&&($("#luckysheet-rightclick-menu").hide(),$("#luckysheet-cols-h-hover").hide(),$("#luckysheet-cols-menu-btn").hide(),w.luckysheet_cols_menu_status=!1),e.stopPropagation()}).mousemove(function(e){if(w.luckysheet_cols_selected_status||w.luckysheet_select_status)return $("#luckysheet-cols-h-hover").hide(),void $("#luckysheet-cols-menu-btn").hide();if(w.luckysheet_cols_menu_status||w.luckysheet_cols_change_size)return;let t=A(e.pageX,e.pageY)[0]+$("#luckysheet-cols-h-c").scrollLeft(),l=T(t),s=l[1],c=l[0];l[2],$("#luckysheet-cols-h-hover").css({left:c,width:s-c-1,display:"block"}),$("#luckysheet-cols-menu-btn").css({left:s-19,display:"block"}),$("#luckysheet-cols-change-size").css({left:s-5}),t<s&&t>=s-5?($("#luckysheet-cols-change-size").css({opacity:0}),$("#luckysheet-cols-menu-btn").hide()):($("#luckysheet-change-size-line").hide(),$("#luckysheet-cols-change-size").css("opacity",0))}).mouseleave(function(e){w.luckysheet_cols_menu_status||w.luckysheet_cols_change_size||($("#luckysheet-cols-h-hover").hide(),$("#luckysheet-cols-menu-btn").hide(),$("#luckysheet-cols-change-size").css("opacity",0))}).mouseup(function(e){if(3==e.which){if(F())return;w.luckysheetRightHeadClickIs="column",$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-word").text(f().rightclick.column),$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-size").text(f().rightclick.width),$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-left").text(f().rightclick.left),$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-right").text(f().rightclick.right),$("#luckysheet-cols-rows-add").show(),$("#luckysheet-cols-rows-data").show(),$("#luckysheet-cols-rows-shift").hide(),$("#luckysheet-cols-rows-handleincell").hide(),S("#luckysheet-cols-rows-add .luckysheet-menuseparator").style.display="block",S("#luckysheet-cols-rows-data .luckysheet-menuseparator").style.display="block";const t=o.cellRightClickConfig;if(!(t.copy||t.copyAs||t.paste||t.insertColumn||t.deleteColumn||t.hideColumn||t.columnWidth||t.clear||t.matrix||t.sort||t.filter||t.chart||t.image||t.link||t.data||t.cellFormat))return;S("#luckysheet-top-left-add-selected").style.display=t.insertColumn?"block":"none",S("#luckysheet-bottom-right-add-selected").style.display=t.insertColumn?"block":"none",S("#luckysheet-del-selected").style.display=t.deleteColumn?"block":"none",S("#luckysheet-hide-selected").style.display=t.hideColumn?"block":"none",S("#luckysheet-show-selected").style.display=t.hideColumn?"block":"none",S("#luckysheet-column-row-width-selected").style.display=t.columnWidth?"block":"none",t.copy||t.copyAs||t.paste||(S("#luckysheet-cols-rows-add .luckysheet-menuseparator").style.display="none",t.insertColumn||t.deleteColumn||t.hideColumn||t.columnWidth||(S("#luckysheet-cols-rows-data .luckysheet-menuseparator").style.display="none")),t.insertColumn||t.deleteColumn||t.hideColumn||t.columnWidth||(S("#luckysheet-cols-rows-add .luckysheet-menuseparator").style.display="none"),t.clear||t.matrix||t.sort||t.filter||t.chart||t.image||t.link||t.data||t.cellFormat||(S("#luckysheet-cols-rows-data .luckysheet-menuseparator").style.display="none"),I($("#luckysheet-rightclick-menu"),e.pageX,$(this).offset().top+18),w.luckysheet_cols_menu_status=!0;let l=$.extend(!0,{},w.config);null==l.columnlen&&(l.columnlen={});let s=null==l.columnlen[w.luckysheet_select_save[0].column[0]]?w.defaultcollen:l.columnlen[w.luckysheet_select_save[0].column[0]],c=!0;for(let e=0;e<w.luckysheet_select_save.length;e++){let t=w.luckysheet_select_save[e],o=t.column[0],n=t.column[1];for(let e=o;e<=n;e++)if((null==l.columnlen[e]?w.defaultcollen:l.columnlen[e])!=s){c=!1;break}}c?$("#luckysheet-cols-rows-add").find("input[type='number'].rcsize").val(s):$("#luckysheet-cols-rows-add").find("input[type='number'].rcsize").val("")}}),$("#luckysheet-rows-change-size").mousedown(function(e){t.removeActivePs(),($("#luckysheet-modal-dialog-activeImage").is(":visible")||$("#luckysheet-modal-dialog-cropping").is(":visible"))&&l.cancelActiveImgItem(),$("#luckysheet-input-box").hide(),$("#luckysheet-rows-change-size").css({opacity:1});let s=A(e.pageX,e.pageY)[1]+$("#luckysheet-rows-h").scrollTop(),c=$("#luckysheet-cell-main").scrollLeft(),o=$("#luckysheet-cell-main").width(),n=z(s),i=n[1],u=n[0],h=n[2];w.luckysheet_rows_change_size=!0,w.luckysheet_scroll_status=!0,$("#luckysheet-change-size-line").css({height:"1px","border-width":"0 0px 1px 0",top:i-3,left:0,width:c+o,display:"block",cursor:"ns-resize"}),$("#luckysheet-sheettable, #luckysheet-rows-h, #luckysheet-rows-h canvas").css("cursor","ns-resize"),w.luckysheet_rows_change_size_start=[u,h],$("#luckysheet-rightclick-menu").hide(),$("#luckysheet-rows-h-hover").hide(),$("#luckysheet-cols-menu-btn").hide(),e.stopPropagation()}),$("#luckysheet-cols-change-size").mousedown(function(e){t.removeActivePs(),($("#luckysheet-modal-dialog-activeImage").is(":visible")||$("#luckysheet-modal-dialog-cropping").is(":visible"))&&l.cancelActiveImgItem(),$("#luckysheet-input-box").hide(),$("#luckysheet-cols-change-size").css({opacity:1});let s=A(e.pageX,e.pageY),c=$("#luckysheet-cols-h-c").scrollLeft(),o=$("#luckysheet-cell-main").scrollTop(),n=$("#luckysheet-cell-main").height(),i=s[0]+c,u=w.visibledatarow.length-1,h=(w.visibledatarow[u],T(i)),r=h[1],a=h[0],d=h[2];w.luckysheet_cols_change_size=!0,w.luckysheet_scroll_status=!0,$("#luckysheet-change-size-line").css({height:n+o,"border-width":"0 1px 0 0",top:0,left:r-3,width:"1px",display:"block",cursor:"ew-resize"}),$("#luckysheet-sheettable, #luckysheet-cols-h-c, .luckysheet-cols-h-cells, .luckysheet-cols-h-cells canvas").css("cursor","ew-resize"),w.luckysheet_cols_change_size_start=[a,d],$("#luckysheet-rightclick-menu").hide(),$("#luckysheet-cols-h-hover").hide(),$("#luckysheet-cols-menu-btn").hide(),w.luckysheet_cols_dbclick_times=0,e.stopPropagation()}).dblclick(function(){!function(){w.luckysheet_cols_change_size=!1,$("#luckysheet-change-size-line").hide(),$("#luckysheet-cols-change-size").css("opacity",0),$("#luckysheet-sheettable, #luckysheet-cols-h-c, .luckysheet-cols-h-cells, .luckysheet-cols-h-cells canvas").css("cursor","default");let e=A(event.pageX,event.pageY),t=$("#luckysheet-cols-h-c").scrollLeft(),l=e[0]+t,s=T(l)[2],c=w.deepCopyFlowData(w.flowdata),o=$("#luckysheetTableContent").get(0).getContext("2d"),n=$.extend(!0,{},w.config);null==n.columnlen&&(n.columnlen={});let i={},u=$("#luckysheet-cell-main").scrollTop(),h=w.luckysheetTableContentHW[1],r=D(w.visibledatarow,u),a=D(w.visibledatarow,u+h);(a+=a-r)>=c.length&&(a=c.length-1);for(let e=0;e<w.luckysheet_select_save.length;e++){let t=w.luckysheet_select_save[e].column[0],l=w.luckysheet_select_save[e].column[1];if(s<t||s>l){if(s in i)continue;let e=w.defaultcollen;for(let t=r;t<=a;t++){let l=c[t][s];if(null==l||N(l.v)&&!B(l))continue;let n=L(s)[1]-L(s)[0]-2,i=O(l,o,{r:t,c:s,cellWidth:n}),u=0;null!=i&&(u=i.textWidthAll),u+6>e&&(e=u+6)}e!=w.defaultcollen&&(n.columnlen[s]=e,n.customWidth&&delete n.customWidth[s]),i[s]=1}else for(let e=t;e<=l;e++){if(e in i)continue;let t=w.defaultcollen;for(let l=r;l<=a;l++){let s=c[l][e];if(null==s||N(s.v)&&!B(s))continue;let n=L(e)[1]-L(e)[0]-2,i=O(s,o,{r:l,c:e,cellWidth:n}),u=0;null!=i&&(u=i.textWidthAll),u+6>t&&(t=u+6)}t!=w.defaultcollen&&(n.columnlen[e]=t,n.customWidth&&delete n.customWidth[e]),i[e]=1}}w.refreshGridAll(w.flowdata[0].length,w.flowdata.length,w.flowdata,n,w.luckysheet_select_save,"resizeC","columnlen")}()}),$("#luckysheet-cols-menu-btn").click(function(e){let t=$("#luckysheet-rightclick-menu"),l=$(this).offset();$("#luckysheet-cols-rows-shift").show(),w.luckysheetRightHeadClickIs="column",$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-word").text(f().rightclick.column),$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-left").text(f().rightclick.left),$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-right").text(f().rightclick.right),$("#luckysheet-cols-rows-add").show(),$("#luckysheet-cols-rows-data").hide(),$("#luckysheet-cols-rows-shift").show(),$("#luckysheet-cols-rows-handleincell").hide(),S("#luckysheet-cols-rows-add .luckysheet-menuseparator").style.display="block",S("#luckysheet-cols-rows-shift .luckysheet-menuseparator").style.display="block";const s=o.cellRightClickConfig;(s.copy||s.copyAs||s.paste||s.insertColumn||s.deleteColumn||s.hideColumn||s.columnWidth||s.sort)&&(S("#luckysheet-top-left-add-selected").style.display=s.insertColumn?"block":"none",S("#luckysheet-bottom-right-add-selected").style.display=s.insertColumn?"block":"none",S("#luckysheet-del-selected").style.display=s.deleteColumn?"block":"none",S("#luckysheet-hide-selected").style.display=s.hideColumn?"block":"none",S("#luckysheet-show-selected").style.display=s.hideColumn?"block":"none",S("#luckysheet-column-row-width-selected").style.display=s.columnWidth?"block":"none",s.copy||s.copyAs||s.paste||(S("#luckysheet-cols-rows-add .luckysheet-menuseparator").style.display="none",s.insertColumn||s.deleteColumn||s.hideColumn||s.columnWidth||(S("#luckysheet-cols-rows-shift .luckysheet-menuseparator").style.display="none")),s.insertColumn||s.deleteColumn||s.hideColumn||s.columnWidth||(S("#luckysheet-cols-rows-add .luckysheet-menuseparator").style.display="none"),s.sort||(S("#luckysheet-cols-rows-shift .luckysheet-menuseparator").style.display="none"),I(t,l.left,l.top+18),w.luckysheet_cols_menu_status=!0)}),$("#luckysheet-top-left-add-selected").click(function(e){if("INPUT"===e.target.nodeName)return;$("#luckysheet-rightclick-menu").hide(),C();const t=f(),l=t.drag,s=t.info;if(w.luckysheet_select_save.length>1)return void(F()?alert(l.noMulti):y.info(l.noMulti,""));let c=$(this).find("input").val();if(!W(c))return void(F()?alert(s.tipInputNumber):y.info(s.tipInputNumber,""));if((c=parseInt(c))<1||c>100)return void(F()?alert(s.tipInputNumberLimit):y.info(s.tipInputNumberLimit,""));let o=w.luckysheet_select_save[0][w.luckysheetRightHeadClickIs][0];U(w.luckysheetRightHeadClickIs,o,c,"lefttop")}),$("#luckysheetColsRowsHandleAdd_row").click(function(e){if($("#luckysheet-rightclick-menu").hide(),C(),!1===w.allowEdit)return;let t=w.luckysheet_select_save[0].row[0];U("row",t,1,"lefttop")}),$("#luckysheetColsRowsHandleAdd_column").click(function(e){if($("#luckysheet-rightclick-menu").hide(),C(),!1===w.allowEdit)return;let t=w.luckysheet_select_save[0].column[0];U("column",t,1,"lefttop")}),$("#luckysheet-bottom-right-add-selected").click(function(e){if("INPUT"===e.target.nodeName)return;$("#luckysheet-rightclick-menu").hide(),C();const t=f(),l=t.drag,s=t.info;if(w.luckysheet_select_save.length>1)return void(F()?alert(l.noMulti):y.info(l.noMulti,""));let c=$(this).find("input").val();if(!W(c))return void(F()?alert(s.tipInputNumber):y.info(s.tipInputNumber,""));if((c=parseInt(c))<1||c>100)return void(F()?alert(s.tipInputNumberLimit):y.info(s.tipInputNumberLimit,""));let o=w.luckysheet_select_save[0][w.luckysheetRightHeadClickIs][1];U(w.luckysheetRightHeadClickIs,o,c,"rightbottom")}),$("#luckysheet-del-selected, #luckysheet-del-selected_t").click(function(e){$("#luckysheet-rightclick-menu").hide(),C();const t=f().drag;if(w.luckysheet_select_save.length>1)return void("row"==w.luckysheetRightHeadClickIs?F()?alert(t.noMulti):y.info(t.noMulti,""):"column"==w.luckysheetRightHeadClickIs&&(F()?alert(t.noMulti):y.info(t.noMulti,"")));let l=w.luckysheet_select_save[0][w.luckysheetRightHeadClickIs][0],s=w.luckysheet_select_save[0][w.luckysheetRightHeadClickIs][1];K(w.luckysheetRightHeadClickIs,l,s)}),$("#luckysheet-delRows").click(function(e){$("#luckysheet-rightclick-menu").hide(),C();const t=f().drag;if(w.luckysheet_select_save.length>1)return void("row"==w.luckysheetRightHeadClickIs?F()?alert(t.noMulti):y.info(t.noMulti,""):"column"==w.luckysheetRightHeadClickIs&&(F()?alert(t.noMulti):y.info(t.noMulti,"")));let l=w.luckysheet_select_save[0].row[0],s=w.luckysheet_select_save[0].row[1];K("row",l,s)}),$("#luckysheet-delCols").click(function(e){$("#luckysheet-rightclick-menu").hide(),C();const t=f().drag;if(w.luckysheet_select_save.length>1)return void("row"==w.luckysheetRightHeadClickIs?F()?alert(t.noMulti):y.info(t.noMulti,""):"column"==w.luckysheetRightHeadClickIs&&(F()?alert(t.noMulti):y.info(t.noMulti,"")));let l=w.luckysheet_select_save[0].column[0],s=w.luckysheet_select_save[0].column[1];K("column",l,s)}),$("#luckysheet-hide-selected").click(function(e){$("#luckysheet-rightclick-menu").hide(),C();const t=f().drag;if(w.luckysheet_select_save.length>1)"row"==w.luckysheetRightHeadClickIs?F()?alert(t.noMulti):y.info(t.noMulti,""):"column"==w.luckysheetRightHeadClickIs&&(F()?alert(t.noMulti):y.info(t.noMulti,""));else if("row"==w.luckysheetRightHeadClickIs){if(!J(w.currentSheetIndex,"formatRows"))return;let e=$.extend(!0,{},w.config);null==e.rowhidden&&(e.rowhidden={});for(let t=0;t<w.luckysheet_select_save.length;t++){let l=w.luckysheet_select_save[t].row[0],s=w.luckysheet_select_save[t].row[1];for(let t=l;t<=s;t++)e.rowhidden[t]=0}if(w.clearjfundo){let t={type:"showHidRows"};t.sheetIndex=w.currentSheetIndex,t.config=$.extend(!0,{},w.config),t.curconfig=e,w.jfundo.length=0,w.jfredo.push(t)}w.config=e,w.luckysheetfile[H(w.currentSheetIndex)].config=w.config,w.saveParam("cg",w.currentSheetIndex,e.rowhidden,{k:"rowhidden"}),w.refreshGrid_rhcw(w.flowdata.length,w.flowdata[0].length)}else if("column"==w.luckysheetRightHeadClickIs){if(!J(w.currentSheetIndex,"formatColumns"))return;let e=$.extend(!0,{},w.config);null==e.colhidden&&(e.colhidden={});for(let t=0;t<w.luckysheet_select_save.length;t++){let l=w.luckysheet_select_save[t].column[0],s=w.luckysheet_select_save[t].column[1];for(let t=l;t<=s;t++)e.colhidden[t]=0}if(w.clearjfundo){let t={type:"showHidCols"};t.sheetIndex=w.currentSheetIndex,t.config=$.extend(!0,{},w.config),t.curconfig=e,w.jfundo.length=0,w.jfredo.push(t)}w.config=e,w.luckysheetfile[H(w.currentSheetIndex)].config=w.config,w.saveParam("cg",w.currentSheetIndex,e.colhidden,{k:"colhidden"}),w.refreshGrid_rhcw(w.flowdata.length,w.flowdata[0].length)}}),$("#luckysheet-show-selected").click(function(e){$("#luckysheet-rightclick-menu").hide(),C();const t=f().drag;if(w.luckysheet_select_save.length>1)"row"==w.luckysheetRightHeadClickIs?F()?alert(t.noMulti):y.info(t.noMulti,""):"column"==w.luckysheetRightHeadClickIs&&(F()?alert(t.noMulti):y.info(t.noMulti,""));else if("row"==w.luckysheetRightHeadClickIs){if(!J(w.currentSheetIndex,"formatRows"))return;let e=$.extend(!0,{},w.config);if(null==e.rowhidden)return;for(let t=0;t<w.luckysheet_select_save.length;t++){let l=w.luckysheet_select_save[t].row[0],s=w.luckysheet_select_save[t].row[1];for(let t=l;t<=s;t++)delete e.rowhidden[t]}if(w.clearjfundo){let t={type:"showHidRows"};t.sheetIndex=w.currentSheetIndex,t.config=$.extend(!0,{},w.config),t.curconfig=e,w.jfundo.length=0,w.jfredo.push(t)}w.config=e,w.luckysheetfile[H(w.currentSheetIndex)].config=w.config,w.saveParam("cg",w.currentSheetIndex,e.rowhidden,{k:"rowhidden"}),w.refreshGrid_rhcw(w.flowdata.length,w.flowdata[0].length)}else if("column"==w.luckysheetRightHeadClickIs){if(!J(w.currentSheetIndex,"formatColumns"))return;let e=$.extend(!0,{},w.config);if(null==e.colhidden)return;for(let t=0;t<w.luckysheet_select_save.length;t++){let l=w.luckysheet_select_save[t].column[0],s=w.luckysheet_select_save[t].column[1];for(let t=l;t<=s;t++)delete e.colhidden[t]}if(w.clearjfundo){let t={type:"showHidCols"};t.sheetIndex=w.currentSheetIndex,t.config=$.extend(!0,{},w.config),t.curconfig=e,w.jfundo.length=0,w.jfredo.push(t)}w.config=e,w.luckysheetfile[H(w.currentSheetIndex)].config=w.config,w.saveParam("cg",w.currentSheetIndex,e.colhidden,{k:"colhidden"}),w.refreshGrid_rhcw(w.flowdata.length,w.flowdata[0].length)}}),$("#luckysheet-delCellsMoveLeft").click(function(e){$("body .luckysheet-cols-menu").hide(),C();const t=f().drag;if(w.luckysheet_select_save.length>1)return void(F()?alert(t.noMulti):y.info(t.noMulti,""));let l=w.luckysheet_select_save[0].row[0],s=w.luckysheet_select_save[0].row[1],c=w.luckysheet_select_save[0].column[0],o=w.luckysheet_select_save[0].column[1];X("moveLeft",l,s,c,o)}),$("#luckysheet-delCellsMoveUp").click(function(e){$("body .luckysheet-cols-menu").hide(),C();const t=f().drag;if(w.luckysheet_select_save.length>1)return void(F()?alert(t.noMulti):y.info(t.noMulti,""));let l=w.luckysheet_select_save[0].row[0],s=w.luckysheet_select_save[0].row[1],c=w.luckysheet_select_save[0].column[0],o=w.luckysheet_select_save[0].column[1];X("moveUp",l,s,c,o)}),$("#luckysheet-delete-text").click(function(){if(V(w.luckysheet_select_save,w.currentSheetIndex)&&($("#luckysheet-rightclick-menu").hide(),C(),!1!==w.allowEdit&&w.luckysheet_select_save.length>0)){let t=w.deepCopyFlowData(w.flowdata),l=!1;for(let e=0;e<w.luckysheet_select_save.length;e++){let t=w.luckysheet_select_save[e].row[0],s=w.luckysheet_select_save[e].row[1],c=w.luckysheet_select_save[e].column[0],o=w.luckysheet_select_save[e].column[1];if(j(w.config,t,s,c,o)){l=!0;break}}if(l){const e=f().drag;return void(F()?alert(e.noPartMerge):y.info(e.noPartMerge,""))}for(let l=0;l<w.luckysheet_select_save.length;l++){let s=w.luckysheet_select_save[l].row[0],c=w.luckysheet_select_save[l].row[1],o=w.luckysheet_select_save[l].column[0],n=w.luckysheet_select_save[l].column[1];for(let l=s;l<=c;l++)for(let s=o;s<=n;s++)e.isPivotRange(l,s)||("object"==b(t[l][s])?(delete t[l][s].m,delete t[l][s].v,null!=t[l][s].f&&(delete t[l][s].f,a.delFunctionGroup(l,s,w.currentSheetIndex),delete t[l][s].spl),null!=t[l][s].ct&&"inlineStr"==t[l][s].ct.t&&delete t[l][s].ct):t[l][s]=null)}w.refreshGrid(t,w.luckysheet_select_save)}}),$("#luckysheet-column-row-width-selected").click(function(e){if("INPUT"===e.target.nodeName)return;$("#luckysheet-rightclick-menu").hide(),C();let t=parseInt($(this).closest(".luckysheet-cols-menuitem").find("input[type='number']").val().trim());const s=f().info;let c,o=$.extend(!0,{},w.config),n=null;if("row"==w.luckysheetRightHeadClickIs){if(!J(w.currentSheetIndex,"formatRows"))return;if(t<0||t>545)return void(F()?alert(s.tipRowHeightLimit):y.info(s.tipRowHeightLimit,""));c="resizeR",null==o.rowlen&&(o.rowlen={});for(let e=0;e<w.luckysheet_select_save.length;e++){let s=w.luckysheet_select_save[e].row[0],c=w.luckysheet_select_save[e].row[1];for(let e=s;e<=c;e++)o.rowlen[e]=t,n=l.moveChangeSize("row",e,t)}}else if("column"==w.luckysheetRightHeadClickIs){if(!J(w.currentSheetIndex,"formatColumns"))return;if(t<0||t>2038)return void(F()?alert(s.tipColumnWidthLimit):y.info(s.tipColumnWidthLimit,""));c="resizeC",null==o.columnlen&&(o.columnlen={});for(let e=0;e<w.luckysheet_select_save.length;e++){let s=w.luckysheet_select_save[e].column[0],c=w.luckysheet_select_save[e].column[1];for(let e=s;e<=c;e++)o.columnlen[e]=t,n=l.moveChangeSize("column",e,t)}}w.clearjfundo&&(w.jfundo.length=0,w.jfredo.push({type:"resize",ctrlType:c,sheetIndex:w.currentSheetIndex,config:$.extend(!0,{},w.config),curconfig:$.extend(!0,{},o),images:$.extend(!0,{},l.images),curImages:$.extend(!0,{},n)})),w.config=o,w.luckysheetfile[H(w.currentSheetIndex)].config=w.config,w.luckysheetfile[H(w.currentSheetIndex)].images=n,w.saveParam("all",w.currentSheetIndex,n,{k:"images"}),l.images=n,l.allImagesShow(),"row"==w.luckysheetRightHeadClickIs?(w.saveParam("cg",w.currentSheetIndex,o.rowlen,{k:"rowlen"}),w.refreshGrid_rhcw(w.flowdata.length,null)):"column"==w.luckysheetRightHeadClickIs&&(w.saveParam("cg",w.currentSheetIndex,o.columnlen,{k:"columnlen"}),w.refreshGrid_rhcw(null,w.flowdata[0].length))})},deleteRows:function(e,t,l){w.luckysheetRightHeadClickIs="column"},deleteColumns:function(){}}});
//# sourceMappingURL=../sourcemaps/controllers/rowColumnOperation.js.map
