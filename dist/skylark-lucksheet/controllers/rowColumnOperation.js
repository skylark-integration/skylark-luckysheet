/**
 * skylark-lucksheet - A version of lucksheet.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["./pivotTable","./postil","./imageCtrl","./menuButton","./server","./select","../utils/util","../methods/get","../global/location","../global/validate","../global/count","../global/formula","../global/extend","../global/refresh","../global/getdata","../global/tooltip","../global/editor","../locale/locale","../global/getRowlen","../controllers/sheetSearch","./inlineString","./protection","../store","./luckysheetConfigsetting"],function(e,t,l,s,c,o,n,i,u,h,r,a,d,k,y,f,g,m,_,w,p,v,b,x){"use strict";const{selectHightlightShow:I,luckysheet_count_show:C,selectHelpboxFill:R}=o,{getObjType:S,showrightclickmenu:H,luckysheetContainerFocus:M,luckysheetfontformat:z,$$:P}=n,{getSheetIndex:T,getRangetxt:L}=i,{rowLocation:j,rowLocationByIndex:A,colLocation:N,colLocationByIndex:W,mouseposition:F}=u,{isRealNull:G,isRealNum:U,hasPartMC:K,isEditMode:X}=h,{countfunc:Y}=r,{luckysheetextendtable:E,luckysheetdeletetable:O,luckysheetDeleteCell:B}=d,{jfrefreshgrid:D,jfrefreshgridall:V,jfrefreshgrid_rhcw:q}=k,{getcellvalue:J}=y,{getMeasureText:Q,getCellTextInfo:Z}=_,{luckysheet_searcharray:ee}=w,{isInlineStringCell:te}=p,{checkProtectionLockedRangeList:le,checkProtectionAllSelected:se,checkProtectionAuthorityNormal:ce}=v;return{rowColumnOperationInitial:function(){$("#luckysheet-rows-h").mousedown(function(e){if(!se(b.currentSheetIndex))return;t.removeActivePs(),($("#luckysheet-modal-dialog-activeImage").is(":visible")||$("#luckysheet-modal-dialog-cropping").is(":visible"))&&l.cancelActiveImgItem();let o=F(e.pageX,e.pageY)[1]+$("#luckysheet-rows-h").scrollTop(),n=j(o),i=n[1],u=n[0],h=n[2],r=b.visibledatacolumn.length-1,d=b.visibledatacolumn[r];if($("#luckysheet-rightclick-menu").hide(),$("#luckysheet-sheet-list, #luckysheet-rightclick-sheet-menu").hide(),"3"==e.which){let e=!1;for(let t=0;t<b.luckysheet_select_save.length;t++){let l=b.luckysheet_select_save[t];if(null!=l.row&&h>=l.row[0]&&h<=l.row[1]&&0==l.column[0]&&l.column[1]==b.flowdata[0].length-1){e=!0;break}}if(e)return}let k=u,y=i-u-1,f=[h,h];b.luckysheet_scroll_status=!0;let g=$("#luckysheet-input-box");if(parseInt(g.css("top"))>0){if(a.rangestart||a.rangedrag_column_start||a.rangedrag_row_start||a.israngeseleciton()||$("#luckysheet-ifFormulaGenerator-multiRange-dialog").is(":visible")){let t=s.mergeMoveMain([0,r],f,{row_focus:h,column_focus:0},k,y,0,d);if(null!=t&&(f=t[1],k=t[2],y=t[3]),e.shiftKey){let e=a.func_selectedrange,t=0,l=0,c=[];e.top>u?(t=u,l=e.top+e.height-u,e.row[1]>e.row_focus&&(e.row[1]=e.row_focus),c=[h,e.row[1]]):e.top==u?(t=u,l=e.top+e.height-u,c=[h,e.row[0]]):(t=e.top,l=i-e.top-1,e.row[0]<e.row_focus&&(e.row[0]=e.row_focus),c=[e.row[0],h]);let o=s.mergeMoveMain([0,r],c,{row_focus:h,column_focus:0},t,l,0,d);null!=o&&(c=o[1],t=o[2],l=o[3]),e.row=c,e.top_move=t,e.height_move=l,a.func_selectedrange=e}else if(e.ctrlKey&&","!=$("#luckysheet-rich-text-editor").find("span").last().text()){let e=$("#luckysheet-rich-text-editor").text()+",";if(e.length>0&&"="==e.substr(0,1)){if(e=a.functionHTMLGenerate(e),window.getSelection){let e=window.getSelection();a.functionRangeIndex=[$(e.anchorNode).parent().index(),e.anchorOffset]}else{let e=document.selection.createRange();a.functionRangeIndex=e}$("#luckysheet-rich-text-editor").html(e),a.canceFunctionrangeSelected(),a.createRangeHightlight()}a.rangestart=!1,a.rangedrag_column_start=!1,a.rangedrag_row_start=!1,$("#luckysheet-functionbox-cell").html(e),a.rangeHightlightselected($("#luckysheet-rich-text-editor")),a.israngeseleciton(),a.func_selectedrange={left:W(0)[0],width:W(0)[1]-W(0)[0]-1,top:k,height:y,left_move:0,width_move:d-0-1,top_move:k,height_move:y,row:f,column:[0,r],row_focus:h,column_focus:0}}else a.func_selectedrange={left:W(0)[0],width:W(0)[1]-W(0)[0]-1,top:k,height:y,left_move:0,width_move:d-0-1,top_move:k,height_move:y,row:f,column:[0,r],row_focus:h,column_focus:0};if(a.rangestart||a.rangedrag_column_start||a.rangedrag_row_start||a.israngeseleciton())a.rangeSetValue({row:f,column:[null,null]});else if($("#luckysheet-ifFormulaGenerator-multiRange-dialog").is(":visible")){let e=L(b.currentSheetIndex,{row:f,column:[0,r]},b.currentSheetIndex);$("#luckysheet-ifFormulaGenerator-multiRange-dialog input").val(e)}return a.rangedrag_row_start=!0,a.rangestart=!1,a.rangedrag_column_start=!1,$("#luckysheet-formula-functionrange-select").css({left:0,width:d-0-1,top:k,height:y}).show(),$("#luckysheet-formula-help-c").hide(),C(0,k,d-0-1,y,f,[0,r]),void setTimeout(function(){let e,t=window.getSelection().anchorNode;$("#luckysheet-search-formula-parm").is(":visible")||$("#luckysheet-search-formula-parm-select").is(":visible")?(e=$("#luckysheet-rich-text-editor"),a.rangechangeindex=a.data_parm_index):e=$(t).closest("div");let l=e.find("span[rangeindex='"+a.rangechangeindex+"']");a.setCaretPosition(l.get(0),0,l.html().length)},1)}a.updatecell(b.luckysheetCellUpdate[0],b.luckysheetCellUpdate[1]),b.luckysheet_rows_selected_status=!0}else b.luckysheet_rows_selected_status=!0;if(b.luckysheet_rows_selected_status){if(e.shiftKey){let e=$.extend(!0,{},b.luckysheet_select_save[b.luckysheet_select_save.length-1]),t=0,l=0,s=[];e.top>u?(t=u,l=e.top+e.height-u,e.row[1]>e.row_focus&&(e.row[1]=e.row_focus),s=[h,e.row[1]]):e.top==u?(t=u,l=e.top+e.height-u,s=[h,e.row[0]]):(t=e.top,l=i-e.top-1,e.row[0]<e.row_focus&&(e.row[0]=e.row_focus),s=[e.row[0],h]),e.row=s,e.top_move=t,e.height_move=l,b.luckysheet_select_save[b.luckysheet_select_save.length-1]=e}else e.ctrlKey?b.luckysheet_select_save.push({left:W(0)[0],width:W(0)[1]-W(0)[0]-1,top:k,height:y,left_move:0,width_move:d-0-1,top_move:k,height_move:y,row:f,column:[0,r],row_focus:h,column_focus:0,row_select:!0}):(b.luckysheet_select_save.length=0,b.luckysheet_select_save.push({left:W(0)[0],width:W(0)[1]-W(0)[0]-1,top:k,height:y,left_move:0,width_move:d-0-1,top_move:k,height_move:y,row:f,column:[0,r],row_focus:h,column_focus:0,row_select:!0}));I(),c.saveParam("mv",b.currentSheetIndex,b.luckysheet_select_save)}R(),setTimeout(function(){clearTimeout(b.countfuncTimeout),Y()},101)}).mousemove(function(e){if(b.luckysheet_rows_selected_status||b.luckysheet_rows_change_size||b.luckysheet_select_status)return void $("#luckysheet-rows-h-hover").hide();let t=F(e.pageX,e.pageY)[1]+$("#luckysheet-rows-h").scrollTop(),l=j(t),s=l[1],c=l[0];l[2],$("#luckysheet-rows-h-hover").css({top:c,height:s-c-1,display:"block"}),t<s-1&&t>=s-5?$("#luckysheet-rows-change-size").css({top:s-3,opacity:0}):$("#luckysheet-rows-change-size").css("opacity",0)}).mouseleave(function(e){$("#luckysheet-rows-h-hover").hide(),$("#luckysheet-rows-change-size").css("opacity",0)}).mouseup(function(e){if(3==e.which){if(X())return;$("#luckysheet-cols-rows-shift").hide(),b.luckysheetRightHeadClickIs="row",$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-word").text(m().rightclick.row),$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-size").text(m().rightclick.height),$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-left").text(m().rightclick.top),$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-right").text(m().rightclick.bottom),$("#luckysheet-cols-rows-add").show(),$("#luckysheet-cols-rows-data").show(),$("#luckysheet-cols-rows-shift").hide(),$("#luckysheet-cols-rows-handleincell").hide(),P("#luckysheet-cols-rows-add .luckysheet-menuseparator").style.display="block",P("#luckysheet-cols-rows-data .luckysheet-menuseparator").style.display="block";const t=x.cellRightClickConfig;if(!(t.copy||t.copyAs||t.paste||t.insertRow||t.deleteRow||t.hideRow||t.rowHeight||t.clear||t.matrix||t.sort||t.filter||t.chart||t.image||t.link||t.data||t.cellFormat))return;P("#luckysheet-top-left-add-selected").style.display=t.insertRow?"block":"none",P("#luckysheet-bottom-right-add-selected").style.display=t.insertRow?"block":"none",P("#luckysheet-del-selected").style.display=t.deleteRow?"block":"none",P("#luckysheet-hide-selected").style.display=t.hideRow?"block":"none",P("#luckysheet-show-selected").style.display=t.hideRow?"block":"none",P("#luckysheet-column-row-width-selected").style.display=t.rowHeight?"block":"none",t.copy||t.copyAs||t.paste||(P("#luckysheet-cols-rows-add .luckysheet-menuseparator").style.display="none",t.insertRow||t.deleteRow||t.hideRow||t.rowHeight||(P("#luckysheet-cols-rows-data .luckysheet-menuseparator").style.display="none")),t.insertRow||t.deleteRow||t.hideRow||t.rowHeight||(P("#luckysheet-cols-rows-add .luckysheet-menuseparator").style.display="none"),t.clear||t.matrix||t.sort||t.filter||t.chart||t.image||t.link||t.data||t.cellFormat||(P("#luckysheet-cols-rows-data .luckysheet-menuseparator").style.display="none"),H($("#luckysheet-rightclick-menu"),$(this).offset().left+46,e.pageY),b.luckysheet_cols_menu_status=!0;let l=$.extend(!0,{},b.config);null==l.rowlen&&(l.rowlen={});let s=null==l.rowlen[b.luckysheet_select_save[0].row[0]]?b.defaultrowlen:l.rowlen[b.luckysheet_select_save[0].row[0]],c=!0;for(let e=0;e<b.luckysheet_select_save.length;e++){let t=b.luckysheet_select_save[e],o=t.row[0],n=t.row[1];for(let e=o;e<=n;e++)if((null==l.rowlen[e]?b.defaultrowlen:l.rowlen[e])!=s){c=!1;break}}c?$("#luckysheet-cols-rows-add").find("input[type='number'].rcsize").val(s):$("#luckysheet-cols-rows-add").find("input[type='number'].rcsize").val("")}}),$("#luckysheet-cols-h-c").mousedown(function(e){if(!se(b.currentSheetIndex))return;t.removeActivePs(),($("#luckysheet-modal-dialog-activeImage").is(":visible")||$("#luckysheet-modal-dialog-cropping").is(":visible"))&&l.cancelActiveImgItem();let o=F(e.pageX,e.pageY)[0]+$(this).scrollLeft(),n=b.visibledatarow.length-1,i=b.visibledatarow[n],u=N(o),h=u[1],r=u[0],d=u[2];if(b.orderbyindex=d,$("#luckysheet-rightclick-menu").hide(),$("#luckysheet-sheet-list, #luckysheet-rightclick-sheet-menu").hide(),$("#luckysheet-filter-menu, #luckysheet-filter-submenu").hide(),"3"==e.which){let e=!1;for(let t=0;t<b.luckysheet_select_save.length;t++){let l=b.luckysheet_select_save[t];if(null!=l.column&&d>=l.column[0]&&d<=l.column[1]&&0==l.row[0]&&l.row[1]==b.flowdata.length-1){e=!0;break}}if(e)return}let k=r,y=h-r-1,f=[d,d];b.luckysheet_scroll_status=!0;let g=$("#luckysheet-input-box");if(parseInt(g.css("top"))>0){if(a.rangestart||a.rangedrag_column_start||a.rangedrag_row_start||a.israngeseleciton()||$("#luckysheet-ifFormulaGenerator-multiRange-dialog").is(":visible")){let t=s.mergeMoveMain(f,[0,n],{row_focus:0,column_focus:d},0,i,k,y);if(null!=t&&(f=t[0],k=t[4],y=t[5]),e.shiftKey){let e=a.func_selectedrange,t=0,l=0,c=[];e.left>r?(t=r,l=e.left+e.width-r,e.column[1]>e.column_focus&&(e.column[1]=e.column_focus),c=[d,e.column[1]]):e.left==r?(t=r,l=e.left+e.width-r,c=[d,e.column[0]]):(t=e.left,l=h-e.left-1,e.column[0]<e.column_focus&&(e.column[0]=e.column_focus),c=[e.column[0],d]);let o=s.mergeMoveMain(c,[0,n],{row_focus:0,column_focus:d},0,i,t,l);null!=o&&(c=o[0],t=o[4],l=o[5]),e.column=c,e.left_move=t,e.width_move=l,a.func_selectedrange=e}else if(e.ctrlKey&&","!=$("#luckysheet-rich-text-editor").find("span").last().text()){let e=$("#luckysheet-rich-text-editor").text()+",";if(e.length>0&&"="==e.substr(0,1)){if(e=a.functionHTMLGenerate(e),window.getSelection){let e=window.getSelection();a.functionRangeIndex=[$(e.anchorNode).parent().index(),e.anchorOffset]}else{let e=document.selection.createRange();a.functionRangeIndex=e}$("#luckysheet-rich-text-editor").html(e),a.canceFunctionrangeSelected(),a.createRangeHightlight()}a.rangestart=!1,a.rangedrag_column_start=!1,a.rangedrag_row_start=!1,$("#luckysheet-functionbox-cell").html(e),a.rangeHightlightselected($("#luckysheet-rich-text-editor")),a.israngeseleciton(),a.func_selectedrange={left:k,width:y,top:A(0)[0],height:A(0)[1]-A(0)[0]-1,left_move:k,width_move:y,top_move:0,height_move:i-0-1,row:[0,n],column:f,row_focus:0,column_focus:d}}else a.func_selectedrange={left:k,width:y,top:A(0)[0],height:A(0)[1]-A(0)[0]-1,left_move:k,width_move:y,top_move:0,height_move:i-0-1,row:[0,n],column:f,row_focus:0,column_focus:d};if(a.rangestart||a.rangedrag_column_start||a.rangedrag_row_start||a.israngeseleciton())a.rangeSetValue({row:[null,null],column:f});else if($("#luckysheet-ifFormulaGenerator-multiRange-dialog").is(":visible")){let e=L(b.currentSheetIndex,{row:[0,n],column:f},b.currentSheetIndex);$("#luckysheet-ifFormulaGenerator-multiRange-dialog input").val(e)}return a.rangedrag_column_start=!0,a.rangestart=!1,a.rangedrag_row_start=!1,$("#luckysheet-formula-functionrange-select").css({left:k,width:y,top:0,height:i-0-1}).show(),$("#luckysheet-formula-help-c").hide(),void C(k,0,y,i-0-1,[0,n],f)}a.updatecell(b.luckysheetCellUpdate[0],b.luckysheetCellUpdate[1]),b.luckysheet_cols_selected_status=!0}else b.luckysheet_cols_selected_status=!0;if(b.luckysheet_cols_selected_status){if(e.shiftKey){let e=$.extend(!0,{},b.luckysheet_select_save[b.luckysheet_select_save.length-1]),t=0,l=0,s=[];e.left>r?(t=r,l=e.left+e.width-r,e.column[1]>e.column_focus&&(e.column[1]=e.column_focus),s=[d,e.column[1]]):e.left==r?(t=r,l=e.left+e.width-r,s=[d,e.column[0]]):(t=e.left,l=h-e.left-1,e.column[0]<e.column_focus&&(e.column[0]=e.column_focus),s=[e.column[0],d]),e.column=s,e.left_move=t,e.width_move=l,b.luckysheet_select_save[b.luckysheet_select_save.length-1]=e}else e.ctrlKey?b.luckysheet_select_save.push({left:k,width:y,top:A(0)[0],height:A(0)[1]-A(0)[0]-1,left_move:k,width_move:y,top_move:0,height_move:i-0-1,row:[0,n],column:f,row_focus:0,column_focus:d,column_select:!0}):(b.luckysheet_select_save.length=0,b.luckysheet_select_save.push({left:k,width:y,top:A(0)[0],height:A(0)[1]-A(0)[0]-1,left_move:k,width_move:y,top_move:0,height_move:i-0-1,row:[0,n],column:f,row_focus:0,column_focus:d,column_select:!0}));I(),c.saveParam("mv",b.currentSheetIndex,b.luckysheet_select_save)}R(),setTimeout(function(){clearTimeout(b.countfuncTimeout),Y()},101),b.luckysheet_cols_menu_status&&($("#luckysheet-rightclick-menu").hide(),$("#luckysheet-cols-h-hover").hide(),$("#luckysheet-cols-menu-btn").hide(),b.luckysheet_cols_menu_status=!1),e.stopPropagation()}).mousemove(function(e){if(b.luckysheet_cols_selected_status||b.luckysheet_select_status)return $("#luckysheet-cols-h-hover").hide(),void $("#luckysheet-cols-menu-btn").hide();if(b.luckysheet_cols_menu_status||b.luckysheet_cols_change_size)return;let t=F(e.pageX,e.pageY)[0]+$("#luckysheet-cols-h-c").scrollLeft(),l=N(t),s=l[1],c=l[0];l[2],$("#luckysheet-cols-h-hover").css({left:c,width:s-c-1,display:"block"}),$("#luckysheet-cols-menu-btn").css({left:s-19,display:"block"}),$("#luckysheet-cols-change-size").css({left:s-5}),t<s&&t>=s-5?($("#luckysheet-cols-change-size").css({opacity:0}),$("#luckysheet-cols-menu-btn").hide()):($("#luckysheet-change-size-line").hide(),$("#luckysheet-cols-change-size").css("opacity",0))}).mouseleave(function(e){b.luckysheet_cols_menu_status||b.luckysheet_cols_change_size||($("#luckysheet-cols-h-hover").hide(),$("#luckysheet-cols-menu-btn").hide(),$("#luckysheet-cols-change-size").css("opacity",0))}).mouseup(function(e){if(3==e.which){if(X())return;b.luckysheetRightHeadClickIs="column",$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-word").text(m().rightclick.column),$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-size").text(m().rightclick.width),$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-left").text(m().rightclick.left),$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-right").text(m().rightclick.right),$("#luckysheet-cols-rows-add").show(),$("#luckysheet-cols-rows-data").show(),$("#luckysheet-cols-rows-shift").hide(),$("#luckysheet-cols-rows-handleincell").hide(),P("#luckysheet-cols-rows-add .luckysheet-menuseparator").style.display="block",P("#luckysheet-cols-rows-data .luckysheet-menuseparator").style.display="block";const t=x.cellRightClickConfig;if(!(t.copy||t.copyAs||t.paste||t.insertColumn||t.deleteColumn||t.hideColumn||t.columnWidth||t.clear||t.matrix||t.sort||t.filter||t.chart||t.image||t.link||t.data||t.cellFormat))return;P("#luckysheet-top-left-add-selected").style.display=t.insertColumn?"block":"none",P("#luckysheet-bottom-right-add-selected").style.display=t.insertColumn?"block":"none",P("#luckysheet-del-selected").style.display=t.deleteColumn?"block":"none",P("#luckysheet-hide-selected").style.display=t.hideColumn?"block":"none",P("#luckysheet-show-selected").style.display=t.hideColumn?"block":"none",P("#luckysheet-column-row-width-selected").style.display=t.columnWidth?"block":"none",t.copy||t.copyAs||t.paste||(P("#luckysheet-cols-rows-add .luckysheet-menuseparator").style.display="none",t.insertColumn||t.deleteColumn||t.hideColumn||t.columnWidth||(P("#luckysheet-cols-rows-data .luckysheet-menuseparator").style.display="none")),t.insertColumn||t.deleteColumn||t.hideColumn||t.columnWidth||(P("#luckysheet-cols-rows-add .luckysheet-menuseparator").style.display="none"),t.clear||t.matrix||t.sort||t.filter||t.chart||t.image||t.link||t.data||t.cellFormat||(P("#luckysheet-cols-rows-data .luckysheet-menuseparator").style.display="none"),H($("#luckysheet-rightclick-menu"),e.pageX,$(this).offset().top+18),b.luckysheet_cols_menu_status=!0;let l=$.extend(!0,{},b.config);null==l.columnlen&&(l.columnlen={});let s=null==l.columnlen[b.luckysheet_select_save[0].column[0]]?b.defaultcollen:l.columnlen[b.luckysheet_select_save[0].column[0]],c=!0;for(let e=0;e<b.luckysheet_select_save.length;e++){let t=b.luckysheet_select_save[e],o=t.column[0],n=t.column[1];for(let e=o;e<=n;e++)if((null==l.columnlen[e]?b.defaultcollen:l.columnlen[e])!=s){c=!1;break}}c?$("#luckysheet-cols-rows-add").find("input[type='number'].rcsize").val(s):$("#luckysheet-cols-rows-add").find("input[type='number'].rcsize").val("")}}),$("#luckysheet-rows-change-size").mousedown(function(e){t.removeActivePs(),($("#luckysheet-modal-dialog-activeImage").is(":visible")||$("#luckysheet-modal-dialog-cropping").is(":visible"))&&l.cancelActiveImgItem(),$("#luckysheet-input-box").hide(),$("#luckysheet-rows-change-size").css({opacity:1});let s=F(e.pageX,e.pageY)[1]+$("#luckysheet-rows-h").scrollTop(),c=$("#luckysheet-cell-main").scrollLeft(),o=$("#luckysheet-cell-main").width(),n=j(s),i=n[1],u=n[0],h=n[2];b.luckysheet_rows_change_size=!0,b.luckysheet_scroll_status=!0,$("#luckysheet-change-size-line").css({height:"1px","border-width":"0 0px 1px 0",top:i-3,left:0,width:c+o,display:"block",cursor:"ns-resize"}),$("#luckysheet-sheettable, #luckysheet-rows-h, #luckysheet-rows-h canvas").css("cursor","ns-resize"),b.luckysheet_rows_change_size_start=[u,h],$("#luckysheet-rightclick-menu").hide(),$("#luckysheet-rows-h-hover").hide(),$("#luckysheet-cols-menu-btn").hide(),e.stopPropagation()}),$("#luckysheet-cols-change-size").mousedown(function(e){t.removeActivePs(),($("#luckysheet-modal-dialog-activeImage").is(":visible")||$("#luckysheet-modal-dialog-cropping").is(":visible"))&&l.cancelActiveImgItem(),$("#luckysheet-input-box").hide(),$("#luckysheet-cols-change-size").css({opacity:1});let s=F(e.pageX,e.pageY),c=$("#luckysheet-cols-h-c").scrollLeft(),o=$("#luckysheet-cell-main").scrollTop(),n=$("#luckysheet-cell-main").height(),i=s[0]+c,u=b.visibledatarow.length-1,h=(b.visibledatarow[u],N(i)),r=h[1],a=h[0],d=h[2];b.luckysheet_cols_change_size=!0,b.luckysheet_scroll_status=!0,$("#luckysheet-change-size-line").css({height:n+o,"border-width":"0 1px 0 0",top:0,left:r-3,width:"1px",display:"block",cursor:"ew-resize"}),$("#luckysheet-sheettable, #luckysheet-cols-h-c, .luckysheet-cols-h-cells, .luckysheet-cols-h-cells canvas").css("cursor","ew-resize"),b.luckysheet_cols_change_size_start=[a,d],$("#luckysheet-rightclick-menu").hide(),$("#luckysheet-cols-h-hover").hide(),$("#luckysheet-cols-menu-btn").hide(),b.luckysheet_cols_dbclick_times=0,e.stopPropagation()}).dblclick(function(){!function(){b.luckysheet_cols_change_size=!1,$("#luckysheet-change-size-line").hide(),$("#luckysheet-cols-change-size").css("opacity",0),$("#luckysheet-sheettable, #luckysheet-cols-h-c, .luckysheet-cols-h-cells, .luckysheet-cols-h-cells canvas").css("cursor","default");let e=F(event.pageX,event.pageY),t=$("#luckysheet-cols-h-c").scrollLeft(),l=e[0]+t,s=N(l)[2],c=g.deepCopyFlowData(b.flowdata),o=$("#luckysheetTableContent").get(0).getContext("2d"),n=$.extend(!0,{},b.config);null==n.columnlen&&(n.columnlen={});let i={},u=$("#luckysheet-cell-main").scrollTop(),h=b.luckysheetTableContentHW[1],r=ee(b.visibledatarow,u),a=ee(b.visibledatarow,u+h);(a+=a-r)>=c.length&&(a=c.length-1);for(let e=0;e<b.luckysheet_select_save.length;e++){let t=b.luckysheet_select_save[e].column[0],l=b.luckysheet_select_save[e].column[1];if(s<t||s>l){if(s in i)continue;let e=b.defaultcollen;for(let t=r;t<=a;t++){let l=c[t][s];if(null==l||G(l.v)&&!te(l))continue;let n=W(s)[1]-W(s)[0]-2,i=Z(l,o,{r:t,c:s,cellWidth:n}),u=0;null!=i&&(u=i.textWidthAll),u+6>e&&(e=u+6)}e!=b.defaultcollen&&(n.columnlen[s]=e,n.customWidth&&delete n.customWidth[s]),i[s]=1}else for(let e=t;e<=l;e++){if(e in i)continue;let t=b.defaultcollen;for(let l=r;l<=a;l++){let s=c[l][e];if(null==s||G(s.v)&&!te(s))continue;let n=W(e)[1]-W(e)[0]-2,i=Z(s,o,{r:l,c:e,cellWidth:n}),u=0;null!=i&&(u=i.textWidthAll),u+6>t&&(t=u+6)}t!=b.defaultcollen&&(n.columnlen[e]=t,n.customWidth&&delete n.customWidth[e]),i[e]=1}}V(b.flowdata[0].length,b.flowdata.length,b.flowdata,n,b.luckysheet_select_save,"resizeC","columnlen")}()}),$("#luckysheet-cols-menu-btn").click(function(e){let t=$("#luckysheet-rightclick-menu"),l=$(this).offset();$("#luckysheet-cols-rows-shift").show(),b.luckysheetRightHeadClickIs="column",$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-word").text(m().rightclick.column),$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-left").text(m().rightclick.left),$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-right").text(m().rightclick.right),$("#luckysheet-cols-rows-add").show(),$("#luckysheet-cols-rows-data").hide(),$("#luckysheet-cols-rows-shift").show(),$("#luckysheet-cols-rows-handleincell").hide(),P("#luckysheet-cols-rows-add .luckysheet-menuseparator").style.display="block",P("#luckysheet-cols-rows-shift .luckysheet-menuseparator").style.display="block";const s=x.cellRightClickConfig;(s.copy||s.copyAs||s.paste||s.insertColumn||s.deleteColumn||s.hideColumn||s.columnWidth||s.sort)&&(P("#luckysheet-top-left-add-selected").style.display=s.insertColumn?"block":"none",P("#luckysheet-bottom-right-add-selected").style.display=s.insertColumn?"block":"none",P("#luckysheet-del-selected").style.display=s.deleteColumn?"block":"none",P("#luckysheet-hide-selected").style.display=s.hideColumn?"block":"none",P("#luckysheet-show-selected").style.display=s.hideColumn?"block":"none",P("#luckysheet-column-row-width-selected").style.display=s.columnWidth?"block":"none",s.copy||s.copyAs||s.paste||(P("#luckysheet-cols-rows-add .luckysheet-menuseparator").style.display="none",s.insertColumn||s.deleteColumn||s.hideColumn||s.columnWidth||(P("#luckysheet-cols-rows-shift .luckysheet-menuseparator").style.display="none")),s.insertColumn||s.deleteColumn||s.hideColumn||s.columnWidth||(P("#luckysheet-cols-rows-add .luckysheet-menuseparator").style.display="none"),s.sort||(P("#luckysheet-cols-rows-shift .luckysheet-menuseparator").style.display="none"),H(t,l.left,l.top+18),b.luckysheet_cols_menu_status=!0)}),$("#luckysheet-top-left-add-selected").click(function(e){if("INPUT"===e.target.nodeName)return;$("#luckysheet-rightclick-menu").hide(),M();const t=m(),l=t.drag,s=t.info;if(b.luckysheet_select_save.length>1)return void(X()?alert(l.noMulti):f.info(l.noMulti,""));let c=$(this).find("input").val();if(!U(c))return void(X()?alert(s.tipInputNumber):f.info(s.tipInputNumber,""));if((c=parseInt(c))<1||c>100)return void(X()?alert(s.tipInputNumberLimit):f.info(s.tipInputNumberLimit,""));let o=b.luckysheet_select_save[0][b.luckysheetRightHeadClickIs][0];E(b.luckysheetRightHeadClickIs,o,c,"lefttop")}),$("#luckysheetColsRowsHandleAdd_row").click(function(e){if($("#luckysheet-rightclick-menu").hide(),M(),!1===b.allowEdit)return;let t=b.luckysheet_select_save[0].row[0];E("row",t,1,"lefttop")}),$("#luckysheetColsRowsHandleAdd_column").click(function(e){if($("#luckysheet-rightclick-menu").hide(),M(),!1===b.allowEdit)return;let t=b.luckysheet_select_save[0].column[0];E("column",t,1,"lefttop")}),$("#luckysheet-bottom-right-add-selected").click(function(e){if("INPUT"===e.target.nodeName)return;$("#luckysheet-rightclick-menu").hide(),M();const t=m(),l=t.drag,s=t.info;if(b.luckysheet_select_save.length>1)return void(X()?alert(l.noMulti):f.info(l.noMulti,""));let c=$(this).find("input").val();if(!U(c))return void(X()?alert(s.tipInputNumber):f.info(s.tipInputNumber,""));if((c=parseInt(c))<1||c>100)return void(X()?alert(s.tipInputNumberLimit):f.info(s.tipInputNumberLimit,""));let o=b.luckysheet_select_save[0][b.luckysheetRightHeadClickIs][1];E(b.luckysheetRightHeadClickIs,o,c,"rightbottom")}),$("#luckysheet-del-selected, #luckysheet-del-selected_t").click(function(e){$("#luckysheet-rightclick-menu").hide(),M();const t=m().drag;if(b.luckysheet_select_save.length>1)return void("row"==b.luckysheetRightHeadClickIs?X()?alert(t.noMulti):f.info(t.noMulti,""):"column"==b.luckysheetRightHeadClickIs&&(X()?alert(t.noMulti):f.info(t.noMulti,"")));let l=b.luckysheet_select_save[0][b.luckysheetRightHeadClickIs][0],s=b.luckysheet_select_save[0][b.luckysheetRightHeadClickIs][1];O(b.luckysheetRightHeadClickIs,l,s)}),$("#luckysheet-delRows").click(function(e){$("#luckysheet-rightclick-menu").hide(),M();const t=m().drag;if(b.luckysheet_select_save.length>1)return void("row"==b.luckysheetRightHeadClickIs?X()?alert(t.noMulti):f.info(t.noMulti,""):"column"==b.luckysheetRightHeadClickIs&&(X()?alert(t.noMulti):f.info(t.noMulti,"")));let l=b.luckysheet_select_save[0].row[0],s=b.luckysheet_select_save[0].row[1];O("row",l,s)}),$("#luckysheet-delCols").click(function(e){$("#luckysheet-rightclick-menu").hide(),M();const t=m().drag;if(b.luckysheet_select_save.length>1)return void("row"==b.luckysheetRightHeadClickIs?X()?alert(t.noMulti):f.info(t.noMulti,""):"column"==b.luckysheetRightHeadClickIs&&(X()?alert(t.noMulti):f.info(t.noMulti,"")));let l=b.luckysheet_select_save[0].column[0],s=b.luckysheet_select_save[0].column[1];O("column",l,s)}),$("#luckysheet-hide-selected").click(function(e){$("#luckysheet-rightclick-menu").hide(),M();const t=m().drag;if(b.luckysheet_select_save.length>1)"row"==b.luckysheetRightHeadClickIs?X()?alert(t.noMulti):f.info(t.noMulti,""):"column"==b.luckysheetRightHeadClickIs&&(X()?alert(t.noMulti):f.info(t.noMulti,""));else if("row"==b.luckysheetRightHeadClickIs){if(!ce(b.currentSheetIndex,"formatRows"))return;let e=$.extend(!0,{},b.config);null==e.rowhidden&&(e.rowhidden={});for(let t=0;t<b.luckysheet_select_save.length;t++){let l=b.luckysheet_select_save[t].row[0],s=b.luckysheet_select_save[t].row[1];for(let t=l;t<=s;t++)e.rowhidden[t]=0}if(b.clearjfundo){let t={type:"showHidRows"};t.sheetIndex=b.currentSheetIndex,t.config=$.extend(!0,{},b.config),t.curconfig=e,b.jfundo.length=0,b.jfredo.push(t)}b.config=e,b.luckysheetfile[T(b.currentSheetIndex)].config=b.config,c.saveParam("cg",b.currentSheetIndex,e.rowhidden,{k:"rowhidden"}),q(b.flowdata.length,b.flowdata[0].length)}else if("column"==b.luckysheetRightHeadClickIs){if(!ce(b.currentSheetIndex,"formatColumns"))return;let e=$.extend(!0,{},b.config);null==e.colhidden&&(e.colhidden={});for(let t=0;t<b.luckysheet_select_save.length;t++){let l=b.luckysheet_select_save[t].column[0],s=b.luckysheet_select_save[t].column[1];for(let t=l;t<=s;t++)e.colhidden[t]=0}if(b.clearjfundo){let t={type:"showHidCols"};t.sheetIndex=b.currentSheetIndex,t.config=$.extend(!0,{},b.config),t.curconfig=e,b.jfundo.length=0,b.jfredo.push(t)}b.config=e,b.luckysheetfile[T(b.currentSheetIndex)].config=b.config,c.saveParam("cg",b.currentSheetIndex,e.colhidden,{k:"colhidden"}),q(b.flowdata.length,b.flowdata[0].length)}}),$("#luckysheet-show-selected").click(function(e){$("#luckysheet-rightclick-menu").hide(),M();const t=m().drag;if(b.luckysheet_select_save.length>1)"row"==b.luckysheetRightHeadClickIs?X()?alert(t.noMulti):f.info(t.noMulti,""):"column"==b.luckysheetRightHeadClickIs&&(X()?alert(t.noMulti):f.info(t.noMulti,""));else if("row"==b.luckysheetRightHeadClickIs){if(!ce(b.currentSheetIndex,"formatRows"))return;let e=$.extend(!0,{},b.config);if(null==e.rowhidden)return;for(let t=0;t<b.luckysheet_select_save.length;t++){let l=b.luckysheet_select_save[t].row[0],s=b.luckysheet_select_save[t].row[1];for(let t=l;t<=s;t++)delete e.rowhidden[t]}if(b.clearjfundo){let t={type:"showHidRows"};t.sheetIndex=b.currentSheetIndex,t.config=$.extend(!0,{},b.config),t.curconfig=e,b.jfundo.length=0,b.jfredo.push(t)}b.config=e,b.luckysheetfile[T(b.currentSheetIndex)].config=b.config,c.saveParam("cg",b.currentSheetIndex,e.rowhidden,{k:"rowhidden"}),q(b.flowdata.length,b.flowdata[0].length)}else if("column"==b.luckysheetRightHeadClickIs){if(!ce(b.currentSheetIndex,"formatColumns"))return;let e=$.extend(!0,{},b.config);if(null==e.colhidden)return;for(let t=0;t<b.luckysheet_select_save.length;t++){let l=b.luckysheet_select_save[t].column[0],s=b.luckysheet_select_save[t].column[1];for(let t=l;t<=s;t++)delete e.colhidden[t]}if(b.clearjfundo){let t={type:"showHidCols"};t.sheetIndex=b.currentSheetIndex,t.config=$.extend(!0,{},b.config),t.curconfig=e,b.jfundo.length=0,b.jfredo.push(t)}b.config=e,b.luckysheetfile[T(b.currentSheetIndex)].config=b.config,c.saveParam("cg",b.currentSheetIndex,e.colhidden,{k:"colhidden"}),q(b.flowdata.length,b.flowdata[0].length)}}),$("#luckysheet-delCellsMoveLeft").click(function(e){$("body .luckysheet-cols-menu").hide(),M();const t=m().drag;if(b.luckysheet_select_save.length>1)return void(X()?alert(t.noMulti):f.info(t.noMulti,""));let l=b.luckysheet_select_save[0].row[0],s=b.luckysheet_select_save[0].row[1],c=b.luckysheet_select_save[0].column[0],o=b.luckysheet_select_save[0].column[1];B("moveLeft",l,s,c,o)}),$("#luckysheet-delCellsMoveUp").click(function(e){$("body .luckysheet-cols-menu").hide(),M();const t=m().drag;if(b.luckysheet_select_save.length>1)return void(X()?alert(t.noMulti):f.info(t.noMulti,""));let l=b.luckysheet_select_save[0].row[0],s=b.luckysheet_select_save[0].row[1],c=b.luckysheet_select_save[0].column[0],o=b.luckysheet_select_save[0].column[1];B("moveUp",l,s,c,o)}),$("#luckysheet-delete-text").click(function(){if(le(b.luckysheet_select_save,b.currentSheetIndex)&&($("#luckysheet-rightclick-menu").hide(),M(),!1!==b.allowEdit&&b.luckysheet_select_save.length>0)){let t=g.deepCopyFlowData(b.flowdata),l=!1;for(let e=0;e<b.luckysheet_select_save.length;e++){let t=b.luckysheet_select_save[e].row[0],s=b.luckysheet_select_save[e].row[1],c=b.luckysheet_select_save[e].column[0],o=b.luckysheet_select_save[e].column[1];if(K(b.config,t,s,c,o)){l=!0;break}}if(l){const e=m().drag;return void(X()?alert(e.noPartMerge):f.info(e.noPartMerge,""))}for(let l=0;l<b.luckysheet_select_save.length;l++){let s=b.luckysheet_select_save[l].row[0],c=b.luckysheet_select_save[l].row[1],o=b.luckysheet_select_save[l].column[0],n=b.luckysheet_select_save[l].column[1];for(let l=s;l<=c;l++)for(let s=o;s<=n;s++)e.isPivotRange(l,s)||("object"==S(t[l][s])?(delete t[l][s].m,delete t[l][s].v,null!=t[l][s].f&&(delete t[l][s].f,a.delFunctionGroup(l,s,b.currentSheetIndex),delete t[l][s].spl),null!=t[l][s].ct&&"inlineStr"==t[l][s].ct.t&&delete t[l][s].ct):t[l][s]=null)}D(t,b.luckysheet_select_save)}}),$("#luckysheet-column-row-width-selected").click(function(e){if("INPUT"===e.target.nodeName)return;$("#luckysheet-rightclick-menu").hide(),M();let t=parseInt($(this).closest(".luckysheet-cols-menuitem").find("input[type='number']").val().trim());const s=m().info;let o,n=$.extend(!0,{},b.config),i=null;if("row"==b.luckysheetRightHeadClickIs){if(!ce(b.currentSheetIndex,"formatRows"))return;if(t<0||t>545)return void(X()?alert(s.tipRowHeightLimit):f.info(s.tipRowHeightLimit,""));o="resizeR",null==n.rowlen&&(n.rowlen={});for(let e=0;e<b.luckysheet_select_save.length;e++){let s=b.luckysheet_select_save[e].row[0],c=b.luckysheet_select_save[e].row[1];for(let e=s;e<=c;e++)n.rowlen[e]=t,i=l.moveChangeSize("row",e,t)}}else if("column"==b.luckysheetRightHeadClickIs){if(!ce(b.currentSheetIndex,"formatColumns"))return;if(t<0||t>2038)return void(X()?alert(s.tipColumnWidthLimit):f.info(s.tipColumnWidthLimit,""));o="resizeC",null==n.columnlen&&(n.columnlen={});for(let e=0;e<b.luckysheet_select_save.length;e++){let s=b.luckysheet_select_save[e].column[0],c=b.luckysheet_select_save[e].column[1];for(let e=s;e<=c;e++)n.columnlen[e]=t,i=l.moveChangeSize("column",e,t)}}b.clearjfundo&&(b.jfundo.length=0,b.jfredo.push({type:"resize",ctrlType:o,sheetIndex:b.currentSheetIndex,config:$.extend(!0,{},b.config),curconfig:$.extend(!0,{},n),images:$.extend(!0,{},l.images),curImages:$.extend(!0,{},i)})),b.config=n,b.luckysheetfile[T(b.currentSheetIndex)].config=b.config,b.luckysheetfile[T(b.currentSheetIndex)].images=i,c.saveParam("all",b.currentSheetIndex,i,{k:"images"}),l.images=i,l.allImagesShow(),"row"==b.luckysheetRightHeadClickIs?(c.saveParam("cg",b.currentSheetIndex,n.rowlen,{k:"rowlen"}),q(b.flowdata.length,null)):"column"==b.luckysheetRightHeadClickIs&&(c.saveParam("cg",b.currentSheetIndex,n.columnlen,{k:"columnlen"}),q(null,b.flowdata[0].length))})},deleteRows:function(e,t,l){b.luckysheetRightHeadClickIs="column"},deleteColumns:function(){}}});
//# sourceMappingURL=../sourcemaps/controllers/rowColumnOperation.js.map
