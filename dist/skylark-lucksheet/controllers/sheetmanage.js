/**
 * skylark-lucksheet - A version of lucksheet.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["skylark-localForage","../methods/validate","../widgets/cleargridelement","../methods/getdata","../methods/setdata","../widgets/createdom","../widgets/tooltip","./formula","../methods/rhchInit","../methods/sheets","../widgets/extend","../utils/util","../widgets/constant","./server","../methods/luckysheetConfigsetting","./pivotTable","../widgets/resize","./postil","../widgets/imageCtrl","../widgets/dataVerificationCtrl","../widgets/hyperlinkCtrl","./freezen","./filter","../widgets/select","../store","../locale/locale","../expendPlugins/chart/plugin","../widgets/resize","./zoom","./menuButton"],function(e,t,l,s,i,h,c,o,n,a,r,u,d,f,y,k,m,g,v,x,S,p,w,b,_,C,I,T,P,z){"use strict";const{isRealNum:L}=t,A=y.isEditMode,{getcellvalue:H,datagridgrowth:F,getcellFormula:j}=s,{setcellvalue:R}=i,{luckysheetextendtable:O,luckysheetdeletetable:N}=r,{replaceHtml:B,getObjType:G,chatatABC:W,arrayRemoveItem:D}=u,{sheetHTML:M,luckysheetlodingHTML:E}=d,{createFilterOptions:V,labelFilterOptionState:Z}=w,{selectHightlightShow:K,selectionCopyShow:q}=b,{renderChartShow:J}=I,{changeSheetContainerSize:U,menuToolBarWidth:Q}=T,{zoomNumberDomBind:X}=P,Y=Object.assign(a,{addNewSheet:function(e,t){if(A()||!1===_.allowEdit)return;let s=_.luckysheetfile.length,i=this.generateRandomSheetIndex(),h=this.generateRandomSheetName(_.luckysheetfile,t);$("#luckysheet-sheet-container-c").append(B(M,{index:i,active:"",name:h,style:"",colorset:""}));let c={name:h,color:"",status:"0",order:s,index:i,celldata:[],row:_.defaultrowNum,column:_.defaultcolumnNum,config:{},pivotTable:null,isPivotTable:!!t};if(_.luckysheetfile.push(c),$("#luckysheet-sheet-area div.luckysheet-sheets-item").removeClass("luckysheet-sheets-item-active"),$("#luckysheet-sheets-item"+i).addClass("luckysheet-sheets-item-active"),$("#luckysheet-cell-main").append('<div id="luckysheet-datavisual-selection-set-'+i+'" class="luckysheet-datavisual-selection-set"></div>'),l(e),_.saveParam("sha",null,$.extend(!0,{},c)),_.clearjfundo){_.jfundo.length=0;let e={type:"addSheet"};e.sheetconfig=$.extend(!0,{},c),e.index=i,e.currentSheetIndex=_.currentSheetIndex,_.jfredo.push(e)}_.changeSheet(i,t,!0)},setSheetHide:function(e){let t=this.getSheetIndex(e);_.luckysheetfile[t].hide=1;let l,s=$("#luckysheet-sheets-item"+e);if(s.hide(),$("#luckysheet-sheet-area div.luckysheet-sheets-item").removeClass("luckysheet-sheets-item-active"),y.showsheetbarConfig.sheet)l=s.nextAll(":visible"),l=s.nextAll(":visible").length>0?l.eq(0).data("index"):s.prevAll(":visible").eq(0).data("index");else{let e,s=[];_.luckysheetfile.forEach((e,t)=>{1!==e.hide&&s.push(t)});let i=s.length;e=1===i?s[0]:s[i-1]>t?s.find(e=>e>t):s[i-1],l=_.luckysheetfile[e].index}$("#luckysheet-sheets-item"+l).addClass("luckysheet-sheets-item-active"),_.changeSheet(l),_.saveParam("sh",s.data("index"),1,{op:"hide",cur:l})},setSheetShow:function(e){_.luckysheetfile[this.getSheetIndex(e)].hide=0,_.changeSheet(e),_.saveParam("sh",e,0,{op:"show",cur:null})},sheetMaxIndex:0,ordersheet:function(e){return function(t,l){return t[e]-l[e]}},getCurrentOrder:function(){let e={};return $("#luckysheet-sheet-area div.luckysheet-sheets-item").each(function(t){let l=$(this).data("index");for(let s=0;s<_.luckysheetfile.length;s++)if(_.luckysheetfile[s].index==l){e[l.toString()]=t;break}}),e},reOrderAllSheet:function(){let e={};$("#luckysheet-sheet-area div.luckysheet-sheets-item").each(function(t){let l=$(this).data("index");for(let s=0;s<_.luckysheetfile.length;s++)if(_.luckysheetfile[s].index==l){_.luckysheetfile[s].order=t,e[l.toString()]=t;break}}),_.saveParam("shr",null,e),_.luckysheetfile.sort((e,t)=>{let l=e.order,s=t.order;return null!=l&&null!=s?l-s:null!=l?-1:1})},createSheet:function(){let e=[];_.luckysheetfile.sort(this.ordersheet("order"));for(let t=0;t<_.luckysheetfile.length;t++){let l="",s=_.luckysheetfile[t].index,i="";null!=_.luckysheetfile[t].color&&(i='<div class="luckysheet-sheets-item-color" style=" position: absolute; width: 100%; height: 3px; bottom: 0px; left: 0px; background-color: '+_.luckysheetfile[t].color+';"></div>'),_.currentSheetIndex==s?e.push(B(M,{index:s,active:"luckysheet-sheets-item-active",name:_.luckysheetfile[t].name,style:"",colorset:i})):(1==_.luckysheetfile[t].hide?e.push(B(M,{index:s,active:"",name:_.luckysheetfile[t].name,style:"display:none;",colorset:i})):e.push(B(M,{index:s,active:"",name:_.luckysheetfile[t].name,style:"",colorset:i})),l="style='display:none;'"),$("#luckysheet-cell-main").append("<div "+l+' id="luckysheet-datavisual-selection-set-'+s+'" class="luckysheet-datavisual-selection-set"></div>')}$("#luckysheet-sheet-container-c").append(e.join("")),this.locationSheet()},locationSheet:function(){let e=$("#luckysheet-sheet-container-c"),t=$("#"+_.container).width(),l=($("#luckysheet-sheet-container-c > div.luckysheet-sheets-item-active").eq(0),0),s=0;$("#luckysheet-sheet-container-c > div.luckysheet-sheets-item:visible").each(function(){$(this).hasClass("luckysheet-sheets-item-active")&&(l=s),s+=$(this).outerWidth()}),setTimeout(function(){e.scrollLeft(l-10),s>=.7*t&&y.showsheetbarConfig.sheet&&($("#luckysheet-sheet-area .luckysheet-sheets-scroll").css("display","inline-block"),$("#luckysheet-sheet-container .docs-sheet-fade-left").show())},1)},copySheet:function(e,t){if(A()||!1===_.allowEdit)return;let s=_.luckysheetfile.length,i=this.generateRandomSheetIndex(),h=this.getSheetIndex(e),c=$.extend(!0,{},_.luckysheetfile[h]);c.order=s,c.index=i,c.name=this.generateCopySheetName(_.luckysheetfile,c.name);let o="";null!=c.color&&(o='<div class="luckysheet-sheets-item-color" style=" position: absolute; width: 100%; height: 3px; bottom: 0px; left: 0px; background-color: '+c.color+';"></div>');let n=$("#luckysheet-sheets-item"+e);if($("#luckysheet-sheet-container-c").append(B(M,{index:c.index,active:"",name:c.name,order:c.order,style:"",colorset:o})),$("#luckysheet-sheets-item"+c.index).insertAfter(n),_.luckysheetfile.splice(h+1,0,c),$("#luckysheet-sheet-area div.luckysheet-sheets-item").removeClass("luckysheet-sheets-item-active"),$("#luckysheet-sheets-item"+i).addClass("luckysheet-sheets-item-active"),$("#luckysheet-cell-main").append('<div id="luckysheet-datavisual-selection-set-'+i+'" class="luckysheet-datavisual-selection-set"></div>'),l(t),_.saveParam("shc",i,{copyindex:e,name:c.name}),_.changeSheet(i),this.reOrderAllSheet(),_.clearjfundo)_.jfredo.push({type:"copySheet",copyindex:e,index:c.index,sheetIndex:c.index});else if(_.jfredo.length>0){let e=_.jfredo[_.jfredo.length-1];"copySheet"==e.type&&(e.index=c.index,e.sheetIndex=c.index)}},createSheetbydata:function(e,t,s=!0){let i="";if(null!=e.color&&(i='<div class="luckysheet-sheets-item-color" style=" position: absolute; width: 100%; height: 3px; bottom: 0px; left: 0px; background-color: '+e.color+';"></div>'),$("#luckysheet-sheet-container-c").append(B(M,{index:e.index,active:"",name:e.name,order:e.order,style:"",colorset:i})),s){let t=e.order;t>=_.luckysheetfile.length?(t=_.luckysheetfile.length-1,$("#luckysheet-sheets-item"+e.index).insertAfter($("#luckysheet-sheets-item"+_.luckysheetfile[t].index))):$("#luckysheet-sheets-item"+e.index).insertBefore($("#luckysheet-sheets-item"+_.luckysheetfile[t].index))}_.luckysheetfile.push(e),$("#luckysheet-sheet-area div.luckysheet-sheets-item").removeClass("luckysheet-sheets-item-active"),$("#luckysheet-sheets-item"+e.index).addClass("luckysheet-sheets-item-active"),$("#luckysheet-cell-main").append('<div id="luckysheet-datavisual-selection-set-'+e.index+'" class="luckysheet-datavisual-selection-set"></div>'),l(),null!=t?(_.saveParam("shre",null,{reIndex:e.index}),e.hide=0,_.saveParam("sh",e.index,0,{op:"show",cur:null})):_.saveParam("sha",null,e),_.changeSheet(e.index,e.isPivotTable,!0),this.reOrderAllSheet()},deleteSheet:function(e){if(!1===_.allowEdit)return;let t=this.getSheetIndex(e);this.setSheetHide(e),$("#luckysheet-sheets-item"+e).remove(),$("#luckysheet-datavisual-selection-set-"+e).remove();let l=_.luckysheetfile.splice(t,1);this.reOrderAllSheet(),_.saveParam("shd",null,{deleIndex:e}),_.clearjfundo&&(l[0].type="deleteSheet",_.jfredo.push(l[0]))},nulldata:null,initialjfFile:function(t,l){let s=this;s.getCurSheet();let i=_.luckysheetfile[s.getSheetIndex(_.currentSheetIndex)];s.nulldata=F([],_.defaultrowNum,_.defaultcolumnNum);let n=s.buildGridData(i),a=[];i.jfgird_select_save=i.jfgird_select_save||[],i.jfgird_select_save.forEach(e=>a.push({row:e.row,column:e.column})),i.luckysheet_select_save=a,this.sheetParamRestore(i,n);let r=_.luckysheet_select_save[0].row[1],u=_.luckysheet_select_save[0].column[1];if(_.luckysheet_select_save.length>1)for(let e=0;e<_.luckysheet_select_save.length;e++)_.luckysheet_select_save[e].row[1]>r&&(r=_.luckysheet_select_save[e].row[1]),_.luckysheet_select_save[e].column[1]>u&&(u=_.luckysheet_select_save[e].column[1]);z.fontInitial(_.fontList),i.data=n;let d=n.length;r>d-1&&(d=r+1);let k=n[0].length;u>k-1&&(k=u+1),"function"==typeof y.beforeCreateDom&&y.beforeCreateDom(luckysheet),"function"==typeof y.workbookCreateBefore&&y.workbookCreateBefore(luckysheet),h(k,d,n,t,l),setTimeout(function(){c.createHoverTip("#luckysheet_info_detail",".luckysheet_info_detail_back, .luckysheet_info_detail_input, .luckysheet_info_detail_update"),c.createHoverTip("#luckysheet-wa-editor",".luckysheet-toolbar-menu-button, .luckysheet-toolbar-button, .luckysheet-toolbar-combo-button"),_.luckysheetTableContentHW=[$("#luckysheet-cell-main").width()+_.rowHeaderWidth-_.cellMainSrollBarSize,$("#luckysheet-cell-main").height()+_.columnHeaderHeight-_.cellMainSrollBarSize],$("#luckysheetTableContent, #luckysheetTableContentF").attr({width:Math.ceil(_.luckysheetTableContentHW[0]*_.devicePixelRatio),height:Math.ceil(_.luckysheetTableContentHW[1]*_.devicePixelRatio)}).css({width:_.luckysheetTableContentHW[0],height:_.luckysheetTableContentHW[1]}).get(0).getContext("2d");let t=C().info,l=_.gridKey+"__qkcache",h=function(){i.load="1",s.createSheet();let e=function(){s.mergeCalculation(i.index),s.setSheetParam(!1),s.storeSheetParam(),s.restoreselect(),s.CacheNotLoadControll=[],s.restoreCache(),o.execFunctionGroupForce(y.forceCalculation),s.restoreSheetAll(_.currentSheetIndex),$("#luckysheet_info_detail_save").html(t.detailSave),i.isPivotTable?_.luckysheetcurrentisPivotTable=!0:(_.luckysheetcurrentisPivotTable=!1,$("#luckysheet-modal-dialog-slider-pivot").hide()),Q(),m(),null!=i.scrollLeft&&i.scrollLeft>0?$("#luckysheet-scrollbar-x").scrollLeft(i.scrollLeft):$("#luckysheet-scrollbar-x").scrollLeft(0),null!=i.scrollTop&&i.scrollTop>0?$("#luckysheet-scrollbar-y").scrollTop(i.scrollTop):$("#luckysheet-scrollbar-y").scrollTop(0),D(_.asyncLoad,"core"),y.pointEdit?setTimeout(function(){$("#luckysheetloadingdata").remove()},0):setTimeout(function(){$("#luckysheetloadingdata").fadeOut().remove()},500)},l=_.loadSheetUrl;if(""==l)s.loadOtherFile(i),e();else{let t=s.checkLoadSheetIndex(i),h=[];for(let e=0;e<t.length;e++){let l=t[e];l!=i.index&&h.push(l)}if(0===h.length)return void e();$.post(l,{gridKey:_.gridKey,index:h.join(",")},function(t){let l=new Function("return "+t)();for(let e in l){if(e==i.index)continue;let t=_.luckysheetfile[s.getSheetIndex(e)];null!=t.load&&"0"!=t.load||(t.celldata=l[e.toString()],t.data=s.buildGridData(t),t.load="1")}e()})}};try{e.getItem(l).then(function(e){null!=e&&(s.CacheNotLoadControll=e),f.clearcachelocaldata(function(){h()})})}catch(e){h(),console.log("缓存操作失败")}},1)},storeSheetParam:function(){let e=this.getSheetIndex(_.currentSheetIndex),t=_.luckysheetfile[e];t.config=_.config,t.visibledatarow=_.visibledatarow,t.visibledatacolumn=_.visibledatacolumn,t.ch_width=_.ch_width,t.rh_height=_.rh_height,t.luckysheet_select_save=$.extend(!0,[],_.luckysheet_select_save),t.luckysheet_selection_range=$.extend(!0,[],_.luckysheet_selection_range),$("#luckysheet-scrollbar-x")[0].scrollWidth>$("#luckysheet-scrollbar-x")[0].offsetWidth&&(t.scrollLeft=$("#luckysheet-scrollbar-x").scrollLeft()),$("#luckysheet-scrollbar-y")[0].scrollHeight>$("#luckysheet-scrollbar-y")[0].offsetHeight&&(t.scrollTop=$("#luckysheet-scrollbar-y").scrollTop()),t.zoomRatio=_.zoomRatio},setSheetParam:function(e=!0){let t=this.getSheetIndex(_.currentSheetIndex),l=_.luckysheetfile[t];_.flowdata=l.data,_.webWorkerFlowDataCache(_.flowdata),o.execFunctionGlobalData=null,window.luckysheet_getcelldata_cache=null,this.sheetParamRestore(l,_.flowdata),null==l.freezen?(_.freezenhorizontaldata=null,_.freezenverticaldata=null):(_.freezenhorizontaldata=null==l.freezen.horizontal?null:l.freezen.horizontal.freezenhorizontaldata,_.freezenverticaldata=null==l.freezen.vertical?null:l.freezen.vertical.freezenverticaldata),e&&n(_.flowdata.length,_.flowdata[0].length),g.buildAllPs(_.flowdata),v.currentImgId=null,v.images=l.images,v.allImagesShow(),v.init(),_.dataVerification=l.dataVerification,x.init(),S.hyperlink=l.hyperlink,S.init(),V(l.filter_select,l.filter)},restoreselect:function(){let e=this.getSheetIndex(_.currentSheetIndex),t=_.luckysheetfile[e];K(!0),q(),null!=t.scrollLeft&&t.scrollLeft>0?$("#luckysheet-scrollbar-x").scrollLeft(t.scrollLeft):$("#luckysheet-scrollbar-x").scrollLeft(0),null!=t.scrollTop&&t.scrollTop>0?$("#luckysheet-scrollbar-y").scrollTop(t.scrollTop):$("#luckysheet-scrollbar-y").scrollTop(0)},storeSheetParamALL:function(){this.storeSheetParam();let e=this.getSheetIndex(_.currentSheetIndex);_.luckysheetfile[e].data=_.flowdata,_.luckysheetfile[e].config=$.extend(!0,{},_.config)},mergeCalculationSheet:{},mergeCalculation:function(e){let t=_.luckysheetfile[this.getSheetIndex(e)],l=t.config,s=t.data;if(null==l)return;let i=l.merge;if(!(null==i||e in this.mergeCalculationSheet||!1===t.autoCalculationMerge)){this.mergeCalculationSheet[e]=1;for(let e in i){let t=parseInt(e.substr(0,e.indexOf("_"))),l=parseInt(e.substr(e.indexOf("_")+1)),h=i[e];null==s[t][l]&&(s[t][l]={}),s[t][l].mc={r:t,c:l,rs:h.rs,cs:h.cs};for(let e=t;e<t+h.rs;e++)for(let i=l;i<l+h.cs;i++)e==t&&i==l||(null==s[e][i]&&(s[e][i]={}),s[e][i].mc={r:t,c:l})}}},changeSheet:function(e,t,l){if(A())return;let s=this;if(e==_.currentSheetIndex)return;_.allowUpdate&&($("#luckysheet-cell-main #luckysheet-multipleRange-show").empty(),f.multipleIndex=0),y.createHookFunction("sheetActivate",e,t,l),$("#luckysheet-filter-selected-sheet"+_.currentSheetIndex+", #luckysheet-filter-options-sheet"+_.currentSheetIndex).hide(),$("#luckysheet-filter-selected-sheet"+e+", #luckysheet-filter-options-sheet"+e).show(),s.storeSheetParamALL(),s.setCurSheet(e);let i=_.luckysheetfile[s.getSheetIndex(e)];if(i.isPivotTable?(_.luckysheetcurrentisPivotTable=!0,t||k.changePivotTable(e)):(_.luckysheetcurrentisPivotTable=!1,$("#luckysheet-modal-dialog-slider-pivot").hide(),m(!1)),null!=i.load){let t=s.buildGridData(i);i.data=t,s.mergeCalculation(e),s.setSheetParam(!0),s.showSheet(),setTimeout(function(){o.execFunctionGroup(),_.refresh(),_.saveParam("shs",null,_.currentSheetIndex)},1)}else{let t=_.loadSheetUrl;if(""==t||_.luckysheetcurrentisPivotTable||l){let t=s.buildGridData(i);i.data=t,i.load="1",s.loadOtherFile(i),s.mergeCalculation(e),s.setSheetParam(),s.showSheet(),setTimeout(function(){s.restoreCache(),o.execFunctionGroupForce(y.forceCalculation),s.restoreSheetAll(_.currentSheetIndex),_.refresh()},1),_.saveParam("shs",null,_.currentSheetIndex)}else{$("#luckysheet-grid-window-1").append(E());let l=s.checkLoadSheetIndex(i);$.post(t,{gridKey:_.gridKey,index:l.join(",")},function(t){let l=new Function("return "+t)();i.celldata=l[e.toString()];let h=s.buildGridData(i);setTimeout(function(){$("#luckysheetloadingdata").fadeOut().remove()},500);for(let t in l){if(t==e)continue;let i=_.luckysheetfile[s.getSheetIndex(t)];null!=i.load&&"0"!=i.load||(i.celldata=l[t.toString()],i.data=s.buildGridData(i),i.load="1")}i.data=h,i.load="1",s.mergeCalculation(e),s.setSheetParam(),s.showSheet(),setTimeout(function(){s.restoreCache(),o.execFunctionGroupForce(y.forceCalculation),s.restoreSheetAll(_.currentSheetIndex),_.refresh()},1),_.saveParam("shs",null,_.currentSheetIndex)})}}$("#luckysheet-cell-main .luckysheet-datavisual-selection-set").hide(),$("#luckysheet-datavisual-selection-set-"+e).show(),J(e),p.initialFreezen(e),s.restoreselect()},showSheet:function(){$("#luckysheet-cell-flow_0").css({width:_.ch_width,top:"-1px"}),$("#luckysheet-sheettable_0").css({width:_.ch_width-1,height:_.rh_height}),$("#luckysheetrowHeader_0").css("height",_.rh_height),$("#luckysheet-cols-h-cells_0").css("width",_.ch_width),$("#luckysheet-scrollbar-x div").width(_.ch_width),$("#luckysheet-scrollbar-y div").height(_.rh_height+_.columnHeaderHeight-_.cellMainSrollBarSize-3);let e=this.getSheetIndex(_.currentSheetIndex),t=_.luckysheetfile[e];_.scrollRefreshSwitch=!1,null!=t.scrollLeft&&t.scrollLeft>0?$("#luckysheet-scrollbar-x").scrollLeft(t.scrollLeft*_.zoomRatio):$("#luckysheet-scrollbar-x").scrollLeft(0),null!=t.scrollTop&&t.scrollTop>0?$("#luckysheet-scrollbar-y").scrollTop(t.scrollTop*_.zoomRatio):$("#luckysheet-scrollbar-y").scrollTop(0),setTimeout(()=>{_.scrollRefreshSwitch=!0},0),X(_.zoomRatio)},changeSheetExec:function(e,t,s){let i=$("#luckysheet-sheets-item"+e);window.luckysheet_getcelldata_cache=null,$("#luckysheet-sheet-area div.luckysheet-sheets-item").removeClass("luckysheet-sheets-item-active"),i.addClass("luckysheet-sheets-item-active").show(),l(),this.changeSheet(e,t,s),$("#luckysheet-sheet-list, #luckysheet-rightclick-sheet-menu").hide(),o.rangestart&&o.createRangeHightlight(),this.sheetBarShowAndHide(e)},sheetArrowShowAndHide(){let e=$("#luckysheet-sheet-container").width(),t=0;$("#luckysheet-sheet-container-c > div.luckysheet-sheets-item:visible").each(function(){t+=$(this).outerWidth()}),t>=e?y.showsheetbarConfig.sheet&&($("#luckysheet-sheet-area .luckysheet-sheets-scroll").css("display","inline-block"),$("#luckysheet-sheet-container .docs-sheet-fade-left").show()):($("#luckysheet-sheet-area .luckysheet-sheets-scroll").css("display","none"),$("#luckysheet-sheet-container .docs-sheet-fade-left").hide())},sheetBarShowAndHide(e){let t=$("#luckysheet-sheet-container-c");if(null!=e){let l=$("#luckysheet-sheets-item"+e);t.scrollLeft(l.offset().left)}let l=t.width(),s=t[0].scrollWidth,i=t.scrollLeft();i<=0?$("#luckysheet-sheet-container .docs-sheet-fade-left").hide():$("#luckysheet-sheet-container .docs-sheet-fade-left").show(),l+i>=s?$("#luckysheet-sheet-container .docs-sheet-fade-right").hide():$("#luckysheet-sheet-container .docs-sheet-fade-right").show()},restoreFilter:function(e){let t=this.getSheetIndex(e),l=_.luckysheetfile[t];if("string"==G(l.filter_select)&&(l.filter_select=JSON.parse(l.filter_select)),null==l.filter_select||null==l.filter_select.row||null==l.filter_select.column)return;V(l.filter_select),"object"!=G(l.filter)&&null!=l.filter&&"string"==G(l.filter)&&(l.filter=JSON.parse(l.filter));let s={};null!=l.config&&null!=l.config.rowhidden&&(s=l.config.rowhidden),$("#luckysheet-filter-options-sheet"+e+" .luckysheet-filter-options").each(function(e){if(null==l.filter)return!1;let t=$(this),i=l.filter[e];if(null==i)return!0;"object"!=G(i)&&(i=JSON.parse(i)),Z(t,i.optionstate,i.rowhidden,i.caljs,!1,i.st_r,i.ed_r,i.cindex,i.st_c,i.ed_c),s=$.extend(!0,s,i.rowhidden)}),null==l.config&&(l.config={}),l.config.rowhidden=s,_.config=l.config,_.refreshGrid_rhcw(_.flowdata.length,_.flowdata[0].length,!1)},restorePivot:function(e){let t=this.getSheetIndex(e);_.luckysheetfile[t].isPivotTable&&(k.getCellData(e),k.initialPivotManage(!0),k.refreshPivotTable(!1))},restoreSheetAll:function(e){this.restorePivot(e),this.restoreFilter(e),this.restoreFreezen(e)},restoreFreezen:function(e){p.initialFreezen(e)},restoreCache:function(){let e=this,t=e.CacheNotLoadControll;if(e.CacheNotLoadControll=[],0!=t.length)for(let l=0;l<t.length;l++){let s=t[l];e.execCache(s)}}});function ee(e){let t=_.getSheetByIndex();g.buildAllPs(t.data),v.images=t.images,v.allImagesShow(),v.init(),null==t.config&&(t.config={}),null==t.config.sheetViewZoom&&(t.config.sheetViewZoom={});let l=t.config.curentsheetView;null==l&&(l="viewNormal"),t.config.sheetViewZoom[l+"ZoomScale"]=e,_.saveParam("all",_.currentSheetIndex,_.zoomRatio,{k:"zoomRatio"}),_.saveParam("cg",_.currentSheetIndex,t.config.sheetViewZoom,{k:"sheetViewZoom"}),_.refreshGrid_rhcw(_.flowdata.length,_.flowdata[0].length),U()}return _.onSheetChanging=Y.changeSheetExec.bind(Y),_.onActive=function(){Y.showSheet(),setTimeout(function(){Y.restoreCache(),o.execFunctionGroup(),Y.restoreSheetAll(_.currentSheetIndex),_.refresh()},1)},_.onInvalidate=function(){Y.sheetArrowShowAndHide(),Y.sheetBarShowAndHide()},_.onZoomChange=function(e){ee(e)},Y});
//# sourceMappingURL=../sourcemaps/controllers/sheetmanage.js.map
