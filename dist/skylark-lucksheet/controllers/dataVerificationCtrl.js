/**
 * skylark-lucksheet - A version of lucksheet.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["../utils/util","../global/formula","../global/validate","../global/datecontroll","../global/refresh","../global/tooltip","../global/setdata","../global/getdata","../global/editor","./constant","./select","./server","./menuButton","./sheetmanage","../methods/get","../locale/locale","../store"],function(e,t,i,a,o,n,l,c,d,r,s,u,h,f,p,v,g){"use strict";const{replaceHtml:b}=e,{isRealNum:y,isRealNull:m}=i,{isdatetime:w,diff:x}=a,{luckysheetrefreshgrid:k}=o,{setcellvalue:V}=l,{getcellvalue:_}=c,{modelHTML:L}=r,{selectionCopyShow:I}=s,{getSheetIndex:R,getRangetxt:S}=p;return{defaultItem:{type:"dropdown",type2:null,value1:"",value2:"",checked:!1,remote:!1,prohibitInput:!1,hintShow:!1,hintText:""},curItem:null,dataVerification:null,selectRange:[],selectStatus:!1,optionLabel:{number:"数值",number_integer:"整数",number_decimal:"小数",bw:"介于",nb:"不介于",eq:"等于",ne:"不等于",gt:"大于",lt:"小于",gte:"大于等于",lte:"小于等于",include:"包括",exclude:"不包括",equal:"等于",bf:"早于",nbf:"不早于",af:"晚于",naf:"不晚于",card:"身份证号码",phone:"手机号"},optionLabel_en:{number:"numeric",number_integer:"integer",number_decimal:"decimal",bw:"between",nb:"not between",eq:"equal to",ne:"not equal to",gt:"greater",lt:"less than",gte:"greater or equal to",lte:"less than or equal to",include:"include",exclude:"not include",equal:"equal to",bf:"earlier than",nbf:"not earlier than",af:"later than",naf:"not later than",card:"identification number",phone:"phone number"},createDialog:function(){const e=v(),t=e.dataVerification,i=e.toolbar,a=e.button;$("#luckysheet-modal-dialog-mask").show(),$("#luckysheet-dataVerification-dialog").remove();let o=`<div class="box">\n                            <div class="box-item" style="border-top:1px solid #E1E4E8;">\n                                <div class="box-item-title">${t.cellRange}</div>\n                                <div id="data-verification-range" class="range">\n                                    <input class="formulaInputFocus" spellcheck="false">\n                                    <i class="fa fa-table" aria-hidden="true" title="${t.selectCellRange}"></i>\n                                </div>\n                            </div>\n                            <div class="box-item">\n                                <div class="box-item-title">${t.verificationCondition}</div>\n                                <select id="data-verification-type-select">\n                                    <option value="dropdown">${t.dropdown}</option>\n                                    <option value="checkbox">${t.checkbox}</option>\n                                    <option value="number">${t.number}</option>\n                                    <option value="number_integer">${t.number_integer}</option>\n                                    <option value="number_decimal">${t.number_decimal}</option>\n                                    <option value="text_content">${t.text_content}</option>\n                                    <option value="text_length">${t.text_length}</option>\n                                    <option value="date">${t.date}</option>\n                                    <option value="validity">${t.validity}</option>\n                                </select>\n                                <div class="show-box">\n                                    <div class="show-box-item show-box-item-dropdown">\n                                        <div class="range">\n                                            <input class="formulaInputFocus data-verification-value1" placeholder="${t.placeholder1}" spellcheck="false">\n                                            <i class="fa fa-table" aria-hidden="true" title="${t.selectCellRange}"></i>\n                                        </div>\n                                    </div>\n                                    <div class="show-box-item show-box-item-checkbox">\n                                        <div class="check-box">\n                                            <span>${t.selected} ——</span>\n                                            <input type="text" class="data-verification-value1" placeholder="${t.placeholder2}">\n                                        </div>\n                                        <div class="check-box">\n                                            <span>${t.notSelected} ——</span>\n                                            <input type="text" class="data-verification-value2" placeholder="${t.placeholder2}">\n                                        </div>\n                                    </div>\n                                    <div class="show-box-item show-box-item-number">\n                                        <select id="data-verification-number-select">\n                                            <option value="bw">${t.between}</option>\n                                            <option value="nb">${t.notBetween}</option>\n                                            <option value="eq">${t.equal}</option>\n                                            <option value="ne">${t.notEqualTo}</option>\n                                            <option value="gt">${t.moreThanThe}</option>\n                                            <option value="lt">${t.lessThan}</option>\n                                            <option value="gte">${t.greaterOrEqualTo}</option>\n                                            <option value="lte">${t.lessThanOrEqualTo}</option>\n                                        </select>\n                                        <div class="input input1">\n                                            <input type="number" class="data-verification-value1" placeholder="1">\n                                            <span>-</span>\n                                            <input type="number" class="data-verification-value2" placeholder="100">\n                                        </div>\n                                        <div class="input input2">\n                                            <input type="number" class="data-verification-value1" placeholder="${t.placeholder3}">\n                                        </div>\n                                    </div>\n                                    <div class="show-box-item show-box-item-text">\n                                        <select id="data-verification-text-select">\n                                            <option value="include">${t.include}</option>\n                                            <option value="exclude">${t.exclude}</option>\n                                            <option value="equal">${t.equal}</option>\n                                        </select>\n                                        <div class="input input2">\n                                            <input type="text" class="data-verification-value1" placeholder="${t.placeholder4}"/>\n                                        </div>\n                                    </div>\n                                    <div class="show-box-item show-box-item-textLength">\n                                        <select id="data-verification-textLength-select">\n                                            <option value="bw">${t.between}</option>\n                                            <option value="nb">${t.notBetween}</option>\n                                            <option value="eq">${t.equal}</option>\n                                            <option value="ne">${t.notEqualTo}</option>\n                                            <option value="gt">${t.moreThanThe}</option>\n                                            <option value="lt">${t.lessThan}</option>\n                                            <option value="gte">${t.greaterOrEqualTo}</option>\n                                            <option value="lte">${t.lessThanOrEqualTo}</option>\n                                        </select>\n                                        <div class="input input1">\n                                            <input type="number" class="data-verification-value1" placeholder="1">\n                                            <span>-</span>\n                                            <input type="number" class="data-verification-value2" placeholder="100">\n                                        </div>\n                                        <div class="input input2">\n                                            <input type="number" class="data-verification-value1" placeholder="${t.placeholder3}">\n                                        </div>\n                                    </div>\n                                    <div class="show-box-item show-box-item-date">\n                                        <select id="data-verification-date-select">\n                                            <option value="bw">${t.between}</option>\n                                            <option value="nb">${t.notBetween}</option>\n                                            <option value="eq">${t.equal}</option>\n                                            <option value="ne">${t.notEqualTo}</option>\n                                            <option value="bf">${t.earlierThan}</option>\n                                            <option value="nbf">${t.noEarlierThan}</option>\n                                            <option value="af">${t.laterThan}</option>\n                                            <option value="naf">${t.noLaterThan}</option>\n                                        </select>\n                                        <div class="input input1">\n                                            <input type="date" class="data-verification-value1" placeholder="2020/9/10">\n                                            <span>-</span>\n                                            <input type="date" class="data-verification-value2" placeholder="2020/9/10">\n                                        </div>\n                                        <div class="input input2">\n                                            <input type="date" class="data-verification-value1" placeholder="2020/9/10">\n                                        </div>\n                                    </div>\n                                    <div class="show-box-item show-box-item-validity">\n                                        <select id="data-verification-validity-select">\n                                            <option value="card">${t.identificationNumber}</option>\n                                            <option value="phone">${t.phoneNumber}</option>\n                                        </select>\n                                    </div>\n                                </div>\n                            </div>\n                            <div class="box-item">\n                                <div class="check">\n                                    <input type="checkbox" id="data-verification-remote" class="data-verification-remote">\n                                    <label for="data-verification-remote">${t.remote}</label>\n                                </div>\n                                <div class="check">\n                                    <input type="checkbox" id="data-verification-prohibitInput">\n                                    <label for="data-verification-prohibitInput">${t.prohibitInput}</label>\n                                </div>\n                                <div class="check">\n                                    <input type="checkbox" id="data-verification-hint-show">\n                                    <label for="data-verification-hint-show">${t.hintShow}</label>\n                                </div>\n                                <div class="data-verification-hint-text">\n                                    <input type="text" placeholder="${t.placeholder5}">\n                                </div>\n                            </div>\n                        </div>`;$("body").append(b(L,{id:"luckysheet-dataVerification-dialog",addclass:"luckysheet-dataVerification-dialog",title:i.dataVerification,content:o,botton:`<button id="luckysheet-dataVerification-dialog-confirm" class="btn btn-primary">${a.confirm}</button>\n                        <button id="luckysheet-dataVerification-dialog-delete" class="btn btn-default">${t.deleteVerification}</button>\n                        <button class="btn btn-default luckysheet-model-close-btn">${a.cancel}</button>`,style:"z-index:100003"}));let n=$("#luckysheet-dataVerification-dialog").find(".luckysheet-modal-dialog-content").css("min-width",350).end(),l=n.outerHeight(),c=n.outerWidth(),d=$(window).width(),r=$(window).height(),s=$(document).scrollLeft(),u=$(document).scrollTop();$("#luckysheet-dataVerification-dialog").css({left:(d+s-c)/2,top:(r+u-l)/3}).show(),this.dataAllocation()},init:function(){let e=this;const i=v().dataVerification;$(document).off("click.dropdownBtn").on("click.dropdownBtn","#luckysheet-dataVerification-dropdown-btn",function(t){e.dropdownListShow(),t.stopPropagation()}),$(document).off("click.dropdownListItem").on("click.dropdownListItem","#luckysheet-dataVerification-dropdown-List .dropdown-List-item",function(e){$("#luckysheet-dataVerification-dropdown-List").hide();let i=e.target.innerText,a=g.luckysheet_select_save[g.luckysheet_select_save.length-1],o=a.row_focus,n=a.column_focus;$("#luckysheet-rich-text-editor").text(i),t.updatecell(o,n),e.stopPropagation()}),$(document).off("click.dvRange").on("click.dvRange","#data-verification-range .fa-table",function(i){$("#luckysheet-dataVerification-dialog").hide();let a=$(this).siblings("input").val().trim();e.rangeDialog("0",a),e.selectRange=[];let o=e.getRangeByTxt(a);if(t.rangetosheet=g.currentSheetIndex,o[0].sheetIndex!=g.currentSheetIndex&&f.changeSheetExec(o[0].sheetIndex),o.length>0)for(let t=0;t<o.length;t++){let i=o[t].row[0],a=o[t].row[1],n=o[t].column[0],l=o[t].column[1],c=g.visibledatarow[a],d=i-1==-1?0:g.visibledatarow[i-1],r=g.visibledatacolumn[l],s=n-1==-1?0:g.visibledatacolumn[n-1];e.selectRange.push({left:s,width:r-s-1,top:d,height:c-d-1,left_move:s,width_move:r-s-1,top_move:d,height_move:c-d-1,row:[i,a],column:[n,l],row_focus:i,column_focus:n})}I(e.selectRange)}),$(document).off("click.dvRange2").on("click.dvRange2","#luckysheet-dataVerification-dialog .show-box-item-dropdown .range .fa-table",function(i){$("#luckysheet-dataVerification-dialog").hide();let a=$(this).siblings("input").val().trim();e.rangeDialog("1",a),e.selectRange=[];let o=e.getRangeByTxt(a);if(t.rangetosheet=g.currentSheetIndex,o[0].sheetIndex!=g.currentSheetIndex&&f.changeSheetExec(o[0].sheetIndex),o.length>0)for(let t=0;t<o.length;t++){let i=o[t].row[0],a=o[t].row[1],n=o[t].column[0],l=o[t].column[1],c=g.visibledatarow[a],d=i-1==-1?0:g.visibledatarow[i-1],r=g.visibledatacolumn[l],s=n-1==-1?0:g.visibledatacolumn[n-1];e.selectRange.push({left:s,width:r-s-1,top:d,height:c-d-1,left_move:s,width_move:r-s-1,top_move:d,height_move:c-d-1,row:[i,a],column:[n,l],row_focus:i,column_focus:n})}I(e.selectRange)}),$(document).off("click.dvRangeConfirm").on("click.dvRangeConfirm","#luckysheet-dataVerificationRange-dialog-confirm",function(i){let a=$(this).attr("data-source"),o=$(this).parents("#luckysheet-dataVerificationRange-dialog").find("input").val();if(e.getRangeByTxt(o).length>1)return void n.info('<i class="fa fa-exclamation-triangle"></i>',"不能对多重选择区域执行此操作，请选择单个区域，然后再试");"0"==a?$("#luckysheet-dataVerification-dialog #data-verification-range input").val(o):"1"==a&&$("#luckysheet-dataVerification-dialog .show-box-item-dropdown .range input").val(o),$("#luckysheet-dataVerificationRange-dialog").hide(),$("#luckysheet-modal-dialog-mask").show(),$("#luckysheet-dataVerification-dialog").show(),null!=t.rangetosheet&&t.rangetosheet!=g.currentSheetIndex&&(f.changeSheetExec(t.rangetosheet),t.rangetosheet=null);I([])}),$(document).off("click.dvRangeClose").on("click.dvRangeClose","#luckysheet-dataVerificationRange-dialog-close",function(e){$("#luckysheet-dataVerificationRange-dialog").hide(),$("#luckysheet-modal-dialog-mask").show(),$("#luckysheet-dataVerification-dialog").show(),null!=t.rangetosheet&&t.rangetosheet!=g.currentSheetIndex&&(f.changeSheetExec(t.rangetosheet),t.rangetosheet=null);I([])}),$(document).on("click","#luckysheet-dataVerificationRange-dialog .luckysheet-modal-dialog-title-close",function(e){$("#luckysheet-dataVerificationRange-dialog").hide(),$("#luckysheet-modal-dialog-mask").show(),$("#luckysheet-dataVerification-dialog").show(),null!=t.rangetosheet&&t.rangetosheet!=g.currentSheetIndex&&(f.changeSheetExec(t.rangetosheet),t.rangetosheet=null);I([])}),$(document).off("change.typeSelect").on("change.typeSelect","#data-verification-type-select",function(t){$("#luckysheet-dataVerification-dialog .show-box .show-box-item").hide();let i=this.value,a=e.curItem;if("dropdown"==i){$("#luckysheet-dataVerification-dialog .show-box .show-box-item-dropdown").show();let e="";i==a.type&&(e=a.value1),$("#luckysheet-dataVerification-dialog .show-box-item-dropdown .data-verification-value1").val(e)}else if("checkbox"==i){$("#luckysheet-dataVerification-dialog .show-box .show-box-item-checkbox").show();let e="",t="";i==a.type&&(e=a.value1,t=a.value2),$("#luckysheet-dataVerification-dialog .show-box-item-checkbox .data-verification-value1").val(e),$("#luckysheet-dataVerification-dialog .show-box-item-checkbox .data-verification-value2").val(t)}else if("number"==i||"number_integer"==i||"number_decimal"==i){$("#luckysheet-dataVerification-dialog .show-box-item-number").show(),$("#luckysheet-dataVerification-dialog .show-box-item-number .input").hide();let e="bw",t="",i="";"number"!=a.type&&"number_integer"!=a.type&&"number_decimal"!=a.type||(e=a.type2,t=a.value1,i=a.value2),$("#luckysheet-dataVerification-dialog #data-verification-number-select").val(e),"bw"==e||"nb"==e?$("#luckysheet-dataVerification-dialog .show-box-item-number .input1").show():$("#luckysheet-dataVerification-dialog .show-box-item-number .input2").show(),$("#luckysheet-dataVerification-dialog .show-box-item-number .data-verification-value1").val(t),$("#luckysheet-dataVerification-dialog .show-box-item-number .data-verification-value2").val(i)}else if("text_content"==i){$("#luckysheet-dataVerification-dialog .show-box-item-text").show();let e="include",t="";i==a.type&&(e=a.type2,t=a.value1),$("#luckysheet-dataVerification-dialog #data-verification-text-select").val(e),$("#luckysheet-dataVerification-dialog .show-box-item-text .data-verification-value1").val(t)}else if("text_length"==i){$("#luckysheet-dataVerification-dialog .show-box-item-textLength").show(),$("#luckysheet-dataVerification-dialog .show-box-item-textLength .input").hide();let e="bw",t="",o="";i==a.type&&(e=a.type2,t=a.value1,o=a.value2),$("#luckysheet-dataVerification-dialog #data-verification-textLength-select").val(e),"bw"==e||"nb"==e?$("#luckysheet-dataVerification-dialog .show-box-item-textLength .input1").show():$("#luckysheet-dataVerification-dialog .show-box-item-textLength .input2").show(),$("#luckysheet-dataVerification-dialog .show-box-item-textLength .data-verification-value1").val(t),$("#luckysheet-dataVerification-dialog .show-box-item-textLength .data-verification-value2").val(o)}else if("date"==i){$("#luckysheet-dataVerification-dialog .show-box-item-date").show(),$("#luckysheet-dataVerification-dialog .show-box-item-date .input").hide();let e="bw",t="",o="";i==a.type&&(e=a.type2,t=a.value1,o=a.value2),$("#luckysheet-dataVerification-dialog #data-verification-date-select").val(e),"bw"==e||"nb"==e?$("#luckysheet-dataVerification-dialog .show-box-item-date .input1").show():$("#luckysheet-dataVerification-dialog .show-box-item-date .input2").show(),$("#luckysheet-dataVerification-dialog .show-box-item-date .data-verification-value1").val(t),$("#luckysheet-dataVerification-dialog .show-box-item-date .data-verification-value2").val(o)}else if("validity"==i){$("#luckysheet-dataVerification-dialog .show-box .show-box-item-validity").show();let e="card";i==a.type&&(e=a.type2),$("#luckysheet-dataVerification-dialog #data-verification-validity-select").val(e)}}),$(document).off("change.numberSelect").on("change.numberSelect","#data-verification-number-select",function(e){$("#luckysheet-dataVerification-dialog .show-box-item-number .input").hide();let t=this.value;"bw"==t||"nb"==t?$("#luckysheet-dataVerification-dialog .show-box-item-number .input1").show():$("#luckysheet-dataVerification-dialog .show-box-item-number .input2").show()}),$(document).off("change.dateSelect").on("change.dateSelect","#data-verification-date-select",function(e){$("#luckysheet-dataVerification-dialog .show-box-item-date .input").hide();let t=this.value;"bw"==t||"nb"==t?$("#luckysheet-dataVerification-dialog .show-box-item-date .input1").show():$("#luckysheet-dataVerification-dialog .show-box-item-date .input2").show()}),$(document).off("change.hintShow").on("change.hintShow","#data-verification-hint-show",function(e){this.checked?$("#luckysheet-dataVerification-dialog .data-verification-hint-text").show():$("#luckysheet-dataVerification-dialog .data-verification-hint-text").hide()}),$(document).off("click.dvSaveConfirm").on("click.dvSaveConfirm","#luckysheet-dataVerification-dialog-confirm",function(t){let a=$("#luckysheet-dataVerification-dialog #data-verification-range input").val().trim(),o=e.getRangeByTxt(a);if(0==o.length)return void n.info('<i class="fa fa-exclamation-triangle"></i>',i.selectCellRange2);let l=o[o.length-1].row[0],c=o[o.length-1].row[1],r=o[o.length-1].column[0],s=o[o.length-1].column[1],u=d.deepCopyFlowData(g.flowdata);l<0&&(l=0),c>u.length-1&&(c=u.length-1),r<0&&(r=0),s>u[0].length-1&&(s=u[0].length-1);let h=$("#luckysheet-dataVerification-dialog #data-verification-type-select").val(),f=null,p="",v="";if("dropdown"==h){if(0==(p=$("#luckysheet-dataVerification-dialog .show-box-item-dropdown .data-verification-value1").val().trim()).length)return void n.info('<i class="fa fa-exclamation-triangle"></i>',i.tooltipInfo1)}else if("checkbox"==h){if(p=$("#luckysheet-dataVerification-dialog .show-box-item-checkbox .data-verification-value1").val().trim(),v=$("#luckysheet-dataVerification-dialog .show-box-item-checkbox .data-verification-value2").val().trim(),0==p.length||0==v.length)return void n.info('<i class="fa fa-exclamation-triangle"></i>',i.tooltipInfo2)}else if("number"==h||"number_integer"==h||"number_decimal"==h){if(f=$("#luckysheet-dataVerification-dialog #data-verification-number-select").val(),p=$("#luckysheet-dataVerification-dialog .show-box-item-number .input:visible .data-verification-value1").val().trim(),!y(p))return void n.info('<i class="fa fa-exclamation-triangle"></i>',i.tooltipInfo3);if("bw"==f||"nb"==f){if(v=$("#luckysheet-dataVerification-dialog .show-box-item-number .input:visible .data-verification-value2").val().trim(),!y(v))return void n.info('<i class="fa fa-exclamation-triangle"></i>',i.tooltipInfo3);if(Number(v)<Number(p))return void n.info('<i class="fa fa-exclamation-triangle"></i>',i.tooltipInfo4)}}else if("text_content"==h){if(f=$("#luckysheet-dataVerification-dialog #data-verification-text-select").val(),0==(p=$("#luckysheet-dataVerification-dialog .show-box-item-text .data-verification-value1").val().trim()).length)return void n.info('<i class="fa fa-exclamation-triangle"></i>',i.tooltipInfo5)}else if("text_length"==h){if(f=$("#luckysheet-dataVerification-dialog #data-verification-textLength-select").val(),p=$("#luckysheet-dataVerification-dialog .show-box-item-textLength .input:visible .data-verification-value1").val().trim(),!y(p))return void n.info('<i class="fa fa-exclamation-triangle"></i>',i.tooltipInfo3);if("bw"==f||"nb"==f){if(v=$("#luckysheet-dataVerification-dialog .show-box-item-textLength .input:visible .data-verification-value2").val().trim(),!y(v))return void n.info('<i class="fa fa-exclamation-triangle"></i>',i.tooltipInfo3);if(Number(v)<Number(p))return void n.info('<i class="fa fa-exclamation-triangle"></i>',i.tooltipInfo4)}}else if("date"==h){if(f=$("#luckysheet-dataVerification-dialog #data-verification-date-select").val(),p=$("#luckysheet-dataVerification-dialog .show-box-item-date .input:visible .data-verification-value1").val().trim(),!w(p))return void n.info('<i class="fa fa-exclamation-triangle"></i>',i.tooltipInfo6);if("bw"==f||"nb"==f){if(v=$("#luckysheet-dataVerification-dialog .show-box-item-date .input:visible .data-verification-value2").val().trim(),!w(v))return void n.info('<i class="fa fa-exclamation-triangle"></i>',i.tooltipInfo6);if(x(p,v)>0)return void n.info('<i class="fa fa-exclamation-triangle"></i>',i.tooltipInfo7)}}else"validity"==h&&(f=$("#luckysheet-dataVerification-dialog #data-verification-validity-select").val());let b=$("#luckysheet-dataVerification-dialog #data-verification-remote").is(":checked"),m=$("#luckysheet-dataVerification-dialog #data-verification-prohibitInput").is(":checked"),k=$("#luckysheet-dataVerification-dialog #data-verification-hint-show").is(":checked"),_="";k&&(_=$("#luckysheet-dataVerification-dialog .data-verification-hint-text input").val().trim());let L={type:h,type2:f,value1:p,value2:v,checked:!1,remote:b,prohibitInput:m,hintShow:k,hintText:_},I=$.extend(!0,{},e.dataVerification),R=$.extend(!0,{},e.dataVerification);for(let e=l;e<=c;e++)for(let t=r;t<=s;t++)R[e+"_"+t]=L,"checkbox"==h&&V(e,t,u,L.value2);"checkbox"==h?e.refOfCheckbox(I,R,g.currentSheetIndex,u,o[o.length-1]):e.ref(I,R,g.currentSheetIndex),$("#luckysheet-modal-dialog-mask").hide(),$("#luckysheet-dataVerification-dialog").hide()}),$(document).off("click.delete").on("click.delete","#luckysheet-dataVerification-dialog-delete",function(t){let a=$("#luckysheet-dataVerification-dialog #data-verification-range input").val().trim(),o=e.getRangeByTxt(a);if(0==o.length)return void n.info('<i class="fa fa-exclamation-triangle"></i>',i.selectCellRange2);let l=$.extend(!0,{},e.dataVerification),c=$.extend(!0,{},e.dataVerification),d=o[o.length-1].row[0],r=o[o.length-1].row[1],s=o[o.length-1].column[0],u=o[o.length-1].column[1];for(let e=d;e<=r;e++)for(let t=s;t<=u;t++)delete c[e+"_"+t];e.ref(l,c,g.currentSheetIndex),$("#luckysheet-modal-dialog-mask").hide(),$("#luckysheet-dataVerification-dialog").hide()}),$(document).on("click","#luckysheet-info .luckysheet-modal-dialog-title-close, #luckysheet-info .luckysheet-model-close-btn",function(e){$(this).parents("#luckysheet-info").hide(),$("#luckysheet-dataVerification-dialog").is(":visible")&&$("#luckysheet-modal-dialog-mask").show(),e.stopPropagation()})},dataAllocation:function(){let e=this,t=g.luckysheet_select_save[g.luckysheet_select_save.length-1],i=S(g.currentSheetIndex,t,g.currentSheetIndex);$("#luckysheet-dataVerification-dialog #data-verification-range input").val(i);let a=t.row_focus||t.row[0],o=t.column_focus||t.column[0],n=$.extend(!0,{},e.dataVerification)[a+"_"+o];null==n&&(n=$.extend(!0,{},e.defaultItem)),e.curItem=n,$("#luckysheet-dataVerification-dialog #data-verification-type-select").val(n.type),$("#luckysheet-dataVerification-dialog .show-box .show-box-item").hide(),"dropdown"==n.type?($("#luckysheet-dataVerification-dialog .show-box .show-box-item-dropdown").show(),$("#luckysheet-dataVerification-dialog .show-box-item-dropdown .data-verification-value1").val(n.value1)):"checkbox"==n.type?($("#luckysheet-dataVerification-dialog .show-box .show-box-item-checkbox").show(),$("#luckysheet-dataVerification-dialog .show-box-item-checkbox .data-verification-value1").val(n.value1),$("#luckysheet-dataVerification-dialog .show-box-item-checkbox .data-verification-value2").val(n.value2)):"number"==n.type||"number_integer"==n.type||"number_decimal"==n.type?($("#luckysheet-dataVerification-dialog .show-box-item-number").show(),$("#luckysheet-dataVerification-dialog #data-verification-number-select").val(n.type2),$("#luckysheet-dataVerification-dialog .show-box-item-number .input").hide(),"bw"==n.type2||"nb"==n.type2?$("#luckysheet-dataVerification-dialog .show-box-item-number .input1").show():$("#luckysheet-dataVerification-dialog .show-box-item-number .input2").show(),$("#luckysheet-dataVerification-dialog .show-box-item-number .data-verification-value1").val(n.value1),$("#luckysheet-dataVerification-dialog .show-box-item-number .data-verification-value2").val(n.value2)):"text_content"==n.type?($("#luckysheet-dataVerification-dialog .show-box-item-text").show(),$("#luckysheet-dataVerification-dialog #data-verification-text-select").val(n.type2),$("#luckysheet-dataVerification-dialog .show-box-item-text .data-verification-value1").val(n.value1)):"text_length"==n.type?($("#luckysheet-dataVerification-dialog .show-box-item-textLength").show(),$("#luckysheet-dataVerification-dialog #data-verification-textLength-select").val(n.type2),$("#luckysheet-dataVerification-dialog .show-box-item-textLength .input").hide(),"bw"==n.type2||"nb"==n.type2?$("#luckysheet-dataVerification-dialog .show-box-item-textLength .input1").show():$("#luckysheet-dataVerification-dialog .show-box-item-textLength .input2").show(),$("#luckysheet-dataVerification-dialog .show-box-item-textLength .data-verification-value1").val(n.value1),$("#luckysheet-dataVerification-dialog .show-box-item-textLength .data-verification-value2").val(n.value2)):"date"==n.type?($("#luckysheet-dataVerification-dialog .show-box-item-date").show(),$("#luckysheet-dataVerification-dialog #data-verification-date-select").val(n.type2),$("#luckysheet-dataVerification-dialog .show-box-item-date .input").hide(),"bw"==n.type2||"nb"==n.type2?$("#luckysheet-dataVerification-dialog .show-box-item-date .input1").show():$("#luckysheet-dataVerification-dialog .show-box-item-date .input2").show(),$("#luckysheet-dataVerification-dialog .show-box-item-date .data-verification-value1").val(n.value1),$("#luckysheet-dataVerification-dialog .show-box-item-date .data-verification-value2").val(n.value2)):"validity"==n.type&&($("#luckysheet-dataVerification-dialog .show-box .show-box-item-validity").show(),$("#luckysheet-dataVerification-dialog #data-verification-validity-select").val(n.type2)),$("#luckysheet-dataVerification-dialog #data-verification-remote").prop("checked",n.remote),$("#luckysheet-dataVerification-dialog #data-verification-prohibitInput").prop("checked",n.prohibitInput),$("#luckysheet-dataVerification-dialog #data-verification-hint-show").prop("checked",n.hintShow),n.hintShow?$("#luckysheet-dataVerification-dialog .data-verification-hint-text").show():$("#luckysheet-dataVerification-dialog .data-verification-hint-text").hide(),$("#luckysheet-dataVerification-dialog .data-verification-hint-text input").val(n.hintText)},rangeDialog:function(e,t){const i=v(),a=i.dataVerification,o=i.button;$("#luckysheet-modal-dialog-mask").hide(),$("#luckysheet-dataVerificationRange-dialog").remove(),$("body").append(b(L,{id:"luckysheet-dataVerificationRange-dialog",addclass:"luckysheet-dataVerificationRange-dialog",title:a.selectCellRange,content:`<input readonly="readonly" placeholder="${a.selectCellRange2}" value="${t}"/>`,botton:`<button id="luckysheet-dataVerificationRange-dialog-confirm" class="btn btn-primary" data-source="${e}">${o.confirm}</button>\n                        <button id="luckysheet-dataVerificationRange-dialog-close" class="btn btn-default">${o.close}</button>`,style:"z-index:100003"}));let n=$("#luckysheet-dataVerificationRange-dialog").find(".luckysheet-modal-dialog-content").css("min-width",300).end(),l=n.outerHeight(),c=n.outerWidth(),d=$(window).width(),r=$(window).height(),s=$(document).scrollLeft(),u=$(document).scrollTop();$("#luckysheet-dataVerificationRange-dialog").css({left:(d+s-c)/2,top:(r+u-l)/3}).show()},getTxtByRange:function(e){if(e.length>0){let t=[];for(let i=0;i<e.length;i++){let a=e[i].row[0],o=e[i].row[1],n=e[i].column[0],l=e[i].column[1];t.push(S(g.currentSheetIndex,{row:[a,o],column:[n,l]},g.currentSheetIndex))}return t.join(",")}},getRangeByTxt:function(e){let i=[];if(-1!=e.indexOf(",")){let a=e.split(",");for(let e=0;e<a.length;e++){if(!t.iscelldata(a[e])){i=[];break}i.push(t.getcellrange(a[e]))}}else t.iscelldata(e)&&i.push(t.getcellrange(e));return i},cellFocus:function(e,t,i){$("#luckysheet-dataVerification-dropdown-btn").hide(),$("#luckysheet-dataVerification-showHintBox").hide();let a=this;if(null==a.dataVerification||null==a.dataVerification[e+"_"+t])return void $("#luckysheet-dataVerification-dropdown-List").hide();let o=g.visibledatarow[e],n=0==e?0:g.visibledatarow[e-1],l=g.visibledatacolumn[t],c=0==t?0:g.visibledatacolumn[t-1],d=h.mergeborer(g.flowdata,e,t);d&&(o=d.row[1],n=d.row[0],l=d.column[1],c=d.column[0]);let r=a.dataVerification[e+"_"+t];if(i&&"checkbox"==r.type)return void a.checkboxChange(e,t);if("dropdown"==r.type){if($("#luckysheet-dataVerification-dropdown-btn").show().css({"max-width":l-c,"max-height":o-n,left:l-20,top:n+(o-n-20)/2}),$("#luckysheet-dataVerification-dropdown-List").is(":visible")){$("#luckysheet-dataVerification-dropdown-List").prop("data-index")!=e+"_"+t&&$("#luckysheet-dataVerification-dropdown-List").hide()}}else $("#luckysheet-dataVerification-dropdown-List").hide();if(r.hintShow){let e;return e="en"==g.lang?'<span style="color:#f5a623;">Hint: </span>':'<span style="color:#f5a623;">提示：</span>',e+=a.getHintText(r),void $("#luckysheet-dataVerification-showHintBox").html(e).show().css({left:c,top:o})}let s=_(e,t,null);if(!m(s)&&!a.validateCellData(s,r)){let e;e="en"==g.lang?'<span style="color:#f72626;">Failure: </span>':'<span style="color:#f72626;">失效：</span>',e+=a.getFailureText(r),$("#luckysheet-dataVerification-showHintBox").html(e).show().css({left:c,top:o})}},getHintText:function(e){let t=this,i=e.hintText||"";return 0==i.length&&("en"==g.lang?"dropdown"==e.type?i+="please select an option in the drop-down list":"checkbox"==e.type||("number"==e.type||"number_integer"==e.type||"number_decimal"==e.type?(i+="please enter a "+t.optionLabel_en[e.type]+" "+t.optionLabel_en[e.type2]+" "+e.value1,"bw"!=e.type2&&"nb"!=e.type2||(i+=" and "+e.value2)):"text_content"==e.type?i+="please enter text "+t.optionLabel_en[e.type2]+" "+e.value1:"text_length"==e.type?(i+="please enter text with length "+t.optionLabel_en[e.type2]+" "+e.value1,"bw"!=e.type2&&"nb"!=e.type2||(i+=" and "+e.value2)):"date"==e.type?(i+="please enter a date "+t.optionLabel_en[e.type2]+" "+e.value1,"bw"!=e.type2&&"nb"!=e.type2||(i+=" and "+e.value2)):"validity"==e.type&&(i+="please enter the correct "+t.optionLabel_en[e.type2])):"dropdown"==e.type?i+="请选择下拉列表中的选项":"checkbox"==e.type||("number"==e.type||"number_integer"==e.type||"number_decimal"==e.type?(i+="请输入"+t.optionLabel[e.type2]+e.value1,"bw"!=e.type2&&"nb"!=e.type2||(i+="和"+e.value2+"之间"),i+="的"+t.optionLabel[e.type]):"text_content"==e.type?i+="请输入内容"+t.optionLabel[e.type2]+e.value1+"的文本":"text_length"==e.type?(i+="请输入长度"+t.optionLabel[e.type2]+e.value1,"bw"!=e.type2&&"nb"!=e.type2||(i+="和"+e.value2+"之间"),i+="的文本"):"date"==e.type?(i+="请输入"+t.optionLabel[e.type2]+e.value1,"bw"!=e.type2&&"nb"!=e.type2||(i+="和"+e.value2+"之间"),i+="的日期"):"validity"==e.type&&(i+="请输入正确的"+t.optionLabel[e.type2]))),i},getFailureText:function(e){let t=this,i="";return"en"==g.lang?"dropdown"==e.type?i+="what you selected is not an option in the drop-down list":"checkbox"==e.type||("number"==e.type||"number_integer"==e.type||"number_decimal"==e.type?(i+="what you entered is not a "+t.optionLabel_en[e.type]+" "+t.optionLabel_en[e.type2]+" "+e.value1,"bw"!=e.type2&&"nb"!=e.type2||(i+=" and "+e.value2)):"text_content"==e.type?i+="what you entered is not text that "+t.optionLabel_en[e.type2]+" "+e.value1:"text_length"==e.type?(i+="the text you entered is not length "+t.optionLabel_en[e.type2]+" "+e.value1,"bw"!=e.type2&&"nb"!=e.type2||(i+=" and "+e.value2)):"date"==e.type?(i+="the date you entered is not "+t.optionLabel_en[e.type2]+" "+e.value1,"bw"!=e.type2&&"nb"!=e.type2||(i+=" and "+e.value2)):"validity"==e.type&&(i+="what you entered is not a correct "+t.optionLabel_en[e.type2])):"dropdown"==e.type?i+="你选择的不是下拉列表中的选项":"checkbox"==e.type||("number"==e.type||"number_integer"==e.type||"number_decimal"==e.type?(i+="你输入的不是"+t.optionLabel[e.type2]+e.value1,"bw"!=e.type2&&"nb"!=e.type2||(i+="和"+e.value2+"之间"),i+="的"+t.optionLabel[e.type]):"text_content"==e.type?i+="你输入的不是内容"+t.optionLabel[e.type2]+e.value1+"的文本":"text_length"==e.type?(i+="你输入的不是长度"+t.optionLabel[e.type2]+e.value1,"bw"!=e.type2&&"nb"!=e.type2||(i+="和"+e.value2+"之间"),i+="的文本"):"date"==e.type?(i+="你输入的不是"+t.optionLabel[e.type2]+e.value1,"bw"!=e.type2&&"nb"!=e.type2||(i+="和"+e.value2+"之间"),i+="的日期"):"validity"==e.type&&(i+="你输入的不是一个正确的"+t.optionLabel[e.type2])),i},validateCellData:function(e,t){let i=this,a=t.type,o=t.type2,n=t.value1,l=t.value2;if("dropdown"==a){let t=i.getDropdownList(n),a=!1;for(let i=0;i<t.length;i++)if(t[i]==e){a=!0;break}return a}if("checkbox"==a);else if("number"==a||"number_integer"==a||"number_decimal"==a){if(!y(e))return!1;if(e=Number(e),"number_integer"==a&&e%1!=0)return!1;if("number_decimal"==a&&e%1==0)return!1;if(n=Number(n),l=Number(l),"bw"==o&&(e<n||e>l))return!1;if("nb"==o&&e>=n&&e<=l)return!1;if("eq"==o&&e!=n)return!1;if("ne"==o&&e==n)return!1;if("gt"==o&&e<=n)return!1;if("lt"==o&&e>=n)return!1;if("gte"==o&&e<n)return!1;if("lte"==o&&e>n)return!1}else if("text_content"==a){if(e=e.toString(),n=n.toString(),"include"==o&&-1==e.indexOf(n))return!1;if("exclude"==o&&e.indexOf(n)>-1)return!1;if("equal"==o&&e!=n)return!1}else if("text_length"==a){if(e=e.toString().length,n=Number(n),l=Number(l),"bw"==o&&(e<n||e>l))return!1;if("nb"==o&&e>=n&&e<=l)return!1;if("eq"==o&&e!=n)return!1;if("ne"==o&&e==n)return!1;if("gt"==o&&e<=n)return!1;if("lt"==o&&e>=n)return!1;if("gte"==o&&e<n)return!1;if("lte"==o&&e>n)return!1}else if("date"==a){if(!w(e))return!1;if("bw"==o&&(x(e,n)<0||x(e,l)>0))return!1;if("nb"==o&&x(e,n)>=0&&x(e,l)<=0)return!1;if("eq"==o&&0!=x(e,n))return!1;if("ne"==o&&0==x(e,n))return!1;if("bf"==o&&x(e,n)>=0)return!1;if("nbf"==o&&x(e,n)<0)return!1;if("af"==o&&x(e,n)<=0)return!1;if("naf"==o&&x(e,n)>0)return!1}else if("validity"==a){if("card"==o&&!/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/.test(e))return!1;if("phone"==o&&!/^[1][3,4,5,7,8][0-9]{9}$/.test(e))return!1}return!0},dropdownListShow:function(){$("#luckysheet-dataVerification-showHintBox").hide();let e=g.luckysheet_select_save[g.luckysheet_select_save.length-1],t=e.row_focus,i=e.column_focus,a=g.visibledatarow[t],o=0==t?0:g.visibledatarow[t-1],n=g.visibledatacolumn[i],l=0==i?0:g.visibledatacolumn[i-1],c=h.mergeborer(g.flowdata,t,i);c&&(a=c.row[1],o=c.row[0],n=c.column[1],l=c.column[0]);let d=this.dataVerification[t+"_"+i],r="";this.getDropdownList(d.value1).forEach(e=>{r+=`<div class="dropdown-List-item luckysheet-mousedown-cancel">${e}</div>`}),$("#luckysheet-dataVerification-dropdown-List").html(r).prop("data-index",t+"_"+i).show().css({width:n-l-1,left:l,top:a});let s=$("#luckysheet-dataVerification-dropdown-List").outerHeight();a+s>$("#luckysheet-cell-main")[0].scrollHeight-42-6&&$("#luckysheet-dataVerification-dropdown-List").css({top:o-s})},getDropdownList:function(e){let i=[];if(t.iscelldata(e)){let a=t.getcellrange(e),o=g.luckysheetfile[R(a.sheetIndex)].data;for(let e=a.row[0];e<=a.row[1];e++)for(let t=a.column[0];t<=a.column[1];t++){if(null==o[e])continue;let a=o[e][t];if(null==a||null==a.v)continue;let n=a.m||a.v;i.includes(n)||i.push(n)}}else{let t=e.split(",");for(let e=0;e<t.length;e++){let a=t[e];0!=a.length&&(i.includes(a)||i.push(a))}}return i},checkboxChange:function(e,t){let i=$.extend(!0,{},this.dataVerification),a=$.extend(!0,{},this.dataVerification),o=a[e+"_"+t];o.checked=!o.checked;let n=o.value2;o.checked&&(n=o.value1);let l=d.deepCopyFlowData(g.flowdata);V(e,t,l,n),this.refOfCheckbox(i,a,g.currentSheetIndex,l,{row:[e,e],column:[t,t]})},ref:function(e,t,i){if(g.clearjfundo){g.jfundo.length=0;let a={type:"updateDataVerification"};a.sheetIndex=i,a.historyDataVerification=e,a.currentDataVerification=t,g.jfredo.push(a)}this.dataVerification=t,g.luckysheetfile[R(i)].dataVerification=t,u.allowUpdate&&u.saveParam("all",i,t,{k:"dataVerification"}),setTimeout(function(){k()},1)},refOfCheckbox:function(e,t,i,a,o){if(g.clearjfundo){g.jfundo.length=0;let n={type:"updateDataVerificationOfCheckbox"};n.sheetIndex=i,n.historyDataVerification=e,n.currentDataVerification=t,n.data=g.flowdata,n.curData=a,n.range=o,g.jfredo.push(n)}this.dataVerification=t,g.luckysheetfile[R(i)].dataVerification=t,g.flowdata=a,d.webWorkerFlowDataCache(g.flowdata),g.luckysheetfile[R(i)].data=g.flowdata,u.allowUpdate&&(u.saveParam("all",i,t,{k:"dataVerification"}),u.historyParam(g.flowdata,i,o)),setTimeout(function(){k()},1)}}});
//# sourceMappingURL=../sourcemaps/controllers/dataVerificationCtrl.js.map
