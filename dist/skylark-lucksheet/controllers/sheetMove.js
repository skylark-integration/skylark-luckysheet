/**
 * skylark-lucksheet - A version of lucksheet.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["../utils/util","./formula","../methods/validate","../methods/count","../methods/cells","../widgets/select","./pivotTable","../store"],function(e,l,t,o,n,c,u,r){"use strict";const{getObjType:i}=e,{isRealNull:f}=t,{countfunc:s}=o,{selectHightlightShow:a}=c;function h(e,t,o,c){null==c&&(c=!0);let i,f,h,w,m,g,d,b,v=r.flowdata.length,_=r.flowdata[0].length;if("rangeOfSelect"==o){let o,c,s=r.luckysheet_select_save[r.luckysheet_select_save.length-1];o=null==s.row_focus?s.row[0]:s.row_focus,c=null==s.column_focus?s.column[0]:s.column_focus;let k=n.mergeborer(r.flowdata,o,c);if(k){let l=k.row[2],n=k.row[3],u=k.column[2],r=k.column[3];t>0?"down"==e?(o=n,c=u):"right"==e&&(o=l,c=r):(o=l,c=u)}let p=null==s.moveXY?o:s.moveXY.x,y=null==s.moveXY?c:s.moveXY.y;"down"==e?p=o+=t:"right"==e&&(y=c+=t),o>=v&&(p=o=v-1),o<0&&(p=o=0),c>=_&&(y=c=_-1),c<0&&(y=c=0);let $=n.mergeborer(r.flowdata,o,c);$?(i=$.row[1],f=$.row[0],h=$.row[2],w=$.row[3],m=$.column[1],g=$.column[0],d=$.column[2],b=$.column[3]):(i=r.visibledatarow[p],f=p-1==-1?0:r.visibledatarow[p-1],h=p,w=p,m=r.visibledatacolumn[y],g=y-1==-1?0:r.visibledatacolumn[y-1],d=y,b=y),s.row=[h,w],s.column=[d,b],s.row_focus=h,s.column_focus=d,s.moveXY={x:p,y:y},a(),u.pivotclick(h,d),l.fucntionboxshow(h,d)}else if("rangeOfFormula"==o){let o,c,u=l.func_selectedrange;o=null==u.row_focus?u.row[0]:u.row_focus,c=null==u.column_focus?u.column[0]:u.column_focus;let s=n.mergeborer(r.flowdata,o,c);if(s){let l=s.row[2],n=s.row[3],u=s.column[2],r=s.column[3];t>0?"down"==e?(o=n,c=u):"right"==e&&(o=l,c=r):(o=l,c=u)}let a=null==u.moveXY?o:u.moveXY.x,k=null==u.moveXY?c:u.moveXY.y;"down"==e?a=o+=t:"right"==e&&(k=c+=t),o>=v&&(a=o=v-1),o<0&&(a=o=0),c>=_&&(k=c=_-1),c<0&&(k=c=0);let p=n.mergeborer(r.flowdata,o,c);p?(i=p.row[1],f=p.row[0],h=p.row[2],w=p.row[3],m=p.column[1],g=p.column[0],d=p.column[2],b=p.column[3]):(i=r.visibledatarow[a],f=a-1==-1?0:r.visibledatarow[a-1],h=a,w=a,m=r.visibledatacolumn[k],g=k-1==-1?0:r.visibledatacolumn[k-1],d=k,b=k),l.func_selectedrange={left:g,width:m-g-1,top:f,height:i-f-1,left_move:g,width_move:m-g-1,top_move:f,height_move:i-f-1,row:[h,w],column:[d,b],row_focus:h,column_focus:d,moveXY:{x:a,y:k}},$("#luckysheet-formula-functionrange-select").css({left:g,width:m-g-1,top:f,height:i-f-1}).show(),l.rangeSetValue({row:[h,w],column:[d,b]})}let k=$("#luckysheet-cell-main").scrollLeft(),p=$("#luckysheet-cell-main").scrollTop(),y=$("#luckysheet-cell-main").height(),T=$("#luckysheet-cell-main").width(),j=0,M=0;m-k-T+20>0?(j=m-T+20,c&&$("#luckysheet-scrollbar-x").scrollLeft(j)):g-k-20<0&&(j=g-20,c&&$("#luckysheet-scrollbar-x").scrollLeft(j)),i-p-y+20>0?(M=i-y+20,c&&$("#luckysheet-scrollbar-y").scrollTop(M)):f-p-20<0&&(M=f-20,c&&$("#luckysheet-scrollbar-y").scrollTop(M)),clearTimeout(r.countfuncTimeout),s(),r.saveParam("mv",r.currentSheetIndex,r.luckysheet_select_save)}function w(e,t,o,c){let u,i,f,h;if(null==c&&(c=!0),"rangeOfSelect"==o){let l=r.luckysheet_select_save[r.luckysheet_select_save.length-1],o=l.row[0],c=l.row[1],s=l.column[0],w=l.column[1],v=l.row_focus,_=l.column_focus,k=r.flowdata.length,p=r.flowdata[0].length;if("down"==e){if(m(v,s,w)){let e=d(v,s,w),l=e[0],n=e[1];l>o&&n==c?(t>0&&m(o,s,w)&&(o=d(o,s,w)[1]),o+=t):n<c&&l==o?(t<0&&m(c,s,w)&&(c=d(c,s,w)[0]),c+=t):t>0?c+=t:o+=t}else v>o&&v==c?(t>0&&m(o,s,w)&&(o=d(o,s,w)[1]),o+=t):v<c&&v==o?(t<0&&m(c,s,w)&&(c=d(c,s,w)[0]),c+=t):v==o&&v==c&&(t>0?c+=t:o+=t);c>=k&&(c=k-1),c<0&&(c=0),o>=k&&(o=k-1),o<0&&(o=0)}else{if(g(_,o,c)){let e=b(_,o,c),l=e[0],n=e[1];l>s&&n==w?(t>0&&g(s,o,c)&&(s=b(s,o,c)[1]),s+=t):n<w&&l==s?(t<0&&g(w,o,c)&&(w=b(w,o,c)[0]),w+=t):t>0?w+=t:s+=t}else _>s&&_==w?(t>0&&g(s,o,c)&&(s=b(s,o,c)[1]),s+=t):_<w&&_==s?(t<0&&g(w,o,c)&&(w=b(w,o,c)[0]),w+=t):_==s&&_==w&&(t>0?w+=t:s+=t);w>=p&&(w=p-1),w<0&&(w=0),s>=p&&(s=p-1),s<0&&(s=0)}let y=[o,c],$=[s,w];u=r.visibledatarow[c],i=o-1==-1?0:r.visibledatarow[o-1],f=r.visibledatacolumn[w],h=s-1==-1?0:r.visibledatacolumn[s-1];let T=n.mergeMoveMain($,y,l,i,u-i-1,h,f-h-1);null!=T&&($=T[0],y=T[1]),l.row=y,l.column=$,a()}else if("rangeOfFormula"==o){let o=l.func_selectedrange,c=o.row[0],s=o.row[1],a=o.column[0],w=o.column[1],v=o.row_focus,_=o.column_focus,k=r.flowdata.length,p=r.flowdata[0].length;if("down"==e){if(m(v,a,w)){let e=d(v,a,w),l=e[0],o=e[1];l>c&&o==s?(t>0&&m(c,a,w)&&(c=d(c,a,w)[1]),c+=t):o<s&&l==c?(t<0&&m(s,a,w)&&(s=d(s,a,w)[0]),s+=t):t>0?s+=t:c+=t}else v>c&&v==s?(t>0&&m(c,a,w)&&(c=d(c,a,w)[1]),c+=t):v<s&&v==c?(t<0&&m(s,a,w)&&(s=d(s,a,w)[0]),s+=t):v==c&&v==s&&(t>0?s+=t:c+=t);s>=k&&(s=k-1),s<0&&(s=0),c>=k&&(c=k-1),c<0&&(c=0)}else{if(g(_,c,s)){let e=b(_,c,s),l=e[0],o=e[1];l>a&&o==w?(t>0&&g(a,c,s)&&(a=b(a,c,s)[1]),a+=t):o<w&&l==a?(t<0&&g(w,c,s)&&(w=b(w,c,s)[0]),w+=t):t>0?w+=t:a+=t}else _>a&&_==w?(t>0&&g(a,c,s)&&(a=b(a,c,s)[1]),a+=t):_<w&&_==a?(t<0&&g(w,c,s)&&(w=b(w,c,s)[0]),w+=t):_==a&&_==w&&(t>0?w+=t:a+=t);w>=p&&(w=p-1),w<0&&(w=0),a>=p&&(a=p-1),a<0&&(a=0)}let y=[c,s],T=[a,w];u=r.visibledatarow[s],i=c-1==-1?0:r.visibledatarow[c-1],f=r.visibledatacolumn[w];let j=i,M=u-i-1,x=h=a-1==-1?0:r.visibledatacolumn[a-1],L=f-h-1,S=n.mergeMoveMain(T,y,o,j,M,x,L);null!=S&&(T=S[0],y=S[1],j=S[2],M=S[3],x=S[4],L=S[5]),l.func_selectedrange={left:x,width:L,top:j,height:M,left_move:x,width_move:L,top_move:j,height_move:M,row:y,column:T,row_focus:v,column_focus:_},$("#luckysheet-formula-functionrange-select").css({left:x,width:L,top:j,height:M}).show(),l.rangeSetValue({row:y,column:T})}let w=$("#luckysheet-cell-main").scrollLeft(),v=$("#luckysheet-cell-main").scrollTop(),_=$("#luckysheet-cell-main").height(),k=$("#luckysheet-cell-main").width(),p=0,y=0;f-w-k+20>0?(p=f-k+20,c&&$("#luckysheet-scrollbar-x").scrollLeft(p)):h-w-20<0&&(p=h-20,c&&$("#luckysheet-scrollbar-x").scrollLeft(p)),u-v-_+20>0?(y=u-_+20,c&&$("#luckysheet-scrollbar-y").scrollTop(y)):i-v-20<0&&(y=i-20,c&&$("#luckysheet-scrollbar-y").scrollTop(y)),clearTimeout(r.countfuncTimeout),s()}function m(e,l,t){let o=!1;for(let n=l;n<=t;n++){let l=r.flowdata[e][n];if("object"==i(l)&&"mc"in l){o=!0;break}}return o}function g(e,l,t){let o=!1;for(let n=l;n<=t;n++){let l=r.flowdata[n][e];if("object"==i(l)&&"mc"in l){o=!0;break}}return o}function d(e,l,t){let o=r.flowdata.length-1,n=null;if(e>0)for(let o=e;o>=0;o--){for(let e=l;e<=t;e++){let l=r.flowdata[o][e];if("object"==i(l)&&"mc"in l){let e=r.config.merge[l.mc.r+"_"+l.mc.c];(null==n||e.r<n)&&(n=e.r)}}if(!(m(n-1,l,t)&&n>0))break;o=n-1}else n=0;let c=null;if(e<o)for(let n=e;n<=o;n++){for(let e=l;e<=t;e++){let l=r.flowdata[n][e];if("object"==i(l)&&"mc"in l){let e=r.config.merge[l.mc.r+"_"+l.mc.c];(null==c||e.r+e.rs-1>c)&&(c=e.r+e.rs-1)}}if(!(m(c+1,l,t)&&c<o))break;n=c+1}else c=o;return[n,c]}function b(e,l,t){let o=r.flowdata[0].length-1,n=null;if(e>0)for(let o=e;o>=0;o--){for(let e=l;e<=t;e++){let l=r.flowdata[e][o];if("object"==i(l)&&"mc"in l){let e=r.config.merge[l.mc.r+"_"+l.mc.c];(null==n||e.c<n)&&(n=e.c)}}if(!(g(n-1,l,t)&&n>0))break;o=n-1}else n=0;let c=null;if(e<o)for(let n=e;n<=o;n++){for(let e=l;e<=t;e++){let l=r.flowdata[e][n];if("object"==i(l)&&"mc"in l){let e=r.config.merge[l.mc.r+"_"+l.mc.c];(null==c||e.c+e.cs-1>c)&&(c=e.c+e.cs-1)}}if(!(g(c+1,l,t)&&c<o))break;n=c+1}else c=o;return[n,c]}function v(e,l,t,o){let n,c=null;if("down"==e){let e=r.flowdata[t][l];n=!("object"!=i(e)||!f(e.v))||!!f(e),console.log(n,"stNull");let u=[],s=0;for(let e=t+1;e<=o;e++){let a=r.flowdata[e][l];if("object"==i(a)&&f(a.v)?u.push(!0):f(a)?u.push(!0):u.push(!1),1==u.length&&1==n&&0==u[s]){c=t+s+1;break}if(u.length>1){if(n&&0==u[s]){c=t+s+1;break}if(!n){if(0==u[s]&&1==u[s-1]){c=t+s+1;break}if(1==u[s]&&0==u[s-1]){c=t+s;break}}}e==o&&(c=o),s++}}else if("up"==e){let e=r.flowdata[o][l];n=!("object"!=i(e)||!f(e.v))||!!f(e);let u=[],s=0;for(let e=o-1;e>=t;e--){let a=r.flowdata[e][l];if("object"==i(a)&&f(a.v)?u.push(!0):f(a)?u.push(!0):u.push(!1),1==u.length&&n&&0==u[s]){c=o-(s+1);break}if(u.length>1){if(n&&0==u[s]){c=o-(s+1);break}if(!n){if(0==u[s]&&1==u[s-1]){c=o-(s+1);break}if(1==u[s]&&0==u[s-1]){c=o-s;break}}}e==t&&(c=t),s++}}else if("right"==e){let e=r.flowdata[l][t];n=!("object"!=i(e)||!f(e.v))||!!f(e);let u=[],s=0;for(let e=t+1;e<=o;e++){let a=r.flowdata[l][e];if("object"==i(a)&&f(a.v)?u.push(!0):f(a)?u.push(!0):u.push(!1),1==u.length&&n&&0==u[s]){c=t+s+1;break}if(u.length>1){if(n&&0==u[s]){c=t+s+1;break}if(!n){if(0==u[s]&&1==u[s-1]){c=t+s+1;break}if(1==u[s]&&0==u[s-1]){c=t+s;break}}}e==o&&(c=o),s++}}else if("left"==e){let e=r.flowdata[l][o];n=!("object"!=i(e)||!f(e.v))||!!f(e);let u=[],s=0;for(let e=o-1;e>=t;e--){let a=r.flowdata[l][e];if("object"==i(a)&&f(a.v)?u.push(!0):f(a)?u.push(!0):u.push(!1),1==u.length&&n&&0==u[s]){c=o-(s+1);break}if(u.length>1){if(n&&0==u[s]){c=o-(s+1);break}if(!n){if(0==u[s]&&1==u[s-1]){c=o-(s+1);break}if(1==u[s]&&0==u[s-1]){c=o-s;break}}}e==t&&(c=t),s++}}return c}return{luckysheetMoveEndCell:function(e,t,o,n,c){null==o&&(o=!0),e||(e="down"),t||(t="cell"),null==c&&(c=!1);let u=r.luckysheet_select_save[r.luckysheet_select_save.length-1],s=null==u.row?0:u.row[0],a=null==u.column?0:u.column[0],m=null==u.row?0:u.row[0],g=null==u.column?0:u.column[0],d=null==u.row?0:u.row[1],b=null==u.column?0:u.column[1];if(l.fucntionboxshow(s,a),"range"==t){var v=r.luckysheet_shiftpositon.row[0],_=r.luckysheet_shiftpositon.column[0];let l=r.luckysheet_shiftpositon.row[1],t=r.luckysheet_shiftpositon.column[1];"down"==e||"up"==e?l<d?s=null==u.row?0:u.row[1]:v>m?s=null==u.row?0:u.row[0]:l==d&&v==m&&(s="down"==e?null==u.row?0:u.row[1]:null==u.row?0:u.row[0]):"right"!=e&&"left"!=e||(t<b?a=null==u.column?0:u.column[1]:_>g?a=null==u.column?0:u.column[0]:t==b&&_==g&&(a="right"==e?null==u.column?0:u.column[1]:null==u.column?0:u.column[0]))}let k=r.flowdata.length,p=r.flowdata[0].length,y=r.flowdata,$="",T=0;if("up"==e){if(0==s)return;{let e=[],l=null,t=0,o=null;for(let n=g;n<=b;n++){e=[],t=0;for(let o=s-1;o>=0;o--){let c=y[o][n];if("object"==i(c)&&f(c.v)?e.push(!1):f(c)?e.push(!1):e.push(!0),e.length>1){if(1==e[t]&&0==e[t-1]){l=o;break}if(0==e[t]&&1==e[t-1]){l=o+1;break}}t++}null==l&&(l=0),(null==o||l<o)&&(o=l)}$="down",T=o-s}}else if("down"==e){if(s==k-1)return;{let e=[],l=null,t=0,o=null;for(let n=g;n<=b;n++){e=[],t=0;for(let o=s+1;o<y.length;o++){let c=y[o][n];if("object"==i(c)&&f(c.v)?e.push(!1):f(c)?e.push(!1):e.push(!0),e.length>1){if(1==e[t]&&0==e[t-1]){l=o;break}if(0==e[t]&&1==e[t-1]){l=o-1;break}}t++}null==l&&(l=y.length-1),(null==o||l>o)&&(o=l)}$="down",T=o-s}}else if("left"==e){if(0==a)return;{let e=[],l=null,t=0,o=null;for(let n=m;n<=d;n++){e=[],t=0;for(let o=a-1;o>=0;o--){let c=y[n][o];if("object"==i(c)&&f(c.v)?e.push(!1):f(c)?e.push(!1):e.push(!0),e.length>1){if(1==e[t]&&0==e[t-1]){l=o;break}if(0==e[t]&&1==e[t-1]){l=o+1;break}}t++}null==l&&(l=0),(null==o||l<o)&&(o=l)}$="right",T=o-a}}else if("right"==e){if(a==p-1)return;{let e=[],l=null,t=0,o=null;for(let n=m;n<=d;n++){e=[],t=0;for(let o=a+1;o<y[0].length;o++){let c=y[n][o];if("object"==i(c)&&f(c.v)?e.push(!1):f(c)?e.push(!1):e.push(!0),e.length>1){if(1==e[t]&&0==e[t-1]){l=o;break}if(0==e[t]&&1==e[t-1]){l=o-1;break}}t++}null==l&&(l=y[0].length-1),(null==o||l>o)&&(o=l)}$="right",T=o-a}}if("range"==t&&("up"==e?p_endR<d&&T+s<p_endR&&(T=p_endR-s):"down"==e?v>m&&T+s>v&&(T=v-s):"left"==e?p_endC<b&&T+a<p_endC&&(T=p_endC-a):"right"==e&&_>g&&T+a>_&&(T=_-a),null!=n&&Math.abs(T)>Math.abs(n)&&(T=n)),c)return T;"cell"==t?h($,T,"rangeOfSelect",o):"range"==t&&w($,T,"rangeOfSelect",o)},luckysheetMoveHighlightCell:h,luckysheetMoveHighlightCell2:function(e,t,o){let c,i,f,h;if(o||(o=!0),"rangeOfSelect"==t){let t=r.luckysheet_select_save[r.luckysheet_select_save.length-1],o=t.row_focus,s=t.column_focus,w=!1,m={};if(null!=r.config.merge&&o+"_"+s in r.config.merge&&(w=!0,m=r.config.merge[o+"_"+s]),"down"==e){if(o==r.flowdata.length-1)return;o=v("down",s,w?m.r+m.rs-1:o,r.flowdata.length-1)}else if("up"==e){if(0==o)return;o=v("up",s,0,w?m.r:o)}else if("right"==e){if(s==r.flowdata[0].length-1)return;s=v("right",o,w?m.c+m.cs-1:s,r.flowdata[0].length-1)}else if("left"==e){if(0==s)return;s=v("left",o,0,w?m.c:s)}let g=[o,o],d=[s,s];c=r.visibledatarow[o],i=o-1==-1?0:r.visibledatarow[o-1],f=r.visibledatacolumn[s],h=s-1==-1?0:r.visibledatacolumn[s-1];let b=n.mergeMoveMain(d,g,t,i,c-i-1,h,f-h-1);null!=b&&(d=b[0],g=b[1]),r.luckysheet_select_save=[{row:g,column:d}],a(),u.pivotclick(o,s),l.fucntionboxshow(o,s)}else if("rangeOfFormula"==t){let t=l.func_selectedrange,o=t.row_focus,u=t.column_focus,s=!1,a={};if(null!=r.config.merge&&o+"_"+u in r.config.merge&&(s=!0,a=r.config.merge[o+"_"+u]),"down"==e){if(o==r.flowdata.length-1)return;o=v("down",u,s?a.r+a.rs-1:o,r.flowdata.length-1)}else if("up"==e){if(0==o)return;o=v("up",u,0,s?a.r:o)}else if("right"==e){if(u==r.flowdata[0].length-1)return;u=v("right",o,s?a.c+a.cs-1:u,r.flowdata[0].length-1)}else if("left"==e){if(0==u)return;u=v("left",o,0,s?a.c:u)}let w=[o,o],m=[u,u];c=r.visibledatarow[o],i=o-1==-1?0:r.visibledatarow[o-1],f=r.visibledatacolumn[u];let g=i,d=c-i-1,b=h=u-1==-1?0:r.visibledatacolumn[u-1],_=f-h-1,k=n.mergeMoveMain(m,w,t,g,d,b,_);null!=k&&(m=k[0],w=k[1],g=k[2],d=k[3],b=k[4],_=k[5]),l.func_selectedrange={left:b,width:_,top:g,height:d,left_move:b,width_move:_,top_move:g,height_move:d,row:w,column:m,row_focus:o,column_focus:u},$("#luckysheet-formula-functionrange-select").css({left:b,width:_,top:g,height:d}).show(),l.rangeSetValue({row:w,column:m})}let w=$("#luckysheet-cell-main").scrollLeft(),m=$("#luckysheet-cell-main").scrollTop(),g=$("#luckysheet-cell-main").height(),d=$("#luckysheet-cell-main").width(),b=0,_=0;f-w-d+20>0?(b=f-d+20,o&&$("#luckysheet-scrollbar-x").scrollLeft(b)):h-w-20<0&&(b=h-20,o&&$("#luckysheet-scrollbar-x").scrollLeft(b)),c-m-g+20>0?(_=c-g+20,o&&$("#luckysheet-scrollbar-y").scrollTop(_)):i-m-20<0&&(_=i-20,o&&$("#luckysheet-scrollbar-y").scrollTop(_)),clearTimeout(r.countfuncTimeout),s()},luckysheetMoveHighlightRange:w,luckysheetMoveHighlightRange2:function(e,t,o){let c,u,i,f;if(o||(o=!0),"rangeOfSelect"==t){let l=r.luckysheet_select_save[r.luckysheet_select_save.length-1],t=l.row_focus,o=l.column_focus,s=l.row[0],h=l.row[1],w=l.column[0],_=l.column[1];if("down"==e){if(h==r.flowdata.length-1)return;if(m(t,w,_)){let e=d(t,w,_),l=e[0],n=e[1];l>s&&n==h?s=v("down",o,s,h):h=v("down",o,h,r.flowdata.length-1)}else t>s&&t==h?s=v("down",o,s,h):h=v("down",o,h,r.flowdata.length-1)}else if("up"==e){if(0==s)return;if(m(t,w,_)){let e=d(t,w,_),l=e[0];e[1]<h&&l==s?h=v("up",o,s,h):s=v("up",o,0,s)}else t<h&&t==s?h=v("up",o,s,h):s=v("up",o,0,s)}else if("right"==e){if(_==r.flowdata[0].length-1)return;if(g(o,s,h)){let e=b(o,s,h),l=e[0],n=e[1];l>w&&n==_?w=v("right",t,w,_):_=v("right",t,_,r.flowdata[0].length-1)}else o>w&&o==_?w=v("right",t,w,_):_=v("right",t,_,r.flowdata[0].length-1)}else if("left"==e){if(0==w)return;if(g(o,s,h)){let e=b(o,s,h),l=e[0];e[1]<_&&l==w?_=v("left",t,w,_):w=v("left",t,0,w)}else o<_&&o==w?_=v("left",t,w,_):w=v("left",t,0,w)}let k=[s,h],p=[w,_];c=r.visibledatarow[h],u=s-1==-1?0:r.visibledatarow[s-1],i=r.visibledatacolumn[_],f=w-1==-1?0:r.visibledatacolumn[w-1];let y=n.mergeMoveMain(p,k,l,u,c-u-1,f,i-f-1);null!=y&&(p=y[0],k=y[1]),l.row=k,l.column=p,a()}else if("rangeOfFormula"==t){let t=l.func_selectedrange,o=t.row_focus,s=t.column_focus,a=t.row[0],h=t.row[1],w=t.column[0],_=t.column[1];if("down"==e){if(h==r.flowdata.length-1)return;if(m(o,w,_)){let e=d(o,w,_),l=e[0],t=e[1];l>a&&t==h?a=v("down",s,a,h):h=v("down",s,h,r.flowdata.length-1)}else o>a&&o==h?a=v("down",s,a,h):h=v("down",s,h,r.flowdata.length-1)}else if("up"==e){if(0==a)return;if(m(o,w,_)){let e=d(o,w,_),l=e[0];e[1]<h&&l==a?h=v("up",s,a,h):a=v("up",s,0,a)}else o<h&&o==a?h=v("up",s,a,h):a=v("up",s,0,a)}else if("right"==e){if(_==r.flowdata[0].length-1)return;if(g(s,a,h)){let e=b(s,a,h),l=e[0],t=e[1];l>w&&t==_?w=v("right",o,w,_):_=v("right",o,_,r.flowdata[0].length-1)}else s>w&&s==_?w=v("right",o,w,_):_=v("right",o,_,r.flowdata[0].length-1)}else if("left"==e){if(0==w)return;if(g(s,a,h)){let e=b(s,a,h),l=e[0];e[1]<_&&l==w?_=v("left",o,w,_):w=v("left",o,0,w)}else s<_&&s==w?_=v("left",o,w,_):w=v("left",o,0,w)}let k=[a,h],p=[w,_];c=r.visibledatarow[h],u=a-1==-1?0:r.visibledatarow[a-1],i=r.visibledatacolumn[_];let y=u,T=c-u-1,j=f=w-1==-1?0:r.visibledatacolumn[w-1],M=i-f-1,x=n.mergeMoveMain(p,k,t,y,T,j,M);null!=x&&(p=x[0],k=x[1],y=x[2],T=x[3],j=x[4],M=x[5]),l.func_selectedrange={left:j,width:M,top:y,height:T,left_move:j,width_move:M,top_move:y,height_move:T,row:k,column:p,row_focus:o,column_focus:s},$("#luckysheet-formula-functionrange-select").css({left:j,width:M,top:y,height:T}).show(),l.rangeSetValue({row:k,column:p})}let h=$("#luckysheet-cell-main").scrollLeft(),w=$("#luckysheet-cell-main").scrollTop(),_=$("#luckysheet-cell-main").height(),k=$("#luckysheet-cell-main").width(),p=0,y=0;i-h-k+20>0?(p=i-k+20,o&&$("#luckysheet-scrollbar-x").scrollLeft(p)):f-h-20<0&&(p=f-20,o&&$("#luckysheet-scrollbar-x").scrollLeft(p)),c-w-_+20>0?(y=c-_+20,o&&$("#luckysheet-scrollbar-y").scrollTop(y)):u-w-20<0&&(y=u-20,o&&$("#luckysheet-scrollbar-y").scrollTop(y)),clearTimeout(r.countfuncTimeout),s()}}});
//# sourceMappingURL=../sourcemaps/controllers/sheetMove.js.map
