/**
 * skylark-lucksheet - A version of lucksheet.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["../utils/util","../global/formula","../global/validate","../global/count","./menuButton","./select","./pivotTable","../store","./server"],function(e,l,t,o,n,c,u,r,i){"use strict";const{getObjType:f}=e,{isRealNull:a}=t,{countfunc:s}=o,{selectHightlightShow:h}=c;function w(e,t,o,c){null==c&&(c=!0);let f,a,w,m,g,d,b,v,_=r.flowdata.length,k=r.flowdata[0].length;if("rangeOfSelect"==o){let o,c,i=r.luckysheet_select_save[r.luckysheet_select_save.length-1];o=null==i.row_focus?i.row[0]:i.row_focus,c=null==i.column_focus?i.column[0]:i.column_focus;let s=n.mergeborer(r.flowdata,o,c);if(s){let l=s.row[2],n=s.row[3],u=s.column[2],r=s.column[3];t>0?"down"==e?(o=n,c=u):"right"==e&&(o=l,c=r):(o=l,c=u)}let p=null==i.moveXY?o:i.moveXY.x,y=null==i.moveXY?c:i.moveXY.y;"down"==e?p=o+=t:"right"==e&&(y=c+=t),o>=_&&(p=o=_-1),o<0&&(p=o=0),c>=k&&(y=c=k-1),c<0&&(y=c=0);let $=n.mergeborer(r.flowdata,o,c);$?(f=$.row[1],a=$.row[0],w=$.row[2],m=$.row[3],g=$.column[1],d=$.column[0],b=$.column[2],v=$.column[3]):(f=r.visibledatarow[p],a=p-1==-1?0:r.visibledatarow[p-1],w=p,m=p,g=r.visibledatacolumn[y],d=y-1==-1?0:r.visibledatacolumn[y-1],b=y,v=y),i.row=[w,m],i.column=[b,v],i.row_focus=w,i.column_focus=b,i.moveXY={x:p,y:y},h(),u.pivotclick(w,b),l.fucntionboxshow(w,b)}else if("rangeOfFormula"==o){let o,c,u=l.func_selectedrange;o=null==u.row_focus?u.row[0]:u.row_focus,c=null==u.column_focus?u.column[0]:u.column_focus;let i=n.mergeborer(r.flowdata,o,c);if(i){let l=i.row[2],n=i.row[3],u=i.column[2],r=i.column[3];t>0?"down"==e?(o=n,c=u):"right"==e&&(o=l,c=r):(o=l,c=u)}let s=null==u.moveXY?o:u.moveXY.x,h=null==u.moveXY?c:u.moveXY.y;"down"==e?s=o+=t:"right"==e&&(h=c+=t),o>=_&&(s=o=_-1),o<0&&(s=o=0),c>=k&&(h=c=k-1),c<0&&(h=c=0);let p=n.mergeborer(r.flowdata,o,c);p?(f=p.row[1],a=p.row[0],w=p.row[2],m=p.row[3],g=p.column[1],d=p.column[0],b=p.column[2],v=p.column[3]):(f=r.visibledatarow[s],a=s-1==-1?0:r.visibledatarow[s-1],w=s,m=s,g=r.visibledatacolumn[h],d=h-1==-1?0:r.visibledatacolumn[h-1],b=h,v=h),l.func_selectedrange={left:d,width:g-d-1,top:a,height:f-a-1,left_move:d,width_move:g-d-1,top_move:a,height_move:f-a-1,row:[w,m],column:[b,v],row_focus:w,column_focus:b,moveXY:{x:s,y:h}},$("#luckysheet-formula-functionrange-select").css({left:d,width:g-d-1,top:a,height:f-a-1}).show(),l.rangeSetValue({row:[w,m],column:[b,v]})}let p=$("#luckysheet-cell-main").scrollLeft(),y=$("#luckysheet-cell-main").scrollTop(),T=$("#luckysheet-cell-main").height(),j=$("#luckysheet-cell-main").width(),M=0,x=0;g-p-j+20>0?(M=g-j+20,c&&$("#luckysheet-scrollbar-x").scrollLeft(M)):d-p-20<0&&(M=d-20,c&&$("#luckysheet-scrollbar-x").scrollLeft(M)),f-y-T+20>0?(x=f-T+20,c&&$("#luckysheet-scrollbar-y").scrollTop(x)):a-y-20<0&&(x=a-20,c&&$("#luckysheet-scrollbar-y").scrollTop(x)),clearTimeout(r.countfuncTimeout),s(),i.saveParam("mv",r.currentSheetIndex,r.luckysheet_select_save)}function m(e,t,o,c){let u,i,f,a;if(null==c&&(c=!0),"rangeOfSelect"==o){let l=r.luckysheet_select_save[r.luckysheet_select_save.length-1],o=l.row[0],c=l.row[1],s=l.column[0],w=l.column[1],m=l.row_focus,_=l.column_focus,k=r.flowdata.length,p=r.flowdata[0].length;if("down"==e){if(g(m,s,w)){let e=b(m,s,w),l=e[0],n=e[1];l>o&&n==c?(t>0&&g(o,s,w)&&(o=b(o,s,w)[1]),o+=t):n<c&&l==o?(t<0&&g(c,s,w)&&(c=b(c,s,w)[0]),c+=t):t>0?c+=t:o+=t}else m>o&&m==c?(t>0&&g(o,s,w)&&(o=b(o,s,w)[1]),o+=t):m<c&&m==o?(t<0&&g(c,s,w)&&(c=b(c,s,w)[0]),c+=t):m==o&&m==c&&(t>0?c+=t:o+=t);c>=k&&(c=k-1),c<0&&(c=0),o>=k&&(o=k-1),o<0&&(o=0)}else{if(d(_,o,c)){let e=v(_,o,c),l=e[0],n=e[1];l>s&&n==w?(t>0&&d(s,o,c)&&(s=v(s,o,c)[1]),s+=t):n<w&&l==s?(t<0&&d(w,o,c)&&(w=v(w,o,c)[0]),w+=t):t>0?w+=t:s+=t}else _>s&&_==w?(t>0&&d(s,o,c)&&(s=v(s,o,c)[1]),s+=t):_<w&&_==s?(t<0&&d(w,o,c)&&(w=v(w,o,c)[0]),w+=t):_==s&&_==w&&(t>0?w+=t:s+=t);w>=p&&(w=p-1),w<0&&(w=0),s>=p&&(s=p-1),s<0&&(s=0)}let y=[o,c],$=[s,w];u=r.visibledatarow[c],i=o-1==-1?0:r.visibledatarow[o-1],f=r.visibledatacolumn[w],a=s-1==-1?0:r.visibledatacolumn[s-1];let T=n.mergeMoveMain($,y,l,i,u-i-1,a,f-a-1);null!=T&&($=T[0],y=T[1]),l.row=y,l.column=$,h()}else if("rangeOfFormula"==o){let o=l.func_selectedrange,c=o.row[0],s=o.row[1],h=o.column[0],w=o.column[1],m=o.row_focus,_=o.column_focus,k=r.flowdata.length,p=r.flowdata[0].length;if("down"==e){if(g(m,h,w)){let e=b(m,h,w),l=e[0],o=e[1];l>c&&o==s?(t>0&&g(c,h,w)&&(c=b(c,h,w)[1]),c+=t):o<s&&l==c?(t<0&&g(s,h,w)&&(s=b(s,h,w)[0]),s+=t):t>0?s+=t:c+=t}else m>c&&m==s?(t>0&&g(c,h,w)&&(c=b(c,h,w)[1]),c+=t):m<s&&m==c?(t<0&&g(s,h,w)&&(s=b(s,h,w)[0]),s+=t):m==c&&m==s&&(t>0?s+=t:c+=t);s>=k&&(s=k-1),s<0&&(s=0),c>=k&&(c=k-1),c<0&&(c=0)}else{if(d(_,c,s)){let e=v(_,c,s),l=e[0],o=e[1];l>h&&o==w?(t>0&&d(h,c,s)&&(h=v(h,c,s)[1]),h+=t):o<w&&l==h?(t<0&&d(w,c,s)&&(w=v(w,c,s)[0]),w+=t):t>0?w+=t:h+=t}else _>h&&_==w?(t>0&&d(h,c,s)&&(h=v(h,c,s)[1]),h+=t):_<w&&_==h?(t<0&&d(w,c,s)&&(w=v(w,c,s)[0]),w+=t):_==h&&_==w&&(t>0?w+=t:h+=t);w>=p&&(w=p-1),w<0&&(w=0),h>=p&&(h=p-1),h<0&&(h=0)}let y=[c,s],T=[h,w];u=r.visibledatarow[s],i=c-1==-1?0:r.visibledatarow[c-1],f=r.visibledatacolumn[w];let j=i,M=u-i-1,x=a=h-1==-1?0:r.visibledatacolumn[h-1],L=f-a-1,S=n.mergeMoveMain(T,y,o,j,M,x,L);null!=S&&(T=S[0],y=S[1],j=S[2],M=S[3],x=S[4],L=S[5]),l.func_selectedrange={left:x,width:L,top:j,height:M,left_move:x,width_move:L,top_move:j,height_move:M,row:y,column:T,row_focus:m,column_focus:_},$("#luckysheet-formula-functionrange-select").css({left:x,width:L,top:j,height:M}).show(),l.rangeSetValue({row:y,column:T})}let w=$("#luckysheet-cell-main").scrollLeft(),m=$("#luckysheet-cell-main").scrollTop(),_=$("#luckysheet-cell-main").height(),k=$("#luckysheet-cell-main").width(),p=0,y=0;f-w-k+20>0?(p=f-k+20,c&&$("#luckysheet-scrollbar-x").scrollLeft(p)):a-w-20<0&&(p=a-20,c&&$("#luckysheet-scrollbar-x").scrollLeft(p)),u-m-_+20>0?(y=u-_+20,c&&$("#luckysheet-scrollbar-y").scrollTop(y)):i-m-20<0&&(y=i-20,c&&$("#luckysheet-scrollbar-y").scrollTop(y)),clearTimeout(r.countfuncTimeout),s()}function g(e,l,t){let o=!1;for(let n=l;n<=t;n++){let l=r.flowdata[e][n];if("object"==f(l)&&"mc"in l){o=!0;break}}return o}function d(e,l,t){let o=!1;for(let n=l;n<=t;n++){let l=r.flowdata[n][e];if("object"==f(l)&&"mc"in l){o=!0;break}}return o}function b(e,l,t){let o=r.flowdata.length-1,n=null;if(e>0)for(let o=e;o>=0;o--){for(let e=l;e<=t;e++){let l=r.flowdata[o][e];if("object"==f(l)&&"mc"in l){let e=r.config.merge[l.mc.r+"_"+l.mc.c];(null==n||e.r<n)&&(n=e.r)}}if(!(g(n-1,l,t)&&n>0))break;o=n-1}else n=0;let c=null;if(e<o)for(let n=e;n<=o;n++){for(let e=l;e<=t;e++){let l=r.flowdata[n][e];if("object"==f(l)&&"mc"in l){let e=r.config.merge[l.mc.r+"_"+l.mc.c];(null==c||e.r+e.rs-1>c)&&(c=e.r+e.rs-1)}}if(!(g(c+1,l,t)&&c<o))break;n=c+1}else c=o;return[n,c]}function v(e,l,t){let o=r.flowdata[0].length-1,n=null;if(e>0)for(let o=e;o>=0;o--){for(let e=l;e<=t;e++){let l=r.flowdata[e][o];if("object"==f(l)&&"mc"in l){let e=r.config.merge[l.mc.r+"_"+l.mc.c];(null==n||e.c<n)&&(n=e.c)}}if(!(d(n-1,l,t)&&n>0))break;o=n-1}else n=0;let c=null;if(e<o)for(let n=e;n<=o;n++){for(let e=l;e<=t;e++){let l=r.flowdata[e][n];if("object"==f(l)&&"mc"in l){let e=r.config.merge[l.mc.r+"_"+l.mc.c];(null==c||e.c+e.cs-1>c)&&(c=e.c+e.cs-1)}}if(!(d(c+1,l,t)&&c<o))break;n=c+1}else c=o;return[n,c]}function _(e,l,t,o){let n,c=null;if("down"==e){let e=r.flowdata[t][l];n=!("object"!=f(e)||!a(e.v))||!!a(e),console.log(n,"stNull");let u=[],i=0;for(let e=t+1;e<=o;e++){let s=r.flowdata[e][l];if("object"==f(s)&&a(s.v)?u.push(!0):a(s)?u.push(!0):u.push(!1),1==u.length&&1==n&&0==u[i]){c=t+i+1;break}if(u.length>1){if(n&&0==u[i]){c=t+i+1;break}if(!n){if(0==u[i]&&1==u[i-1]){c=t+i+1;break}if(1==u[i]&&0==u[i-1]){c=t+i;break}}}e==o&&(c=o),i++}}else if("up"==e){let e=r.flowdata[o][l];n=!("object"!=f(e)||!a(e.v))||!!a(e);let u=[],i=0;for(let e=o-1;e>=t;e--){let s=r.flowdata[e][l];if("object"==f(s)&&a(s.v)?u.push(!0):a(s)?u.push(!0):u.push(!1),1==u.length&&n&&0==u[i]){c=o-(i+1);break}if(u.length>1){if(n&&0==u[i]){c=o-(i+1);break}if(!n){if(0==u[i]&&1==u[i-1]){c=o-(i+1);break}if(1==u[i]&&0==u[i-1]){c=o-i;break}}}e==t&&(c=t),i++}}else if("right"==e){let e=r.flowdata[l][t];n=!("object"!=f(e)||!a(e.v))||!!a(e);let u=[],i=0;for(let e=t+1;e<=o;e++){let s=r.flowdata[l][e];if("object"==f(s)&&a(s.v)?u.push(!0):a(s)?u.push(!0):u.push(!1),1==u.length&&n&&0==u[i]){c=t+i+1;break}if(u.length>1){if(n&&0==u[i]){c=t+i+1;break}if(!n){if(0==u[i]&&1==u[i-1]){c=t+i+1;break}if(1==u[i]&&0==u[i-1]){c=t+i;break}}}e==o&&(c=o),i++}}else if("left"==e){let e=r.flowdata[l][o];n=!("object"!=f(e)||!a(e.v))||!!a(e);let u=[],i=0;for(let e=o-1;e>=t;e--){let s=r.flowdata[l][e];if("object"==f(s)&&a(s.v)?u.push(!0):a(s)?u.push(!0):u.push(!1),1==u.length&&n&&0==u[i]){c=o-(i+1);break}if(u.length>1){if(n&&0==u[i]){c=o-(i+1);break}if(!n){if(0==u[i]&&1==u[i-1]){c=o-(i+1);break}if(1==u[i]&&0==u[i-1]){c=o-i;break}}}e==t&&(c=t),i++}}return c}return{luckysheetMoveEndCell:function(e,t,o,n,c){null==o&&(o=!0),e||(e="down"),t||(t="cell"),null==c&&(c=!1);let u=r.luckysheet_select_save[r.luckysheet_select_save.length-1],i=null==u.row?0:u.row[0],s=null==u.column?0:u.column[0],h=null==u.row?0:u.row[0],g=null==u.column?0:u.column[0],d=null==u.row?0:u.row[1],b=null==u.column?0:u.column[1];if(l.fucntionboxshow(i,s),"range"==t){var v=r.luckysheet_shiftpositon.row[0],_=r.luckysheet_shiftpositon.column[0];let l=r.luckysheet_shiftpositon.row[1],t=r.luckysheet_shiftpositon.column[1];"down"==e||"up"==e?l<d?i=null==u.row?0:u.row[1]:v>h?i=null==u.row?0:u.row[0]:l==d&&v==h&&(i="down"==e?null==u.row?0:u.row[1]:null==u.row?0:u.row[0]):"right"!=e&&"left"!=e||(t<b?s=null==u.column?0:u.column[1]:_>g?s=null==u.column?0:u.column[0]:t==b&&_==g&&(s="right"==e?null==u.column?0:u.column[1]:null==u.column?0:u.column[0]))}let k=r.flowdata.length,p=r.flowdata[0].length,y=r.flowdata,$="",T=0;if("up"==e){if(0==i)return;{let e=[],l=null,t=0,o=null;for(let n=g;n<=b;n++){e=[],t=0;for(let o=i-1;o>=0;o--){let c=y[o][n];if("object"==f(c)&&a(c.v)?e.push(!1):a(c)?e.push(!1):e.push(!0),e.length>1){if(1==e[t]&&0==e[t-1]){l=o;break}if(0==e[t]&&1==e[t-1]){l=o+1;break}}t++}null==l&&(l=0),(null==o||l<o)&&(o=l)}$="down",T=o-i}}else if("down"==e){if(i==k-1)return;{let e=[],l=null,t=0,o=null;for(let n=g;n<=b;n++){e=[],t=0;for(let o=i+1;o<y.length;o++){let c=y[o][n];if("object"==f(c)&&a(c.v)?e.push(!1):a(c)?e.push(!1):e.push(!0),e.length>1){if(1==e[t]&&0==e[t-1]){l=o;break}if(0==e[t]&&1==e[t-1]){l=o-1;break}}t++}null==l&&(l=y.length-1),(null==o||l>o)&&(o=l)}$="down",T=o-i}}else if("left"==e){if(0==s)return;{let e=[],l=null,t=0,o=null;for(let n=h;n<=d;n++){e=[],t=0;for(let o=s-1;o>=0;o--){let c=y[n][o];if("object"==f(c)&&a(c.v)?e.push(!1):a(c)?e.push(!1):e.push(!0),e.length>1){if(1==e[t]&&0==e[t-1]){l=o;break}if(0==e[t]&&1==e[t-1]){l=o+1;break}}t++}null==l&&(l=0),(null==o||l<o)&&(o=l)}$="right",T=o-s}}else if("right"==e){if(s==p-1)return;{let e=[],l=null,t=0,o=null;for(let n=h;n<=d;n++){e=[],t=0;for(let o=s+1;o<y[0].length;o++){let c=y[n][o];if("object"==f(c)&&a(c.v)?e.push(!1):a(c)?e.push(!1):e.push(!0),e.length>1){if(1==e[t]&&0==e[t-1]){l=o;break}if(0==e[t]&&1==e[t-1]){l=o-1;break}}t++}null==l&&(l=y[0].length-1),(null==o||l>o)&&(o=l)}$="right",T=o-s}}if("range"==t&&("up"==e?p_endR<d&&T+i<p_endR&&(T=p_endR-i):"down"==e?v>h&&T+i>v&&(T=v-i):"left"==e?p_endC<b&&T+s<p_endC&&(T=p_endC-s):"right"==e&&_>g&&T+s>_&&(T=_-s),null!=n&&Math.abs(T)>Math.abs(n)&&(T=n)),c)return T;"cell"==t?w($,T,"rangeOfSelect",o):"range"==t&&m($,T,"rangeOfSelect",o)},luckysheetMoveHighlightCell:w,luckysheetMoveHighlightCell2:function(e,t,o){let c,i,f,a;if(o||(o=!0),"rangeOfSelect"==t){let t=r.luckysheet_select_save[r.luckysheet_select_save.length-1],o=t.row_focus,s=t.column_focus,w=!1,m={};if(null!=r.config.merge&&o+"_"+s in r.config.merge&&(w=!0,m=r.config.merge[o+"_"+s]),"down"==e){if(o==r.flowdata.length-1)return;o=_("down",s,w?m.r+m.rs-1:o,r.flowdata.length-1)}else if("up"==e){if(0==o)return;o=_("up",s,0,w?m.r:o)}else if("right"==e){if(s==r.flowdata[0].length-1)return;s=_("right",o,w?m.c+m.cs-1:s,r.flowdata[0].length-1)}else if("left"==e){if(0==s)return;s=_("left",o,0,w?m.c:s)}let g=[o,o],d=[s,s];c=r.visibledatarow[o],i=o-1==-1?0:r.visibledatarow[o-1],f=r.visibledatacolumn[s],a=s-1==-1?0:r.visibledatacolumn[s-1];let b=n.mergeMoveMain(d,g,t,i,c-i-1,a,f-a-1);null!=b&&(d=b[0],g=b[1]),r.luckysheet_select_save=[{row:g,column:d}],h(),u.pivotclick(o,s),l.fucntionboxshow(o,s)}else if("rangeOfFormula"==t){let t=l.func_selectedrange,o=t.row_focus,u=t.column_focus,s=!1,h={};if(null!=r.config.merge&&o+"_"+u in r.config.merge&&(s=!0,h=r.config.merge[o+"_"+u]),"down"==e){if(o==r.flowdata.length-1)return;o=_("down",u,s?h.r+h.rs-1:o,r.flowdata.length-1)}else if("up"==e){if(0==o)return;o=_("up",u,0,s?h.r:o)}else if("right"==e){if(u==r.flowdata[0].length-1)return;u=_("right",o,s?h.c+h.cs-1:u,r.flowdata[0].length-1)}else if("left"==e){if(0==u)return;u=_("left",o,0,s?h.c:u)}let w=[o,o],m=[u,u];c=r.visibledatarow[o],i=o-1==-1?0:r.visibledatarow[o-1],f=r.visibledatacolumn[u];let g=i,d=c-i-1,b=a=u-1==-1?0:r.visibledatacolumn[u-1],v=f-a-1,k=n.mergeMoveMain(m,w,t,g,d,b,v);null!=k&&(m=k[0],w=k[1],g=k[2],d=k[3],b=k[4],v=k[5]),l.func_selectedrange={left:b,width:v,top:g,height:d,left_move:b,width_move:v,top_move:g,height_move:d,row:w,column:m,row_focus:o,column_focus:u},$("#luckysheet-formula-functionrange-select").css({left:b,width:v,top:g,height:d}).show(),l.rangeSetValue({row:w,column:m})}let w=$("#luckysheet-cell-main").scrollLeft(),m=$("#luckysheet-cell-main").scrollTop(),g=$("#luckysheet-cell-main").height(),d=$("#luckysheet-cell-main").width(),b=0,v=0;f-w-d+20>0?(b=f-d+20,o&&$("#luckysheet-scrollbar-x").scrollLeft(b)):a-w-20<0&&(b=a-20,o&&$("#luckysheet-scrollbar-x").scrollLeft(b)),c-m-g+20>0?(v=c-g+20,o&&$("#luckysheet-scrollbar-y").scrollTop(v)):i-m-20<0&&(v=i-20,o&&$("#luckysheet-scrollbar-y").scrollTop(v)),clearTimeout(r.countfuncTimeout),s()},luckysheetMoveHighlightRange:m,luckysheetMoveHighlightRange2:function(e,t,o){let c,u,i,f;if(o||(o=!0),"rangeOfSelect"==t){let l=r.luckysheet_select_save[r.luckysheet_select_save.length-1],t=l.row_focus,o=l.column_focus,a=l.row[0],s=l.row[1],w=l.column[0],m=l.column[1];if("down"==e){if(s==r.flowdata.length-1)return;if(g(t,w,m)){let e=b(t,w,m),l=e[0],n=e[1];l>a&&n==s?a=_("down",o,a,s):s=_("down",o,s,r.flowdata.length-1)}else t>a&&t==s?a=_("down",o,a,s):s=_("down",o,s,r.flowdata.length-1)}else if("up"==e){if(0==a)return;if(g(t,w,m)){let e=b(t,w,m),l=e[0];e[1]<s&&l==a?s=_("up",o,a,s):a=_("up",o,0,a)}else t<s&&t==a?s=_("up",o,a,s):a=_("up",o,0,a)}else if("right"==e){if(m==r.flowdata[0].length-1)return;if(d(o,a,s)){let e=v(o,a,s),l=e[0],n=e[1];l>w&&n==m?w=_("right",t,w,m):m=_("right",t,m,r.flowdata[0].length-1)}else o>w&&o==m?w=_("right",t,w,m):m=_("right",t,m,r.flowdata[0].length-1)}else if("left"==e){if(0==w)return;if(d(o,a,s)){let e=v(o,a,s),l=e[0];e[1]<m&&l==w?m=_("left",t,w,m):w=_("left",t,0,w)}else o<m&&o==w?m=_("left",t,w,m):w=_("left",t,0,w)}let k=[a,s],p=[w,m];c=r.visibledatarow[s],u=a-1==-1?0:r.visibledatarow[a-1],i=r.visibledatacolumn[m],f=w-1==-1?0:r.visibledatacolumn[w-1];let y=n.mergeMoveMain(p,k,l,u,c-u-1,f,i-f-1);null!=y&&(p=y[0],k=y[1]),l.row=k,l.column=p,h()}else if("rangeOfFormula"==t){let t=l.func_selectedrange,o=t.row_focus,a=t.column_focus,s=t.row[0],h=t.row[1],w=t.column[0],m=t.column[1];if("down"==e){if(h==r.flowdata.length-1)return;if(g(o,w,m)){let e=b(o,w,m),l=e[0],t=e[1];l>s&&t==h?s=_("down",a,s,h):h=_("down",a,h,r.flowdata.length-1)}else o>s&&o==h?s=_("down",a,s,h):h=_("down",a,h,r.flowdata.length-1)}else if("up"==e){if(0==s)return;if(g(o,w,m)){let e=b(o,w,m),l=e[0];e[1]<h&&l==s?h=_("up",a,s,h):s=_("up",a,0,s)}else o<h&&o==s?h=_("up",a,s,h):s=_("up",a,0,s)}else if("right"==e){if(m==r.flowdata[0].length-1)return;if(d(a,s,h)){let e=v(a,s,h),l=e[0],t=e[1];l>w&&t==m?w=_("right",o,w,m):m=_("right",o,m,r.flowdata[0].length-1)}else a>w&&a==m?w=_("right",o,w,m):m=_("right",o,m,r.flowdata[0].length-1)}else if("left"==e){if(0==w)return;if(d(a,s,h)){let e=v(a,s,h),l=e[0];e[1]<m&&l==w?m=_("left",o,w,m):w=_("left",o,0,w)}else a<m&&a==w?m=_("left",o,w,m):w=_("left",o,0,w)}let k=[s,h],p=[w,m];c=r.visibledatarow[h],u=s-1==-1?0:r.visibledatarow[s-1],i=r.visibledatacolumn[m];let y=u,T=c-u-1,j=f=w-1==-1?0:r.visibledatacolumn[w-1],M=i-f-1,x=n.mergeMoveMain(p,k,t,y,T,j,M);null!=x&&(p=x[0],k=x[1],y=x[2],T=x[3],j=x[4],M=x[5]),l.func_selectedrange={left:j,width:M,top:y,height:T,left_move:j,width_move:M,top_move:y,height_move:T,row:k,column:p,row_focus:o,column_focus:a},$("#luckysheet-formula-functionrange-select").css({left:j,width:M,top:y,height:T}).show(),l.rangeSetValue({row:k,column:p})}let a=$("#luckysheet-cell-main").scrollLeft(),w=$("#luckysheet-cell-main").scrollTop(),m=$("#luckysheet-cell-main").height(),k=$("#luckysheet-cell-main").width(),p=0,y=0;i-a-k+20>0?(p=i-k+20,o&&$("#luckysheet-scrollbar-x").scrollLeft(p)):f-a-20<0&&(p=f-20,o&&$("#luckysheet-scrollbar-x").scrollLeft(p)),c-w-m+20>0?(y=c-m+20,o&&$("#luckysheet-scrollbar-y").scrollTop(y)):u-w-20<0&&(y=u-20,o&&$("#luckysheet-scrollbar-y").scrollTop(y)),clearTimeout(r.countfuncTimeout),s()}}});
//# sourceMappingURL=../sourcemaps/controllers/sheetMove.js.map
