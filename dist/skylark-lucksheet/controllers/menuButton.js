/**
 * skylark-lucksheet - A version of lucksheet.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["../widgets/select","../widgets/constant","../methods/luckysheetConfigsetting","./moreFormat","./alternateformat","./conditionformat","../methods/sheetSearch","./freezen","../widgets/resize","./filter","./searchReplace","./locationCell","./ifFormulaGenerator","./updateCell","../widgets/insertFormula","./sheetmanage","./postil","../methods/validate","../widgets/tooltip","../methods/format","./sort","./formula","../methods/location","../methods/datecontroll","../methods/getRowlen","../methods/setdata","../methods/count","../widgets/cursorPos","../methods/get","../methods/set","../methods/cells","./inlineString","../utils/util","./protection","../store","../locale/locale","../widgets/draw"],function(e,t,l,n,o,i,c,s,a,u,r,d,h,f,m,p,y,v,k,g,x,b,w,_,C,F,S,B,A,I,z,D,T,R,M,P,N){"use strict";const{selectionCopyShow:V,selectIsOverlap:O}=e,{luckyColor:W,iconfontObjects:E}=t,{luckysheet_searcharray:j}=c,{createFilter:H}=u,{luckysheetupdateCell:G}=f,{isRealNum:L,isRealNull:U,hasPartMC:q}=v,K=l.isEditMode,{genarate:J,update:Q,is_date:Y}=g,{sortSelection:X}=x,{rowLocationByIndex:Z,colLocationByIndex:ee}=w,{isdatatypemulti:te}=_,{rowlenByRange:le,getCellTextSplitArr:ne}=C,{setcellvalue:oe}=F,{countfunc:ie}=S,{hideMenuByCancel:ce}=B,{getSheetIndex:se,getRangetxt:ae,getluckysheetfile:ue}=A,{setluckysheetfile:re}=I,{isInlineStringCell:de,updateInlineStringFormat:he,convertCssToStyleList:fe,inlineStyleAffectAttribute:me,updateInlineStringFormatOutside:pe}=D,{replaceHtml:ye,getObjType:ve,rgbTohex:ke,mouseclickposition:ge,luckysheetfontformat:xe,luckysheetContainerFocus:be}=T,{openProtectionModal:we,checkProtectionFormatCells:$e,checkProtectionNotEnable:_e}=R;return{menu:'<div class="luckysheet-cols-menu luckysheet-rightgclick-menu luckysheet-menuButton ${subclass} luckysheet-mousedown-cancel" id="luckysheet-icon-${id}-menuButton">${item}</div>',item:'<div itemvalue="${value}" itemname="${name}" class="luckysheet-cols-menuitem ${sub} luckysheet-mousedown-cancel"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel" style="padding: 3px 0px 3px 1px;"><span style="margin-right:3px;width:13px;display:inline-block;" class="icon luckysheet-mousedown-cancel"></span> ${name} <span class="luckysheet-submenu-arrow luckysheet-mousedown-cancel ${iconClass}" style="user-select: none;">${example}</span></div></div>',split:'<div class="luckysheet-menuseparator luckysheet-mousedown-cancel" role="separator"></div>',color:'<div class="luckysheet-cols-menu luckysheet-rightgclick-menu luckysheet-rightgclick-menu-sub luckysheet-mousedown-cancel luckysheet-menuButton ${sub}" id="${id}"><div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel luckysheet-color-reset"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">${resetColor}</div></div> <div class="luckysheet-mousedown-cancel"> <div class="luckysheet-mousedown-cancel"> <input type="text" class="luckysheet-color-selected" /> </div> </div> <div class="luckysheet-menuseparator luckysheet-mousedown-cancel" role="separator"></div> ${coloritem}</div>',coloritem:'<div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel ${class}"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">${name}</div></div>',subcolor:'<div id="luckysheet-icon-${id}-menuButton" class="luckysheet-cols-menu luckysheet-rightgclick-menu luckysheet-rightgclick-menu-sub luckysheet-menuButton-sub luckysheet-mousedown-cancel"> <div class="luckysheet-mousedown-cancel"> <div class="luckysheet-mousedown-cancel"> <input type="text" class="luckysheet-color-selected" /> </div> </div></div>',rightclickmenu:null,submenuhide:{},focus:function(e,t){if("luckysheet-icon-font-family-menuButton"==e.attr("id")&&te(t).num){null==(t=P().fontarray[parseInt(t)])&&(t=this.defualtFont[itemvalue])}e.find(".luckysheet-cols-menuitem").find("span.icon").html(""),null==t?e.find(".luckysheet-cols-menuitem").eq(0).find("span.icon").html('<i class="fa fa-check luckysheet-mousedown-cancel"></i>'):e.find(".luckysheet-cols-menuitem[itemvalue='"+t+"']").find("span.icon").html('<i class="fa fa-check luckysheet-mousedown-cancel"></i>')},createButtonMenu:function(e){let t="",l=this;for(let n=0;n<e.length;n++){let o=e[n];"split"==o.value?t+=l.split:"more"==o.example?t+=ye(l.item,{value:o.value,name:o.text,example:"",sub:"luckysheet-cols-submenu",iconClass:"iconfont luckysheet-iconfont-youjiantou"}):t+=ye(l.item,{value:o.value,name:o.text,example:o.example,sub:"",iconClass:""})}return t},cancelPaintModel:function(){$("#luckysheet-sheettable_0").removeClass("luckysheetPaintCursor"),M.luckysheet_copy_save.dataSheetIndex==M.currentSheetIndex?(M.luckysheet_selection_range=[],V()):M.luckysheetfile[se(M.luckysheet_copy_save.dataSheetIndex)].luckysheet_selection_range=[],M.luckysheet_copy_save={},this.luckysheetPaintModelOn=!1,$("#luckysheetpopover").fadeOut(200,function(){$("#luckysheetpopover").remove()})},luckysheetPaintModelOn:!1,luckysheetPaintSingle:!1,initialMenuButton:function(){let e=this;$("#luckysheet-icon-paintformat").click(function(){let t=P().paint;if(null==M.luckysheet_select_save||0==M.luckysheet_select_save.length)return void(K()?alert(t.tipSelectRange):k.info("",t.tipSelectRange));if(M.luckysheet_select_save.length>1)return void(K()?alert(t.tipNotMulti):k.info("",t.tipNotMulti));k.popover("<i class='fa fa-paint-brush'></i> "+t.start,"topCenter",!0,null,t.end,function(){e.cancelPaintModel()}),$("#luckysheet-sheettable_0").addClass("luckysheetPaintCursor"),M.luckysheet_selection_range=[{row:M.luckysheet_select_save[0].row,column:M.luckysheet_select_save[0].column}],V();let l=!1,n=!1;for(let e=M.luckysheet_select_save[0].row[0];e<=M.luckysheet_select_save[0].row[1];e++)if(null==M.config.rowhidden||null==M.config.rowhidden[e]){null!=M.config.rowlen&&e in M.config.rowlen&&(l=!0);for(let t=M.luckysheet_select_save[0].column[0];t<=M.luckysheet_select_save[0].column[1];t++){let l=M.flowdata[e][t];"object"==ve(l)&&"mc"in l&&null!=l.mc.rs&&(n=!0)}}M.luckysheet_copy_save={dataSheetIndex:M.currentSheetIndex,copyRange:[{row:M.luckysheet_select_save[0].row,column:M.luckysheet_select_save[0].column}],RowlChange:l,HasMC:n},e.luckysheetPaintModelOn=!0,e.luckysheetPaintSingle=!0}),$("#luckysheet-icon-paintformat").dblclick(function(){let t=P().paint;if(null==M.luckysheet_select_save||0==M.luckysheet_select_save.length)return void(K()?alert(t.tipSelectRange):k.info("",t.tipSelectRange));if(M.luckysheet_select_save.length>1)return void(K()?alert(t.tipNotMulti):k.info("",t.tipNotMulti));k.popover("<i class='fa fa-paint-brush'></i> "+t.start,"topCenter",!0,null,t.end,function(){e.cancelPaintModel()}),$("#luckysheet-sheettable_0").addClass("luckysheetPaintCursor"),M.luckysheet_selection_range=[{row:M.luckysheet_select_save[0].row,column:M.luckysheet_select_save[0].column}],V();let l=!1,n=!1;for(let e=M.luckysheet_select_save[0].row[0];e<=M.luckysheet_select_save[0].row[1];e++)if(null==M.config.rowhidden||null==M.config.rowhidden[e]){null!=M.config.rowlen&&e in M.config.rowlen&&(l=!0);for(let t=M.luckysheet_select_save[0].column[0];t<=M.luckysheet_select_save[0].column[1];t++){let l=M.flowdata[e][t];"object"==ve(l)&&"mc"in l&&null!=l.mc.rs&&(n=!0)}}M.luckysheet_copy_save={dataSheetIndex:M.currentSheetIndex,copyRange:[{row:M.luckysheet_select_save[0].row,column:M.luckysheet_select_save[0].column}],RowlChange:l,HasMC:n},e.luckysheetPaintModelOn=!0,e.luckysheetPaintSingle=!1}),$("#luckysheet-icon-currency").click(function(){let t=M.deepCopyFlowData(M.flowdata);e.updateFormat(t,"ct","¥ #.00")}),$("#luckysheet-icon-percent").click(function(){let t=M.deepCopyFlowData(M.flowdata);e.updateFormat(t,"ct","0.00%")}),$("#luckysheet-icon-fmt-decimal-decrease").click(function(){let t=M.deepCopyFlowData(M.flowdata),l=M.luckysheet_select_save[0].row_focus,n=M.luckysheet_select_save[0].column_focus,o=e.checkstatus(t,l,n,"ct"),i=t[l][n];if(null==o||"n"!=o.t)return;if("General"==o.fa){o=J(i.v)[1]}if(/^(w|W)((0?)|(0\.0+))$/.test(o.fa))return void(o.fa.indexOf(".")>-1?".0"==o.fa.substr(-2)?e.updateFormat(t,"ct",o.fa.split(".")[0]):e.updateFormat(t,"ct",o.fa.substr(0,o.fa.length-1)):e.updateFormat(t,"ct",o.fa));let c="",s="";if(!(o.fa.indexOf(".")>-1))return;c=(a=o.fa.split("."))[0];let a=(s=a[1]).split(""),u="";for(let e=a.length-1;e>=0;e--){let t=a[e];if("#"==t||"0"==t||","==t||!isNaN(parseInt(t)))break;u=t+u}let r="";if(o.fa.indexOf(".")>-1){let e=s;u.length>0&&(e=s.replace(u,""));let t=e.replace(/#/g,"0");r=""==(t=t.substr(0,t.length-1))?c+u:c+"."+t+u}e.updateFormat(t,"ct",r)}),$("#luckysheet-icon-fmt-decimal-increase").click(function(){let t=M.deepCopyFlowData(M.flowdata),l=M.luckysheet_select_save[0].row_focus,n=M.luckysheet_select_save[0].column_focus,o=e.checkstatus(t,l,n,"ct"),i=t[l][n];if(null==o||"n"!=o.t)return;if("General"==o.fa){o=J(i.v)[1]}if("General"==o.fa)return void e.updateFormat(t,"ct","#.0");if(/^(w|W)((0?)|(0\.0+))$/.test(o.fa))return void(o.fa.indexOf(".")>-1?e.updateFormat(t,"ct",o.fa+"0"):"0"==o.fa.substr(-1)?e.updateFormat(t,"ct",o.fa+".0"):e.updateFormat(t,"ct",o.fa+"0.0"));let c="",s="";o.fa.indexOf(".")>-1?(c=(a=o.fa.split("."))[0],s=a[1]):s=o.fa;let a=s.split(""),u="";for(let e=a.length-1;e>=0;e--){let t=a[e];if("#"==t||"0"==t||","==t||!isNaN(parseInt(t)))break;u=t+u}let r="";if(o.fa.indexOf(".")>-1){let e=s;u.length>0&&(e=s.replace(u,""));let t=e.replace(/#/g,"0");r=c+"."+(t+="0")+u}else r=u.length>0?s.replace(u,"")+".0"+u:s+".0"+u;e.updateFormat(t,"ct",r)}),$("#luckysheet-icon-fmt-other").click(function(){const t=P(),l=t.format,o=t.defaultFmt;let i=$(this).attr("id")+"-menuButton",c=$("#"+i);if(0==c.length){let t=o,s=e.createButtonMenu(t),a=ye(e.menu,{id:"fmt-other",item:s,subclass:"",sub:""}),u=[{text:l.moreCurrency+"...",value:"morecurrency",example:""},{text:l.moreDateTime+"...",value:"moredatetime",example:""},{text:l.moreNumber+"...",value:"moredigit",example:""}],r=e.createButtonMenu(u),d=ye(e.menu,{id:"fmtOtherSelf",item:r,subclass:"luckysheet-menuButton-sub"});$("body").append(a+d),c=$("#"+i).width(250),e.focus(c),c.find(".luckysheet-cols-menuitem").click(function(){c.hide(),be();let t=$(this),l=t.attr("itemvalue"),n=t.attr("itemname");if($("#luckysheet-icon-fmt-other").find(".luckysheet-toolbar-menu-button-caption").html(" "+n+" "),"fmtOtherSelf"==l)return;let o=M.deepCopyFlowData(M.flowdata);e.focus(c,l),e.updateFormat(o,"ct",l)}),$("#luckysheet-icon-fmtOtherSelf-menuButton").find(".luckysheet-cols-menuitem").click(function(){c.hide(),$("#luckysheet-icon-fmtOtherSelf-menuButton").hide(),be();let e=$(this).attr("itemvalue");n.createDialog(e),n.init()})}else{const t=$(this).find(".luckysheet-toolbar-menu-button-caption").text().trim(),l=o.find(e=>e.text===t);l&&e.focus(c,l.value)}let s=$(this).outerWidth(),a=c.outerWidth(),u=$(this).offset().left;a>s&&a+u>$("#"+M.container).width()&&(u=u-a+s),ge(c,u,$(this).offset().top+25,"lefttop")}),$("#luckysheet-icon-font-family").mousedown(function(e){ce(e),e.stopPropagation()}).click(function(){let t=$(this).attr("id")+"-menuButton",l=$("#"+t);if(0==l.length){let n=e.createButtonMenu(e.fontSelectList),o=ye(e.menu,{id:"font-family",item:n,subclass:"",sub:""});$("body").append(o),l=$("#"+t).width(200),e.focus(l),l.on("click",".luckysheet-cols-menuitem",function(){l.hide(),be();let t=$(this),n=t.attr("itemvalue"),o=t.attr("itemname");e.focus(l,n),$("#luckysheet-icon-font-family").find(".luckysheet-toolbar-menu-button-caption").html(" "+o+" ");let i=M.deepCopyFlowData(M.flowdata);e.updateFormat(i,"ff",n)})}let n=$(this).outerWidth(),o=l.outerWidth(),i=$(this).offset().left;o>n&&o+i>$("#"+M.container).width()&&(i=i-o+n),ge(l,i,$(this).offset().top+25,"lefttop")}),$("#luckysheet-icon-text-color").mousedown(function(e){ce(e),e.stopPropagation()}).click(function(){let t=M.deepCopyFlowData(M.flowdata),l=$(this).attr("color");null==l&&(l="#000000"),e.updateFormat(t,"fc",l)}),$("#luckysheet-icon-text-color-menu").mousedown(function(e){ce(e),e.stopPropagation()}).click(function(){let t=$(this).attr("id")+"-menuButton",n=$("#"+t);if(0==n.length){const i=P(),c=i.toolbar,s=i.button,a=i.alternatingColors;let u=[{name:c.alternatingColors+"...",id:"luckysheet-color-alternate",example:""}],r=(e.createButtonMenu(u),"text-color-self"),d=ye(e.coloritem,{class:"luckysheet-icon-alternateformat",name:c.alternatingColors+"..."}),h=ye(e.color,{id:t,coloritem:d,colorself:r,sub:"",resetColor:c.resetColor});$("body").append(h),n=$("#"+t),$("#"+t).find(".luckysheet-color-selected").spectrum({showPalette:!0,showPaletteOnly:!0,preferredFormat:"hex",clickoutFiresChange:!1,showInitial:!0,showInput:!0,flat:!0,hideAfterPaletteSelect:!0,showSelectionPalette:!0,maxPaletteSize:8,maxSelectionSize:8,cancelText:s.cancel,chooseText:s.confirm,togglePaletteMoreText:c.customColor,togglePaletteLessText:c.collapse,togglePaletteOnly:!0,clearText:c.clearText,color:l.defaultTextColor,noColorSelectedText:c.noColorSelectedText,localStorageKey:"spectrum.textcolor"+M.gridKey,palette:[["#000","#444","#666","#999","#ccc","#eee","#f3f3f3","#fff"],["#f00","#f90","#ff0","#0f0","#0ff","#00f","#90f","#f0f"],["#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d0e0e3","#cfe2f3","#d9d2e9","#ead1dc"],["#ea9999","#f9cb9c","#ffe599","#b6d7a8","#a2c4c9","#9fc5e8","#b4a7d6","#d5a6bd"],["#e06666","#f6b26b","#ffd966","#93c47d","#76a5af","#6fa8dc","#8e7cc3","#c27ba0"],["#c00","#e69138","#f1c232","#6aa84f","#45818e","#3d85c6","#674ea7","#a64d79"],["#900","#b45f06","#bf9000","#38761d","#134f5c","#0b5394","#351c75","#741b47"],["#600","#783f04","#7f6000","#274e13","#0c343d","#073763","#20124d","#4c1130"]],change:function(t){t=null!=t?t.toHexString():"#000",$("#luckysheet-icon-text-color .text-color-bar").css("background-color",t),$("#luckysheet-icon-text-color").attr("color",t);let l=M.deepCopyFlowData(M.flowdata);e.updateFormat(l,"fc",t),n.hide(),be(),$("#luckysheet-input-box").css("color",t)}}),n.find(".luckysheet-color-reset").click(function(){n.hide(),be();let l=$("#"+t).find(".luckysheet-color-selected");l.val("#000000"),$("#luckysheet-icon-text-color").attr("color",null),l.spectrum("set","#000000"),$("#luckysheet-icon-text-color .luckysheet-color-menu-button-indicator").css("border-bottom-color","#000000");let o=M.deepCopyFlowData(M.flowdata);e.updateFormat(o,"fc",null)}),n.find(".luckysheet-icon-alternateformat").click(function(){if(n.hide(),be(),M.luckysheet_select_save.length>1)return void(K()?alert(a.errorInfo):k.info(a.errorInfo,""));let e=$.extend(!0,{},M.luckysheet_select_save[0]);o.rangeIsExists(e)[0]||(o.modelfocusIndex=0,o.new(e)),o.init(),o.perfect()})}let i=$(this).outerWidth(),c=n.outerWidth(),s=$(this).offset().left;c>i&&c+s>$("#"+M.container).width()&&(s=s-c+i);let a=$(this).offset().top+26;setTimeout(function(){let e=$("#"+t).find(".luckysheet-color-selected");e.spectrum("set",e.val()),ge(n,s-28,a,"lefttop")},1)}),$("#luckysheet-icon-cell-color").click(function(){let t=M.deepCopyFlowData(M.flowdata),l=$(this).attr("color");null==l&&(l="#ffffff"),e.updateFormat(t,"bg",l)}),$("#luckysheet-icon-cell-color-menu").click(function(){let t=$(this).attr("id")+"-menuButton",n=$("#"+t);if(0==n.length){let i="cell-color-self";const c=P(),s=c.toolbar,a=c.button,u=c.alternatingColors;let r=ye(e.coloritem,{class:"luckysheet-icon-alternateformat",name:s.alternatingColors+"..."}),d=ye(e.color,{id:t,coloritem:r,colorself:i,sub:"",resetColor:s.resetColor});$("body").append(d),n=$("#"+t),$("#"+t).find(".luckysheet-color-selected").spectrum({showPalette:!0,showPaletteOnly:!0,preferredFormat:"hex",clickoutFiresChange:!1,showInitial:!0,showInput:!0,flat:!0,hideAfterPaletteSelect:!0,showSelectionPalette:!0,maxPaletteSize:8,maxSelectionSize:8,color:l.defaultCellColor,cancelText:a.cancel,chooseText:a.confirm,togglePaletteMoreText:s.customColor,togglePaletteLessText:s.collapse,togglePaletteOnly:!0,clearText:s.clearText,noColorSelectedText:s.noColorSelectedText,localStorageKey:"spectrum.bgcolor"+M.gridKey,palette:[["#000","#444","#666","#999","#ccc","#eee","#f3f3f3","#fff"],["#f00","#f90","#ff0","#0f0","#0ff","#00f","#90f","#f0f"],["#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d0e0e3","#cfe2f3","#d9d2e9","#ead1dc"],["#ea9999","#f9cb9c","#ffe599","#b6d7a8","#a2c4c9","#9fc5e8","#b4a7d6","#d5a6bd"],["#e06666","#f6b26b","#ffd966","#93c47d","#76a5af","#6fa8dc","#8e7cc3","#c27ba0"],["#c00","#e69138","#f1c232","#6aa84f","#45818e","#3d85c6","#674ea7","#a64d79"],["#900","#b45f06","#bf9000","#38761d","#134f5c","#0b5394","#351c75","#741b47"],["#600","#783f04","#7f6000","#274e13","#0c343d","#073763","#20124d","#4c1130"]],change:function(t){t=null!=t?t.toHexString():"#fff",$("#luckysheet-icon-cell-color .text-color-bar").css("background-color",t),$("#luckysheet-icon-cell-color").attr("color",t);let l=M.deepCopyFlowData(M.flowdata);e.updateFormat(l,"bg",t),n.hide(),be()}}),n.find(".luckysheet-color-reset").click(function(){n.hide(),be();let l=$("#"+t).find(".luckysheet-color-selected");l.val("#ffffff"),$("#luckysheet-icon-cell-color").attr("color",null),l.spectrum("set","#ffffff"),$("#luckysheet-icon-cell-color .luckysheet-color-menu-button-indicator").css("border-bottom-color","#ffffff");let o=M.deepCopyFlowData(M.flowdata);e.updateFormat(o,"bg",null)}),n.find(".luckysheet-icon-alternateformat").click(function(){if(n.hide(),be(),M.luckysheet_select_save.length>1)return void(K()?alert(u.errorInfo):k.info(u.errorInfo,""));let e=$.extend(!0,{},M.luckysheet_select_save[0]);o.rangeIsExists(e)[0]||(o.modelfocusIndex=0,o.new(e)),o.init(),o.perfect()}),$("#"+t).find(".luckysheet-color-selected").val("#fff")}let i=$(this).outerWidth(),c=n.outerWidth(),s=$(this).offset().left;c>i&&c+s>$("#"+M.container).width()&&(s=s-c+i);let a=$(this).offset().top+26;setTimeout(function(){let e=$("#"+t).find(".luckysheet-color-selected");e.spectrum("set",e.val()),ge(n,s-28,a,"lefttop")},1)});let t=null;$("#luckysheet-icon-font-size").mousedown(function(e){if(parseInt($("#luckysheet-input-box").css("top"))>0){let e=window.getSelection();if("None"!=e.type){let t=e.getRangeAt(0);t.collapsed||(M.inlineStringEditRange=t.cloneRange())}}ce(e),e.stopPropagation()}).click(function(){let l=$(this).attr("id")+"-menuButton",n=$("#"+l);if(0==n.length){let o=[{text:"9",value:"9",example:""},{text:"10",value:"10",example:""},{text:"11",value:"11",example:""},{text:"12",value:"12",example:""},{text:"14",value:"14",example:""},{text:"16",value:"16",example:""},{text:"18",value:"18",example:""},{text:"20",value:"20",example:""},{text:"22",value:"22",example:""},{text:"24",value:"24",example:""},{text:"26",value:"26",example:""},{text:"28",value:"28",example:""},{text:"36",value:"36",example:""},{text:"48",value:"48",example:""},{text:"72",value:"72",example:""}],i=e.createButtonMenu(o),c=ye(e.menu,{id:"font-size",item:i,subclass:"",sub:""});$("body").append(c),n=$("#"+l).width(150),e.focus(n,10),n.find(".luckysheet-cols-menuitem").click(function(){n.hide(),be();let l=$(this).attr("itemvalue"),o=$("#luckysheet-icon-font-size input");$("#luckysheet-icon-font-size").attr("itemvalue",l),e.focus(n,l),o.val(l);let i=M.deepCopyFlowData(M.flowdata);e.updateFormat(i,"fs",l),clearTimeout(t)})}let o=$(this).outerWidth(),i=n.outerWidth(),c=$("#luckysheet-icon-font-size").attr("itemvalue");null==c&&(c=10),e.focus(n,c);let s=$(this).offset().left;i>o&&i+s>$("#"+M.container).width()&&(s=s-i+o),ge(n,s,$(this).offset().top+25,"lefttop")}).find("input.luckysheet-toolbar-textinput").keydown(function(e){ce(e),e.stopPropagation()}).keyup(function(l){if(13!=l.keyCode)return;let n=$(this),o=parseInt(n.val()),i=$("#luckysheet-icon-font-size-menuButton");e.focus(i,o);let c=M.deepCopyFlowData(M.flowdata);e.updateFormat(c,"fs",o),t=setTimeout(function(){i.hide(),n.blur()},200)}),$("#luckysheet-icon-border-all").click(function(){if(!$e(M.currentSheetIndex))return;M.deepCopyFlowData(M.flowdata);let e=$(this).attr("type");null==e&&(e="border-all");let t=$("#luckysheet-icon-borderColor-menuButton").find(".luckysheet-color-selected").val(),l=$("#luckysheetborderSizepreview").attr("itemvalue");null!=t&&""!=t||(t="#000"),null!=l&&""!=l||(l="1");let n=$.extend(!0,{},M.config);null==n.borderInfo&&(n.borderInfo=[]);let o={rangeType:"range",borderType:e,color:t,style:l,range:$.extend(!0,[],M.luckysheet_select_save)};if(n.borderInfo.push(o),M.clearjfundo){M.jfundo.length=0;let e=[];e.type="borderChange",e.config=$.extend(!0,{},M.config),e.curconfig=$.extend(!0,{},n),e.sheetIndex=M.currentSheetIndex,M.jfredo.push(e)}M.saveParam("cg",M.currentSheetIndex,n.borderInfo,{k:"borderInfo"}),M.config=n,M.luckysheetfile[se(M.currentSheetIndex)].config=M.config,M.refresh()}),$("#luckysheet-icon-border-menu").click(function(){let t=$(this).attr("id")+"-menuButton",l=$("#"+t);if(0==l.length){let n=10,o=120;const i=P(),c=i.border,s=i.toolbar,a=i.button;let u=[{text:c.borderTop,value:"border-top",example:'<div class="luckysheet-icon luckysheet-inline-block luckysheet-material-icon luckysheet-mousedown-cancel" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-border-top iconfont luckysheet-iconfont-shangbiankuang" style="user-select: none;"> </div> </div>'},{text:c.borderBottom,value:"border-bottom",example:'<div class="luckysheet-icon luckysheet-inline-block luckysheet-material-icon luckysheet-mousedown-cancel" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-border-bottom iconfont luckysheet-iconfont-xiabiankuang" style="user-select: none;"> </div> </div>'},{text:c.borderLeft,value:"border-left",example:'<div class="luckysheet-icon luckysheet-inline-block luckysheet-material-icon luckysheet-mousedown-cancel" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-border-left iconfont luckysheet-iconfont-zuobiankuang" style="user-select: none;"> </div> </div>'},{text:c.borderRight,value:"border-right",example:'<div class="luckysheet-icon luckysheet-inline-block luckysheet-material-icon luckysheet-mousedown-cancel" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-border-right iconfont luckysheet-iconfont-youbiankuang" style="user-select: none;"> </div> </div>'},{text:"",value:"split",example:""},{text:c.borderNone,value:"border-none",example:'<div class="luckysheet-icon luckysheet-inline-block luckysheet-material-icon luckysheet-mousedown-cancel" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-border-none iconfont luckysheet-iconfont-wubiankuang" style="user-select: none;"> </div> </div>'},{text:c.borderAll,value:"border-all",example:'<div class="luckysheet-icon luckysheet-inline-block luckysheet-material-icon luckysheet-mousedown-cancel" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-border-all iconfont luckysheet-iconfont-quanjiabiankuang" style="user-select: none;"> </div> </div>'},{text:c.borderOutside,value:"border-outside",example:'<div class="luckysheet-icon luckysheet-inline-block luckysheet-material-icon luckysheet-mousedown-cancel" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-border-outside iconfont luckysheet-iconfont-sizhoujiabiankuang" style="user-select: none;"> </div> </div>'},{text:"",value:"split",example:""},{text:c.borderInside,value:"border-inside",example:'<div class="luckysheet-icon luckysheet-inline-block luckysheet-material-icon luckysheet-mousedown-cancel" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-border-inside iconfont luckysheet-iconfont-neikuangxian" style="user-select: none;"> </div> </div>'},{text:c.borderHorizontal,value:"border-horizontal",example:'<div class="luckysheet-icon luckysheet-inline-block luckysheet-material-icon luckysheet-mousedown-cancel" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-border-horizontal iconfont luckysheet-iconfont-neikuanghengxian" style="user-select: none;"> </div> </div>'},{text:c.borderVertical,value:"border-vertical",example:'<div class="luckysheet-icon luckysheet-inline-block luckysheet-material-icon luckysheet-mousedown-cancel" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-border-vertical iconfont luckysheet-iconfont-neikuangshuxian" style="user-select: none;"> </div> </div>'},{text:"",value:"split",example:""},{text:"<span id='luckysheet-icon-borderColor-linecolor' class='luckysheet-mousedown-cancel' style='border-bottom:3px solid #000;'>"+c.borderColor+"</span>",value:"borderColor",example:"more"},{text:c.borderSize+"<img id='luckysheetborderSizepreview' width=100 height=10 src='data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==' style='position:absolute;bottom:-5px;right:0px;width:100px;height:10px;'>",value:"borderSize",example:"more"}];const r=E.border;let d=e.createButtonMenu(u),h=ye(e.menu,{id:"border-menu",item:d,subclass:"",sub:""}),f=[{text:c.borderNone,value:"0",example:""},{text:"<canvas type='Thin' class='border-Thin' width="+o+" height="+n+" style='width:"+o+"px;height:"+n+"px;position:static;'></canvas>",value:"1",example:""},{text:"<canvas type='Hair' class='border-Hair' width="+o+" height="+n+" style='width:"+o+"px;height:"+n+"px;position:static;'></canvas>",value:"2",example:""},{text:"<canvas type='Dotted' class='border-Dotted' width="+o+" height="+n+" style='width:"+o+"px;height:"+n+"px;position:static;'></canvas>",value:"3",example:""},{text:"<canvas type='Dashed' class='border-Dashed' width="+o+" height="+n+" style='width:"+o+"px;height:"+n+"px;position:static;'></canvas>",value:"4",example:""},{text:"<canvas type='DashDot' class='border-DashDot' width="+o+" height="+n+" style='width:"+o+"px;height:"+n+"px;position:static;'></canvas>",value:"5",example:""},{text:"<canvas type='DashDotDot' class='border-DashDotDot' width="+o+" height="+n+" style='width:"+o+"px;height:"+n+"px;position:static;'></canvas>",value:"6",example:""},{text:"<canvas type='Medium' class='border-Medium' width="+o+" height="+n+" style='width:"+o+"px;height:"+n+"px;position:static;'></canvas>",value:"8",example:""},{text:"<canvas type='MediumDashed' class='border-MediumDashed' width="+o+" height="+n+" style='width:"+o+"px;height:"+n+"px;position:static;'></canvas>",value:"9",example:""},{text:"<canvas type='MediumDashDot' class='border-MediumDashDot' width="+o+" height="+n+" style='width:"+o+"px;height:"+n+"px;position:static;'></canvas>",value:"10",example:""},{text:"<canvas type='MediumDashDotDot' class='border-MediumDashDotDot' width="+o+" height="+n+" style='width:"+o+"px;height:"+n+"px;position:static;'></canvas>",value:"11",example:""},{text:"<canvas type='Thick' class='border-Thick' width="+o+" height="+n+" style='width:"+o+"px;height:"+n+"px;position:static;'></canvas>",value:"13",example:""}],m=e.createButtonMenu(f),p=ye(e.menu,{id:"borderSize",item:m,subclass:"luckysheet-menuButton-sub"}),y="luckysheet-icon-borderSize-menuButton",v="luckysheet-icon-borderColor-menuButton",k=ye(e.color,{id:v,coloritem:"",colorself:"",sub:"luckysheet-menuButton-sub",resetColor:s.resetColor});$("body").append(h+k+p),l=$("#"+t).width(170),e.focus(l,"border-all"),$("#"+y+" canvas").each(function(t){$(this).attr("type");let l=$(this).closest(".luckysheet-cols-menuitem").attr("itemvalue"),n=$(this).addClass("luckysheet-mousedown-cancel").get(0).getContext("2d");n.translate(.5,.5),e.setLineDash(n,l,"h",0,5,100,5),n.strokeStyle="#000000",n.stroke(),n.closePath()}),$("#"+y+" .luckysheet-cols-menuitem").click(function(){$("#"+y).hide();let t=$(this),l=t.attr("itemvalue");if(0==l)$("#luckysheetborderSizepreview").attr("src","data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==").attr("itemvalue",null);else{let e=t.find("canvas").get(0).toDataURL("image/png");$("#luckysheetborderSizepreview").attr("src",e).attr("itemvalue",l)}e.focus($("#"+y),l)}),l.find(".luckysheet-cols-menuitem").click(function(){l.hide(),be();let t=$(this).attr("itemvalue");if("borderColor"==t||"borderSize"==t)return;if(!$e(M.currentSheetIndex))return;M.deepCopyFlowData(M.flowdata);let n=$("#"+v).find(".luckysheet-color-selected").val(),o=$("#luckysheetborderSizepreview").attr("itemvalue");null!=n&&""!=n||(n="#000"),null!=o&&""!=o||(o="1");let i=$.extend(!0,{},M.config);null==i.borderInfo&&(i.borderInfo=[]);let c={rangeType:"range",borderType:t,color:n,style:o,range:$.extend(!0,[],M.luckysheet_select_save)};if(i.borderInfo.push(c),M.clearjfundo){M.jfundo.length=0;let e=[];e.type="borderChange",e.config=$.extend(!0,{},M.config),e.curconfig=$.extend(!0,{},i),e.sheetIndex=M.currentSheetIndex,M.jfredo.push(e)}M.saveParam("cg",M.currentSheetIndex,i.borderInfo,{k:"borderInfo"}),M.config=i,M.luckysheetfile[se(M.currentSheetIndex)].config=M.config,M.refresh(),$("#luckysheet-icon-border-all").attr("type",t),$("#luckysheet-icon-border-all").find(".luckysheet-icon-img-container").removeAttr("class").addClass("luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-"+t+r[t]),e.focus(l,t)}),$("#"+v).find(".luckysheet-color-selected").spectrum({showPalette:!0,showPaletteOnly:!0,preferredFormat:"hex",clickoutFiresChange:!1,showInitial:!0,showInput:!0,flat:!0,hideAfterPaletteSelect:!0,showSelectionPalette:!0,maxPaletteSize:8,maxSelectionSize:8,color:"#000",cancelText:a.cancel,chooseText:a.confirm,togglePaletteMoreText:s.customColor,togglePaletteLessText:s.collapse,togglePaletteOnly:!0,clearText:s.clearText,noColorSelectedText:s.noColorSelectedText,localStorageKey:"spectrum.bordercolor"+M.gridKey,palette:[["#000","#444","#666","#999","#ccc","#eee","#f3f3f3","#fff"],["#f00","#f90","#ff0","#0f0","#0ff","#00f","#90f","#f0f"],["#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d0e0e3","#cfe2f3","#d9d2e9","#ead1dc"],["#ea9999","#f9cb9c","#ffe599","#b6d7a8","#a2c4c9","#9fc5e8","#b4a7d6","#d5a6bd"],["#e06666","#f6b26b","#ffd966","#93c47d","#76a5af","#6fa8dc","#8e7cc3","#c27ba0"],["#c00","#e69138","#f1c232","#6aa84f","#45818e","#3d85c6","#674ea7","#a64d79"],["#900","#b45f06","#bf9000","#38761d","#134f5c","#0b5394","#351c75","#741b47"],["#600","#783f04","#7f6000","#274e13","#0c343d","#073763","#20124d","#4c1130"]],change:function(e){$(this);e=null!=e?e.toHexString():"#000";$("#luckysheet-icon-borderColor-linecolor").css("border-bottom-color",e),$("#"+v).find(".luckysheet-color-selected").val(e)}}),$("#"+v).find(".luckysheet-color-reset").click(function(){let e=$("#"+v).find(".luckysheet-color-selected");e.val("#000"),$("#luckysheet-icon-cell-color").attr("color",null),e.spectrum("set","#000"),$("#luckysheet-icon-borderColor-linecolor").css("border-bottom-color","#000")})}let n=$(this).outerWidth(),o=l.outerWidth(),i=$(this).offset().left;o>n&&o+i>$("#"+M.container).width()&&(i=i-o+n),ge(l,i-28,$(this).offset().top+25,"lefttop")}),$("#luckysheet-icon-merge-button").click(function(){if(!_e(M.currentSheetIndex))return;if(O())return void(K()?alert("不能合并重叠区域"):k.info("不能合并重叠区域",""));if(null!=M.config.merge){let e=!1;for(let t=0;t<M.luckysheet_select_save.length;t++){let l=M.luckysheet_select_save[t].row[0],n=M.luckysheet_select_save[t].row[1],o=M.luckysheet_select_save[t].column[0],i=M.luckysheet_select_save[t].column[1];if(e=q(M.config,l,n,o,i))break}if(e)return void(K()?alert("无法对部分合并单元格执行此操作"):k.info("无法对部分合并单元格执行此操作",""))}let t=M.deepCopyFlowData(M.flowdata);e.updateFormat_mc(t,"mergeAll")}),$("#luckysheet-icon-merge-menu").click(function(){let t=$(this).attr("id")+"-menuButton",l=$("#"+t);if(0==l.length){const n=P().merge;let o=[{text:n.mergeAll,value:"mergeAll",example:""},{text:n.mergeV,value:"mergeV",example:""},{text:n.mergeH,value:"mergeH",example:""},{text:n.mergeCancel,value:"mergeCancel",example:""}],i=e.createButtonMenu(o),c=ye(e.menu,{id:"merge-menu",item:i,subclass:"",sub:""});$("body").append(c),l=$("#"+t).width(110),e.focus(l),l.find(".luckysheet-cols-menuitem").click(function(){if(l.hide(),be(),O())return void(K()?alert(n.overlappingError):k.info(n.overlappingError,""));if(null!=M.config.merge){let e=!1;for(let t=0;t<M.luckysheet_select_save.length;t++){let l=M.luckysheet_select_save[t].row[0],n=M.luckysheet_select_save[t].row[1],o=M.luckysheet_select_save[t].column[0],i=M.luckysheet_select_save[t].column[1];if(e=q(M.config,l,n,o,i))break}if(e)return void(K()?alert(n.partiallyError):k.info(n.partiallyError,""))}let t=$(this).attr("itemvalue");e.focus(l,t);let o=M.deepCopyFlowData(M.flowdata);e.updateFormat_mc(o,t)})}let n=$(this).outerWidth(),o=l.outerWidth(),i=$(this).offset().left;o>n&&o+i>$("#"+M.container).width()&&(i=i-o+n),ge(l,i-28,$(this).offset().top+25,"lefttop")}),$("#luckysheet-icon-align").click(function(){let t=$("#luckysheet-icon-align").attr("type");null==t&&(t="left");let l=M.deepCopyFlowData(M.flowdata);e.updateFormat(l,"ht",t)}),$("#luckysheet-icon-align-menu").click(function(){let t=$(this).attr("id")+"-menuButton",l=$("#"+t);if(0==l.length){const n=P().align;let o=[{text:n.left,value:"left",example:'<div class="luckysheet-icon luckysheet-inline-block" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-align-left iconfont luckysheet-iconfont-wenbenzuoduiqi" style="user-select: none;"> </div> </div>'},{text:n.center,value:"center",example:'<div class="luckysheet-icon luckysheet-inline-block" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-align-center iconfont luckysheet-iconfont-wenbenjuzhongduiqi" style="user-select: none;"> </div> </div>'},{text:n.right,value:"right",example:'<div class="luckysheet-icon luckysheet-inline-block" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-align-right iconfont luckysheet-iconfont-wenbenyouduiqi" style="user-select: none;"> </div> </div>'}];const i=E.align;let c=e.createButtonMenu(o),s=ye(e.menu,{id:"align-menu",item:c,subclass:"",sub:""});$("body").append(s),l=$("#"+t).width(120),e.focus(l),l.find(".luckysheet-cols-menuitem").click(function(){l.hide(),be();let t=$(this).attr("itemvalue");e.focus(l,t),$("#luckysheet-icon-align").attr("type",t).find(".luckysheet-icon-img-container").removeAttr("class").addClass("luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-align-"+t+i[t]);let n=M.deepCopyFlowData(M.flowdata);e.updateFormat(n,"ht",t)})}let n=$(this).outerWidth(),o=l.outerWidth(),i=$(this).offset().left;o>n&&o+i>$("#"+M.container).width()&&(i=i-o+n),ge(l,i-28,$(this).offset().top+25,"lefttop")}),$("#luckysheet-icon-valign").click(function(){let t=$("#luckysheet-icon-valign").attr("type");null==t&&(t="bottom");let l=M.deepCopyFlowData(M.flowdata);e.updateFormat(l,"vt",t)}),$("#luckysheet-icon-valign-menu").click(function(){let t=$(this).attr("id")+"-menuButton",l=$("#"+t);const n=P().align;if(0==l.length){let o=[{text:n.top,value:"top",example:'<div class="luckysheet-icon luckysheet-inline-block" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-valign-top iconfont luckysheet-iconfont-dingbuduiqi" style="user-select: none;"> </div> </div>'},{text:n.middle,value:"middle",example:'<div class="luckysheet-icon luckysheet-inline-block" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-valign-middle iconfont luckysheet-iconfont-shuipingduiqi" style="user-select: none;"> </div> </div>'},{text:n.bottom,value:"bottom",example:'<div class="luckysheet-icon luckysheet-inline-block" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-valign-bottom iconfont luckysheet-iconfont-dibuduiqi" style="user-select: none;"> </div> </div>'}];const i=E.align;let c=e.createButtonMenu(o),s=ye(e.menu,{id:"valign-menu",item:c,subclass:"",sub:""});$("body").append(s),l=$("#"+t).width(120),e.focus(l,"bottom"),l.find(".luckysheet-cols-menuitem").click(function(){l.hide(),be();let t=$(this).attr("itemvalue");e.focus(l,t),$("#luckysheet-icon-valign").attr("type",t).find(".luckysheet-icon-img-container").removeAttr("class").addClass("luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-valign-"+t+i[t]);let n=M.deepCopyFlowData(M.flowdata);e.updateFormat(n,"vt",t)})}let o=$(this).outerWidth(),i=l.outerWidth(),c=$(this).offset().left;i>o&&i+c>$("#"+M.container).width()&&(c=c-i+o),ge(l,c-28,$(this).offset().top+25,"lefttop")}),$("#luckysheet-icon-textwrap-menu").click(function(){let t=$(this).attr("id")+"-menuButton",l=$("#"+t);if(0==l.length){const n=P().textWrap;let o=[{text:n.overflow,value:"overflow",example:'<div class="luckysheet-icon luckysheet-inline-block" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-textwrap-overflow iconfont luckysheet-iconfont-yichu1" style="user-select: none;"> </div> </div>'},{text:n.wrap,value:"wrap",example:'<div class="luckysheet-icon luckysheet-inline-block" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-textwrap-wrap iconfont luckysheet-iconfont-zidonghuanhang" style="user-select: none;"> </div> </div>'},{text:n.clip,value:"clip",example:'<div class="luckysheet-icon luckysheet-inline-block" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-textwrap-clip iconfont luckysheet-iconfont-jieduan" style="user-select: none;"> </div> </div>'}];const i=E.textWrap;let c=e.createButtonMenu(o),s=ye(e.menu,{id:"textwrap-menu",item:c,subclass:"",sub:""});$("body").append(s),l=$("#"+t).width(120),e.focus(l,"clip"),l.find(".luckysheet-cols-menuitem").click(function(){l.hide(),be();let t=$(this).attr("itemvalue");e.focus(l,t),$("#luckysheet-icon-textwrap").attr("type",t).find(".luckysheet-icon-img-container").removeAttr("class").addClass("luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-textwrap-"+t+i[t]);let n=M.deepCopyFlowData(M.flowdata);e.updateFormat(n,"tb",t)})}let n=$(this).outerWidth(),o=l.outerWidth(),i=$(this).offset().left;o>n&&o+i>$("#"+M.container).width()&&(i=i-o+n),ge(l,i-28,$(this).offset().top+25,"lefttop")}),$("#luckysheet-icon-rotation-menu").click(function(){let t=$(this).attr("id")+"-menuButton",l=$("#"+t);if(0==l.length){const n=P().rotation;let o=[{text:n.none,value:"none",example:'<div class="luckysheet-icon luckysheet-inline-block" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-rotation-none iconfont luckysheet-iconfont-wuxuanzhuang" style="user-select: none;"> </div> </div>'},{text:n.angleup,value:"angleup",example:'<div class="luckysheet-icon luckysheet-inline-block" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-rotation-angleup iconfont luckysheet-iconfont-xiangshangqingxie" style="user-select: none;"> </div> </div>'},{text:n.angledown,value:"angledown",example:'<div class="luckysheet-icon luckysheet-inline-block" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-rotation-angledown iconfont luckysheet-iconfont-xiangxiaqingxie" style="user-select: none;"> </div> </div>'},{text:n.vertical,value:"vertical",example:'<div class="luckysheet-icon luckysheet-inline-block" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-rotation-vertical iconfont luckysheet-iconfont-shupaiwenzi" style="user-select: none;"> </div> </div>'},{text:n.rotationUp,value:"rotation-up",example:'<div class="luckysheet-icon luckysheet-inline-block" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-rotation-rotation-up iconfont luckysheet-iconfont-wenbenxiangshang" style="user-select: none;"> </div> </div>'},{text:n.rotationDown,value:"rotation-down",example:'<div class="luckysheet-icon luckysheet-inline-block" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-rotation-rotation-down iconfont luckysheet-iconfont-xiangxia90" style="user-select: none;"> </div> </div>'}];const i=E.rotation;let c=e.createButtonMenu(o),s=ye(e.menu,{id:"rotation-menu",item:c,subclass:"",sub:""});$("body").append(s),l=$("#"+t).width(160),e.focus(l),l.find(".luckysheet-cols-menuitem").click(function(){l.hide(),be();let t=$(this).attr("itemvalue");e.focus(l,t),$("#luckysheet-icon-rotation").attr("type",t).find(".luckysheet-icon-img-container").removeAttr("class").addClass("luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-rotation-"+t+i[t]);let n=M.deepCopyFlowData(M.flowdata);e.updateFormat(n,"tr",t)})}let n=$(this).outerWidth(),o=l.outerWidth(),i=$(this).offset().left;o>n&&o+i>$("#"+M.container).width()&&(i=i-o+n),ge(l,i-28,$(this).offset().top+25,"lefttop")}),$("#luckysheet-icon-freezen-menu").click(function(){let t=$(this).attr("id")+"-menuButton",l=$("#"+t);if(0==l.length){const n=P().freezen;let o=[{text:n.freezenRow,value:"freezenRow",example:""},{text:n.freezenColumn,value:"freezenColumn",example:""},{text:n.freezenRC,value:"freezenRC",example:""},{text:"",value:"split",example:""},{text:n.freezenRowRange,value:"freezenRowRange",example:""},{text:n.freezenColumnRange,value:"freezenColumnRange",example:""},{text:n.freezenRCRange,value:"freezenRCRange",example:""},{text:"",value:"split",example:""},{text:n.freezenCancel,value:"freezenCancel",example:""}],i=e.createButtonMenu(o),c=ye(e.menu,{id:"freezen-menu",item:i,subclass:"",sub:""});$("body").append(c),(l=$("#"+t).width(170)).find(".luckysheet-cols-menuitem").click(function(){l.hide(),be();let t=$(this).attr("itemvalue");if(e.focus(l,t),s.saveFrozen(t),"freezenRow"==t){let e=$("#luckysheet-cell-main").scrollTop(),t=j(M.visibledatarow,e);-1==t&&(t=0);let l=M.visibledatarow[t]-2-e+M.columnHeaderHeight,n=[M.visibledatarow[t],t+1,e,s.cutVolumn(M.visibledatarow,t+1),l];s.saveFreezen(n,l,null,null),null!=M.freezenverticaldata&&(s.cancelFreezenVertical(),s.createAssistCanvas(),M.refresh()),s.createFreezenHorizontal(n,l),s.createAssistCanvas(),M.refresh()}else if("freezenColumn"==t){let e=$("#luckysheet-cell-main").scrollLeft(),t=j(M.visibledatacolumn,e);-1==t&&(t=0);let l=M.visibledatacolumn[t]-2-e+M.rowHeaderWidth,n=[M.visibledatacolumn[t],t+1,e,s.cutVolumn(M.visibledatacolumn,t+1),l];s.saveFreezen(null,null,n,l),null!=M.freezenhorizontaldata&&(s.cancelFreezenHorizontal(),s.createAssistCanvas(),M.refresh()),s.createFreezenVertical(n,l),s.createAssistCanvas(),M.refresh()}else if("freezenRC"==t){let e=$("#luckysheet-cell-main").scrollTop(),t=j(M.visibledatarow,e);-1==t&&(t=0);let l=M.visibledatarow[t]-2-e+M.columnHeaderHeight,n=[M.visibledatarow[t],t+1,e,s.cutVolumn(M.visibledatarow,t+1),l];s.saveFreezen(n,l,null,null),s.createFreezenHorizontal(n,l);let o=$("#luckysheet-cell-main").scrollLeft(),i=j(M.visibledatacolumn,o);-1==i&&(i=0);let c=M.visibledatacolumn[i]-2-o+M.rowHeaderWidth,a=[M.visibledatacolumn[i],i+1,o,s.cutVolumn(M.visibledatacolumn,i+1),c];s.saveFreezen(null,null,a,c),s.createFreezenVertical(a,c),s.createAssistCanvas(),M.refresh()}else if("freezenRowRange"==t){if(null==M.luckysheet_select_save||0==M.luckysheet_select_save.length)return void(K()?alert(n.noSeletionError):k.info(n.noSeletionError,""));let e=$("#luckysheet-cell-main").scrollTop(),t=j(M.visibledatarow,e),l=M.luckysheet_select_save[M.luckysheet_select_save.length-1],o=null==l.row_focus?l.row[0]:l.row_focus;o>t&&(t=o),-1==t&&(t=0);let i=M.visibledatarow[t]-2-e+M.columnHeaderHeight,c=[M.visibledatarow[t],t+1,e,s.cutVolumn(M.visibledatarow,t+1),i];s.saveFreezen(c,i,null,null),null!=M.freezenverticaldata&&(s.cancelFreezenVertical(),s.createAssistCanvas(),M.refesh()),s.createFreezenHorizontal(c,i),s.createAssistCanvas(),M.refesh()}else if("freezenColumnRange"==t){if(null==M.luckysheet_select_save||0==M.luckysheet_select_save.length)return void(K()?alert(n.noSeletionError):k.info(n.noSeletionError,""));let e=$("#luckysheet-cell-main").scrollLeft(),t=j(M.visibledatacolumn,e),l=M.luckysheet_select_save[M.luckysheet_select_save.length-1],o=null==l.column_focus?l.column[0]:l.column_focus;o>t&&(t=o),-1==t&&(t=0);let i=M.visibledatacolumn[t]-2-e+M.rowHeaderWidth,c=[M.visibledatacolumn[t],t+1,e,s.cutVolumn(M.visibledatacolumn,t+1),i];s.saveFreezen(null,null,c,i),null!=M.freezenhorizontaldata&&(s.cancelFreezenHorizontal(),s.createAssistCanvas(),M.refesh()),s.createFreezenVertical(c,i),s.createAssistCanvas(),M.refresh()}else if("freezenRCRange"==t){if(null==M.luckysheet_select_save||0==M.luckysheet_select_save.length)return void(K()?alert(n.noSeletionError):k.info(n.noSeletionError,""));let e=$("#luckysheet-cell-main").scrollTop(),t=j(M.visibledatarow,e),l=M.luckysheet_select_save[M.luckysheet_select_save.length-1],o=null==l.row_focus?l.row[0]:l.row_focus;o>t&&(t=o),-1==t&&(t=0);let i=M.visibledatarow[t]-2-e+M.columnHeaderHeight,c=[M.visibledatarow[t],t+1,e,s.cutVolumn(M.visibledatarow,t+1),i];s.saveFreezen(c,i,null,null),s.createFreezenHorizontal(c,i);let a=$("#luckysheet-cell-main").scrollLeft(),u=j(M.visibledatacolumn,a),r=null==l.column_focus?l.column[0]:l.column_focus;r>u&&(u=r),-1==u&&(u=0);let d=M.visibledatacolumn[u]-2-a+M.rowHeaderWidth,h=[M.visibledatacolumn[u],u+1,a,s.cutVolumn(M.visibledatacolumn,u+1),d];s.saveFreezen(null,null,h,d),s.createFreezenVertical(h,d),s.createAssistCanvas(),M.refresh()}else"freezenCancel"==t&&(null!=M.freezenverticaldata&&(s.cancelFreezenVertical(),s.createAssistCanvas(),M.refresh()),null!=M.freezenhorizontaldata&&(s.cancelFreezenHorizontal(),s.createAssistCanvas(),M.refresh()),s.scrollAdapt());setTimeout(function(){a()},0)})}let n=$(this).outerWidth(),o=l.outerWidth(),i=$(this).offset().left;o>n&&o+i>$("#"+M.container).width()&&(i=i-o+n),ge(l,i-68,$(this).offset().top+25,"lefttop")}),$("#luckysheet-icon-autofilter").click(function(){let t=$(this).attr("id")+"-menuButton",l=$("#"+t);if(0==l.length){const n=P(),o=n.sort,i=n.filter;let c=[{text:o.asc,value:"asc",example:'<i class="iconfont luckysheet-iconfont-shengxu" aria-hidden="true"></i>'},{text:o.desc,value:"desc",example:'<i class="iconfont luckysheet-iconfont-jiangxu" aria-hidden="true"></i>'},{text:o.custom+"...",value:"diysort",example:'<i class="iconfont luckysheet-iconfont-zidingyipaixu" aria-hidden="true"></i>'},{text:"",value:"split",example:""},{text:i.filter,value:"filter",example:'<i class="iconfont luckysheet-iconfont-shaixuan2" aria-hidden="true"></i>'},{text:i.clearFilter,value:"clearfilter",example:'<i class="iconfont luckysheet-iconfont-qingchushaixuan" aria-hidden="true"></i>'}],s=e.createButtonMenu(c),a=ye(e.menu,{id:"autofilter",item:s,subclass:"",sub:""});$("body").append(a),(l=$("#"+t).width(150)).find(".luckysheet-cols-menuitem").click(function(){l.hide(),be();let e=$(this).attr("itemvalue");"diysort"==e?$("#luckysheetorderby").click():"asc"==e?X(!0):"desc"==e?X(!1):"filter"==e?$("#luckysheet-filter-options-sheet"+M.currentSheetIndex).length>0?$("#luckysheet-filter-initial").click():H():"clearfilter"==e&&$("#luckysheet-filter-initial").click()})}let n=$(this).outerWidth(),o=l.outerWidth(),i=$(this).offset().left;o>n&&o+i>$("#"+M.container).width()&&(i=i-o+n),ge(l,i,$(this).offset().top+25,"lefttop")}),$("#luckysheet-icon-seachmore").click(function(){let t=$(this).attr("id")+"-menuButton",l=$("#"+t);const n=P().findAndReplace;if(0==l.length){let o=[{text:n.find+" ...",value:"search",example:'<i class="iconfont luckysheet-iconfont-sousuo" aria-hidden="true"></i>'},{text:n.replace+" ...",value:"replace",example:'<i class="iconfont luckysheet-iconfont-tihuan" aria-hidden="true"></i>'},{text:"",value:"split",example:""},{text:n.location+" ...",value:"location",example:'<i class="iconfont luckysheet-iconfont-dingwei" aria-hidden="true"></i>'},{text:n.formula,value:"locationFormula",example:n.locationExample},{text:n.date,value:"locationConstantDate",example:n.locationExample},{text:n.number,value:"locationConstantNumber",example:n.locationExample},{text:n.string,value:"locationConstantString",example:n.locationExample},{text:n.error,value:"locationConstantError",example:n.locationExample},{text:n.condition,value:"locationCF",example:n.locationExample},{text:n.rowSpan,value:"locationStepRow",example:n.locationExample},{text:n.columnSpan,value:"locationStepColumn",example:n.locationExample}],i=e.createButtonMenu(o),c=ye(e.menu,{id:"seachmore",item:i,subclass:"",sub:""});$("body").append(c),(l=$("#"+t).width(180)).find(".luckysheet-cols-menuitem").click(function(){l.hide(),be();let e=$(this).attr("itemvalue");if("search"==e||"replace"==e)"search"==e?r.createDialog(0):"replace"==e&&r.createDialog(1),r.init(),$("#luckysheet-search-replace #searchInput input").focus();else if("location"==e)d.createDialog(),d.init();else if("locationFormula"==e||"locationConstantDate"==e||"locationConstantNumber"==e||"locationConstantString"==e||"locationConstantError"==e||"locationCF"==e){let t,l=M.luckysheet_select_save[0];t=0==M.luckysheet_select_save.length||1==M.luckysheet_select_save.length&&l.row[0]==l.row[1]&&l.column[0]==l.column[1]?[{row:[0,M.flowdata.length-1],column:[0,M.flowdata[0].length-1]}]:$.extend(!0,[],M.luckysheet_select_save),"locationFormula"==e?d.apply(t,"locationFormula","all"):"locationConstantDate"==e?d.apply(t,"locationConstant","d"):"locationConstantNumber"==e?d.apply(t,"locationConstant","n"):"locationConstantString"==e?d.apply(t,"locationConstant","s,g"):"locationConstantError"==e?d.apply(t,"locationConstant","e"):"locationCF"==e&&d.apply(t,"locationCF")}else if("locationStepRow"==e){if(0==M.luckysheet_select_save.length||1==M.luckysheet_select_save.length&&M.luckysheet_select_save[0].row[0]==M.luckysheet_select_save[0].row[1])return void(K()?alert(n.lessTwoRowTip):k.info("",n.lessTwoRowTip));let e=$.extend(!0,[],M.luckysheet_select_save);d.apply(e,"locationStepRow")}else if("locationStepColumn"==e){if(0==M.luckysheet_select_save.length||1==M.luckysheet_select_save.length&&M.luckysheet_select_save[0].column[0]==M.luckysheet_select_save[0].column[1])return void(K()?alert(n.lessTwoColumnTip):k.info("",n.lessTwoColumnTip));let e=$.extend(!0,[],M.luckysheet_select_save);d.apply(e,"locationStepColumn")}})}let o=$(this).outerWidth(),i=l.outerWidth(),c=$(this).offset().left;i>o&&i+c>$("#"+M.container).width()&&(c=c-i+o),ge(l,c,$(this).offset().top+25,"lefttop")}),$("#luckysheet-icon-function").click(function(){e.autoSelectionFormula("SUM")}),$("#luckysheet-icon-function-menu").click(function(){let t=$(this).attr("id")+"-menuButton",l=$("#"+t);const n=P().formula;if(0==l.length){let o=[{text:n.sum,value:"SUM",example:"SUM"},{text:n.average,value:"AVERAGE",example:"AVERAGE"},{text:n.count,value:"COUNT",example:"COUNT"},{text:n.max,value:"MAX",example:"MAX"},{text:n.min,value:"MIN",example:"MIN"},{text:"",value:"split",example:""},{text:n.ifGenerate,value:"if",example:"IF"},{text:n.find+" ...",value:"formula",example:""}],i=e.createButtonMenu(o),c=ye(e.menu,{id:"function-menu",item:i,subclass:"",sub:""});$("body").append(c),(l=$("#"+t).width(180)).find(".luckysheet-cols-menuitem").click(function(){l.hide(),be();let t=$(this).attr("itemvalue");if("if"==t){let e=M.luckysheet_select_save[M.luckysheet_select_save.length-1],t=null==e.row_focus?e.row[0]:e.row_focus,l=null==e.column_focus?e.column[0]:e.column_focus;if(M.flowdata[t]&&M.flowdata[t][l]&&M.flowdata[t][l].f){let e=M.flowdata[t][l].f.toString();if(-1==e.indexOf("=if("))return void(K()?alert(n.tipNotBelongToIf):k.info(n.tipNotBelongToIf,""));h.ifFormulaDialog(e)}else h.ifFormulaDialog();h.init()}else if("formula"==t){if(0==M.luckysheet_select_save.length)return void(K()?alert(n.tipSelectCell):k.info(n.tipSelectCell,""));let e=M.luckysheet_select_save[M.luckysheet_select_save.length-1],t=e.row_focus,l=e.column_focus;G(t,l,M.flowdata);let o=M.flowdata[t][l];if(null!=o&&null!=o.f){let e=b.getfunctionParam(o.f);null!=e.fn?m.formulaParmDialog(e.fn,e.param):m.formulaListDialog()}else $("#luckysheet-rich-text-editor").html('<span dir="auto" class="luckysheet-formula-text-color">=</span>'),$("#luckysheet-functionbox-cell").html($("#luckysheet-rich-text-editor").html()),m.formulaListDialog();m.init()}else e.autoSelectionFormula(t)})}let o=$(this).outerWidth(),i=l.outerWidth(),c=$(this).offset().left;i>o&&i+c>$("#"+M.container).width()&&(c=c-i+o),ge(l,c-48,$(this).offset().top+25,"lefttop")}),$("#luckysheet-icon-bold").mousedown(function(e){ce(e),e.stopPropagation()}).click(function(t){let l=M.deepCopyFlowData(M.flowdata),n=M.luckysheet_select_save[0].row_focus,o=M.luckysheet_select_save[0].column_focus,i=e.checkstatus(l,n,o,"bl");i=1==i?0:1,e.updateFormat(l,"bl",i),e.menuButtonFocus(l,n,o)}),$("#luckysheet-icon-italic").mousedown(function(e){ce(e),e.stopPropagation()}).click(function(){let t=M.deepCopyFlowData(M.flowdata),l=M.luckysheet_select_save[0].row_focus,n=M.luckysheet_select_save[0].column_focus,o=e.checkstatus(t,l,n,"it");o=1==o?0:1,e.updateFormat(t,"it",o),e.menuButtonFocus(t,l,n)}),$("#luckysheet-icon-strikethrough").mousedown(function(e){ce(e),e.stopPropagation()}).click(function(){let t=M.deepCopyFlowData(M.flowdata),l=M.luckysheet_select_save[0].row_focus,n=M.luckysheet_select_save[0].column_focus,o=e.checkstatus(t,l,n,"cl");o=1==o?0:1,e.updateFormat(t,"cl",o),e.menuButtonFocus(t,l,n)}),$("#luckysheet-icon-underline").mousedown(function(e){ce(e),e.stopPropagation()}).click(function(){let t=M.deepCopyFlowData(M.flowdata),l=M.luckysheet_select_save[0].row_focus,n=M.luckysheet_select_save[0].column_focus,o=e.checkstatus(t,l,n,"un");o=1==o?0:1,e.updateFormat(t,"un",o),e.menuButtonFocus(t,l,n)}),$("#luckysheet-icon-conditionformat").click(function(){let t=$(this).attr("id")+"-menuButton",l=$("#"+t);const n=P().conditionformat;if(0==l.length){let o=[{text:n.highlightCellRules,value:"highlightCellRule",example:"more"},{text:n.itemSelectionRules,value:"projectSelectRule",example:"more"},{text:n.dataBar,value:"dataBar",example:"more"},{text:n.colorGradation,value:"colorGradation",example:"more"},{text:n.icons,value:"icons",example:""},{text:"",value:"split",example:""},{text:n.newRule,value:"newRule",example:""},{text:n.deleteRule,value:"deleteRule",example:"more"},{text:n.manageRules,value:"administerRule",example:""}],c=e.createButtonMenu(o),s=ye(e.menu,{id:"conditionformat",item:c,subclass:"",sub:""}),a=[{text:n.greaterThan,value:"greaterThan",example:">"},{text:n.lessThan,value:"lessThan",example:"<"},{text:n.between,value:"betweenness",example:"[]"},{text:n.equal,value:"equal",example:"="},{text:n.textContains,value:"textContains",example:"()"},{text:n.occurrence,value:"occurrenceDate",example:n.yesterday},{text:n.duplicateValue,value:"duplicateValue",example:"##"}],u=e.createButtonMenu(a),r=ye(e.menu,{id:"highlightCellRule",item:u,subclass:"luckysheet-menuButton-sub"}),d=[{text:n.top10,value:"top10",example:n.top10},{text:n.top10_percent,value:"top10%",example:n.top10_percent},{text:n.last10,value:"last10",example:n.last10},{text:n.last10_percent,value:"last10%",example:n.last10_percent},{text:n.aboveAverage,value:"AboveAverage",example:n.above},{text:n.belowAverage,value:"SubAverage",example:n.below}],h=e.createButtonMenu(d),f=ye(e.menu,{id:"projectSelectRule",item:h,subclass:"luckysheet-menuButton-sub"}),m=`<div id="luckysheet-icon-dataBar-menuButton" class="luckysheet-cols-menu luckysheet-rightgclick-menu luckysheet-menuButton luckysheet-menuButton-sub luckysheet-mousedown-cancel" style="width: 126px;padding: 5px;top: 118.5px;left: 1321.48px;display: none;">\n                                    <div itemvalue="0" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: 0 0;" title="${n.gradientDataBar_1}"></div>\n                                    </div>\n                                    <div itemvalue="1" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -38px 0;" title="${n.gradientDataBar_2}"></div>\n                                    </div>\n                                    <div itemvalue="2" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -76px 0;" title="${n.gradientDataBar_3}"></div>\n                                    </div>\n                                    <div itemvalue="3" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: 0 -36px;" title="${n.gradientDataBar_4}"></div>\n                                    </div>\n                                    <div itemvalue="4" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -38px -36px;" title="${n.gradientDataBar_5}"></div>\n                                    </div>\n                                    <div itemvalue="5" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -76px -36px;" title="${n.gradientDataBar_6}"></div>\n                                    </div>\n                                    <div itemvalue="6" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: 0 -72px;" title="${n.solidColorDataBar_1}"></div>\n                                    </div>\n                                    <div itemvalue="7" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -38px -72px;" title="${n.solidColorDataBar_2}"></div>\n                                    </div>\n                                    <div itemvalue="8" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -76px -72px;" title="${n.solidColorDataBar_3}"></div>\n                                    </div>\n                                    <div itemvalue="9" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: 0 -108px;" title="${n.solidColorDataBar_4}"></div>\n                                    </div>\n                                    <div itemvalue="10" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -38px -108px;" title="${n.solidColorDataBar_5}"></div>\n                                    </div>\n                                    <div itemvalue="11" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -76px -108px;" title="${n.solidColorDataBar_6}"></div>\n                                    </div>\n                                </div>`,y=`<div id="luckysheet-icon-colorGradation-menuButton" class="luckysheet-cols-menu luckysheet-rightgclick-menu luckysheet-menuButton luckysheet-menuButton-sub luckysheet-mousedown-cancel" style="width: 126px;padding: 5px;top: 143.5px;left: 1321.48px;display: none;">\n                                    <div itemvalue="0" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: 0 0;" title="${n.colorGradation_1}"></div>\n                                    </div>\n                                    <div itemvalue="1" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -38px 0;" title="${n.colorGradation_2}"></div>\n                                    </div>\n                                    <div itemvalue="2" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -76px 0;" title="${n.colorGradation_3}"></div>\n                                    </div>\n                                    <div itemvalue="3" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -114px 0;" title="${n.colorGradation_4}"></div>\n                                    </div>\n                                    <div itemvalue="4" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: 0 -36px;" title="${n.colorGradation_5}"></div>\n                                    </div>\n                                    <div itemvalue="5" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -38px -36px;" title="${n.colorGradation_6}"></div>\n                                    </div>\n                                    <div itemvalue="6" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -76px -36px;" title="${n.colorGradation_7}"></div>\n                                    </div>\n                                    <div itemvalue="7" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -114px -36px;" title="${n.colorGradation_8}"></div>\n                                    </div>\n                                    <div itemvalue="8" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: 0 -72px;" title="${n.colorGradation_9}"></div>\n                                    </div>\n                                    <div itemvalue="9" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -38px -72px;" title="${n.colorGradation_10}"></div>\n                                    </div>\n                                    <div itemvalue="10" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -76px -72px;" title="${n.colorGradation_11}"></div>\n                                    </div>\n                                    <div itemvalue="11" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -114px -72px;" title="${n.colorGradation_12}"></div>\n                                    </div>\n                                </div>`,v=[{text:n.deleteSheetRule,value:"delSheet",example:""}],g=e.createButtonMenu(v),x=ye(e.menu,{id:"deleteRule",item:g,subclass:"luckysheet-menuButton-sub"});$("body").append(s+r+f+m+y+x),l=$("#"+t).width(190),$("#luckysheet-icon-highlightCellRule-menuButton").width(160),$("#luckysheet-icon-projectSelectRule-menuButton").width(180),l.find(".luckysheet-cols-menuitem").click(function(){l.hide(),be();let e=$(this).attr("itemvalue");if("icons"==e){if(0==M.luckysheet_select_save.length)return void(K()?alert(n.pleaseSelectRange):k.info(n.pleaseSelectRange,""));i.CFiconsDialog(),i.init()}else if("newRule"==e){if(0==M.luckysheet_select_save.length)return void(K()?alert(n.pleaseSelectRange):k.info(n.pleaseSelectRange,""));i.newConditionRuleDialog(0),i.init()}else if("administerRule"==e){let e=M.loadSheetUrl,t=ue();if(""!=e&&null!=e){let l=[];for(let e=0;e<t.length;e++)l.push(t[e].index);$.post(e,{gridKey:M.gridKey,index:l.join(",")},function(e){let l=new Function("return "+e)();setTimeout(function(){$("#luckysheetloadingdata").fadeOut().remove()},500);for(let e in l){if(e==M.currentSheetIndex)continue;let n=t[se(e)];n.celldata=l[e.toString()],n.data=p.buildGridData(n)}re(t),i.fileClone=$.extend(!0,[],t),i.administerRuleDialog(),i.init()})}else i.fileClone=$.extend(!0,[],t),i.administerRuleDialog(),i.init()}}),$(document).off("click.CFhighlightCellRule").on("click.CFhighlightCellRule","#luckysheet-icon-highlightCellRule-menuButton .luckysheet-cols-menuitem",function(){l.hide(),$("#luckysheet-icon-highlightCellRule-menuButton").hide(),be();let e=$(this).attr("itemvalue");if(0!=M.luckysheet_select_save.length){let t,l,o=i.textCellColorHtml();switch(e){case"greaterThan":t=n.conditionformat_greaterThan,l=`<div class="box" data-itemvalue="greaterThan">\n                                                <div class="boxTitleOne">${n.conditionformat_greaterThan_title}：</div>\n                                                <div class="inpbox range">\n                                                    <input id="conditionVal" class="formulaInputFocus"/>\n                                                    <i class="fa fa-table" aria-hidden="true" title="${n.selectCell}"></i>\n                                                </div>\n                                                <div style="margin: 5px 0;">${n.setAs}：</div> \n                                                ${o} \n                                            </div>`;break;case"lessThan":t=n.conditionformat_lessThan,l=`<div class="box" data-itemvalue="lessThan">\n                                                <div class="boxTitleOne">${n.conditionformat_lessThan_title}：</div>\n                                                <div class="inpbox range">\n                                                    <input id="conditionVal" class="formulaInputFocus"/>\n                                                    <i class="fa fa-table" aria-hidden="true" title="${n.selectCell}"></i>\n                                                </div>\n                                                <div style="margin: 5px 0;">${n.setAs}：</div>\n                                                ${o}\n                                            </div>`;break;case"betweenness":t=n.conditionformat_betweenness,l=`<div class="box" data-itemvalue="betweenness">\n                                                <div class="boxTitleOne">${n.conditionformat_betweenness_title}：</div>\n                                                <div style="height: 30px;line-height: 30px;">\n                                                    <div class="inpbox2 range">\n                                                        <input id="conditionVal" class="formulaInputFocus"/>\n                                                        <i class="fa fa-table" aria-hidden="true" title="${n.selectCell}"></i>\n                                                    </div>\n                                                    <div style="float: left;height: 30px;line-height: 30px;margin: 0 5px;">${n.to}</div>\n                                                    <div class="inpbox2 range">\n                                                        <input id="conditionVal2" class="formulaInputFocus"/>\n                                                        <i class="fa fa-table" aria-hidden="true" title="${n.selectCell}"></i>\n                                                    </div>\n                                                </div>\n                                                <div style="margin: 5px 0;">${n.setAs}：</div>\n                                                ${o}\n                                            </div>`;break;case"equal":t=n.conditionformat_equal,l=`<div class="box" data-itemvalue="equal">\n                                                <div class="boxTitleOne">${n.conditionformat_equal_title}：</div>\n                                                <div class="inpbox range">\n                                                    <input id="conditionVal" class="formulaInputFocus"/>\n                                                    <i class="fa fa-table" aria-hidden="true" title="${n.selectCell}"></i>\n                                                </div>\n                                                <div style="margin: 5px 0;">${n.setAs}：</div>\n                                                ${o}\n                                            </div>`;break;case"textContains":t=n.conditionformat_textContains,l=`<div class="box" data-itemvalue="textContains">\n                                                <div class="boxTitleOne">${n.conditionformat_textContains_title}：</div>\n                                                <div class="inpbox range">\n                                                    <input id="conditionVal" class="formulaInputFocus"/>\n                                                    <i class="fa fa-table" aria-hidden="true" title="${n.selectCell}"></i>\n                                                </div>\n                                                <div style="margin: 5px 0;">${n.setAs}：</div>\n                                                ${o}\n                                            </div>`;break;case"occurrenceDate":t=n.conditionformat_occurrenceDate,l=`<div class="box" data-itemvalue="occurrenceDate">\n                                                <div class="boxTitleOne">${n.conditionformat_occurrenceDate_title}：</div>\n                                                <div class="inpbox">\n                                                    <input id="daterange-btn" class="formulaInputFocus" readonly="readonly" placeholder="${n.pleaseSelectADate}"/>\n                                                </div>\n                                                <div style="margin: 5px 0;">${n.setAs}：</div>\n                                                ${o}\n                                            </div>`;break;case"duplicateValue":t=n.conditionformat_duplicateValue,l=`<div class="box" data-itemvalue="duplicateValue">\n                                                <div class="boxTitleOne">${n.conditionformat_duplicateValue_title}：</div>\n                                                <select id="conditionVal" class="selectbox">\n                                                    <option value="0">${n.duplicateValue}</option>\n                                                    <option value="1">${n.uniqueValue}</option>\n                                                </select>\n                                                <div style="margin:5px 0;">${n.setAs}：</div>\n                                                ${o}\n                                            </div>`}i.conditionformatDialog(t,l)}else K()?alert(n.pleaseSelectRange):k.info(n.pleaseSelectRange,"")}),$(document).off("click.CFprojectSelectRule").on("click.CFprojectSelectRule","#luckysheet-icon-projectSelectRule-menuButton .luckysheet-cols-menuitem",function(){l.hide(),$("#luckysheet-icon-projectSelectRule-menuButton").hide(),be();let e=$(this).attr("itemvalue");if(0!=M.luckysheet_select_save.length){let t,l,o=i.textCellColorHtml();switch(e){case"top10":t=n.conditionformat_top10,l=`<div class="box" data-itemvalue="top10">\n                                                <div class="boxTitleOne">${n.conditionformat_top10_title}：</div>\n                                                <div style="height: 30px;line-height: 30px;">\n                                                    <div style="float: left;height: 30px;line-height: 30px;margin: 0 5px;">${n.top}</div>\n                                                    <div class="inpbox2">\n                                                        <input id="conditionVal" class="formulaInputFocus" type="number" value="10"/>\n                                                    </div>\n                                                    <div style="float: left;height: 30px;line-height: 30px;margin: 0 5px;">${n.oneself}</div>\n                                                </div>\n                                                <div style="margin: 5px 0;">${n.setAs}：</div>\n                                                ${o}\n                                            </div>`;break;case"top10%":t=n.conditionformat_top10_percent,l=`<div class="box" data-itemvalue="top10%">\n                                                <div class="boxTitleOne">${n.conditionformat_top10_title}：</div>\n                                                <div style="height: 30px;line-height: 30px;">\n                                                    <div style="float: left;height: 30px;line-height: 30px;margin: 0 5px;">${n.top}</div>\n                                                    <div class="inpbox2">\n                                                        <input id="conditionVal" class="formulaInputFocus" type="number" value="10"/>\n                                                    </div>\n                                                    <div style="float: left;height: 30px;line-height: 30px;margin: 0 5px;">%</div>\n                                                </div>\n                                                <div style="margin: 5px 0;">${n.setAs}：</div>\n                                                ${o}\n                                            </div>`;break;case"last10":t=n.conditionformat_last10,l=`<div class="box" data-itemvalue="last10">\n                                                <div class="boxTitleOne">${n.conditionformat_last10_title}：</div>\n                                                <div style="height: 30px;line-height: 30px;">\n                                                    <div style="float: left;height: 30px;line-height: 30px;margin: 0 5px;">${n.last}</div>\n                                                    <div class="inpbox2">\n                                                        <input id="conditionVal" class="formulaInputFocus" type="number" value="10"/>\n                                                    </div>\n                                                    <div style="float: left;height: 30px;line-height: 30px;margin: 0 5px;">${n.oneself}</div>\n                                                </div>\n                                                <div style="margin: 5px 0;">${n.setAs}：</div>\n                                                ${o}\n                                            </div>`;break;case"last10%":t=n.conditionformat_last10_percent,l=`<div class="box" data-itemvalue="last10%">\n                                                <div class="boxTitleOne">${n.conditionformat_last10_title}：</div>\n                                                <div style="height: 30px;line-height: 30px;">\n                                                    <div style="float: left;height: 30px;line-height: 30px;margin: 0 5px;">${n.last}</div>\n                                                    <div class="inpbox2">\n                                                        <input id="conditionVal" class="formulaInputFocus" type="number" value="10"/>\n                                                    </div>\n                                                    <div style="float: left;height: 30px;line-height: 30px;margin: 0 5px;">%</div>\n                                                </div>\n                                                <div style="margin:5px 0;">设置为：</div>\n                                                ${o}\n                                            </div>`;break;case"AboveAverage":t=n.conditionformat_AboveAverage,l=`<div class="box" data-itemvalue="AboveAverage">\n                                                <div class="boxTitleOne">${n.conditionformat_AboveAverage_title}：</div>\n                                                <div style="margin: 5px 0;">${n.setAsByArea}：</div>\n                                                ${o}\n                                            </div>`;break;case"SubAverage":t=n.conditionformat_SubAverage,l=`<div class="box" data-itemvalue="SubAverage">\n                                                <div class="boxTitleOne">${n.conditionformat_SubAverage_title}：</div>\n                                                <div style="margin: 5px 0;">${n.setAsByArea}：</div>\n                                                ${o}\n                                            </div>`}i.conditionformatDialog(t,l)}else K()?alert(n.pleaseSelectRange):k.info(n.pleaseSelectRange,"")}),$(document).off("click.CFdataBar").on("click.CFdataBar","#luckysheet-icon-dataBar-menuButton .luckysheet-cols-menuitem",function(){l.hide(),$("#luckysheet-icon-dataBar-menuButton").hide(),be();let e=$(this).attr("itemvalue");if(M.luckysheet_select_save.length>0){let t=$.extend(!0,[],M.luckysheet_select_save),l=i.dataBarList[e].format;i.updateItem("dataBar",t,l)}}),$(document).off("click.CFcolorGradation").on("click.CFcolorGradation","#luckysheet-icon-colorGradation-menuButton .luckysheet-cols-menuitem",function(){l.hide(),$("#luckysheet-icon-colorGradation-menuButton").hide(),be();let e=$(this).attr("itemvalue");if(M.luckysheet_select_save.length>0){let t=$.extend(!0,[],M.luckysheet_select_save),l=i.colorGradationList[e].format;i.updateItem("colorGradation",t,l)}}),$(document).off("click.CFdeleteRule").on("click.CFdeleteRule","#luckysheet-icon-deleteRule-menuButton .luckysheet-cols-menuitem",function(){l.hide(),$("#luckysheet-icon-deleteRule-menuButton").hide(),be(),"delSheet"==$(this).attr("itemvalue")&&i.updateItem("delSheet")})}let o=$(this).outerWidth(),c=l.outerWidth(),s=$(this).offset().left;c>o&&c+s>$("#"+M.container).width()&&(s=s-c+o),ge(l,s,$(this).offset().top+25,"lefttop")}),$("#luckysheet-icon-postil").click(function(){let t=$(this).attr("id")+"-menuButton",l=$("#"+t);const n=P().comment;l.remove(),y.removeActivePs();let o=M.luckysheet_select_save[M.luckysheet_select_save.length-1],i=o.row_focus;null==i&&(i=o.row[0]);let c,s=o.column_focus;null==s&&(s=o.column[0]),c=null!=M.flowdata[i][s]&&null!=M.flowdata[i][s].ps?[{text:n.edit,value:"editPs",example:""},{text:n.delete,value:"delPs",example:""},{text:"",value:"split",example:""},{text:n.showOne,value:"showHidePs",example:""},{text:n.showAll,value:"showHideAllPs",example:""}]:[{text:n.insert,value:"newPs",example:""},{text:"",value:"split",example:""},{text:n.showAll,value:"showHideAllPs",example:""}];let a=e.createButtonMenu(c),u=ye(e.menu,{id:"postil",item:a,subclass:"",sub:""});$("body").append(u),(l=$("#"+t).width(150)).find(".luckysheet-cols-menuitem").click(function(){l.hide(),be();let e=$(this).attr("itemvalue");"newPs"==e?y.newPs(i,s):"editPs"==e?y.editPs(i,s):"delPs"==e?y.delPs(i,s):"showHidePs"==e?y.showHidePs(i,s):"showHideAllPs"==e&&y.showHideAllPs()});let r=$(this).outerWidth(),d=l.outerWidth(),h=$(this).offset().left;d>r&&d+h>$("#"+M.container).width()&&(h=h-d+r),ge(l,h,$(this).offset().top+25,"lefttop")}),$("#luckysheet-icon-protection").click(function(){let e=p.getSheetByIndex();we(e)}),$("#luckysheet-icon-print").click(function(){let t=$(this).attr("id")+"-menuButton",l=$("#"+t);const n=P().print;if(0==l.length){let o=[{text:n.menuItemPrint,value:"print",example:'<i class="iconfont luckysheet-iconfont-dayin" aria-hidden="true"></i>'},{text:"",value:"split",example:""},{text:n.menuItemAreas,value:"areas",example:'<i class="iconfont luckysheet-iconfont-tihuan" aria-hidden="true"></i>'},{text:n.menuItemRows,value:"rows",example:'<i class="iconfont luckysheet-iconfont-zhuandao1" aria-hidden="true"></i>'},{text:n.menuItemColumns,value:"columns",example:'<i class="iconfont luckysheet-iconfont-dingwei" aria-hidden="true"></i>'}],i=e.createButtonMenu(o),c=ye(e.menu,{id:"print",item:i,subclass:"",sub:""});$("body").append(c),(l=$("#"+t).width(180)).find(".luckysheet-cols-menuitem").click(function(){l.hide(),be();let e=$(this).attr("itemvalue");"print"==e?alert("print"):"areas"!=e&&"rows"!=e&&"columns"!=e||alert("areas")})}let o=$(this).outerWidth(),i=l.outerWidth(),c=$(this).offset().left;i>o&&i+c>$("#"+M.container).width()&&(c=c-i+o),ge(l,c,$(this).offset().top+25,"lefttop")}),$("body").on("mouseover mouseleave",".luckysheet-menuButton .luckysheet-cols-submenu",function(t){let l=$(this),n=l.attr("itemvalue"),o=$("#luckysheet-icon-"+n+"-menuButton");if("mouseover"===t.type){let t=l.parent(),n=$(window).width(),i=$(window).height(),c=t.width(),s=o.height()+25,a=o.width()+5,u=l.offset(),r=u.top,d=u.left+c;d+a>n&&(d=u.left-a),r+s>i&&(r=i-s),o.css({top:r,left:d}).show(),e.rightclickmenu=l}else clearTimeout(e.submenuhide[o.attr("id")]),e.submenuhide[o.attr("id")]=setTimeout(function(){o.hide()},200)}).on("mouseover mouseleave",".luckysheet-menuButton-sub",function(t){"mouseover"===t.type?(e.rightclickmenu.addClass("luckysheet-cols-menuitem-hover"),clearTimeout(e.submenuhide[$(this).attr("id")])):(e.rightclickmenu.removeClass("luckysheet-cols-menuitem-hover"),$(this).hide())})},getQKBorder:function(e,t,l){let n="";e.indexOf("pt")>-1?(e=parseFloat(e))<1||(n=e<1.5?"Medium":"Thick"):(e=parseFloat(e))<2||(n=e<3?"Medium":"Thick");let o=0;return"double"==(t=t.toLowerCase())?o=2:"dotted"==t?o="Medium"==n||"Thick"==n?3:10:"dashed"==t?o="Medium"==n||"Thick"==n?4:9:"solid"==t&&(o="Medium"==n?8:"Thick"==n?13:1),[o,l]},updateFormatCell:function(e,t,l,n,o,i,c){if(null!=e&&null!=t)if("ct"==t){for(let t=n;t<=o;t++)if(null==M.config.rowhidden||null==M.config.rowhidden[t])for(let n=i;n<=c;n++){let o=e[t][n],i=null;i="object"==ve(o)?e[t][n].v:e[t][n],"@"!=l&&L(i)&&(i=parseFloat(i));let c=Q(l,i),s="n";Y(l)||14===l||15===l||16===l||17===l||18===l||19===l||20===l||21===l||22===l||45===l||46===l||47===l?s="d":"@"==l||49===l?s="s":"General"!=l&&0!==l||(s="g"),"object"==ve(o)?(e[t][n].m=c,null==e[t][n].ct&&(e[t][n].ct={}),e[t][n].ct.fa=l,e[t][n].ct.t=s):e[t][n]={ct:{fa:l,t:s},v:i,m:c}}}else{"ht"==t?"left"==l?l="1":"center"==l?l="0":"right"==l&&(l="2"):"vt"==t?"top"==l?l="1":"middle"==l?l="0":"bottom"==l&&(l="2"):"tb"==t?"overflow"==l?l="1":"clip"==l?l="0":"wrap"==l&&(l="2"):"tr"==t&&("none"==l?l="0":"angleup"==l?l="1":"angledown"==l?l="2":"vertical"==l?l="3":"rotation-up"==l?l="4":"rotation-down"==l&&(l="5"));for(let s=n;s<=o;s++)if(null==M.config.rowhidden||null==M.config.rowhidden[s])for(let n=i;n<=c;n++){let o=e[s][n];"object"==ve(o)?(pe(o,t,l),e[s][n][t]=l):(e[s][n]={v:o},e[s][n][t]=l)}}},updateFormat:function(e,t,l){if(!$e(M.currentSheetIndex))return;if(!1===M.allowEdit)return;document.createElement("canvas").getContext("2d");if(t in me&&parseInt($("#luckysheet-input-box").css("top"))>0){if("="!=$("#luckysheet-input-box").text().substr(0,1)){let n=e[M.luckysheetCellUpdate[0]][M.luckysheetCellUpdate[1]];he(n,t,l,b.rangeResizeTo)}}let n=$.extend(!0,{},M.config);null==n.rowlen&&(n.rowlen={});for(let o=0;o<M.luckysheet_select_save.length;o++){let i=M.luckysheet_select_save[o].row[0],c=M.luckysheet_select_save[o].row[1],s=M.luckysheet_select_save[o].column[0],a=M.luckysheet_select_save[o].column[1];this.updateFormatCell(e,t,l,i,c,s,a),"tb"!=t&&"tr"!=t&&"fs"!=t||(n=le(e,i,c,n))}let o={};"tb"!=t&&"tr"!=t&&"fs"!=t||(o={cfg:n,RowlChange:!0}),M.refreshRange(e,M.luckysheet_select_save,o,!1)},updateFormat_mc:function(e,t){let l=$.extend(!0,{},M.config);if(null==l.merge&&(l.merge={}),_e(M.currentSheetIndex)){if("mergeCancel"==t)for(let t=0;t<M.luckysheet_select_save.length;t++){let n=M.luckysheet_select_save[t],o=n.row[0],i=n.row[1],c=n.column[0],s=n.column[1];if(o==i&&c==s)continue;let a={};for(let t=o;t<=i;t++)for(let n=c;n<=s;n++){let o=e[t][n];if(null!=o&&null!=o.mc){let i=o.mc.r,c=o.mc.c;if("rs"in o.mc)delete o.mc,delete l.merge[i+"_"+c],a[i+"_"+c]=$.extend(!0,{},o);else{let l=JSON.parse(JSON.stringify(a[i+"_"+c]));delete l.v,delete l.m,delete l.ct,delete l.f,delete l.spl,e[t][n]=l}}}}else{let n=!1;for(let t=0;t<M.luckysheet_select_save.length;t++){let l=M.luckysheet_select_save[t],o=l.row[0],i=l.row[1],c=l.column[0],s=l.column[1];for(let t=o;t<=i;t++)for(let l=c;l<=s;l++){let o=e[t][l];if("object"==ve(o)&&"mc"in o){n=!0;break}}}if(n)for(let t=0;t<M.luckysheet_select_save.length;t++){let n=M.luckysheet_select_save[t],o=n.row[0],i=n.row[1],c=n.column[0],s=n.column[1];if(o==i&&c==s)continue;let a={};for(let t=o;t<=i;t++)for(let n=c;n<=s;n++){let o=e[t][n];if(null!=o&&null!=o.mc){let i=o.mc.r,c=o.mc.c;if("rs"in o.mc)delete o.mc,delete l.merge[i+"_"+c],a[i+"_"+c]=$.extend(!0,{},o);else{let l=JSON.parse(JSON.stringify(a[i+"_"+c]));delete l.v,delete l.m,delete l.ct,delete l.f,delete l.spl,e[t][n]=l}}}}else for(let n=0;n<M.luckysheet_select_save.length;n++){let o=M.luckysheet_select_save[n],i=o.row[0],c=o.row[1],s=o.column[0],a=o.column[1];if(i!=c||s!=a)if("mergeAll"==t){let t={},n=!1;for(let l=i;l<=c;l++)for(let o=s;o<=a;o++){let c=e[l][o];null==c||U(c.v)&&null==c.f||n||(t=$.extend(!0,{},c),n=!0),e[l][o]={mc:{r:i,c:s}}}e[i][s]=t,e[i][s].mc={r:i,c:s,rs:c-i+1,cs:a-s+1},l.merge[i+"_"+s]={r:i,c:s,rs:c-i+1,cs:a-s+1}}else if("mergeV"==t)for(let t=s;t<=a;t++){let n={},o=!1;for(let l=i;l<=c;l++){let c=e[l][t];null==c||U(c.v)&&null==c.f||o||(n=$.extend(!0,{},c),o=!0),e[l][t]={mc:{r:i,c:t}}}e[i][t]=n,e[i][t].mc={r:i,c:t,rs:c-i+1,cs:1},l.merge[i+"_"+t]={r:i,c:t,rs:c-i+1,cs:1}}else if("mergeH"==t)for(let t=i;t<=c;t++){let n={},o=!1;for(let l=s;l<=a;l++){let i=e[t][l];null==i||U(i.v)&&null==i.f||o||(n=$.extend(!0,{},i),o=!0),e[t][l]={mc:{r:t,c:s}}}e[t][s]=n,e[t][s].mc={r:t,c:s,rs:1,cs:a-s+1},l.merge[t+"_"+s]={r:t,c:s,rs:1,cs:a-s+1}}}}M.clearjfundo&&(M.jfundo.length=0,M.jfredo.push({type:"mergeChange",sheetIndex:M.currentSheetIndex,data:M.flowdata,curData:e,range:$.extend(!0,[],M.luckysheet_select_save),config:$.extend(!0,{},M.config),curConfig:l})),M.clearjfundo=!1,M.refreshRange(e,M.luckysheet_select_save,{cfg:l}),M.clearjfundo=!0}},changeMenuButtonDom:function(e,t,l){let n=this;null==l&&(l=P());const o=l.fontarray;l.fontjson;if("bl"==e)"0"!=t?$("#luckysheet-icon-bold").addClass("luckysheet-toolbar-button-hover"):$("#luckysheet-icon-bold").removeClass("luckysheet-toolbar-button-hover");else if("it"==e)"0"!=t?$("#luckysheet-icon-italic").addClass("luckysheet-toolbar-button-hover"):$("#luckysheet-icon-italic").removeClass("luckysheet-toolbar-button-hover");else if("cl"==e)"0"!=t?$("#luckysheet-icon-strikethrough").addClass("luckysheet-toolbar-button-hover"):$("#luckysheet-icon-strikethrough").removeClass("luckysheet-toolbar-button-hover");else if("un"==e)"0"!=t?$("#luckysheet-icon-underline").addClass("luckysheet-toolbar-button-hover"):$("#luckysheet-icon-underline").removeClass("luckysheet-toolbar-button-hover");else if("ff"==e){let e=$("#"+"luckysheet-icon-font-family-menuButton"),l=o[0],i=0;null!=t&&(te(t).num?null==(l=o[i=parseInt(t)])&&(l=i=n.defualtFont[i],null!=i&&n.addFontTolist(i)):(i=t=t.replace(/"/g,"").replace(/'/g,""),l=t,n.addFontTolist(i))),n.focus(e,i),$("#luckysheet-icon-font-family").find(".luckysheet-toolbar-menu-button-caption").html(" "+l+" ")}else if("fs"==e){let e=$("#luckysheet-icon-font-size-menuButton"),l=t,o=$("#luckysheet-icon-font-size input");n.focus(e,l),$("#luckysheet-icon-font-size").attr("itemvalue",l),o.val(l)}else if("ht"==e){let e=$("#luckysheet-icon-align-menu-menuButton"),l=($("luckysheet-icon-align"),"left");"0"==t?l="center":"2"==t&&(l="right"),n.focus(e,l);const o=E.align;$("#luckysheet-icon-align").attr("type",l).find(".luckysheet-icon-img-container").removeAttr("class").addClass("luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-align-"+l+o[l]),e.hide()}else if("vt"==e){let e=$("#luckysheet-icon-valign-menu-menuButton"),l=($("luckysheet-icon-valign"),"bottom");"1"==t?l="top":"0"==t&&(l="middle"),n.focus(e,l);const o=E.align;$("#luckysheet-icon-valign").attr("type",l).find(".luckysheet-icon-img-container").removeAttr("class").addClass("luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-valign-"+l+o[l]),e.hide()}else if("tb"==e){let e=$("#luckysheet-icon-textwrap-menu-menuButton"),l=($("luckysheet-icon-textwrap"),"clip");"1"==t?l="overflow":"2"==t&&(l="wrap"),n.focus(e,l);const o=E.textWrap;$("#luckysheet-icon-textwrap").attr("type",l).find(".luckysheet-icon-img-container").removeAttr("class").addClass("luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-textwrap-"+l+o[l]),e.hide()}else if("tr"==e){let e=$("#luckysheet-icon-rotation-menu-menuButton"),l=($("luckysheet-icon-rotation"),"none");"1"==t?l="angleup":"2"==t?l="angledown":"3"==t?l="vertical":"4"==t?l="rotation-up":"5"==t&&(l="rotation-down"),n.focus(e,l);const o=E.rotation;$("#luckysheet-icon-rotation").attr("type",l).find(".luckysheet-icon-img-container").removeAttr("class").addClass("luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-rotation-"+l+o[l]),e.hide()}else if("ct"==e){let e=$("#luckysheet-icon-fmt-other");const l=P().defaultFmt;if(!t)return void e.find(".luckysheet-toolbar-menu-button-caption").html(" "+l[0].text+" ");const{fa:n}=t,o=l.find(e=>e.value===n);if(o)e.find(".luckysheet-toolbar-menu-button-caption").html(" "+o.text+" ");else{const t=l.find(e=>"fmtOtherSelf"===e.value);e.find(".luckysheet-toolbar-menu-button-caption").html(" "+t.text+" ")}}},inputMenuButtonFocus:function(e){let t=window.getSelection().getRangeAt(0).startContainer;M.inlineStringEditRange=null;const l=P();if("SPAN"==t.parentNode.tagName){let e=t.parentNode.style.cssText,n=fe(e);for(let e in n)this.changeMenuButtonDom(e,n[e],l)}},menuButtonFocus:function(e,t,l){let n=this,o=["bl","it","cl","ff","ht","vt","fs","tb","tr","ct","un"];const i=P();for(let c=0;c<o.length;c++){let s=o[c],a=n.checkstatus(e,t,l,s);this.changeMenuButtonDom(s,a,i)}},checkstatus:function(e,t,l,n){return z.checkstatus(e,t,l,n)},setLineDash:function(e,t,l,n,o,i,c){return N.setLineDash(e,t,l,n,o,i,c)},moveMergeData:function(e,t,l){if(U(e))return e;let n=[],o=[],i=!1;for(let c=0;c<e.length;c++)for(let s=0;s<e[0].length;s++){let a=e[c][s];"object"==ve(a)&&"mc"in a&&(null!=a.mc.rs&&(n.push({rs:a.mc.rs,cs:a.mc.cs,r:a.mc.r,c:a.mc.c}),o.push({rs:a.mc.rs,cs:a.mc.cs,r:a.mc.r+t,c:a.mc.c+l}),i=!0),e[c][s].mc.r+=t,e[c][s].mc.c+=l)}return{deleMC:n,insertMC:o,hasMC:i}},getRangeInMerge:function(e,t,l,n,o){let i=this,c=[],s=null;if(null!=(s=null!=o?$.extend(!0,{},i.getSheetConfig()):$.extend(!0,{},M.config))&&null!=s.merge)for(let o in s.merge){let i=s.merge[o];e+t-1<i.r||e>i.r+i.rs-1||l+n-1<i.c||l>i.c+i.cs-1||c.push(i)}return c},mergeborer:function(e,t,l){return z.mergeborer(e,t,l)},mergeMoveMain:function(e,t,l,n,o,i,c){return z.mergeMoveMain(e,t,l,n,o,i,c)},mergeMove:function(e,t,l,n,o,i,c,s){return z.mergeMove(e,t,l,n,o,i,c,s)},getCellRealSize:function(e,t,l){return z.getCellRealSize(e,t,l)},getTextSize:function(e,t){return z.getTextSize(e,t)},activeFormulaInput:function(e,t,l,n,o,i){if(null==i&&(i=!1),G(e,t,M.flowdata,!0),i){let e='<span dir="auto" class="luckysheet-formula-text-color">=</span><span dir="auto" class="luckysheet-formula-text-color">'+o.toUpperCase()+'</span><span dir="auto" class="luckysheet-formula-text-color">(</span><span dir="auto" class="luckysheet-formula-text-color">)</span>';$("#luckysheet-rich-text-editor").html(e);window.getSelection();let t=$("#luckysheet-rich-text-editor").find("span");return void b.setCaretPosition(t.get(t.length-2),0,1)}let c=Z(l[0])[0],s=Z(l[1])[1],a=ee(n[0])[0],u=ee(n[1])[1],r='<span dir="auto" class="luckysheet-formula-text-color">=</span><span dir="auto" class="luckysheet-formula-text-color">'+o.toUpperCase()+'</span><span dir="auto" class="luckysheet-formula-text-color">(</span><span class="luckysheet-formula-functionrange-cell" rangeindex="0" dir="auto" style="color:'+W[0]+';">'+ae(M.currentSheetIndex,{row:l,column:n},M.currentSheetIndex)+'</span><span dir="auto" class="luckysheet-formula-text-color">)</span>';$("#luckysheet-rich-text-editor").html(r),b.israngeseleciton(),b.rangestart=!0,b.rangedrag_column_start=!1,b.rangedrag_row_start=!1,b.rangechangeindex=0,b.rangeSetValue({row:l,column:n}),b.func_selectedrange={left:a,width:u-a-1,top:c,height:s-c-1,left_move:a,width_move:u-a-1,top_move:c,height_move:s-c-1,row:[e,e],column:[t,t]},$("#luckysheet-formula-functionrange-select").css({left:a,width:u-a-1,top:c,height:s-c-1}).show(),$("#luckysheet-formula-help-c").hide()},backFormulaInput:function(e,t,l,n,o,i){let c="="+i.toUpperCase()+"("+ae(M.currentSheetIndex,{row:n,column:o},M.currentSheetIndex)+")",s=b.execfunction(c,t,l),a={v:s[1],f:s[2]};oe(t,l,e,a),b.execFunctionExist.push({r:t,c:l,i:M.currentSheetIndex}),M.historyParam(e,M.currentSheetIndex,{row:[t,t],column:[l,l]})},checkNoNullValue:function(e){let t=e;return"object"==ve(t)&&(t=t.v),!(U(t)||!te(t).num||null!=e.ct&&null!=e.ct.t&&"n"!=e.ct.t&&"g"!=e.ct.t)},checkNoNullValueAll:function(e){let t=e;return"object"==ve(t)&&(t=t.v),!U(t)},getNoNullValue:function(e,t,l,n){let o=this,i=null,c=0,s=0;for(let a=l-1;a>=0;a--){let l;if(l="c"==n?e[t][a]:e[a][t],o.checkNoNullValue(l))0,i=a;else{if(null!=l&&null!=l.v&&""!=l.v)break;if(++c>=40){if(!(s<=0))break;s=1}}}return i},singleFormulaInput:function(e,t,l,n,o,i,c,s,a){let u=this;null==c&&(c="r"),null==s&&(s=!0),null==a&&(a=!0);let r=!0,d=!1;for(let t=n;t<=o;t++){let n=null;n="c"==c?e[t][l]:e[l][t],u.checkNoNullValue(n)?(r=!1,d=!0):u.checkNoNullValueAll(n)&&(r=!1)}if(r&&a){if(null==u.getNoNullValue(e,t,l,c))"c"==c?u.activeFormulaInput(t,l,null,null,i,!0):u.activeFormulaInput(l,t,null,null,i,!0);else if(t==n)for(let t=n;t<=o;t++){let n=u.getNoNullValue(e,t,l,c);if(null==n)break;"c"==c?u.backFormulaInput(e,t,l,[t,t],[n,l-1],i):u.backFormulaInput(e,l,t,[n,l-1],[t,t],i)}else for(let t=o;t>=n;t--){let n=u.getNoNullValue(e,t,l,c);if(null==n)break;"c"==c?u.backFormulaInput(e,t,l,[t,t],[n,l-1],i):u.backFormulaInput(e,l,t,[n,l-1],[t,t],i)}}else{if(!d||!s)return!0;{let t=null;if(null!=(t="c"==c?e[o][l]:e[l][o])&&null!=t.v&&t.v.toString().length>0){let s=o;for(t="c"==c?e[o][l]:e[l][o];null!=t&&null!=t.v&&t.v.toString().length>0;){let n=null;if(++s>=(n="c"==c?e.length:e[0].length))return;t="c"==c?e[s][l]:e[l][s]}"c"==c?u.backFormulaInput(e,s,l,[n,o],[l,l],i):u.backFormulaInput(e,l,s,[l,l],[n,o],i)}else"c"==c?u.backFormulaInput(e,o,l,[n,o],[l,l],i):u.backFormulaInput(e,l,o,[l,l],[n,o],i)}}},autoSelectionFormula:function(e){let t=this,l=M.deepCopyFlowData(M.flowdata),n=!0;b.execFunctionExist=[];let o=function(e,l,n,o,i,c){let s=t.getNoNullValue(e,l,i,"c");null==s?t.activeFormulaInput(l,o,null,null,c,!0):t.activeFormulaInput(l,o,[l,n],[s,i-1],c)},i=function(e,l,n,i,c,s){let a=t.getNoNullValue(e,i,n,"r");null==a?o(e,l,n,i,c,s):t.activeFormulaInput(l,i,[a,n-1],[i,c],s)};for(let c=0;c<M.luckysheet_select_save.length;c++){let s=M.luckysheet_select_save[c].row[0],a=M.luckysheet_select_save[c].row[1],u=M.luckysheet_select_save[c].column[0],r=M.luckysheet_select_save[c].column[1],d=M.luckysheet_select_save[c].row_focus,h=M.luckysheet_select_save[c].column_focus;if(s==a&&u==r){if(a-1<0&&r-1<0)return void t.activeFormulaInput(s,u,null,null,e,!0);a-1>=0&&t.checkNoNullValue(l[a-1][u])?i(l,s,a,u,r,e):r-1>=0&&t.checkNoNullValue(l[s][r-1])?o(l,s,a,u,r,e):i(l,s,a,u,r,e)}else if(s==a)n=t.singleFormulaInput(l,h,s,u,r,e,"r");else if(u==r)n=t.singleFormulaInput(l,d,u,s,a,e,"c");else{let o=!0;for(let n=s;n<=a;n++)o=t.singleFormulaInput(l,h,n,u,r,e,"r",!0,!1)&&o;let i=!0;for(let n=u;n<=r;n++)i=t.singleFormulaInput(l,d,n,s,a,e,"c",!0,!1)&&i;n=!!o&&!!i}n=n&&n}n||(b.execFunctionExist.reverse(),b.execFunctionGroup(null,null,null,null,l),M.refreshRange(l,M.luckysheet_select_save),clearTimeout(M.jfcountfuncTimeout),M.jfcountfuncTimeout=setTimeout(function(){ie()},500))},getStyleByCell:function(e,t,l){return m_cells.getStyleByCell(e,t,l)},fontSelectList:[],defualtFont:["Times New Roman","Arial","Tahoma","Verdana","微软雅黑","宋体","黑体","楷体","仿宋","新宋体","华文新魏","华文行楷","华文隶书"],addFontTolist:function(e){e=e.replace(/"/g,"").replace(/'/g,"");let t=!0;for(let l=0;l<this.fontSelectList.length;l++){if(this.fontSelectList[l].value==e){t=!1;break}}if(e in P().fontjson&&(t=!1),t){let t={};t.value=e,t.index=this.fontSelectList.length,t.type="userDefined",t.text="<span class='luckysheet-mousedown-cancel' style='font-size:11px;font-family:"+e+"'>"+e+"</span>",t.example="",this.fontSelectList.push(t);let l=$("#luckysheet-icon-font-family-menuButton"),n=this.createButtonMenu(this.fontSelectList);l.html(n)}},fontInitial:function(e){let t=[];const l=P().fontarray;for(let e=0;e<l.length;e++){let n=l[e],o={};o.value=n,o.index=e,o.type="inner",o.text="<span class='luckysheet-mousedown-cancel' style='font-size:11px;font-family:"+n+"'>"+n+"</span>",o.example="",t.push(o)}if(null!=e){for(let l=0;l<e.length;l++){let n=e[l],o={};if(o.value=n.fontName,o.index=l,o.type="userDefined",o.text="<span class='luckysheet-mousedown-cancel' style='font-size:11px;font-family:"+n.fontName+"'>"+n.fontName+"</span>",o.example="",t.push(o),document.fonts&&!document.fonts.check("12px "+n.fontName)&&n.url){const e=new FontFace(n.fontName,`url(${n.url})`);document.fonts.add(e),e.load()}}document.fonts&&document.fonts.ready.then(function(){})}this.fontSelectList=t}}});
//# sourceMappingURL=../sourcemaps/controllers/menuButton.js.map
