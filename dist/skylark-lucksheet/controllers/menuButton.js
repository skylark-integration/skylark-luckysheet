/**
 * skylark-lucksheet - A version of lucksheet.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["./select","./constant","./luckysheetConfigsetting","./moreFormat","./alternateformat","./conditionformat","./server","./sheetSearch","./freezen","./resize","./filter","./searchReplace","./locationCell","./ifFormulaGenerator","./updateCell","./insertFormula","./sheetmanage","./postil","../global/validate","../global/tooltip","../global/editor","../global/format","../global/refresh","../global/sort","../global/formula","../global/location","../global/datecontroll","../global/getRowlen","../global/setdata","../global/getdata","../global/count","../global/cursorPos","../methods/get","../methods/set","./inlineString","../utils/util","./protection","../store","../locale/locale"],function(e,t,l,n,o,i,c,s,a,u,r,d,h,f,m,p,y,v,k,g,x,b,w,_,C,F,S,B,A,I,D,T,z,R,M,P,N,O,V){"use strict";const{selectionCopyShow:W,selectIsOverlap:H}=e,{luckyColor:E,iconfontObjects:j}=t,{luckysheet_searcharray:G}=s,{createFilter:L}=r,{luckysheetupdateCell:U}=m,{isRealNum:q,isRealNull:K,isEditMode:J,hasPartMC:Q}=k,{genarate:Y,update:X,is_date:Z}=b,{jfrefreshgrid:ee,luckysheetrefreshgrid:te}=w,{sortSelection:le}=_,{rowLocationByIndex:ne,colLocationByIndex:oe}=F,{isdatatypemulti:ie}=S,{rowlenByRange:ce,getCellTextSplitArr:se}=B,{setcellvalue:ae}=A,{getFontStyleByCell:ue,checkstatusByCell:re}=I,{countfunc:de}=D,{hideMenuByCancel:he}=T,{getSheetIndex:fe,getRangetxt:me,getluckysheetfile:pe}=z,{setluckysheetfile:ye}=R,{isInlineStringCell:ve,updateInlineStringFormat:ke,convertCssToStyleList:ge,inlineStyleAffectAttribute:xe,updateInlineStringFormatOutside:be}=M,{replaceHtml:we,getObjType:$e,rgbTohex:_e,mouseclickposition:Ce,luckysheetfontformat:Fe,luckysheetContainerFocus:Se}=P,{openProtectionModal:Be,checkProtectionFormatCells:Ae,checkProtectionNotEnable:Ie}=N;return{menu:'<div class="luckysheet-cols-menu luckysheet-rightgclick-menu luckysheet-menuButton ${subclass} luckysheet-mousedown-cancel" id="luckysheet-icon-${id}-menuButton">${item}</div>',item:'<div itemvalue="${value}" itemname="${name}" class="luckysheet-cols-menuitem ${sub} luckysheet-mousedown-cancel"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel" style="padding: 3px 0px 3px 1px;"><span style="margin-right:3px;width:13px;display:inline-block;" class="icon luckysheet-mousedown-cancel"></span> ${name} <span class="luckysheet-submenu-arrow luckysheet-mousedown-cancel ${iconClass}" style="user-select: none;">${example}</span></div></div>',split:'<div class="luckysheet-menuseparator luckysheet-mousedown-cancel" role="separator"></div>',color:'<div class="luckysheet-cols-menu luckysheet-rightgclick-menu luckysheet-rightgclick-menu-sub luckysheet-mousedown-cancel luckysheet-menuButton ${sub}" id="${id}"><div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel luckysheet-color-reset"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">${resetColor}</div></div> <div class="luckysheet-mousedown-cancel"> <div class="luckysheet-mousedown-cancel"> <input type="text" class="luckysheet-color-selected" /> </div> </div> <div class="luckysheet-menuseparator luckysheet-mousedown-cancel" role="separator"></div> ${coloritem}</div>',coloritem:'<div class="luckysheet-cols-menuitem luckysheet-mousedown-cancel ${class}"><div class="luckysheet-cols-menuitem-content luckysheet-mousedown-cancel">${name}</div></div>',subcolor:'<div id="luckysheet-icon-${id}-menuButton" class="luckysheet-cols-menu luckysheet-rightgclick-menu luckysheet-rightgclick-menu-sub luckysheet-menuButton-sub luckysheet-mousedown-cancel"> <div class="luckysheet-mousedown-cancel"> <div class="luckysheet-mousedown-cancel"> <input type="text" class="luckysheet-color-selected" /> </div> </div></div>',rightclickmenu:null,submenuhide:{},focus:function(e,t){if("luckysheet-icon-font-family-menuButton"==e.attr("id")&&ie(t).num){null==(t=V().fontarray[parseInt(t)])&&(t=this.defualtFont[itemvalue])}e.find(".luckysheet-cols-menuitem").find("span.icon").html(""),null==t?e.find(".luckysheet-cols-menuitem").eq(0).find("span.icon").html('<i class="fa fa-check luckysheet-mousedown-cancel"></i>'):e.find(".luckysheet-cols-menuitem[itemvalue='"+t+"']").find("span.icon").html('<i class="fa fa-check luckysheet-mousedown-cancel"></i>')},createButtonMenu:function(e){let t="",l=this;for(let n=0;n<e.length;n++){let o=e[n];"split"==o.value?t+=l.split:"more"==o.example?t+=we(l.item,{value:o.value,name:o.text,example:"",sub:"luckysheet-cols-submenu",iconClass:"iconfont luckysheet-iconfont-youjiantou"}):t+=we(l.item,{value:o.value,name:o.text,example:o.example,sub:"",iconClass:""})}return t},cancelPaintModel:function(){$("#luckysheet-sheettable_0").removeClass("luckysheetPaintCursor"),O.luckysheet_copy_save.dataSheetIndex==O.currentSheetIndex?(O.luckysheet_selection_range=[],W()):O.luckysheetfile[fe(O.luckysheet_copy_save.dataSheetIndex)].luckysheet_selection_range=[],O.luckysheet_copy_save={},this.luckysheetPaintModelOn=!1,$("#luckysheetpopover").fadeOut(200,function(){$("#luckysheetpopover").remove()})},luckysheetPaintModelOn:!1,luckysheetPaintSingle:!1,initialMenuButton:function(){let e=this;$("#luckysheet-icon-paintformat").click(function(){let t=V().paint;if(null==O.luckysheet_select_save||0==O.luckysheet_select_save.length)return void(J()?alert(t.tipSelectRange):g.info("",t.tipSelectRange));if(O.luckysheet_select_save.length>1)return void(J()?alert(t.tipNotMulti):g.info("",t.tipNotMulti));g.popover("<i class='fa fa-paint-brush'></i> "+t.start,"topCenter",!0,null,t.end,function(){e.cancelPaintModel()}),$("#luckysheet-sheettable_0").addClass("luckysheetPaintCursor"),O.luckysheet_selection_range=[{row:O.luckysheet_select_save[0].row,column:O.luckysheet_select_save[0].column}],W();let l=!1,n=!1;for(let e=O.luckysheet_select_save[0].row[0];e<=O.luckysheet_select_save[0].row[1];e++)if(null==O.config.rowhidden||null==O.config.rowhidden[e]){null!=O.config.rowlen&&e in O.config.rowlen&&(l=!0);for(let t=O.luckysheet_select_save[0].column[0];t<=O.luckysheet_select_save[0].column[1];t++){let l=O.flowdata[e][t];"object"==$e(l)&&"mc"in l&&null!=l.mc.rs&&(n=!0)}}O.luckysheet_copy_save={dataSheetIndex:O.currentSheetIndex,copyRange:[{row:O.luckysheet_select_save[0].row,column:O.luckysheet_select_save[0].column}],RowlChange:l,HasMC:n},e.luckysheetPaintModelOn=!0,e.luckysheetPaintSingle=!0}),$("#luckysheet-icon-paintformat").dblclick(function(){let t=V().paint;if(null==O.luckysheet_select_save||0==O.luckysheet_select_save.length)return void(J()?alert(t.tipSelectRange):g.info("",t.tipSelectRange));if(O.luckysheet_select_save.length>1)return void(J()?alert(t.tipNotMulti):g.info("",t.tipNotMulti));g.popover("<i class='fa fa-paint-brush'></i> "+t.start,"topCenter",!0,null,t.end,function(){e.cancelPaintModel()}),$("#luckysheet-sheettable_0").addClass("luckysheetPaintCursor"),O.luckysheet_selection_range=[{row:O.luckysheet_select_save[0].row,column:O.luckysheet_select_save[0].column}],W();let l=!1,n=!1;for(let e=O.luckysheet_select_save[0].row[0];e<=O.luckysheet_select_save[0].row[1];e++)if(null==O.config.rowhidden||null==O.config.rowhidden[e]){null!=O.config.rowlen&&e in O.config.rowlen&&(l=!0);for(let t=O.luckysheet_select_save[0].column[0];t<=O.luckysheet_select_save[0].column[1];t++){let l=O.flowdata[e][t];"object"==$e(l)&&"mc"in l&&null!=l.mc.rs&&(n=!0)}}O.luckysheet_copy_save={dataSheetIndex:O.currentSheetIndex,copyRange:[{row:O.luckysheet_select_save[0].row,column:O.luckysheet_select_save[0].column}],RowlChange:l,HasMC:n},e.luckysheetPaintModelOn=!0,e.luckysheetPaintSingle=!1}),$("#luckysheet-icon-currency").click(function(){let t=x.deepCopyFlowData(O.flowdata);e.updateFormat(t,"ct","Â¥ #.00")}),$("#luckysheet-icon-percent").click(function(){let t=x.deepCopyFlowData(O.flowdata);e.updateFormat(t,"ct","0.00%")}),$("#luckysheet-icon-fmt-decimal-decrease").click(function(){let t=x.deepCopyFlowData(O.flowdata),l=O.luckysheet_select_save[0].row_focus,n=O.luckysheet_select_save[0].column_focus,o=e.checkstatus(t,l,n,"ct"),i=t[l][n];if(null==o||"n"!=o.t)return;if("General"==o.fa){o=Y(i.v)[1]}if(/^(w|W)((0?)|(0\.0+))$/.test(o.fa))return void(o.fa.indexOf(".")>-1?".0"==o.fa.substr(-2)?e.updateFormat(t,"ct",o.fa.split(".")[0]):e.updateFormat(t,"ct",o.fa.substr(0,o.fa.length-1)):e.updateFormat(t,"ct",o.fa));let c="",s="";if(!(o.fa.indexOf(".")>-1))return;c=(a=o.fa.split("."))[0];let a=(s=a[1]).split(""),u="";for(let e=a.length-1;e>=0;e--){let t=a[e];if("#"==t||"0"==t||","==t||!isNaN(parseInt(t)))break;u=t+u}let r="";if(o.fa.indexOf(".")>-1){let e=s;u.length>0&&(e=s.replace(u,""));let t=e.replace(/#/g,"0");r=""==(t=t.substr(0,t.length-1))?c+u:c+"."+t+u}e.updateFormat(t,"ct",r)}),$("#luckysheet-icon-fmt-decimal-increase").click(function(){let t=x.deepCopyFlowData(O.flowdata),l=O.luckysheet_select_save[0].row_focus,n=O.luckysheet_select_save[0].column_focus,o=e.checkstatus(t,l,n,"ct"),i=t[l][n];if(null==o||"n"!=o.t)return;if("General"==o.fa){o=Y(i.v)[1]}if("General"==o.fa)return void e.updateFormat(t,"ct","#.0");if(/^(w|W)((0?)|(0\.0+))$/.test(o.fa))return void(o.fa.indexOf(".")>-1?e.updateFormat(t,"ct",o.fa+"0"):"0"==o.fa.substr(-1)?e.updateFormat(t,"ct",o.fa+".0"):e.updateFormat(t,"ct",o.fa+"0.0"));let c="",s="";o.fa.indexOf(".")>-1?(c=(a=o.fa.split("."))[0],s=a[1]):s=o.fa;let a=s.split(""),u="";for(let e=a.length-1;e>=0;e--){let t=a[e];if("#"==t||"0"==t||","==t||!isNaN(parseInt(t)))break;u=t+u}let r="";if(o.fa.indexOf(".")>-1){let e=s;u.length>0&&(e=s.replace(u,""));let t=e.replace(/#/g,"0");r=c+"."+(t+="0")+u}else r=u.length>0?s.replace(u,"")+".0"+u:s+".0"+u;e.updateFormat(t,"ct",r)}),$("#luckysheet-icon-fmt-other").click(function(){const t=V(),l=t.format,o=t.defaultFmt;let i=$(this).attr("id")+"-menuButton",c=$("#"+i);if(0==c.length){let t=o,s=e.createButtonMenu(t),a=we(e.menu,{id:"fmt-other",item:s,subclass:"",sub:""}),u=[{text:l.moreCurrency+"...",value:"morecurrency",example:""},{text:l.moreDateTime+"...",value:"moredatetime",example:""},{text:l.moreNumber+"...",value:"moredigit",example:""}],r=e.createButtonMenu(u),d=we(e.menu,{id:"fmtOtherSelf",item:r,subclass:"luckysheet-menuButton-sub"});$("body").append(a+d),c=$("#"+i).width(250),e.focus(c),c.find(".luckysheet-cols-menuitem").click(function(){c.hide(),Se();let t=$(this),l=t.attr("itemvalue"),n=t.attr("itemname");if($("#luckysheet-icon-fmt-other").find(".luckysheet-toolbar-menu-button-caption").html(" "+n+" "),"fmtOtherSelf"==l)return;let o=x.deepCopyFlowData(O.flowdata);e.focus(c,l),e.updateFormat(o,"ct",l)}),$("#luckysheet-icon-fmtOtherSelf-menuButton").find(".luckysheet-cols-menuitem").click(function(){c.hide(),$("#luckysheet-icon-fmtOtherSelf-menuButton").hide(),Se();let e=$(this).attr("itemvalue");n.createDialog(e),n.init()})}else{const t=$(this).find(".luckysheet-toolbar-menu-button-caption").text().trim(),l=o.find(e=>e.text===t);l&&e.focus(c,l.value)}let s=$(this).outerWidth(),a=c.outerWidth(),u=$(this).offset().left;a>s&&a+u>$("#"+O.container).width()&&(u=u-a+s),Ce(c,u,$(this).offset().top+25,"lefttop")}),$("#luckysheet-icon-font-family").mousedown(function(e){he(e),e.stopPropagation()}).click(function(){let t=$(this).attr("id")+"-menuButton",l=$("#"+t);if(0==l.length){let n=e.createButtonMenu(e.fontSelectList),o=we(e.menu,{id:"font-family",item:n,subclass:"",sub:""});$("body").append(o),l=$("#"+t).width(200),e.focus(l),l.on("click",".luckysheet-cols-menuitem",function(){l.hide(),Se();let t=$(this),n=t.attr("itemvalue"),o=t.attr("itemname");e.focus(l,n),$("#luckysheet-icon-font-family").find(".luckysheet-toolbar-menu-button-caption").html(" "+o+" ");let i=x.deepCopyFlowData(O.flowdata);e.updateFormat(i,"ff",n)})}let n=$(this).outerWidth(),o=l.outerWidth(),i=$(this).offset().left;o>n&&o+i>$("#"+O.container).width()&&(i=i-o+n),Ce(l,i,$(this).offset().top+25,"lefttop")}),$("#luckysheet-icon-text-color").mousedown(function(e){he(e),e.stopPropagation()}).click(function(){let t=x.deepCopyFlowData(O.flowdata),l=$(this).attr("color");null==l&&(l="#000000"),e.updateFormat(t,"fc",l)}),$("#luckysheet-icon-text-color-menu").mousedown(function(e){he(e),e.stopPropagation()}).click(function(){let t=$(this).attr("id")+"-menuButton",n=$("#"+t);if(0==n.length){const i=V(),s=i.toolbar,a=i.button,u=i.alternatingColors;let r=[{name:s.alternatingColors+"...",id:"luckysheet-color-alternate",example:""}],d=(e.createButtonMenu(r),"text-color-self"),h=we(e.coloritem,{class:"luckysheet-icon-alternateformat",name:s.alternatingColors+"..."}),f=we(e.color,{id:t,coloritem:h,colorself:d,sub:"",resetColor:s.resetColor});$("body").append(f),n=$("#"+t),$("#"+t).find(".luckysheet-color-selected").spectrum({showPalette:!0,showPaletteOnly:!0,preferredFormat:"hex",clickoutFiresChange:!1,showInitial:!0,showInput:!0,flat:!0,hideAfterPaletteSelect:!0,showSelectionPalette:!0,maxPaletteSize:8,maxSelectionSize:8,cancelText:a.cancel,chooseText:a.confirm,togglePaletteMoreText:s.customColor,togglePaletteLessText:s.collapse,togglePaletteOnly:!0,clearText:s.clearText,color:l.defaultTextColor,noColorSelectedText:s.noColorSelectedText,localStorageKey:"spectrum.textcolor"+c.gridKey,palette:[["#000","#444","#666","#999","#ccc","#eee","#f3f3f3","#fff"],["#f00","#f90","#ff0","#0f0","#0ff","#00f","#90f","#f0f"],["#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d0e0e3","#cfe2f3","#d9d2e9","#ead1dc"],["#ea9999","#f9cb9c","#ffe599","#b6d7a8","#a2c4c9","#9fc5e8","#b4a7d6","#d5a6bd"],["#e06666","#f6b26b","#ffd966","#93c47d","#76a5af","#6fa8dc","#8e7cc3","#c27ba0"],["#c00","#e69138","#f1c232","#6aa84f","#45818e","#3d85c6","#674ea7","#a64d79"],["#900","#b45f06","#bf9000","#38761d","#134f5c","#0b5394","#351c75","#741b47"],["#600","#783f04","#7f6000","#274e13","#0c343d","#073763","#20124d","#4c1130"]],change:function(t){t=null!=t?t.toHexString():"#000",$("#luckysheet-icon-text-color .text-color-bar").css("background-color",t),$("#luckysheet-icon-text-color").attr("color",t);let l=x.deepCopyFlowData(O.flowdata);e.updateFormat(l,"fc",t),n.hide(),Se(),$("#luckysheet-input-box").css("color",t)}}),n.find(".luckysheet-color-reset").click(function(){n.hide(),Se();let l=$("#"+t).find(".luckysheet-color-selected");l.val("#000000"),$("#luckysheet-icon-text-color").attr("color",null),l.spectrum("set","#000000"),$("#luckysheet-icon-text-color .luckysheet-color-menu-button-indicator").css("border-bottom-color","#000000");let o=x.deepCopyFlowData(O.flowdata);e.updateFormat(o,"fc",null)}),n.find(".luckysheet-icon-alternateformat").click(function(){if(n.hide(),Se(),O.luckysheet_select_save.length>1)return void(J()?alert(u.errorInfo):g.info(u.errorInfo,""));let e=$.extend(!0,{},O.luckysheet_select_save[0]);o.rangeIsExists(e)[0]||(o.modelfocusIndex=0,o.new(e)),o.init(),o.perfect()})}let i=$(this).outerWidth(),s=n.outerWidth(),a=$(this).offset().left;s>i&&s+a>$("#"+O.container).width()&&(a=a-s+i);let u=$(this).offset().top+26;setTimeout(function(){let e=$("#"+t).find(".luckysheet-color-selected");e.spectrum("set",e.val()),Ce(n,a-28,u,"lefttop")},1)}),$("#luckysheet-icon-cell-color").click(function(){let t=x.deepCopyFlowData(O.flowdata),l=$(this).attr("color");null==l&&(l="#ffffff"),e.updateFormat(t,"bg",l)}),$("#luckysheet-icon-cell-color-menu").click(function(){let t=$(this).attr("id")+"-menuButton",n=$("#"+t);if(0==n.length){let i="cell-color-self";const s=V(),a=s.toolbar,u=s.button,r=s.alternatingColors;let d=we(e.coloritem,{class:"luckysheet-icon-alternateformat",name:a.alternatingColors+"..."}),h=we(e.color,{id:t,coloritem:d,colorself:i,sub:"",resetColor:a.resetColor});$("body").append(h),n=$("#"+t),$("#"+t).find(".luckysheet-color-selected").spectrum({showPalette:!0,showPaletteOnly:!0,preferredFormat:"hex",clickoutFiresChange:!1,showInitial:!0,showInput:!0,flat:!0,hideAfterPaletteSelect:!0,showSelectionPalette:!0,maxPaletteSize:8,maxSelectionSize:8,color:l.defaultCellColor,cancelText:u.cancel,chooseText:u.confirm,togglePaletteMoreText:a.customColor,togglePaletteLessText:a.collapse,togglePaletteOnly:!0,clearText:a.clearText,noColorSelectedText:a.noColorSelectedText,localStorageKey:"spectrum.bgcolor"+c.gridKey,palette:[["#000","#444","#666","#999","#ccc","#eee","#f3f3f3","#fff"],["#f00","#f90","#ff0","#0f0","#0ff","#00f","#90f","#f0f"],["#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d0e0e3","#cfe2f3","#d9d2e9","#ead1dc"],["#ea9999","#f9cb9c","#ffe599","#b6d7a8","#a2c4c9","#9fc5e8","#b4a7d6","#d5a6bd"],["#e06666","#f6b26b","#ffd966","#93c47d","#76a5af","#6fa8dc","#8e7cc3","#c27ba0"],["#c00","#e69138","#f1c232","#6aa84f","#45818e","#3d85c6","#674ea7","#a64d79"],["#900","#b45f06","#bf9000","#38761d","#134f5c","#0b5394","#351c75","#741b47"],["#600","#783f04","#7f6000","#274e13","#0c343d","#073763","#20124d","#4c1130"]],change:function(t){t=null!=t?t.toHexString():"#fff",$("#luckysheet-icon-cell-color .text-color-bar").css("background-color",t),$("#luckysheet-icon-cell-color").attr("color",t);let l=x.deepCopyFlowData(O.flowdata);e.updateFormat(l,"bg",t),n.hide(),Se()}}),n.find(".luckysheet-color-reset").click(function(){n.hide(),Se();let l=$("#"+t).find(".luckysheet-color-selected");l.val("#ffffff"),$("#luckysheet-icon-cell-color").attr("color",null),l.spectrum("set","#ffffff"),$("#luckysheet-icon-cell-color .luckysheet-color-menu-button-indicator").css("border-bottom-color","#ffffff");let o=x.deepCopyFlowData(O.flowdata);e.updateFormat(o,"bg",null)}),n.find(".luckysheet-icon-alternateformat").click(function(){if(n.hide(),Se(),O.luckysheet_select_save.length>1)return void(J()?alert(r.errorInfo):g.info(r.errorInfo,""));let e=$.extend(!0,{},O.luckysheet_select_save[0]);o.rangeIsExists(e)[0]||(o.modelfocusIndex=0,o.new(e)),o.init(),o.perfect()}),$("#"+t).find(".luckysheet-color-selected").val("#fff")}let i=$(this).outerWidth(),s=n.outerWidth(),a=$(this).offset().left;s>i&&s+a>$("#"+O.container).width()&&(a=a-s+i);let u=$(this).offset().top+26;setTimeout(function(){let e=$("#"+t).find(".luckysheet-color-selected");e.spectrum("set",e.val()),Ce(n,a-28,u,"lefttop")},1)});let t=null;$("#luckysheet-icon-font-size").mousedown(function(e){if(parseInt($("#luckysheet-input-box").css("top"))>0){let e=window.getSelection();if("None"!=e.type){let t=e.getRangeAt(0);t.collapsed||(O.inlineStringEditRange=t.cloneRange())}}he(e),e.stopPropagation()}).click(function(){let l=$(this).attr("id")+"-menuButton",n=$("#"+l);if(0==n.length){let o=[{text:"9",value:"9",example:""},{text:"10",value:"10",example:""},{text:"11",value:"11",example:""},{text:"12",value:"12",example:""},{text:"14",value:"14",example:""},{text:"16",value:"16",example:""},{text:"18",value:"18",example:""},{text:"20",value:"20",example:""},{text:"22",value:"22",example:""},{text:"24",value:"24",example:""},{text:"26",value:"26",example:""},{text:"28",value:"28",example:""},{text:"36",value:"36",example:""},{text:"48",value:"48",example:""},{text:"72",value:"72",example:""}],i=e.createButtonMenu(o),c=we(e.menu,{id:"font-size",item:i,subclass:"",sub:""});$("body").append(c),n=$("#"+l).width(150),e.focus(n,10),n.find(".luckysheet-cols-menuitem").click(function(){n.hide(),Se();let l=$(this).attr("itemvalue"),o=$("#luckysheet-icon-font-size input");$("#luckysheet-icon-font-size").attr("itemvalue",l),e.focus(n,l),o.val(l);let i=x.deepCopyFlowData(O.flowdata);e.updateFormat(i,"fs",l),clearTimeout(t)})}let o=$(this).outerWidth(),i=n.outerWidth(),c=$("#luckysheet-icon-font-size").attr("itemvalue");null==c&&(c=10),e.focus(n,c);let s=$(this).offset().left;i>o&&i+s>$("#"+O.container).width()&&(s=s-i+o),Ce(n,s,$(this).offset().top+25,"lefttop")}).find("input.luckysheet-toolbar-textinput").keydown(function(e){he(e),e.stopPropagation()}).keyup(function(l){if(13!=l.keyCode)return;let n=$(this),o=parseInt(n.val()),i=$("#luckysheet-icon-font-size-menuButton");e.focus(i,o);let c=x.deepCopyFlowData(O.flowdata);e.updateFormat(c,"fs",o),t=setTimeout(function(){i.hide(),n.blur()},200)}),$("#luckysheet-icon-border-all").click(function(){if(!Ae(O.currentSheetIndex))return;x.deepCopyFlowData(O.flowdata);let e=$(this).attr("type");null==e&&(e="border-all");let t=$("#luckysheet-icon-borderColor-menuButton").find(".luckysheet-color-selected").val(),l=$("#luckysheetborderSizepreview").attr("itemvalue");null!=t&&""!=t||(t="#000"),null!=l&&""!=l||(l="1");let n=$.extend(!0,{},O.config);null==n.borderInfo&&(n.borderInfo=[]);let o={rangeType:"range",borderType:e,color:t,style:l,range:$.extend(!0,[],O.luckysheet_select_save)};if(n.borderInfo.push(o),O.clearjfundo){O.jfundo.length=0;let e=[];e.type="borderChange",e.config=$.extend(!0,{},O.config),e.curconfig=$.extend(!0,{},n),e.sheetIndex=O.currentSheetIndex,O.jfredo.push(e)}c.saveParam("cg",O.currentSheetIndex,n.borderInfo,{k:"borderInfo"}),O.config=n,O.luckysheetfile[fe(O.currentSheetIndex)].config=O.config,setTimeout(function(){te()},1)}),$("#luckysheet-icon-border-menu").click(function(){let t=$(this).attr("id")+"-menuButton",l=$("#"+t);if(0==l.length){let n=10,o=120;const i=V(),s=i.border,a=i.toolbar,u=i.button;let r=[{text:s.borderTop,value:"border-top",example:'<div class="luckysheet-icon luckysheet-inline-block luckysheet-material-icon luckysheet-mousedown-cancel" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-border-top iconfont luckysheet-iconfont-shangbiankuang" style="user-select: none;"> </div> </div>'},{text:s.borderBottom,value:"border-bottom",example:'<div class="luckysheet-icon luckysheet-inline-block luckysheet-material-icon luckysheet-mousedown-cancel" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-border-bottom iconfont luckysheet-iconfont-xiabiankuang" style="user-select: none;"> </div> </div>'},{text:s.borderLeft,value:"border-left",example:'<div class="luckysheet-icon luckysheet-inline-block luckysheet-material-icon luckysheet-mousedown-cancel" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-border-left iconfont luckysheet-iconfont-zuobiankuang" style="user-select: none;"> </div> </div>'},{text:s.borderRight,value:"border-right",example:'<div class="luckysheet-icon luckysheet-inline-block luckysheet-material-icon luckysheet-mousedown-cancel" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-border-right iconfont luckysheet-iconfont-youbiankuang" style="user-select: none;"> </div> </div>'},{text:"",value:"split",example:""},{text:s.borderNone,value:"border-none",example:'<div class="luckysheet-icon luckysheet-inline-block luckysheet-material-icon luckysheet-mousedown-cancel" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-border-none iconfont luckysheet-iconfont-wubiankuang" style="user-select: none;"> </div> </div>'},{text:s.borderAll,value:"border-all",example:'<div class="luckysheet-icon luckysheet-inline-block luckysheet-material-icon luckysheet-mousedown-cancel" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-border-all iconfont luckysheet-iconfont-quanjiabiankuang" style="user-select: none;"> </div> </div>'},{text:s.borderOutside,value:"border-outside",example:'<div class="luckysheet-icon luckysheet-inline-block luckysheet-material-icon luckysheet-mousedown-cancel" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-border-outside iconfont luckysheet-iconfont-sizhoujiabiankuang" style="user-select: none;"> </div> </div>'},{text:"",value:"split",example:""},{text:s.borderInside,value:"border-inside",example:'<div class="luckysheet-icon luckysheet-inline-block luckysheet-material-icon luckysheet-mousedown-cancel" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-border-inside iconfont luckysheet-iconfont-neikuangxian" style="user-select: none;"> </div> </div>'},{text:s.borderHorizontal,value:"border-horizontal",example:'<div class="luckysheet-icon luckysheet-inline-block luckysheet-material-icon luckysheet-mousedown-cancel" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-border-horizontal iconfont luckysheet-iconfont-neikuanghengxian" style="user-select: none;"> </div> </div>'},{text:s.borderVertical,value:"border-vertical",example:'<div class="luckysheet-icon luckysheet-inline-block luckysheet-material-icon luckysheet-mousedown-cancel" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-border-vertical iconfont luckysheet-iconfont-neikuangshuxian" style="user-select: none;"> </div> </div>'},{text:"",value:"split",example:""},{text:"<span id='luckysheet-icon-borderColor-linecolor' class='luckysheet-mousedown-cancel' style='border-bottom:3px solid #000;'>"+s.borderColor+"</span>",value:"borderColor",example:"more"},{text:s.borderSize+"<img id='luckysheetborderSizepreview' width=100 height=10 src='data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==' style='position:absolute;bottom:-5px;right:0px;width:100px;height:10px;'>",value:"borderSize",example:"more"}];const d=j.border;let h=e.createButtonMenu(r),f=we(e.menu,{id:"border-menu",item:h,subclass:"",sub:""}),m=[{text:s.borderNone,value:"0",example:""},{text:"<canvas type='Thin' class='border-Thin' width="+o+" height="+n+" style='width:"+o+"px;height:"+n+"px;position:static;'></canvas>",value:"1",example:""},{text:"<canvas type='Hair' class='border-Hair' width="+o+" height="+n+" style='width:"+o+"px;height:"+n+"px;position:static;'></canvas>",value:"2",example:""},{text:"<canvas type='Dotted' class='border-Dotted' width="+o+" height="+n+" style='width:"+o+"px;height:"+n+"px;position:static;'></canvas>",value:"3",example:""},{text:"<canvas type='Dashed' class='border-Dashed' width="+o+" height="+n+" style='width:"+o+"px;height:"+n+"px;position:static;'></canvas>",value:"4",example:""},{text:"<canvas type='DashDot' class='border-DashDot' width="+o+" height="+n+" style='width:"+o+"px;height:"+n+"px;position:static;'></canvas>",value:"5",example:""},{text:"<canvas type='DashDotDot' class='border-DashDotDot' width="+o+" height="+n+" style='width:"+o+"px;height:"+n+"px;position:static;'></canvas>",value:"6",example:""},{text:"<canvas type='Medium' class='border-Medium' width="+o+" height="+n+" style='width:"+o+"px;height:"+n+"px;position:static;'></canvas>",value:"8",example:""},{text:"<canvas type='MediumDashed' class='border-MediumDashed' width="+o+" height="+n+" style='width:"+o+"px;height:"+n+"px;position:static;'></canvas>",value:"9",example:""},{text:"<canvas type='MediumDashDot' class='border-MediumDashDot' width="+o+" height="+n+" style='width:"+o+"px;height:"+n+"px;position:static;'></canvas>",value:"10",example:""},{text:"<canvas type='MediumDashDotDot' class='border-MediumDashDotDot' width="+o+" height="+n+" style='width:"+o+"px;height:"+n+"px;position:static;'></canvas>",value:"11",example:""},{text:"<canvas type='Thick' class='border-Thick' width="+o+" height="+n+" style='width:"+o+"px;height:"+n+"px;position:static;'></canvas>",value:"13",example:""}],p=e.createButtonMenu(m),y=we(e.menu,{id:"borderSize",item:p,subclass:"luckysheet-menuButton-sub"}),v="luckysheet-icon-borderSize-menuButton",k="luckysheet-icon-borderColor-menuButton",g=we(e.color,{id:k,coloritem:"",colorself:"",sub:"luckysheet-menuButton-sub",resetColor:a.resetColor});$("body").append(f+g+y),l=$("#"+t).width(170),e.focus(l,"border-all"),$("#"+v+" canvas").each(function(t){$(this).attr("type");let l=$(this).closest(".luckysheet-cols-menuitem").attr("itemvalue"),n=$(this).addClass("luckysheet-mousedown-cancel").get(0).getContext("2d");n.translate(.5,.5),e.setLineDash(n,l,"h",0,5,100,5),n.strokeStyle="#000000",n.stroke(),n.closePath()}),$("#"+v+" .luckysheet-cols-menuitem").click(function(){$("#"+v).hide();let t=$(this),l=t.attr("itemvalue");if(0==l)$("#luckysheetborderSizepreview").attr("src","data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==").attr("itemvalue",null);else{let e=t.find("canvas").get(0).toDataURL("image/png");$("#luckysheetborderSizepreview").attr("src",e).attr("itemvalue",l)}e.focus($("#"+v),l)}),l.find(".luckysheet-cols-menuitem").click(function(){l.hide(),Se();let t=$(this).attr("itemvalue");if("borderColor"==t||"borderSize"==t)return;if(!Ae(O.currentSheetIndex))return;x.deepCopyFlowData(O.flowdata);let n=$("#"+k).find(".luckysheet-color-selected").val(),o=$("#luckysheetborderSizepreview").attr("itemvalue");null!=n&&""!=n||(n="#000"),null!=o&&""!=o||(o="1");let i=$.extend(!0,{},O.config);null==i.borderInfo&&(i.borderInfo=[]);let s={rangeType:"range",borderType:t,color:n,style:o,range:$.extend(!0,[],O.luckysheet_select_save)};if(i.borderInfo.push(s),O.clearjfundo){O.jfundo.length=0;let e=[];e.type="borderChange",e.config=$.extend(!0,{},O.config),e.curconfig=$.extend(!0,{},i),e.sheetIndex=O.currentSheetIndex,O.jfredo.push(e)}c.saveParam("cg",O.currentSheetIndex,i.borderInfo,{k:"borderInfo"}),O.config=i,O.luckysheetfile[fe(O.currentSheetIndex)].config=O.config,setTimeout(function(){te()},1),$("#luckysheet-icon-border-all").attr("type",t),$("#luckysheet-icon-border-all").find(".luckysheet-icon-img-container").removeAttr("class").addClass("luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-"+t+d[t]),e.focus(l,t)}),$("#"+k).find(".luckysheet-color-selected").spectrum({showPalette:!0,showPaletteOnly:!0,preferredFormat:"hex",clickoutFiresChange:!1,showInitial:!0,showInput:!0,flat:!0,hideAfterPaletteSelect:!0,showSelectionPalette:!0,maxPaletteSize:8,maxSelectionSize:8,color:"#000",cancelText:u.cancel,chooseText:u.confirm,togglePaletteMoreText:a.customColor,togglePaletteLessText:a.collapse,togglePaletteOnly:!0,clearText:a.clearText,noColorSelectedText:a.noColorSelectedText,localStorageKey:"spectrum.bordercolor"+c.gridKey,palette:[["#000","#444","#666","#999","#ccc","#eee","#f3f3f3","#fff"],["#f00","#f90","#ff0","#0f0","#0ff","#00f","#90f","#f0f"],["#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d0e0e3","#cfe2f3","#d9d2e9","#ead1dc"],["#ea9999","#f9cb9c","#ffe599","#b6d7a8","#a2c4c9","#9fc5e8","#b4a7d6","#d5a6bd"],["#e06666","#f6b26b","#ffd966","#93c47d","#76a5af","#6fa8dc","#8e7cc3","#c27ba0"],["#c00","#e69138","#f1c232","#6aa84f","#45818e","#3d85c6","#674ea7","#a64d79"],["#900","#b45f06","#bf9000","#38761d","#134f5c","#0b5394","#351c75","#741b47"],["#600","#783f04","#7f6000","#274e13","#0c343d","#073763","#20124d","#4c1130"]],change:function(e){$(this);e=null!=e?e.toHexString():"#000";$("#luckysheet-icon-borderColor-linecolor").css("border-bottom-color",e),$("#"+k).find(".luckysheet-color-selected").val(e)}}),$("#"+k).find(".luckysheet-color-reset").click(function(){let e=$("#"+k).find(".luckysheet-color-selected");e.val("#000"),$("#luckysheet-icon-cell-color").attr("color",null),e.spectrum("set","#000"),$("#luckysheet-icon-borderColor-linecolor").css("border-bottom-color","#000")})}let n=$(this).outerWidth(),o=l.outerWidth(),i=$(this).offset().left;o>n&&o+i>$("#"+O.container).width()&&(i=i-o+n),Ce(l,i-28,$(this).offset().top+25,"lefttop")}),$("#luckysheet-icon-merge-button").click(function(){if(!Ie(O.currentSheetIndex))return;if(H())return void(J()?alert("ä¸è½åå¹¶éå åºå"):g.info("ä¸è½åå¹¶éå åºå",""));if(null!=O.config.merge){let e=!1;for(let t=0;t<O.luckysheet_select_save.length;t++){let l=O.luckysheet_select_save[t].row[0],n=O.luckysheet_select_save[t].row[1],o=O.luckysheet_select_save[t].column[0],i=O.luckysheet_select_save[t].column[1];if(e=Q(O.config,l,n,o,i))break}if(e)return void(J()?alert("æ æ³å¯¹é¨ååå¹¶ååæ ¼æ§è¡æ­¤æä½"):g.info("æ æ³å¯¹é¨ååå¹¶ååæ ¼æ§è¡æ­¤æä½",""))}let t=x.deepCopyFlowData(O.flowdata);e.updateFormat_mc(t,"mergeAll")}),$("#luckysheet-icon-merge-menu").click(function(){let t=$(this).attr("id")+"-menuButton",l=$("#"+t);if(0==l.length){const n=V().merge;let o=[{text:n.mergeAll,value:"mergeAll",example:""},{text:n.mergeV,value:"mergeV",example:""},{text:n.mergeH,value:"mergeH",example:""},{text:n.mergeCancel,value:"mergeCancel",example:""}],i=e.createButtonMenu(o),c=we(e.menu,{id:"merge-menu",item:i,subclass:"",sub:""});$("body").append(c),l=$("#"+t).width(110),e.focus(l),l.find(".luckysheet-cols-menuitem").click(function(){if(l.hide(),Se(),H())return void(J()?alert(n.overlappingError):g.info(n.overlappingError,""));if(null!=O.config.merge){let e=!1;for(let t=0;t<O.luckysheet_select_save.length;t++){let l=O.luckysheet_select_save[t].row[0],n=O.luckysheet_select_save[t].row[1],o=O.luckysheet_select_save[t].column[0],i=O.luckysheet_select_save[t].column[1];if(e=Q(O.config,l,n,o,i))break}if(e)return void(J()?alert(n.partiallyError):g.info(n.partiallyError,""))}let t=$(this).attr("itemvalue");e.focus(l,t);let o=x.deepCopyFlowData(O.flowdata);e.updateFormat_mc(o,t)})}let n=$(this).outerWidth(),o=l.outerWidth(),i=$(this).offset().left;o>n&&o+i>$("#"+O.container).width()&&(i=i-o+n),Ce(l,i-28,$(this).offset().top+25,"lefttop")}),$("#luckysheet-icon-align").click(function(){let t=$("#luckysheet-icon-align").attr("type");null==t&&(t="left");let l=x.deepCopyFlowData(O.flowdata);e.updateFormat(l,"ht",t)}),$("#luckysheet-icon-align-menu").click(function(){let t=$(this).attr("id")+"-menuButton",l=$("#"+t);if(0==l.length){const n=V().align;let o=[{text:n.left,value:"left",example:'<div class="luckysheet-icon luckysheet-inline-block" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-align-left iconfont luckysheet-iconfont-wenbenzuoduiqi" style="user-select: none;"> </div> </div>'},{text:n.center,value:"center",example:'<div class="luckysheet-icon luckysheet-inline-block" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-align-center iconfont luckysheet-iconfont-wenbenjuzhongduiqi" style="user-select: none;"> </div> </div>'},{text:n.right,value:"right",example:'<div class="luckysheet-icon luckysheet-inline-block" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-align-right iconfont luckysheet-iconfont-wenbenyouduiqi" style="user-select: none;"> </div> </div>'}];const i=j.align;let c=e.createButtonMenu(o),s=we(e.menu,{id:"align-menu",item:c,subclass:"",sub:""});$("body").append(s),l=$("#"+t).width(120),e.focus(l),l.find(".luckysheet-cols-menuitem").click(function(){l.hide(),Se();let t=$(this).attr("itemvalue");e.focus(l,t),$("#luckysheet-icon-align").attr("type",t).find(".luckysheet-icon-img-container").removeAttr("class").addClass("luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-align-"+t+i[t]);let n=x.deepCopyFlowData(O.flowdata);e.updateFormat(n,"ht",t)})}let n=$(this).outerWidth(),o=l.outerWidth(),i=$(this).offset().left;o>n&&o+i>$("#"+O.container).width()&&(i=i-o+n),Ce(l,i-28,$(this).offset().top+25,"lefttop")}),$("#luckysheet-icon-valign").click(function(){let t=$("#luckysheet-icon-valign").attr("type");null==t&&(t="bottom");let l=x.deepCopyFlowData(O.flowdata);e.updateFormat(l,"vt",t)}),$("#luckysheet-icon-valign-menu").click(function(){let t=$(this).attr("id")+"-menuButton",l=$("#"+t);const n=V().align;if(0==l.length){let o=[{text:n.top,value:"top",example:'<div class="luckysheet-icon luckysheet-inline-block" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-valign-top iconfont luckysheet-iconfont-dingbuduiqi" style="user-select: none;"> </div> </div>'},{text:n.middle,value:"middle",example:'<div class="luckysheet-icon luckysheet-inline-block" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-valign-middle iconfont luckysheet-iconfont-shuipingduiqi" style="user-select: none;"> </div> </div>'},{text:n.bottom,value:"bottom",example:'<div class="luckysheet-icon luckysheet-inline-block" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-valign-bottom iconfont luckysheet-iconfont-dibuduiqi" style="user-select: none;"> </div> </div>'}];const i=j.align;let c=e.createButtonMenu(o),s=we(e.menu,{id:"valign-menu",item:c,subclass:"",sub:""});$("body").append(s),l=$("#"+t).width(120),e.focus(l,"bottom"),l.find(".luckysheet-cols-menuitem").click(function(){l.hide(),Se();let t=$(this).attr("itemvalue");e.focus(l,t),$("#luckysheet-icon-valign").attr("type",t).find(".luckysheet-icon-img-container").removeAttr("class").addClass("luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-valign-"+t+i[t]);let n=x.deepCopyFlowData(O.flowdata);e.updateFormat(n,"vt",t)})}let o=$(this).outerWidth(),i=l.outerWidth(),c=$(this).offset().left;i>o&&i+c>$("#"+O.container).width()&&(c=c-i+o),Ce(l,c-28,$(this).offset().top+25,"lefttop")}),$("#luckysheet-icon-textwrap-menu").click(function(){let t=$(this).attr("id")+"-menuButton",l=$("#"+t);if(0==l.length){const n=V().textWrap;let o=[{text:n.overflow,value:"overflow",example:'<div class="luckysheet-icon luckysheet-inline-block" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-textwrap-overflow iconfont luckysheet-iconfont-yichu1" style="user-select: none;"> </div> </div>'},{text:n.wrap,value:"wrap",example:'<div class="luckysheet-icon luckysheet-inline-block" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-textwrap-wrap iconfont luckysheet-iconfont-zidonghuanhang" style="user-select: none;"> </div> </div>'},{text:n.clip,value:"clip",example:'<div class="luckysheet-icon luckysheet-inline-block" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-textwrap-clip iconfont luckysheet-iconfont-jieduan" style="user-select: none;"> </div> </div>'}];const i=j.textWrap;let c=e.createButtonMenu(o),s=we(e.menu,{id:"textwrap-menu",item:c,subclass:"",sub:""});$("body").append(s),l=$("#"+t).width(120),e.focus(l,"clip"),l.find(".luckysheet-cols-menuitem").click(function(){l.hide(),Se();let t=$(this).attr("itemvalue");e.focus(l,t),$("#luckysheet-icon-textwrap").attr("type",t).find(".luckysheet-icon-img-container").removeAttr("class").addClass("luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-textwrap-"+t+i[t]);let n=x.deepCopyFlowData(O.flowdata);e.updateFormat(n,"tb",t)})}let n=$(this).outerWidth(),o=l.outerWidth(),i=$(this).offset().left;o>n&&o+i>$("#"+O.container).width()&&(i=i-o+n),Ce(l,i-28,$(this).offset().top+25,"lefttop")}),$("#luckysheet-icon-rotation-menu").click(function(){let t=$(this).attr("id")+"-menuButton",l=$("#"+t);if(0==l.length){const n=V().rotation;let o=[{text:n.none,value:"none",example:'<div class="luckysheet-icon luckysheet-inline-block" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-rotation-none iconfont luckysheet-iconfont-wuxuanzhuang" style="user-select: none;"> </div> </div>'},{text:n.angleup,value:"angleup",example:'<div class="luckysheet-icon luckysheet-inline-block" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-rotation-angleup iconfont luckysheet-iconfont-xiangshangqingxie" style="user-select: none;"> </div> </div>'},{text:n.angledown,value:"angledown",example:'<div class="luckysheet-icon luckysheet-inline-block" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-rotation-angledown iconfont luckysheet-iconfont-xiangxiaqingxie" style="user-select: none;"> </div> </div>'},{text:n.vertical,value:"vertical",example:'<div class="luckysheet-icon luckysheet-inline-block" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-rotation-vertical iconfont luckysheet-iconfont-shupaiwenzi" style="user-select: none;"> </div> </div>'},{text:n.rotationUp,value:"rotation-up",example:'<div class="luckysheet-icon luckysheet-inline-block" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-rotation-rotation-up iconfont luckysheet-iconfont-wenbenxiangshang" style="user-select: none;"> </div> </div>'},{text:n.rotationDown,value:"rotation-down",example:'<div class="luckysheet-icon luckysheet-inline-block" style="user-select: none;opacity:1;"> <div aria-hidden="true" class="luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-rotation-rotation-down iconfont luckysheet-iconfont-xiangxia90" style="user-select: none;"> </div> </div>'}];const i=j.rotation;let c=e.createButtonMenu(o),s=we(e.menu,{id:"rotation-menu",item:c,subclass:"",sub:""});$("body").append(s),l=$("#"+t).width(160),e.focus(l),l.find(".luckysheet-cols-menuitem").click(function(){l.hide(),Se();let t=$(this).attr("itemvalue");e.focus(l,t),$("#luckysheet-icon-rotation").attr("type",t).find(".luckysheet-icon-img-container").removeAttr("class").addClass("luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-rotation-"+t+i[t]);let n=x.deepCopyFlowData(O.flowdata);e.updateFormat(n,"tr",t)})}let n=$(this).outerWidth(),o=l.outerWidth(),i=$(this).offset().left;o>n&&o+i>$("#"+O.container).width()&&(i=i-o+n),Ce(l,i-28,$(this).offset().top+25,"lefttop")}),$("#luckysheet-icon-freezen-menu").click(function(){let t=$(this).attr("id")+"-menuButton",l=$("#"+t);if(0==l.length){const n=V().freezen;let o=[{text:n.freezenRow,value:"freezenRow",example:""},{text:n.freezenColumn,value:"freezenColumn",example:""},{text:n.freezenRC,value:"freezenRC",example:""},{text:"",value:"split",example:""},{text:n.freezenRowRange,value:"freezenRowRange",example:""},{text:n.freezenColumnRange,value:"freezenColumnRange",example:""},{text:n.freezenRCRange,value:"freezenRCRange",example:""},{text:"",value:"split",example:""},{text:n.freezenCancel,value:"freezenCancel",example:""}],i=e.createButtonMenu(o),c=we(e.menu,{id:"freezen-menu",item:i,subclass:"",sub:""});$("body").append(c),(l=$("#"+t).width(170)).find(".luckysheet-cols-menuitem").click(function(){l.hide(),Se();let t=$(this).attr("itemvalue");if(e.focus(l,t),a.saveFrozen(t),"freezenRow"==t){let e=$("#luckysheet-cell-main").scrollTop(),t=G(O.visibledatarow,e);-1==t&&(t=0);let l=O.visibledatarow[t]-2-e+O.columnHeaderHeight,n=[O.visibledatarow[t],t+1,e,a.cutVolumn(O.visibledatarow,t+1),l];a.saveFreezen(n,l,null,null),null!=a.freezenverticaldata&&(a.cancelFreezenVertical(),a.createAssistCanvas(),te()),a.createFreezenHorizontal(n,l),a.createAssistCanvas(),te()}else if("freezenColumn"==t){let e=$("#luckysheet-cell-main").scrollLeft(),t=G(O.visibledatacolumn,e);-1==t&&(t=0);let l=O.visibledatacolumn[t]-2-e+O.rowHeaderWidth,n=[O.visibledatacolumn[t],t+1,e,a.cutVolumn(O.visibledatacolumn,t+1),l];a.saveFreezen(null,null,n,l),null!=a.freezenhorizontaldata&&(a.cancelFreezenHorizontal(),a.createAssistCanvas(),te()),a.createFreezenVertical(n,l),a.createAssistCanvas(),te()}else if("freezenRC"==t){let e=$("#luckysheet-cell-main").scrollTop(),t=G(O.visibledatarow,e);-1==t&&(t=0);let l=O.visibledatarow[t]-2-e+O.columnHeaderHeight,n=[O.visibledatarow[t],t+1,e,a.cutVolumn(O.visibledatarow,t+1),l];a.saveFreezen(n,l,null,null),a.createFreezenHorizontal(n,l);let o=$("#luckysheet-cell-main").scrollLeft(),i=G(O.visibledatacolumn,o);-1==i&&(i=0);let c=O.visibledatacolumn[i]-2-o+O.rowHeaderWidth,s=[O.visibledatacolumn[i],i+1,o,a.cutVolumn(O.visibledatacolumn,i+1),c];a.saveFreezen(null,null,s,c),a.createFreezenVertical(s,c),a.createAssistCanvas(),te()}else if("freezenRowRange"==t){if(null==O.luckysheet_select_save||0==O.luckysheet_select_save.length)return void(J()?alert(n.noSeletionError):g.info(n.noSeletionError,""));let e=$("#luckysheet-cell-main").scrollTop(),t=G(O.visibledatarow,e),l=O.luckysheet_select_save[O.luckysheet_select_save.length-1],o=null==l.row_focus?l.row[0]:l.row_focus;o>t&&(t=o),-1==t&&(t=0);let i=O.visibledatarow[t]-2-e+O.columnHeaderHeight,c=[O.visibledatarow[t],t+1,e,a.cutVolumn(O.visibledatarow,t+1),i];a.saveFreezen(c,i,null,null),null!=a.freezenverticaldata&&(a.cancelFreezenVertical(),a.createAssistCanvas(),te()),a.createFreezenHorizontal(c,i),a.createAssistCanvas(),te()}else if("freezenColumnRange"==t){if(null==O.luckysheet_select_save||0==O.luckysheet_select_save.length)return void(J()?alert(n.noSeletionError):g.info(n.noSeletionError,""));let e=$("#luckysheet-cell-main").scrollLeft(),t=G(O.visibledatacolumn,e),l=O.luckysheet_select_save[O.luckysheet_select_save.length-1],o=null==l.column_focus?l.column[0]:l.column_focus;o>t&&(t=o),-1==t&&(t=0);let i=O.visibledatacolumn[t]-2-e+O.rowHeaderWidth,c=[O.visibledatacolumn[t],t+1,e,a.cutVolumn(O.visibledatacolumn,t+1),i];a.saveFreezen(null,null,c,i),null!=a.freezenhorizontaldata&&(a.cancelFreezenHorizontal(),a.createAssistCanvas(),te()),a.createFreezenVertical(c,i),a.createAssistCanvas(),te()}else if("freezenRCRange"==t){if(null==O.luckysheet_select_save||0==O.luckysheet_select_save.length)return void(J()?alert(n.noSeletionError):g.info(n.noSeletionError,""));let e=$("#luckysheet-cell-main").scrollTop(),t=G(O.visibledatarow,e),l=O.luckysheet_select_save[O.luckysheet_select_save.length-1],o=null==l.row_focus?l.row[0]:l.row_focus;o>t&&(t=o),-1==t&&(t=0);let i=O.visibledatarow[t]-2-e+O.columnHeaderHeight,c=[O.visibledatarow[t],t+1,e,a.cutVolumn(O.visibledatarow,t+1),i];a.saveFreezen(c,i,null,null),a.createFreezenHorizontal(c,i);let s=$("#luckysheet-cell-main").scrollLeft(),u=G(O.visibledatacolumn,s),r=null==l.column_focus?l.column[0]:l.column_focus;r>u&&(u=r),-1==u&&(u=0);let d=O.visibledatacolumn[u]-2-s+O.rowHeaderWidth,h=[O.visibledatacolumn[u],u+1,s,a.cutVolumn(O.visibledatacolumn,u+1),d];a.saveFreezen(null,null,h,d),a.createFreezenVertical(h,d),a.createAssistCanvas(),te()}else"freezenCancel"==t&&(null!=a.freezenverticaldata&&(a.cancelFreezenVertical(),a.createAssistCanvas(),te()),null!=a.freezenhorizontaldata&&(a.cancelFreezenHorizontal(),a.createAssistCanvas(),te()),a.scrollAdapt());setTimeout(function(){u()},0)})}let n=$(this).outerWidth(),o=l.outerWidth(),i=$(this).offset().left;o>n&&o+i>$("#"+O.container).width()&&(i=i-o+n),Ce(l,i-68,$(this).offset().top+25,"lefttop")}),$("#luckysheet-icon-autofilter").click(function(){let t=$(this).attr("id")+"-menuButton",l=$("#"+t);if(0==l.length){const n=V(),o=n.sort,i=n.filter;let c=[{text:o.asc,value:"asc",example:'<i class="iconfont luckysheet-iconfont-shengxu" aria-hidden="true"></i>'},{text:o.desc,value:"desc",example:'<i class="iconfont luckysheet-iconfont-jiangxu" aria-hidden="true"></i>'},{text:o.custom+"...",value:"diysort",example:'<i class="iconfont luckysheet-iconfont-zidingyipaixu" aria-hidden="true"></i>'},{text:"",value:"split",example:""},{text:i.filter,value:"filter",example:'<i class="iconfont luckysheet-iconfont-shaixuan2" aria-hidden="true"></i>'},{text:i.clearFilter,value:"clearfilter",example:'<i class="iconfont luckysheet-iconfont-qingchushaixuan" aria-hidden="true"></i>'}],s=e.createButtonMenu(c),a=we(e.menu,{id:"autofilter",item:s,subclass:"",sub:""});$("body").append(a),(l=$("#"+t).width(150)).find(".luckysheet-cols-menuitem").click(function(){l.hide(),Se();let e=$(this).attr("itemvalue");"diysort"==e?$("#luckysheetorderby").click():"asc"==e?le(!0):"desc"==e?le(!1):"filter"==e?$("#luckysheet-filter-options-sheet"+O.currentSheetIndex).length>0?$("#luckysheet-filter-initial").click():L():"clearfilter"==e&&$("#luckysheet-filter-initial").click()})}let n=$(this).outerWidth(),o=l.outerWidth(),i=$(this).offset().left;o>n&&o+i>$("#"+O.container).width()&&(i=i-o+n),Ce(l,i,$(this).offset().top+25,"lefttop")}),$("#luckysheet-icon-seachmore").click(function(){let t=$(this).attr("id")+"-menuButton",l=$("#"+t);const n=V().findAndReplace;if(0==l.length){let o=[{text:n.find+" ...",value:"search",example:'<i class="iconfont luckysheet-iconfont-sousuo" aria-hidden="true"></i>'},{text:n.replace+" ...",value:"replace",example:'<i class="iconfont luckysheet-iconfont-tihuan" aria-hidden="true"></i>'},{text:"",value:"split",example:""},{text:n.location+" ...",value:"location",example:'<i class="iconfont luckysheet-iconfont-dingwei" aria-hidden="true"></i>'},{text:n.formula,value:"locationFormula",example:n.locationExample},{text:n.date,value:"locationConstantDate",example:n.locationExample},{text:n.number,value:"locationConstantNumber",example:n.locationExample},{text:n.string,value:"locationConstantString",example:n.locationExample},{text:n.error,value:"locationConstantError",example:n.locationExample},{text:n.condition,value:"locationCF",example:n.locationExample},{text:n.rowSpan,value:"locationStepRow",example:n.locationExample},{text:n.columnSpan,value:"locationStepColumn",example:n.locationExample}],i=e.createButtonMenu(o),c=we(e.menu,{id:"seachmore",item:i,subclass:"",sub:""});$("body").append(c),(l=$("#"+t).width(180)).find(".luckysheet-cols-menuitem").click(function(){l.hide(),Se();let e=$(this).attr("itemvalue");if("search"==e||"replace"==e)"search"==e?d.createDialog(0):"replace"==e&&d.createDialog(1),d.init(),$("#luckysheet-search-replace #searchInput input").focus();else if("location"==e)h.createDialog(),h.init();else if("locationFormula"==e||"locationConstantDate"==e||"locationConstantNumber"==e||"locationConstantString"==e||"locationConstantError"==e||"locationCF"==e){let t,l=O.luckysheet_select_save[0];t=0==O.luckysheet_select_save.length||1==O.luckysheet_select_save.length&&l.row[0]==l.row[1]&&l.column[0]==l.column[1]?[{row:[0,O.flowdata.length-1],column:[0,O.flowdata[0].length-1]}]:$.extend(!0,[],O.luckysheet_select_save),"locationFormula"==e?h.apply(t,"locationFormula","all"):"locationConstantDate"==e?h.apply(t,"locationConstant","d"):"locationConstantNumber"==e?h.apply(t,"locationConstant","n"):"locationConstantString"==e?h.apply(t,"locationConstant","s,g"):"locationConstantError"==e?h.apply(t,"locationConstant","e"):"locationCF"==e&&h.apply(t,"locationCF")}else if("locationStepRow"==e){if(0==O.luckysheet_select_save.length||1==O.luckysheet_select_save.length&&O.luckysheet_select_save[0].row[0]==O.luckysheet_select_save[0].row[1])return void(J()?alert(n.lessTwoRowTip):g.info("",n.lessTwoRowTip));let e=$.extend(!0,[],O.luckysheet_select_save);h.apply(e,"locationStepRow")}else if("locationStepColumn"==e){if(0==O.luckysheet_select_save.length||1==O.luckysheet_select_save.length&&O.luckysheet_select_save[0].column[0]==O.luckysheet_select_save[0].column[1])return void(J()?alert(n.lessTwoColumnTip):g.info("",n.lessTwoColumnTip));let e=$.extend(!0,[],O.luckysheet_select_save);h.apply(e,"locationStepColumn")}})}let o=$(this).outerWidth(),i=l.outerWidth(),c=$(this).offset().left;i>o&&i+c>$("#"+O.container).width()&&(c=c-i+o),Ce(l,c,$(this).offset().top+25,"lefttop")}),$("#luckysheet-icon-function").click(function(){e.autoSelectionFormula("SUM")}),$("#luckysheet-icon-function-menu").click(function(){let t=$(this).attr("id")+"-menuButton",l=$("#"+t);const n=V().formula;if(0==l.length){let o=[{text:n.sum,value:"SUM",example:"SUM"},{text:n.average,value:"AVERAGE",example:"AVERAGE"},{text:n.count,value:"COUNT",example:"COUNT"},{text:n.max,value:"MAX",example:"MAX"},{text:n.min,value:"MIN",example:"MIN"},{text:"",value:"split",example:""},{text:n.ifGenerate,value:"if",example:"IF"},{text:n.find+" ...",value:"formula",example:""}],i=e.createButtonMenu(o),c=we(e.menu,{id:"function-menu",item:i,subclass:"",sub:""});$("body").append(c),(l=$("#"+t).width(180)).find(".luckysheet-cols-menuitem").click(function(){l.hide(),Se();let t=$(this).attr("itemvalue");if("if"==t){let e=O.luckysheet_select_save[O.luckysheet_select_save.length-1],t=null==e.row_focus?e.row[0]:e.row_focus,l=null==e.column_focus?e.column[0]:e.column_focus;if(O.flowdata[t]&&O.flowdata[t][l]&&O.flowdata[t][l].f){let e=O.flowdata[t][l].f.toString();if(-1==e.indexOf("=if("))return void(J()?alert(n.tipNotBelongToIf):g.info(n.tipNotBelongToIf,""));f.ifFormulaDialog(e)}else f.ifFormulaDialog();f.init()}else if("formula"==t){if(0==O.luckysheet_select_save.length)return void(J()?alert(n.tipSelectCell):g.info(n.tipSelectCell,""));let e=O.luckysheet_select_save[O.luckysheet_select_save.length-1],t=e.row_focus,l=e.column_focus;U(t,l,O.flowdata);let o=O.flowdata[t][l];if(null!=o&&null!=o.f){let e=C.getfunctionParam(o.f);null!=e.fn?p.formulaParmDialog(e.fn,e.param):p.formulaListDialog()}else $("#luckysheet-rich-text-editor").html('<span dir="auto" class="luckysheet-formula-text-color">=</span>'),$("#luckysheet-functionbox-cell").html($("#luckysheet-rich-text-editor").html()),p.formulaListDialog();p.init()}else e.autoSelectionFormula(t)})}let o=$(this).outerWidth(),i=l.outerWidth(),c=$(this).offset().left;i>o&&i+c>$("#"+O.container).width()&&(c=c-i+o),Ce(l,c-48,$(this).offset().top+25,"lefttop")}),$("#luckysheet-icon-bold").mousedown(function(e){he(e),e.stopPropagation()}).click(function(t){let l=x.deepCopyFlowData(O.flowdata),n=O.luckysheet_select_save[0].row_focus,o=O.luckysheet_select_save[0].column_focus,i=e.checkstatus(l,n,o,"bl");i=1==i?0:1,e.updateFormat(l,"bl",i),e.menuButtonFocus(l,n,o)}),$("#luckysheet-icon-italic").mousedown(function(e){he(e),e.stopPropagation()}).click(function(){let t=x.deepCopyFlowData(O.flowdata),l=O.luckysheet_select_save[0].row_focus,n=O.luckysheet_select_save[0].column_focus,o=e.checkstatus(t,l,n,"it");o=1==o?0:1,e.updateFormat(t,"it",o),e.menuButtonFocus(t,l,n)}),$("#luckysheet-icon-strikethrough").mousedown(function(e){he(e),e.stopPropagation()}).click(function(){let t=x.deepCopyFlowData(O.flowdata),l=O.luckysheet_select_save[0].row_focus,n=O.luckysheet_select_save[0].column_focus,o=e.checkstatus(t,l,n,"cl");o=1==o?0:1,e.updateFormat(t,"cl",o),e.menuButtonFocus(t,l,n)}),$("#luckysheet-icon-underline").mousedown(function(e){he(e),e.stopPropagation()}).click(function(){let t=x.deepCopyFlowData(O.flowdata),l=O.luckysheet_select_save[0].row_focus,n=O.luckysheet_select_save[0].column_focus,o=e.checkstatus(t,l,n,"un");o=1==o?0:1,e.updateFormat(t,"un",o),e.menuButtonFocus(t,l,n)}),$("#luckysheet-icon-conditionformat").click(function(){let t=$(this).attr("id")+"-menuButton",l=$("#"+t);const n=V().conditionformat;if(0==l.length){let o=[{text:n.highlightCellRules,value:"highlightCellRule",example:"more"},{text:n.itemSelectionRules,value:"projectSelectRule",example:"more"},{text:n.dataBar,value:"dataBar",example:"more"},{text:n.colorGradation,value:"colorGradation",example:"more"},{text:n.icons,value:"icons",example:""},{text:"",value:"split",example:""},{text:n.newRule,value:"newRule",example:""},{text:n.deleteRule,value:"deleteRule",example:"more"},{text:n.manageRules,value:"administerRule",example:""}],s=e.createButtonMenu(o),a=we(e.menu,{id:"conditionformat",item:s,subclass:"",sub:""}),u=[{text:n.greaterThan,value:"greaterThan",example:">"},{text:n.lessThan,value:"lessThan",example:"<"},{text:n.between,value:"betweenness",example:"[]"},{text:n.equal,value:"equal",example:"="},{text:n.textContains,value:"textContains",example:"()"},{text:n.occurrence,value:"occurrenceDate",example:n.yesterday},{text:n.duplicateValue,value:"duplicateValue",example:"##"}],r=e.createButtonMenu(u),d=we(e.menu,{id:"highlightCellRule",item:r,subclass:"luckysheet-menuButton-sub"}),h=[{text:n.top10,value:"top10",example:n.top10},{text:n.top10_percent,value:"top10%",example:n.top10_percent},{text:n.last10,value:"last10",example:n.last10},{text:n.last10_percent,value:"last10%",example:n.last10_percent},{text:n.aboveAverage,value:"AboveAverage",example:n.above},{text:n.belowAverage,value:"SubAverage",example:n.below}],f=e.createButtonMenu(h),m=we(e.menu,{id:"projectSelectRule",item:f,subclass:"luckysheet-menuButton-sub"}),p=`<div id="luckysheet-icon-dataBar-menuButton" class="luckysheet-cols-menu luckysheet-rightgclick-menu luckysheet-menuButton luckysheet-menuButton-sub luckysheet-mousedown-cancel" style="width: 126px;padding: 5px;top: 118.5px;left: 1321.48px;display: none;">\n                                    <div itemvalue="0" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: 0 0;" title="${n.gradientDataBar_1}"></div>\n                                    </div>\n                                    <div itemvalue="1" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -38px 0;" title="${n.gradientDataBar_2}"></div>\n                                    </div>\n                                    <div itemvalue="2" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -76px 0;" title="${n.gradientDataBar_3}"></div>\n                                    </div>\n                                    <div itemvalue="3" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: 0 -36px;" title="${n.gradientDataBar_4}"></div>\n                                    </div>\n                                    <div itemvalue="4" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -38px -36px;" title="${n.gradientDataBar_5}"></div>\n                                    </div>\n                                    <div itemvalue="5" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -76px -36px;" title="${n.gradientDataBar_6}"></div>\n                                    </div>\n                                    <div itemvalue="6" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: 0 -72px;" title="${n.solidColorDataBar_1}"></div>\n                                    </div>\n                                    <div itemvalue="7" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -38px -72px;" title="${n.solidColorDataBar_2}"></div>\n                                    </div>\n                                    <div itemvalue="8" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -76px -72px;" title="${n.solidColorDataBar_3}"></div>\n                                    </div>\n                                    <div itemvalue="9" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: 0 -108px;" title="${n.solidColorDataBar_4}"></div>\n                                    </div>\n                                    <div itemvalue="10" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -38px -108px;" title="${n.solidColorDataBar_5}"></div>\n                                    </div>\n                                    <div itemvalue="11" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -76px -108px;" title="${n.solidColorDataBar_6}"></div>\n                                    </div>\n                                </div>`,v=`<div id="luckysheet-icon-colorGradation-menuButton" class="luckysheet-cols-menu luckysheet-rightgclick-menu luckysheet-menuButton luckysheet-menuButton-sub luckysheet-mousedown-cancel" style="width: 126px;padding: 5px;top: 143.5px;left: 1321.48px;display: none;">\n                                    <div itemvalue="0" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: 0 0;" title="${n.colorGradation_1}"></div>\n                                    </div>\n                                    <div itemvalue="1" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -38px 0;" title="${n.colorGradation_2}"></div>\n                                    </div>\n                                    <div itemvalue="2" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -76px 0;" title="${n.colorGradation_3}"></div>\n                                    </div>\n                                    <div itemvalue="3" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -114px 0;" title="${n.colorGradation_4}"></div>\n                                    </div>\n                                    <div itemvalue="4" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: 0 -36px;" title="${n.colorGradation_5}"></div>\n                                    </div>\n                                    <div itemvalue="5" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -38px -36px;" title="${n.colorGradation_6}"></div>\n                                    </div>\n                                    <div itemvalue="6" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -76px -36px;" title="${n.colorGradation_7}"></div>\n                                    </div>\n                                    <div itemvalue="7" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -114px -36px;" title="${n.colorGradation_8}"></div>\n                                    </div>\n                                    <div itemvalue="8" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: 0 -72px;" title="${n.colorGradation_9}"></div>\n                                    </div>\n                                    <div itemvalue="9" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -38px -72px;" title="${n.colorGradation_10}"></div>\n                                    </div>\n                                    <div itemvalue="10" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -76px -72px;" title="${n.colorGradation_11}"></div>\n                                    </div>\n                                    <div itemvalue="11" class="luckysheet-cols-menuitem luckysheet-mousedown-cancel" style="width: 28px; height: 26px;padding: 5px;float: left;">\n                                        <div class="luckysheet-mousedown-cancel bgImgBox" style="background-position: -114px -72px;" title="${n.colorGradation_12}"></div>\n                                    </div>\n                                </div>`,k=[{text:n.deleteSheetRule,value:"delSheet",example:""}],x=e.createButtonMenu(k),b=we(e.menu,{id:"deleteRule",item:x,subclass:"luckysheet-menuButton-sub"});$("body").append(a+d+m+p+v+b),l=$("#"+t).width(190),$("#luckysheet-icon-highlightCellRule-menuButton").width(160),$("#luckysheet-icon-projectSelectRule-menuButton").width(180),l.find(".luckysheet-cols-menuitem").click(function(){l.hide(),Se();let e=$(this).attr("itemvalue");if("icons"==e){if(0==O.luckysheet_select_save.length)return void(J()?alert(n.pleaseSelectRange):g.info(n.pleaseSelectRange,""));i.CFiconsDialog(),i.init()}else if("newRule"==e){if(0==O.luckysheet_select_save.length)return void(J()?alert(n.pleaseSelectRange):g.info(n.pleaseSelectRange,""));i.newConditionRuleDialog(0),i.init()}else if("administerRule"==e){let e=c.loadSheetUrl,t=pe();if(""!=e&&null!=e){let l=[];for(let e=0;e<t.length;e++)l.push(t[e].index);$.post(e,{gridKey:c.gridKey,index:l.join(",")},function(e){let l=new Function("return "+e)();setTimeout(function(){$("#luckysheetloadingdata").fadeOut().remove()},500);for(let e in l){if(e==O.currentSheetIndex)continue;let n=t[fe(e)];n.celldata=l[e.toString()],n.data=y.buildGridData(n)}ye(t),i.fileClone=$.extend(!0,[],t),i.administerRuleDialog(),i.init()})}else i.fileClone=$.extend(!0,[],t),i.administerRuleDialog(),i.init()}}),$(document).off("click.CFhighlightCellRule").on("click.CFhighlightCellRule","#luckysheet-icon-highlightCellRule-menuButton .luckysheet-cols-menuitem",function(){l.hide(),$("#luckysheet-icon-highlightCellRule-menuButton").hide(),Se();let e=$(this).attr("itemvalue");if(0!=O.luckysheet_select_save.length){let t,l,o=i.textCellColorHtml();switch(e){case"greaterThan":t=n.conditionformat_greaterThan,l=`<div class="box" data-itemvalue="greaterThan">\n                                                <div class="boxTitleOne">${n.conditionformat_greaterThan_title}ï¼</div>\n                                                <div class="inpbox range">\n                                                    <input id="conditionVal" class="formulaInputFocus"/>\n                                                    <i class="fa fa-table" aria-hidden="true" title="${n.selectCell}"></i>\n                                                </div>\n                                                <div style="margin: 5px 0;">${n.setAs}ï¼</div> \n                                                ${o} \n                                            </div>`;break;case"lessThan":t=n.conditionformat_lessThan,l=`<div class="box" data-itemvalue="lessThan">\n                                                <div class="boxTitleOne">${n.conditionformat_lessThan_title}ï¼</div>\n                                                <div class="inpbox range">\n                                                    <input id="conditionVal" class="formulaInputFocus"/>\n                                                    <i class="fa fa-table" aria-hidden="true" title="${n.selectCell}"></i>\n                                                </div>\n                                                <div style="margin: 5px 0;">${n.setAs}ï¼</div>\n                                                ${o}\n                                            </div>`;break;case"betweenness":t=n.conditionformat_betweenness,l=`<div class="box" data-itemvalue="betweenness">\n                                                <div class="boxTitleOne">${n.conditionformat_betweenness_title}ï¼</div>\n                                                <div style="height: 30px;line-height: 30px;">\n                                                    <div class="inpbox2 range">\n                                                        <input id="conditionVal" class="formulaInputFocus"/>\n                                                        <i class="fa fa-table" aria-hidden="true" title="${n.selectCell}"></i>\n                                                    </div>\n                                                    <div style="float: left;height: 30px;line-height: 30px;margin: 0 5px;">${n.to}</div>\n                                                    <div class="inpbox2 range">\n                                                        <input id="conditionVal2" class="formulaInputFocus"/>\n                                                        <i class="fa fa-table" aria-hidden="true" title="${n.selectCell}"></i>\n                                                    </div>\n                                                </div>\n                                                <div style="margin: 5px 0;">${n.setAs}ï¼</div>\n                                                ${o}\n                                            </div>`;break;case"equal":t=n.conditionformat_equal,l=`<div class="box" data-itemvalue="equal">\n                                                <div class="boxTitleOne">${n.conditionformat_equal_title}ï¼</div>\n                                                <div class="inpbox range">\n                                                    <input id="conditionVal" class="formulaInputFocus"/>\n                                                    <i class="fa fa-table" aria-hidden="true" title="${n.selectCell}"></i>\n                                                </div>\n                                                <div style="margin: 5px 0;">${n.setAs}ï¼</div>\n                                                ${o}\n                                            </div>`;break;case"textContains":t=n.conditionformat_textContains,l=`<div class="box" data-itemvalue="textContains">\n                                                <div class="boxTitleOne">${n.conditionformat_textContains_title}ï¼</div>\n                                                <div class="inpbox range">\n                                                    <input id="conditionVal" class="formulaInputFocus"/>\n                                                    <i class="fa fa-table" aria-hidden="true" title="${n.selectCell}"></i>\n                                                </div>\n                                                <div style="margin: 5px 0;">${n.setAs}ï¼</div>\n                                                ${o}\n                                            </div>`;break;case"occurrenceDate":t=n.conditionformat_occurrenceDate,l=`<div class="box" data-itemvalue="occurrenceDate">\n                                                <div class="boxTitleOne">${n.conditionformat_occurrenceDate_title}ï¼</div>\n                                                <div class="inpbox">\n                                                    <input id="daterange-btn" class="formulaInputFocus" readonly="readonly" placeholder="${n.pleaseSelectADate}"/>\n                                                </div>\n                                                <div style="margin: 5px 0;">${n.setAs}ï¼</div>\n                                                ${o}\n                                            </div>`;break;case"duplicateValue":t=n.conditionformat_duplicateValue,l=`<div class="box" data-itemvalue="duplicateValue">\n                                                <div class="boxTitleOne">${n.conditionformat_duplicateValue_title}ï¼</div>\n                                                <select id="conditionVal" class="selectbox">\n                                                    <option value="0">${n.duplicateValue}</option>\n                                                    <option value="1">${n.uniqueValue}</option>\n                                                </select>\n                                                <div style="margin:5px 0;">${n.setAs}ï¼</div>\n                                                ${o}\n                                            </div>`}i.conditionformatDialog(t,l)}else J()?alert(n.pleaseSelectRange):g.info(n.pleaseSelectRange,"")}),$(document).off("click.CFprojectSelectRule").on("click.CFprojectSelectRule","#luckysheet-icon-projectSelectRule-menuButton .luckysheet-cols-menuitem",function(){l.hide(),$("#luckysheet-icon-projectSelectRule-menuButton").hide(),Se();let e=$(this).attr("itemvalue");if(0!=O.luckysheet_select_save.length){let t,l,o=i.textCellColorHtml();switch(e){case"top10":t=n.conditionformat_top10,l=`<div class="box" data-itemvalue="top10">\n                                                <div class="boxTitleOne">${n.conditionformat_top10_title}ï¼</div>\n                                                <div style="height: 30px;line-height: 30px;">\n                                                    <div style="float: left;height: 30px;line-height: 30px;margin: 0 5px;">${n.top}</div>\n                                                    <div class="inpbox2">\n                                                        <input id="conditionVal" class="formulaInputFocus" type="number" value="10"/>\n                                                    </div>\n                                                    <div style="float: left;height: 30px;line-height: 30px;margin: 0 5px;">${n.oneself}</div>\n                                                </div>\n                                                <div style="margin: 5px 0;">${n.setAs}ï¼</div>\n                                                ${o}\n                                            </div>`;break;case"top10%":t=n.conditionformat_top10_percent,l=`<div class="box" data-itemvalue="top10%">\n                                                <div class="boxTitleOne">${n.conditionformat_top10_title}ï¼</div>\n                                                <div style="height: 30px;line-height: 30px;">\n                                                    <div style="float: left;height: 30px;line-height: 30px;margin: 0 5px;">${n.top}</div>\n                                                    <div class="inpbox2">\n                                                        <input id="conditionVal" class="formulaInputFocus" type="number" value="10"/>\n                                                    </div>\n                                                    <div style="float: left;height: 30px;line-height: 30px;margin: 0 5px;">%</div>\n                                                </div>\n                                                <div style="margin: 5px 0;">${n.setAs}ï¼</div>\n                                                ${o}\n                                            </div>`;break;case"last10":t=n.conditionformat_last10,l=`<div class="box" data-itemvalue="last10">\n                                                <div class="boxTitleOne">${n.conditionformat_last10_title}ï¼</div>\n                                                <div style="height: 30px;line-height: 30px;">\n                                                    <div style="float: left;height: 30px;line-height: 30px;margin: 0 5px;">${n.last}</div>\n                                                    <div class="inpbox2">\n                                                        <input id="conditionVal" class="formulaInputFocus" type="number" value="10"/>\n                                                    </div>\n                                                    <div style="float: left;height: 30px;line-height: 30px;margin: 0 5px;">${n.oneself}</div>\n                                                </div>\n                                                <div style="margin: 5px 0;">${n.setAs}ï¼</div>\n                                                ${o}\n                                            </div>`;break;case"last10%":t=n.conditionformat_last10_percent,l=`<div class="box" data-itemvalue="last10%">\n                                                <div class="boxTitleOne">${n.conditionformat_last10_title}ï¼</div>\n                                                <div style="height: 30px;line-height: 30px;">\n                                                    <div style="float: left;height: 30px;line-height: 30px;margin: 0 5px;">${n.last}</div>\n                                                    <div class="inpbox2">\n                                                        <input id="conditionVal" class="formulaInputFocus" type="number" value="10"/>\n                                                    </div>\n                                                    <div style="float: left;height: 30px;line-height: 30px;margin: 0 5px;">%</div>\n                                                </div>\n                                                <div style="margin:5px 0;">è®¾ç½®ä¸ºï¼</div>\n                                                ${o}\n                                            </div>`;break;case"AboveAverage":t=n.conditionformat_AboveAverage,l=`<div class="box" data-itemvalue="AboveAverage">\n                                                <div class="boxTitleOne">${n.conditionformat_AboveAverage_title}ï¼</div>\n                                                <div style="margin: 5px 0;">${n.setAsByArea}ï¼</div>\n                                                ${o}\n                                            </div>`;break;case"SubAverage":t=n.conditionformat_SubAverage,l=`<div class="box" data-itemvalue="SubAverage">\n                                                <div class="boxTitleOne">${n.conditionformat_SubAverage_title}ï¼</div>\n                                                <div style="margin: 5px 0;">${n.setAsByArea}ï¼</div>\n                                                ${o}\n                                            </div>`}i.conditionformatDialog(t,l)}else J()?alert(n.pleaseSelectRange):g.info(n.pleaseSelectRange,"")}),$(document).off("click.CFdataBar").on("click.CFdataBar","#luckysheet-icon-dataBar-menuButton .luckysheet-cols-menuitem",function(){l.hide(),$("#luckysheet-icon-dataBar-menuButton").hide(),Se();let e=$(this).attr("itemvalue");if(O.luckysheet_select_save.length>0){let t=$.extend(!0,[],O.luckysheet_select_save),l=i.dataBarList[e].format;i.updateItem("dataBar",t,l)}}),$(document).off("click.CFcolorGradation").on("click.CFcolorGradation","#luckysheet-icon-colorGradation-menuButton .luckysheet-cols-menuitem",function(){l.hide(),$("#luckysheet-icon-colorGradation-menuButton").hide(),Se();let e=$(this).attr("itemvalue");if(O.luckysheet_select_save.length>0){let t=$.extend(!0,[],O.luckysheet_select_save),l=i.colorGradationList[e].format;i.updateItem("colorGradation",t,l)}}),$(document).off("click.CFdeleteRule").on("click.CFdeleteRule","#luckysheet-icon-deleteRule-menuButton .luckysheet-cols-menuitem",function(){l.hide(),$("#luckysheet-icon-deleteRule-menuButton").hide(),Se(),"delSheet"==$(this).attr("itemvalue")&&i.updateItem("delSheet")})}let o=$(this).outerWidth(),s=l.outerWidth(),a=$(this).offset().left;s>o&&s+a>$("#"+O.container).width()&&(a=a-s+o),Ce(l,a,$(this).offset().top+25,"lefttop")}),$("#luckysheet-icon-postil").click(function(){let t=$(this).attr("id")+"-menuButton",l=$("#"+t);const n=V().comment;l.remove(),v.removeActivePs();let o=O.luckysheet_select_save[O.luckysheet_select_save.length-1],i=o.row_focus;null==i&&(i=o.row[0]);let c,s=o.column_focus;null==s&&(s=o.column[0]),c=null!=O.flowdata[i][s]&&null!=O.flowdata[i][s].ps?[{text:n.edit,value:"editPs",example:""},{text:n.delete,value:"delPs",example:""},{text:"",value:"split",example:""},{text:n.showOne,value:"showHidePs",example:""},{text:n.showAll,value:"showHideAllPs",example:""}]:[{text:n.insert,value:"newPs",example:""},{text:"",value:"split",example:""},{text:n.showAll,value:"showHideAllPs",example:""}];let a=e.createButtonMenu(c),u=we(e.menu,{id:"postil",item:a,subclass:"",sub:""});$("body").append(u),(l=$("#"+t).width(150)).find(".luckysheet-cols-menuitem").click(function(){l.hide(),Se();let e=$(this).attr("itemvalue");"newPs"==e?v.newPs(i,s):"editPs"==e?v.editPs(i,s):"delPs"==e?v.delPs(i,s):"showHidePs"==e?v.showHidePs(i,s):"showHideAllPs"==e&&v.showHideAllPs()});let r=$(this).outerWidth(),d=l.outerWidth(),h=$(this).offset().left;d>r&&d+h>$("#"+O.container).width()&&(h=h-d+r),Ce(l,h,$(this).offset().top+25,"lefttop")}),$("#luckysheet-icon-protection").click(function(){let e=y.getSheetByIndex();Be(e)}),$("#luckysheet-icon-print").click(function(){let t=$(this).attr("id")+"-menuButton",l=$("#"+t);const n=V().print;if(0==l.length){let o=[{text:n.menuItemPrint,value:"print",example:'<i class="iconfont luckysheet-iconfont-dayin" aria-hidden="true"></i>'},{text:"",value:"split",example:""},{text:n.menuItemAreas,value:"areas",example:'<i class="iconfont luckysheet-iconfont-tihuan" aria-hidden="true"></i>'},{text:n.menuItemRows,value:"rows",example:'<i class="iconfont luckysheet-iconfont-zhuandao1" aria-hidden="true"></i>'},{text:n.menuItemColumns,value:"columns",example:'<i class="iconfont luckysheet-iconfont-dingwei" aria-hidden="true"></i>'}],i=e.createButtonMenu(o),c=we(e.menu,{id:"print",item:i,subclass:"",sub:""});$("body").append(c),(l=$("#"+t).width(180)).find(".luckysheet-cols-menuitem").click(function(){l.hide(),Se();let e=$(this).attr("itemvalue");"print"==e?alert("print"):"areas"!=e&&"rows"!=e&&"columns"!=e||alert("areas")})}let o=$(this).outerWidth(),i=l.outerWidth(),c=$(this).offset().left;i>o&&i+c>$("#"+O.container).width()&&(c=c-i+o),Ce(l,c,$(this).offset().top+25,"lefttop")}),$("body").on("mouseover mouseleave",".luckysheet-menuButton .luckysheet-cols-submenu",function(t){let l=$(this),n=l.attr("itemvalue"),o=$("#luckysheet-icon-"+n+"-menuButton");if("mouseover"===t.type){let t=l.parent(),n=$(window).width(),i=$(window).height(),c=t.width(),s=o.height()+25,a=o.width()+5,u=l.offset(),r=u.top,d=u.left+c;d+a>n&&(d=u.left-a),r+s>i&&(r=i-s),o.css({top:r,left:d}).show(),e.rightclickmenu=l}else clearTimeout(e.submenuhide[o.attr("id")]),e.submenuhide[o.attr("id")]=setTimeout(function(){o.hide()},200)}).on("mouseover mouseleave",".luckysheet-menuButton-sub",function(t){"mouseover"===t.type?(e.rightclickmenu.addClass("luckysheet-cols-menuitem-hover"),clearTimeout(e.submenuhide[$(this).attr("id")])):(e.rightclickmenu.removeClass("luckysheet-cols-menuitem-hover"),$(this).hide())})},getQKBorder:function(e,t,l){let n="";e.indexOf("pt")>-1?(e=parseFloat(e))<1||(n=e<1.5?"Medium":"Thick"):(e=parseFloat(e))<2||(n=e<3?"Medium":"Thick");let o=0;return"double"==(t=t.toLowerCase())?o=2:"dotted"==t?o="Medium"==n||"Thick"==n?3:10:"dashed"==t?o="Medium"==n||"Thick"==n?4:9:"solid"==t&&(o="Medium"==n?8:"Thick"==n?13:1),[o,l]},updateFormatCell:function(e,t,l,n,o,i,c){if(null!=e&&null!=t)if("ct"==t){for(let t=n;t<=o;t++)if(null==O.config.rowhidden||null==O.config.rowhidden[t])for(let n=i;n<=c;n++){let o=e[t][n],i=null;i="object"==$e(o)?e[t][n].v:e[t][n],"@"!=l&&q(i)&&(i=parseFloat(i));let c=X(l,i),s="n";Z(l)||14===l||15===l||16===l||17===l||18===l||19===l||20===l||21===l||22===l||45===l||46===l||47===l?s="d":"@"==l||49===l?s="s":"General"!=l&&0!==l||(s="g"),"object"==$e(o)?(e[t][n].m=c,null==e[t][n].ct&&(e[t][n].ct={}),e[t][n].ct.fa=l,e[t][n].ct.t=s):e[t][n]={ct:{fa:l,t:s},v:i,m:c}}}else{"ht"==t?"left"==l?l="1":"center"==l?l="0":"right"==l&&(l="2"):"vt"==t?"top"==l?l="1":"middle"==l?l="0":"bottom"==l&&(l="2"):"tb"==t?"overflow"==l?l="1":"clip"==l?l="0":"wrap"==l&&(l="2"):"tr"==t&&("none"==l?l="0":"angleup"==l?l="1":"angledown"==l?l="2":"vertical"==l?l="3":"rotation-up"==l?l="4":"rotation-down"==l&&(l="5"));for(let s=n;s<=o;s++)if(null==O.config.rowhidden||null==O.config.rowhidden[s])for(let n=i;n<=c;n++){let o=e[s][n];"object"==$e(o)?(be(o,t,l),e[s][n][t]=l):(e[s][n]={v:o},e[s][n][t]=l)}}},updateFormat:function(e,t,l){if(!Ae(O.currentSheetIndex))return;if(!1===O.allowEdit)return;document.createElement("canvas").getContext("2d");if(t in xe&&parseInt($("#luckysheet-input-box").css("top"))>0){if("="!=$("#luckysheet-input-box").text().substr(0,1)){let n=e[O.luckysheetCellUpdate[0]][O.luckysheetCellUpdate[1]];ke(n,t,l,C.rangeResizeTo)}}let n=$.extend(!0,{},O.config);null==n.rowlen&&(n.rowlen={});for(let o=0;o<O.luckysheet_select_save.length;o++){let i=O.luckysheet_select_save[o].row[0],c=O.luckysheet_select_save[o].row[1],s=O.luckysheet_select_save[o].column[0],a=O.luckysheet_select_save[o].column[1];this.updateFormatCell(e,t,l,i,c,s,a),"tb"!=t&&"tr"!=t&&"fs"!=t||(n=ce(e,i,c,n))}let o={};"tb"!=t&&"tr"!=t&&"fs"!=t||(o={cfg:n,RowlChange:!0}),ee(e,O.luckysheet_select_save,o,!1)},updateFormat_mc:function(e,t){let l=$.extend(!0,{},O.config);if(null==l.merge&&(l.merge={}),Ie(O.currentSheetIndex)){if("mergeCancel"==t)for(let t=0;t<O.luckysheet_select_save.length;t++){let n=O.luckysheet_select_save[t],o=n.row[0],i=n.row[1],c=n.column[0],s=n.column[1];if(o==i&&c==s)continue;let a={};for(let t=o;t<=i;t++)for(let n=c;n<=s;n++){let o=e[t][n];if(null!=o&&null!=o.mc){let i=o.mc.r,c=o.mc.c;if("rs"in o.mc)delete o.mc,delete l.merge[i+"_"+c],a[i+"_"+c]=$.extend(!0,{},o);else{let l=JSON.parse(JSON.stringify(a[i+"_"+c]));delete l.v,delete l.m,delete l.ct,delete l.f,delete l.spl,e[t][n]=l}}}}else{let n=!1;for(let t=0;t<O.luckysheet_select_save.length;t++){let l=O.luckysheet_select_save[t],o=l.row[0],i=l.row[1],c=l.column[0],s=l.column[1];for(let t=o;t<=i;t++)for(let l=c;l<=s;l++){let o=e[t][l];if("object"==$e(o)&&"mc"in o){n=!0;break}}}if(n)for(let t=0;t<O.luckysheet_select_save.length;t++){let n=O.luckysheet_select_save[t],o=n.row[0],i=n.row[1],c=n.column[0],s=n.column[1];if(o==i&&c==s)continue;let a={};for(let t=o;t<=i;t++)for(let n=c;n<=s;n++){let o=e[t][n];if(null!=o&&null!=o.mc){let i=o.mc.r,c=o.mc.c;if("rs"in o.mc)delete o.mc,delete l.merge[i+"_"+c],a[i+"_"+c]=$.extend(!0,{},o);else{let l=JSON.parse(JSON.stringify(a[i+"_"+c]));delete l.v,delete l.m,delete l.ct,delete l.f,delete l.spl,e[t][n]=l}}}}else for(let n=0;n<O.luckysheet_select_save.length;n++){let o=O.luckysheet_select_save[n],i=o.row[0],c=o.row[1],s=o.column[0],a=o.column[1];if(i!=c||s!=a)if("mergeAll"==t){let t={},n=!1;for(let l=i;l<=c;l++)for(let o=s;o<=a;o++){let c=e[l][o];null==c||K(c.v)&&null==c.f||n||(t=$.extend(!0,{},c),n=!0),e[l][o]={mc:{r:i,c:s}}}e[i][s]=t,e[i][s].mc={r:i,c:s,rs:c-i+1,cs:a-s+1},l.merge[i+"_"+s]={r:i,c:s,rs:c-i+1,cs:a-s+1}}else if("mergeV"==t)for(let t=s;t<=a;t++){let n={},o=!1;for(let l=i;l<=c;l++){let c=e[l][t];null==c||K(c.v)&&null==c.f||o||(n=$.extend(!0,{},c),o=!0),e[l][t]={mc:{r:i,c:t}}}e[i][t]=n,e[i][t].mc={r:i,c:t,rs:c-i+1,cs:1},l.merge[i+"_"+t]={r:i,c:t,rs:c-i+1,cs:1}}else if("mergeH"==t)for(let t=i;t<=c;t++){let n={},o=!1;for(let l=s;l<=a;l++){let i=e[t][l];null==i||K(i.v)&&null==i.f||o||(n=$.extend(!0,{},i),o=!0),e[t][l]={mc:{r:t,c:s}}}e[t][s]=n,e[t][s].mc={r:t,c:s,rs:1,cs:a-s+1},l.merge[t+"_"+s]={r:t,c:s,rs:1,cs:a-s+1}}}}O.clearjfundo&&(O.jfundo.length=0,O.jfredo.push({type:"mergeChange",sheetIndex:O.currentSheetIndex,data:O.flowdata,curData:e,range:$.extend(!0,[],O.luckysheet_select_save),config:$.extend(!0,{},O.config),curConfig:l})),O.clearjfundo=!1,ee(e,O.luckysheet_select_save,{cfg:l}),O.clearjfundo=!0}},borderfix:function(e,t,l){return null==e[t][l]?[-1,0,0,-1]:null==e[t][l].bg||""==e[t][l].bg?[-1,0,0,-1]:[-2,-1,1,0]},changeMenuButtonDom:function(e,t,l){let n=this;null==l&&(l=V());const o=l.fontarray;l.fontjson;if("bl"==e)"0"!=t?$("#luckysheet-icon-bold").addClass("luckysheet-toolbar-button-hover"):$("#luckysheet-icon-bold").removeClass("luckysheet-toolbar-button-hover");else if("it"==e)"0"!=t?$("#luckysheet-icon-italic").addClass("luckysheet-toolbar-button-hover"):$("#luckysheet-icon-italic").removeClass("luckysheet-toolbar-button-hover");else if("cl"==e)"0"!=t?$("#luckysheet-icon-strikethrough").addClass("luckysheet-toolbar-button-hover"):$("#luckysheet-icon-strikethrough").removeClass("luckysheet-toolbar-button-hover");else if("un"==e)"0"!=t?$("#luckysheet-icon-underline").addClass("luckysheet-toolbar-button-hover"):$("#luckysheet-icon-underline").removeClass("luckysheet-toolbar-button-hover");else if("ff"==e){let e=$("#"+"luckysheet-icon-font-family-menuButton"),l=o[0],i=0;null!=t&&(ie(t).num?null==(l=o[i=parseInt(t)])&&(l=i=n.defualtFont[i],null!=i&&n.addFontTolist(i)):(i=t=t.replace(/"/g,"").replace(/'/g,""),l=t,n.addFontTolist(i))),n.focus(e,i),$("#luckysheet-icon-font-family").find(".luckysheet-toolbar-menu-button-caption").html(" "+l+" ")}else if("fs"==e){let e=$("#luckysheet-icon-font-size-menuButton"),l=t,o=$("#luckysheet-icon-font-size input");n.focus(e,l),$("#luckysheet-icon-font-size").attr("itemvalue",l),o.val(l)}else if("ht"==e){let e=$("#luckysheet-icon-align-menu-menuButton"),l=($("luckysheet-icon-align"),"left");"0"==t?l="center":"2"==t&&(l="right"),n.focus(e,l);const o=j.align;$("#luckysheet-icon-align").attr("type",l).find(".luckysheet-icon-img-container").removeAttr("class").addClass("luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-align-"+l+o[l]),e.hide()}else if("vt"==e){let e=$("#luckysheet-icon-valign-menu-menuButton"),l=($("luckysheet-icon-valign"),"bottom");"1"==t?l="top":"0"==t&&(l="middle"),n.focus(e,l);const o=j.align;$("#luckysheet-icon-valign").attr("type",l).find(".luckysheet-icon-img-container").removeAttr("class").addClass("luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-valign-"+l+o[l]),e.hide()}else if("tb"==e){let e=$("#luckysheet-icon-textwrap-menu-menuButton"),l=($("luckysheet-icon-textwrap"),"clip");"1"==t?l="overflow":"2"==t&&(l="wrap"),n.focus(e,l);const o=j.textWrap;$("#luckysheet-icon-textwrap").attr("type",l).find(".luckysheet-icon-img-container").removeAttr("class").addClass("luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-textwrap-"+l+o[l]),e.hide()}else if("tr"==e){let e=$("#luckysheet-icon-rotation-menu-menuButton"),l=($("luckysheet-icon-rotation"),"none");"1"==t?l="angleup":"2"==t?l="angledown":"3"==t?l="vertical":"4"==t?l="rotation-up":"5"==t&&(l="rotation-down"),n.focus(e,l);const o=j.rotation;$("#luckysheet-icon-rotation").attr("type",l).find(".luckysheet-icon-img-container").removeAttr("class").addClass("luckysheet-icon-img-container luckysheet-icon-img luckysheet-icon-rotation-"+l+o[l]),e.hide()}else if("ct"==e){let e=$("#luckysheet-icon-fmt-other");const l=V().defaultFmt;if(!t)return void e.find(".luckysheet-toolbar-menu-button-caption").html(" "+l[0].text+" ");const{fa:n}=t,o=l.find(e=>e.value===n);if(o)e.find(".luckysheet-toolbar-menu-button-caption").html(" "+o.text+" ");else{const t=l.find(e=>"fmtOtherSelf"===e.value);e.find(".luckysheet-toolbar-menu-button-caption").html(" "+t.text+" ")}}},inputMenuButtonFocus:function(e){let t=window.getSelection().getRangeAt(0).startContainer;O.inlineStringEditRange=null;const l=V();if("SPAN"==t.parentNode.tagName){let e=t.parentNode.style.cssText,n=ge(e);for(let e in n)this.changeMenuButtonDom(e,n[e],l)}},menuButtonFocus:function(e,t,l){let n=this,o=["bl","it","cl","ff","ht","vt","fs","tb","tr","ct","un"];const i=V();for(let c=0;c<o.length;c++){let s=o[c],a=n.checkstatus(e,t,l,s);this.changeMenuButtonDom(s,a,i)}},checkstatus:function(e,t,l,n){if(null==e||null==e[t])return console.warn("It's incorrect data",t,l),null;let o=e[t][l];return re(o,n)},setLineDash:function(e,t,l,n,o,i,c){t={0:"none",1:"Thin",2:"Hair",3:"Dotted",4:"Dashed",5:"DashDot",6:"DashDotDot",7:"Double",8:"Medium",9:"MediumDashed",10:"MediumDashDot",11:"MediumDashDotDot",12:"SlantedDashDot",13:"Thick"}[t.toString()];try{"Hair"==t?e.setLineDash([1,2]):t.indexOf("DashDotDot")>-1?e.setLineDash([2,2,5,2,2]):t.indexOf("DashDot")>-1?e.setLineDash([2,5,2]):t.indexOf("Dotted")>-1?e.setLineDash([2]):t.indexOf("Dashed")>-1?e.setLineDash([3]):e.setLineDash([0])}catch(e){console.log(e)}e.beginPath(),t.indexOf("Medium")>-1?("h"==l?(e.moveTo(n,o-.5),e.lineTo(i,c-.5)):(e.moveTo(n-.5,o),e.lineTo(i-.5,c)),e.lineWidth=2):"Thick"==t?(e.moveTo(n,o),e.lineTo(i,c),e.lineWidth=3):(e.moveTo(n,o),e.lineTo(i,c),e.lineWidth=1)},moveMergeData:function(e,t,l){if(K(e))return e;let n=[],o=[],i=!1;for(let c=0;c<e.length;c++)for(let s=0;s<e[0].length;s++){let a=e[c][s];"object"==$e(a)&&"mc"in a&&(null!=a.mc.rs&&(n.push({rs:a.mc.rs,cs:a.mc.cs,r:a.mc.r,c:a.mc.c}),o.push({rs:a.mc.rs,cs:a.mc.cs,r:a.mc.r+t,c:a.mc.c+l}),i=!0),e[c][s].mc.r+=t,e[c][s].mc.c+=l)}return{deleMC:n,insertMC:o,hasMC:i}},getRangeInMerge:function(e,t,l,n,o){let i=this,c=[],s=null;if(null!=(s=null!=o?$.extend(!0,{},i.getSheetConfig()):$.extend(!0,{},O.config))&&null!=s.merge)for(let o in s.merge){let i=s.merge[o];e+t-1<i.r||e>i.r+i.rs-1||l+n-1<i.c||l>i.c+i.cs-1||c.push(i)}return c},mergeborer:function(e,t,l){if(null==e||null==e[t])return console.warn("Merge info is null",t,l),null;let n=e[t][l];if("object"==$e(n)&&"mc"in n){let o=n.mc;if(null==o)return console.warn("Merge info is null",t,l),null;if(l=o.c,null==e[t=o.r][l])return console.warn("Main merge Cell info is null",t,l),null;let i,c,s,a,u,r,d,h,f=e[t][l].mc.cs,m=e[t][l].mc.rs,p=e[t][l].mc;for(let e=t;e<p.rs+t;e++)i=0==e?-1:O.visibledatarow[e-1]-1,c=O.visibledatarow[e],null==a?(a=i,s=c):s+=c-i-1;for(let e=l;e<p.cs+l;e++)u=0==e?0:O.visibledatacolumn[e-1],r=O.visibledatacolumn[e],null==h?(h=u,d=r):d+=r-u;return{row:[a,s,t,t+m-1],column:[h,d,l,l+f-1]}}return null},mergeMoveData:{},mergeMoveMain:function(e,t,l,n,o,i,c){let s=this,a=y.getSheetMerge();if(null==a)return;let u=[];for(let e in a)u.push(e);t[0]>t[1]&&(t[1]=t[0]),e[0]>e[1]&&(e[1]=e[0]);let r=!0;for(s.mergeMoveData={};r;){r=!1;for(let d=0;d<u.length;d++){let h=u[d],f=a[h];if(h in s.mergeMoveData)continue;let m=s.mergeMove(f,e,t,l,n,o,i,c);null!=m?(s.mergeMoveData[h]=f,e=m[0],t=m[1],n=m[2],o=m[3],i=m[4],c=m[5],r=!0):delete s.mergeMoveData[h]}}return[e,t,n,o,i,c]},mergeMove:function(e,t,l,n,o,i,c,s){let a=this,u=e.r,r=e.r+e.rs-1,d=e.c,h=e.c+e.cs-1,f=!1;if(t[1]<t[0]&&(t[0]=t[1]),l[1]<l[0]&&(l[0]=l[1]),t[0]<=d&&t[1]>=h&&l[0]<=u&&l[1]>=r||!(t[1]<d||t[0]>h)&&!(l[1]<u||l[0]>r)){let m=a.mergeborer(O.flowdata,e.r,e.c);if(m){let e=m.row[1],a=m.row[0],p=(m.row[2],m.column[1]),y=m.column[0];m.column[2];t[1]<d||t[0]>h||(l[0]<=r&&l[0]>=u&&(i+=o-a,o=a,l[0]=u),l[1]>=u&&l[1]<=r&&(i=(n.row_focus>=u&&n.row_focus,e-o),l[1]=r)),l[1]<u||l[0]>r||(t[0]<=h&&t[0]>=d&&(s+=c-y,c=y,t[0]=d),t[1]>=d&&t[1]<=h&&(s=(n.column_focus>=d&&n.column_focus,p-c),t[1]=h)),f=!0}}return f?[t,l,o,i,c,s]:null},getCellRealSize:function(e,t,l){let n=this,o=O.defaultcollen,i=O.defaultrowlen,c=e[t][l];if(c&&null!=c.mc){let t=c.mc,l=n.mergeborer(e,t.r,t.c);if(l){let e=l.row[1],t=l.row[0],n=(l.row[2],l.row[3],l.column[1]),c=l.column[0];l.column[2],l.column[3];o=n-c-1,i=e-t-1}}else{let e=pe()[fe(O.currentSheetIndex)].config;null!=e.columnlen&&null!=e.columnlen[l]&&(o=e.columnlen[l]),null!=e.rowlen&&null!=e.rowlen[t]&&(i=e.rowlen[t])}return[o,i]},getTextHeightCache:{},getTextSize:function(e,t){let l=V().fontarray,n=t||"10pt "+l[0],o=this;if(n in o.getTextHeightCache)return o.getTextHeightCache[n];0==$("#luckysheetTextSizeTest").length&&$('<span id="luckysheetTextSizeTest" style="float:left;white-space:nowrap;visibility:hidden;margin:0;padding:0;">'+e+"</span>").appendTo($("body"));let i=$("#luckysheetTextSizeTest").text(e).css({font:n}),c=i.innerWidth(),s=i.innerHeight();return o.getTextHeightCache[n]=[c,s],[c,s]},activeFormulaInput:function(e,t,l,n,o,i){if(null==i&&(i=!1),U(e,t,O.flowdata,!0),i){let e='<span dir="auto" class="luckysheet-formula-text-color">=</span><span dir="auto" class="luckysheet-formula-text-color">'+o.toUpperCase()+'</span><span dir="auto" class="luckysheet-formula-text-color">(</span><span dir="auto" class="luckysheet-formula-text-color">)</span>';$("#luckysheet-rich-text-editor").html(e);window.getSelection();let t=$("#luckysheet-rich-text-editor").find("span");return void C.setCaretPosition(t.get(t.length-2),0,1)}let c=ne(l[0])[0],s=ne(l[1])[1],a=oe(n[0])[0],u=oe(n[1])[1],r='<span dir="auto" class="luckysheet-formula-text-color">=</span><span dir="auto" class="luckysheet-formula-text-color">'+o.toUpperCase()+'</span><span dir="auto" class="luckysheet-formula-text-color">(</span><span class="luckysheet-formula-functionrange-cell" rangeindex="0" dir="auto" style="color:'+E[0]+';">'+me(O.currentSheetIndex,{row:l,column:n},O.currentSheetIndex)+'</span><span dir="auto" class="luckysheet-formula-text-color">)</span>';$("#luckysheet-rich-text-editor").html(r),C.israngeseleciton(),C.rangestart=!0,C.rangedrag_column_start=!1,C.rangedrag_row_start=!1,C.rangechangeindex=0,C.rangeSetValue({row:l,column:n}),C.func_selectedrange={left:a,width:u-a-1,top:c,height:s-c-1,left_move:a,width_move:u-a-1,top_move:c,height_move:s-c-1,row:[e,e],column:[t,t]},$("#luckysheet-formula-functionrange-select").css({left:a,width:u-a-1,top:c,height:s-c-1}).show(),$("#luckysheet-formula-help-c").hide()},backFormulaInput:function(e,t,l,n,o,i){let s="="+i.toUpperCase()+"("+me(O.currentSheetIndex,{row:n,column:o},O.currentSheetIndex)+")",a=C.execfunction(s,t,l),u={v:a[1],f:a[2]};ae(t,l,e,u),C.execFunctionExist.push({r:t,c:l,i:O.currentSheetIndex}),c.historyParam(e,O.currentSheetIndex,{row:[t,t],column:[l,l]})},checkNoNullValue:function(e){let t=e;return"object"==$e(t)&&(t=t.v),!(K(t)||!ie(t).num||null!=e.ct&&null!=e.ct.t&&"n"!=e.ct.t&&"g"!=e.ct.t)},checkNoNullValueAll:function(e){let t=e;return"object"==$e(t)&&(t=t.v),!K(t)},getNoNullValue:function(e,t,l,n){let o=this,i=null,c=0,s=0;for(let a=l-1;a>=0;a--){let l;if(l="c"==n?e[t][a]:e[a][t],o.checkNoNullValue(l))0,i=a;else{if(null!=l&&null!=l.v&&""!=l.v)break;if(++c>=40){if(!(s<=0))break;s=1}}}return i},singleFormulaInput:function(e,t,l,n,o,i,c,s,a){let u=this;null==c&&(c="r"),null==s&&(s=!0),null==a&&(a=!0);let r=!0,d=!1;for(let t=n;t<=o;t++){let n=null;n="c"==c?e[t][l]:e[l][t],u.checkNoNullValue(n)?(r=!1,d=!0):u.checkNoNullValueAll(n)&&(r=!1)}if(r&&a){if(null==u.getNoNullValue(e,t,l,c))"c"==c?u.activeFormulaInput(t,l,null,null,i,!0):u.activeFormulaInput(l,t,null,null,i,!0);else if(t==n)for(let t=n;t<=o;t++){let n=u.getNoNullValue(e,t,l,c);if(null==n)break;"c"==c?u.backFormulaInput(e,t,l,[t,t],[n,l-1],i):u.backFormulaInput(e,l,t,[n,l-1],[t,t],i)}else for(let t=o;t>=n;t--){let n=u.getNoNullValue(e,t,l,c);if(null==n)break;"c"==c?u.backFormulaInput(e,t,l,[t,t],[n,l-1],i):u.backFormulaInput(e,l,t,[n,l-1],[t,t],i)}}else{if(!d||!s)return!0;{let t=null;if(null!=(t="c"==c?e[o][l]:e[l][o])&&null!=t.v&&t.v.toString().length>0){let s=o;for(t="c"==c?e[o][l]:e[l][o];null!=t&&null!=t.v&&t.v.toString().length>0;){let n=null;if(++s>=(n="c"==c?e.length:e[0].length))return;t="c"==c?e[s][l]:e[l][s]}"c"==c?u.backFormulaInput(e,s,l,[n,o],[l,l],i):u.backFormulaInput(e,l,s,[l,l],[n,o],i)}else"c"==c?u.backFormulaInput(e,o,l,[n,o],[l,l],i):u.backFormulaInput(e,l,o,[l,l],[n,o],i)}}},autoSelectionFormula:function(e){let t=this,l=x.deepCopyFlowData(O.flowdata),n=!0;C.execFunctionExist=[];let o=function(e,l,n,o,i,c){let s=t.getNoNullValue(e,l,i,"c");null==s?t.activeFormulaInput(l,o,null,null,c,!0):t.activeFormulaInput(l,o,[l,n],[s,i-1],c)},i=function(e,l,n,i,c,s){let a=t.getNoNullValue(e,i,n,"r");null==a?o(e,l,n,i,c,s):t.activeFormulaInput(l,i,[a,n-1],[i,c],s)};for(let c=0;c<O.luckysheet_select_save.length;c++){let s=O.luckysheet_select_save[c].row[0],a=O.luckysheet_select_save[c].row[1],u=O.luckysheet_select_save[c].column[0],r=O.luckysheet_select_save[c].column[1],d=O.luckysheet_select_save[c].row_focus,h=O.luckysheet_select_save[c].column_focus;if(s==a&&u==r){if(a-1<0&&r-1<0)return void t.activeFormulaInput(s,u,null,null,e,!0);a-1>=0&&t.checkNoNullValue(l[a-1][u])?i(l,s,a,u,r,e):r-1>=0&&t.checkNoNullValue(l[s][r-1])?o(l,s,a,u,r,e):i(l,s,a,u,r,e)}else if(s==a)n=t.singleFormulaInput(l,h,s,u,r,e,"r");else if(u==r)n=t.singleFormulaInput(l,d,u,s,a,e,"c");else{let o=!0;for(let n=s;n<=a;n++)o=t.singleFormulaInput(l,h,n,u,r,e,"r",!0,!1)&&o;let i=!0;for(let n=u;n<=r;n++)i=t.singleFormulaInput(l,d,n,s,a,e,"c",!0,!1)&&i;n=!!o&&!!i}n=n&&n}n||(C.execFunctionExist.reverse(),C.execFunctionGroup(null,null,null,null,l),ee(l,O.luckysheet_select_save),clearTimeout(O.jfcountfuncTimeout),O.jfcountfuncTimeout=setTimeout(function(){de()},500))},getStyleByCell:function(e,t,l){let n=this,c="",s=o.getComputeMap(),a=o.checksAF(t,l,s),u=i.getComputeMap(),r=i.checksCF(t,l,u);V().fontarray;let d=e[t][l],h=(d.ct,!1);ve(d)&&(h=!0);for(let o in d){let i=n.checkstatus(e,t,l,o);(null!=a||null!=r&&null!=r.cellColor)&&(null!=r&&null!=r.cellColor?c+="background: "+r.cellColor+";":null!=a&&(c+="background: "+a[1]+";")),"object"!=$e(i)&&(("bg"==o||null!=a||null!=r&&null!=r.cellColor)&&(null!=r&&null!=r.cellColor?c+="background: "+r.cellColor+";":c+=null!=a?"background: "+a[1]+";":"background: "+i+";"),"ht"==o&&"1"!=i&&("0"==i?c+="text-align: center;":"2"==i&&(c+="text-align: right;")),"vt"==o&&"1"!=i&&("0"==i?c+="align-items: center;":"2"==i&&(c+="align-items: flex-end;")))}return h||(c+=ue(d,a,r)),c},fontSelectList:[],defualtFont:["Times New Roman","Arial","Tahoma","Verdana","å¾®è½¯éé»","å®ä½","é»ä½","æ¥·ä½","ä»¿å®","æ°å®ä½","åææ°é­","åæè¡æ¥·","åæé¶ä¹¦"],addFontTolist:function(e){e=e.replace(/"/g,"").replace(/'/g,"");let t=!0;for(let l=0;l<this.fontSelectList.length;l++){if(this.fontSelectList[l].value==e){t=!1;break}}if(e in V().fontjson&&(t=!1),t){let t={};t.value=e,t.index=this.fontSelectList.length,t.type="userDefined",t.text="<span class='luckysheet-mousedown-cancel' style='font-size:11px;font-family:"+e+"'>"+e+"</span>",t.example="",this.fontSelectList.push(t);let l=$("#luckysheet-icon-font-family-menuButton"),n=this.createButtonMenu(this.fontSelectList);l.html(n)}},fontInitial:function(e){let t=[];const l=V().fontarray;for(let e=0;e<l.length;e++){let n=l[e],o={};o.value=n,o.index=e,o.type="inner",o.text="<span class='luckysheet-mousedown-cancel' style='font-size:11px;font-family:"+n+"'>"+n+"</span>",o.example="",t.push(o)}if(null!=e){for(let l=0;l<e.length;l++){let n=e[l],o={};if(o.value=n.fontName,o.index=l,o.type="userDefined",o.text="<span class='luckysheet-mousedown-cancel' style='font-size:11px;font-family:"+n.fontName+"'>"+n.fontName+"</span>",o.example="",t.push(o),document.fonts&&!document.fonts.check("12px "+n.fontName)&&n.url){const e=new FontFace(n.fontName,`url(${n.url})`);document.fonts.add(e),e.load()}}document.fonts&&document.fonts.ready.then(function(){})}this.fontSelectList=t}}});
//# sourceMappingURL=../sourcemaps/controllers/menuButton.js.map
