/**
 * skylark-lucksheet - A version of lucksheet.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["../methods/rhchInit","../methods/formula_methods","../methods/setdata","../methods/getdata","../methods/getRowlen","../widgets/draw","./freezen","./sheetmanage","./postil","../widgets/hyperlinkCtrl","../widgets/select","./filter","../methods/get","../store"],function(e,t,a,n,l,r,c,i,o,d,u,f,s,h){"use strict";const{setcellvalue:g}=a,{getcellFormula:m}=n,{computeRowlenArr:x}=l,{luckysheetDrawMain:w,luckysheetDrawgridRowTitle:y,luckysheetDrawgridColumnTitle:v}=r,{selectHightlightShow:k,selectionCopyShow:_,collaborativeEditBox:I}=u,{createFilterOptions:p}=f,{getSheetIndex:S}=s;let z=null;function C(e,a,n){t.execFunctionExist=[];for(let n=0;n<e.length;n++)for(let l=e[n].row[0];l<=e[n].row[1];l++)for(let r=e[n].column[0];r<=e[n].column[1];r++)t.execFunctionExist.push({r:l,c:r,i:a});t.execFunctionExist.reverse(),t.execFunctionGroup(null,null,null,null,n),t.execFunctionGlobalData=null}function P(e,a,n,l=!0,r=!0){null==e&&(e=h.flowdata),null==a&&(a=h.luckysheet_select_save),clearTimeout(z),null==n&&(n={});let c=n.cfg,i=n.RowlChange,o=n.cdformat,d=n.dataVerification,u=n.dynamicArray,f=h.luckysheetfile[S(h.currentSheetIndex)];if(h.clearjfundo){let t,n,l,r;h.jfundo.length=0,t=null==c?$.extend(!0,{},h.config):$.extend(!0,{},c),n=null==o?$.extend(!0,[],f.luckysheet_conditionformat_save):o,l=null==d?$.extend(!0,{},f.dataVerification):d,r=null==u?$.extend(!0,[],f.dynamicArray):u,h.jfredo.push({type:"datachange",data:h.flowdata,curdata:e,sheetIndex:h.currentSheetIndex,range:a,config:$.extend(!0,{},h.config),curConfig:t,cdformat:$.extend(!0,[],f.luckysheet_conditionformat_save),curCdformat:n,RowlChange:i,dataVerification:$.extend(!0,[],f.dataVerification),curDataVerification:l,dynamicArray:$.extend(!0,[],f.dynamicArray),curDynamicArray:r,dataRange:[...f.luckysheet_select_save]})}h.flowdata=e,h.webWorkerFlowDataCache(h.flowdata),f.data=h.flowdata,null!=c&&(h.config=c,f.config=h.config,h.saveParam("all",h.currentSheetIndex,c,{k:"config"}),null!=i&&F(h.flowdata.length,h.flowdata[0].length)),null!=o&&(f.luckysheet_conditionformat_save=o,h.saveParam("all",h.currentSheetIndex,o,{k:"luckysheet_conditionformat_save"})),null!=d&&(h.dataVerification=d,f.dataVerification=d,h.saveParam("all",h.currentSheetIndex,d,{k:"dataVerification"})),null!=u&&(f.dynamicArray=u,h.saveParam("all",h.currentSheetIndex,u,{k:"dynamicArray"}));for(let e=0;e<a.length;e++){let n=a[e].row[0],l=a[e].column[0];if(null!=h.flowdata[n][l]&&null!=h.flowdata[n][l].spl){window.luckysheetCurrentRow=n,window.luckysheetCurrentColumn=l,window.luckysheetCurrentFunction=h.flowdata[n][l].f;let e=$.trim(t.functionParserExe(h.flowdata[n][l].f)),a=new Function("return "+e)();h.flowdata[n][l].spl=a}h.allowUpdate&&h.historyParam(h.flowdata,h.currentSheetIndex,a[e]),"function"==typeof h.chartparam.jfrefreshchartall&&h.chartparam.jfrefreshchartall(h.flowdata,a[e].row[0],a[e].row[1],a[e].column[0],a[e].column[1])}l&&C(a,h.currentSheetIndex,e),r&&(z=setTimeout(function(){j()},1)),window.luckysheet_getcelldata_cache=null}function V(e,t,a,n,l,r,c,o,d=!0){let u={},f=!1;if(clearTimeout(z),"cellRowChange"==r){u.type="cellRowChange",u.config=$.extend(!0,{},h.config),u.curconfig=$.extend(!0,{},n),u.range=$.extend(!0,[],h.luckysheet_select_save),u.currange=l,u.ctrlType=r,u.ctrlValue=c;let e=n.rowlen;null==e&&(e={}),h.saveParam("cg",h.currentSheetIndex,e,{k:"rowlen"})}else if("resizeC"==r){u.type="resize",u.config=$.extend(!0,{},h.config),u.curconfig=$.extend(!0,{},n),u.range=$.extend(!0,[],h.luckysheet_select_save),u.currange=l,u.ctrlType=r,u.ctrlValue=c;let e=n.columnlen;null==e&&(e={}),h.saveParam("cg",h.currentSheetIndex,e,{k:"columnlen"})}else if(r.indexOf("extend")>-1)u.type="extend",u.config=$.extend(!0,{},h.config),u.curconfig=$.extend(!0,{},n),u.range=$.extend(!0,[],h.luckysheet_select_save),u.currange=l,u.ctrlType=r,u.ctrlValue=c,h.saveParam("arc",h.currentSheetIndex,{index:c.index,len:c.len,direction:c.direction,mc:n.merge},{rc:c.type});else if(r.indexOf("dele")>-1)u.type="dele",u.config=$.extend(!0,{},h.config),u.curconfig=$.extend(!0,{},n),u.range=$.extend(!0,[],h.luckysheet_select_save),u.currange=l,u.ctrlType=r,u.ctrlValue=c,h.saveParam("drc",h.currentSheetIndex,{index:c.index,len:c.len,mc:n.merge,borderInfo:n.borderInfo},{rc:c.type});else{u.type="datachangeAll",u.range=$.extend(!0,[],h.luckysheet_select_save),u.currange=l,u.ctrlType=r,u.ctrlValue=c,f=!0;for(let e=0;e<l.length;e++)h.historyParam(a,h.currentSheetIndex,l[e])}h.clearjfundo&&(h.jfundo.length=0,u.data=h.flowdata,u.curdata=a,u.sheetIndex=h.currentSheetIndex,u.cdformat=$.extend(!0,[],h.luckysheetfile[S(h.currentSheetIndex)].luckysheet_conditionformat_save),u.curCdformat=o,h.jfredo.push(u)),h.flowdata=a,h.webWorkerFlowDataCache(a),h.luckysheetfile[S(h.currentSheetIndex)].data=h.flowdata,null!=n&&(h.config=n,h.luckysheetfile[S(h.currentSheetIndex)].config=h.config,h.saveParam("all",h.currentSheetIndex,n,{k:"config"})),null!=o&&(h.luckysheetfile[S(h.currentSheetIndex)].luckysheet_conditionformat_save=o,h.saveParam("all",h.currentSheetIndex,o,{k:"luckysheet_conditionformat_save"})),h.luckysheet_select_save=$.extend(!0,[],l),h.luckysheet_select_save.length>0&&k(),f&&C(l,h.currentSheetIndex,a),F(t,e),d&&(z=setTimeout(function(){j()},1)),i.storeSheetParamALL(),window.luckysheet_getcelldata_cache=null}function b(e,a,n,l,r,c,i,o,u,f,s){let x=h.luckysheetfile[S(h.currentSheetIndex)];I();let w=[];for(let t in a.merge){let n=a.merge[t];for(let t=n.r;t<=n.r+n.rs-1;t++)for(let a=n.c;a<=n.c+n.cs-1;a++)null==e[t][a]&&(e[t][a]={}),t==n.r&&a==n.c?e[t][a].mc=n:e[t][a].mc={r:n.r,c:n.c},w.push({r:t,c:a})}let y=[];h.clearjfundo&&(h.jfundo.length=0,h.jfredo.push({type:n,sheetIndex:h.currentSheetIndex,data:h.flowdata,curData:e,config:$.extend(!0,{},h.config),curConfig:a,ctrlValue:l,mcData:w,calc:$.extend(!0,[],x.calcChain),curCalc:r,funcData:y,filterObj:{filter_select:$.extend(!0,{},x.filter_select),filter:$.extend(!0,{},x.filter)},curFilterObj:c,cf:$.extend(!0,[],x.luckysheet_conditionformat_save),curCf:i,af:$.extend(!0,[],x.luckysheet_alternateformat_save),curAf:o,freezen:{freezenhorizontaldata:h.freezenhorizontaldata,freezenverticaldata:h.freezenverticaldata},curFreezen:u,dataVerification:$.extend(!0,{},x.dataVerification),curDataVerification:f,hyperlink:$.extend(!0,{},x.hyperlink),curHyperlink:s,dataRange:[...x.luckysheet_select_save]}));let v=l.index,k=l.len,_=l.rc;if("addRC"==n){let t=l.direction,a=[];if(l.restore)if("r"==_){let n;"lefttop"==t?n=v:"rightbottom"==t&&(n=v+1);let l=n+k-1;for(let t=n;t<=l;t++){let n=[];for(let a=0;a<e[0].length;a++){let l=e[t][a];n.push(l)}a.push(n)}}else if("c"==_){let n;"lefttop"==t?n=v:"rightbottom"==t&&(n=v+1);let l=n+k-1;for(let t=0;t<e.length;t++){let r=[];for(let a=n;a<=l;a++){let n=e[t][a];r.push(n)}a.push(r)}}h.saveParam("arc",h.currentSheetIndex,{index:v,len:k,direction:t,data:a},{rc:_})}else"delRC"==n&&h.saveParam("drc",h.currentSheetIndex,{index:v,len:k},{rc:_});h.flowdata=e,h.webWorkerFlowDataCache(h.flowdata),x.data=e,h.config=a,x.config=h.config,h.saveParam("all",h.currentSheetIndex,a,{k:"config"});for(let e=0;e<w.length;e++){let t=w[e].r,a=w[e].c;h.saveParam("v",h.currentSheetIndex,h.flowdata[t][a],{r:t,c:a})}if(r.length>0)for(let a=0;a<r.length;a++){let n=r[a],l=n.r,c=n.c,i=n.index,o=m(l,c,i,e),d=t.execfunction(o,l,c,i,null,!0);n.func=d,e[l][c].f==o&&g(l,c,e,d[1])}x.calcChain=r,h.saveParam("all",h.currentSheetIndex,r,{k:"calcChain"});for(let e=0;e<y.length;e++){let t=y[e].r,a=y[e].c;h.saveParam("v",h.currentSheetIndex,h.flowdata[t][a],{r:t,c:a})}null!=c?(x.filter_select=c.filter_select,x.filter=c.filter):(x.filter_select=null,x.filter=null),p(x.filter_select,x.filter),h.saveParam("all",h.currentSheetIndex,x.filter_select,{k:"filter_select"}),h.saveParam("all",h.currentSheetIndex,x.filter,{k:"filter"}),x.luckysheet_conditionformat_save=i,h.saveParam("all",h.currentSheetIndex,x.luckysheet_conditionformat_save,{k:"luckysheet_conditionformat_save"}),x.luckysheet_alternateformat_save=o,h.saveParam("all",h.currentSheetIndex,x.luckysheet_alternateformat_save,{k:"luckysheet_alternateformat_save"}),null!=u?(h.freezenhorizontaldata=u.freezenhorizontaldata,h.freezenverticaldata=u.freezenverticaldata):(h.freezenhorizontaldata=null,h.freezenverticaldata=null),h.dataVerification=f,x.dataVerification=f,h.saveParam("all",h.currentSheetIndex,x.dataVerification,{k:"dataVerification"}),d.hyperlink=s,x.hyperlink=s,h.saveParam("all",h.currentSheetIndex,x.hyperlink,{k:"hyperlink"}),F(h.flowdata.length,h.flowdata[0].length)}function D(e,a,n,l,r,c,i,o){let u=h.luckysheetfile[S(h.currentSheetIndex)];clearTimeout(z),I();let f=[];if("{}"==JSON.stringify(a.merge))for(let t=0;t<e.length;t++)for(let a=0;a<e[0].length;a++){let n=e[t][a];null!=n&&null!=n.mc&&(delete n.mc,f.push({r:t,c:a}))}else for(let t in a.merge){let n=a.merge[t];for(let t=n.r;t<=n.r+n.rs-1;t++)for(let a=n.c;a<=n.c+n.cs-1;a++)null==e[t][a]&&(e[t][a]={}),t==n.r&&a==n.c?e[t][a].mc=n:e[t][a].mc={r:n.r,c:n.c},f.push({r:t,c:a})}let s=[];if(h.clearjfundo&&(h.jfundo.length=0,h.jfredo.push({type:"deleteCell",sheetIndex:h.currentSheetIndex,ctrl:n,data:h.flowdata,curData:e,config:$.extend(!0,{},h.config),curConfig:a,mcData:f,calc:$.extend(!0,[],u.calcChain),curCalc:l,funcData:s,filterObj:{filter_select:$.extend(!0,{},u.filter_select),filter:$.extend(!0,{},u.filter)},curFilterObj:r,cf:$.extend(!0,[],u.luckysheet_conditionformat_save),curCf:c,dataVerification:$.extend(!0,{},u.dataVerification),curDataVerification:i,hyperlink:$.extend(!0,{},u.hyperlink),curHyperlink:o,dataRange:[...u.luckysheet_select_save]})),h.flowdata=e,h.webWorkerFlowDataCache(h.flowdata),u.data=e,h.allowUpdate){let t,a=n.type,l=n.str,r=n.edr,c=n.stc,i=n.edc;"moveUp"==a?t={row:[l,e.length-1],column:[c,i]}:"moveLeft"==a&&(t={row:[l,r],column:[c,e[0].length-1]}),h.historyParam(h.flowdata,h.currentSheetIndex,t)}h.config=a,u.config=h.config,h.saveParam("all",h.currentSheetIndex,a,{k:"config"});for(let e=0;e<f.length;e++){let t=f[e].r,a=f[e].c;h.saveParam("v",h.currentSheetIndex,h.flowdata[t][a],{r:t,c:a})}if(l.length>0)for(let a=0;a<l.length;a++){let n=l[a],r=n.r,c=n.c,i=n.index,o=m(r,c,i,e),d=t.execfunction(o,r,c,i,null,!0);n.func=d,e[r][c].f==o&&g(r,c,e,d[1])}u.calcChain=l,h.saveParam("all",h.currentSheetIndex,l,{k:"calcChain"});for(let e=0;e<s.length;e++){let t=s[e].r,a=s[e].c;h.saveParam("v",h.currentSheetIndex,h.flowdata[t][a],{r:t,c:a})}null!=r?(u.filter_select=r.filter_select,u.filter=r.filter):(u.filter_select=null,u.filter=null),p(u.filter_select,u.filter),h.saveParam("all",h.currentSheetIndex,u.filter_select,{k:"filter_select"}),h.saveParam("all",h.currentSheetIndex,u.filter,{k:"filter"}),u.luckysheet_conditionformat_save=c,h.saveParam("all",h.currentSheetIndex,u.luckysheet_conditionformat_save,{k:"luckysheet_conditionformat_save"}),h.dataVerification=i,u.dataVerification=i,h.saveParam("all",h.currentSheetIndex,u.dataVerification,{k:"dataVerification"}),d.hyperlink=o,u.hyperlink=o,h.saveParam("all",h.currentSheetIndex,u.hyperlink,{k:"hyperlink"}),z=setTimeout(function(){j()},1)}function H(e,a,n){let l,r={};t.execFunctionExist=[],clearTimeout(z);for(let a=e.range.row[0];a<=e.range.row[1];a++)for(let n=e.range.column[0];n<=e.range.column[1];n++)a+"_"+n+"_"+e.sheetIndex in r||(r[a+"_"+n+"_"+e.sheetIndex]=0,t.execFunctionExist.push({r:a,c:n,i:e.sheetIndex}));for(let e=a.range.row[0];e<=a.range.row[1];e++)for(let n=a.range.column[0];n<=a.range.column[1];n++)e+"_"+n+"_"+a.sheetIndex in r||(r[e+"_"+n+"_"+a.sheetIndex]=0,t.execFunctionExist.push({r:e,c:n,i:a.sheetIndex}));if(h.clearjfundo&&(h.jfundo.length=0,h.jfredo.push({type:"pasteCut",source:e,target:a,RowlChange:n})),h.currentSheetIndex==e.sheetIndex?(h.config=e.curConfig,l=e.curData.length,h.luckysheetfile[S(a.sheetIndex)].config=a.curConfig):h.currentSheetIndex==a.sheetIndex&&(h.config=a.curConfig,l=a.curData.length,h.luckysheetfile[S(e.sheetIndex)].config=e.curConfig),n){h.visibledatarow=[],h.rh_height=0;for(let e=0;e<l;e++){let t=h.defaultrowlen;null!=h.config.rowlen&&null!=h.config.rowlen[e]&&(t=h.config.rowlen[e]),null==h.config.rowhidden||null==h.config.rowhidden[e]?(h.rh_height+=t+1,h.visibledatarow.push(h.rh_height)):(t=h.config.rowhidden[e],h.visibledatarow.push(h.rh_height))}if(h.rh_height+=110,h.currentSheetIndex==e.sheetIndex){let e=x(a.curData.length,a.curConfig);h.luckysheetfile[S(a.sheetIndex)].visibledatarow=e}else if(h.currentSheetIndex==a.sheetIndex){let t=x(e.curData.length,e.curConfig);h.luckysheetfile[S(e.sheetIndex)].visibledatarow=t}}h.currentSheetIndex==e.sheetIndex?(h.flowdata=e.curData,h.luckysheetfile[S(a.sheetIndex)].data=a.curData):h.currentSheetIndex==a.sheetIndex&&(h.flowdata=a.curData,h.luckysheetfile[S(e.sheetIndex)].data=e.curData),h.webWorkerFlowDataCache(h.flowdata),h.luckysheetfile[S(h.currentSheetIndex)].data=h.flowdata,h.currentSheetIndex==a.sheetIndex?h.luckysheet_select_save=[{row:a.range.row,column:a.range.column}]:h.luckysheet_select_save=[{row:e.range.row,column:e.range.column}],h.luckysheet_select_save.length>0&&k(),h.luckysheetfile[S(e.sheetIndex)].luckysheet_conditionformat_save=e.curCdformat,h.luckysheetfile[S(a.sheetIndex)].luckysheet_conditionformat_save=a.curCdformat,h.currentSheetIndex==e.sheetIndex?h.dataVerification=e.curDataVerification:h.currentSheetIndex==a.sheetIndex&&(h.dataVerification=a.curDataVerification),h.luckysheetfile[S(e.sheetIndex)].dataVerification=e.curDataVerification,h.luckysheetfile[S(a.sheetIndex)].dataVerification=a.curDataVerification,t.execFunctionExist.reverse(),t.execFunctionGroup(null,null,null,null,a.curData),t.execFunctionGlobalData=null,z=setTimeout(function(){j()},1),i.storeSheetParamALL(),h.saveParam("all",e.sheetIndex,e.curConfig,{k:"config"}),h.saveParam("all",a.sheetIndex,a.curConfig,{k:"config"}),h.historyParam(e.curData,e.sheetIndex,{row:e.range.row,column:e.range.column}),h.historyParam(a.curData,a.sheetIndex,{row:a.range.row,column:a.range.column}),h.saveParam("all",e.sheetIndex,e.curCdformat,{k:"luckysheet_conditionformat_save"}),h.saveParam("all",a.sheetIndex,a.curCdformat,{k:"luckysheet_conditionformat_save"}),h.saveParam("all",e.sheetIndex,e.curDataVerification,{k:"dataVerification"}),h.saveParam("all",a.sheetIndex,a.curDataVerification,{k:"dataVerification"})}function F(a,n,l=!0){e(a,n),clearTimeout(z),i.storeSheetParam();let r=h.luckysheetfile[S(h.currentSheetIndex)].calcChain;if(null!=r&&r.length>0){null==h.config.rowlen&&(h.config.rowlen={}),null==h.config.columnlen&&(h.config.columnlen={});for(let e=0;e<r.length;e++){let a=r[e].r,n=r[e].c;if(r[e].index==h.currentSheetIndex&&null!=h.flowdata[a][n]&&null!=h.flowdata[a][n].spl&&(a in h.config.rowlen||n in h.config.columnlen)){window.luckysheetCurrentRow=a,window.luckysheetCurrentColumn=n,window.luckysheetCurrentFunction=h.flowdata[a][n].f;let e=$.trim(t.functionParserExe(h.flowdata[a][n].f)),l=new Function("return "+e)();h.flowdata[a][n].spl=l,h.saveParam("v",h.currentSheetIndex,h.flowdata[a][n],{r:a,c:n})}}h.luckysheetfile[S(h.currentSheetIndex)].data=h.flowdata}if(o.positionSync(),k(),I(),$(".luckysheet-selection-copy").is(":visible")&&_(),$("#luckysheet-dropCell-icon").is(":visible")&&$("#luckysheet-dropCell-icon").remove(),null!=h.freezenhorizontaldata&&null!=h.freezenverticaldata){let e=h.freezenhorizontaldata[1]-1,t=h.freezenverticaldata[1]-1,a=h.freezenhorizontaldata[2],n=h.freezenverticaldata[2],l=h.visibledatarow[e]-2-a+h.columnHeaderHeight,r=[h.visibledatarow[e],e+1,a,c.cutVolumn(h.visibledatarow,e+1),l],i=h.visibledatacolumn[t]-2-n+h.rowHeaderWidth,o=[h.visibledatacolumn[t],t+1,n,c.cutVolumn(h.visibledatacolumn,t+1),i];c.saveFreezen(r,l,o,i),c.createFreezenHorizontal(r,l),c.createFreezenVertical(o,i),c.createAssistCanvas()}else if(null!=h.freezenhorizontaldata){let e=h.freezenhorizontaldata[1]-1,t=h.freezenhorizontaldata[2],a=h.visibledatarow[e]-2-t+h.columnHeaderHeight,n=[h.visibledatarow[e],e+1,t,c.cutVolumn(h.visibledatarow,e+1),a];c.saveFreezen(n,a,null,null),c.createFreezenHorizontal(n,a),c.createAssistCanvas()}else if(null!=h.freezenverticaldata){let e=h.freezenverticaldata[1]-1,t=h.freezenverticaldata[2],a=h.visibledatacolumn[e]-2-t+h.rowHeaderWidth,n=[h.visibledatacolumn[e],e+1,t,c.cutVolumn(h.visibledatacolumn,e+1),a];c.saveFreezen(null,null,n,a),c.createFreezenVertical(n,a),c.createAssistCanvas()}else $("#luckysheet-filter-options-sheet"+h.currentSheetIndex+" .luckysheet-filter-options").length>0&&$("#luckysheet-filter-options-sheet"+h.currentSheetIndex+" .luckysheet-filter-options").each(function(e,t){let a=$(t).data("str"),n=$(t).data("cindex"),l=h.visibledatacolumn[n]-20,r=a-1==-1?0:h.visibledatarow[a-1];$(t).css({left:l,top:r})});if($("#luckysheet-filter-selected-sheet"+h.currentSheetIndex).length>0){let e=h.luckysheetfile[S(h.currentSheetIndex)].filter_select,t=e.row[0],a=e.row[1],n=e.column[0],l=e.column[1],r=h.visibledatarow[a],c=t-1==-1?0:h.visibledatarow[t-1],i=h.visibledatacolumn[l],o=n-1==-1?0:h.visibledatacolumn[n-1];$("#luckysheet-filter-selected-sheet"+h.currentSheetIndex).css({left:o,width:i-o-1,top:c,height:r-c-1})}i.showSheet(),l&&(z=setTimeout(function(){j()},1))}function j(e,a){if(t.groupValuesRefresh(),null==e&&(e=$("#luckysheet-cell-main").scrollLeft()),null==a&&(a=$("#luckysheet-cell-main").scrollTop()),null!=h.freezenverticaldata||null!=h.freezenhorizontaldata){let t,n,l,r,c,i,o=h.luckysheetTableContentHW[0],d=h.luckysheetTableContentHW[1];null!=h.freezenverticaldata&&null!=h.freezenhorizontaldata?(t=h.freezenhorizontaldata[0],n=h.freezenhorizontaldata[1],l=h.freezenhorizontaldata[2],r=h.freezenverticaldata[0],c=h.freezenverticaldata[1],i=h.freezenverticaldata[2],w(i,l,r,t,1,1,null,null,"freezen_3"),w(e+r-i,l,o-r+i,t,1,1,null,null,"freezen_4"),w(i,a+t-l,r,d-t+l,1,1,null,null,"freezen_7"),w(e+r-i,a+t-l,o-r+i,d-t+l,r-i+h.rowHeaderWidth,t-l+h.columnHeaderHeight),v(i,r,h.rowHeaderWidth),v(e+r-i,o-r+i,r-i+h.rowHeaderWidth),y(l,t,h.columnHeaderHeight),y(a+t-l,d-t+l,t-l+h.columnHeaderHeight)):null!=h.freezenhorizontaldata?(t=h.freezenhorizontaldata[0],n=h.freezenhorizontaldata[1],l=h.freezenhorizontaldata[2],w(e,l,o,t,1,1,null,null,"freezen_h"),w(e,a+t-l,o,d-t+l,null,t-l+h.columnHeaderHeight),v(e,o,null),y(l,t,h.columnHeaderHeight),y(a+t-l,d-t+l,t-l+h.columnHeaderHeight)):null!=h.freezenverticaldata&&(r=h.freezenverticaldata[0],c=h.freezenverticaldata[1],i=h.freezenverticaldata[2],w(i,a,r,d,1,1,null,null,"freezen_v"),w(e+r-i,a,o-r+i,d,r-i+h.rowHeaderWidth,null),y(a,d,null),v(i,r,h.rowHeaderWidth),v(e+r-i,o-r+i,r-i+h.rowHeaderWidth))}else{if(0==$("#luckysheetTableContent").length)return;let t=$("#luckysheetTableContent").get(0).getContext("2d");w(e,a),v(e),y(a),t.clearRect(0,0,h.rowHeaderWidth*h.devicePixelRatio-1,h.columnHeaderHeight*h.devicePixelRatio-1)}}return h.onRefresh=j,h.onRefreshGrid=P,h.onRefreshGridAll=V,h.onRefreshRange=P,h.onRefreshGrid_adRC=b,h.onRefreshGrid_deleteCell=D,h.onRefreshGrid_pastcut=H,h.onRefreshGrid_rhcw=F,{jfrefreshgrid:P,jfrefreshgridall:V,jfrefreshrange:function(e,t,a){clearTimeout(z),h.clearjfundo&&(h.jfundo.length=0,h.jfredo.push({type:"rangechange",data:h.flowdata,curdata:e,range:t,sheetIndex:h.currentSheetIndex,cdformat:$.extend(!0,[],h.luckysheetfile[S(h.currentSheetIndex)].luckysheet_conditionformat_save),curCdformat:a})),h.flowdata=e,h.webWorkerFlowDataCache(h.flowdata),h.luckysheetfile[S(h.currentSheetIndex)].data=h.flowdata,null!=a&&(h.luckysheetfile[S(h.currentSheetIndex)].luckysheet_conditionformat_save=a),C(t,h.currentSheetIndex,e),z=setTimeout(function(){j()},1);for(let e=0;e<t.length;e++)h.historyParam(h.flowdata,h.currentSheetIndex,t[e])},jfrefreshgrid_adRC:b,jfrefreshgrid_deleteCell:D,jfrefreshgrid_pastcut:H,jfrefreshgrid_rhcw:F,luckysheetrefreshgrid:j}});
//# sourceMappingURL=../sourcemaps/controllers/refresh.js.map
