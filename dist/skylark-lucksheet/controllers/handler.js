/**
 * skylark-lucksheet - A version of lucksheet.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["./mobile","./luckysheetConfigsetting","./freezen","./pivotTable","./dropCell","./postil","./imageCtrl","./hyperlinkCtrl","./dataVerificationCtrl","./menuButton","./conditionformat","./alternateformat","./ifFormulaGenerator","./sheetmanage","./server","./updateCell","./sheetSearch","./resize","./sheetMove","./select","./selection","./controlHistory","./splitColumn","../global/cursorPos","./constant","./protection","./cellFormat","../utils/util","../methods/get","../global/location","../global/getRowlen","../global/validate","../global/count","../global/browser","../global/formula","../global/extend","../global/scroll","../global/refresh","../global/getdata","../global/tooltip","../global/editor","../global/format","../global/method","../global/border","../global/draw","../locale/locale","../store","../expendPlugins/chart/plugin"],function(e,t,l,c,o,s,r,a,n,i,u,h,d,m,f,y,g,k,_,p,w,v,b,z,C,R,x,S,M,T,I,H,X,A,L,P,W,F,j,O,B,D,Y,E,q,N,U,V){"use strict";const{luckysheetupdateCell:K}=y,{luckysheet_searcharray:G}=g,{luckysheetMoveHighlightCell:Q}=_,{selectHightlightShow:J,selectIsOverlap:Z,selectionCopyShow:ee,luckysheet_count_show:te,selectHelpboxFill:le}=p,{hideMenuByCancel:ce}=z,{luckysheetdefaultstyle:oe}=C,{checkProtectionLockedRangeList:se,checkProtectionAllSelected:re,checkProtectionSelectLockedOrUnLockedCells:ae,checkProtectionNotEnable:ne,checkProtectionAuthorityNormal:ie}=R,{openCellFormatModel:ue}=x,{replaceHtml:he,getObjType:de,chatatABC:me,ArrayUnique:fe,showrightclickmenu:ye,luckysheetactiveCell:ge,luckysheetContainerFocus:ke,$$:_e}=S,{getSheetIndex:pe,getRangetxt:we}=M,{rowLocation:ve,colLocation:be,mouseposition:$e}=T,{rowlenByRange:ze}=I,{isRealNull:Ce,hasPartMC:Re,isEditMode:xe}=H,{countfunc:Se}=X,{luckysheetextendtable:Me}=P,{jfrefreshgrid:Te,jfrefreshgrid_rhcw:Ie,luckysheetrefreshgrid:He}=F,{getdatabyselection:Xe,datagridgrowth:Ae}=j,{genarate:Le}=D,{getBorderInfoCompute:Pe}=E,{luckysheetDrawMain:We}=q,{createLuckyChart:Fe,hideAllNeedRangeShow:je}=V;return function(){A.detectOS();A.mobilecheck()&&e(),Date.now||(Date.now=function(){return(new Date).getTime()}),function(){for(var e=["webkit","moz"],t=0;t<e.length&&!window.requestAnimationFrame;++t){var l=e[t];window.requestAnimationFrame=window[l+"RequestAnimationFrame"],window.cancelAnimationFrame=window[l+"CancelAnimationFrame"]||window[l+"CancelRequestAnimationFrame"]}if(/iP(ad|hone|od).*OS 6/.test(window.navigator.userAgent)||!window.requestAnimationFrame||!window.cancelAnimationFrame){var c=0;window.requestAnimationFrame=function(e){var t=Date.now(),l=Math.max(c+16,t);return setTimeout(function(){e(c=l)},l-t)},window.cancelAnimationFrame=clearTimeout}}(),$("#luckysheet-sheet-container-c").mousewheel(function(e,t){let l=e.deltaFactor<40?1:e.deltaFactor<80?2:3,c=$(this).scrollLeft();0!=e.deltaY?e.deltaY<0?c+=10*l:c-=10*l:0!=e.deltaX&&(e.deltaX>0?c+=10*l:c-=10*l),$(this).scrollLeft(c),e.preventDefault()}),$("#luckysheet-cell-main").scroll(function(){}).mousewheel(function(e,t){e.preventDefault()});const y=N(),g=y.drag,_=y.info;let p;$("#luckysheet-grid-window-1").mousewheel(function(e,t){let c=$("#luckysheet-scrollbar-x").scrollLeft(),o=$("#luckysheet-scrollbar-y").scrollTop(),s=U.visibledatacolumn,r=U.visibledatarow;null!=l.freezenhorizontaldata&&(r=l.freezenhorizontaldata[3]),null!=l.freezenverticaldata&&(s=l.freezenverticaldata[3]),clearTimeout(p),null!=U.visibledatacolumn_unique?s=U.visibledatacolumn_unique:(s=fe(s),U.visibledatacolumn_unique=s),null!=U.visibledatarow_unique?r=U.visibledatarow_unique:(r=fe(r),U.visibledatarow_unique=r);G(s,c);let a=G(r,o);null!=l.freezenhorizontaldata&&(a=G(r,o+l.freezenhorizontaldata[0]));let n=0,i=e.deltaFactor<40?1:e.deltaFactor<80?2:3;if(0!=e.deltaY){let t,c=Math.round(i/U.zoomRatio);c=c<1?1:c,e.deltaY<0?(t=a+c)>=r.length&&(t=r.length-1):(t=a-c)<0&&(t=0),n=0==t?0:r[t-1],null!=l.freezenhorizontaldata&&(n-=l.freezenhorizontaldata[0]),$("#luckysheet-scrollbar-y").scrollTop(n)}else if(0!=e.deltaX){e.deltaX>0?c+=20*U.zoomRatio:c-=20*U.zoomRatio,$("#luckysheet-scrollbar-x").scrollLeft(c)}p=setTimeout(()=>{U.visibledatacolumn_unique=null,U.visibledatarow_unique=null},500)}),$("#luckysheet-scrollbar-x").scroll(function(){W()}).mousewheel(function(e,t){e.preventDefault()}),$("#luckysheet-scrollbar-y").scroll(function(){W()}).mousewheel(function(e,t){e.preventDefault()}),$(window).resize(function(){document.getElementById(U.container)&&k()}),$("#luckysheet-rich-text-editor").mouseup(function(e){i.inputMenuButtonFocus(e.target)}),$("#luckysheet-cell-main, #luckysheetTableContent").mousedown(function(e){if($(e.target).hasClass("luckysheet-mousedown-cancel"))return;!function(){let e=_e(".luckysheet-multipleRange-show");void 0===e.length&&(e=[e]);e.forEach(e=>{const t=e.id.replace("luckysheet-multipleRange-show-","");null===U.cooperativeEdit.usernameTimeout["user"+t]&&(_e(".username",e).style.display="none")})}(),$("#luckysheet-cell-selected").find(".luckysheet-cs-fillhandle").css("cursor","default").end().find(".luckysheet-cs-draghandle").css("cursor","default"),$("#luckysheet-cell-main, #luckysheetTableContent, #luckysheet-sheettable_0").css("cursor","default"),s.removeActivePs(),($("#luckysheet-modal-dialog-activeImage").is(":visible")||$("#luckysheet-modal-dialog-cropping").is(":visible"))&&r.cancelActiveImgItem();let o=$e(e.pageX,e.pageY);if(o[0]>=U.cellmainWidth-U.cellMainSrollBarSize||o[1]>=U.cellmainHeight-U.cellMainSrollBarSize)return;let y=o[0]+$("#luckysheet-cell-main").scrollLeft(),g=o[1]+$("#luckysheet-cell-main").scrollTop();null!=l.freezenverticaldata&&o[0]<l.freezenverticaldata[0]-l.freezenverticaldata[2]&&(y=o[0]+l.freezenverticaldata[2]),null!=l.freezenhorizontaldata&&o[1]<l.freezenhorizontaldata[0]-l.freezenhorizontaldata[2]&&(g=o[1]+l.freezenhorizontaldata[2]);let k=m.getSheetByIndex(),_=$("#luckysheetTableContent").get(0).getContext("2d"),p=ve(g),w=p[1],v=p[0],b=p[2],z=be(y),C=z[1],R=z[0],x=z[2],S=b,M=x,T=i.mergeborer(U.flowdata,b,x);if(T&&(w=T.row[1],v=T.row[0],b=T.row[2],S=T.row[3],C=T.column[1],R=T.column[0],x=T.column[2],M=T.column[3]),!Y.createHookFunction("cellMousedownBefore",U.flowdata[b][x],{r:b,c:x,start_r:v,start_c:R,end_r:w,end_c:C},k,_))return;if(n.cellFocus(b,x,!0),R<$("#luckysheet-cell-main").scrollLeft()&&$("#luckysheet-scrollbar-x").scrollLeft(R),v<$("#luckysheet-cell-main").scrollTop()&&$("#luckysheet-scrollbar-y").scrollTop(v),"3"==e.which){$("#luckysheet-dataVerification-showHintBox").hide();let e=!1;for(let t=0;t<U.luckysheet_select_save.length;t++)if(null!=U.luckysheet_select_save[t].row&&b>=U.luckysheet_select_save[t].row[0]&&b<=U.luckysheet_select_save[t].row[1]&&x>=U.luckysheet_select_save[t].column[0]&&x<=U.luckysheet_select_save[t].column[1]){e=!0;break}if(e)return}if(null!=U.flowdata[b]&&null!=U.flowdata[b][x]&&null!=U.flowdata[b][x].dd&&null!=t.fireMousedown&&"function"==de(t.fireMousedown))return void t.fireMousedown(U.flowdata[b][x].dd);if(a.hyperlink&&a.hyperlink[b+"_"+x]&&"3"!=e.which)return void a.cellFocus(b,x);U.luckysheet_scroll_status=!0;let I=$("#luckysheet-input-box");if(parseInt(I.css("top"))>0){if(L.rangestart||L.rangedrag_column_start||L.rangedrag_row_start||L.israngeseleciton()){let t=[b,S],l=[x,M],c=R,o=C-R-1,s=v,r=w-v-1;if(e.shiftKey){let e=L.func_selectedrange,t=0,l=0,c=[];e.top>v?(t=v,l=e.top+e.height-v,e.row[1]>e.row_focus&&(e.row[1]=e.row_focus),c=[b,e.row[1]]):e.top==v?(t=v,l=e.top+e.height-v,c=[b,e.row[0]]):(t=e.top,l=w-e.top-1,e.row[0]<e.row_focus&&(e.row[0]=e.row_focus),c=[e.row[0],b]);let o=0,s=0,r=[];e.left>R?(o=R,s=e.left+e.width-R,e.column[1]>e.column_focus&&(e.column[1]=e.column_focus),r=[x,e.column[1]]):e.left==R?(o=R,s=e.left+e.width-R,r=[x,e.column[0]]):(o=e.left,s=C-e.left-1,e.column[0]<e.column_focus&&(e.column[0]=e.column_focus),r=[e.column[0],x]);let a=i.mergeMoveMain(r,c,e,t,l,o,s);null!=a&&(r=a[0],c=a[1],t=a[2],l=a[3],o=a[4],s=a[5]),te(o,t,s,l,c,r),e.row=c,e.column=r,e.left_move=o,e.width_move=s,e.top_move=t,e.height_move=l,L.func_selectedrange=e}else if(e.ctrlKey&&","!=$("#luckysheet-rich-text-editor").find("span").last().text()){let e=$("#luckysheet-rich-text-editor").text();if(e.length>0){let t=e.substr(e.length-1,1);","!=t&&"="!=t&&"("!=t&&(e+=",")}if(e.length>0&&"="==e.substr(0,1)){if(e=L.functionHTMLGenerate(e),window.getSelection){let e=window.getSelection();L.functionRangeIndex=[$(e.anchorNode).parent().index(),e.anchorOffset]}else{let e=document.selection.createRange();L.functionRangeIndex=e}$("#luckysheet-rich-text-editor").html(e),L.canceFunctionrangeSelected(),L.createRangeHightlight()}L.rangestart=!1,L.rangedrag_column_start=!1,L.rangedrag_row_start=!1,$("#luckysheet-functionbox-cell").html(e),L.rangeHightlightselected($("#luckysheet-rich-text-editor")),L.israngeseleciton(),L.func_selectedrange={left:c,width:o,top:s,height:r,left_move:c,width_move:o,top_move:s,height_move:r,row:t,column:l,row_focus:b,column_focus:x}}else L.func_selectedrange={left:c,width:o,top:s,height:r,left_move:c,width_move:o,top_move:s,height_move:r,row:t,column:l,row_focus:b,column_focus:x};return L.rangeSetValue({row:t,column:l}),L.rangestart=!0,L.rangedrag_column_start=!1,L.rangedrag_row_start=!1,$("#luckysheet-formula-functionrange-select").css({left:c,width:o,top:s,height:r}).show(),$("#luckysheet-formula-help-c").hide(),te(c,s,o,r,t,l),void setTimeout(function(){let e,t=window.getSelection().anchorNode;$("#luckysheet-search-formula-parm").is(":visible")||$("#luckysheet-search-formula-parm-select").is(":visible")?(e=$("#luckysheet-rich-text-editor"),L.rangechangeindex=L.data_parm_index):e=$(t).closest("div");let l=e.find("span[rangeindex='"+L.rangechangeindex+"']");L.setCaretPosition(l.get(0),0,l.html().length)},1)}L.updatecell(U.luckysheetCellUpdate[0],U.luckysheetCellUpdate[1]),U.luckysheet_select_status=!0,$("#luckysheet-info").is(":visible")&&(U.luckysheet_select_status=!1)}else ae(b,x,U.currentSheetIndex)&&(U.luckysheet_select_status=!0);if($("#luckysheet-multiRange-dialog").is(":visible")){if(u.selectStatus=!0,U.luckysheet_select_status=!1,e.shiftKey){let e=u.selectRange[u.selectRange.length-1],t=0,l=0,c=[];e.top>v?(t=v,l=e.top+e.height-v,e.row[1]>e.row_focus&&(e.row[1]=e.row_focus),c=[b,e.row[1]]):e.top==v?(t=v,l=e.top+e.height-v,c=[b,e.row[0]]):(t=e.top,l=w-e.top-1,e.row[0]<e.row_focus&&(e.row[0]=e.row_focus),c=[e.row[0],b]);let o=0,s=0,r=[];e.left>R?(o=R,s=e.left+e.width-R,e.column[1]>e.column_focus&&(e.column[1]=e.column_focus),r=[x,e.column[1]]):e.left==R?(o=R,s=e.left+e.width-R,r=[x,e.column[0]]):(o=e.left,s=C-e.left-1,e.column[0]<e.column_focus&&(e.column[0]=e.column_focus),r=[e.column[0],x]);let a=i.mergeMoveMain(r,c,e,t,l,o,s);null!=a&&(r=a[0],c=a[1],t=a[2],l=a[3],o=a[4],s=a[5]),e.row=c,e.column=r,e.left_move=o,e.width_move=s,e.top_move=t,e.height_move=l,u.selectRange[u.selectRange.length-1]=e}else e.ctrlKey?u.selectRange.push({left:R,width:C-R-1,top:v,height:w-v-1,left_move:R,width_move:C-R-1,top_move:v,height_move:w-v-1,row:[b,S],column:[x,M],row_focus:b,column_focus:x}):(u.selectRange=[],u.selectRange.push({left:R,width:C-R-1,top:v,height:w-v-1,left_move:R,width_move:C-R-1,top_move:v,height_move:w-v-1,row:[b,S],column:[x,M],row_focus:b,column_focus:x}));ee(u.selectRange);let t=u.getTxtByRange(u.selectRange);$("#luckysheet-multiRange-dialog input").val(t)}else if(u.selectStatus=!1,u.selectRange=[],$("#luckysheet-singleRange-dialog").is(":visible")){U.luckysheet_select_status=!1,ee([{row:[b,b],column:[x,x]}]);let e=we(U.currentSheetIndex,{row:[b,b],column:[x,x]},U.currentSheetIndex);$("#luckysheet-singleRange-dialog input").val(e)}else{if($("#luckysheet-dataVerificationRange-dialog").is(":visible")){if(n.selectStatus=!0,U.luckysheet_select_status=!1,e.shiftKey){let e=n.selectRange[n.selectRange.length-1],t=0,l=0,c=[];e.top>v?(t=v,l=e.top+e.height-v,e.row[1]>e.row_focus&&(e.row[1]=e.row_focus),c=[b,e.row[1]]):e.top==v?(t=v,l=e.top+e.height-v,c=[b,e.row[0]]):(t=e.top,l=w-e.top-1,e.row[0]<e.row_focus&&(e.row[0]=e.row_focus),c=[e.row[0],b]);let o=0,s=0,r=[];e.left>R?(o=R,s=e.left+e.width-R,e.column[1]>e.column_focus&&(e.column[1]=e.column_focus),r=[x,e.column[1]]):e.left==R?(o=R,s=e.left+e.width-R,r=[x,e.column[0]]):(o=e.left,s=C-e.left-1,e.column[0]<e.column_focus&&(e.column[0]=e.column_focus),r=[e.column[0],x]);let a=i.mergeMoveMain(r,c,e,t,l,o,s);null!=a&&(r=a[0],c=a[1],t=a[2],l=a[3],o=a[4],s=a[5]),e.row=c,e.column=r,e.left_move=o,e.width_move=s,e.top_move=t,e.height_move=l,n.selectRange[n.selectRange.length-1]=e}else n.selectRange=[],n.selectRange.push({left:R,width:C-R-1,top:v,height:w-v-1,left_move:R,width_move:C-R-1,top_move:v,height_move:w-v-1,row:[b,S],column:[x,M],row_focus:b,column_focus:x});ee(n.selectRange);let t=n.getTxtByRange(n.selectRange);return L.rangetosheet!=U.currentSheetIndex&&(t=U.luckysheetfile[pe(U.currentSheetIndex)].name+"!"+t),void $("#luckysheet-dataVerificationRange-dialog input").val(t)}if(n.selectStatus=!1,n.selectRange=[],d.singleRangeFocus&&$("#luckysheet-ifFormulaGenerator-dialog .singRange").click(),$("#luckysheet-ifFormulaGenerator-singleRange-dialog").is(":visible")){U.luckysheet_select_status=!1,L.rangestart=!1,$("#luckysheet-formula-functionrange-select").css({left:R,width:C-R-1,top:v,height:w-v-1}).show(),$("#luckysheet-formula-help-c").hide();let e=we(U.currentSheetIndex,{row:[b,b],column:[x,x]},U.currentSheetIndex);$("#luckysheet-ifFormulaGenerator-singleRange-dialog input").val(e)}else{if($("#luckysheet-ifFormulaGenerator-multiRange-dialog").is(":visible")){U.luckysheet_select_status=!1,L.func_selectedrange={left:R,width:C-R-1,top:v,height:w-v-1,left_move:R,width_move:C-R-1,top_move:v,height_move:w-v-1,row:[b,b],column:[x,x],row_focus:b,column_focus:x},L.rangestart=!0,$("#luckysheet-formula-functionrange-select").css({left:R,width:C-R-1,top:v,height:w-v-1}).show(),$("#luckysheet-formula-help-c").hide();let e=we(U.currentSheetIndex,{row:[b,b],column:[x,x]},U.currentSheetIndex);return $("#luckysheet-ifFormulaGenerator-multiRange-dialog input").val(e),$("#luckysheet-row-count-show").hide(),void $("#luckysheet-column-count-show").hide()}if(U.luckysheet_select_status){if(e.shiftKey){let e=$.extend(!0,{},U.luckysheet_select_save[U.luckysheet_select_save.length-1]),t=0,l=0,o=[];e.top>v?(t=v,l=e.top+e.height-v,e.row[1]>e.row_focus&&(e.row[1]=e.row_focus),o=[b,e.row[1]]):e.top==v?(t=v,l=e.top+e.height-v,o=[b,e.row[0]]):(t=e.top,l=w-e.top-1,e.row[0]<e.row_focus&&(e.row[0]=e.row_focus),o=[e.row[0],b]);let s=0,r=0,a=[];e.left>R?(s=R,r=e.left+e.width-R,e.column[1]>e.column_focus&&(e.column[1]=e.column_focus),a=[x,e.column[1]]):e.left==R?(s=R,r=e.left+e.width-R,a=[x,e.column[0]]):(s=e.left,r=C-e.left-1,e.column[0]<e.column_focus&&(e.column[0]=e.column_focus),a=[e.column[0],x]);let n=i.mergeMoveMain(a,o,e,t,l,s,r);null!=n&&(a=n[0],o=n[1],t=n[2],l=n[3],s=n[4],r=n[5]),e.row=o,e.column=a,e.left_move=s,e.width_move=r,e.top_move=t,e.height_move=l,U.luckysheet_select_save[U.luckysheet_select_save.length-1]=e,$("#luckysheet-alternateformat-rangeDialog").is(":visible")&&$("#luckysheet-alternateformat-rangeDialog input").val(we(U.currentSheetIndex,U.luckysheet_select_save)),c.luckysheet_pivotTable_select_state&&$("#luckysheet-pivotTable-range-selection-input").val(U.luckysheetfile[pe(U.currentSheetIndex)].name+"!"+me(U.luckysheet_select_save[0].column[0])+(U.luckysheet_select_save[0].row[0]+1)+":"+me(U.luckysheet_select_save[0].column[1])+(U.luckysheet_select_save[0].row[1]+1))}else e.ctrlKey?U.luckysheet_select_save.push({left:R,width:C-R-1,top:v,height:w-v-1,left_move:R,width_move:C-R-1,top_move:v,height_move:w-v-1,row:[b,S],column:[x,M],row_focus:b,column_focus:x}):(U.luckysheet_select_save.length=0,U.luckysheet_select_save.push({left:R,width:C-R-1,top:v,height:w-v-1,left_move:R,width_move:C-R-1,top_move:v,height_move:w-v-1,row:[b,S],column:[x,M],row_focus:b,column_focus:x}),i.menuButtonFocus(U.flowdata,b,x),L.fucntionboxshow(b,x));J(),null==l.freezenhorizontaldata&&null==l.freezenverticaldata||l.scrollAdaptOfselect(),A.mobilecheck()||ge(),f.saveParam("mv",U.currentSheetIndex,U.luckysheet_select_save)}h.rangefocus&&(h.rangefocus=!1,$("#luckysheet-alternateformat-range .fa-table").click()),$("#luckysheet-row-count-show, #luckysheet-column-count-show").hide(),xe()||je(),c.pivotclick(b,x,U.currentSheetIndex),ke(),Y.createHookFunction("cellMousedown",U.flowdata[b][x],{r:b,c:x,start_r:v,start_c:R,end_r:w,end_c:C},k,_)}}}).mouseup(function(e){if("3"==e.which){if(!U.allowEdit)return;if(xe())return;let l=e.pageX,c=e.pageY,o=(U.flowdata,U.luckysheet_select_save[0]);const s=t.cellRightClickConfig;if($("#luckysheet-cols-rows-data").show(),$("#luckysheet-cols-rows-handleincell").show(),$("#luckysheet-cols-rows-add, #luckysheet-cols-rows-shift").hide(),_e("#luckysheet-cols-rows-data .luckysheet-menuseparator").style.display="block",_e("#luckysheet-cols-rows-handleincell .luckysheet-menuseparator").style.display="block",null!=o.row&&0==o.row[0]&&o.row[1]==U.flowdata.length-1){if(!(s.copy||s.copyAs||s.paste||s.insertColumn||s.deleteColumn||s.hideColumn||s.columnWidth||s.clear||s.matrix||s.sort||s.filter||s.chart||s.image||s.link||s.data||s.cellFormat))return;U.luckysheetRightHeadClickIs="column",$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-word").text(N().rightclick.column),$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-size").text(N().rightclick.width),$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-left").text(N().rightclick.left),$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-right").text(N().rightclick.right),$("#luckysheet-cols-rows-add").show(),$("#luckysheet-cols-rows-shift").hide(),$("#luckysheet-cols-rows-handleincell").hide(),U.luckysheet_cols_menu_status=!0,_e("#luckysheet-cols-rows-add .luckysheet-menuseparator").style.display="block",_e("#luckysheet-top-left-add-selected").style.display=s.insertColumn?"block":"none",_e("#luckysheet-bottom-right-add-selected").style.display=s.insertColumn?"block":"none",_e("#luckysheet-del-selected").style.display=s.deleteColumn?"block":"none",_e("#luckysheet-hide-selected").style.display=s.hideColumn?"block":"none",_e("#luckysheet-show-selected").style.display=s.hideColumn?"block":"none",_e("#luckysheet-column-row-width-selected").style.display=s.columnWidth?"block":"none",s.copy||s.copyAs||s.paste||(_e("#luckysheet-cols-rows-add .luckysheet-menuseparator").style.display="none",s.insertColumn||s.deleteColumn||s.hideColumn||s.columnWidth||(_e("#luckysheet-cols-rows-data .luckysheet-menuseparator").style.display="none")),s.insertColumn||s.deleteColumn||s.hideColumn||s.columnWidth||(_e("#luckysheet-cols-rows-add .luckysheet-menuseparator").style.display="none");let e=$.extend(!0,{},U.config);null==e.columnlen&&(e.columnlen={});let t=null==e.columnlen[U.luckysheet_select_save[0].column[0]]?U.defaultcollen:e.columnlen[U.luckysheet_select_save[0].column[0]],l=!0;for(let c=0;c<U.luckysheet_select_save.length;c++){let o=U.luckysheet_select_save[c],s=o.column[0],r=o.column[1];for(let c=s;c<=r;c++){if((null==e.columnlen[c]?U.defaultcollen:e.columnlen[c])!=t){l=!1;break}}}l?$("#luckysheet-cols-rows-add").find("input[type='number'].rcsize").val(t):$("#luckysheet-cols-rows-add").find("input[type='number'].rcsize").val("")}else if(null!=o.column&&0==o.column[0]&&o.column[1]==U.flowdata[0].length-1){if(!(s.copy||s.copyAs||s.paste||s.insertRow||s.deleteRow||s.hideRow||s.rowHeight||s.clear||s.matrix||s.sort||s.filter||s.chart||s.image||s.link||s.data||s.cellFormat))return;U.luckysheetRightHeadClickIs="row",$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-word").text(N().rightclick.row),$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-size").text(N().rightclick.height),$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-left").text(N().rightclick.top),$("#luckysheet-rightclick-menu .luckysheet-cols-rows-shift-right").text(N().rightclick.bottom),$("#luckysheet-cols-rows-add").show(),$("#luckysheet-cols-rows-shift").hide(),$("#luckysheet-cols-rows-handleincell").hide(),U.luckysheet_cols_menu_status=!0,_e("#luckysheet-cols-rows-add .luckysheet-menuseparator").style.display="block",_e("#luckysheet-top-left-add-selected").style.display=s.insertRow?"block":"none",_e("#luckysheet-bottom-right-add-selected").style.display=s.insertRow?"block":"none",_e("#luckysheet-del-selected").style.display=s.deleteRow?"block":"none",_e("#luckysheet-hide-selected").style.display=s.hideRow?"block":"none",_e("#luckysheet-show-selected").style.display=s.hideRow?"block":"none",_e("#luckysheet-column-row-width-selected").style.display=s.rowHeight?"block":"none",s.copy||s.copyAs||s.paste||(_e("#luckysheet-cols-rows-add .luckysheet-menuseparator").style.display="none",s.insertRow||s.deleteRow||s.hideRow||s.rowHeight||(_e("#luckysheet-cols-rows-data .luckysheet-menuseparator").style.display="none")),s.insertRow||s.deleteRow||s.hideRow||s.rowHeight||(_e("#luckysheet-cols-rows-add .luckysheet-menuseparator").style.display="none");let e=$.extend(!0,{},U.config);null==e.rowlen&&(e.rowlen={});let t=null==e.rowlen[U.luckysheet_select_save[0].row[0]]?U.defaultrowlen:e.rowlen[U.luckysheet_select_save[0].row[0]],l=!0;for(let c=0;c<U.luckysheet_select_save.length;c++){let o=U.luckysheet_select_save[c],s=o.row[0],r=o.row[1];for(let c=s;c<=r;c++){if((null==e.rowlen[c]?U.defaultrowlen:e.rowlen[c])!=t){l=!1;break}}}l?$("#luckysheet-cols-rows-add").find("input[type='number'].rcsize").val(t):$("#luckysheet-cols-rows-add").find("input[type='number'].rcsize").val("")}else{if(!(s.copy||s.copyAs||s.paste||s.insertRow||s.insertColumn||s.deleteRow||s.deleteColumn||s.deleteCell||s.clear||s.matrix||s.sort||s.filter||s.chart||s.image||s.link||s.data||s.cellFormat))return;s.copy||s.copyAs||s.paste||(_e("#luckysheet-cols-rows-handleincell .luckysheet-menuseparator").style.display="none",s.insertRow||s.insertColumn||s.deleteRow||s.deleteColumn||s.deleteCell||(_e("#luckysheet-cols-rows-data .luckysheet-menuseparator").style.display="none")),s.insertRow||s.insertColumn||s.deleteRow||s.deleteColumn||s.deleteCell||(_e("#luckysheet-cols-rows-handleincell .luckysheet-menuseparator").style.display="none")}s.clear||s.matrix||s.sort||s.filter||s.chart||s.image||s.link||s.data||s.cellFormat||(_e("#luckysheet-cols-rows-data .luckysheet-menuseparator").style.display="none"),ye($("#luckysheet-rightclick-menu"),l,c)}f.saveParam("mv",U.currentSheetIndex,U.luckysheet_select_save)}).dblclick(function(e){if($(e.target).hasClass("luckysheet-mousedown-cancel"))return;if(!U.allowEdit)return;if(parseInt($("#luckysheet-input-box").css("top"))>0)return;let t=$e(e.pageX,e.pageY);if(t[0]>=U.cellmainWidth-U.cellMainSrollBarSize||t[1]>=U.cellmainHeight-U.cellMainSrollBarSize)return;let o=$("#luckysheet-cell-main").scrollLeft(),s=$("#luckysheet-cell-main").scrollTop(),r=t[0]+o,a=t[1]+s;null!=l.freezenverticaldata&&t[0]<l.freezenverticaldata[0]-l.freezenverticaldata[2]&&(r=t[0]+l.freezenverticaldata[2]),null!=l.freezenhorizontaldata&&t[1]<l.freezenhorizontaldata[0]-l.freezenhorizontaldata[2]&&(a=t[1]+l.freezenhorizontaldata[2]);let n=ve(a)[2],u=be(r)[2],h=i.mergeborer(U.flowdata,n,u);if(h&&(n=h.row[2],u=h.column[2]),c.isPivotRange(n,u)){if(!(null!=c.filter&&0!=c.filter.length||null!=c.row&&0!=c.row.length||null!=c.column&&0!=c.column.length||null!=c.values&&0!=c.values.length))return;if(null==c.values||0==c.values.length)return;if(0==n||0==u)return;if(null!=c.column&&c.column.length>0)if(c.values.length>=2&&"column"==c.showType){if(n<=c.column.length||u>=c.pivotDatas[0].length-c.values.length)return}else if(n<=c.column.length-1||u>=c.pivotDatas[0].length-1)return;if(null!=c.row&&c.row.length>0)if(c.values.length>=2&&"row"==c.showType){if(u<=c.row.length||n>=c.pivotDatas.length-c.values.length)return}else if(u<=c.row.length-1||n>=c.pivotDatas.length-1)return;return m.addNewSheet(e),void c.drillDown(n,u)}if($("#luckysheet-search-formula-parm").is(":visible")||$("#luckysheet-search-formula-parm-select").is(":visible"))$("#luckysheet-cell-selected").hide();else{if($("#luckysheet-conditionformat-dialog").is(":visible")||$("#luckysheet-administerRule-dialog").is(":visible")||$("#luckysheet-newConditionRule-dialog").is(":visible")||$("#luckysheet-editorConditionRule-dialog").is(":visible")||$("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible"))return;if($("#luckysheet-modal-dialog-slider-alternateformat").is(":visible")||$("#luckysheet-alternateformat-rangeDialog").is(":visible"))return;{i.luckysheetPaintModelOn&&i.cancelPaintModel();let e=U.luckysheet_select_save[0].column_focus,t=U.luckysheet_select_save[0].row_focus;e===u&&t===n||(n=t,u=e),K(n,u,U.flowdata),J()}}}),document.getElementById("luckysheet-cell-main").addEventListener("drop",function(e){e.preventDefault(),e.stopPropagation();let l=e.dataTransfer.files;if(1==l.length&&l[0].type.indexOf("image")>-1){if(!ie(U.currentSheetIndex,"editObjects"))return;let e=new FileReader;e.readAsDataURL(l[0]),e.onload=function(e){let t=e.target.result;r.inserImg(t)}}!function(e){if(t&&t.hook&&t.hook.cellDragStop){let t=$e(e.pageX,e.pageY),l=t[0]+$("#luckysheet-cell-main").scrollLeft(),c=t[1]+$("#luckysheet-cell-main").scrollTop(),o=ve(c),s=o[1],r=o[0],a=o[2],n=be(l),u=n[1],h=n[0],d=n[2],f=i.mergeborer(U.flowdata,a,d);f&&(s=f.row[1],r=f.row[0],a=f.row[2],u=f.column[1],h=f.column[0],d=f.column[2]);let y=m.getSheetByIndex(),g=$("#luckysheetTableContent").get(0).getContext("2d");Y.createHookFunction("cellDragStop",U.flowdata[a][d],{r:a,c:d,start_r:r,start_c:h,end_r:s,end_c:u},y,g,e)}}(e)},!1),document.getElementById("luckysheet-cell-main").addEventListener("dragover",function(e){e.preventDefault(),e.stopPropagation()},!1),$(document).on("mousemove.luckysheetEvent",function(e){if(s.overshow(e),a.overshow(e),window.cancelAnimationFrame(U.jfautoscrollTimeout),t&&t.hook&&t.hook.sheetMousemove){let t=$e(e.pageX,e.pageY),o=t[0]+$("#luckysheet-cell-main").scrollLeft(),s=t[1]+$("#luckysheet-cell-main").scrollTop(),r=ve(s),a=r[1],n=r[0],u=r[2],h=be(o),d=h[1],f=h[0],y=h[2],g=i.mergeborer(U.flowdata,u,y);g&&(a=g.row[1],n=g.row[0],u=g.row[2],d=g.column[1],f=g.column[0],y=g.column[2]);let k=m.getSheetByIndex(),_={functionResizeStatus:L.functionResizeStatus,horizontalmoveState:!!l.horizontalmovestate,verticalmoveState:!!l.verticalmovestate,pivotTableMoveState:!!c&&c.movestate,sheetMoveStatus:U.luckysheet_sheet_move_status,scrollStatus:!!U.luckysheet_scroll_status,selectStatus:!!U.luckysheet_select_status,rowsSelectedStatus:!!U.luckysheet_rows_selected_status,colsSelectedStatus:!!U.luckysheet_cols_selected_status,cellSelectedMove:!!U.luckysheet_cell_selected_move,cellSelectedExtend:!!U.luckysheet_cell_selected_extend,colsChangeSize:!!U.luckysheet_cols_change_size,rowsChangeSize:!!U.luckysheet_rows_change_size,chartMove:!!U.chartparam.luckysheetCurrentChartMove,chartResize:!!U.chartparam.luckysheetCurrentChartResize,rangeResize:!!L.rangeResize,rangeMove:!!L.rangeMove},p=$("#luckysheetTableContent").get(0).getContext("2d");U.flowdata&&U.flowdata[u]&&Y.createHookFunction("sheetMousemove",U.flowdata[u][y],{r:u,c:y,start_r:n,start_c:f,end_r:a,end_c:d},k,_,p)}if(L.functionResizeStatus){let t=e.pageY-L.functionResizeData.y,l=L.functionResizeData.calculatebarHeight+t,c=Math.round($(window).height()/2);if(l<=28){if(l<=20)return;l=28}else if(l>=c){if(l>=c+8)return;l=c}U.calculatebarHeight=l,$("#luckysheet-wa-calculate").css("height",U.calculatebarHeight-2),$("#luckysheet-wa-calculate-size").css({background:"#5e5e5e",cursor:"ns-resize"}),clearTimeout(L.functionResizeTimeout),L.functionResizeTimeout=setTimeout(function(){k()},15)}else if(l.horizontalmovestate){let t=$e(e.pageX,e.pageY),c=$("#luckysheet-cell-main").scrollLeft(),o=$("#luckysheet-cell-main").scrollTop(),s=(t[0],t[1]+o),r=ve(s),a=r[1],n=r[0],i=r[2],u=t[1]+U.columnHeaderHeight;u<U.columnHeaderHeight&&(u=U.columnHeaderHeight),u>l.windowHeight-4&&(u=l.windowHeight-4),$("#luckysheet-freezebar-horizontal").find(".luckysheet-freezebar-horizontal-handle").css({top:u}),u+o-U.columnHeaderHeight>=n+(a-n)/2?(u=a-2-o+U.columnHeaderHeight,l.freezenhorizontaldata=[a,i+1,o,l.cutVolumn(U.visibledatarow,i+1),u]):(u=n-2-o+U.columnHeaderHeight,l.freezenhorizontaldata=[n,i,o,l.cutVolumn(U.visibledatarow,i),u]),$("#luckysheet-freezebar-horizontal").find(".luckysheet-freezebar-horizontal-drop").css({top:u}),l.saveFreezen(l.freezenhorizontaldata,u,null,null)}else if(l.verticalmovestate){let t=$e(e.pageX,e.pageY),c=$("#luckysheet-cell-main").scrollLeft(),o=$("#luckysheet-cell-main").scrollTop(),s=t[0]+c,r=(t[1],be(s)),a=r[1],n=r[0],i=r[2],u=t[0]+U.rowHeaderWidth;u<U.rowHeaderWidth&&(u=U.rowHeaderWidth),u>l.windowWidth-4&&(u=l.windowWidth-4),$("#luckysheet-freezebar-vertical").find(".luckysheet-freezebar-vertical-handle").css({left:u}),u+c-U.rowHeaderWidth>=n+(a-n)/2?(u=a-2-c+U.rowHeaderWidth,l.freezenverticaldata=[a,i+1,c,l.cutVolumn(U.visibledatacolumn,i+1),u]):(u=n-2-c+U.rowHeaderWidth,l.freezenverticaldata=[n,i,c,l.cutVolumn(U.visibledatacolumn,i),u]),$("#luckysheet-freezebar-vertical").find(".luckysheet-freezebar-vertical-drop").css({left:u}),l.saveFreezen(null,null,l.freezenverticaldata,u),k()}else if(c&&c.movestate){let t=e.pageX,l=e.pageY;$("#luckysheet-modal-dialog-slider-pivot-move").css({left:t-c.movesave.width/2,top:l-c.movesave.height})}else if(U.luckysheet_sheet_move_status){let t=$("#luckysheet-sheet-container-c").scrollLeft(),l=e.pageX+t;if(Math.abs(e.pageX-U.luckysheet_sheet_move_data.pageX)<3)return;let c=$("#luckysheet-sheet-container").width(),o=l-U.luckysheet_sheet_move_data.curleft-$("#luckysheet-sheet-container").offset().left;U.luckysheet_sheet_move_data.activeobject.css({left:o});let s=G(U.luckysheet_sheet_move_data.widthlist,o+U.luckysheet_sheet_move_data.curleft);U.luckysheet_sheet_move_data.cursorobject.css({cursor:"move"}),o-t<=6&&$("#luckysheet-sheets-leftscroll").click(),o-t>=c-40&&$("#luckysheet-sheets-rightscroll").click(),s!=U.luckysheet_sheet_move_data.curindex&&(-1==s&&o>0?(s=U.luckysheet_sheet_move_data.widthlist.length-1,$("#luckysheet-sheets-item-clone").insertAfter($("#luckysheet-sheet-area div.luckysheet-sheets-item:visible").eq(s))):-1==s&&o<=0?$("#luckysheet-sheets-item-clone").insertBefore($("#luckysheet-sheet-area div.luckysheet-sheets-item:visible").eq(0)):$("#luckysheet-sheets-item-clone").insertAfter($("#luckysheet-sheet-area div.luckysheet-sheets-item:visible").eq(s)),U.luckysheet_sheet_move_data.widthlist=[],$("#luckysheet-sheet-area div.luckysheet-sheets-item:visible").each(function(e){0==e?U.luckysheet_sheet_move_data.widthlist.push(parseInt($(this).outerWidth())):U.luckysheet_sheet_move_data.widthlist.push(parseInt($(this).outerWidth())+U.luckysheet_sheet_move_data.widthlist[e-1])}),U.luckysheet_sheet_move_data.curindex=$("#luckysheet-sheet-area div.luckysheet-sheets-item:visible").index($("#luckysheet-sheets-item-clone")))}else if(U.luckysheet_model_move_state){let t=$(document).scrollTop(),l=$(document).scrollLeft(),c=e.pageY+t,o=e.pageX+l,s=$(window).height(),r=$(window).width(),a=U.luckysheet_model_move_obj.height(),n=U.luckysheet_model_move_obj.width(),i=c-U.luckysheet_model_xy[1],u=o-U.luckysheet_model_xy[0];i<0&&(i=0),i+a+62>s&&(i=s-a-62),u<0&&(u=0),u+n+86>r&&(u=r-n-86),U.luckysheet_model_move_obj.css({top:i,left:u}),e.preventDefault()}else if(U.luckysheet_scroll_status||U.luckysheet_select_status||U.luckysheet_rows_selected_status||U.luckysheet_cols_selected_status||U.luckysheet_cell_selected_move||U.luckysheet_cell_selected_extend||U.luckysheet_cols_change_size||U.luckysheet_rows_change_size||U.chartparam.luckysheetCurrentChartMove||U.chartparam.luckysheetCurrentChartResize||L.rangeResize||L.rangeMove){U.luckysheet_select_status&&(clearTimeout(U.countfuncTimeout),U.countfuncTimeout=setTimeout(function(){Se()},500)),U.jfautoscrollTimeout=window.requestAnimationFrame(function t(){if(U.luckysheet_scroll_status&&!U.luckysheet_cols_change_size&&!U.luckysheet_rows_change_size){let t=$e(e.pageX,e.pageY),l=$("#luckysheet-scrollbar-x").scrollLeft(),c=$("#luckysheet-scrollbar-y").scrollTop(),o=t[0],s=t[1],r=$("#luckysheet-cell-main").height()-20*U.zoomRatio,a=$("#luckysheet-cell-main").width()-60*U.zoomRatio;if(s<0||s>r){let e;e=s<0?c+s/2:c+(s-r)/2,$("#luckysheet-scrollbar-y").scrollTop(e)}if(o<0||o>a){let e;e=o<0?l+o/2:l+(o-a)/2,$("#luckysheet-scrollbar-x").scrollLeft(e)}}if(U.luckysheet_select_status){let t=$e(e.pageX,e.pageY),o=t[0]+$("#luckysheet-cell-main").scrollLeft(),s=t[1]+$("#luckysheet-cell-main").scrollTop(),r=ve(s),a=r[1],n=r[0],u=r[2],h=be(o),d=h[1],m=h[0],f=h[2];if(!ae(u,f,U.currentSheetIndex))return;let y=$.extend(!0,{},U.luckysheet_select_save[U.luckysheet_select_save.length-1]),g=0,k=0,_=[];y.top>n?(g=n,k=y.top+y.height-n,y.row[1]>y.row_focus&&(y.row[1]=y.row_focus),_=[u,y.row[1]]):y.top==n?(g=n,k=y.top+y.height-n,_=[u,y.row[0]]):(g=y.top,k=a-y.top-1,y.row[0]<y.row_focus&&(y.row[0]=y.row_focus),_=[y.row[0],u]);let p=0,w=0,v=[];y.left>m?(p=m,w=y.left+y.width-m,y.column[1]>y.column_focus&&(y.column[1]=y.column_focus),v=[f,y.column[1]]):y.left==m?(p=m,w=y.left+y.width-m,v=[f,y.column[0]]):(p=y.left,w=d-y.left-1,y.column[0]<y.column_focus&&(y.column[0]=y.column_focus),v=[y.column[0],f]);let b=i.mergeMoveMain(v,_,y,g,k,p,w);null!=b&&(v=b[0],_=b[1],g=b[2],k=b[3],p=b[4],w=b[5]),y.row=_,y.column=v,y.left_move=p,y.width_move=w,y.top_move=g,y.height_move=k,U.luckysheet_select_save[U.luckysheet_select_save.length-1]=y,J(),l.scrollFreezen(),$("#luckysheet-alternateformat-rangeDialog").is(":visible")&&$("#luckysheet-alternateformat-rangeDialog input").val(we(U.currentSheetIndex,U.luckysheet_select_save[U.luckysheet_select_save.length-1])),c.luckysheet_pivotTable_select_state&&$("#luckysheet-pivotTable-range-selection-input").val(U.luckysheetfile[pe(U.currentSheetIndex)].name+"!"+me(U.luckysheet_select_save[0].column[0])+(U.luckysheet_select_save[0].row[0]+1)+":"+me(U.luckysheet_select_save[0].column[1])+(U.luckysheet_select_save[0].row[1]+1))}else if(u.selectStatus){let t=$e(e.pageX,e.pageY),l=t[0]+$("#luckysheet-cell-main").scrollLeft(),c=t[1]+$("#luckysheet-cell-main").scrollTop(),o=ve(c),s=o[1],r=o[0],a=o[2],n=be(l),h=n[1],d=n[0],m=n[2],f=u.selectRange[u.selectRange.length-1],y=0,g=0,k=[];f.top>r?(y=r,g=f.top+f.height-r,f.row[1]>f.row_focus&&(f.row[1]=f.row_focus),k=[a,f.row[1]]):f.top==r?(y=r,g=f.top+f.height-r,k=[a,f.row[0]]):(y=f.top,g=s-f.top-1,f.row[0]<f.row_focus&&(f.row[0]=f.row_focus),k=[f.row[0],a]);let _=0,p=0,w=[];f.left>d?(_=d,p=f.left+f.width-d,f.column[1]>f.column_focus&&(f.column[1]=f.column_focus),w=[m,f.column[1]]):f.left==d?(_=d,p=f.left+f.width-d,w=[m,f.column[0]]):(_=f.left,p=h-f.left-1,f.column[0]<f.column_focus&&(f.column[0]=f.column_focus),w=[f.column[0],m]);let v=i.mergeMoveMain(w,k,f,y,g,_,p);null!=v&&(w=v[0],k=v[1],y=v[2],g=v[3],_=v[4],p=v[5]),f.row=k,f.column=w,f.left_move=_,f.width_move=p,f.top_move=y,f.height_move=g,u.selectRange[u.selectRange.length-1]=f,ee(u.selectRange);let b=u.getTxtByRange(u.selectRange);$("#luckysheet-multiRange-dialog input").val(b)}else if(n.selectStatus){let t=$e(e.pageX,e.pageY),l=t[0]+$("#luckysheet-cell-main").scrollLeft(),c=t[1]+$("#luckysheet-cell-main").scrollTop(),o=ve(c),s=o[1],r=o[0],a=o[2],u=be(l),h=u[1],d=u[0],m=u[2],f=n.selectRange[n.selectRange.length-1],y=0,g=0,k=[];f.top>r?(y=r,g=f.top+f.height-r,f.row[1]>f.row_focus&&(f.row[1]=f.row_focus),k=[a,f.row[1]]):f.top==r?(y=r,g=f.top+f.height-r,k=[a,f.row[0]]):(y=f.top,g=s-f.top-1,f.row[0]<f.row_focus&&(f.row[0]=f.row_focus),k=[f.row[0],a]);let _=0,p=0,w=[];f.left>d?(_=d,p=f.left+f.width-d,f.column[1]>f.column_focus&&(f.column[1]=f.column_focus),w=[m,f.column[1]]):f.left==d?(_=d,p=f.left+f.width-d,w=[m,f.column[0]]):(_=f.left,p=h-f.left-1,f.column[0]<f.column_focus&&(f.column[0]=f.column_focus),w=[f.column[0],m]);let v=i.mergeMoveMain(w,k,f,y,g,_,p);null!=v&&(w=v[0],k=v[1],y=v[2],g=v[3],_=v[4],p=v[5]),f.row=k,f.column=w,f.left_move=_,f.width_move=p,f.top_move=y,f.height_move=g,n.selectRange[n.selectRange.length-1]=f,ee(n.selectRange);let b=n.getTxtByRange(n.selectRange);L.rangetosheet!=U.currentSheetIndex&&(b=U.luckysheetfile[pe(U.currentSheetIndex)].name+"!"+b),$("#luckysheet-dataVerificationRange-dialog input").val(b)}else if(L.rangestart)L.rangedrag(e);else if(L.rangedrag_row_start)L.rangedrag_row(e);else if(L.rangedrag_column_start)L.rangedrag_column(e);else if(U.luckysheet_rows_selected_status){let t=$e(e.pageX,e.pageY)[1]+$("#luckysheet-rows-h").scrollTop();if(t<0)return!1;let l=ve(t),c=l[1],o=l[0],s=l[2],r=U.visibledatacolumn.length-1,a=(U.visibledatacolumn[r],$.extend(!0,{},U.luckysheet_select_save[U.luckysheet_select_save.length-1])),n=0,i=0,u=[];a.top>o?(n=o,i=a.top+a.height-o,a.row[1]>a.row_focus&&(a.row[1]=a.row_focus),u=[s,a.row[1]]):a.top==o?(n=o,i=a.top+a.height-o,u=[s,a.row[0]]):(n=a.top,i=c-a.top-1,a.row[0]<a.row_focus&&(a.row[0]=a.row_focus),u=[a.row[0],s]),a.row=u,a.top_move=n,a.height_move=i,U.luckysheet_select_save[U.luckysheet_select_save.length-1]=a,J(),clearTimeout(U.countfuncTimeout),U.countfuncTimeout=setTimeout(function(){Se()},500)}else if(U.luckysheet_cols_selected_status){let t=$e(e.pageX,e.pageY)[0]+$("#luckysheet-cols-h-c").scrollLeft();if(t<0)return!1;let l=U.visibledatarow.length-1,c=(U.visibledatarow[l],be(t)),o=c[1],s=c[0],r=c[2],a=$.extend(!0,{},U.luckysheet_select_save[U.luckysheet_select_save.length-1]),n=0,i=0,u=[];a.left>s?(n=s,i=a.left+a.width-s,a.column[1]>a.column_focus&&(a.column[1]=a.column_focus),u=[r,a.column[1]]):a.left==s?(n=s,i=a.left+a.width-s,u=[r,a.column[0]]):(n=a.left,i=o-a.left-1,a.column[0]<a.column_focus&&(a.column[0]=a.column_focus),u=[a.column[0],r]),a.column=u,a.left_move=n,a.width_move=i,U.luckysheet_select_save[U.luckysheet_select_save.length-1]=a,J(),clearTimeout(U.countfuncTimeout),U.countfuncTimeout=setTimeout(function(){Se()},500)}else if(U.luckysheet_cell_selected_move){let t=$e(e.pageX,e.pageY),l=$("#luckysheet-cell-main").scrollLeft(),c=$("#luckysheet-cell-main").scrollTop(),o=t[0]+l,s=t[1]+c,r=$(window).height()+c-U.sheetBarHeight-U.statisticBarHeight,a=$(window).width()+l,n=ve(s),i=n[1],u=n[0],h=n[2],d=be(o),m=d[1],f=d[0],y=d[2],g=U.luckysheet_cell_selected_move_index[0],k=U.luckysheet_cell_selected_move_index[1],_=U.luckysheet_select_save[0].row[0]-g+h,p=U.luckysheet_select_save[0].row[1]-g+h,w=U.luckysheet_select_save[0].column[0]-k+y,v=U.luckysheet_select_save[0].column[1]-k+y;(_<0||s<0)&&(_=0,p=U.luckysheet_select_save[0].row[1]-U.luckysheet_select_save[0].row[0]),(w<0||o<0)&&(w=0,v=U.luckysheet_select_save[0].column[1]-U.luckysheet_select_save[0].column[0]),(p>=U.visibledatarow[U.visibledatarow.length-1]||s>r)&&(_=U.visibledatarow.length-1-U.luckysheet_select_save[0].row[1]+U.luckysheet_select_save[0].row[0],p=U.visibledatarow.length-1),(v>=U.visibledatacolumn[U.visibledatacolumn.length-1]||o>a)&&(w=U.visibledatacolumn.length-1-U.luckysheet_select_save[0].column[1]+U.luckysheet_select_save[0].column[0],v=U.visibledatacolumn.length-1),f=w-1==-1?0:U.visibledatacolumn[w-1],m=U.visibledatacolumn[v],u=_-1==-1?0:U.visibledatarow[_-1],i=U.visibledatarow[p],$("#luckysheet-cell-selected-move").css({left:f,width:m-f-2,top:u,height:i-u-2,display:"block"})}else if(U.luckysheet_cell_selected_extend){let t=$e(e.pageX,e.pageY),l=$("#luckysheet-cell-main").scrollLeft()-5,c=$("#luckysheet-cell-main").scrollTop()-5,o=t[0]+l,s=t[1]+c,r=$(window).height()+c-U.sheetBarHeight-U.statisticBarHeight,a=$(window).width()+l,n=ve(s),i=n[1],u=n[0],h=n[2],d=be(o),m=d[1],f=d[0],y=d[2],g=U.luckysheet_cell_selected_extend_index[0],k=U.luckysheet_cell_selected_extend_index[1],_=U.luckysheet_select_save[0].row[0],p=U.luckysheet_select_save[0].row[1],w=U.luckysheet_select_save[0].column[0],v=U.luckysheet_select_save[0].column[1];(_<0||s<0)&&(_=0,p=U.luckysheet_select_save[0].row[1]-U.luckysheet_select_save[0].row[0]),(w<0||o<0)&&(w=0,v=U.luckysheet_select_save[0].column[1]-U.luckysheet_select_save[0].column[0]),(p>=U.visibledatarow[U.visibledatarow.length-1]||s>r)&&(_=U.visibledatarow.length-1-U.luckysheet_select_save[0].row[1]+U.luckysheet_select_save[0].row[0],p=U.visibledatarow.length-1),(v>=U.visibledatacolumn[U.visibledatacolumn.length-1]||o>a)&&(w=U.visibledatacolumn.length-1-U.luckysheet_select_save[0].column[1]+U.luckysheet_select_save[0].column[0],v=U.visibledatacolumn.length-1);let b=U.luckysheet_select_save[0].top_move,z=U.luckysheet_select_save[0].height_move,C=U.luckysheet_select_save[0].left_move,R=U.luckysheet_select_save[0].width_move;Math.abs(g-h)>Math.abs(k-y)?h>=_&&h<=p||(U.luckysheet_select_save[0].top_move>=u?(b=u,z=U.luckysheet_select_save[0].top_move+U.luckysheet_select_save[0].height_move-u):(b=U.luckysheet_select_save[0].top_move,z=i-U.luckysheet_select_save[0].top_move-1)):y>=w&&y<=v||(U.luckysheet_select_save[0].left_move>=f?(C=f,R=U.luckysheet_select_save[0].left_move+U.luckysheet_select_save[0].width_move-f):(C=U.luckysheet_select_save[0].left_move,R=m-U.luckysheet_select_save[0].left_move-1)),$("#luckysheet-cell-selected-extend").css({left:C,width:R,top:b,height:z,display:"block"})}else if(U.luckysheet_cols_change_size){let t=$e(e.pageX,e.pageY),l=$("#luckysheet-cols-h-c").scrollLeft(),c=t[0]+l,o=$(window).width(),s=U.visibledatarow.length-1,r=(U.visibledatarow[s],be(c));r[1],r[0],r[2],c+3-U.luckysheet_cols_change_size_start[0]>30&&c<o+l-100&&($("#luckysheet-change-size-line").css({left:c}),$("#luckysheet-cols-change-size").css({left:c-2}))}else if(U.luckysheet_rows_change_size){let t=$e(e.pageX,e.pageY),l=$("#luckysheet-rows-h").scrollTop(),c=t[1]+l,o=$(window).height(),s=ve(c);s[1],s[0],s[2],c+3-U.luckysheet_rows_change_size_start[0]>19&&c<o+l-200&&($("#luckysheet-change-size-line").css({top:c}),$("#luckysheet-rows-change-size").css({top:c}))}else if(U.chartparam.luckysheetCurrentChartMove){const t=$e(e.pageX,e.pageY),c=t[0]+$("#luckysheet-cell-main").scrollLeft(),o=t[1]+$("#luckysheet-cell-main").scrollTop(),s=U.chartparam.luckysheetCurrentChartMoveObj.height(),r=U.chartparam.luckysheetCurrentChartMoveObj.width();let a=o-U.chartparam.luckysheetCurrentChartMoveXy[1],n=c-U.chartparam.luckysheetCurrentChartMoveXy[0];if(a<0&&(a=0),a+s+42+6>U.chartparam.luckysheetCurrentChartMoveWinH&&(a=U.chartparam.luckysheetCurrentChartMoveWinH-s-42-6),n<0&&(n=0),n+r+22+36>U.chartparam.luckysheetCurrentChartMoveWinW&&(n=U.chartparam.luckysheetCurrentChartMoveWinW-r-22-36),U.chartparam.luckysheetCurrentChartMoveObj.css({top:a,left:n}),null!=l.freezenhorizontaldata||null!=l.freezenverticaldata){l.scrollAdapt();const t=U.chartparam.luckysheetCurrentChartMoveObj.offset(),c=U.chartparam.luckysheetCurrentChartMoveObj.position();U.chartparam.luckysheetCurrentChartMoveXy=[e.pageX-t.left,e.pageY-t.top,c.left,c.top,$("#luckysheet-scrollbar-x").scrollLeft(),$("#luckysheet-scrollbar-y").scrollTop()]}}else if(U.chartparam.luckysheetCurrentChartResize){const t=$("#luckysheet-cell-main").scrollTop(),l=$("#luckysheet-cell-main").scrollLeft(),c=$e(e.pageX,e.pageY),o=c[0]+l,s=c[1]+t;if(o<0||s<0)return!1;U.chartparam.luckysheetCurrentChartResizeObj.height(),U.chartparam.luckysheetCurrentChartResizeObj.width();const r=s-U.chartparam.luckysheetCurrentChartResizeXy[1],a=o-U.chartparam.luckysheetCurrentChartResizeXy[0];let n=U.chartparam.luckysheetCurrentChartResizeXy[5],i=U.chartparam.luckysheetCurrentChartResizeXy[3],u=U.chartparam.luckysheetCurrentChartResizeXy[4],h=U.chartparam.luckysheetCurrentChartResizeXy[2];"lm"!=U.chartparam.luckysheetCurrentChartResize&&"lt"!=U.chartparam.luckysheetCurrentChartResize&&"lb"!=U.chartparam.luckysheetCurrentChartResize||(u=o,h=U.chartparam.luckysheetCurrentChartResizeXy[2]-a,u>U.chartparam.luckysheetCurrentChartResizeXy[2]+U.chartparam.luckysheetCurrentChartResizeXy[4]-60?(u=U.chartparam.luckysheetCurrentChartResizeXy[2]+U.chartparam.luckysheetCurrentChartResizeXy[4]-60,h=U.chartparam.luckysheetCurrentChartResizeXy[2]-(U.chartparam.luckysheetCurrentChartResizeXy[2]+U.chartparam.luckysheetCurrentChartResizeXy[4]-60-U.chartparam.luckysheetCurrentChartResizeXy[0])):u<=0&&(u=0,h=U.chartparam.luckysheetCurrentChartResizeXy[2]+U.chartparam.luckysheetCurrentChartResizeXy[0])),"rm"!=U.chartparam.luckysheetCurrentChartResize&&"rt"!=U.chartparam.luckysheetCurrentChartResize&&"rb"!=U.chartparam.luckysheetCurrentChartResize||((h=U.chartparam.luckysheetCurrentChartResizeXy[2]+a)<60?h=60:h>=U.chartparam.luckysheetCurrentChartResizeWinW-U.chartparam.luckysheetCurrentChartResizeXy[4]-22-36&&(h=U.chartparam.luckysheetCurrentChartResizeWinW-U.chartparam.luckysheetCurrentChartResizeXy[4]-22-36)),"mt"!=U.chartparam.luckysheetCurrentChartResize&&"lt"!=U.chartparam.luckysheetCurrentChartResize&&"rt"!=U.chartparam.luckysheetCurrentChartResize||(n=s,i=U.chartparam.luckysheetCurrentChartResizeXy[3]-r,n>U.chartparam.luckysheetCurrentChartResizeXy[3]+U.chartparam.luckysheetCurrentChartResizeXy[5]-60?(n=U.chartparam.luckysheetCurrentChartResizeXy[3]+U.chartparam.luckysheetCurrentChartResizeXy[5]-60,i=U.chartparam.luckysheetCurrentChartResizeXy[3]-(U.chartparam.luckysheetCurrentChartResizeXy[3]+U.chartparam.luckysheetCurrentChartResizeXy[5]-60-U.chartparam.luckysheetCurrentChartResizeXy[1])):n<=0&&(n=0,i=U.chartparam.luckysheetCurrentChartResizeXy[3]+U.chartparam.luckysheetCurrentChartResizeXy[1])),"mb"!=U.chartparam.luckysheetCurrentChartResize&&"lb"!=U.chartparam.luckysheetCurrentChartResize&&"rb"!=U.chartparam.luckysheetCurrentChartResize||((i=U.chartparam.luckysheetCurrentChartResizeXy[3]+r)<60?i=60:i>=U.chartparam.luckysheetCurrentChartResizeWinH-U.chartparam.luckysheetCurrentChartResizeXy[5]-42-6&&(i=U.chartparam.luckysheetCurrentChartResizeWinH-U.chartparam.luckysheetCurrentChartResizeXy[5]-42-6));const d={top:n,left:u,height:i,width:h};U.chartparam.luckysheetCurrentChartResizeObj.css(d),U.resizeChart(U.chartparam.luckysheetCurrentChart)}else if(r.move){let t=$e(e.pageX,e.pageY),l=t[0]+$("#luckysheet-cell-main").scrollLeft(),c=t[1]+$("#luckysheet-cell-main").scrollTop(),o=r.images[r.currentImgId];o.isFixedPos&&(l=e.pageX,c=e.pageY);let s=$("#luckysheet-modal-dialog-activeImage").height(),a=$("#luckysheet-modal-dialog-activeImage").width(),n=c-r.moveXY[1],i=l-r.moveXY[0],u=0,h=r.currentWinH-s-42-6,d=0,m=r.currentWinW-a-22-36;o.isFixedPos&&(h=(u=U.infobarHeight+U.toolbarHeight+U.calculatebarHeight+U.columnHeaderHeight)+U.cellmainHeight-U.cellMainSrollBarSize-s,m=(d=U.rowHeaderWidth)+U.cellmainWidth-U.cellMainSrollBarSize-a),n<u&&(n=u),n>h&&(n=h),i<d&&(i=d),i>m&&(i=m),$("#luckysheet-modal-dialog-activeImage").css({left:i,top:n})}else if(r.resize){let t=$e(e.pageX,e.pageY),l=$("#luckysheet-cell-main").scrollLeft(),c=$("#luckysheet-cell-main").scrollTop(),o=t[0]+l,s=t[1]+c;if(o<0||s<0)return!1;let a=r.resizeXY,n=s-a[1],i=o-a[0],u=a[5],h=a[3],d=a[4],m=a[2],f=r.resize,y=r.images[r.currentImgId];if(y.isFixedPos){let e=U.infobarHeight+U.toolbarHeight+U.calculatebarHeight+U.columnHeaderHeight,t=U.rowHeaderWidth;"lt"==f?((d=a[4]-a[6]+i)<t&&(d=t),d>a[4]-a[6]+a[2]-1&&(d=a[4]-a[6]+a[2]-1),m=a[4]-a[6]+a[2]-d,h=Math.round(m*(a[3]/a[2])),(u=a[5]-a[7]+a[3]-h)<e&&(u=e,h=a[5]-a[7]+a[3]-u,m=Math.round(h*(a[2]/a[3])),d=a[4]-a[6]+a[2]-m),u>a[5]-a[7]+a[3]-1&&(u=a[5]-a[7]+a[3]-1,h=a[5]-a[7]+a[3]-u,m=Math.round(h*(a[2]/a[3])),d=a[4]-a[6]+a[2]-m)):"lm"==f?((d=a[4]-a[6]+i)<t&&(d=t),d>a[4]-a[6]+a[2]-1&&(d=a[4]-a[6]+a[2]-1),m=a[4]-a[6]+a[2]-d,u=a[5]-a[7],h=a[3]):"lb"==f?((d=a[4]-a[6]+i)<t&&(d=t),d>a[4]-a[6]+a[2]-1&&(d=a[4]-a[6]+a[2]-1),m=a[4]-a[6]+a[2]-d,h=Math.round(m*(a[3]/a[2])),u=a[5]-a[7],h<1&&(h=1,m=Math.round(h*(a[2]/a[3])),d=a[4]-a[6]+a[2]-m),h>e+U.cellmainHeight-U.cellMainSrollBarSize-u&&(h=e+U.cellmainHeight-U.cellMainSrollBarSize-u,m=Math.round(h*(a[2]/a[3])),d=a[4]-a[6]+a[2]-m)):"rt"==f?(d=a[4]-a[6],(m=a[2]+i)<1&&(m=1),m>t+U.cellmainWidth-U.cellMainSrollBarSize-d&&(m=t+U.cellmainWidth-U.cellMainSrollBarSize-d),h=Math.round(m*(a[3]/a[2])),(u=a[5]-a[7]+a[3]-h)<e&&(u=e,h=a[5]-a[7]+a[3]-u,m=Math.round(h*(a[2]/a[3]))),u>a[5]-a[7]+a[3]-1&&(u=a[5]-a[7]+a[3]-1,h=a[5]-a[7]+a[3]-u,m=Math.round(h*(a[2]/a[3])))):"rm"==f?(d=a[4]-a[6],(m=a[2]+i)<1&&(m=1),m>t+U.cellmainWidth-U.cellMainSrollBarSize-d&&(m=t+U.cellmainWidth-U.cellMainSrollBarSize-d),u=a[5]-a[7],h=a[3]):"rb"==f?(d=a[4]-a[6],(m=a[2]+i)<1&&(m=1),m>t+U.cellmainWidth-U.cellMainSrollBarSize-d&&(m=t+U.cellmainWidth-U.cellMainSrollBarSize-d),h=Math.round(m*(a[3]/a[2])),u=a[5]-a[7],h<1&&(h=1,m=Math.round(h*(a[2]/a[3]))),h>e+U.cellmainHeight-U.cellMainSrollBarSize-u&&(h=e+U.cellmainHeight-U.cellMainSrollBarSize-u,m=Math.round(h*(a[2]/a[3])))):"mt"==f?(d=a[4]-a[6],m=a[2],(u=a[5]-a[7]+n)<e&&(u=e),u>a[5]-a[7]+a[3]-1&&(u=a[5]-a[7]+a[3]-1),h=a[5]-a[7]+a[3]-u):"mb"==f&&(d=a[4]-a[6],m=a[2],u=a[5]-a[7],(h=a[3]+n)<1&&(h=1),h>e+U.cellmainHeight-U.cellMainSrollBarSize-u&&(h=e+U.cellmainHeight-U.cellMainSrollBarSize-u))}else"lt"==f?(d=o,m=a[2]-i,d>a[2]+a[4]-1?(d=a[2]+a[4]-1,m=a[2]+a[0]-(a[2]+a[4]-1)):d<=0&&(d=0,m=a[2]+a[0]),h=Math.round(m*(a[3]/a[2])),(u=a[3]+a[1]-h)>a[3]+a[5]-1?(u=a[3]+a[5]-1,h=a[3]+a[1]-(a[3]+a[5]-1),m=Math.round(h*(a[2]/a[3])),d=a[2]+a[0]-m):u<=0&&(u=0,h=a[3]+a[1],m=Math.round(h*(a[2]/a[3])),d=a[2]+a[0]-m)):"lm"==f?(d=o,m=a[2]-i,d>a[2]+a[4]-1?(d=a[2]+a[4]-1,m=a[2]+a[0]-(a[2]+a[4]-1)):d<=0&&(d=0,m=a[2]+a[0])):"lb"==f?(d=o,m=a[2]-i,d>a[2]+a[4]-1?(d=a[2]+a[4]-1,m=a[2]+a[0]-(a[2]+a[4]-1)):d<=0&&(d=0,m=a[2]+a[0]),(h=Math.round(m*(a[3]/a[2])))<1?(h=1,m=Math.round(h*(a[2]/a[3])),d=a[2]+a[0]-m):h>=r.currentWinH-a[5]-42-6&&(h=r.currentWinH-a[5]-42-6,m=Math.round(h*(a[2]/a[3])),d=a[2]+a[0]-m)):"rt"==f?((m=a[2]+i)<1?m=1:m>=r.currentWinW-a[4]-22-36&&(m=r.currentWinW-a[4]-22-36),h=Math.round(m*(a[3]/a[2])),(u=a[3]+a[1]-h)>a[3]+a[5]-1?(u=a[3]+a[5]-1,h=a[3]+a[1]-(a[3]+a[5]-1),m=Math.round(h*(a[2]/a[3]))):u<=0&&(u=0,h=a[3]+a[1],m=Math.round(h*(a[2]/a[3])))):"rm"==f?(m=a[2]+i)<1?m=1:m>=r.currentWinW-a[4]-22-36&&(m=r.currentWinW-a[4]-22-36):"rb"==f?((m=a[2]+i)<1?m=1:m>=r.currentWinW-a[4]-22-36&&(m=r.currentWinW-a[4]-22-36),(h=Math.round(m*(a[3]/a[2])))<1?(h=1,m=Math.round(h*(a[2]/a[3]))):h>=r.currentWinH-a[5]-42-6&&(h=r.currentWinH-a[5]-42-6,m=Math.round(h*(a[2]/a[3])))):"mt"==f?(u=s,h=a[3]-n,u>a[3]+a[5]-1?(u=a[3]+a[5]-1,h=a[3]+a[1]-(a[3]+a[5]-1)):u<=0&&(u=0,h=a[3]+a[1])):"mb"==f&&((h=a[3]+n)<1?h=1:h>=r.currentWinH-a[5]-42-6&&(h=r.currentWinH-a[5]-42-6));$("#luckysheet-modal-dialog-activeImage").css({width:m,height:h,left:d,top:u});let g=m/y.crop.width,k=h/y.crop.height,_=Math.round(y.default.width*g),p=Math.round(y.default.height*k),w=Math.round(y.crop.offsetLeft*g),v=Math.round(y.crop.offsetTop*k);$("#luckysheet-modal-dialog-activeImage .luckysheet-modal-dialog-content").css({"background-size":_+"px "+p+"px","background-position":-w+"px "+-v+"px"})}else if(r.cropChange){let t=$e(e.pageX,e.pageY),l=t[0]+$("#luckysheet-cell-main").scrollLeft(),c=t[1]+$("#luckysheet-cell-main").scrollTop();if(l<0||c<0)return!1;let o,s,a,n,i=r.cropChangeXY,u=c-i[1],h=l-i[0],d=r.images[r.currentImgId],m=r.cropChange;"lt"==m?((a=d.crop.offsetLeft+h)<0&&(a=0),a>d.crop.width+d.crop.offsetLeft-1&&(a=d.crop.width+d.crop.offsetLeft-1),o=d.crop.width+d.crop.offsetLeft-a,(n=d.crop.offsetTop+u)<0&&(n=0),n>d.crop.height+d.crop.offsetTop-1&&(n=d.crop.height+d.crop.offsetTop-1),s=d.crop.height+d.crop.offsetTop-n):"lm"==m?((a=d.crop.offsetLeft+h)<0&&(a=0),a>d.crop.width+d.crop.offsetLeft-1&&(a=d.crop.width+d.crop.offsetLeft-1),o=d.crop.width+d.crop.offsetLeft-a,n=d.crop.offsetTop,s=d.crop.height):"lb"==m?((a=d.crop.offsetLeft+h)<0&&(a=0),a>d.crop.width+d.crop.offsetLeft-1&&(a=d.crop.width+d.crop.offsetLeft-1),o=d.crop.width+d.crop.offsetLeft-a,n=d.crop.offsetTop,(s=d.crop.height+u)<1&&(s=1),s>d.default.height-n&&(s=d.default.height-n)):"rt"==m?(a=d.crop.offsetLeft,(o=d.crop.width+h)<1&&(o=1),o>d.default.width-a&&(o=d.default.width-a),(n=d.crop.offsetTop+u)<0&&(n=0),n>d.crop.height+d.crop.offsetTop-1&&(n=d.crop.height+d.crop.offsetTop-1),s=d.crop.height+d.crop.offsetTop-n):"rm"==m?(a=d.crop.offsetLeft,(o=d.crop.width+h)<1&&(o=1),o>d.default.width-a&&(o=d.default.width-a),n=d.crop.offsetTop,s=d.crop.height):"rb"==m?(a=d.crop.offsetLeft,(o=d.crop.width+h)<1&&(o=1),o>d.default.width-a&&(o=d.default.width-a),n=d.crop.offsetTop,(s=d.crop.height+u)<1&&(s=1),s>d.default.height-n&&(s=d.default.height-n)):"mt"==m?(a=d.crop.offsetLeft,o=d.crop.width,(n=d.crop.offsetTop+u)<0&&(n=0),n>d.crop.height+d.crop.offsetTop-1&&(n=d.crop.height+d.crop.offsetTop-1),s=d.crop.height+d.crop.offsetTop-n):"mb"==m&&(a=d.crop.offsetLeft,o=d.crop.width,n=d.crop.offsetTop,(s=d.crop.height+u)<1&&(s=1),s>d.default.height-n&&(s=d.default.height-n));let f=d.default.left+a,y=d.default.top+n;d.isFixedPos&&(f=d.fixedLeft+a,y=d.fixedTop+n),$("#luckysheet-modal-dialog-cropping").show().css({width:o,height:s,left:f,top:y}),$("#luckysheet-modal-dialog-cropping .cropping-mask").css({width:d.default.width,height:d.default.height,"background-image":"url("+d.src+")",left:-a,top:-n}),$("#luckysheet-modal-dialog-cropping .cropping-content").css({"background-image":"url("+d.src+")","background-size":d.default.width+"px "+d.default.height+"px","background-position":-a+"px "+-n+"px"}),r.cropChangeObj={width:o,height:s,offsetLeft:a,offsetTop:n}}else if(s.move){let t=$e(e.pageX,e.pageY),l=t[0]+$("#luckysheet-cell-main").scrollLeft(),c=t[1]+$("#luckysheet-cell-main").scrollTop(),o=s.currentObj.outerHeight(),r=s.currentObj.outerWidth(),a=c-s.moveXY[1],n=l-s.moveXY[0];a<0&&(a=0),a+o+42+6>s.currentWinH&&(a=s.currentWinH-o-42-6),n<0&&(n=0),n+r+22+36>s.currentWinW&&(n=s.currentWinW-r-22-36),s.currentObj.css({left:n,top:a})}else if(s.resize){let t=$e(e.pageX,e.pageY),l=t[0]+$("#luckysheet-cell-main").scrollLeft(),c=t[1]+$("#luckysheet-cell-main").scrollTop();if(l<0||c<0)return!1;let o=s.resizeXY,r=c-o[1],a=l-o[0],n=o[5],i=o[3],u=o[4],h=o[2],d=s.resize;"lm"!=d&&"lt"!=d&&"lb"!=d||(u=l,h=o[2]-a,u>o[2]+o[4]-60?(u=o[2]+o[4]-60,h=o[2]-(o[2]+o[4]-60-o[0])):u<=0&&(u=0,h=o[2]+o[0])),"rm"!=d&&"rt"!=d&&"rb"!=d||((h=o[2]+a)<60?h=60:h>=s.currentWinW-o[4]-22-36&&(h=s.currentWinW-o[4]-22-36)),"mt"!=d&&"lt"!=d&&"rt"!=d||(n=c,i=o[3]-r,n>o[3]+o[5]-60?(n=o[3]+o[5]-60,i=o[3]-(o[3]+o[5]-60-o[1])):n<=0&&(n=0,i=o[3]+o[1])),"mb"!=d&&"lb"!=d&&"rb"!=d||((i=o[3]+r)<60?i=60:i>=s.currentWinH-o[5]-42-6&&(i=s.currentWinH-o[5]-42-6)),s.currentObj.css({width:h,height:i,left:u,top:n})}else L.rangeResize?L.rangeResizeDraging(e,L.rangeResizeObj,L.rangeResizexy,L.rangeResize,L.rangeResizeWinW,L.rangeResizeWinH,U.ch_width,U.rh_height):L.rangeMove?L.rangeMoveDraging(e,L.rangeMovexy,L.rangeMoveObj.data("range"),L.rangeMoveObj,U.sheetBarHeight,U.statisticBarHeight):U.chart_selection.rangeResize?U.chart_selection.rangeResizeDraging(e,U.sheetBarHeight,U.statisticBarHeight):U.chart_selection.rangeMove&&U.chart_selection.rangeMoveDraging(e,U.sheetBarHeight,U.statisticBarHeight);U.jfautoscrollTimeout=window.requestAnimationFrame(t)})}}),$(document).on("mouseup.luckysheetEvent",function(e){if(t&&t.hook&&t.hook.sheetMouseup){let t=$e(e.pageX,e.pageY),o=t[0]+$("#luckysheet-cell-main").scrollLeft(),s=t[1]+$("#luckysheet-cell-main").scrollTop(),r=ve(s),a=r[1],n=r[0],u=r[2],h=be(o),d=h[1],f=h[0],y=h[2],g=i.mergeborer(U.flowdata,u,y);g&&(a=g.row[1],n=g.row[0],u=g.row[2],d=g.column[1],f=g.column[0],y=g.column[2]);let k=m.getSheetByIndex(),_={functionResizeStatus:L.functionResizeStatus,horizontalmoveState:!!l.horizontalmovestate,verticalmoveState:!!l.verticalmovestate,pivotTableMoveState:!!c&&c.movestate,sheetMoveStatus:U.luckysheet_sheet_move_status,scrollStatus:!!U.luckysheet_scroll_status,selectStatus:!!U.luckysheet_select_status,rowsSelectedStatus:!!U.luckysheet_rows_selected_status,colsSelectedStatus:!!U.luckysheet_cols_selected_status,cellSelectedMove:!!U.luckysheet_cell_selected_move,cellSelectedExtend:!!U.luckysheet_cell_selected_extend,colsChangeSize:!!U.luckysheet_cols_change_size,rowsChangeSize:!!U.luckysheet_rows_change_size,chartMove:!!U.chartparam.luckysheetCurrentChartMove,chartResize:!!U.chartparam.luckysheetCurrentChartResize,rangeResize:!!L.rangeResize,rangeMove:!!L.rangeMove},p=$("#luckysheetTableContent").get(0).getContext("2d");Y.createHookFunction("sheetMouseup",U.flowdata[u][y],{r:u,c:y,start_r:n,start_c:f,end_r:a,end_c:d},k,_,p)}if(U.luckysheet_select_status&&(clearTimeout(U.countfuncTimeout),U.countfuncTimeout=setTimeout(function(){Se()},0),i.luckysheetPaintModelOn&&(w.pasteHandlerOfPaintModel(U.luckysheet_copy_save),i.luckysheetPaintSingle&&i.cancelPaintModel())),U.luckysheet_select_status=!1,window.cancelAnimationFrame(U.jfautoscrollTimeout),U.luckysheet_scroll_status=!1,$("#luckysheet-cell-selected").find(".luckysheet-cs-fillhandle").css("cursor","crosshair").end().find(".luckysheet-cs-draghandle").css("cursor","move"),$("#luckysheet-cell-main, #luckysheetTableContent, #luckysheet-sheettable_0").css("cursor","default"),U.luckysheet_rows_selected_status=!1,U.luckysheet_cols_selected_status=!1,U.luckysheet_model_move_state=!1,L.functionResizeStatus&&(L.functionResizeStatus=!1,$("#luckysheet-wa-calculate-size").removeAttr("style")),l.horizontalmovestate&&(l.horizontalmovestate=!1,$("#luckysheet-freezebar-horizontal").removeClass("luckysheet-freezebar-active"),$("#luckysheet-freezebar-horizontal").find(".luckysheet-freezebar-horizontal-handle").css("cursor","-webkit-grab"),l.freezenhorizontaldata[4]<=U.columnHeaderHeight&&l.cancelFreezenHorizontal(),l.createAssistCanvas(),He()),l.verticalmovestate&&(l.verticalmovestate=!1,$("#luckysheet-freezebar-vertical").removeClass("luckysheet-freezebar-active"),$("#luckysheet-freezebar-vertical").find(".luckysheet-freezebar-vertical-handle").css("cursor","-webkit-grab"),l.freezenverticaldata[4]<=U.rowHeaderWidth&&l.cancelFreezenVertical(),l.createAssistCanvas(),He()),c&&c.movestate&&($("#luckysheet-modal-dialog-slider-pivot-move").remove(),c.movestate=!1,$("#luckysheet-modal-dialog-pivotTable-list, #luckysheet-modal-dialog-config-filter, #luckysheet-modal-dialog-config-row, #luckysheet-modal-dialog-config-column, #luckysheet-modal-dialog-config-value").css("cursor","default"),"luckysheet-modal-dialog-pivotTable-list"!=c.movesave.containerid)){0==$(e.target).closest(".luckysheet-modal-dialog-slider-config-list").length&&("luckysheet-modal-dialog-config-value"==c.movesave.containerid&&c.resetOrderby(c.movesave.obj),c.movesave.obj.remove(),c.showvaluecolrow(),$("#luckysheet-modal-dialog-pivotTable-list").find(".luckysheet-modal-dialog-slider-list-item").each(function(){$(this).find(".luckysheet-slider-list-item-selected").find("i").remove()}),$("#luckysheet-modal-dialog-config-filter, #luckysheet-modal-dialog-config-row, #luckysheet-modal-dialog-config-column, #luckysheet-modal-dialog-config-value").find(".luckysheet-modal-dialog-slider-config-item").each(function(){let e=$(this).data("index");$("#luckysheet-modal-dialog-pivotTable-list").find(".luckysheet-modal-dialog-slider-list-item").each(function(){let t=$(this).find(".luckysheet-slider-list-item-selected");$(this).data("index")==e&&0==t.find("i").length&&t.append('<i class="fa fa-check luckysheet-mousedown-cancel"></i>')})}),c.refreshPivotTable())}if(U.luckysheet_sheet_move_status&&(U.luckysheet_sheet_move_status=!1,U.luckysheet_sheet_move_data.activeobject.insertBefore($("#luckysheet-sheets-item-clone")),U.luckysheet_sheet_move_data.activeobject.removeAttr("style"),$("#luckysheet-sheets-item-clone").remove(),U.luckysheet_sheet_move_data.cursorobject.css({cursor:"pointer"}),U.luckysheet_sheet_move_data={},m.reOrderAllSheet()),clearTimeout(U.chartparam.luckysheetCurrentChartMoveTimeout),U.chartparam.luckysheetCurrentChartMove&&(U.chartparam.luckysheetCurrentChartMove=!1,U.chartparam.luckysheetInsertChartTosheetChange)){var a=U.chartparam.luckysheetCurrentChartMoveObj.css("top"),n=U.chartparam.luckysheetCurrentChartMoveObj.css("left"),h=$("#luckysheet-cell-main").scrollLeft(),d=$("#luckysheet-cell-main").scrollTop(),y=U.chartparam.luckysheetCurrentChartMoveXy[2],k=U.chartparam.luckysheetCurrentChartMoveXy[3],_=U.chartparam.luckysheetCurrentChartMoveXy[4],p=U.chartparam.luckysheetCurrentChartMoveXy[5],v=U.chartparam.luckysheetCurrentChartMoveObj.find(".luckysheet-modal-dialog-content").attr("id");U.jfredo.push({type:"moveChart",chart_id:v,sheetIndex:U.currentSheetIndex,myTop:a,myLeft:n,scrollTop:d,scrollLeft:h,x:y,y:k,scrollTop1:p,scrollLeft1:_})}if(U.chartparam.luckysheetCurrentChartResize&&(U.chartparam.luckysheetCurrentChartResize=null,U.chartparam.luckysheetInsertChartTosheetChange)){var b=U.chartparam.luckysheetCurrentChartResizeObj.height(),z=U.chartparam.luckysheetCurrentChartResizeObj.width(),C=(h=$("#luckysheet-cell-main").scrollLeft(),d=$("#luckysheet-cell-main").scrollTop(),a=U.chartparam.luckysheetCurrentChartMoveObj.css("top"),n=U.chartparam.luckysheetCurrentChartMoveObj.css("left"),v=U.chartparam.luckysheetCurrentChartResizeObj.find(".luckysheet-modal-dialog-content").attr("id"),U.chartparam.luckysheetCurrentChartResizeXy[2]),R=U.chartparam.luckysheetCurrentChartResizeXy[3];y=U.chartparam.luckysheetCurrentChartResizeXy[4],k=U.chartparam.luckysheetCurrentChartResizeXy[5],_=U.chartparam.luckysheetCurrentChartResizeXy[6],p=U.chartparam.luckysheetCurrentChartResizeXy[7];U.jfredo.push({type:"resizeChart",chart_id:v,sheetIndex:U.currentSheetIndex,myTop:a,myLeft:n,myHeight:b,myWidth:z,scrollTop:d,scrollLeft:h,x:y,y:k,myWidth1:C,myHeight1:R,scrollTop1:p,scrollLeft1:_})}if(L.rangeResize&&L.rangeResizeDragged(e,L.rangeResizeObj,L.rangeResize,L.rangeResizexy,L.rangeResizeWinW,L.rangeResizeWinH),r.move&&r.moveImgItem(),r.resize&&r.resizeImgItem(),r.cropChange&&r.cropChangeImgItem(),s.move){s.move=!1;let e=s.currentObj.closest(".luckysheet-postil-show").attr("id"),t=e.split("luckysheet-postil-show_")[1].split("_")[0],l=e.split("luckysheet-postil-show_")[1].split("_")[1],c=B.deepCopyFlowData(U.flowdata),o=[];c[t][l].ps.left=s.currentObj.position().left,c[t][l].ps.top=s.currentObj.position().top,c[t][l].ps.value=s.currentObj.find(".formulaInputFocus").text(),o.push(t+"_"+l),s.ref(c,o),$("#"+e).remove(),c[t][l].ps.isshow?(s.buildPs(t,l,c[t][l].ps),$("#"+e).addClass("luckysheet-postil-show-active"),$("#"+e).find(".luckysheet-postil-dialog-resize").show()):s.editPs(t,l)}if(s.resize){s.resize=null;let e=s.currentObj.closest(".luckysheet-postil-show").attr("id"),t=e.split("luckysheet-postil-show_")[1].split("_")[0],l=e.split("luckysheet-postil-show_")[1].split("_")[1],c=B.deepCopyFlowData(U.flowdata),o=[];c[t][l].ps.left=s.currentObj.position().left,c[t][l].ps.top=s.currentObj.position().top,c[t][l].ps.width=s.currentObj.outerWidth(),c[t][l].ps.height=s.currentObj.outerHeight(),c[t][l].ps.value=s.currentObj.find(".formulaInputFocus").text(),o.push(t+"_"+l),s.ref(c,o),$("#"+e).remove(),c[t][l].ps.isshow?(s.buildPs(t,l,c[t][l].ps),$("#"+e).addClass("luckysheet-postil-show-active"),$("#"+e).find(".luckysheet-postil-dialog-resize").show()):s.editPs(t,l)}if(U.luckysheet_rows_change_size){U.luckysheet_rows_change_size=!1,$("#luckysheet-change-size-line").hide(),$("#luckysheet-rows-change-size").css("opacity",0),$("#luckysheet-sheettable, #luckysheet-rows-h, #luckysheet-rows-h canvas").css("cursor","default");let t=$e(e.pageX,e.pageY),l=$("#luckysheet-rows-h").scrollTop(),c=t[1]+l,o=$(window).height(),s=ve(c),a=(s[1],s[0],s[2],c+3-U.luckysheet_rows_change_size_start[0]);c+3-U.luckysheet_rows_change_size_start[0]<19&&(a=19),c>=o-200+l&&(a=o-200-U.luckysheet_rows_change_size_start[0]+l);let n=$.extend(!0,{},U.config);null==n.rowlen&&(n.rowlen={}),null==n.customHeight&&(n.customHeight={}),n.customHeight[U.luckysheet_rows_change_size_start[1]]=1;const i=U.luckysheet_rows_change_size_start[1];let u=!1;U.luckysheet_select_save.length>0&&U.luckysheet_select_save.filter(e=>e.row_select).some(e=>(i>=e.row[0]&&i<=e.row[1]&&(u=!0),u)),u?U.luckysheet_select_save.filter(e=>e.row_select).forEach(e=>{for(let t=e.row[0];t<=e.row[1];t++)n.rowlen[t]=Math.ceil(a/U.zoomRatio)}):n.rowlen[U.luckysheet_rows_change_size_start[1]]=Math.ceil(a/U.zoomRatio);let h=r.moveChangeSize("row",U.luckysheet_rows_change_size_start[1],a);U.clearjfundo&&(U.jfundo.length=0,U.jfredo.push({type:"resize",ctrlType:"resizeR",sheetIndex:U.currentSheetIndex,config:$.extend(!0,{},U.config),curconfig:$.extend(!0,{},n),images:$.extend(!0,{},r.images),curImages:$.extend(!0,{},h)})),U.config=n,U.luckysheetfile[pe(U.currentSheetIndex)].config=U.config,f.saveParam("cg",U.currentSheetIndex,n.rowlen,{k:"rowlen"}),U.luckysheetfile[pe(U.currentSheetIndex)].images=h,f.saveParam("all",U.currentSheetIndex,h,{k:"images"}),r.images=h,r.allImagesShow(),Ie(U.flowdata.length,null)}if(U.luckysheet_cols_change_size){U.luckysheet_cols_change_size=!1,$("#luckysheet-change-size-line").hide(),$("#luckysheet-cols-change-size").css("opacity",0),$("#luckysheet-sheettable, #luckysheet-cols-h-c, .luckysheet-cols-h-cells, .luckysheet-cols-h-cells canvas").css("cursor","default");let t=$e(e.pageX,e.pageY),l=$("#luckysheet-cols-h-c").scrollLeft(),c=t[0]+l,o=$(window).width(),s=U.visibledatarow.length-1,a=(U.visibledatarow[s],be(c)),n=(a[1],a[0],a[2],c+3-U.luckysheet_cols_change_size_start[0]),i=U.defaultcollen;if(null!=U.config.columnlen&&null!=U.config.columnlen[U.luckysheet_cols_change_size_start[1]]&&(i=U.config.columnlen[U.luckysheet_cols_change_size_start[1]]),Math.abs(n-i)<3)return;c+3-U.luckysheet_cols_change_size_start[0]<30&&(n=30),c>=o-100+l&&(n=o-100-U.luckysheet_cols_change_size_start[0]+l);let u=$.extend(!0,{},U.config);null==u.columnlen&&(u.columnlen={}),null==u.customWidth&&(u.customWidth={}),u.customWidth[U.luckysheet_cols_change_size_start[1]]=1;const h=U.luckysheet_cols_change_size_start[1];let d=!1;U.luckysheet_select_save.length>0&&U.luckysheet_select_save.filter(e=>e.column_select).some(e=>(h>=e.column[0]&&h<=e.column[1]&&(d=!0),d)),d?U.luckysheet_select_save.filter(e=>e.column_select).forEach(e=>{for(let t=e.column[0];t<=e.column[1];t++)u.columnlen[t]=Math.ceil(n/U.zoomRatio)}):u.columnlen[U.luckysheet_cols_change_size_start[1]]=Math.ceil(n/U.zoomRatio);let m=r.moveChangeSize("column",U.luckysheet_cols_change_size_start[1],n);U.clearjfundo&&(U.jfundo.length=0,U.jfredo.push({type:"resize",ctrlType:"resizeC",sheetIndex:U.currentSheetIndex,config:$.extend(!0,{},U.config),curconfig:$.extend(!0,{},u),images:$.extend(!0,{},r.images),curImages:$.extend(!0,{},m)})),U.config=u,U.luckysheetfile[pe(U.currentSheetIndex)].config=U.config,f.saveParam("cg",U.currentSheetIndex,u.columnlen,{k:"columnlen"}),U.luckysheetfile[pe(U.currentSheetIndex)].images=m,f.saveParam("all",U.currentSheetIndex,m,{k:"images"}),r.images=m,r.allImagesShow(),Ie(null,U.flowdata[0].length),setTimeout(function(){He()},1)}if(L.rangeMove&&L.rangeMoveDragged(L.rangeMoveObj),U.luckysheet_cell_selected_move){$("#luckysheet-cell-selected-move").hide(),U.luckysheet_cell_selected_move=!1;let t=$e(e.pageX,e.pageY);if(!se(U.luckysheet_select_save,U.currentSheetIndex))return;let l=$("#luckysheet-cell-main").scrollLeft(),c=$("#luckysheet-cell-main").scrollTop(),o=t[0]+l,s=t[1]+c,r=$(window).height()+c-U.sheetBarHeight-U.statisticBarHeight,a=$(window).width()+l,n=ve(s)[2],i=be(o)[2],h=U.luckysheet_cell_selected_move_index[0],d=U.luckysheet_cell_selected_move_index[1];if(n==h&&i==d)return;let m=B.deepCopyFlowData(U.flowdata),f=U.luckysheet_select_save[U.luckysheet_select_save.length-1],y=Xe(f),k=$.extend(!0,{},U.config);if(null==k.merge&&(k.merge={}),null==k.rowlen&&(k.rowlen={}),Re(k,f.row[0],f.row[1],f.column[0],f.column[1]))return void(xe()?alert(g.noMerge):O.info('<i class="fa fa-exclamation-triangle"></i>',g.noMerge));let _=f.row[0]-h+n,p=f.row[1]-h+n,w=f.column[0]-d+i,v=f.column[1]-d+i;if(!se([{row:[_,p],column:[w,v]}],U.currentSheetIndex))return;if((_<0||s<0)&&(_=0,p=f.row[1]-f.row[0]),(w<0||o<0)&&(w=0,v=f.column[1]-f.column[0]),(p>=U.visibledatarow[U.visibledatarow.length-1]||s>r)&&(_=U.visibledatarow.length-1-f.row[1]+f.row[0],p=U.visibledatarow.length-1),(v>=U.visibledatacolumn[U.visibledatacolumn.length-1]||o>a)&&(w=U.visibledatacolumn.length-1-f.column[1]+f.column[0],v=U.visibledatacolumn.length-1),Re(k,_,p,w,v))return void(xe()?alert(g.noMerge):O.info('<i class="fa fa-exclamation-triangle"></i>',g.noMerge));let b=Pe(U.currentSheetIndex),z=null;for(let e=f.row[0];e<=f.row[1];e++){e in k.rowlen&&(z=!0);for(let t=f.column[0];t<=f.column[1];t++){let l=m[e][t];"object"==de(l)&&"mc"in l&&l.mc.r+"_"+l.mc.c in k.merge&&delete k.merge[l.mc.r+"_"+l.mc.c],m[e][t]=null}}if(k.borderInfo&&k.borderInfo.length>0){let e=[];for(let t=0;t<k.borderInfo.length;t++){let l=k.borderInfo[t].rangeType;if("range"==l){let l=k.borderInfo[t].range,c=[];for(let e=0;e<l.length;e++)c=c.concat(u.CFSplitRange(l[e],{row:f.row,column:f.column},{row:[_,p],column:[w,v]},"restPart"));k.borderInfo[t].range=c,e.push(k.borderInfo[t])}else if("cell"==l){let l=k.borderInfo[t].value.row_index,c=k.borderInfo[t].value.col_index;l>=f.row[0]&&l<=f.row[1]&&c>=f.column[0]&&c<=f.column[1]||e.push(k.borderInfo[t])}}k.borderInfo=e}let C={};for(let e=0;e<y.length;e++)for(let t=0;t<y[0].length;t++){if(b[e+f.row[0]+"_"+(t+f.column[0])]){let l={rangeType:"cell",value:{row_index:e+_,col_index:t+w,l:b[e+f.row[0]+"_"+(t+f.column[0])].l,r:b[e+f.row[0]+"_"+(t+f.column[0])].r,t:b[e+f.row[0]+"_"+(t+f.column[0])].t,b:b[e+f.row[0]+"_"+(t+f.column[0])].b}};null==k.borderInfo&&(k.borderInfo=[]),k.borderInfo.push(l)}let l="";if(null!=y[e]&&null!=y[e][t]&&(l=y[e][t]),"object"==de(l)&&"mc"in l){let c=$.extend(!0,{},l.mc);"rs"in l.mc?(C[c.r+"_"+c.c]=[e+_,t+w],l.mc.r=e+_,l.mc.c=t+w,k.merge[e+_+"_"+(t+w)]=l.mc):(l.mc.r=C[c.r+"_"+c.c][0],l.mc.c=C[c.r+"_"+c.c][1])}m[e+_][t+w]=l}z&&(k=ze(m,f.row[0],f.row[1],k),k=ze(m,_,p,k));let R,x,S=$.extend(!0,[],U.luckysheetfile[pe(U.currentSheetIndex)].luckysheet_conditionformat_save);if(null!=S&&S.length>0)for(let e=0;e<S.length;e++){let t=S[e].cellrange,l=[];for(let e=0;e<t.length;e++){let c=u.CFSplitRange(t[e],{row:f.row,column:f.column},{row:[_,p],column:[w,v]},"allPart");l=l.concat(c)}S[e].cellrange=l}R=U.luckysheet_select_save[0].row_focus==U.luckysheet_select_save[0].row[0]?_:p,x=U.luckysheet_select_save[0].column_focus==U.luckysheet_select_save[0].column[0]?w:v;let M=[];M.push({row:f.row,column:f.column}),M.push({row:[_,p],column:[w,v]}),f.row=[_,p],f.column=[w,v],f.row_focus=R,f.column_focus=x,Te(m,M,{cfg:k,RowlChange:z,cdformat:S}),J(),$("#luckysheet-sheettable").css("cursor","default"),clearTimeout(U.countfuncTimeout),U.countfuncTimeout=setTimeout(function(){Se()},500)}if(U.chart_selection.rangeMove&&U.chart_selection.rangeMoveDragged(),U.chart_selection.rangeResize&&U.chart_selection.rangeResizeDragged(),U.luckysheet_cell_selected_extend){if(U.luckysheet_cell_selected_extend=!1,$("#luckysheet-cell-selected-extend").hide(),!se(U.luckysheet_select_save,U.currentSheetIndex))return;let t=$e(e.pageX,e.pageY),l=$("#luckysheet-cell-main").scrollLeft(),s=$("#luckysheet-cell-main").scrollTop(),r=t[0]+l-5,a=t[1]+s-5,n=$(window).height()+s-U.sheetBarHeight-U.statisticBarHeight,i=$(window).width()+l,u=ve(a),h=(u[1],u[0]),d=u[2],m=be(r),f=(m[1],m[0]),y=m[2],k=U.luckysheet_cell_selected_extend_index[0],_=U.luckysheet_cell_selected_extend_index[1],p=U.luckysheet_select_save[U.luckysheet_select_save.length-1],w=p.row[0],v=p.row[1],b=p.column[0],z=p.column[1];(w<0||a<0)&&(w=0,v=p.row[1]-p.row[0]),(b<0||r<0)&&(b=0,z=p.column[1]-p.column[0]),(v>=U.visibledatarow[U.visibledatarow.length-1]||a>n)&&(w=U.visibledatarow.length-1-p.row[1]+p.row[0],v=U.visibledatarow.length-1),(z>=U.visibledatacolumn[U.visibledatacolumn.length-1]||r>i)&&(b=U.visibledatacolumn.length-1-p.column[1]+p.column[0],z=U.visibledatacolumn.length-1),o.copyRange={row:$.extend(!0,[],p.row),column:$.extend(!0,[],p.column)};let C=o.typeItemHide();if(C[0]||C[1]||C[2]||C[3]||C[4]||C[5]||C[6]?o.applyType="1":o.applyType="0",Math.abs(k-d)>Math.abs(_-y)){if(d>=w&&d<=v)return;if(U.luckysheet_select_save[0].top_move>=h){if(o.applyRange={row:[d,p.row[0]-1],column:p.column},o.direction="up",w-=p.row[0]-d,c.isPivotRange(w,z))return void O.info(g.affectPivot,"")}else if(o.applyRange={row:[p.row[1]+1,d],column:p.column},o.direction="down",v+=d-p.row[1],c.isPivotRange(v,z))return void O.info(g.affectPivot,"")}else{if(y>=b&&y<=z)return;if(U.luckysheet_select_save[0].left_move>=f){if(o.applyRange={row:p.row,column:[y,p.column[0]-1]},o.direction="left",b-=p.column[0]-y,c.isPivotRange(v,b))return void O.info(g.affectPivot,"")}else if(o.applyRange={row:p.row,column:[p.column[1]+1,y]},o.direction="right",z+=y-p.column[1],c.isPivotRange(v,z))return void O.info(g.affectPivot,"")}if(null!=U.config.merge){let e=!1;for(let t=p.row[0];t<=p.row[1];t++)for(let l=p.column[0];l<=p.column[1];l++){let c=U.flowdata[t][l];if(null!=c&&null!=c.mc){e=!0;break}}if(e)return void(xe()?alert(g.noMerge):O.info(g.noMerge,""));for(let t=w;t<=v;t++)for(let l=b;l<=z;l++){let c=U.flowdata[t][l];if(null!=c&&null!=c.mc){e=!0;break}}if(e)return void(xe()?alert(g.noMerge):O.info(g.noMerge,""))}p.row=[w,v],p.column=[b,z],o.update(),o.createIcon(),$("#luckysheet-cell-selected-move").hide(),$("#luckysheet-sheettable").css("cursor","default"),clearTimeout(U.countfuncTimeout),U.countfuncTimeout=setTimeout(function(){Se()},500)}}),$(".luckysheet-grid-container, #luckysheet-rightclick-menu").on("contextmenu",function(e){e.preventDefault()}),$("#luckysheet-cell-main div.luckysheet-cs-draghandle").mousedown(function(e){if(xe()||!1===U.allowEdit)return;$("#luckysheet-cell-selected").find(".luckysheet-cs-fillhandle").css("cursor","move").end().find(".luckysheet-cs-draghandle").css("cursor","move"),$("#luckysheet-cell-main, #luckysheetTableContent, #luckysheet-sheettable_0").css("cursor","move"),U.luckysheet_cell_selected_move=!0,U.luckysheet_scroll_status=!0;let t=$e(e.pageX,e.pageY),l=t[0]+$("#luckysheet-cell-main").scrollLeft(),c=t[1]+$("#luckysheet-cell-main").scrollTop(),o=ve(c),s=o[0],r=o[1],a=o[2],n=be(l),i=n[0],u=n[1],h=n[2];U.luckysheet_cell_selected_move_index=[a,h],$("#luckysheet-cell-selected-move").css({left:i,width:u-i-1,top:s,height:r-s-1,display:"block"}),e.stopPropagation()}),$("#luckysheet-cell-main div.luckysheet-cs-fillhandle").mousedown(function(e){xe()||!1===U.allowEdit||($("#luckysheet-cell-selected").find(".luckysheet-cs-fillhandle").css("cursor","crosshair").end().find(".luckysheet-cs-draghandle").css("cursor","crosshair"),$("#luckysheet-cell-main, #luckysheetTableContent, #luckysheet-sheettable_0").css("cursor","crosshair"),U.luckysheet_cell_selected_extend_time=setTimeout(function(){U.luckysheet_cell_selected_extend=!0,U.luckysheet_scroll_status=!0;let t=$e(e.pageX,e.pageY),l=t[0]+$("#luckysheet-cell-main").scrollLeft()-5,c=t[1]+$("#luckysheet-cell-main").scrollTop()-5,o=ve(c),s=o[0],r=o[1],a=o[2],n=be(l),i=n[0],u=n[1],h=n[2];U.luckysheet_cell_selected_extend_index=[a,h],$("#luckysheet-cell-selected-extend").css({left:i,width:u-i-1,top:s,height:r-s-1,display:"block"})},100),e.stopPropagation())}).click(function(){clearTimeout(U.luckysheet_cell_selected_extend_time),event.stopPropagation()}).dblclick(function(){let e=U.luckysheet_select_save[0],t=e.row[0],l=e.row[1],s=e.column[0],r=e.column[1];if(c.isPivotRange(t,s))return;let a=!1,n=0;for(let e=l+1;e<U.flowdata.length;e++)if(s-1>=0&&r+1<U.flowdata[0].length){let t=U.flowdata[e][s-1],c=U.flowdata[e][r+1];if(e==l+1){if((null==t||Ce(t.v))&&(null==c||Ce(c.v))){a=!1;break}a=!0,n++}else{if((null==t||Ce(t.v))&&(null==c||Ce(c.v)))break;n++}}else if(s-1>=0){let t=U.flowdata[e][s-1];if(e==l+1){if(null==t||Ce(t.v)){a=!1;break}a=!0,n++}else{if(null==t||Ce(t.v))break;n++}}else if(r+1<U.flowdata[0].length){let t=U.flowdata[e][r+1];if(e==l+1){if(null==t||Ce(t.v)){a=!1;break}a=!0,n++}else{if(null==t||Ce(t.v))break;n++}}if(!a||0==n)return void event.stopPropagation();o.copyRange={row:[t,l],column:[s,r]};let i=o.typeItemHide();i[0]||i[1]||i[2]||i[3]||i[4]||i[5]||i[6]?o.applyType="1":o.applyType="0",o.applyRange={row:[l+1,l+n],column:[s,r]},o.direction="down",U.luckysheet_select_save=[{row:[t,l+n],column:[s,r]}],o.update(),o.createIcon(),$("#luckysheet-cell-selected-move").hide(),$("#luckysheet-sheettable").css("cursor","default"),clearTimeout(U.countfuncTimeout),U.countfuncTimeout=setTimeout(function(){Se()},500),event.stopPropagation()}),$("#luckysheet-bottom-add-row, #luckysheet-bottom-add-row-input, #luckysheet-bottom-return-top").on("mousedown dblclick mouseup",function(e){e.stopPropagation()}),$("#luckysheet-bottom-add-row").on("click",function(e){$("#luckysheet-rightclick-menu").hide(),ke();$(this);let t=$("#luckysheet-bottom-add-row-input").val();""==t&&(t=100),isNaN(parseInt(t))?xe()?alert(_.tipInputNumber):O.info("error",_.tipInputNumber):(t=parseInt(t))<1||t>100?xe()?alert(_.tipInputNumberLimit):O.info("error",_.tipInputNumberLimit):Me("row",U.flowdata.length-1,t)}),$("#luckysheet-bottom-return-top").on("click",function(e){$("#luckysheet-scrollbar-y").scrollTop(0)}),$("#luckysheet-copy-btn, #luckysheet-cols-copy-btn, #luckysheet-paste-btn-title").click(function(e){if($(this).parent().hide(),null!=U.config.merge){let e=!1;for(let t=0;t<U.luckysheet_select_save.length;t++){let l=U.luckysheet_select_save[t].row[0],c=U.luckysheet_select_save[t].row[1],o=U.luckysheet_select_save[t].column[0],s=U.luckysheet_select_save[t].column[1];if(e=Re(U.config,l,c,o,s))break}if(e)return void(xe()?alert(g.noPartMerge):O.info(g.noPartMerge,""))}let t=U.luckysheetfile[pe(U.currentSheetIndex)].luckysheet_conditionformat_save;if(U.luckysheet_select_save.length>1&&null!=t&&t.length>0){let e=!1,t=u.getComputeMap();e:for(let l=0;l<U.luckysheet_select_save.length&&!e;l++){let c=U.luckysheet_select_save[l].row[0],o=U.luckysheet_select_save[l].row[1],s=U.luckysheet_select_save[l].column[0],r=U.luckysheet_select_save[l].column[1];for(let l=c;l<=o;l++)for(let c=s;c<=r;c++)if(null!=u.checksCF(l,c,t)){e=!0;continue e}}if(e)return void(xe()?alert(g.noMulti):O.info(g.noMulti,""))}if(U.luckysheet_select_save.length>1){let e=!0,t=U.luckysheet_select_save[0].row[0],l=U.luckysheet_select_save[0].row[1],c=!0,o=U.luckysheet_select_save[0].column[0],s=U.luckysheet_select_save[0].column[1];for(let r=1;r<U.luckysheet_select_save.length;r++)U.luckysheet_select_save[r].row[0]==t&&U.luckysheet_select_save[r].row[1]==l||(e=!1),U.luckysheet_select_save[r].column[0]==o&&U.luckysheet_select_save[r].column[1]==s||(c=!1);if(!e&&!c||Z())return void(xe()?alert(g.noMulti):O.info(g.noMulti,""))}w.copy(e)}),$("#luckysheet-copy-paste, #luckysheet-cols-paste-btn, #luckysheet-paste-btn-title").click(function(e){w.paste(e,"btn"),$(this).parent().hide()}),$("#luckysheet-chart-btn-title").click(function(){Fe()}),$("#luckysheetdatavisual").click(function(){Fe(),$("#luckysheet-rightclick-menu").hide()}),$("#luckysheet-pivot-btn-title").click(function(e){ie(U.currentSheetIndex,"usePivotTablereports")&&c.createPivotTable(e)}),$("#luckysheet-chart-btn-screenshot").click(function(){const e=y.screenshot;if(0==U.luckysheet_select_save.length)return void(xe()?alert(e.screenshotTipNoSelection):O.info(e.screenshotTipTitle,e.screenshotTipNoSelection));if(U.luckysheet_select_save.length>1)return void(xe()?alert(e.screenshotTipHasMulti):O.info(e.screenshotTipTitle,e.screenshotTipHasMulti));if(null!=U.config.merge){let t=!1;for(let e=0;e<U.luckysheet_select_save.length;e++){let l=U.luckysheet_select_save[e].row[0],c=U.luckysheet_select_save[e].row[1],o=U.luckysheet_select_save[e].column[0],s=U.luckysheet_select_save[e].column[1];if(t=Re(U.config,l,c,o,s))break}if(t)return void(xe()?alert(e.screenshotTipHasMerge):O.info(e.screenshotTipTitle,e.screenshotTipHasMerge))}let t,l,c,o,s=U.luckysheet_select_save[0].row[0],r=U.luckysheet_select_save[0].row[1],a=U.luckysheet_select_save[0].column[0],n=U.luckysheet_select_save[0].column[1];s-1<0?(t=0,l=U.visibledatarow[r]):(t=U.visibledatarow[s-1],l=U.visibledatarow[r]-U.visibledatarow[s-1]),a-1<0?(c=0,o=U.visibledatacolumn[n]):(c=U.visibledatacolumn[a-1],o=U.visibledatacolumn[n]-U.visibledatacolumn[a-1]);let i=$("<canvas>").attr({width:Math.ceil(o*devicePixelRatio),height:Math.ceil(l*devicePixelRatio)}).css({width:o,height:l});We(c,t,o,l,1,1,null,null,i);let u=i.get(0).getContext("2d");u.beginPath(),u.moveTo(0,0),u.lineTo(0,U.devicePixelRatio*l),u.lineWidth=2*U.devicePixelRatio,u.strokeStyle=oe.strokeStyle,u.stroke(),u.closePath(),u.beginPath(),u.moveTo(0,0),u.lineTo(U.devicePixelRatio*o,0),u.lineWidth=2*U.devicePixelRatio,u.strokeStyle=oe.strokeStyle,u.stroke(),u.closePath();let h=new Image,d=i.get(0).toDataURL("image/png");h.src=d,o>l?h.style.width="100%":h.style.height="100%";let m=$(window).height()-200;O.screenshot(e.screenshotTipSuccess,'<div id="luckysheet-confirm-screenshot-save" style="height:'+m+'px;overflow:auto;"></div>',d),$("#luckysheet-confirm-screenshot-save").append(h),i.remove()}),$(document).on("click.luckysheetEvent","a.download",function(){let e=$("#luckysheet-confirm-screenshot-save img").attr("src");const t=y.screenshot;let l=atob(e.split(",")[1]),c=l.length,o=new Uint8Array(c);for(let e=0;e<c;e++)o[e]=l.charCodeAt(e);let s,r=new Blob([o]),a=document.createElement("a");a.setAttribute("href",URL.createObjectURL(r)),a.setAttribute("download",t.screenshotImageName+".png"),a.style.display="none",document.body.appendChild(a),a.click(),a.addEventListener("click",s=function(){requestAnimationFrame(function(){URL.revokeObjectURL(a.href)}),a.removeAttribute("href"),a.removeEventListener("click",s)}),document.body.removeChild(a)}),$("#luckysheet-splitColumn-btn-title").click(function(){if(!ne(U.currentSheetIndex))return;if(null==U.luckysheet_select_save||0==U.luckysheet_select_save.length)return;const e=y.splitText;U.luckysheet_select_save.length>1?O.info(e.tipNoMulti,""):U.luckysheet_select_save[0].column[0]==U.luckysheet_select_save[0].column[1]?(b.createDialog(),b.init()):O.info(e.tipNoMultiColumn,"")}),$("#luckysheet-insertImg-btn-title").click(function(){ie(U.currentSheetIndex,"editObjects")&&$("#luckysheet-imgUpload").click()}),$("#luckysheetInsertImage").click(function(){ie(U.currentSheetIndex,"editObjects")&&($("#luckysheet-imgUpload").click(),$("#luckysheet-rightclick-menu").hide())}),$("#luckysheet-imgUpload").click(function(e){e.stopPropagation()}),$("#luckysheet-imgUpload").on("change",function(e){if(!ie(U.currentSheetIndex,"editObjects",!1))return;let t=e.currentTarget.files[0],l=new FileReader;l.readAsDataURL(t),l.onload=function(e){let t=e.target.result;r.inserImg(t),$("#luckysheet-imgUpload").val("")}}),$("#luckysheet-insertLink-btn-title").click(function(){ne(U.currentSheetIndex)&&null!=U.luckysheet_select_save&&0!=U.luckysheet_select_save.length&&(a.createDialog(),a.init())}),$("#luckysheetInsertLink").click(function(){$("#luckysheet-insertLink-btn-title").click(),$("#luckysheet-rightclick-menu").hide()}),$("#luckysheet-dataVerification-btn-title").click(function(){ne(U.currentSheetIndex)&&null!=U.luckysheet_select_save&&0!=U.luckysheet_select_save.length&&(n.createDialog(),n.init())}),$("#luckysheetDataVerification").click(function(){$("#luckysheet-dataVerification-btn-title").click(),$("#luckysheet-rightclick-menu").hide()}),$("#luckysheetCellFormatRightClickMenu").click(function(){ue()}),$("#luckysheet-freezen-btn-horizontal").click(function(){$.trim($(this).text())==N().freezen.freezenCancel?(l.saveFrozen("freezenCancel"),null!=l.freezenverticaldata&&(l.cancelFreezenVertical(),l.createAssistCanvas(),He()),null!=l.freezenhorizontaldata&&(l.cancelFreezenHorizontal(),l.createAssistCanvas(),He()),l.scrollAdapt()):(l.saveFrozen("freezenRow"),null!=l.freezenverticaldata&&(l.cancelFreezenVertical(),l.createAssistCanvas(),He()),null==l.freezenhorizontaldata&&(l.createFreezenHorizontal(),l.createAssistCanvas()))}),$("#luckysheet-freezen-btn-vertical").click(function(){null!=l.freezenverticaldata?(l.saveFrozen("freezenCancel"),l.cancelFreezenVertical(),He()):(l.saveFrozen("freezenColumn"),l.createFreezenVertical()),l.createAssistCanvas()}),$("#luckysheet-rightclick-menu input").on("keydown",function(e){e.stopPropagation()}),$("#luckysheet-modal-dialog-mask").on("click dbclick mousedown mousemove mouseup",function(e){e.stopPropagation(),e.preventDefault()});$(document).on("visibilitychange.luckysheetEvent webkitvisibilitychange.luckysheetEvent msvisibilitychange.luckysheetEvent",function(){(document.hidden||document.webkitHidden||document.msHidden)&&(U.iscopyself=!1)}).on("mouseleave.luckysheetEvent",function(){U.iscopyself=!1}).on("mousedown.luckysheetEvent",function(e){s.removeActivePs(),ce(e),$(e.target).closest("#luckysheet-wa-editor").length>0&&parseInt($("#luckysheet-input-box").css("top"))>0&&(console.log(e),L.updatecell(U.luckysheetCellUpdate[0],U.luckysheetCellUpdate[1]),Q("down",0,"rangeOfSelect"))}),$("#luckysheet-left-top").click(function(e){re(U.currentSheetIndex)&&($("#luckysheet-wa-functionbox-confirm").click(),U.luckysheet_select_status=!1,U.luckysheet_select_save=[{row:[0,U.flowdata.length-1],column:[0,U.flowdata[0].length-1],row_focus:0,column_focus:0,row_select:!0,column_select:!0}],J(),clearTimeout(U.countfuncTimeout),U.countfuncTimeout=setTimeout(function(){Se()},500),f.saveParam("mv",U.currentSheetIndex,U.luckysheet_select_save),e.stopPropagation())}),$("#luckysheet-icon-undo").click(function(e){v.redo(e)}),$("#luckysheet-icon-redo").click(function(e){v.undo(e)}),$(document).on("mousedown.luckysheetEvent","div.luckysheet-modal-dialog",function(e){if(!$(e.target).is(".luckysheet-modal-dialog"))return;U.luckysheet_model_move_state=!0,U.luckysheet_model_move_obj=$(e.currentTarget);let t=U.luckysheet_model_move_obj.offset();U.luckysheet_model_xy=[e.pageX-t.left,e.pageY-t.top]}),$(document).on("click.luckysheetEvent",".luckysheet-modal-dialog-title-close, .luckysheet-model-close-btn",function(e){($("#textcolorselect").is(":visible")||$("#cellcolorselect").is(":visible"))&&$("#luckysheet-conditionformat-dialog").show(),$(e.currentTarget).parents(".luckysheet-modal-dialog").hide(),$("#luckysheet-modal-dialog-mask").hide(),$(this).parents(".luckysheet-modal-dialog").hasClass("luckysheet-search-formula")&&(L.dontupdate(),Q("down",0,"rangeOfSelect")),$(this).parents(".luckysheet-modal-dialog").hasClass("luckysheet-search-formula-parm")&&(L.dontupdate(),Q("down",0,"rangeOfSelect")),$(this).parents(".luckysheet-modal-dialog").hasClass("luckysheet-search-formula-parm-select")&&(L.dontupdate(),Q("down",0,"rangeOfSelect")),ke()}),$("#luckysheet_info_detail_title").click(function(){window.open(t.myFolderUrl,"_self")}),$("#luckysheet-chart-rangeShow").on("mousedown.chartRangeShowMove",".luckysheet-chart-rangeShow-move",function(e){U.chart_selection.rangeMove=!0,U.luckysheet_scroll_status=!0,U.chart_selection.rangeMoveObj=$(this).parent();let t=U.currentChart,l=$(this).parent().attr("id");if("luckysheet-chart-rangeShow-content"==l){let e=t.rangeArray[0].row[0]+t.rangeSplitArray.content.row[0],l=t.rangeArray[0].column[0]+t.rangeSplitArray.content.column[0];U.chart_selection.rangeMoveIndex=[e,l]}else if("luckysheet-chart-rangeShow-rowtitle"==l){let e=t.rangeArray[0].row[0]+t.rangeSplitArray.rowtitle.row[0],l=t.rangeArray[0].column[0]+t.rangeSplitArray.rowtitle.column[0];U.chart_selection.rangeMoveIndex=[e,l]}else if("luckysheet-chart-rangeShow-coltitle"==l){let e=t.rangeArray[0].row[0]+t.rangeSplitArray.coltitle.row[0],l=t.rangeArray[0].column[0]+t.rangeSplitArray.coltitle.column[0];U.chart_selection.rangeMoveIndex=[e,l]}let c=$e(e.pageX,e.pageY),o=c[0]+$("#luckysheet-cell-main").scrollLeft(),s=c[1]+$("#luckysheet-cell-main").scrollTop(),r=$(this).data("type");"top"==r?s+=3:"right"==r?o-=3:"bottom"==r?s-=3:"left"==r&&(o+=3);let a=ve(s)[2],n=be(o)[2];U.chart_selection.rangeMovexy=[a,n],e.stopPropagation()}),$("#luckysheet-chart-rangeShow").on("mousedown.chartRangeShowResize",".luckysheet-chart-rangeShow-resize",function(e){U.chart_selection.rangeResize=$(this).data("type"),U.luckysheet_scroll_status=!0,U.chart_selection.rangeResizeObj=$(this).parent();let t,l,c,o,s=U.currentChart,r=$(this).parent().attr("id");if("luckysheet-chart-rangeShow-content"==r)s.rangeRowCheck.exits?(t=s.rangeArray[0].row[0]+s.rangeSplitArray.content.row[0],l=s.rangeArray[0].row[0]+s.rangeSplitArray.content.row[1]):(t=s.rangeSplitArray.content.row[0],l=s.rangeSplitArray.content.row[0]),s.rangeColCheck.exits?(c=s.rangeArray[0].column[0]+s.rangeSplitArray.content.column[0],o=s.rangeArray[0].column[0]+s.rangeSplitArray.content.column[1]):(c=s.rangeSplitArray.content.column[0],o=s.rangeSplitArray.content.column[1]),U.chart_selection.rangeResizeIndex={row:[t,l],column:[c,o]};else if("luckysheet-chart-rangeShow-rowtitle"==r){let e=s.rangeArray[0].row[0]+s.rangeSplitArray.rowtitle.row[0],t=s.rangeArray[0].row[0]+s.rangeSplitArray.rowtitle.row[1],l=s.rangeArray[0].column[0]+s.rangeSplitArray.rowtitle.column[0],c=s.rangeArray[0].column[0]+s.rangeSplitArray.rowtitle.column[1];U.chart_selection.rangeResizeIndex={row:[e,t],column:[l,c]}}else if("luckysheet-chart-rangeShow-coltitle"==r){let e=s.rangeArray[0].row[0]+s.rangeSplitArray.coltitle.row[0],t=s.rangeArray[0].row[0]+s.rangeSplitArray.coltitle.row[1],l=s.rangeArray[0].column[0]+s.rangeSplitArray.coltitle.column[0],c=s.rangeArray[0].column[0]+s.rangeSplitArray.coltitle.column[1];U.chart_selection.rangeResizeIndex={row:[e,t],column:[l,c]}}let a=$e(e.pageX,e.pageY),n=a[0]+$("#luckysheet-cell-main").scrollLeft(),i=a[1]+$("#luckysheet-cell-main").scrollTop();"lt"==U.chart_selection.rangeResize?(n+=3,i+=3):"lb"==U.chart_selection.rangeResize?(n+=3,i-=3):"rt"==U.chart_selection.rangeResize?(n-=3,i+=3):"rb"==U.chart_selection.rangeResize&&(n-=3,i-=3);let u=ve(i)[2],h=be(n)[2];U.chart_selection.rangeResizexy=[u,h],e.stopPropagation()}),$("#luckysheet-wa-calculate-size").mousedown(function(e){let t=e.pageY;L.functionResizeData.y=t,L.functionResizeStatus=!0,L.functionResizeData.calculatebarHeight=U.calculatebarHeight,null!=L.rangetosheet&&L.updatecell(U.luckysheetCellUpdate[0],U.luckysheetCellUpdate[1])}),i.initialMenuButton();document.getElementById("testdpidiv").offsetWidth,U.devicePixelRatio,document.getElementById("testdpidiv").offsetHeight,U.devicePixelRatio;$(document).on("paste.luckysheetEvent",function(e){if(!xe())if(w.isPasteAction){$("#luckysheet-rich-text-editor").blur(),w.isPasteAction=!1;let t=window.clipboardData;t||(t=e.originalEvent.clipboardData);let l=t.getData("text/html")||t.getData("text/plain"),c=!0;if(l.indexOf("luckysheet_copy_action_table")>-1&&null!=U.luckysheet_copy_save.copyRange&&U.luckysheet_copy_save.copyRange.length>0){let e=[],t=new RegExp("<tr.*?>(.*?)</tr>","g"),o=new RegExp("<td.*?>(.*?)</td>","g"),s=l.match(t);for(let t=0;t<s.length;t++){let l=[],c=s[t].match(o);if(null!=c)for(let e=0;e<c.length;e++){let t=c[e].replace(/<td.*?>/g,"").replace(/<\/td>/g,"");l.push(t)}e.push(l)}let r,a=U.luckysheet_copy_save.copyRange[0].row[0],n=U.luckysheet_copy_save.copyRange[0].row[1],i=U.luckysheet_copy_save.copyRange[0].column[0],u=U.luckysheet_copy_save.copyRange[0].column[1],h=U.luckysheet_copy_save.dataSheetIndex;r=h==U.currentSheetIndex?B.deepCopyFlowData(U.flowdata):U.luckysheetfile[pe(h)].data;for(let t=a;t<=n&&!(t-a>e.length-1);t++)for(let l=i;l<=u;l++){let o,s=r[t][l];if((null==s||null==s.mc||null!=s.mc.rs)&&(null==(o=null!=s?null!=s.ct&&s.ct.fa.indexOf("w")>-1?r[t][l].v:r[t][l].m:"")&&(o=""),e[t-a][l-i]!=o)){c=!1;break}}}const o=N().fontjson;if(!Y.createHookFunction("rangePasteBefore",U.luckysheet_select_save,l))return;if(l.indexOf("luckysheet_copy_action_table")>-1&&null!=U.luckysheet_copy_save.copyRange&&U.luckysheet_copy_save.copyRange.length>0&&c)U.luckysheet_paste_iscut?(U.luckysheet_paste_iscut=!1,w.pasteHandlerOfCutPaste(U.luckysheet_copy_save),w.clearcopy(e)):w.pasteHandlerOfCopyPaste(U.luckysheet_copy_save);else if(l.indexOf("luckysheet_copy_action_image")>-1)r.pasteImgItem();else if(l.indexOf("table")>-1){$("#luckysheet-copy-content").html(l);let e=new Array($("#luckysheet-copy-content").find("table tr").length),t=0;$("#luckysheet-copy-content").find("table tr").eq(0).find("td").each(function(){let e=parseInt($(this).attr("colspan"));isNaN(e)&&(e=1),t+=e});for(let l=0;l<e.length;l++)e[l]=new Array(t);let c=0,s={};$("#luckysheet-copy-content").find("table tr").each(function(){let l=0;$(this).find("td").each(function(){let r=$(this),a={},n=r.text();if(0==$.trim(n).length)a.v=null,a.m="";else{let e=Le(r.text());a.v=e[2],a.ct=e[1],a.m=e[0]}let u=r.css("background-color");"rgba(0, 0, 0, 0)"==u&&(u=null),a.bg=u;let h=r.css("font-weight");a.bl=400==h||"normal"==h?0:1;let d=r.css("font-style");a.it="normal"==d?0:1;let m=r.css("font-family").split(",");for(let e=0;e<m.length;e++){let t=$.trim(m[e].toLowerCase());if(null!=(t=o[t])){a.ff=t;break}a.ff=0}let f=Math.floor(72*parseInt(r.css("font-size"))/96)+1;a.fs=f;let y=r.css("color");a.fc=y;let g=r.css("text-align");a.ht="center"==g?0:"right"==g?2:1;let k=r.css("vertical-align");for(a.vt="middle"==k?0:"top"==k||"text-top"==k?1:2;l<t&&null!=e[c][l];)l++;if(l==t)return!0;if(null==e[c][l]){e[c][l]=a;let t=parseInt(r.attr("rowspan")),o=parseInt(r.attr("colspan"));isNaN(t)&&(t=1),isNaN(o)&&(o=1);let n=U.luckysheet_select_save[0].row[0]+c,u=U.luckysheet_select_save[0].column[0]+l;for(let a=0;a<t;a++)for(let h=0;h<o;h++){if(0==a){let e=r.css("border-top");if(null!=e&&e.length>0&&"0px"!=e.substr(0,3).toLowerCase()){let e=r.css("border-top-width"),t=r.css("border-top-style"),o=r.css("border-top-color"),n=i.getQKBorder(e,t,o);null==s[c+a+"_"+(l+h)]&&(s[c+a+"_"+(l+h)]={}),s[c+a+"_"+(l+h)].t={style:n[0],color:n[1]}}}if(a==t-1){let e=r.css("border-bottom");if(null!=e&&e.length>0&&"0px"!=e.substr(0,3).toLowerCase()){let e=r.css("border-bottom-width"),t=r.css("border-bottom-style"),o=r.css("border-bottom-color"),n=i.getQKBorder(e,t,o);null==s[c+a+"_"+(l+h)]&&(s[c+a+"_"+(l+h)]={}),s[c+a+"_"+(l+h)].b={style:n[0],color:n[1]}}}if(0==h){let e=r.css("border-left");if(null!=e&&e.length>0&&"0px"!=e.substr(0,3).toLowerCase()){let e=r.css("border-left-width"),t=r.css("border-left-style"),o=r.css("border-left-color"),n=i.getQKBorder(e,t,o);null==s[c+a+"_"+(l+h)]&&(s[c+a+"_"+(l+h)]={}),s[c+a+"_"+(l+h)].l={style:n[0],color:n[1]}}}if(h==o-1){let e=r.css("border-right");if(null!=e&&e.length>0&&"0px"!=e.substr(0,3).toLowerCase()){let e=r.css("border-right-width"),t=r.css("border-right-style"),o=r.css("border-right-color"),n=i.getQKBorder(e,t,o);null==s[c+a+"_"+(l+h)]&&(s[c+a+"_"+(l+h)]={}),s[c+a+"_"+(l+h)].r={style:n[0],color:n[1]}}}0==a&&0==h||(e[c+a][l+h]={mc:{r:n,c:u}})}if(t>1||o>1){let s={rs:t,cs:o,r:n,c:u};e[c][l].mc=s}}return++l==t||void 0}),c++}),U.luckysheet_selection_range=[],w.pasteHandler(e,s),$("#luckysheet-copy-content").empty()}else{if(1==t.files.length&&t.files[0].type.indexOf("image")>-1){let e=new FileReader;return e.readAsDataURL(t.files[0]),void(e.onload=function(e){let t=e.target.result;r.inserImg(t)})}l=t.getData("text/plain"),w.pasteHandler(l)}}else if($(e.target).closest("#luckysheet-rich-text-editor").length>0){e.preventDefault();let t=window.clipboardData;t||(t=e.originalEvent.clipboardData);let l=t.getData("text/plain");document.execCommand("insertText",!1,l)}}),t.enablePage&&$("#luckysheet-bottom-page-next").click(function(){let e=t.pageInfo.queryExps,l=t.pageInfo.reportId,c=t.pageInfo.fields,o=t.pageInfo.mobile,s=t.pageInfo.frezon,r=t.pageInfo.currentPage,a=(t.pageInfo.totalPage,t.pageInfo.pageUrl);Y.addDataAjax({queryExps:e,reportId:l,fields:c,mobile:o,frezon:s,pageIndex:r,currentPage:r},U.currentSheetIndex,a,function(){if(t.pageInfo.currentPage++,t.pageInfo.totalPage==t.pageInfo.currentPage){$("#luckysheet-bottom-page-next").hide();let e=he(_.pageInfoFull,{total:t.total,totalPage:t.pageInfo.totalPage});$("#luckysheet-bottom-page-info").html(e)}else{let e=he(_.pageInfo,{total:t.total,totalPage:t.pageInfo.totalPage,currentPage:t.pageInfo.currentPage});$("#luckysheet-bottom-page-info").html(e)}})}).mousedown(function(e){e.stopPropagation()}),$("#luckysheet-bottom-bottom-top").click(function(){$("#luckysheet-scrollbar-y").scrollTop(0)}).mousedown(function(e){e.stopPropagation()})}});
//# sourceMappingURL=../sourcemaps/controllers/handler.js.map
