/**
 * skylark-lucksheet - A version of lucksheet.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["./luckysheetConfigsetting","./menuButton","./conditionformat","./server","./updateCell","./constant","./sheetMove","./select","./selection","./searchReplace","./controlHistory","./imageCtrl","../utils/util","../methods/get","../global/validate","../global/cursorPos","../global/formula","../global/cleargridelement","../global/tooltip","../locale/locale","./inlineString","../store"],function(e,t,l,s,c,i,a,n,u,o,r,h,f,d,y,g,k,p,v,_,m,w){"use strict";const{luckysheetupdateCell:b,setCenterInputPosition:C}=c,{keycode:x}=i,{luckysheetMoveHighlightCell:I,luckysheetMoveHighlightCell2:O,luckysheetMoveHighlightRange:R,luckysheetMoveHighlightRange2:S}=a,{selectHightlightShow:D,selectIsOverlap:U}=n,{getByteLen:E,getNowDateTime:F,luckysheetactiveCell:T}=f,{getSheetIndex:P}=d,{hasPartMC:M,isEditMode:K}=y,{luckysheetRangeLast:N}=g,{enterKeyControll:H}=m;let L=!1;function W(e,t,l,s){if(!$("#luckysheet-formula-search-c").is(":visible")||"up"!=e&&"down"!=e){if($("#luckysheet-formula-functionrange-select").is(":visible")){if(t&&l)S(e,"rangeOfFormula");else if(t)O(e,"rangeOfFormula");else if(l){let t=e,l=1;"up"==e&&(t="down",l=-1),"left"==e&&(t="right",l=-1),R(t,l,"rangeOfFormula")}else{let t=e,l=1;"up"==e&&(t="down",l=-1),"left"==e&&(t="right",l=-1),I(t,l,"rangeOfFormula")}s.preventDefault()}else if(k.israngeseleciton()){let c=$(window.getSelection().anchorNode);if(null==c.parent().next().text()||""==c.parent().next().text()){let c=$("#luckysheet-input-box #luckysheet-input-box-index").text(),i=k.getcellrange(c);null==i&&(i=k.getcellrange($("#luckysheet-input-box-index").text()));let a=i.row[0],n=i.row[1],u=i.column[0],o=i.column[1],r=w.visibledatarow[n],h=a-1==-1?0:w.visibledatarow[a-1],f=w.visibledatacolumn[o],d=u-1==-1?0:w.visibledatacolumn[u-1];if(k.func_selectedrange={left:d,width:f-d-1,top:h,height:r-h-1,left_move:d,width_move:f-d-1,top_move:h,height_move:r-h-1,row:[a,n],column:[u,o],row_focus:a,column_focus:u},k.rangeSetValue({row:[a,n],column:[u,o]}),k.rangestart=!0,k.rangedrag_column_start=!1,k.rangedrag_row_start=!1,t&&l)S(e,"rangeOfFormula");else if(t)O(e,"rangeOfFormula");else if(l){let t=e,l=1;"up"==e&&(t="down",l=-1),"left"==e&&(t="right",l=-1),R(t,l,"rangeOfFormula")}else{let t=e,l=1;"up"==e&&(t="down",l=-1),"left"==e&&(t="right",l=-1),I(t,l,"rangeOfFormula")}s.preventDefault()}}else if(!t&&!l){let t=$(window.getSelection().anchorNode),l=window.getSelection().anchorOffset;"up"==e?t.parent().is("span")&&0==t.parent().next().length&&l>0?(k.updatecell(w.luckysheetCellUpdate[0],w.luckysheetCellUpdate[1]),I("down",-1,"rangeOfSelect"),s.preventDefault()):t.is("#luckysheet-rich-text-editor")&&t.context.childElementCount==l?(k.updatecell(w.luckysheetCellUpdate[0],w.luckysheetCellUpdate[1]),I("down",-1,"rangeOfSelect"),s.preventDefault()):t.parent().is("#luckysheet-rich-text-editor")&&t.context.length==l&&(k.updatecell(w.luckysheetCellUpdate[0],w.luckysheetCellUpdate[1]),I("down",-1,"rangeOfSelect"),s.preventDefault()):"down"==e?t.parent().is("span")&&0==t.parent().next().length&&l>0?(k.updatecell(w.luckysheetCellUpdate[0],w.luckysheetCellUpdate[1]),I("down",1,"rangeOfSelect"),s.preventDefault()):t.is("#luckysheet-rich-text-editor")&&t.context.childElementCount==l?(k.updatecell(w.luckysheetCellUpdate[0],w.luckysheetCellUpdate[1]),I("down",1,"rangeOfSelect"),s.preventDefault()):t.parent().is("#luckysheet-rich-text-editor")&&t.context.length==l&&(k.updatecell(w.luckysheetCellUpdate[0],w.luckysheetCellUpdate[1]),I("down",1,"rangeOfSelect"),s.preventDefault()):"left"==e?t.parent().is("span")&&0==t.parent().prev().length&&0==l?(k.updatecell(w.luckysheetCellUpdate[0],w.luckysheetCellUpdate[1]),I("right",-1,"rangeOfSelect"),s.preventDefault()):t.is("#luckysheet-rich-text-editor")&&1==l?(k.updatecell(w.luckysheetCellUpdate[0],w.luckysheetCellUpdate[1]),I("right",-1,"rangeOfSelect"),s.preventDefault()):t.parent().is("#luckysheet-rich-text-editor")&&0==l?(k.updatecell(w.luckysheetCellUpdate[0],w.luckysheetCellUpdate[1]),I("right",-1,"rangeOfSelect"),s.preventDefault()):k.rangeHightlightselected($("#luckysheet-rich-text-editor")):"right"==e&&(t.parent().is("span")&&0==t.parent().next().length&&l>0?(k.updatecell(w.luckysheetCellUpdate[0],w.luckysheetCellUpdate[1]),I("right",1,"rangeOfSelect"),s.preventDefault()):t.is("#luckysheet-rich-text-editor")&&t.context.childElementCount==l?(k.updatecell(w.luckysheetCellUpdate[0],w.luckysheetCellUpdate[1]),I("right",1,"rangeOfSelect"),s.preventDefault()):t.parent().is("#luckysheet-rich-text-editor")&&t.context.length==l?(k.updatecell(w.luckysheetCellUpdate[0],w.luckysheetCellUpdate[1]),I("right",1,"rangeOfSelect"),s.preventDefault()):k.rangeHightlightselected($("#luckysheet-rich-text-editor")))}}else{let t;"down"==e?0==(t=$("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item-active").next()).length&&(t=$("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item").first()):"up"==e&&0==(t=$("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item-active").prev()).length&&(t=$("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item").last()),$("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item").removeClass("luckysheet-formula-search-item-active"),t.addClass("luckysheet-formula-search-item-active"),s.preventDefault()}}return{keyboardInitial:function(){const c=_().drag;$("#luckysheet-input-box").click(function(){k.rangeHightlightselected($("#luckysheet-rich-text-editor"))}).add("#"+w.container).on("keydown",function(s){let i=s.ctrlKey,a=s.altKey,n=s.shiftKey,f=s.keyCode;if($("#luckysheet-modal-dialog-mask").is(":visible")||$(s.target).hasClass("luckysheet-mousedown-cancel")||$(s.target).hasClass("sp-input")||parseInt($("#luckysheet-input-box").css("top"))>0&&$(s.target).closest(".luckysheet-input-box").length>0&&f!=x.ENTER&&f!=x.TAB&&f!=x.UP&&f!=x.DOWN&&f!=x.LEFT&&f!=x.RIGHT){let e=$(window.getSelection().anchorNode);if((e.parent().is("#luckysheet-helpbox-cell")||e.is("#luckysheet-helpbox-cell"))&&f==x.ENTER){let e=$("#luckysheet-helpbox-cell").text();if(k.iscelldata(e)){let t=k.getcellrange(e);w.luckysheet_select_save=[{row:t.row,column:t.column,row_focus:t.row[0],column_focus:t.column[0]}],D(),$("#luckysheet-helpbox-cell").blur();let l=$("#luckysheet-cell-main").scrollLeft(),s=$("#luckysheet-cell-main").scrollTop(),c=$("#luckysheet-cell-main").height(),i=$("#luckysheet-cell-main").width(),a=w.visibledatarow[t.row[1]],n=t.row[0]-1==-1?0:w.visibledatarow[t.row[0]-1],u=w.visibledatacolumn[t.column[1]],o=t.column[0]-1==-1?0:w.visibledatacolumn[t.column[0]-1];u-l-i+20>0?$("#luckysheet-scrollbar-x").scrollLeft(u-i+20):o-l-20<0&&$("#luckysheet-scrollbar-x").scrollLeft(o-20),a-s-c+20>0?$("#luckysheet-scrollbar-y").scrollTop(a-c+20):n-s-20<0&&$("#luckysheet-scrollbar-y").scrollTop(n-20)}}return}if($("#luckysheet-modal-dialog-mask").is(":visible")||$(s.target).hasClass("luckysheet-mousedown-cancel")||$(s.target).hasClass("formulaInputFocus"))return;let d=$("#luckysheet-input-box");if((a||s.metaKey)&&f==x.ENTER&&parseInt(d.css("top"))>0){let e=w.luckysheet_select_save[w.luckysheet_select_save.length-1],t=e.row_focus,l=e.column_focus;H(w.flowdata[t][l]),s.preventDefault()}else if(f==x.ENTER&&parseInt(d.css("top"))>0)$("#luckysheet-formula-search-c").is(":visible")&&null!=k.searchFunctionCell?k.searchFunctionEnter($("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item-active")):(k.updatecell(w.luckysheetCellUpdate[0],w.luckysheetCellUpdate[1]),w.luckysheet_select_save=[{row:[w.luckysheetCellUpdate[0],w.luckysheetCellUpdate[0]],column:[w.luckysheetCellUpdate[1],w.luckysheetCellUpdate[1]],row_focus:w.luckysheetCellUpdate[0],column_focus:w.luckysheetCellUpdate[1]}],I("down",1,"rangeOfSelect")),$("#luckysheet-search-formula-parm").is(":visible")&&$("#luckysheet-search-formula-parm").hide(),$("#luckysheet-search-formula-parm-select").is(":visible")&&$("#luckysheet-search-formula-parm-select").hide(),s.preventDefault();else if(f==x.TAB){if(parseInt(d.css("top"))>0)return;I("right",1,"rangeOfSelect"),s.preventDefault()}else if(f==x.F2){if(parseInt(d.css("top"))>0)return;let e=w.luckysheet_select_save[w.luckysheet_select_save.length-1],t=e.row_focus,l=e.column_focus;b(t,l,w.flowdata),s.preventDefault()}else if(f==x.F4&&parseInt(d.css("top"))>0)k.setfreezonFuc(s),s.preventDefault();else if(f==x.ESC&&parseInt(d.css("top"))>0)k.dontupdate(),I("down",0,"rangeOfSelect"),s.preventDefault();else if(f==x.ENTER){if($(s.target).hasClass("formulaInputFocus")||$("#luckysheet-conditionformat-dialog").is(":visible"))return;if(null!=String.fromCharCode(f)&&$("#luckysheet-cell-selected").is(":visible")){let e=w.luckysheet_select_save[w.luckysheet_select_save.length-1],t=e.row_focus,l=e.column_focus;b(t,l,w.flowdata),s.preventDefault()}}else{if(i||s.metaKey){if(n){if(L||(w.luckysheet_shiftpositon=$.extend(!0,{},w.luckysheet_select_save[w.luckysheet_select_save.length-1]),w.luckysheet_shiftkeydown=!0),f==x.UP){if(parseInt(d.css("top"))>0||$("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible"))return;S("up","rangeOfSelect")}else if(f==x.DOWN){if(parseInt(d.css("top"))>0||$("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible"))return;S("down","rangeOfSelect")}else if(f==x.LEFT){if(parseInt(d.css("top"))>0||$("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible"))return;S("left","rangeOfSelect")}else if(f==x.RIGHT){if(parseInt(d.css("top"))>0||$("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible"))return;S("right","rangeOfSelect")}else if(186==f||222==f){let e=w.luckysheet_select_save[w.luckysheet_select_save.length-1],t=e.row_focus,l=e.column_focus;b(t,l,w.flowdata,!0);let s=F(2);$("#luckysheet-rich-text-editor").html(s),N($("#luckysheet-rich-text-editor")[0]),k.functionInputHanddler($("#luckysheet-functionbox-cell"),$("#luckysheet-rich-text-editor"),f)}}else if(66==f)$("#luckysheet-icon-bold").click();else{if(67==f){if(null!=h.currentImgId)return void h.copyImgItem(s);if(t.luckysheetPaintModelOn&&t.cancelPaintModel(),0==w.luckysheet_select_save.length)return;if(null!=w.config.merge){let e=!1;for(let t=0;t<w.luckysheet_select_save.length;t++){let l=w.luckysheet_select_save[t].row[0],s=w.luckysheet_select_save[t].row[1],c=w.luckysheet_select_save[t].column[0],i=w.luckysheet_select_save[t].column[1];if(e=M(w.config,l,s,c,i))break}if(e)return void(K()?alert(c.noMerge):v.info(c.noMerge,""))}let e=w.luckysheetfile[P(w.currentSheetIndex)].luckysheet_conditionformat_save;if(w.luckysheet_select_save.length>1&&null!=e&&e.length>0){let e=!1,t=l.getComputeMap();e:for(let s=0;s<w.luckysheet_select_save.length&&!e;s++){let c=w.luckysheet_select_save[s].row[0],i=w.luckysheet_select_save[s].row[1],a=w.luckysheet_select_save[s].column[0],n=w.luckysheet_select_save[s].column[1];for(let s=c;s<=i;s++)for(let c=a;c<=n;c++)if(null!=l.checksCF(s,c,t)){e=!0;continue e}}if(e)return void(K()?alert(c.noMulti):v.info(c.noMulti,""))}if(w.luckysheet_select_save.length>1){let e=!0,t=w.luckysheet_select_save[0].row[0],l=w.luckysheet_select_save[0].row[1],s=!0,i=w.luckysheet_select_save[0].column[0],a=w.luckysheet_select_save[0].column[1];for(let c=1;c<w.luckysheet_select_save.length;c++)w.luckysheet_select_save[c].row[0]==t&&w.luckysheet_select_save[c].row[1]==l||(e=!1),w.luckysheet_select_save[c].column[0]==i&&w.luckysheet_select_save[c].column[1]==a||(s=!1);if(!e&&!s||U())return void(K()?alert(c.noMulti):v.info(c.noMulti,""))}return u.copy(s),w.luckysheet_paste_iscut=!1,T(),void s.stopPropagation()}if(70==f)o.createDialog(0),o.init(),$("#luckysheet-search-replace #searchInput input").focus();else if(72==f)o.createDialog(1),o.init(),$("#luckysheet-search-replace #searchInput input").focus();else if(73==f)$("#luckysheet-icon-italic").click();else{if(86==f){if(K())return;if($(s.target).hasClass("formulaInputFocus"))return;return w.luckysheet_select_save.length>1?void(K()?alert(c.noPaste):v.info(c.noPaste,"")):(u.isPasteAction=!0,T(),void s.stopPropagation())}if(88==f){if(t.luckysheetPaintModelOn&&t.cancelPaintModel(),0==w.luckysheet_select_save.length)return;if(null!=w.config.merge){let t=!1;for(let e=0;e<w.luckysheet_select_save.length;e++){let l=w.luckysheet_select_save[e].row[0],s=w.luckysheet_select_save[e].row[1],c=w.luckysheet_select_save[e].column[0],i=w.luckysheet_select_save[e].column[1];if(t=M(w.config,l,s,c,i))break}if(t)return void(e.editMode?alert(_locale_drag.noMerge):v.info(_locale_drag.noMerge,""))}return w.luckysheet_select_save.length>1?void(K()?alert(c.noMulti):v.info(c.noMulti,"")):(u.copy(s),w.luckysheet_paste_iscut=!0,T(),void s.stopPropagation())}if(90==f)return r.redo(s),T(),void s.stopPropagation();if(89==f)return r.undo(s),T(),void s.stopPropagation();if(f==x.UP){if(parseInt(d.css("top"))>0||$("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible"))return;O("up","rangeOfSelect")}else if(f==x.DOWN){if(parseInt(d.css("top"))>0||$("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible"))return;O("down","rangeOfSelect")}else if(f==x.LEFT){if(parseInt(d.css("top"))>0||$("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible"))return;O("left","rangeOfSelect")}else if(f==x.RIGHT){if(parseInt(d.css("top"))>0||$("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible"))return;O("right","rangeOfSelect")}else if(186==f){let e=w.luckysheet_select_save[w.luckysheet_select_save.length-1],t=e.row_focus,l=e.column_focus;b(t,l,w.flowdata,!0);let s=F(1);$("#luckysheet-rich-text-editor").html(s),N($("#luckysheet-rich-text-editor")[0]),k.functionInputHanddler($("#luckysheet-functionbox-cell"),$("#luckysheet-rich-text-editor"),f)}else if(222==f){let e=w.luckysheet_select_save[w.luckysheet_select_save.length-1],t=e.row_focus,l=e.column_focus;b(t,l,w.flowdata,!0);let s=F(2);$("#luckysheet-rich-text-editor").html(s),N($("#luckysheet-rich-text-editor")[0]),k.functionInputHanddler($("#luckysheet-functionbox-cell"),$("#luckysheet-rich-text-editor"),f)}else"A"==String.fromCharCode(f).toLocaleUpperCase()&&$("#luckysheet-left-top").click()}}return void s.preventDefault()}if(n&&(f==x.UP||f==x.DOWN||f==x.LEFT||f==x.RIGHT||a&&(53==f||101==f))){if(parseInt(d.css("top"))>0||$(s.target).hasClass("formulaInputFocus"))return;if(L||(w.luckysheet_shiftpositon=$.extend(!0,{},w.luckysheet_select_save[w.luckysheet_select_save.length-1]),w.luckysheet_shiftkeydown=!0),f==x.UP){if($("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible"))return;R("down",-1,"rangeOfSelect")}else if(f==x.DOWN){if($("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible"))return;R("down",1,"rangeOfSelect")}else if(f==x.LEFT){if($("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible"))return;R("right",-1,"rangeOfSelect")}else if(f==x.RIGHT){if($("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible"))return;R("right",1,"rangeOfSelect")}else!a||53!=f&&101!=f||$("#luckysheet-icon-strikethrough").click();s.preventDefault()}else if(f==x.ESC)t.luckysheetPaintModelOn?t.cancelPaintModel():(p(s),s.preventDefault()),D();else if(f==x.DELETE||f==x.BACKSPACE)null!=h.currentImgId?h.removeImgItem():$("#luckysheet-delete-text").click(),s.preventDefault();else if(8==f&&null!=h.currentImgId)h.removeImgItem(),s.preventDefault();else if(f==x.UP){if(parseInt(d.css("top"))>0||w.luckysheet_cell_selected_move||w.luckysheet_cell_selected_extend||$(s.target).hasClass("formulaInputFocus")||$("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible"))return;I("down",-1,"rangeOfSelect"),s.preventDefault()}else if(f==x.DOWN){if(parseInt(d.css("top"))>0||w.luckysheet_cell_selected_move||w.luckysheet_cell_selected_extend||$(s.target).hasClass("formulaInputFocus")||$("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible"))return;I("down",1,"rangeOfSelect"),s.preventDefault()}else if(f==x.LEFT){if(parseInt(d.css("top"))>0||w.luckysheet_cell_selected_move||w.luckysheet_cell_selected_extend||$(s.target).hasClass("formulaInputFocus")||$("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible"))return;I("right",-1,"rangeOfSelect"),s.preventDefault()}else if(f==x.RIGHT){if(parseInt(d.css("top"))>0||w.luckysheet_cell_selected_move||w.luckysheet_cell_selected_extend||$(s.target).hasClass("formulaInputFocus")||$("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible"))return;I("right",1,"rangeOfSelect"),s.preventDefault()}else if((!(f>=112&&f<=123||f<=46||144==f||108==f||s.ctrlKey||s.altKey||s.shiftKey&&(37==f||38==f||39==f||40==f))||8==f||32==f||46==f||0==f||s.ctrlKey&&86==f)&&null!=String.fromCharCode(f)&&$("#luckysheet-cell-selected").is(":visible")&&f!=x.CAPSLOCK&&f!=x.WIN&&18!=f){let e=w.luckysheet_select_save[w.luckysheet_select_save.length-1],t=e.row_focus,l=e.column_focus;b(t,l,w.flowdata,!0),8==f&&$("#luckysheet-rich-text-editor").html("<br/>"),k.functionInputHanddler($("#luckysheet-functionbox-cell"),$("#luckysheet-rich-text-editor"),f)}}T(),s.stopPropagation()}),$("#"+w.container).add("#luckysheet-input-box").keydown(function(e){if($("#luckysheet-modal-dialog-mask").is(":visible")||$(e.target).hasClass("luckysheet-mousedown-cancel")||$(e.target).hasClass("formulaInputFocus"))return;let t=e.ctrlKey,l=(e.altKey,e.shiftKey),s=e.keyCode,c=$("#luckysheet-input-box");s==x.ESC&&parseInt($("#luckysheet-input-box").css("top"))>0?(k.dontupdate(),I("down",0,"rangeOfSelect"),e.preventDefault()):s==x.ENTER&&parseInt(c.css("top"))>0?$("#luckysheet-formula-search-c").is(":visible")&&null!=k.searchFunctionCell&&(k.searchFunctionEnter($("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item-active")),e.preventDefault()):s==x.TAB&&parseInt(c.css("top"))>0?($("#luckysheet-formula-search-c").is(":visible")&&null!=k.searchFunctionCell?k.searchFunctionEnter($("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item-active")):(k.updatecell(w.luckysheetCellUpdate[0],w.luckysheetCellUpdate[1]),I("right",1,"rangeOfSelect")),e.preventDefault()):s==x.F4&&parseInt(c.css("top"))>0?(k.setfreezonFuc(e),e.preventDefault()):s==x.UP&&parseInt(c.css("top"))>0?W("up",t,l,e):s==x.DOWN&&parseInt(c.css("top"))>0?W("down",t,l,e):s==x.LEFT&&parseInt(c.css("top"))>0?W("left",t,l,e):s==x.RIGHT&&parseInt(c.css("top"))>0?W("right",t,l,e):(!(s>=112&&s<=123||s<=46||144==s||108==s||e.ctrlKey||e.altKey||e.shiftKey&&(37==s||38==s||39==s||40==s||s==x.WIN||s==x.WIN_R||s==x.MENU))||8==s||32==s||46==s||e.ctrlKey&&86==s)&&(k.functionInputHanddler($("#luckysheet-functionbox-cell"),$("#luckysheet-rich-text-editor"),s),C(w.luckysheetCellUpdate[0],w.luckysheetCellUpdate[1],w.flowdata))}).keyup(function(e){let t=e.keyCode;e.shiftKey||16!=t||(w.luckysheet_shiftkeydown=!1,w.luckysheet_shiftpositon=null),parseInt($("#luckysheet-input-box").css("top")),e.preventDefault()}),$("#luckysheet_info_detail_input").val(s.title).css("width",10*E(s.title)).keydown(function(){event.ctrlKey,event.altKey,event.shiftKey;let e=event.keyCode,t=$(this);e==x.ENTER&&t.blur().change()}).bind("input propertychange",function(){let e=$(this),t=10*E(e.val()),l=$("#luckysheet_info_detail_update").outerWidth(),s=$("#luckysheet_info_detail_save").outerWidth(),c=$("#luckysheet_info_detail_user").parent().outerWidth()+60,i=$("#"+w.container).outerWidth()-s-l-c-100;t>i?$("#luckysheet_info_detail_input").css("width",i):$("#luckysheet_info_detail_input").css("width",t)}).change(function(){s.saveParam("na",null,$(this).val())}),$("#"+w.container).add("input.luckysheet-mousedown-cancel").keydown(function(e){const t=e.target.closest(".luckysheet-cols-menuitem");void 0!==t&&null!=t&&13===e.keyCode&&$(t).trigger("click")})}}});
//# sourceMappingURL=../sourcemaps/controllers/keyboard.js.map
