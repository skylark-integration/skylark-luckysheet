/**
 * skylark-lucksheet - A version of lucksheet.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["../methods/luckysheetConfigsetting","./menuButton","./conditionformat","./updateCell","../widgets/constant","./sheetMove","../widgets/select","./selection","./searchReplace","./controlHistory","../widgets/imageCtrl","../utils/util","../methods/get","../methods/validate","../widgets/cursorPos","./formula","../widgets/cleargridelement","../widgets/tooltip","../locale/locale","./inlineString","../store"],function(e,t,l,s,c,i,a,n,u,o,r,h,f,d,y,g,k,p,v,_,m){"use strict";const{luckysheetupdateCell:w,setCenterInputPosition:C}=s,{keycode:b}=c,{luckysheetMoveHighlightCell:x,luckysheetMoveHighlightCell2:I,luckysheetMoveHighlightRange:O,luckysheetMoveHighlightRange2:R}=i,{selectHightlightShow:S,selectIsOverlap:D}=a,{getByteLen:U,getNowDateTime:E,luckysheetactiveCell:F}=h,{getSheetIndex:T}=f,{hasPartMC:P}=d,M=e.isEditMode,{luckysheetRangeLast:K}=y,{enterKeyControll:N}=_;let H=!1;function L(e,t,l,s){if(!$("#luckysheet-formula-search-c").is(":visible")||"up"!=e&&"down"!=e){if($("#luckysheet-formula-functionrange-select").is(":visible")){if(t&&l)R(e,"rangeOfFormula");else if(t)I(e,"rangeOfFormula");else if(l){let t=e,l=1;"up"==e&&(t="down",l=-1),"left"==e&&(t="right",l=-1),O(t,l,"rangeOfFormula")}else{let t=e,l=1;"up"==e&&(t="down",l=-1),"left"==e&&(t="right",l=-1),x(t,l,"rangeOfFormula")}s.preventDefault()}else if(g.israngeseleciton()){let c=$(window.getSelection().anchorNode);if(null==c.parent().next().text()||""==c.parent().next().text()){let c=$("#luckysheet-input-box #luckysheet-input-box-index").text(),i=g.getcellrange(c);null==i&&(i=g.getcellrange($("#luckysheet-input-box-index").text()));let a=i.row[0],n=i.row[1],u=i.column[0],o=i.column[1],r=m.visibledatarow[n],h=a-1==-1?0:m.visibledatarow[a-1],f=m.visibledatacolumn[o],d=u-1==-1?0:m.visibledatacolumn[u-1];if(g.func_selectedrange={left:d,width:f-d-1,top:h,height:r-h-1,left_move:d,width_move:f-d-1,top_move:h,height_move:r-h-1,row:[a,n],column:[u,o],row_focus:a,column_focus:u},g.rangeSetValue({row:[a,n],column:[u,o]}),g.rangestart=!0,g.rangedrag_column_start=!1,g.rangedrag_row_start=!1,t&&l)R(e,"rangeOfFormula");else if(t)I(e,"rangeOfFormula");else if(l){let t=e,l=1;"up"==e&&(t="down",l=-1),"left"==e&&(t="right",l=-1),O(t,l,"rangeOfFormula")}else{let t=e,l=1;"up"==e&&(t="down",l=-1),"left"==e&&(t="right",l=-1),x(t,l,"rangeOfFormula")}s.preventDefault()}}else if(!t&&!l){let t=$(window.getSelection().anchorNode),l=window.getSelection().anchorOffset;"up"==e?t.parent().is("span")&&0==t.parent().next().length&&l>0?(g.updatecell(m.luckysheetCellUpdate[0],m.luckysheetCellUpdate[1]),x("down",-1,"rangeOfSelect"),s.preventDefault()):t.is("#luckysheet-rich-text-editor")&&t.context.childElementCount==l?(g.updatecell(m.luckysheetCellUpdate[0],m.luckysheetCellUpdate[1]),x("down",-1,"rangeOfSelect"),s.preventDefault()):t.parent().is("#luckysheet-rich-text-editor")&&t.context.length==l&&(g.updatecell(m.luckysheetCellUpdate[0],m.luckysheetCellUpdate[1]),x("down",-1,"rangeOfSelect"),s.preventDefault()):"down"==e?t.parent().is("span")&&0==t.parent().next().length&&l>0?(g.updatecell(m.luckysheetCellUpdate[0],m.luckysheetCellUpdate[1]),x("down",1,"rangeOfSelect"),s.preventDefault()):t.is("#luckysheet-rich-text-editor")&&t.context.childElementCount==l?(g.updatecell(m.luckysheetCellUpdate[0],m.luckysheetCellUpdate[1]),x("down",1,"rangeOfSelect"),s.preventDefault()):t.parent().is("#luckysheet-rich-text-editor")&&t.context.length==l&&(g.updatecell(m.luckysheetCellUpdate[0],m.luckysheetCellUpdate[1]),x("down",1,"rangeOfSelect"),s.preventDefault()):"left"==e?t.parent().is("span")&&0==t.parent().prev().length&&0==l?(g.updatecell(m.luckysheetCellUpdate[0],m.luckysheetCellUpdate[1]),x("right",-1,"rangeOfSelect"),s.preventDefault()):t.is("#luckysheet-rich-text-editor")&&1==l?(g.updatecell(m.luckysheetCellUpdate[0],m.luckysheetCellUpdate[1]),x("right",-1,"rangeOfSelect"),s.preventDefault()):t.parent().is("#luckysheet-rich-text-editor")&&0==l?(g.updatecell(m.luckysheetCellUpdate[0],m.luckysheetCellUpdate[1]),x("right",-1,"rangeOfSelect"),s.preventDefault()):g.rangeHightlightselected($("#luckysheet-rich-text-editor")):"right"==e&&(t.parent().is("span")&&0==t.parent().next().length&&l>0?(g.updatecell(m.luckysheetCellUpdate[0],m.luckysheetCellUpdate[1]),x("right",1,"rangeOfSelect"),s.preventDefault()):t.is("#luckysheet-rich-text-editor")&&t.context.childElementCount==l?(g.updatecell(m.luckysheetCellUpdate[0],m.luckysheetCellUpdate[1]),x("right",1,"rangeOfSelect"),s.preventDefault()):t.parent().is("#luckysheet-rich-text-editor")&&t.context.length==l?(g.updatecell(m.luckysheetCellUpdate[0],m.luckysheetCellUpdate[1]),x("right",1,"rangeOfSelect"),s.preventDefault()):g.rangeHightlightselected($("#luckysheet-rich-text-editor")))}}else{let t;"down"==e?0==(t=$("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item-active").next()).length&&(t=$("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item").first()):"up"==e&&0==(t=$("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item-active").prev()).length&&(t=$("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item").last()),$("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item").removeClass("luckysheet-formula-search-item-active"),t.addClass("luckysheet-formula-search-item-active"),s.preventDefault()}}return{keyboardInitial:function(){const s=v().drag;$("#luckysheet-input-box").click(function(){g.rangeHightlightselected($("#luckysheet-rich-text-editor"))}).add("#"+m.container).on("keydown",function(c){let i=c.ctrlKey,a=c.altKey,h=c.shiftKey,f=c.keyCode;if($("#luckysheet-modal-dialog-mask").is(":visible")||$(c.target).hasClass("luckysheet-mousedown-cancel")||$(c.target).hasClass("sp-input")||parseInt($("#luckysheet-input-box").css("top"))>0&&$(c.target).closest(".luckysheet-input-box").length>0&&f!=b.ENTER&&f!=b.TAB&&f!=b.UP&&f!=b.DOWN&&f!=b.LEFT&&f!=b.RIGHT){let e=$(window.getSelection().anchorNode);if((e.parent().is("#luckysheet-helpbox-cell")||e.is("#luckysheet-helpbox-cell"))&&f==b.ENTER){let e=$("#luckysheet-helpbox-cell").text();if(g.iscelldata(e)){let t=g.getcellrange(e);m.luckysheet_select_save=[{row:t.row,column:t.column,row_focus:t.row[0],column_focus:t.column[0]}],S(),$("#luckysheet-helpbox-cell").blur();let l=$("#luckysheet-cell-main").scrollLeft(),s=$("#luckysheet-cell-main").scrollTop(),c=$("#luckysheet-cell-main").height(),i=$("#luckysheet-cell-main").width(),a=m.visibledatarow[t.row[1]],n=t.row[0]-1==-1?0:m.visibledatarow[t.row[0]-1],u=m.visibledatacolumn[t.column[1]],o=t.column[0]-1==-1?0:m.visibledatacolumn[t.column[0]-1];u-l-i+20>0?$("#luckysheet-scrollbar-x").scrollLeft(u-i+20):o-l-20<0&&$("#luckysheet-scrollbar-x").scrollLeft(o-20),a-s-c+20>0?$("#luckysheet-scrollbar-y").scrollTop(a-c+20):n-s-20<0&&$("#luckysheet-scrollbar-y").scrollTop(n-20)}}return}if($("#luckysheet-modal-dialog-mask").is(":visible")||$(c.target).hasClass("luckysheet-mousedown-cancel")||$(c.target).hasClass("formulaInputFocus"))return;let d=$("#luckysheet-input-box");if((a||c.metaKey)&&f==b.ENTER&&parseInt(d.css("top"))>0){let e=m.luckysheet_select_save[m.luckysheet_select_save.length-1],t=e.row_focus,l=e.column_focus;N(m.flowdata[t][l]),c.preventDefault()}else if(f==b.ENTER&&parseInt(d.css("top"))>0)$("#luckysheet-formula-search-c").is(":visible")&&null!=g.searchFunctionCell?g.searchFunctionEnter($("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item-active")):(g.updatecell(m.luckysheetCellUpdate[0],m.luckysheetCellUpdate[1]),m.luckysheet_select_save=[{row:[m.luckysheetCellUpdate[0],m.luckysheetCellUpdate[0]],column:[m.luckysheetCellUpdate[1],m.luckysheetCellUpdate[1]],row_focus:m.luckysheetCellUpdate[0],column_focus:m.luckysheetCellUpdate[1]}],x("down",1,"rangeOfSelect")),$("#luckysheet-search-formula-parm").is(":visible")&&$("#luckysheet-search-formula-parm").hide(),$("#luckysheet-search-formula-parm-select").is(":visible")&&$("#luckysheet-search-formula-parm-select").hide(),c.preventDefault();else if(f==b.TAB){if(parseInt(d.css("top"))>0)return;x("right",1,"rangeOfSelect"),c.preventDefault()}else if(f==b.F2){if(parseInt(d.css("top"))>0)return;let e=m.luckysheet_select_save[m.luckysheet_select_save.length-1],t=e.row_focus,l=e.column_focus;w(t,l,m.flowdata),c.preventDefault()}else if(f==b.F4&&parseInt(d.css("top"))>0)g.setfreezonFuc(c),c.preventDefault();else if(f==b.ESC&&parseInt(d.css("top"))>0)g.dontupdate(),x("down",0,"rangeOfSelect"),c.preventDefault();else if(f==b.ENTER){if($(c.target).hasClass("formulaInputFocus")||$("#luckysheet-conditionformat-dialog").is(":visible"))return;if(null!=String.fromCharCode(f)&&$("#luckysheet-cell-selected").is(":visible")){let e=m.luckysheet_select_save[m.luckysheet_select_save.length-1],t=e.row_focus,l=e.column_focus;w(t,l,m.flowdata),c.preventDefault()}}else{if(i||c.metaKey){if(h){if(H||(m.luckysheet_shiftpositon=$.extend(!0,{},m.luckysheet_select_save[m.luckysheet_select_save.length-1]),m.luckysheet_shiftkeydown=!0),f==b.UP){if(parseInt(d.css("top"))>0||$("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible"))return;R("up","rangeOfSelect")}else if(f==b.DOWN){if(parseInt(d.css("top"))>0||$("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible"))return;R("down","rangeOfSelect")}else if(f==b.LEFT){if(parseInt(d.css("top"))>0||$("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible"))return;R("left","rangeOfSelect")}else if(f==b.RIGHT){if(parseInt(d.css("top"))>0||$("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible"))return;R("right","rangeOfSelect")}else if(186==f||222==f){let e=m.luckysheet_select_save[m.luckysheet_select_save.length-1],t=e.row_focus,l=e.column_focus;w(t,l,m.flowdata,!0);let s=E(2);$("#luckysheet-rich-text-editor").html(s),K($("#luckysheet-rich-text-editor")[0]),g.functionInputHanddler($("#luckysheet-functionbox-cell"),$("#luckysheet-rich-text-editor"),f)}}else if(66==f)$("#luckysheet-icon-bold").click();else{if(67==f){if(null!=r.currentImgId)return void r.copyImgItem(c);if(t.luckysheetPaintModelOn&&t.cancelPaintModel(),0==m.luckysheet_select_save.length)return;if(null!=m.config.merge){let e=!1;for(let t=0;t<m.luckysheet_select_save.length;t++){let l=m.luckysheet_select_save[t].row[0],s=m.luckysheet_select_save[t].row[1],c=m.luckysheet_select_save[t].column[0],i=m.luckysheet_select_save[t].column[1];if(e=P(m.config,l,s,c,i))break}if(e)return void(M()?alert(s.noMerge):p.info(s.noMerge,""))}let e=m.luckysheetfile[T(m.currentSheetIndex)].luckysheet_conditionformat_save;if(m.luckysheet_select_save.length>1&&null!=e&&e.length>0){let e=!1,t=l.getComputeMap();e:for(let s=0;s<m.luckysheet_select_save.length&&!e;s++){let c=m.luckysheet_select_save[s].row[0],i=m.luckysheet_select_save[s].row[1],a=m.luckysheet_select_save[s].column[0],n=m.luckysheet_select_save[s].column[1];for(let s=c;s<=i;s++)for(let c=a;c<=n;c++)if(null!=l.checksCF(s,c,t)){e=!0;continue e}}if(e)return void(M()?alert(s.noMulti):p.info(s.noMulti,""))}if(m.luckysheet_select_save.length>1){let e=!0,t=m.luckysheet_select_save[0].row[0],l=m.luckysheet_select_save[0].row[1],c=!0,i=m.luckysheet_select_save[0].column[0],a=m.luckysheet_select_save[0].column[1];for(let s=1;s<m.luckysheet_select_save.length;s++)m.luckysheet_select_save[s].row[0]==t&&m.luckysheet_select_save[s].row[1]==l||(e=!1),m.luckysheet_select_save[s].column[0]==i&&m.luckysheet_select_save[s].column[1]==a||(c=!1);if(!e&&!c||D())return void(M()?alert(s.noMulti):p.info(s.noMulti,""))}return n.copy(c),m.luckysheet_paste_iscut=!1,F(),void c.stopPropagation()}if(70==f)u.createDialog(0),u.init(),$("#luckysheet-search-replace #searchInput input").focus();else if(72==f)u.createDialog(1),u.init(),$("#luckysheet-search-replace #searchInput input").focus();else if(73==f)$("#luckysheet-icon-italic").click();else{if(86==f){if(M())return;if($(c.target).hasClass("formulaInputFocus"))return;return m.luckysheet_select_save.length>1?void(M()?alert(s.noPaste):p.info(s.noPaste,"")):(n.isPasteAction=!0,F(),void c.stopPropagation())}if(88==f){if(t.luckysheetPaintModelOn&&t.cancelPaintModel(),0==m.luckysheet_select_save.length)return;if(null!=m.config.merge){let t=!1;for(let e=0;e<m.luckysheet_select_save.length;e++){let l=m.luckysheet_select_save[e].row[0],s=m.luckysheet_select_save[e].row[1],c=m.luckysheet_select_save[e].column[0],i=m.luckysheet_select_save[e].column[1];if(t=P(m.config,l,s,c,i))break}if(t)return void(e.editMode?alert(_locale_drag.noMerge):p.info(_locale_drag.noMerge,""))}return m.luckysheet_select_save.length>1?void(M()?alert(s.noMulti):p.info(s.noMulti,"")):(n.copy(c),m.luckysheet_paste_iscut=!0,F(),void c.stopPropagation())}if(90==f)return o.redo(c),F(),void c.stopPropagation();if(89==f)return o.undo(c),F(),void c.stopPropagation();if(f==b.UP){if(parseInt(d.css("top"))>0||$("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible"))return;I("up","rangeOfSelect")}else if(f==b.DOWN){if(parseInt(d.css("top"))>0||$("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible"))return;I("down","rangeOfSelect")}else if(f==b.LEFT){if(parseInt(d.css("top"))>0||$("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible"))return;I("left","rangeOfSelect")}else if(f==b.RIGHT){if(parseInt(d.css("top"))>0||$("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible"))return;I("right","rangeOfSelect")}else if(186==f){let e=m.luckysheet_select_save[m.luckysheet_select_save.length-1],t=e.row_focus,l=e.column_focus;w(t,l,m.flowdata,!0);let s=E(1);$("#luckysheet-rich-text-editor").html(s),K($("#luckysheet-rich-text-editor")[0]),g.functionInputHanddler($("#luckysheet-functionbox-cell"),$("#luckysheet-rich-text-editor"),f)}else if(222==f){let e=m.luckysheet_select_save[m.luckysheet_select_save.length-1],t=e.row_focus,l=e.column_focus;w(t,l,m.flowdata,!0);let s=E(2);$("#luckysheet-rich-text-editor").html(s),K($("#luckysheet-rich-text-editor")[0]),g.functionInputHanddler($("#luckysheet-functionbox-cell"),$("#luckysheet-rich-text-editor"),f)}else"A"==String.fromCharCode(f).toLocaleUpperCase()&&$("#luckysheet-left-top").click()}}return void c.preventDefault()}if(h&&(f==b.UP||f==b.DOWN||f==b.LEFT||f==b.RIGHT||a&&(53==f||101==f))){if(parseInt(d.css("top"))>0||$(c.target).hasClass("formulaInputFocus"))return;if(H||(m.luckysheet_shiftpositon=$.extend(!0,{},m.luckysheet_select_save[m.luckysheet_select_save.length-1]),m.luckysheet_shiftkeydown=!0),f==b.UP){if($("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible"))return;O("down",-1,"rangeOfSelect")}else if(f==b.DOWN){if($("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible"))return;O("down",1,"rangeOfSelect")}else if(f==b.LEFT){if($("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible"))return;O("right",-1,"rangeOfSelect")}else if(f==b.RIGHT){if($("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible"))return;O("right",1,"rangeOfSelect")}else!a||53!=f&&101!=f||$("#luckysheet-icon-strikethrough").click();c.preventDefault()}else if(f==b.ESC)t.luckysheetPaintModelOn?t.cancelPaintModel():(k(c),c.preventDefault()),S();else if(f==b.DELETE||f==b.BACKSPACE)null!=r.currentImgId?r.removeImgItem():$("#luckysheet-delete-text").click(),c.preventDefault();else if(8==f&&null!=r.currentImgId)r.removeImgItem(),c.preventDefault();else if(f==b.UP){if(parseInt(d.css("top"))>0||m.luckysheet_cell_selected_move||m.luckysheet_cell_selected_extend||$(c.target).hasClass("formulaInputFocus")||$("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible"))return;x("down",-1,"rangeOfSelect"),c.preventDefault()}else if(f==b.DOWN){if(parseInt(d.css("top"))>0||m.luckysheet_cell_selected_move||m.luckysheet_cell_selected_extend||$(c.target).hasClass("formulaInputFocus")||$("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible"))return;x("down",1,"rangeOfSelect"),c.preventDefault()}else if(f==b.LEFT){if(parseInt(d.css("top"))>0||m.luckysheet_cell_selected_move||m.luckysheet_cell_selected_extend||$(c.target).hasClass("formulaInputFocus")||$("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible"))return;x("right",-1,"rangeOfSelect"),c.preventDefault()}else if(f==b.RIGHT){if(parseInt(d.css("top"))>0||m.luckysheet_cell_selected_move||m.luckysheet_cell_selected_extend||$(c.target).hasClass("formulaInputFocus")||$("#luckysheet-singleRange-dialog").is(":visible")||$("#luckysheet-multiRange-dialog").is(":visible"))return;x("right",1,"rangeOfSelect"),c.preventDefault()}else if((!(f>=112&&f<=123||f<=46||144==f||108==f||c.ctrlKey||c.altKey||c.shiftKey&&(37==f||38==f||39==f||40==f))||8==f||32==f||46==f||0==f||c.ctrlKey&&86==f)&&null!=String.fromCharCode(f)&&$("#luckysheet-cell-selected").is(":visible")&&f!=b.CAPSLOCK&&f!=b.WIN&&18!=f){let e=m.luckysheet_select_save[m.luckysheet_select_save.length-1],t=e.row_focus,l=e.column_focus;w(t,l,m.flowdata,!0),8==f&&$("#luckysheet-rich-text-editor").html("<br/>"),g.functionInputHanddler($("#luckysheet-functionbox-cell"),$("#luckysheet-rich-text-editor"),f)}}F(),c.stopPropagation()}),$("#"+m.container).add("#luckysheet-input-box").keydown(function(e){if($("#luckysheet-modal-dialog-mask").is(":visible")||$(e.target).hasClass("luckysheet-mousedown-cancel")||$(e.target).hasClass("formulaInputFocus"))return;let t=e.ctrlKey,l=(e.altKey,e.shiftKey),s=e.keyCode,c=$("#luckysheet-input-box");s==b.ESC&&parseInt($("#luckysheet-input-box").css("top"))>0?(g.dontupdate(),x("down",0,"rangeOfSelect"),e.preventDefault()):s==b.ENTER&&parseInt(c.css("top"))>0?$("#luckysheet-formula-search-c").is(":visible")&&null!=g.searchFunctionCell&&(g.searchFunctionEnter($("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item-active")),e.preventDefault()):s==b.TAB&&parseInt(c.css("top"))>0?($("#luckysheet-formula-search-c").is(":visible")&&null!=g.searchFunctionCell?g.searchFunctionEnter($("#luckysheet-formula-search-c").find(".luckysheet-formula-search-item-active")):(g.updatecell(m.luckysheetCellUpdate[0],m.luckysheetCellUpdate[1]),x("right",1,"rangeOfSelect")),e.preventDefault()):s==b.F4&&parseInt(c.css("top"))>0?(g.setfreezonFuc(e),e.preventDefault()):s==b.UP&&parseInt(c.css("top"))>0?L("up",t,l,e):s==b.DOWN&&parseInt(c.css("top"))>0?L("down",t,l,e):s==b.LEFT&&parseInt(c.css("top"))>0?L("left",t,l,e):s==b.RIGHT&&parseInt(c.css("top"))>0?L("right",t,l,e):(!(s>=112&&s<=123||s<=46||144==s||108==s||e.ctrlKey||e.altKey||e.shiftKey&&(37==s||38==s||39==s||40==s||s==b.WIN||s==b.WIN_R||s==b.MENU))||8==s||32==s||46==s||e.ctrlKey&&86==s)&&(g.functionInputHanddler($("#luckysheet-functionbox-cell"),$("#luckysheet-rich-text-editor"),s),C(m.luckysheetCellUpdate[0],m.luckysheetCellUpdate[1],m.flowdata))}).keyup(function(e){let t=e.keyCode;e.shiftKey||16!=t||(m.luckysheet_shiftkeydown=!1,m.luckysheet_shiftpositon=null),parseInt($("#luckysheet-input-box").css("top")),e.preventDefault()}),$("#luckysheet_info_detail_input").val(m.title).css("width",10*U(m.title)).keydown(function(){event.ctrlKey,event.altKey,event.shiftKey;let e=event.keyCode,t=$(this);e==b.ENTER&&t.blur().change()}).bind("input propertychange",function(){let e=$(this),t=10*U(e.val()),l=$("#luckysheet_info_detail_update").outerWidth(),s=$("#luckysheet_info_detail_save").outerWidth(),c=$("#luckysheet_info_detail_user").parent().outerWidth()+60,i=$("#"+m.container).outerWidth()-s-l-c-100;t>i?$("#luckysheet_info_detail_input").css("width",i):$("#luckysheet_info_detail_input").css("width",t)}).change(function(){m.saveParam("na",null,$(this).val())}),$("#"+m.container).add("input.luckysheet-mousedown-cancel").keydown(function(e){const t=e.target.closest(".luckysheet-cols-menuitem");void 0!==t&&null!=t&&13===e.keyCode&&$(t).trigger("click")})}}});
//# sourceMappingURL=../sourcemaps/controllers/keyboard.js.map
