/**
 * skylark-lucksheet - A version of lucksheet.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["../methods/extend_methods","../methods/formula_methods","../methods/getdata","../methods/setdata","../methods/freezen_methods","./select","../methods/sheetSearch","../methods/protection_methods","../methods/get","../store"],function(e,l,t,r,o,n,i,f,c,d){"use strict";const{luckysheetextendData:u,getMoveRange:s}=e,{datagridgrowth:a,getcellFormula:h}=t,{setcellvalue:m}=r,{selectHightlightShow:g}=n,{luckysheet_searcharray:w}=i,{checkProtectionAuthorityNormal:_,checkProtectionNotEnable:p}=f,{getSheetIndex:b}=c;return{luckysheetextendtable:function(e,t,r,n,i){if(i=i||d.currentSheetIndex,"row"==e&&!_(i,"insertRows"))return;if("column"==e&&!_(i,"insertColumns"))return;let f=b(i),c=d.luckysheetfile[f],u=$.extend(!0,[],c.data);r=Math.floor(r);let s=$.extend(!0,{},c.config);null==s.merge&&(s.merge={});let a={};for(let l in s.merge){let o=s.merge[l],i=o.r,f=o.c,c=o.rs,d=o.cs;"row"==e?t<i?a[i+r+"_"+f]={r:i+r,c:f,rs:c,cs:d}:t==i?"lefttop"==n?a[i+r+"_"+f]={r:i+r,c:f,rs:c,cs:d}:a[i+"_"+f]={r:i,c:f,rs:c+r,cs:d}:a[i+"_"+f]=t<i+c-1?{r:i,c:f,rs:c+r,cs:d}:t==i+c-1&&"lefttop"==n?{r:i,c:f,rs:c+r,cs:d}:{r:i,c:f,rs:c,cs:d}:"column"==e&&(t<f?a[i+"_"+(f+r)]={r:i,c:f+r,rs:c,cs:d}:t==f?"lefttop"==n?a[i+"_"+(f+r)]={r:i,c:f+r,rs:c,cs:d}:a[i+"_"+f]={r:i,c:f,rs:c,cs:d+r}:a[i+"_"+f]=t<f+d-1?{r:i,c:f,rs:c,cs:d+r}:t==f+d-1&&"lefttop"==n?{r:i,c:f,rs:c,cs:d+r}:{r:i,c:f,rs:c,cs:d})}s.merge=a;let m=c.calcChain,w=[];if(null!=m&&m.length>0)for(let o=0;o<m.length;o++){let i=$.extend(!0,{},m[o]),f=i.r,c=i.c,d=i.index,s=h(f,c,d);if("row"==e){let e="="+l.functionStrChange(s,"add","row",n,t,r);u[f][c]&&u[f][c].f==s&&(u[f][c].f=e),"lefttop"==n?f>=t&&(i.r+=r):"rightbottom"==n&&f>t&&(i.r+=r),w.push(i)}else if("column"==e){let e="="+l.functionStrChange(s,"add","col",n,t,r);u[f][c]&&u[f][c].f==s&&(u[f][c].f=e),"lefttop"==n?c>=t&&(i.c+=r):"rightbottom"==n&&c>t&&(i.c+=r),w.push(i)}}let p=c.filter_select,y=c.filter,I=null;if(null!=p&&"{}"!=JSON.stringify(p)){I={filter_select:null,filter:null};let l=p.row[0],o=p.row[1],i=p.column[0],f=p.column[1];if("row"==e){if(l<t?o==t&&"lefttop"==n?o+=r:o>t&&(o+=r):l==t?"lefttop"==n?(l+=r,o+=r):"rightbottom"==n&&o>t&&(o+=r):(l+=r,o+=r),null!=y){I.filter={};for(let e in y){let i=y[e].rowhidden,f={};for(let e in i)(e=parseFloat(e))<t?f[e]=0:e==t?"lefttop"==n?f[e+r]=0:"rightbottom"==n&&(f[e]=0):f[e+r]=0;I.filter[e]=$.extend(!0,{},y[e]),I.filter[e].rowhidden=f,I.filter[e].str=l,I.filter[e].edr=o}}}else if("column"==e&&(i<t?f==t&&"lefttop"==n?f+=r:f>t&&(f+=r):i==t?"lefttop"==n?(i+=r,f+=r):"rightbottom"==n&&f>t&&(f+=r):(i+=r,f+=r),null!=y)){I.filter={};for(let e in y){let l=y[e].cindex;l==t&&"lefttop"==n?l+=r:l>t&&(l+=r),I.filter[l-i]=$.extend(!0,{},y[e]),I.filter[l-i].cindex=l,I.filter[l-i].stc=i,I.filter[l-i].edc=f}}I.filter_select={row:[l,o],column:[i,f]}}if(null!=I&&null!=I.filter){null==s.rowhidden&&(s.rowhidden={});for(let e in I.filter){let l=I.filter[e].rowhidden;for(let e in l)s.rowhidden[e]=0}}let v=c.luckysheet_conditionformat_save,x=[];if(null!=v&&v.length>0)for(let l=0;l<v.length;l++){let o=v[l].cellrange,i=[];for(let l=0;l<o.length;l++){let f=o[l].row[0],c=o[l].row[1],d=o[l].column[0],u=o[l].column[1];"row"==e?f<t?c==t&&"lefttop"==n?c+=r:c>t&&(c+=r):f==t?"lefttop"==n?(f+=r,c+=r):"rightbottom"==n&&c>t&&(c+=r):(f+=r,c+=r):"column"==e&&(d<t?u==t&&"lefttop"==n?u+=r:u>t&&(u+=r):d==t?"lefttop"==n?(d+=r,u+=r):"rightbottom"==n&&u>t&&(u+=r):(d+=r,u+=r)),i.push({row:[f,c],column:[d,u]})}let f=$.extend(!0,{},v[l]);f.cellrange=i,x.push(f)}let z=c.luckysheet_alternateformat_save,k=[];if(null!=z&&z.length>0)for(let l=0;l<z.length;l++){let o=z[l].cellrange.row[0],i=z[l].cellrange.row[1],f=z[l].cellrange.column[0],c=z[l].cellrange.column[1],d=$.extend(!0,{},z[l]);"row"==e?o<t?i==t&&"lefttop"==n?i+=r:i>t&&(i+=r):o==t?"lefttop"==n?(o+=r,i+=r):"rightbottom"==n&&i>t&&(i+=r):(o+=r,i+=r):"column"==e&&(f<t?c==t&&"lefttop"==n?c+=r:c>t&&(c+=r):f==t?"lefttop"==n?(f+=r,c+=r):"rightbottom"==n&&c>t&&(c+=r):(f+=r,c+=r)),d.cellrange={row:[o,i],column:[f,c]},k.push(d)}let T={freezenhorizontaldata:null,freezenverticaldata:null};if(null!=d.freezenhorizontaldata&&"row"==e){let e=d.freezenhorizontaldata[2],l=d.freezenhorizontaldata[1]-1;l==t&&"lefttop"==n?l+=r:l>t&&(l+=r);let i=d.visibledatarow[l]-2-e+d.columnHeaderHeight;T.freezenhorizontaldata=[d.visibledatarow[l],l+1,e,o.cutVolumn(d.visibledatarow,l+1),i]}else T.freezenhorizontaldata=d.freezenhorizontaldata;if(null!=d.freezenverticaldata&&"column"==e){let e=d.freezenverticaldata[2],l=d.freezenverticaldata[1]-1;l==t&&"lefttop"==n?l+=r:l>t&&(l+=r);let i=d.visibledatacolumn[l]-2-e+d.rowHeaderWidth;T.freezenverticaldata=[d.visibledatacolumn[l],l+1,e,o.cutVolumn(d.visibledatacolumn,l+1),i]}else T.freezenverticaldata=d.freezenverticaldata;let S=c.dataVerification,C={};if(null!=S)for(let l in S){let o=Number(l.split("_")[0]),i=Number(l.split("_")[1]),f=S[l];if("row"==e)if(t<o)C[o+r+"_"+i]=f;else if(t==o)if("lefttop"==n){C[o+r+"_"+i]=f;for(let e=0;e<r;e++)C[o+e+"_"+i]=f}else{C[o+"_"+i]=f;for(let e=0;e<r;e++)C[o+e+1+"_"+i]=f}else C[o+"_"+i]=f;else if("column"==e)if(t<i)C[o+"_"+(i+r)]=f;else if(t==i)if("lefttop"==n){C[o+"_"+(i+r)]=f;for(let e=0;e<r;e++)C[o+"_"+(i+e)]=f}else{C[o+"_"+i]=f;for(let e=0;e<r;e++)C[o+"_"+(i+e+1)]=f}else C[o+"_"+i]=f}let N,V=c.hyperlink,F={};if(null!=V)for(let l in V){let o=Number(l.split("_")[0]),i=Number(l.split("_")[1]),f=V[l];"row"==e?t<o?F[o+r+"_"+i]=f:t==o&&"lefttop"==n?F[o+r+"_"+i]=f:F[o+"_"+i]=f:"column"==e&&(t<i?F[o+"_"+(i+r)]=f:t==i&&"lefttop"==n?F[o+"_"+(i+r)]=f:F[o+"_"+i]=f)}if("row"==e){if(N="r",null!=s.rowlen){let e={};for(let l in s.rowlen)(l=parseFloat(l))<t?e[l]=s.rowlen[l]:l==t?"lefttop"==n?e[l+r]=s.rowlen[l]:"rightbottom"==n&&(e[l]=s.rowlen[l]):e[l+r]=s.rowlen[l];s.rowlen=e}if(null!=s.rowhidden){let e={};for(let l in s.rowhidden)(l=parseFloat(l))<t?e[l]=s.rowhidden[l]:l==t?"lefttop"==n?e[l+r]=s.rowhidden[l]:"rightbottom"==n&&(e[l]=s.rowhidden[l]):e[l+r]=s.rowhidden[l];s.rowhidden=e}let e=[];for(let l=0;l<u[0].length;l++)e.push(null);if(s.borderInfo&&s.borderInfo.length>0){let e=[];for(let l=0;l<s.borderInfo.length;l++){let o=s.borderInfo[l].rangeType;if("range"==o){let o=s.borderInfo[l].range,i=[];for(let e=0;e<o.length;e++){let l=o[e].row[0],f=o[e].row[1];"lefttop"==n?t<=l?(l+=r,f+=r):t<=f&&(f+=r):t<l?(l+=r,f+=r):t<f&&(f+=r),f>=l&&i.push({row:[l,f],column:o[e].column})}if(i.length>0){let t={rangeType:"range",borderType:s.borderInfo[l].borderType,style:s.borderInfo[l].style,color:s.borderInfo[l].color,range:i};e.push(t)}}else if("cell"==o){let o=s.borderInfo[l].value.row_index;"lefttop"==n?t<=o&&(o+=r):t<o&&(o+=r),s.borderInfo[l].value.row_index=o,e.push(s.borderInfo[l])}}s.borderInfo=e}let l=[];for(let t=0;t<r;t++)l.push(JSON.stringify(e));"lefttop"==n?0==t?new Function("d","return d.unshift("+l.join(",")+")")(u):new Function("d","return d.splice("+t+", 0, "+l.join(",")+")")(u):new Function("d","return d.splice("+(t+1)+", 0, "+l.join(",")+")")(u)}else{if(N="c",null!=s.columnlen){let e={};for(let l in s.columnlen)(l=parseFloat(l))<t?e[l]=s.columnlen[l]:l==t?"lefttop"==n?e[l+r]=s.columnlen[l]:"rightbottom"==n&&(e[l]=s.columnlen[l]):e[l+r]=s.columnlen[l];s.columnlen=e}if(null!=s.colhidden){let e={};for(let l in s.colhidden)(l=parseFloat(l))<t?e[l]=s.colhidden[l]:l==t?"lefttop"==n?e[l+r]=s.colhidden[l]:"rightbottom"==n&&(e[l]=s.colhidden[l]):e[l+r]=s.colhidden[l];s.colhidden=e}let e=[];for(let l=0;l<u.length;l++)e.push(null);if(s.borderInfo&&s.borderInfo.length>0){let e=[];for(let l=0;l<s.borderInfo.length;l++){let o=s.borderInfo[l].rangeType;if("range"==o){let o=s.borderInfo[l].range,i=[];for(let e=0;e<o.length;e++){let l=o[e].column[0],f=o[e].column[1];"lefttop"==n?t<=l?(l+=r,f+=r):t<=f&&(f+=r):t<l?(l+=r,f+=r):t<f&&(f+=r),f>=l&&i.push({row:o[e].row,column:[l,f]})}if(i.length>0){let t={rangeType:"range",borderType:s.borderInfo[l].borderType,style:s.borderInfo[l].style,color:s.borderInfo[l].color,range:i};e.push(t)}}else if("cell"==o){let o=s.borderInfo[l].value.col_index;"lefttop"==n?t<=o&&(o+=r):t<o&&(o+=r),s.borderInfo[l].value.col_index=o,e.push(s.borderInfo[l])}}s.borderInfo=e}for(let l=0;l<u.length;l++){let o=u[l];for(let i=0;i<r;i++)"lefttop"==n?0==t?o.unshift(e[l]):o.splice(t,0,e[l]):o.splice(t+1,0,e[l])}}c.index==d.currentSheetIndex?d.refreshGrid_adRC(u,s,"addRC",{index:t,len:r,direction:n,rc:N,restore:!1},w,I,x,k,T,C,F):(c.data=u,c.config=s,c.calcChain=w,c.filter=I.filter,c.filter_select=I.filter_select,c.luckysheet_conditionformat_save=x,c.luckysheet_alternateformat_save=k,c.dataVerification=C,c.hyperlink=F);let L=null;if(L="row"==e?"lefttop"==n?[{row:[t,t+r-1],column:[0,u[0].length-1]}]:[{row:[t+1,t+r],column:[0,u[0].length-1]}]:"lefttop"==n?[{row:[0,u.length-1],column:[t,t+r-1]}]:[{row:[0,u.length-1],column:[t+1,t+r]}],c.luckysheet_select_save=L,c.index==d.currentSheetIndex&&(d.luckysheet_select_save=L,g()),"row"==e){$("#luckysheet-cell-main").scrollLeft();let e=$("#luckysheet-cell-main").scrollTop(),l=$("#luckysheet-cell-main").height(),t=($("#luckysheet-cell-main").width(),d.visibledatarow[L[0].row[1]]),o=L[0].row[0]-1==-1?0:d.visibledatarow[L[0].row[0]-1];t-e-l+20>0?$("#luckysheet-scrollbar-y").scrollTop(t-l+20):o-e-20<0&&$("#luckysheet-scrollbar-y").scrollTop(o-20),r>30&&($("#luckysheet-row-count-show").hide(),$("#luckysheet-column-count-show").hide())}},luckysheetextendData:u,luckysheetdeletetable:function(e,t,r,n){if(n=n||d.currentSheetIndex,"row"==e&&!_(n,"deleteRows"))return;if("column"==e&&!_(n,"deleteColumns"))return;let i=b(n),f=d.luckysheetfile[i],c=$.extend(!0,[],f.data);if(t<0&&(t=0),r<0&&(r=0),"row"==e?(t>c.length-1&&(t=c.length-1),r>c.length-1&&(r=c.length-1)):(t>c[0].length-1&&(t=c[0].length-1),r>c[0].length-1&&(r=c[0].length-1)),t>r)return;let u=r-t+1,s=$.extend(!0,{},f.config);null==s.merge&&(s.merge={});let a={};for(let l in s.merge){let o=s.merge[l],n=o.r,i=o.c,f=o.rs,c=o.cs;"row"==e?n<t?n+f-1<t?a[n+"_"+i]={r:n,c:i,rs:f,cs:c}:n+f-1>=t&&n+f-1<r?a[n+"_"+i]={r:n,c:i,rs:t-n,cs:c}:n+f-1>=r&&(a[n+"_"+i]={r:n,c:i,rs:f-u,cs:c}):n>=t&&n<=r?n+f-1>r&&(a[t+"_"+i]={r:t,c:i,rs:n+f-1-r,cs:c}):n>r&&(a[n-u+"_"+i]={r:n-u,c:i,rs:f,cs:c}):"column"==e&&(i<t?i+c-1<t?a[n+"_"+i]={r:n,c:i,rs:f,cs:c}:i+c-1>=t&&i+c-1<r?a[n+"_"+i]={r:n,c:i,rs:f,cs:t-i}:i+c-1>=r&&(a[n+"_"+i]={r:n,c:i,rs:f,cs:c-u}):i>=t&&i<=r?i+c-1>r&&(a[n+"_"+t]={r:n,c:t,rs:f,cs:i+c-1-r}):i>r&&(a[n+"_"+(i-u)]={r:n,c:i-u,rs:f,cs:c}))}s.merge=a;let m=f.calcChain,g=[];if(null!=m&&m.length>0)for(let o=0;o<m.length;o++){let n=$.extend(!0,{},m[o]),i=n.r,f=n.c,d=n.index,s=h(i,f,d);if("row"==e){if(i<t||i>r){let e="="+l.functionStrChange(s,"del","row",null,t,u);c[i][f]&&c[i][f].f==s&&(c[i][f].f=e),i>r&&(n.r=i-u),g.push(n)}}else if("column"==e&&(f<t||f>r)){let e="="+l.functionStrChange(s,"del","col",null,t,u);c[i][f]&&c[i][f].f==s&&(c[i][f].f=e),f>r&&(n.c=f-u),g.push(n)}}let p=f.filter_select,y=f.filter,I=null;if(null!=p&&"{}"!=JSON.stringify(p)){I={filter_select:null,filter:null};let l=p.row[0],o=p.row[1],n=p.column[0],i=p.column[1];if("row"==e){if(l>r?(l-=u,o-=u,I.filter_select={row:[l,o],column:[n,i]}):l<t&&(o<t||(o<=r?o=t-1:o-=u),I.filter_select={row:[l,o],column:[n,i]}),null!=I.filter_select&&null!=y)for(let e in y){let n=y[e].rowhidden,i={};for(let e in n)e<t?i[e]=0:e>r&&(i[e-u]=0);"{}"!=JSON.stringify(i)&&(null==I.filter&&(I.filter={}),I.filter[e]=$.extend(!0,{},y[e]),I.filter[e].rowhidden=i,I.filter[e].str=l,I.filter[e].edr=o)}}else if("column"==e&&(n>r?(n-=u,i-=u,I.filter_select={row:[l,o],column:[n,i]}):n<t?(i<t||(i<=r?i=t-1:i-=u),I.filter_select={row:[l,o],column:[n,i]}):i>r&&(n=t,i-=u,I.filter_select={row:[l,o],column:[n,i]}),null!=I.filter_select&&null!=y))for(let e in y){let l=y[e].cindex;l<t?(null==I.filter&&(I.filter={}),I.filter[l-n]=$.extend(!0,{},y[e]),I.filter[l-n].edc=i):l>r&&(l-=u,null==I.filter&&(I.filter={}),I.filter[l-n]=$.extend(!0,{},y[e]),I.filter[l-n].cindex=l,I.filter[l-n].stc=n,I.filter[l-n].edc=i)}}if(null!=I&&null!=I.filter){null==s.rowhidden&&(s.rowhidden={});for(let e in I.filter){let l=I.filter[e].rowhidden;for(let e in l)s.rowhidden[e]=0}}let v=f.luckysheet_conditionformat_save,x=[];if(null!=v&&v.length>0)for(let l=0;l<v.length;l++){let o=v[l].cellrange,n=[];for(let l=0;l<o.length;l++){let i=o[l].row[0],f=o[l].row[1],c=o[l].column[0],d=o[l].column[1];"row"==e?i>=t&&f<=r||(i>r?(i-=u,f-=u):i<t?f<t||(f<=r?f=t-1:f-=u):f>r&&(i=t,f-=u),n.push({row:[i,f],column:[c,d]})):"column"==e&&(c>=t&&d<=r||(c>r?(c-=u,d-=u):c<t?d<t||(d<=r?d=t-1:d-=u):d>r&&(c=t,d-=u),n.push({row:[i,f],column:[c,d]})))}if(n.length>0){let e=$.extend(!0,{},v[l]);e.cellrange=n,x.push(e)}}let z=f.luckysheet_alternateformat_save,k=[];if(null!=z&&z.length>0)for(let l=0;l<z.length;l++){let o=z[l].cellrange.row[0],n=z[l].cellrange.row[1],i=z[l].cellrange.column[0],f=z[l].cellrange.column[1];if("row"==e){if(!(o>=t&&n<=r)){let e=$.extend(!0,{},z[l]);o>r?(o-=u,n-=u):o<t?n<t||(n<=r?n=t-1:n-=u):n>r&&(o=t,n-=u),e.cellrange={row:[o,n],column:[i,f]},k.push(e)}}else if("column"==e&&!(i>=t&&f<=r)){let e=$.extend(!0,{},z[l]);i>r?(i-=u,f-=u):i<t?f<t||(f<=r?f=t-1:f-=u):f>r&&(i=t,f-=u),e.cellrange={row:[o,n],column:[i,f]},k.push(e)}}let T={freezenhorizontaldata:null,freezenverticaldata:null};if(null!=d.freezenhorizontaldata&&"row"==e){let e=d.freezenhorizontaldata[2],l=w(d.visibledatarow,e);-1==l&&(l=0);let n=d.freezenhorizontaldata[1]-1;n>=t&&(n<r?n=t-1:n-=u),n<l&&(n=l);let i=d.visibledatarow[n]-2-e+d.columnHeaderHeight;T.freezenhorizontaldata=[d.visibledatarow[n],n+1,e,o.cutVolumn(d.visibledatarow,n+1),i]}else T.freezenhorizontaldata=d.freezenhorizontaldata;if(null!=d.freezenverticaldata&&"column"==e){let e=d.freezenverticaldata[2],l=w(d.visibledatacolumn,e);-1==l&&(l=0);let n=d.freezenverticaldata[1]-1;n>=t&&(n<r?n=t-1:n-=u),n<l&&(n=l);let i=d.visibledatacolumn[n]-2-e+d.rowHeaderWidth;T.freezenverticaldata=[d.visibledatacolumn[n],n+1,e,o.cutVolumn(d.visibledatacolumn,n+1),i]}else T.freezenverticaldata=d.freezenverticaldata;let S=f.dataVerification,C={};if(null!=S)for(let l in S){let o=Number(l.split("_")[0]),n=Number(l.split("_")[1]),i=S[l];"row"==e?o<t?C[o+"_"+n]=i:o>r&&(C[o-u+"_"+n]=i):"column"==e&&(n<t?C[o+"_"+n]=i:n>r&&(C[o+"_"+(n-u)]=i))}let N,V=f.hyperlink,F={};if(null!=V)for(let l in V){let o=Number(l.split("_")[0]),n=Number(l.split("_")[1]),i=V[l];"row"==e?o<t?F[o+"_"+n]=i:o>r&&(F[o-u+"_"+n]=i):"column"==e&&(n<t?F[o+"_"+n]=i:n>r&&(F[o+"_"+(n-u)]=i))}if("row"==e){N="r",null==s.rowlen&&(s.rowlen={});let e={};for(let l in s.rowlen)l<t?e[l]=s.rowlen[l]:l>r&&(e[l-u]=s.rowlen[l]);s.rowlen=e,null==s.rowhidden&&(s.rowhidden={});let l={};for(let e in s.rowhidden)e<t?l[e]=s.rowhidden[e]:e>r&&(l[e-u]=s.rowhidden[e]);if(s.rowhidden=l,s.borderInfo&&s.borderInfo.length>0){let e=[];for(let l=0;l<s.borderInfo.length;l++){let o=s.borderInfo[l].rangeType;if("range"==o){let o=s.borderInfo[l].range,n=[];for(let e=0;e<o.length;e++){let l=o[e].row[0],i=o[e].row[1];for(let n=t;n<=r;n++)n<o[e].row[0]?(l-=1,i-=1):n<=o[e].row[1]&&(i-=1);i>=l&&n.push({row:[l,i],column:o[e].column})}if(n.length>0){let t={rangeType:"range",borderType:s.borderInfo[l].borderType,style:s.borderInfo[l].style,color:s.borderInfo[l].color,range:n};e.push(t)}}else if("cell"==o){let o=s.borderInfo[l].value.row_index;o<t?e.push(s.borderInfo[l]):o>r&&(s.borderInfo[l].value.row_index=o-(r-t+1),e.push(s.borderInfo[l]))}}s.borderInfo=e}c.splice(t,u);for(let e=0;e<u;e++){let e=[];for(let l=0;l<c[0].length;l++)e.push(null);c.push(e)}}else{N="c",null==s.columnlen&&(s.columnlen={});let e={};for(let l in s.columnlen)l<t?e[l]=s.columnlen[l]:l>r&&(e[l-u]=s.columnlen[l]);s.columnlen=e,null==s.colhidden&&(s.colhidden={});let l={};for(let e in s.colhidden)e<t?l[e]=s.colhidden[e]:e>r&&(l[e-u]=s.colhidden[e]);if(s.colhidden=l,s.borderInfo&&s.borderInfo.length>0){let e=[];for(let l=0;l<s.borderInfo.length;l++){let o=s.borderInfo[l].rangeType;if("range"==o){let o=s.borderInfo[l].range,n=[];for(let e=0;e<o.length;e++){let l=o[e].column[0],i=o[e].column[1];for(let n=t;n<=r;n++)n<o[e].column[0]?(l-=1,i-=1):n<=o[e].column[1]&&(i-=1);i>=l&&n.push({row:o[e].row,column:[l,i]})}if(n.length>0){let t={rangeType:"range",borderType:s.borderInfo[l].borderType,style:s.borderInfo[l].style,color:s.borderInfo[l].color,range:n};e.push(t)}}else if("cell"==o){let o=s.borderInfo[l].value.col_index;o<t?e.push(s.borderInfo[l]):o>r&&(s.borderInfo[l].value.col_index=o-(r-t+1),e.push(s.borderInfo[l]))}}s.borderInfo=e}let o=[];for(let e=0;e<u;e++)o.push(null);for(let e=0;e<c.length;e++){let l=[].concat(c[e]);l.splice(t,u),c[e]=l.concat(o)}}f.index==d.currentSheetIndex?d.refreshGrid_adRC(c,s,"delRC",{index:t,len:r-t+1,rc:N},g,I,x,k,T,C,F):(f.data=c,f.config=s,f.calcChain=g,f.filter=I.filter,f.filter_select=I.filter_select,f.luckysheet_conditionformat_save=x,f.luckysheet_alternateformat_save=k,f.dataVerification=C,f.hyperlink=F)},luckysheetDeleteCell:function(e,t,r,o,n,i){if(i=i||d.currentSheetIndex,!p(i))return;let f=b(i),c=d.luckysheetfile[f],u=$.extend(!0,[],c.data),a=r-t+1,m=n-o+1,g=$.extend(!0,{},d.config);null==g.merge&&(g.merge={});let w={};for(let l in g.merge){let i=g.merge[l],f=i.r,c=i.c,d=i.rs,s=i.cs;if("moveLeft"==e)if(t>f+d-1||r<f||o>c+s-1)w[f+"_"+c]={r:f,c:c,rs:d,cs:s};else if(t<=f&&r>=f+d-1&&n<c)w[f+"_"+(c-m)]={r:f,c:c-m,rs:d,cs:s};else for(let e=f;e<=f+d-1;e++)for(let l=c;l<=c+s-1;l++)delete u[e][l].mc;else if("moveUp"==e)if(o>c+s-1||n<c||t>f+d-1)w[f+"_"+c]={r:f,c:c,rs:d,cs:s};else if(o<=c&&n>=c+s-1&&r<f)w[f-a+"_"+c]={r:f-a,c:c,rs:d,cs:s};else for(let e=f;e<=f+d-1;e++)for(let l=c;l<=c+s-1;l++)delete u[e][l].mc}g.merge=w;let _=c.calcChain,y=[];if(null!=_&&_.length>0)for(let i=0;i<_.length;i++){let f=$.extend(!0,{},_[i]),c=f.r,d=f.c,s=f.index,g=h(c,d,s);if(c<t||c>r||d<o||d>n){let i;"moveLeft"==e?(i="="+l.functionStrChange(g,"del","col",null,o,m),d>n&&c>=t&&c<=r&&(f.c=d-m)):"moveUp"==e&&(i="="+l.functionStrChange(g,"del","row",null,t,a),c>r&&d>=o&&d<=n&&(f.r=c-a)),u[c][d]&&u[c][d].f==g&&(u[c][d].f=i),y.push(f)}}let I=c.filter_select,v=c.filter,x=null;if(null!=I&&"{}"!=JSON.stringify(I)){x={filter_select:null,filter:null};let l=I.row[0],i=I.row[1],f=I.column[0],c=I.column[1];if("moveUp"==e)if(f>=o&&c<=n){if(l>r?x.filter_select={row:[l-a,i-a],column:[f,c]}:i<t?x.filter_select={row:[l,i],column:[f,c]}:l<t&&(x.filter_select=i>r?{row:[l,i-a],column:[f,c]}:{row:[l,t-1],column:[f,c]}),null!=x.filter_select&&null!=v)for(let e in v){let l=v[e].rowhidden,o={};for(let e in l)e<t?o[e]=0:e>r&&(o[e-slen]=0);null==x.filter&&(x.filter={}),x.filter[e]=$.extend(!0,{},v[e]),"{}"!=JSON.stringify(o)&&(x.filter[e].rowhidden=o),x.filter[e].str=x.filter_select.row[0],x.filter[e].edr=x.filter_select.row[1]}}else if(l>=t&&i<=r){if(f>n?x.filter_select={row:[l,i],column:[f,c]}:f>=o?c>n&&(x.filter_select={row:[l,i],column:[o,c-m]}):x.filter_select=c<o?{row:[l,i],column:[f,c]}:c<=n?{row:[l,i],column:[f,o-1]}:{row:[l,i],column:[f,c-m]},null!=x.filter_select&&null!=v)for(let e in v){let l=x.filter_select.column[0],t=x.filter_select.column[1],r=v[e].cindex;if(r<o||r>n){null==x.filter&&(x.filter={}),r>n&&(r-=m);let o=r-l;x.filter[o]=$.extend(!0,{},v[e]),x.filter[o].cindex=r,x.filter[o].stc=l,x.filter[o].edc=t}}}else x.filter_select={row:[l,i],column:[f,c]},null!=v&&(x.filter=v);else if("moveLeft"==e)if(l>=t&&i<=r){if(f>n?x.filter_select={row:[l,i],column:[f-m,c-m]}:c<o?x.filter_select={row:[l,i],column:[f,c]}:f<o&&(x.filter_select=c>n?{row:[l,i],column:[f,c-m]}:{row:[l,i],column:[f,o-1]}),null!=x.filter_select&&null!=v)for(let e in v){let l=x.filter_select.column[0],t=x.filter_select.column[1],r=v[e].cindex;if(r<o||r>n){null==x.filter&&(x.filter={}),r>n&&(r-=m);let o=r-l;x.filter[o]=$.extend(!0,{},v[e]),x.filter[o].cindex=r,x.filter[o].stc=l,x.filter[o].edc=t}}}else f>=o&&c<=n?(l<t||l>r)&&(x.filter_select={row:[l,i],column:[f,c]},null!=v&&(x.filter=v)):(x.filter_select={row:[l,i],column:[f,c]},null!=v&&(x.filter=v))}if(null!=x&&null!=x.filter){null==g.rowhidden&&(g.rowhidden={});for(let e in x.filter){let l=x.filter[e].rowhidden;for(let e in l)g.rowhidden[e]=0}}let z=c.luckysheet_conditionformat_save,k=[];if(null!=z&&z.length>0)for(let l=0;l<z.length;l++){let i=z[l].cellrange,f=[];for(let l=0;l<i.length;l++){let c=i[l].row[0],d=i[l].row[1],u=i[l].column[0],h=i[l].column[1];t<=c&&r>=d&&o<=u&&n>=h||(f=s(e,t,r,o,n,c,d,u,h,a,m))}if(f.length>0){let e=$.extend(!0,{},z[l]);e.cellrange=f,k.push(e)}}let T=c.dataVerification,S={};if(null!=T)for(let l in T){let i=Number(l.split("_")[0]),f=Number(l.split("_")[1]),c=T[l];(i<t||i>r||f<o||f>n)&&("moveLeft"==e?f>n&&i>=t&&i<=r?S[i+"_"+(f-m)]=c:S[i+"_"+f]=c:"moveUp"==e&&(i>r&&f>=o&&f<=n?S[i-a+"_"+f]=c:S[i+"_"+f]=c))}let C=c.hyperlink,N={};if(null!=C)for(let l in C){let i=Number(l.split("_")[0]),f=Number(l.split("_")[1]),c=C[l];(i<t||i>r||f<o||f>n)&&("moveLeft"==e?f>n&&i>=t&&i<=r?N[i+"_"+(f-m)]=c:N[i+"_"+f]=c:"moveUp"==e&&(i>r&&f>=o&&f<=n?N[i-a+"_"+f]=c:N[i+"_"+f]=c))}if(g.borderInfo&&g.borderInfo.length>0){let l=[];for(let i=0;i<g.borderInfo.length;i++){let f=g.borderInfo[i].rangeType;if("range"==f){let f=g.borderInfo[i].range,c=[];for(let l=0;l<f.length;l++){let i=f[l].row[0],d=f[l].row[1],u=f[l].column[0],h=f[l].column[1];t<=i&&r>=d&&o<=u&&n>=h||(c=s(e,t,r,o,n,i,d,u,h,a,m))}if(c.length>0){let e={rangeType:"range",borderType:g.borderInfo[i].borderType,style:g.borderInfo[i].style,color:g.borderInfo[i].color,range:c};l.push(e)}}else if("cell"==f){let f=g.borderInfo[i].value.row_index,c=g.borderInfo[i].value.col_index;(f<t||f>r||c<o||c>n)&&("moveLeft"==e?c>n&&f>=t&&f<=r&&(c-=m,g.borderInfo[i].value.col_index=c):"moveUp"==e&&f>r&&c>=o&&c<=n&&(f-=a,g.borderInfo[i].value.row_index=f),l.push(g.borderInfo[i]))}}g.borderInfo=l}let V=[];for(let e=o;e<=n;e++)V.push(null);if("moveUp"==e){let e=[];for(let l=t;l<=u.length-1;l++){let t=[];for(let e=o;e<=n;e++)t.push(u[l][e]);e.push(t)}e.splice(0,a);let l=[];for(let e=t;e<=r;e++)l.push(V);e=e.concat(l);for(let l=t;l<=u.length-1;l++)for(let r=o;r<=n;r++)u[l][r]=e[l-t][r-o]}else if("moveLeft"==e)for(let e=t;e<=r;e++)u[e].splice(o,m),u[e]=u[e].concat(V);c.index==d.currentSheetIndex?d.refreshGrid_deleteCell(u,g,{type:e,str:t,edr:r,stc:o,edc:n},y,x,k,S,N):(c.data=u,c.config=g,c.calcChain=y,c.filter=x.filter,c.filter_select=x.filter_select,c.luckysheet_conditionformat_save=k,c.dataVerification=S,c.hyperlink=N)}}});
//# sourceMappingURL=../sourcemaps/widgets/extend.js.map
