/**
 * skylark-lucksheet - A version of lucksheet.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["../methods/cells","../methods/dynamicArray","../methods/location","../utils/browser","../methods/get","../store","../methods/luckysheetConfigsetting","../locale/locale"],function(e,l,t,s,c,o,h,u){"use strict";const{dynamicArrayHightShow:i}=l,{rowLocationByIndex:n,colLocationByIndex:_}=t,{getSheetIndex:a,getRangetxt:y}=c;function v(e,l,t){let s=$.extend(!0,{},e);for(let e=l;e<=t;e++)e in s||(s[e]=0);return s}function d(e){let l=[];for(let t in e)l.push(t);l.sort(function(e,l){return e-l});let t=[],s=[];if(l.length>1)for(let e=1;e<l.length;e++)l[e]-l[e-1]==1?(s.push(l[e-1]),e==l.length-1&&(s.push(l[e]),t.push(s))):1==e?e==l.length-1?(s.push(l[e-1]),t.push(s),t.push([l[e]])):t.push(l[0]):e==l.length-1?(s.push(l[e-1]),t.push(s),t.push([l[e]])):(s.push(l[e-1]),t.push(s),s=[]);else t.push([l[0]]);return t}function r(e,l,t,s,c,h){let i=c[1]-c[0]+1,n=h[1]-h[0]+1,_=o.luckysheetTableContentHW[0],a=o.luckysheetTableContentHW[1],y=$("#luckysheet-cell-main").scrollLeft(),v=$("#luckysheet-cell-main").scrollTop();const d=u().info;if(i>=4){let t=e-25;t<0&&(t=e+5),t<y&&(t=y+10);let c=l+s/2;s>a&&(c=v+a/2),$("#luckysheet-row-count-show").css({left:t,top:c,display:"block",width:"11px"}).html("<div>"+i.toString().split("").join("</div><div>")+"</div><div>"+d.row+"</div>")}else $("#luckysheet-row-count-show").hide();if(n>=4){let s=l-25;s<0&&(s=l+5),s<v&&(s=v+10);let c=e+t/2;t>_&&(c=y+_/2),$("#luckysheet-column-count-show").css({left:c,top:s,display:"block"}).text(n+d.column)}else $("#luckysheet-column-count-show").hide()}function k(){let e=o.luckysheet_select_save[o.luckysheet_select_save.length-1],l=e.row_focus,t=e.column_focus;null!=o.config.merge&&l+"_"+t in o.config.merge?$("#luckysheet-helpbox-cell").text(y(o.currentSheetIndex,{column:[t,t],row:[l,l]})):$("#luckysheet-helpbox-cell").text(y(o.currentSheetIndex,e))}return{seletedHighlistByindex:function(e,l,t,s,c){let h=o.visibledatarow[t],u=l-1==-1?0:o.visibledatarow[l-1],i=o.visibledatacolumn[c],n=s-1==-1?0:o.visibledatacolumn[s-1];$("#"+e).css({left:n,width:i-n-1,top:u,height:h-u-1})},selectHightlightShow:function(l=!1){if($("#luckysheet-cell-selected-boxs").show(),$("#luckysheet-cell-selected-boxs #luckysheet-cell-selected").siblings(".luckysheet-cell-selected").remove(),o.luckysheet_select_save.length>0){for(let l=0;l<o.luckysheet_select_save.length;l++){let t,c,h=o.luckysheet_select_save[l].row[0],u=o.luckysheet_select_save[l].row[1],i=o.luckysheet_select_save[l].column[0],n=o.luckysheet_select_save[l].column[1];t=null==o.luckysheet_select_save[l].row_focus?h:o.luckysheet_select_save[l].row_focus,c=null==o.luckysheet_select_save[l].column_focus?i:o.luckysheet_select_save[l].column_focus;let _=o.visibledatarow[u],a=h-1==-1?0:o.visibledatarow[h-1],y=o.visibledatacolumn[n],v=i-1==-1?0:o.visibledatacolumn[i-1],d=o.visibledatarow[t],k=t-1==-1?0:o.visibledatarow[t-1],p=o.visibledatacolumn[c],f=c-1==-1?0:o.visibledatacolumn[c-1],m=e.mergeborer(o.flowdata,t,c);m&&(d=m.row[1],k=m.row[0],p=m.column[1],f=m.column[0]),o.luckysheet_select_save[l].row=[h,u],o.luckysheet_select_save[l].column=[i,n],o.luckysheet_select_save[l].row_focus=t,o.luckysheet_select_save[l].column_focus=c,o.luckysheet_select_save[l].left=f,o.luckysheet_select_save[l].width=p-f-1,o.luckysheet_select_save[l].top=k,o.luckysheet_select_save[l].height=d-k-1,o.luckysheet_select_save[l].left_move=v,o.luckysheet_select_save[l].width_move=y-v-1,o.luckysheet_select_save[l].top_move=a,o.luckysheet_select_save[l].height_move=_-a-1,0==l?1==o.luckysheet_select_save.length?s.mobilecheck()?$("#luckysheet-cell-selected-boxs #luckysheet-cell-selected").css({left:o.luckysheet_select_save[l].left_move,width:o.luckysheet_select_save[l].width_move,top:o.luckysheet_select_save[l].top_move,height:o.luckysheet_select_save[l].height_move,display:"block",border:"1px solid #0188fb"}).find(".luckysheet-cs-draghandle").css("display","block").end().find(".luckysheet-cs-fillhandle").css("display","none").end().find(".luckysheet-cs-touchhandle").css("display","block"):$("#luckysheet-cell-selected-boxs #luckysheet-cell-selected").css({left:o.luckysheet_select_save[l].left_move,width:o.luckysheet_select_save[l].width_move,top:o.luckysheet_select_save[l].top_move,height:o.luckysheet_select_save[l].height_move,display:"block",border:"1px solid #0188fb"}).find(".luckysheet-cs-draghandle").css("display","block").end().find(".luckysheet-cs-fillhandle").css("display","block").end().find(".luckysheet-cs-touchhandle").css("display","none"):$("#luckysheet-cell-selected-boxs #luckysheet-cell-selected").css({left:o.luckysheet_select_save[l].left_move,width:o.luckysheet_select_save[l].width_move,top:o.luckysheet_select_save[l].top_move,height:o.luckysheet_select_save[l].height_move,display:"block",border:"1px solid rgba(1, 136, 251, 0.15)"}).find(".luckysheet-cs-draghandle").css("display","none").end().find(".luckysheet-cs-fillhandle").css("display","none"):$("#luckysheet-cell-selected-boxs").append('<div class="luckysheet-cell-selected" style="left: '+o.luckysheet_select_save[l].left_move+"px; width: "+o.luckysheet_select_save[l].width_move+"px; top: "+o.luckysheet_select_save[l].top_move+"px; height: "+o.luckysheet_select_save[l].height_move+'px; border: 1px solid rgba(1, 136, 251, 0.15); display: block;"></div>'),l==o.luckysheet_select_save.length-1&&($("#luckysheet-cell-selected-focus").css({left:o.luckysheet_select_save[l].left,width:o.luckysheet_select_save[l].width,top:o.luckysheet_select_save[l].top,height:o.luckysheet_select_save[l].height,display:"block"}),r(o.luckysheet_select_save[l].left_move,o.luckysheet_select_save[l].top_move,o.luckysheet_select_save[l].width_move,o.luckysheet_select_save[l].height_move,[h,u],[i,n]))}!function(e,l=!1){let t=$.extend(!0,[],e),s={},c={};for(let e=0;e<t.length;e++){let l=t[e].row[0],o=t[e].row[1],h=t[e].column[0],u=t[e].column[1];s=v(s,l,o),c=v(c,h,u)}$("#luckysheet-rows-h-selected").empty();let o=d(s);for(let e=0;e<o.length;e++){let l=o[e][0],t=o[e][o[e].length-1],s=n(t)[1],c=n(l)[0];$("#luckysheet-rows-h-selected").append('<div class="luckysheet-rows-h-selected" style="top: '+c+"px; height: "+(s-c-1)+'px; display: block; background-color: rgba(76, 76, 76, 0.1);"></div>')}$("#luckysheet-cols-h-selected").empty();let h=d(c);for(let e=0;e<h.length;e++){let l=h[e][0],t=h[e][h[e].length-1],s=_(t)[1],c=_(l)[0];$("#luckysheet-cols-h-selected").append('<div class="luckysheet-cols-h-selected" style="left: '+c+"px; width: "+(s-c-1)+'px; display: block; background-color: rgba(76, 76, 76, 0.1);"></div>')}}(o.luckysheet_select_save,l),k(),1==o.luckysheet_select_save.length&&o.luckysheet_select_save[0].row[0]==o.luckysheet_select_save[0].row[1]&&o.luckysheet_select_save[0].column[0]==o.luckysheet_select_save[0].column[1]&&i(o.luckysheet_select_save[0].row[0],o.luckysheet_select_save[0].column[0])}o.luckysheetfile[a(o.currentSheetIndex)].luckysheet_select_save=o.luckysheet_select_save;const t=JSON.stringify(o.luckysheet_select_save);null==o.luckysheet_select_save_previous|o.luckysheet_select_save_previous!==t&&h.createHookFunction("rangeSelect",o.luckysheetfile[a(o.currentSheetIndex)],o.luckysheet_select_save),o.luckysheet_select_save_previous=t},selectIsOverlap:function(e){null==e&&(e=o.luckysheet_select_save);let l=!1,t={};for(let s=0;s<e.length;s++){let c=e[s].row[0],o=e[s].row[1],h=e[s].column[0],u=e[s].column[1];for(let e=c;e<=o;e++)for(let s=h;s<=u;s++){if(e+"_"+s in t){l=!0;break}t[e+"_"+s]=0}}return l},selectionCopyShow:function(e){if($("#luckysheet-selection-copy").empty(),null==e&&(e=o.luckysheet_selection_range),e.length>0)for(let l=0;l<e.length;l++){let t=e[l].row[0],s=e[l].row[1],c=e[l].column[0],h=e[l].column[1],u=o.visibledatarow[s],i=t-1==-1?0:o.visibledatarow[t-1],n=o.visibledatacolumn[h],_=c-1==-1?0:o.visibledatacolumn[c-1],a='<div class="luckysheet-selection-copy" style="display: block; left: '+_+"px; width: "+(n-_-1)+"px; top: "+i+"px; height: "+(u-i-1)+'px;"><div class="luckysheet-selection-copy-top luckysheet-copy"></div><div class="luckysheet-selection-copy-right luckysheet-copy"></div><div class="luckysheet-selection-copy-bottom luckysheet-copy"></div><div class="luckysheet-selection-copy-left luckysheet-copy"></div><div class="luckysheet-selection-copy-hc"></div></div>';$("#luckysheet-selection-copy").append(a)}},collaborativeEditBox:function(){let e=o.visibledatacolumn,l=o.visibledatarow;o.cooperativeEdit.changeCollaborationSize.forEach(t=>{if(t.i==o.currentSheetIndex){let s=t.v.column,c=e[s[0]]-1;0!==t.v.column[0]&&(c=e[s[1]]-e[s[0]-1]-(s[1]-s[0]+1));let h=t.v.row,u=l[h[0]]-1;0!==t.v.row[0]&&(u=l[h[1]]-l[h[0]-1]-(h[1]-h[0]+1));let i=o.cooperativeEdit.merge_range,n=e[t.v.column[0]-1]-1,_=l[t.v.row[0]-1]-1;if(null!==o.config.columnlen)for(let e in o.config.columnlen)if(t.v.column[0]<=e&&e<=t.v.column[1]){o.luckysheet_cols_change_size_start[1]=e-0;break}if(null!==o.config.rowlen)for(let e in o.config.rowlen)if(t.v.row[0]<=e&&e<=t.v.row[1]){o.luckysheet_rows_change_size_start[1]=e-0;break}if(t.v.column[0]<=o.luckysheet_cols_change_size_start[1]&&o.luckysheet_cols_change_size_start[1]<=t.v.column[1])if(0==o.luckysheet_cols_change_size_start[1])c=e[0]-1;else{let l=t.v.column;c=e[l[1]]-e[l[0]-1]-(l[1]-l[0]+1)}if(t.v.row[0]<=o.luckysheet_rows_change_size_start[1]&&o.luckysheet_rows_change_size_start[1]<=t.v.row[1])if(0==o.luckysheet_rows_change_size_start[1])u=l[0]-1;else{let e=t.v.row;u=l[e[1]]-l[e[0]-1]-(e[1]-e[0]+1)}if(Object.keys(i).length>0){let o=!1;if(i.v.length>1&&(o=Object.keys(i.v[1][0]).length>0),i.v[0].length>1&&(o=Object.keys(i.v[0][1]).length>0),o){let s=i.column[0]<=t.v.column[0]&&i.column[1]>=t.v.column[1];if(n=e[i.column[0]-1]-1,_=l[i.row[0]-1]-1,c=e[i.column[1]]-1,u=l[i.row[1]]-1,s){if(0!==i.column[0]){let l=i.column;c=e[l[1]]-e[l[0]-1]-(l[1]-l[0]+1)}else n=0;t.v.column=i.column}if(i.row[0]<=t.v.row[0]&&i.row[1]>=t.v.row[1]){if(0!==i.row[0]){let e=i.row;u=l[e[1]]-l[e[0]-1]-(e[1]-e[0]+1)}else _=0;t.v.row=i.row}}else c=e[s[0]]-e[s[0]-1]-1,0===s[0]&&(c=e[s[0]]-1),u=l[h[0]]-l[h[0]-1]-1,0===h[0]&&(u=l[h[0]]-1)}$("#luckysheet-multipleRange-show-"+t.id).css({height:u,width:c,top:_+"px",left:n+"px"});let a=$("#luckysheet-multipleRange-show-"+t.id)[0].offsetHeight-1;$("#luckysheet-multipleRange-show-"+t.id+">.username").css({bottom:a+"px"})}})},luckysheet_count_show:r,selectHelpboxFill:k}});
//# sourceMappingURL=../sourcemaps/widgets/select.js.map
