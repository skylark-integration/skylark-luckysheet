/**
 * skylark-lucksheet - A version of lucksheet.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["../methods/imageCtrl_methods","../methods/location","./constant","../methods/protection_methods","../methods/get","../methods/set","../utils/util","../store","../locale/locale"],function(e,t,o,i,l,d,a,r,s){"use strict";const{mouseposition:c}=t,{modelHTML:n}=o,{checkProtectionAuthorityNormal:h}=i,{getSheetIndex:m}=l,{setluckysheet_scroll_status:g}=d,{replaceHtml:u}=a;return Object.assign(e,{modelHtml:function(e,t){let o=t.src,i=this.getImgItemParam(t),l=i.width*r.zoomRatio,d=i.height*r.zoomRatio,a=i.left*r.zoomRatio,s=i.top*r.zoomRatio,c=i.position,n=t.border.width;return`<div id="${e}" class="luckysheet-modal-dialog luckysheet-modal-dialog-image" style="width:${l}px;height:${d}px;padding:0;position:${c};left:${a}px;top:${s}px;z-index:200;">\n                    <div class="luckysheet-modal-dialog-content" style="width:100%;height:100%;overflow:hidden;position:relative;">\n                        <img src="${o}" style="position:absolute;width:${t.default.width*r.zoomRatio}px;height:${t.default.height*r.zoomRatio}px;left:${-t.crop.offsetLeft*r.zoomRatio}px;top:${-t.crop.offsetTop*r.zoomRatio}px;" />\n                    </div>\n                    <div class="luckysheet-modal-dialog-border" style="border:${n}px ${t.border.style} ${t.border.color};border-radius:${t.border.radius*r.zoomRatio}px;position:absolute;left:${-n}px;right:${-n}px;top:${-n}px;bottom:${-n}px;"></div>\n                </div>`},getSliderHtml:function(){let e=s().imageText;return`<div id="luckysheet-modal-dialog-slider-imageCtrl" class="luckysheet-modal-dialog-slider luckysheet-modal-dialog-slider-imageCtrl" style="display:block;">\n                    <div class="luckysheet-modal-dialog-slider-title">\n                        <span>${e.imageSetting}</span>\n                        <span class="luckysheet-model-close-btn" title="${e.close}">\n                            <i class="fa fa-times" aria-hidden="true"></i>\n                        </span>\n                    </div>\n                    <div class="luckysheet-modal-dialog-slider-content">\n                        <div class="slider-box">\n                            <div class="slider-box-title">${e.conventional}</div>\n                            <div class="slider-box-radios">\n                                <div class="radio-item">\n                                    <input type="radio" id="imgItemType1" name="imgItemType" value="1">\n                                    <label for="imgItemType1">${e.moveCell1}</label>\n                                </div>\n                                <div class="radio-item">\n                                    <input type="radio" id="imgItemType2" name="imgItemType" value="2">\n                                    <label for="imgItemType2">${e.moveCell2}</label>\n                                </div>\n                                <div class="radio-item">\n                                    <input type="radio" id="imgItemType3" name="imgItemType" value="3">\n                                    <label for="imgItemType3">${e.moveCell3}</label>\n                                </div>\n                            </div>\n                            <div class="slider-box-checkbox">\n                                <input type="checkbox" id="imgItemIsFixedPos">\n                                <label for="imgItemIsFixedPos">${e.fixedPos}</label>\n                            </div>\n                        </div>\n                        <div class="slider-box">\n                            <div class="slider-box-title">${e.border}</div>\n                            <div class="slider-box-borderConfig">\n                                <div class="border-item">\n                                    <label>${e.width}</label>\n                                    <input type="number" id="imgItemBorderWidth" min="0">\n                                </div>\n                                <div class="border-item">\n                                    <label>${e.radius}</label>\n                                    <input type="number" id="imgItemBorderRadius" min="0">\n                                </div>\n                                <div class="border-item">\n                                    <label>${e.style}</label>\n                                    <select id="imgItemBorderStyle">\n                                        <option value="solid">${e.solid}</option>\n                                        <option value="dashed">${e.dashed}</option>\n                                        <option value="dotted">${e.dotted}</option>\n                                        <option value="double">${e.double}</option>\n                                    </select>\n                                </div>\n                                <div class="border-item">\n                                    <label>${e.color}</label>\n                                    <div id="imgItemBorderColor" class="imgItemBorderColor">\n                                        <span></span>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>`},sliderHtmlShow:function(){$("#luckysheet-modal-dialog-slider-imageCtrl").remove();let e=this.getSliderHtml();$("body").append(e);let t=this.images[this.currentImgId],o=t.type;$("#luckysheet-modal-dialog-slider-imageCtrl #imgItemType"+o).prop("checked",!0);let i=t.isFixedPos;$("#luckysheet-modal-dialog-slider-imageCtrl #imgItemIsFixedPos").prop("checked",i);let l=t.border;$("#luckysheet-modal-dialog-slider-imageCtrl #imgItemBorderWidth").val(l.width),$("#luckysheet-modal-dialog-slider-imageCtrl #imgItemBorderRadius").val(l.radius),$("#luckysheet-modal-dialog-slider-imageCtrl #imgItemBorderStyle").val(l.style),$("#luckysheet-modal-dialog-slider-imageCtrl #imgItemBorderColor span").css("background-color",l.color).attr("title",l.color),this.init()},colorSelectDialog:function(e){const t=s(),o=t.button,i=t.toolbar,l=t.imageCtrl;$("#luckysheet-modal-dialog-mask").show(),$("#luckysheet-imageCtrl-colorSelect-dialog").remove(),$("body").append(u(n,{id:"luckysheet-imageCtrl-colorSelect-dialog",addclass:"luckysheet-imageCtrl-colorSelect-dialog",title:l.borderTile,content:`<div class="currenColor">\n                            ${l.borderCur}:<span title="${e}" style="background-color:${e}"></span>\n                        </div>\n                        <div class="colorshowbox"></div>`,botton:`<button id="luckysheet-imageCtrl-colorSelect-dialog-confirm" class="btn btn-primary">${o.confirm}</button>\n                        <button class="btn btn-default luckysheet-model-close-btn">${o.cancel}</button>`,style:"z-index:100003"}));let d=$("#luckysheet-imageCtrl-colorSelect-dialog").find(".luckysheet-modal-dialog-content").css("min-width",300).end(),a=d.outerHeight(),c=d.outerWidth(),h=$(window).width(),m=$(window).height(),g=$(document).scrollLeft(),f=$(document).scrollTop();$("#luckysheet-imageCtrl-colorSelect-dialog").css({left:(h+g-c)/2,top:(m+f-a)/3}).show(),$("#luckysheet-imageCtrl-colorSelect-dialog").find(".colorshowbox").spectrum({showPalette:!0,showPaletteOnly:!0,preferredFormat:"hex",clickoutFiresChange:!1,showInitial:!0,showInput:!0,flat:!0,hideAfterPaletteSelect:!0,showSelectionPalette:!0,showButtons:!1,maxPaletteSize:8,maxSelectionSize:8,color:e,cancelText:o.cancel,chooseText:i.confirmColor,togglePaletteMoreText:i.customColor,togglePaletteLessText:i.collapse,togglePaletteOnly:!0,clearText:i.clearText,noColorSelectedText:i.noColorSelectedText,localStorageKey:"spectrum.textcolor"+r.gridKey,palette:[["#000","#444","#666","#999","#ccc","#eee","#f3f3f3","#fff"],["#f00","#f90","#ff0","#0f0","#0ff","#00f","#90f","#f0f"],["#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d0e0e3","#cfe2f3","#d9d2e9","#ead1dc"],["#ea9999","#f9cb9c","#ffe599","#b6d7a8","#a2c4c9","#9fc5e8","#b4a7d6","#d5a6bd"],["#e06666","#f6b26b","#ffd966","#93c47d","#76a5af","#6fa8dc","#8e7cc3","#c27ba0"],["#c00","#e69138","#f1c232","#6aa84f","#45818e","#3d85c6","#674ea7","#a64d79"],["#900","#b45f06","#bf9000","#38761d","#134f5c","#0b5394","#351c75","#741b47"],["#600","#783f04","#7f6000","#274e13","#0c343d","#073763","#20124d","#4c1130"]],move:function(e){e=null!=e?e.toHexString():"#000",$("#luckysheet-imageCtrl-colorSelect-dialog .currenColor span").css("background-color",e).attr("title",e)}})},init:function(){let e=this;$("#luckysheet-modal-dialog-slider-imageCtrl .luckysheet-model-close-btn").click(function(){$("#luckysheet-modal-dialog-slider-imageCtrl").hide()}),$("#luckysheet-modal-dialog-slider-imageCtrl").off("change.radio").on("change.radio",".radio-item input[type=radio][name=imgItemType]",function(){e.configChange("type",this.value)}),$("#luckysheet-modal-dialog-slider-imageCtrl").off("change.checkbox").on("change.checkbox",".slider-box-checkbox input[type=checkbox]",function(){e.configChange("fixedPos",this.checked)}),$("#luckysheet-modal-dialog-slider-imageCtrl").off("change.borderWidth").on("change.borderWidth","#imgItemBorderWidth",function(){e.configChange("border-width",this.valueAsNumber)}),$("#luckysheet-modal-dialog-slider-imageCtrl").off("change.borderRadius").on("change.borderRadius","#imgItemBorderRadius",function(){e.configChange("border-radius",this.valueAsNumber)}),$("#luckysheet-modal-dialog-slider-imageCtrl").off("change.borderStyle").on("change.borderStyle","#imgItemBorderStyle",function(){e.configChange("border-style",this.value)}),$("#luckysheet-modal-dialog-slider-imageCtrl").off("click.color").on("click.color","#imgItemBorderColor",function(){let t=$(this).find("span").attr("title");e.colorSelectDialog(t)}),$(document).off("click.selectColorConfirm").on("click.selectColorConfirm","#luckysheet-imageCtrl-colorSelect-dialog-confirm",function(){let t=$(this).parents("#luckysheet-imageCtrl-colorSelect-dialog");$("#luckysheet-modal-dialog-mask").hide(),t.hide();let o=t.find(".currenColor span").attr("title");$("#luckysheet-modal-dialog-slider-imageCtrl #imgItemBorderColor span").css("background-color",o).attr("title",o),e.configChange("border-color",o)}),$("#luckysheet-image-showBoxs").off("mousedown.active").on("mousedown.active",".luckysheet-modal-dialog-image",function(t){if(!h(r.currentSheetIndex,"editObjects",!1))return;$(this).hide();let o=$(this).attr("id");null!=e.currentImgId&&e.currentImgId!=o&&e.cancelActiveImgItem(),e.currentImgId=o;let i=e.images[o],l=e.getImgItemParam(i),d=l.width*r.zoomRatio,a=l.height*r.zoomRatio,s=l.left*r.zoomRatio,c=l.top*r.zoomRatio,n=l.position;$("#luckysheet-modal-dialog-activeImage").show().css({width:d,height:a,left:s,top:c,position:n}),$("#luckysheet-modal-dialog-activeImage .luckysheet-modal-dialog-content").css({"background-image":"url("+i.src+")","background-size":i.default.width*r.zoomRatio+"px "+i.default.height*r.zoomRatio+"px","background-position":-i.crop.offsetLeft*r.zoomRatio+"px "+-i.crop.offsetTop*r.zoomRatio+"px"}),$("#luckysheet-modal-dialog-activeImage .luckysheet-modal-dialog-border").css({"border-width":i.border.width*r.zoomRatio,"border-style":i.border.style,"border-color":i.border.color,"border-radius":i.border.radius*r.zoomRatio,left:-i.border.width*r.zoomRatio,right:-i.border.width*r.zoomRatio,top:-i.border.width*r.zoomRatio,bottom:-i.border.width*r.zoomRatio}),e.sliderHtmlShow(),t.stopPropagation()}),$("#luckysheet-modal-dialog-activeImage").off("mousedown.move").on("mousedown.move",".luckysheet-modal-dialog-content",function(t){if(!h(r.currentSheetIndex,"editObjects",!1))return;$("#luckysheet-modal-dialog-slider-imageCtrl").is(":visible")||e.sliderHtmlShow(),e.move=!0,e.currentWinW=$("#luckysheet-cell-main")[0].scrollWidth,e.currentWinH=$("#luckysheet-cell-main")[0].scrollHeight;let o=$("#luckysheet-modal-dialog-activeImage").offset();e.moveXY=[t.pageX-o.left,t.pageY-o.top],g(!0),t.stopPropagation()}),$("#luckysheet-modal-dialog-activeImage").off("mousedown.resize").on("mousedown.resize",".luckysheet-modal-dialog-resize-item",function(t){if(!h(r.currentSheetIndex,"editObjects",!1))return;e.currentWinW=$("#luckysheet-cell-main")[0].scrollWidth,e.currentWinH=$("#luckysheet-cell-main")[0].scrollHeight,e.resize=$(this).data("type");let o=$("#luckysheet-cell-main").scrollTop(),i=$("#luckysheet-cell-main").scrollLeft(),l=c(t.pageX,t.pageY),d=l[0]+i,a=l[1]+o,s=$("#luckysheet-modal-dialog-activeImage").position(),n=$("#luckysheet-modal-dialog-activeImage").width(),m=$("#luckysheet-modal-dialog-activeImage").height();e.resizeXY=[d,a,n,m,s.left+i,s.top+o,i,o],g(!0),t.stopPropagation()}),$("#luckysheet-modal-dialog-activeImage").off("mousedown.croppingEnter").on("mousedown.croppingEnter",".luckysheet-modal-controll-crop",function(t){e.croppingEnter(),t.stopPropagation()}),$("#luckysheet-modal-dialog-cropping").off("mousedown.croppingExit").on("mousedown.croppingExit",".luckysheet-modal-controll-crop",function(t){e.croppingExit(),t.stopPropagation()}),$("#luckysheet-modal-dialog-cropping").off("mousedown.cropChange").on("mousedown.cropChange",".resize-item",function(t){e.cropChange=$(this).data("type");let o=$("#luckysheet-cell-main").scrollTop(),i=$("#luckysheet-cell-main").scrollLeft(),l=c(t.pageX,t.pageY),d=l[0]+i,a=l[1]+o;e.cropChangeXY=[d,a],g(!0),t.stopPropagation()}),$("#luckysheet-image-showBoxs").off("mousedown.restore").on("mousedown.restore",".luckysheet-modal-controll-restore",function(t){e.restoreImgItem(),t.stopPropagation()}),$("#luckysheet-image-showBoxs").off("mousedown.delete").on("mousedown.delete",".luckysheet-modal-controll-del",function(t){e.removeImgItem(),t.stopPropagation()})},configChange:function(e,t){let o=this,i=o.images[o.currentImgId];switch(e){case"type":i.type=t;break;case"fixedPos":i.isFixedPos=t;let l=o.getImgItemParam(i),d=l.width,a=l.height,r=l.left,s=l.top,c=l.position;$("#luckysheet-modal-dialog-activeImage").show().css({width:d,height:a,left:r,top:s,position:c});break;case"border-width":i.border.width=t,$("#luckysheet-modal-dialog-activeImage .luckysheet-modal-dialog-border").css({"border-width":t,left:-t,right:-t,top:-t,bottom:-t});break;case"border-radius":i.border.radius=t,$("#luckysheet-modal-dialog-activeImage .luckysheet-modal-dialog-border").css("border-radius",t);break;case"border-style":i.border.style=t,$("#luckysheet-modal-dialog-activeImage .luckysheet-modal-dialog-border").css("border-style",t);break;case"border-color":i.border.color=t,$("#luckysheet-modal-dialog-activeImage .luckysheet-modal-dialog-border").css("border-color",t)}o.ref()},cancelActiveImgItem:function(){$("#luckysheet-modal-dialog-activeImage").hide(),$("#luckysheet-modal-dialog-cropping").hide(),$("#luckysheet-modal-dialog-slider-imageCtrl").hide();let e=this.images[this.currentImgId],t=this.getImgItemParam(e),o=t.width*r.zoomRatio,i=t.height*r.zoomRatio,l=t.left*r.zoomRatio,d=t.top*r.zoomRatio,a=t.position;$("#"+this.currentImgId).show().css({width:o,height:i,left:l,top:d,position:a}),$("#"+this.currentImgId+" img").css({width:e.default.width*r.zoomRatio,height:e.default.height*r.zoomRatio,left:-e.crop.offsetLeft*r.zoomRatio,top:-e.crop.offsetTop*r.zoomRatio}),$("#"+this.currentImgId+" .luckysheet-modal-dialog-border").css({"border-width":e.border.width*r.zoomRatio,"border-style":e.border.style,"border-color":e.border.color,"border-radius":e.border.radius*r.zoomRatio,left:-e.border.width*r.zoomRatio,right:-e.border.width*r.zoomRatio,top:-e.border.width*r.zoomRatio,bottom:-e.border.width*r.zoomRatio}),this.currentImgId=null},addImgItem:function(e){let t,o,i=this;e.originHeight<e.originWidth?(o=Math.round(e.originHeight*(400/e.originWidth)),t=400):(t=Math.round(e.originWidth*(400/e.originHeight)),o=400),null==i.images&&(i.images={});let l=$.extend(!0,{},i.imgItem);l.src=e.src,l.originWidth=e.originWidth,l.originHeight=e.originHeight,l.default.width=t,l.default.height=o,l.default.left=e.left,l.default.top=e.top,l.crop.width=t,l.crop.height=o;let d=$("#luckysheet-cell-main").scrollTop(),a=$("#luckysheet-cell-main").scrollLeft();l.fixedLeft=e.left-a+r.rowHeaderWidth,l.fixedTop=e.top-d+r.infobarHeight+r.toolbarHeight+r.calculatebarHeight+r.columnHeaderHeight;let s=i.generateRandomId(),c=i.modelHtml(s,l);$("#luckysheet-image-showBoxs .img-list").append(c),i.images[s]=l,i.ref(),i.init()},moveImgItem:function(){this.move=!1;let e=$("#luckysheet-modal-dialog-activeImage")[0],t=this.images[this.currentImgId];t.isFixedPos?(t.fixedLeft=e.offsetLeft-t.crop.offsetLeft,t.fixedTop=e.offsetTop-t.crop.offsetTop):(t.default.left=e.offsetLeft-t.crop.offsetLeft,t.default.top=e.offsetTop-t.crop.offsetTop),this.ref()},resizeImgItem:function(){this.resize=null;let e=$("#luckysheet-modal-dialog-activeImage")[0],t=this.images[this.currentImgId],o=e.clientWidth/t.crop.width,i=e.clientHeight/t.crop.height;t.default.width=Math.round(t.default.width*o),t.default.height=Math.round(t.default.height*i),t.crop.width=Math.round(t.crop.width*o),t.crop.height=Math.round(t.crop.height*i),t.crop.offsetLeft=Math.round(t.crop.offsetLeft*o),t.crop.offsetTop=Math.round(t.crop.offsetTop*i),t.isFixedPos?(t.fixedLeft=e.offsetLeft,t.fixedTop=e.offsetTop):(t.default.left=e.offsetLeft-t.crop.offsetLeft,t.default.top=e.offsetTop-t.crop.offsetTop),this.ref()},croppingEnter:function(){if(this.cropping=!0,!h(r.currentSheetIndex,"editObjects",!1))return;$("#luckysheet-modal-dialog-activeImage").hide(),$("#luckysheet-modal-dialog-slider-imageCtrl").hide();let e=this.images[this.currentImgId],t=this.getImgItemParam(e),o=t.width,i=t.height,l=t.left,d=t.top,a=t.position;$("#luckysheet-modal-dialog-cropping").show().css({width:o,height:i,left:l,top:d,position:a}),$("#luckysheet-modal-dialog-cropping .cropping-mask").css({width:e.default.width,height:e.default.height,"background-image":"url("+e.src+")",left:-e.crop.offsetLeft,top:-e.crop.offsetTop}),$("#luckysheet-modal-dialog-cropping .cropping-content").css({"background-image":"url("+e.src+")","background-size":e.default.width+"px "+e.default.height+"px","background-position":-e.crop.offsetLeft+"px "+-e.crop.offsetTop+"px"}),$("#luckysheet-modal-dialog-cropping .luckysheet-modal-dialog-border").css({"border-width":e.border.width,"border-style":e.border.style,"border-color":e.border.color,"border-radius":e.border.radius,left:-e.border.width,right:-e.border.width,top:-e.border.width,bottom:-e.border.width})},croppingExit:function(){this.cropping=!1,$("#luckysheet-modal-dialog-cropping").hide();let e=this.images[this.currentImgId],t=this.getImgItemParam(e),o=t.width,i=t.height,l=t.left,d=t.top,a=t.position;$("#luckysheet-modal-dialog-activeImage").show().css({width:o,height:i,left:l,top:d,position:a}),$("#luckysheet-modal-dialog-activeImage .luckysheet-modal-dialog-content").css({"background-image":"url("+e.src+")","background-size":e.default.width+"px "+e.default.height+"px","background-position":-e.crop.offsetLeft+"px "+-e.crop.offsetTop+"px"})},cropChangeImgItem:function(){this.cropChange=null;let e=this.images[this.currentImgId];e.crop.width=this.cropChangeObj.width,e.crop.height=this.cropChangeObj.height,e.crop.offsetLeft=this.cropChangeObj.offsetLeft,e.crop.offsetTop=this.cropChangeObj.offsetTop,this.ref()},restoreImgItem:function(){let e=this.images[this.currentImgId];e.default.width=e.originWidth,e.default.height=e.originHeight,e.crop.width=e.originWidth,e.crop.height=e.originHeight,e.crop.offsetLeft=0,e.crop.offsetTop=0;let t=this.getImgItemParam(e),o=t.width,i=t.height,l=t.left,d=t.top,a=t.position;$("#luckysheet-modal-dialog-activeImage").show().css({width:o,height:i,left:l,top:d,position:a}),$("#luckysheet-modal-dialog-activeImage .luckysheet-modal-dialog-content").css({"background-image":"url("+e.src+")","background-size":e.default.width+"px "+e.default.height+"px","background-position":-e.crop.offsetLeft+"px "+-e.crop.offsetTop+"px"}),this.ref()},removeImgItem:function(){$("#luckysheet-modal-dialog-activeImage").hide(),$("#luckysheet-modal-dialog-cropping").hide(),$("#luckysheet-modal-dialog-slider-imageCtrl").hide(),$("#"+this.currentImgId).remove(),delete this.images[this.currentImgId],this.currentImgId=null,this.ref()},copyImgItem:function(e){this.copyImgItemObj=$.extend(!0,{},this.images[this.currentImgId]);let t=window.clipboardData;t||(t=e.originalEvent.clipboardData);let o='<table data-type="luckysheet_copy_action_image"><tr><td><td></tr></table>';if(t)return t.setData("Text",o),!1;{let e=$("#luckysheet-copy-content");e.html(o),e.focus(),e.select(),document.execCommand("selectAll"),document.execCommand("Copy"),setTimeout(function(){$("#luckysheet-copy-content").blur()},10)}},pasteImgItem:function(){let e=r.luckysheet_select_save[0].row_focus||0,t=r.luckysheet_select_save[0].column_focus||0,o=0==t?0:r.visibledatacolumn[t-1],i=0==e?0:r.visibledatarow[e-1],l=$.extend(!0,{},this.copyImgItemObj);l.default.left=o-l.crop.offsetLeft,l.default.top=i-l.crop.offsetTop;let d=$("#luckysheet-cell-main").scrollTop(),a=$("#luckysheet-cell-main").scrollLeft();l.fixedLeft=l.default.left-a+r.rowHeaderWidth,l.fixedTop=l.default.top-d+r.infobarHeight+r.toolbarHeight+r.calculatebarHeight+r.columnHeaderHeight;let s=this.generateRandomId(),c=this.modelHtml(s,l);$("#luckysheet-image-showBoxs .img-list").append(c),this.images[s]=l,this.ref(),this.init()},allImagesShow:function(){let e=this;if($("#luckysheet-modal-dialog-activeImage").hide(),$("#luckysheet-modal-dialog-cropping").hide(),$("#luckysheet-modal-dialog-slider-imageCtrl").hide(),$("#luckysheet-image-showBoxs .img-list").empty(),null!=e.images)for(let t in e.images){let o=e.images[t],i=e.modelHtml(t,o);$("#luckysheet-image-showBoxs .img-list").append(i)}}})});
//# sourceMappingURL=../sourcemaps/widgets/imageCtrl.js.map
