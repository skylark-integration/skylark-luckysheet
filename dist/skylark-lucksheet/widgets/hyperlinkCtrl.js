/**
 * skylark-lucksheet - A version of lucksheet.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["../utils/util","../methods/getdata","../methods/location","../methods/formula_methods","./tooltip","./constant","./select","../methods/cells","../methods/get","../locale/locale","../store"],function(e,l,t,i,n,o,s,a,r,c,d){"use strict";const{replaceHtml:k}=e,{getcellvalue:h}=l,{rowLocation:u,colLocation:y,mouseposition:p}=t,{modelHTML:f}=o,{selectHightlightShow:g}=s,{getSheetIndex:v}=r;return{item:{linkType:"external",linkAddress:"",linkTooltip:""},hyperlink:null,createDialog:function(){const e=c(),l=e.insertLink,t=e.toolbar,i=e.button;$("#luckysheet-modal-dialog-mask").show(),$("#luckysheet-insertLink-dialog").remove();let n="";d.luckysheetfile.forEach(e=>{n+=`<option value="${e.name}">${e.name}</option>`});let o=`<div class="box">\n                            <div class="box-item">\n                                <label for="luckysheet-insertLink-dialog-linkText">${l.linkText}：</label>\n                                <input type="text" id="luckysheet-insertLink-dialog-linkText"/>\n                            </div>\n                            <div class="box-item">\n                                <label for="luckysheet-insertLink-dialog-linkType">${l.linkType}：</label>\n                                <select id="luckysheet-insertLink-dialog-linkType">\n                                    <option value="external">${l.external}</option>\n                                    <option value="internal">${l.internal}</option>\n                                </select>\n                            </div>\n                            <div class="show-box show-box-external">\n                                <div class="box-item">\n                                    <label for="luckysheet-insertLink-dialog-linkAddress">${l.linkAddress}：</label>\n                                    <input type="text" id="luckysheet-insertLink-dialog-linkAddress" placeholder="${l.placeholder1}" />\n                                </div>\n                            </div>\n                            <div class="show-box show-box-internal">\n                                <div class="box-item">\n                                    <label for="luckysheet-insertLink-dialog-linkSheet">${l.linkSheet}：</label>\n                                    <select id="luckysheet-insertLink-dialog-linkSheet">\n                                        ${n}\n                                    </select>\n                                </div>\n                                <div class="box-item">\n                                    <label for="luckysheet-insertLink-dialog-linkCell">${l.linkCell}：</label>\n                                    <input type="text" id="luckysheet-insertLink-dialog-linkCell" value="A1" placeholder="${l.placeholder2}" />\n                                </div>\n                            </div>\n                            <div class="box-item">\n                                <label for="luckysheet-insertLink-dialog-linkTooltip">${l.linkTooltip}：</label>\n                                <input type="text" id="luckysheet-insertLink-dialog-linkTooltip" placeholder="${l.placeholder3}" />\n                            </div>\n                        </div>`;$("body").append(k(f,{id:"luckysheet-insertLink-dialog",addclass:"luckysheet-insertLink-dialog",title:t.insertLink,content:o,botton:`<button id="luckysheet-insertLink-dialog-confirm" class="btn btn-primary">${i.confirm}</button>\n                        <button class="btn btn-default luckysheet-model-close-btn">${i.cancel}</button>`,style:"z-index:100003"}));let s=$("#luckysheet-insertLink-dialog").find(".luckysheet-modal-dialog-content").css("min-width",350).end(),a=s.outerHeight(),r=s.outerWidth(),h=$(window).width(),u=$(window).height(),y=$(document).scrollLeft(),p=$(document).scrollTop();$("#luckysheet-insertLink-dialog").css({left:(h+y-r)/2,top:(u+p-a)/3}).show(),this.dataAllocation()},init:function(){let e=this;const l=c().insertLink;$(document).off("change.linkType").on("change.linkType","#luckysheet-insertLink-dialog-linkType",function(e){let l=this.value;$("#luckysheet-insertLink-dialog .show-box").hide(),$("#luckysheet-insertLink-dialog .show-box-"+l).show()}),$(document).off("click.confirm").on("click.confirm","#luckysheet-insertLink-dialog-confirm",function(t){let o=d.luckysheet_select_save[d.luckysheet_select_save.length-1],s=o.row_focus||o.row[0],a=o.column_focus||o.column[0],r=$("#luckysheet-insertLink-dialog-linkText").val(),c=$("#luckysheet-insertLink-dialog-linkType").val(),k=$("#luckysheet-insertLink-dialog-linkAddress").val(),h=$("#luckysheet-insertLink-dialog-linkSheet").val(),u=$("#luckysheet-insertLink-dialog-linkCell").val(),y=$("#luckysheet-insertLink-dialog-linkTooltip").val();if("external"==c){if(/^http[s]?:\/\//.test(k)||(k="https://"+k),!/^http[s]?:\/\/([\w\-\.]+)+[\w-]*([\w\-\.\/\?%&=]+)?$/gi.test(k))return void n.info('<i class="fa fa-exclamation-triangle"></i>',l.tooltipInfo1)}else{if(!i.iscelldata(u))return void n.info('<i class="fa fa-exclamation-triangle"></i>',l.tooltipInfo2);k=h+"!"+u}null!=r&&""!=r.replace(/\s/g,"")||(r=k);let p={linkType:c,linkAddress:k,linkTooltip:y},f=$.extend(!0,{},e.hyperlink),g=$.extend(!0,{},e.hyperlink);g[s+"_"+a]=p;let v=d.deepCopyFlowData(d.flowdata),m=v[s][a];null==m&&(m={}),m.fc="rgb(0, 0, 255)",m.un=1,m.v=r,v[s][a]=m,e.ref(f,g,d.currentSheetIndex,v,{row:[s,s],column:[a,a]}),$("#luckysheet-modal-dialog-mask").hide(),$("#luckysheet-insertLink-dialog").hide()})},dataAllocation:function(){let e=d.luckysheet_select_save[d.luckysheet_select_save.length-1],l=e.row_focus||e.row[0],t=e.column_focus||e.column[0],n=(this.hyperlink||{})[l+"_"+t]||{},o=h(l,t,null,"m");$("#luckysheet-insertLink-dialog-linkText").val(o);let s=n.linkType||"external";$("#luckysheet-insertLink-dialog-linkType").val(s),$("#luckysheet-insertLink-dialog .show-box").hide(),$("#luckysheet-insertLink-dialog .show-box-"+s).show();let a=n.linkAddress||"";if("external"==s)$("#luckysheet-insertLink-dialog-linkAddress").val(a);else if(i.iscelldata(a)){let e=a.split("!")[0],l=a.split("!")[1];$("#luckysheet-insertLink-dialog-linkSheet").val(e),$("#luckysheet-insertLink-dialog-linkCell").val(l)}let r=n.linkTooltip||"";$("#luckysheet-insertLink-dialog-linkTooltip").val(r)},cellFocus:function(e,l){if(null==this.hyperlink||null==this.hyperlink[e+"_"+l])return;let t=this.hyperlink[e+"_"+l];if("external"==t.linkType)window.open(t.linkAddress);else{let e=i.getcellrange(t.linkAddress),l=e.sheetIndex,n=[{row:e.row,column:e.column}];l!=d.currentSheetIndex&&($("#luckysheet-sheet-area div.luckysheet-sheets-item").removeClass("luckysheet-sheets-item-active"),$("#luckysheet-sheets-item"+l).addClass("luckysheet-sheets-item-active"),d.changeSheet(l)),d.luckysheet_select_save=n,g(!0);let o=e.row[0]-1==-1?0:d.visibledatarow[e.row[0]-1],s=e.column[0]-1==-1?0:d.visibledatacolumn[e.column[0]-1];$("#luckysheet-scrollbar-x").scrollLeft(s),$("#luckysheet-scrollbar-y").scrollTop(o)}},overshow:function(e){if($("#luckysheet-hyperlink-overshow").remove(),0==$(e.target).closest("#luckysheet-cell-main").length)return;let l=p(e.pageX,e.pageY),t=$("#luckysheet-cell-main").scrollLeft(),i=$("#luckysheet-cell-main").scrollTop(),n=l[0]+t,o=l[1]+i;if(null!=d.freezenverticaldata&&l[0]<d.freezenverticaldata[0]-d.freezenverticaldata[2])return;if(null!=d.freezenhorizontaldata&&l[1]<d.freezenhorizontaldata[0]-d.freezenhorizontaldata[2])return;let s=u(o)[2],r=y(n)[2],c=a.mergeborer(d.flowdata,s,r);if(c&&(s=c.row[2],r=c.column[2]),null==this.hyperlink||null==this.hyperlink[s+"_"+r])return;let k=this.hyperlink[s+"_"+r],h=k.linkTooltip;null!=h&&""!=h.replace(/\s/g,"")||(h=k.linkAddress);let f=d.visibledatarow[s],g=s-1==-1?0:d.visibledatarow[s-1],v=d.visibledatacolumn[r],m=r-1==-1?0:d.visibledatacolumn[r-1];c&&(f=c.row[1],g=c.row[0],v=c.column[1],m=c.column[0]);let b=`<div id="luckysheet-hyperlink-overshow" style="background:#fff;padding:5px 10px;border:1px solid #000;box-shadow:2px 2px #999;position:absolute;left:${m}px;top:${f+5}px;z-index:100;">\n                        <div>${h}</div>\n                        <div>单击鼠标可以追踪</div>\n                    </div>`;$(b).appendTo($("#luckysheet-cell-main"))},ref:function(e,l,t,i,n){if(d.clearjfundo){d.jfundo.length=0;let o={type:"updateHyperlink"};o.sheetIndex=t,o.historyHyperlink=e,o.currentHyperlink=l,o.data=d.flowdata,o.curData=i,o.range=n,d.jfredo.push(o)}this.hyperlink=l,d.luckysheetfile[v(t)].hyperlink=l,d.flowdata=i,d.webWorkerFlowDataCache(d.flowdata),d.luckysheetfile[v(t)].data=d.flowdata,d.allowUpdate&&(d.saveParam("all",t,l,{k:"hyperlink"}),d.historyParam(d.flowdata,t,n)),d.refresh()}}});
//# sourceMappingURL=../sourcemaps/widgets/hyperlinkCtrl.js.map
