/**
 * skylark-lucksheet - A version of lucksheet.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["../../utils/util","../../utils/chartUtil","../../methods/getdata","../../store","../../controllers/formula","../../function/func","../../methods/get","../../methods/location","../../methods/set","../../controllers/sheetMove","../../methods/luckysheetConfigsetting","../../widgets/resize","../../vendors/Vuex","../../vendors/Vue","../../vendors/element-ui","./chartmix"],function(e,t,r,a,l,n,o,c,i,s,h,d,u,g,y,m){"use strict";const{seriesLoadScripts:p,loadLinks:k,$$:f,arrayRemoveItem:x}=e,{generateRandomKey:v,replaceHtml:w}=t,{getdatabyselection:b,getcellvalue:C}=r,{luckysheet_getcelldata:z}=n,{getSheetIndex:_,getRangetxt:S,getvisibledatacolumn:A,getvisibledatarow:R}=o,{rowLocation:I,colLocation:M,mouseposition:T}=c,{setluckysheet_scroll_status:O}=i,{luckysheetMoveHighlightCell:j,luckysheetMoveHighlightCell2:W,luckysheetMoveHighlightRange:D,luckysheetMoveHighlightRange2:H,luckysheetMoveEndCell:L}=s,E=h.isEditMode;let X=I,J=M;const P=["https://cdn.bootcdn.net/ajax/libs/element-ui/2.13.2/theme-chalk/index.css","expendPlugins/chart/chartmix.css"];function Y(e,t){if(void 0!=e)for(let r=0;r<e.length;r++){let l=e[r];t&&a.chartparam.insertToStore({chart_id:l.chart_id,chartOptions:l.chartOptions});let n=l.chart_id,o=n+"_c",c=$(w('<div id="${id}"class="luckysheet-modal-dialog luckysheet-modal-dialog-chart ${addclass}"tabindex="0"role="dialog"aria-labelledby=":41e"dir="ltr"><div class="luckysheet-modal-dialog-resize"><div class="luckysheet-modal-dialog-resize-item luckysheet-modal-dialog-resize-item-lt"data-type="lt"></div><div class="luckysheet-modal-dialog-resize-item luckysheet-modal-dialog-resize-item-mt"data-type="mt"></div><div class="luckysheet-modal-dialog-resize-item luckysheet-modal-dialog-resize-item-lm"data-type="lm"></div><div class="luckysheet-modal-dialog-resize-item luckysheet-modal-dialog-resize-item-rm"data-type="rm"></div><div class="luckysheet-modal-dialog-resize-item luckysheet-modal-dialog-resize-item-rt"data-type="rt"></div><div class="luckysheet-modal-dialog-resize-item luckysheet-modal-dialog-resize-item-lb"data-type="lb"></div><div class="luckysheet-modal-dialog-resize-item luckysheet-modal-dialog-resize-item-mb"data-type="mb"></div><div class="luckysheet-modal-dialog-resize-item luckysheet-modal-dialog-resize-item-rb"data-type="rb"></div></div><div class="luckysheet-modal-dialog-controll"><span class="luckysheet-modal-controll-btn luckysheet-modal-controll-update"role="button"tabindex="0"aria-label="修改图表"title="修改图表"><i class="fa fa-pencil"aria-hidden="true"></i></span><span class="luckysheet-modal-controll-btn luckysheet-modal-controll-max"role="butluckysheet_chartIns_indexton"tabindex="0"aria-label="最大化"title="最大化"><i class="fa fa-window-maximize"aria-hidden="true"></i></span><span class="luckysheet-modal-controll-btn luckysheet-modal-controll-del"role="button"tabindex="0"aria-label="删除"title="删除"><i class="fa fa-trash"aria-hidden="true"></i></span></div><div class="luckysheet-modal-dialog-content">${content}</div></div>',{id:o,addclass:"luckysheet-data-visualization-chart",title:"图表生成",content:""})).appendTo($(".luckysheet-cell-main"));N(c),$(`#${o}`).children(".luckysheet-modal-dialog-content")[0].id=n;let i,s=document.getElementById(o);i=a.chartparam.getChartJson(l.chart_id),a.chartparam.renderChart({chart_id:l.chart_id,chartOptions:i}),a.currentChart=i,K(n),$(`#${n}_c .luckysheet-modal-controll-del`).click(function(e){V(n)}),$(`#${n}_c .luckysheet-modal-controll-update`).click(function(e){F()}),c.children(".luckysheet-modal-dialog-content").mousedown(function(e){a.chartparam.luckysheetCurrentChartMaxState||K(n),e.stopPropagation()}),c.mousedown(function(e){if(!a.chartparam.luckysheetCurrentChartMaxState){K(n),O(!0),$(e.target).is(".luckysheet-modal-dialog-controll")||$(e.target).is(".luckysheet-modal-controll-btn")||$(e.target).is("i")||(a.chartparam.luckysheetCurrentChartMoveTimeout=setTimeout(function(){a.chartparam.luckysheetCurrentChartMove=!0},100));var t=a.chartparam.luckysheetCurrentChartMoveObj.offset(),r=a.chartparam.luckysheetCurrentChartMoveObj.position();a.chartparam.luckysheetCurrentChartMoveXy=[e.pageX-t.left,e.pageY-t.top,r.left,r.top,$("#luckysheet-scrollbar-x").scrollLeft(),$("#luckysheet-scrollbar-y").scrollTop()],a.chartparam.luckysheetCurrentChartMoveWinH=$("#luckysheet-cell-main")[0].scrollHeight,a.chartparam.luckysheetCurrentChartMoveWinW=$("#luckysheet-cell-main")[0].scrollWidth,$(e.target).hasClass("luckysheet-mousedown-cancel")||0!=$(e.target).filter("[class*='sp-palette']").length||0!=$(e.target).filter("[class*='sp-thumb']").length||0!=$(e.target).filter("[class*='sp-']").length||($("#luckysheet-rightclick-menu").hide(),$("#luckysheet-cols-h-hover").hide(),$("#luckysheet-cols-menu-btn").hide(),$("#luckysheet-rightclick-menu").hide(),$("#luckysheet-sheet-list, #luckysheet-rightclick-sheet-menu, #luckysheet-user-menu").hide(),$("body > .luckysheet-filter-menu, body > .luckysheet-filter-submenu, body > .luckysheet-cols-menu").hide()),e.stopPropagation()}}).find(".luckysheet-modal-dialog-resize-item").mousedown(function(e){if(a.chartparam.luckysheetCurrentChartActive){a.chartparam.luckysheetCurrentChartResize=$(this).data("type");var t=T(e.pageX,e.pageY),r=$("#luckysheet-scrollbar-x").scrollLeft(),l=$("#luckysheet-scrollbar-y").scrollTop(),o=t[0]+r,i=t[1]+l,s=a.chartparam.luckysheetCurrentChartResizeObj.position();a.chartparam.luckysheetCurrentChartResizeXy=[o,i,c.width(),c.height(),s.left+r,s.top+l,r,l],a.chartparam.luckysheetCurrentChartResizeWinH=$("#luckysheet-cell-main")[0].scrollHeight,a.chartparam.luckysheetCurrentChartResizeWinW=$("#luckysheet-cell-main")[0].scrollWidth,a.chartparam.luckysheetCurrentChart=n,e.stopPropagation()}});let h=l.width,d=l.height,u=l.left,g=l.top;s.style.width=h+"px",s.style.height=d+"px",s.style.position="absolute",s.style.background="#fff",s.style.left=u+"px",s.style.top=g+"px",s.style.zIndex=a.zIndex?a.zIndex:15,a.zIndex++}}function B(e,t,r,n,o){let c=a.currentChart;if(c&&1==c.rangeArray.length){var i=c.rangeArray[0].row,s=c.rangeArray[0].column;if(t>i[1]||r<i[0]||n>s[1]||o<s[0])return;var h=l.getcellrange(c.rangeTxt),d=-1==h.sheetIndex?0:h.sheetIndex,u=(h.row,h.column,z(c.rangeTxt));if("object"==typeof u&&0!=u.length&&null!=u.data.length){var g=u.data;a.chartparam.changeChartCellData(c.chart_id,g)}}}function N(e){e.find(".luckysheet-modal-dialog-content").hover(function(){e.removeClass("chart-moveable")},function(){e.addClass("chart-moveable")}),e.hover(function(){e.addClass("chart-moveable")},function(){e.removeClass("chart-moveable")})}function V(e){$(`.luckysheet-cell-main #${e}_c`).remove(),U();let t=a.luckysheetfile[_(a.currentSheetIndex)],r=t.chart.findIndex(t=>t.chart_id==e);t.chart.splice(r,1),a.deleteChart(e)}function K(e){let t=a.luckysheetfile[_(a.currentSheetIndex)].chart;for(let r in t)t[r].needRangeShow=!1,t[r].chart_id==e&&(t[r].needRangeShow=!0,a.currentChart=a.getChartJson(e));Z(e)}function U(){let e=a.luckysheetfile[_(a.currentSheetIndex)].chart;for(let t in e)e[t].needRangeShow=!1;q()}function Z(e){let t=$("#"+e+"_c");a.chart_selection.create(),a.chartparam.luckysheetCurrentChartActive=!0,a.chartparam.luckysheetCurrentChartMoveObj=t,a.chartparam.luckysheetCurrentChartResizeObj=t,a.chartparam.luckysheetCurrentChart=e,$("#luckysheet-cell-main").find(".luckysheet-modal-dialog-chart .luckysheet-modal-dialog-resize").hide(),$("#luckysheet-cell-main").find(".luckysheet-modal-dialog-chart .luckysheet-modal-dialog-controll").hide(),t.css("z-index",a.chartparam.luckysheetCurrentChartZIndexRank++),t.find(".luckysheet-modal-dialog-resize").show(),t.find(".luckysheet-modal-dialog-controll").show(),($(".chartSetting").is(":visible")||a.chartparam.luckysheet_chart_redo_click)&&e!=a.chartparam.luckysheetCurrentChart&&$("body .luckysheet-cols-menu").hide(),a.currentChart=a.highlightChart(e)}function q(e){var t;$("#luckysheet-cell-main .luckysheet-modal-dialog-chart .luckysheet-modal-dialog-resize, #luckysheet-cell-main .luckysheet-modal-dialog-chart .luckysheet-modal-dialog-controll").hide(),$("#luckysheet-cell-main").find(".luckysheet-datavisual-selection-set div").remove(),a.chartparam.luckysheetCurrentChartActive=!1,$("#luckysheet-chart-rangeShow").empty(),e||!$(".chartSetting").is(":visible")||E()||$(".chartSetting").is(":visible")&&($(".chartSetting").hide(),$("#luckysheet-cell-main .luckysheet-modal-dialog-chart .luckysheet-modal-dialog-resize, #luckysheet-cell-main .luckysheet-modal-dialog-chart .luckysheet-modal-dialog-controll").hide(),$("#luckysheet-cell-main").find(".luckysheet-datavisual-selection-set div").remove(),a.chartparam.luckysheetCurrentChartActive=!1,E()||t||setTimeout(function(){d()},0))}function F(e,t){$(".chartSetting").is(":visible")||($(".chartSetting").show(),$("#luckysheet-cell-main").find(".luckysheet-datavisual-selection-set div").show(),a.chartparam.luckysheetCurrentChartActive=!0,setTimeout(function(){d()},0))}function G(e){q("true"),a.luckysheetfile.forEach(t=>{if(t.index==e){(t.chart||[]).forEach(e=>{e.isShow=!0,$("#"+e.chart_id+"_c").show(),a.resizeChart(e.chart_id),1==e.needRangeShow&&(a.currentChart=a.getChartJson(e.chart_id),Z(e.chart_id))})}else{(t.chart||[]).forEach(e=>{e.isShow=!1,$("#"+e.chart_id+"_c").hide()})}})}return{chart:function(e,t){k(P),setTimeout(function(){const r=new u.Store;console.info("chartmix::",m.default),g.use(m.default,{store:r});let l=document.getElementsByTagName("body")[0];m.default.initChart(l,a.lang),$(".chartSetting").css({top:"1px",bottom:"1px",position:"absolute",right:"0px",width:"350px",background:"#fff",border:"1px solid #E5E5E5","z-index":1004,"box-shadow":"0px 2px 4px rgba(0,0,0,0.2)","-webkit-box-shadow":"0px 2px 4px rgba(0,0,0,0.2)","-moz-box-shadow":"0px 2px 4px rgba(0,0,0,0.2)","-moz-user-select":"none","-khtml-user-select":"none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none","padding-left":"30px",display:"none"}),a.createChart=m.default.createChart,a.highlightChart=m.default.highlightChart,a.deleteChart=m.default.deleteChart,a.resizeChart=m.default.resizeChart,a.changeChartRange=m.default.changeChartRange,a.changeChartCellData=m.default.changeChartCellData,a.getChartJson=m.default.getChartJson,a.chart_selection={create:function(){var e=a.currentChart;if(!(e.rangeArray.length>1)){$("#luckysheet-chart-rangeShow").empty(),$("#luckysheet-cell-selected-boxs").hide(),$("#luckysheet-cell-selected-focus").hide(),$("#luckysheet-rows-h-selected").empty(),$("#luckysheet-cols-h-selected").empty(),$("#luckysheet-row-count-show").hide(),$("#luckysheet-column-count-show").hide();var t=e.rangeArray[0].row[0],r=e.rangeArray[0].column[0],l=e.rangeSplitArray,n=e.rangeRowCheck;if(n.exits)var o=h("rowtitle",l.rowtitle.row[0]+t,l.rowtitle.row[1]+t,l.rowtitle.column[0]+r,l.rowtitle.column[1]+r);else var o="";var c=e.rangeColCheck;if(c.exits)var i=h("coltitle",l.coltitle.row[0]+t,l.coltitle.row[1]+t,l.coltitle.column[0]+r,l.coltitle.column[1]+r);else var i="";var s=h("content",l.content.row[0]+t,l.content.row[1]+t,l.content.column[0]+r,l.content.column[1]+r);$("#luckysheet-chart-rangeShow").append(o+i+s)}function h(e,t,r,a,l){var n=R(),o=A(),c=n[r],i=t-1==-1?0:n[t-1],s=o[l],h=a-1==-1?0:o[a-1];if("rowtitle"==e)var d="#C65151";if("coltitle"==e)var d="#9667C0";if("content"==e)var d="#4970D1";var u='<div id="luckysheet-chart-rangeShow-'+e+'" style="left: '+h+"px;width: "+(s-h-1)+"px;top: "+i+"px;height: "+(c-i-1)+'px;border: none;margin: 0;position: absolute;z-index: 14;"><div class="luckysheet-chart-rangeShow-move" data-type="top" style="height: 2px;border-top: 2px solid #fff;border-bottom: 2px solid #fff;background: '+d+';position: absolute;left: 0;right: 0;top: -2px;z-index: 18;opacity: 0.9;cursor: move;"></div><div class="luckysheet-chart-rangeShow-move" data-type="right" style="width: 2px;border-left: 2px solid #fff;border-right: 2px solid #fff;background: '+d+';position: absolute;top: 0;bottom: 0;right: -2px;z-index: 18;opacity: 0.9;cursor: move;"></div><div class="luckysheet-chart-rangeShow-move" data-type="bottom" style="height: 2px;border-top: 2px solid #fff;border-bottom: 2px solid #fff;background: '+d+';position: absolute;left: 0;right: 0;bottom: -2px;z-index: 18;opacity: 0.9;cursor: move;"></div><div class="luckysheet-chart-rangeShow-move" data-type="left" style="width: 2px;border-left: 2px solid #fff;border-right: 2px solid #fff;background: '+d+';position: absolute;top: 0;bottom: 0;left: -2px;z-index: 18;opacity: 0.9;cursor: move;"></div><div style="border: 2px solid #85c0fc;background: '+d+';position: absolute;top: 0;right: 0;bottom: 0;left: 0;z-index: 15;opacity: 0.1;"></div><div class="luckysheet-chart-rangeShow-resize" data-type="lt" style="width: 6px;height: 6px;border: 1px solid #fff;background: '+d+';position: absolute;left: -3px;top: -3px;z-index: 19;cursor: se-resize;"></div><div class="luckysheet-chart-rangeShow-resize" data-type="rt" style="width: 6px;height: 6px;border: 1px solid #fff;background: '+d+';position: absolute;right: -3px;top: -3px;z-index: 19;cursor: ne-resize;"></div><div class="luckysheet-chart-rangeShow-resize" data-type="lb" style="width: 6px;height: 6px;border: 1px solid #fff;background: '+d+';position: absolute;left: -3px;bottom: -3px;z-index: 19;cursor: ne-resize;"></div><div class="luckysheet-chart-rangeShow-resize" data-type="rb" style="width: 6px;height: 6px;border: 1px solid #fff;background: '+d+';position: absolute;right: -3px;bottom: -3px;z-index: 19;cursor: se-resize;"></div></div>';return u}},rangeMove:!1,rangeMovexy:null,rangeMoveIndex:null,rangeMoveObj:null,rangeMoveDraging:function(e,t,r){var l=a.currentChart,n=l.rangeArray[0].row[0],o=l.rangeArray[0].column[0],c=l.rangeRowCheck,i=l.rangeColCheck,s=l.rangeSplitArray,h=T(e.pageX,e.pageY),d=$("#luckysheet-cell-main").scrollLeft(),u=$("#luckysheet-cell-main").scrollTop(),g=h[0]+d,y=h[1]+u,m=$(window).height()+u-t-r,p=$(window).width()+d,k=X(y),f=k[2],x=J(g),v=x[2],w=R(),b=A(),C=a.chart_selection.rangeMoveObj.attr("id");if("luckysheet-chart-rangeShow-content"==C){var z=a.chart_selection.rangeMoveIndex[0]-a.chart_selection.rangeMovexy[0]+f;c.exits?(z<n+c.range[1]+1||y<0)&&(z=n+c.range[1]+1):(z<0||y<0)&&(z=0);var _=s.content.row[1]-s.content.row[0]+z;(_>=w.length-1||y>m)&&(z=w.length-1-s.content.row[1]+s.content.row[0],_=w.length-1);var S=a.chart_selection.rangeMoveIndex[1]-a.chart_selection.rangeMovexy[1]+v;i.exits?(S<o+i.range[1]+1||g<0)&&(S=o+i.range[1]+1):(S<0||g<0)&&(S=0);var I=s.content.column[1]-s.content.column[0]+S;(I>=b.length-1||g>p)&&(S=b.length-1-s.content.column[1]+s.content.column[0],I=b.length-1),c.exits&&i.exits?(l.rangeArray=[{row:[n,_],column:[o,I]}],l.rangeSplitArray.range={row:[n,_],column:[o,I]},l.rangeSplitArray.content={row:[z-n,_-n],column:[S-o,I-o]},l.rangeSplitArray.rowtitle={row:l.rangeSplitArray.rowtitle.row,column:[S-o,I-o]},l.rangeSplitArray.coltitle={row:[z-n,_-n],column:l.rangeSplitArray.coltitle.column}):c.exits?(l.rangeArray=[{row:[n,_],column:[S,I]}],l.rangeSplitArray.range={row:[n,_],column:[S,I]},l.rangeSplitArray.content={row:[z-n,_-n],column:l.rangeSplitArray.content.column}):i.exits?(l.rangeArray=[{row:[z,_],column:[o,I]}],l.rangeSplitArray.range={row:[z,_],column:[o,I]},l.rangeSplitArray.content={row:l.rangeSplitArray.content.row,column:[S-o,I-o]}):(l.rangeArray=[{row:[z,_],column:[S,I]}],l.rangeSplitArray.range={row:[z,_],column:[S,I]})}else if("luckysheet-chart-rangeShow-rowtitle"==C){var S=a.chart_selection.rangeMoveIndex[1]-a.chart_selection.rangeMovexy[1]+v;i.exits?(S<o+i.range[1]+1||g<0)&&(S=o+i.range[1]+1):(S<0||g<0)&&(S=0);var I=s.rowtitle.column[1]-s.rowtitle.column[0]+S;(I>=b.length-1||g>p)&&(S=b.length-1-s.rowtitle.column[1]+s.rowtitle.column[0],I=b.length-1),i.exits?(l.rangeArray=[{row:l.rangeArray[0].row,column:[o,I]}],l.rangeSplitArray.range={row:l.rangeArray[0].row,column:[o,I]},l.rangeSplitArray.rowtitle={row:l.rangeSplitArray.rowtitle.row,column:[S-o,I-o]},l.rangeSplitArray.content={row:l.rangeSplitArray.content.row,column:[S-o,I-o]}):(l.rangeArray=[{row:l.rangeArray[0].row,column:[S,I]}],l.rangeSplitArray.range={row:l.rangeArray[0].row,column:[S,I]})}else if("luckysheet-chart-rangeShow-coltitle"==C){var z=a.chart_selection.rangeMoveIndex[0]-a.chart_selection.rangeMovexy[0]+f;c.exits?(z<n+c.range[1]+1||y<0)&&(z=n+c.range[1]+1):(z<0||y<0)&&(z=0);var _=s.coltitle.row[1]-s.coltitle.row[0]+z;(_>=w.length-1||y>m)&&(z=w.length-1-s.coltitle.row[1]+s.coltitle.row[0],_=w.length-1),c.exits?(l.rangeArray=[{row:[n,_],column:l.rangeArray[0].column}],l.rangeSplitArray.range={row:[n,_],column:l.rangeArray[0].column},l.rangeSplitArray.coltitle={row:[z-n,_-n],column:l.rangeSplitArray.coltitle.column},l.rangeSplitArray.content={row:[z-n,_-n],column:l.rangeSplitArray.content.column}):(l.rangeArray=[{row:[z,_],column:l.rangeArray[0].column}],l.rangeSplitArray.range={row:[z,_],column:l.rangeArray[0].column})}a.chart_selection.create()},rangeMoveDragged:function(){a.chart_selection.rangeMove=!1;var e=a.currentChart;e.rangeTxt=S(a.currentSheetIndex,e.rangeArray[0],a.currentSheetIndex),e.chartData=b(e.rangeArray[0],a.currentSheetIndex),a.changeChartRange(e.chart_id,e.chartData,e.rangeArray,e.rangeTxt)},rangeResize:!1,rangeResizexy:null,rangeResizeIndex:null,rangeResizeObj:null,rangeResizeDraging:function(e,t,r){var l=a.currentChart,n=l.rangeArray[0].row[0],o=l.rangeArray[0].column[0],c=l.rangeRowCheck,i=l.rangeColCheck,s=(l.rangeSplitArray,T(e.pageX,e.pageY)),h=$("#luckysheet-cell-main").scrollLeft(),d=$("#luckysheet-cell-main").scrollTop(),u=s[0]+h,g=s[1]+d,y=$(window).height()+d-t-r,m=$(window).width()+h,p=X(g),k=p[2],f=J(u),x=f[2],v=R(),w=A(),b=a.chart_selection.rangeResizeObj.attr("id");if("luckysheet-chart-rangeShow-content"==b){if("lt"==a.chart_selection.rangeResize?(O=a.chart_selection.rangeResizeIndex.row[0],_=a.chart_selection.rangeResizeIndex.column[0],j=a.chart_selection.rangeResizeIndex.row[1],S=a.chart_selection.rangeResizeIndex.column[1]):"lb"==a.chart_selection.rangeResize?(O=a.chart_selection.rangeResizeIndex.row[1],_=a.chart_selection.rangeResizeIndex.column[0],j=a.chart_selection.rangeResizeIndex.row[0],S=a.chart_selection.rangeResizeIndex.column[1]):"rt"==a.chart_selection.rangeResize?(O=a.chart_selection.rangeResizeIndex.row[0],_=a.chart_selection.rangeResizeIndex.column[1],j=a.chart_selection.rangeResizeIndex.row[1],S=a.chart_selection.rangeResizeIndex.column[0]):"rb"==a.chart_selection.rangeResize&&(O=a.chart_selection.rangeResizeIndex.row[1],_=a.chart_selection.rangeResizeIndex.column[1],j=a.chart_selection.rangeResizeIndex.row[0],S=a.chart_selection.rangeResizeIndex.column[0]),c.exits){var C=O-a.chart_selection.rangeResizexy[0]+k;C<n+c.range[1]+1||g<0?C=n+c.range[1]+1:(C>=v.length-1||g>y)&&(C=v.length-1)}else{var C=n-a.chart_selection.rangeResizexy[0]+k;C<0||g<0?C=0:(C>=v.length-1||g>y)&&(C=v.length-1)}if(i.exits){var z=_-a.chart_selection.rangeResizexy[1]+x;z<o+i.range[1]+1||u<0?z=o+i.range[1]+1:(z>=w.length-1||u>m)&&(z=w.length-1)}else{var z=o-a.chart_selection.rangeResizexy[1]+x;z<0||u<0?z=0:(z>=w.length-1||u>m)&&(z=w.length-1)}C>j?(W=j,D=C):(W=C,D=j),z>S?(I=S,M=z):(I=z,M=S),c.exits||i.exits?(l.rangeArray=[{row:[n,D],column:[o,M]}],l.rangeSplitArray.range={row:[n,D],column:[o,M]},l.rangeSplitArray.content={row:[W-n,D-n],column:[I-o,M-o]},c.exits&&(l.rangeSplitArray.rowtitle={row:l.rangeSplitArray.rowtitle.row,column:[I-o,M-o]}),i.exits&&(l.rangeSplitArray.coltitle={row:[W-n,D-n],column:l.rangeSplitArray.coltitle.column})):(l.rangeArray=[{row:[W,D],column:[I,M]}],l.rangeSplitArray.range={row:[W,D],column:[I,M]})}else if("luckysheet-chart-rangeShow-rowtitle"==b){var _,S,I,M;if("lt"==a.chart_selection.rangeResize||"lb"==a.chart_selection.rangeResize?(_=a.chart_selection.rangeResizeIndex.column[0],S=a.chart_selection.rangeResizeIndex.column[1]):"rt"!=a.chart_selection.rangeResize&&"rb"!=a.chart_selection.rangeResize||(_=a.chart_selection.rangeResizeIndex.column[1],S=a.chart_selection.rangeResizeIndex.column[0]),i.exits){var z=_-a.chart_selection.rangeResizexy[1]+x;z<o+i.range[1]+1||u<0?z=o+i.range[1]+1:(z>=w.length-1||u>m)&&(z=w.length-1)}else{var z=o-a.chart_selection.rangeResizexy[1]+x;z<0||u<0?z=0:(z>=w.length-1||u>m)&&(z=w.length-1)}z>S?(I=S,M=z):(I=z,M=S),i.exits?(l.rangeArray=[{row:l.rangeArray[0].row,column:[o,M]}],l.rangeSplitArray.range={row:l.rangeArray[0].row,column:[o,M]},l.rangeSplitArray.rowtitle={row:l.rangeSplitArray.rowtitle.row,column:[I-o,M-o]},l.rangeSplitArray.content={row:l.rangeSplitArray.content.row,column:[I-o,M-o]}):(l.rangeArray=[{row:l.rangeArray[0].row,column:[I,M]}],l.rangeSplitArray.range={row:l.rangeArray[0].row,column:[I,M]})}else if("luckysheet-chart-rangeShow-coltitle"==b){var O,j,W,D;if("lt"==a.chart_selection.rangeResize||"rt"==a.chart_selection.rangeResize?(O=a.chart_selection.rangeResizeIndex.row[0],j=a.chart_selection.rangeResizeIndex.row[1]):"lb"!=a.chart_selection.rangeResize&&"rb"!=a.chart_selection.rangeResize||(O=a.chart_selection.rangeResizeIndex.row[1],j=a.chart_selection.rangeResizeIndex.row[0]),c.exits){var C=O-a.chart_selection.rangeResizexy[0]+k;C<n+c.range[1]+1||g<0?C=n+c.range[1]+1:(C>=v.length-1||g>y)&&(C=v.length-1)}else{var C=n-a.chart_selection.rangeResizexy[0]+k;C<0||g<0?C=0:(C>=v.length-1||g>y)&&(C=v.length-1)}C>j?(W=j,D=C):(W=C,D=j),c.exits?(l.rangeArray=[{row:[n,D],column:l.rangeArray[0].column}],l.rangeSplitArray.range={row:[n,D],column:l.rangeArray[0].column},l.rangeSplitArray.coltitle={row:[W-n,D-n],column:l.rangeSplitArray.coltitle.column},l.rangeSplitArray.content={row:[W-n,D-n],column:l.rangeSplitArray.content.column}):(l.rangeArray=[{row:[W,D],column:l.rangeArray[0].column}],l.rangeSplitArray.range={row:[W,D],column:l.rangeArray[0].column})}a.chart_selection.create()},rangeResizeDragged:function(){a.chart_selection.rangeResize=null;var e=a.currentChart;e.rangeTxt=S(a.currentSheetIndex,e.rangeArray[0],a.currentSheetIndex),e.chartData=b(e.rangeArray[0],a.currentSheetIndex),a.changeChartRange(e.chart_id,e.chartData,e.rangeArray,e.rangeTxt)}},a.chartparam.jfrefreshchartall=B,a.chartparam.changeChartCellData=m.default.changeChartCellData,a.chartparam.renderChart=m.default.renderChart,a.chartparam.getChartJson=m.default.getChartJson,a.chartparam.insertToStore=m.default.insertToStore;for(let r=0;r<e.length;r++)Y(e[r].chart,t);for(let t=0;t<e.length;t++)"1"==e[t].status&&G(e[t].index);x(a.asyncLoad,"chart")},0)},createLuckyChart:function(e,t,r,l){var n=luckysheet.getluckysheet_select_save();1==n.length&&n[0].row[0]==n[0].row[1]&&n[0].column[0]==n[0].column[1]&&(H("right","rangeOfSelect"),H("down","rangeOfSelect"),n=luckysheet.getluckysheet_select_save());for(var o=-1,c=n[0].row[1]-n[0].row[0],i=n[0].row[0];i<=n[0].row[1];i++){for(var s=n[0].column[0];s<=n[0].column[1];s++)if(null!=(u=C(i,s,luckysheet.flowdata()))&&u.toString().length>0){o=i;break}if(-1!==o)break}-1==o&&(o=0),n[0].row=[o,o],luckysheet.setluckysheet_select_save(n),a.luckysheet_shiftpositon=$.extend(!0,{},n[0]),L("down","range",!1,c);var h=-1,d=(n=luckysheet.getluckysheet_select_save())[0].column[1]-n[0].column[0];for(s=n[0].column[0];s<=n[0].column[1];s++){for(i=n[0].row[0];i<=n[0].row[1];i++){var u;if(null!=(u=C(i,s,luckysheet.flowdata()))&&u.toString().length>0){h=s;break}}if(-1!==h)break}-1==h&&(h=0),n[0].column=[h,h],luckysheet.setluckysheet_select_save(n),a.luckysheet_shiftpositon=$.extend(!0,{},n[0]),L("right","range",!1,d),n=luckysheet.getluckysheet_select_save();var g=$.extend(!0,[],n),y=S(a.currentSheetIndex,g[0],a.currentSheetIndex);let m=b();console.dir(m);let p=v("chart"),k=p+"_c",f=$(w('<div id="${id}"class="luckysheet-modal-dialog luckysheet-modal-dialog-chart ${addclass}"tabindex="0"role="dialog"aria-labelledby=":41e"dir="ltr"><div class="luckysheet-modal-dialog-resize"><div class="luckysheet-modal-dialog-resize-item luckysheet-modal-dialog-resize-item-lt"data-type="lt"></div><div class="luckysheet-modal-dialog-resize-item luckysheet-modal-dialog-resize-item-mt"data-type="mt"></div><div class="luckysheet-modal-dialog-resize-item luckysheet-modal-dialog-resize-item-lm"data-type="lm"></div><div class="luckysheet-modal-dialog-resize-item luckysheet-modal-dialog-resize-item-rm"data-type="rm"></div><div class="luckysheet-modal-dialog-resize-item luckysheet-modal-dialog-resize-item-rt"data-type="rt"></div><div class="luckysheet-modal-dialog-resize-item luckysheet-modal-dialog-resize-item-lb"data-type="lb"></div><div class="luckysheet-modal-dialog-resize-item luckysheet-modal-dialog-resize-item-mb"data-type="mb"></div><div class="luckysheet-modal-dialog-resize-item luckysheet-modal-dialog-resize-item-rb"data-type="rb"></div></div><div class="luckysheet-modal-dialog-controll"><span class="luckysheet-modal-controll-btn luckysheet-modal-controll-update"role="button"tabindex="0"aria-label="修改图表"title="修改图表"><i class="fa fa-pencil"aria-hidden="true"></i></span><span class="luckysheet-modal-controll-btn luckysheet-modal-controll-max"role="butluckysheet_chartIns_indexton"tabindex="0"aria-label="最大化"title="最大化"><i class="fa fa-window-maximize"aria-hidden="true"></i></span><span class="luckysheet-modal-controll-btn luckysheet-modal-controll-del"role="button"tabindex="0"aria-label="删除"title="删除"><i class="fa fa-trash"aria-hidden="true"></i></span></div><div class="luckysheet-modal-dialog-content">${content}</div></div>',{id:k,addclass:"luckysheet-data-visualization-chart",title:"图表生成",content:""})).appendTo($(".luckysheet-cell-main")),x=document.getElementById(k),{render:z,chart_json:A}=a.createChart($(`#${k}`).children(".luckysheet-modal-dialog-content")[0],m,p,g,y);console.dir(JSON.stringify(A)),e=e||400,t=t||250,r=r||0,l=l||0,x.style.width=e+"px",x.style.height=t+"px",x.style.position="absolute",x.style.background="#fff",x.style.left=r+"px",x.style.top=l+"px",z.style.width="100%",z.style.height="100%",x.style.zIndex=a.zIndex?a.zIndex:15,a.zIndex++;let R=a.luckysheetfile[_(a.currentSheetIndex)];R.chart||(R.chart=[]),R.chart.push({chart_id:p,width:e,height:t,left:r,top:l,sheetIndex:R.index}),K(p),$(`#${p}_c .luckysheet-modal-controll-del`).click(function(e){V(p)}),N(f),$(`#${p}_c .luckysheet-modal-controll-update`).click(function(e){F()}),f.children(".luckysheet-modal-dialog-content").mousedown(function(e){a.chartparam.luckysheetCurrentChartMaxState||K(p),e.stopPropagation()}),f.mousedown(function(e){if(!a.chartparam.luckysheetCurrentChartMaxState){K(p),O(!0),$(e.target).is(".luckysheet-modal-dialog-controll")||$(e.target).is(".luckysheet-modal-controll-btn")||$(e.target).is("i")||(a.chartparam.luckysheetCurrentChartMoveTimeout=setTimeout(function(){a.chartparam.luckysheetCurrentChartMove=!0},100));var t=a.chartparam.luckysheetCurrentChartMoveObj.offset(),r=a.chartparam.luckysheetCurrentChartMoveObj.position();a.chartparam.luckysheetCurrentChartMoveXy=[e.pageX-t.left,e.pageY-t.top,r.left,r.top,$("#luckysheet-scrollbar-x").scrollLeft(),$("#luckysheet-scrollbar-y").scrollTop()],a.chartparam.luckysheetCurrentChartMoveWinH=$("#luckysheet-cell-main")[0].scrollHeight,a.chartparam.luckysheetCurrentChartMoveWinW=$("#luckysheet-cell-main")[0].scrollWidth,$(e.target).hasClass("luckysheet-mousedown-cancel")||0!=$(e.target).filter("[class*='sp-palette']").length||0!=$(e.target).filter("[class*='sp-thumb']").length||0!=$(e.target).filter("[class*='sp-']").length||($("#luckysheet-rightclick-menu").hide(),$("#luckysheet-cols-h-hover").hide(),$("#luckysheet-cols-menu-btn").hide(),$("#luckysheet-rightclick-menu").hide(),$("#luckysheet-sheet-list, #luckysheet-rightclick-sheet-menu, #luckysheet-user-menu").hide(),$("body > .luckysheet-filter-menu, body > .luckysheet-filter-submenu, body > .luckysheet-cols-menu").hide()),e.stopPropagation()}}).find(".luckysheet-modal-dialog-resize-item").mousedown(function(e){if(a.chartparam.luckysheetCurrentChartActive){a.chartparam.luckysheetCurrentChartResize=$(this).data("type");var t=T(e.pageX,e.pageY),r=$("#luckysheet-scrollbar-x").scrollLeft(),l=$("#luckysheet-scrollbar-y").scrollTop(),n=t[0]+r,o=t[1]+l,c=a.chartparam.luckysheetCurrentChartResizeObj.position();a.chartparam.luckysheetCurrentChartResizeXy=[n,o,f.width(),f.height(),c.left+r,c.top+l,r,l],a.chartparam.luckysheetCurrentChartResizeWinH=$("#luckysheet-cell-main")[0].scrollHeight,a.chartparam.luckysheetCurrentChartResizeWinW=$("#luckysheet-cell-main")[0].scrollWidth,a.chartparam.luckysheetCurrentChart=p,e.stopPropagation()}})},hideAllNeedRangeShow:U,renderChartShow:G}});
//# sourceMappingURL=../../sourcemaps/expendPlugins/chart/plugin.js.map
